"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[2121],{1644:function(e,t,n){n.d(t,{e:function(){return s}});const s=e=>"feedback"in e?e.feedback.value:"value"in e.expectation?e.expectation.value:e.expectation.serialized_value.value},2844:function(e,t){t.A={'code[class*="language-"]':{fontFamily:'Consolas, Menlo, Monaco, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", "Courier New", Courier, monospace',fontSize:"14px",lineHeight:"1.375",direction:"ltr",textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none",background:"#2a2734",color:"#5DFAFC"},'pre[class*="language-"]':{fontFamily:'Consolas, Menlo, Monaco, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", "Courier New", Courier, monospace',fontSize:"14px",lineHeight:"1.375",direction:"ltr",textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none",background:"#2a2734",color:"#5DFAFC",padding:"1em",margin:".5em 0",overflow:"auto"},'pre > code[class*="language-"]':{fontSize:"1em"},'pre[class*="language-"]::-moz-selection':{textShadow:"none",background:"#6a51e6"},'pre[class*="language-"] ::-moz-selection':{textShadow:"none",background:"#6a51e6"},'code[class*="language-"]::-moz-selection':{textShadow:"none",background:"#6a51e6"},'code[class*="language-"] ::-moz-selection':{textShadow:"none",background:"#6a51e6"},'pre[class*="language-"]::selection':{textShadow:"none",background:"#6a51e6"},'pre[class*="language-"] ::selection':{textShadow:"none",background:"#6a51e6"},'code[class*="language-"]::selection':{textShadow:"none",background:"#6a51e6"},'code[class*="language-"] ::selection':{textShadow:"none",background:"#6a51e6"},':not(pre) > code[class*="language-"]':{padding:".1em",borderRadius:".3em"},comment:{color:"#6c6783"},prolog:{color:"#6c6783"},doctype:{color:"#6c6783"},cdata:{color:"#6c6783"},punctuation:{color:"#6c6783"},namespace:{Opacity:".7"},tag:{color:"#3AACE2"},operator:{color:"#3AACE2"},number:{color:"#3AACE2"},property:{color:"#5DFAFC"},function:{color:"#5DFAFC"},"tag-id":{color:"#eeebff"},selector:{color:"#eeebff"},"atrule-id":{color:"#eeebff"},"code.language-javascript":{color:"#c4b9fe"},"attr-name":{color:"#c4b9fe"},"code.language-css":{color:"#ffffff"},"code.language-scss":{color:"#ffffff"},boolean:{color:"#ffffff"},string:{color:"#ffffff"},entity:{color:"#ffffff",cursor:"help"},url:{color:"#ffffff"},".language-css .token.string":{color:"#ffffff"},".language-scss .token.string":{color:"#ffffff"},".style .token.string":{color:"#ffffff"},"attr-value":{color:"#ffffff"},keyword:{color:"#ffffff"},control:{color:"#ffffff"},directive:{color:"#ffffff"},unit:{color:"#ffffff"},statement:{color:"#ffffff"},regex:{color:"#ffffff"},atrule:{color:"#ffffff"},placeholder:{color:"#ffffff"},variable:{color:"#ffffff"},deleted:{textDecoration:"line-through"},inserted:{borderBottom:"1px dotted #eeebff",textDecoration:"none"},italic:{fontStyle:"italic"},important:{fontWeight:"bold",color:"#c4b9fe"},bold:{fontWeight:"bold"},"pre > code.highlight":{Outline:".4em solid #8a75f5",OutlineOffset:".4em"},".line-numbers.line-numbers .line-numbers-rows":{borderRightColor:"#2c2937"},".line-numbers .line-numbers-rows > span:before":{color:"#3c3949"},".line-highlight.line-highlight":{background:"linear-gradient(to right, rgba(224, 145, 66, 0.2) 70%, rgba(224, 145, 66, 0))"}}},15100:function(e,t,n){n.d(t,{S:function(){return p}});var s=n(89555),o=n(9133),r=n(16934),a=n(48443),i=n(68048),l=n(50111);var c={name:"1gyqtrv",styles:"width:min-content;max-width:100%"},d={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const u=({objectKey:e,value:t})=>{const{theme:n}=(0,r.u)(),u=(0,o.isString)(t)?t:JSON.stringify(t);return(0,l.Y)(a.T,{content:u,componentId:"shared.model-trace-explorer.expectation-value-preview-tooltip",children:(0,l.Y)(i.Tag,{color:"indigo",componentId:"shared.model-trace-explorer.expectation-array-item-tag",css:c,children:(0,l.FD)(r.T.Text,{css:d,children:[e&&(0,l.FD)(r.T.Text,{bold:!0,css:(0,s.AH)({marginRight:n.spacing.xs},""),children:[e,":"]}),u]})})})},p=({parsedValue:e,singleLine:t=!1})=>{const{theme:n}=(0,r.u)();return(0,o.isNil)(e)?null:Array.isArray(e)?t?(0,l.Y)(u,{value:e}):(0,l.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:e.map(((e,t)=>(0,l.Y)(u,{value:e},t)))}):(0,o.isObject)(e)?t?(0,l.Y)(u,{value:e}):(0,l.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:Object.entries(e).map((([e,t])=>(0,l.Y)(u,{objectKey:e,value:t},e)))}):(0,l.Y)(u,{value:e})}},23684:function(e,t,n){n.d(t,{F:function(){return c}});var s=n(89555),o=n(16934),r=n(68048),a=n(50111);var i={name:"15currb",styles:"display:flex;height:100%"},l={name:"82a6rk",styles:"flex:1"};const c=({label:e})=>{const{theme:t}=(0,o.u)();return(0,a.FD)("div",{css:i,children:[(0,a.FD)("div",{css:l,children:[(0,a.Y)("div",{css:(0,s.AH)({padding:t.spacing.sm,borderBottom:`1px solid ${t.colors.border}`},""),children:(0,a.Y)(r.TitleSkeleton,{label:e})}),(0,a.FD)("div",{css:(0,s.AH)({borderRadius:t.legacyBorders.borderRadiusMd,overflow:"hidden",display:"flex"},""),children:[(0,a.Y)("div",{css:(0,s.AH)({flex:1,padding:t.spacing.sm,borderRight:`1px solid ${t.colors.border}`},""),children:(0,a.Y)(r.TableSkeleton,{lines:5})}),(0,a.Y)("div",{css:(0,s.AH)({flex:2,padding:t.spacing.sm},""),children:(0,a.Y)(r.TableSkeleton,{lines:5})})]})]}),(0,a.Y)("div",{css:(0,s.AH)({padding:t.spacing.md,overflowY:"auto",flex:1},""),children:(0,a.Y)(r.TableSkeleton,{lines:12})})]})}},24507:function(e,t,n){n(31014),n(26785)},26955:function(e,t,n){n.d(t,{w:function(){return s}});const s=()=>"User"},31814:function(e,t,n){n.d(t,{a:function(){return ls}});var s=n(89555),o=n(31014),r=n(28486),a=n(16934),i=n(68048),l=n(7450);var c=n(46932),d=n(9133),u=n.n(d),p=n(15230),m=n(94026),g=n(50111);var h={name:"1h0bf8r",styles:"body, :host{user-select:none;}"},f={name:"1gtrael",styles:"display:flex;flex:1;overflow:hidden;flex-direction:row"},v={name:"kjqqaz",styles:"width:0;position:relative"};var x=(0,o.forwardRef)((({initialRatio:e,paneWidth:t,setPaneWidth:n,leftChild:r,leftMinWidth:i,rightChild:l,rightMinWidth:c},u)=>{var x;const[y,b]=(0,o.useState)(!1),Y=(0,o.useRef)(null),S=null===(x=(0,m.wY)({ref:Y}))||void 0===x?void 0:x.width,A=(null!==S&&void 0!==S?S:1/0)-c,w=(0,o.useRef)(e),{theme:T}=(0,a.u)(),M=(0,o.useCallback)((e=>{S&&(w.current=e/S)}),[S]);return(0,o.useImperativeHandle)(u,(()=>({updateRatio:M}))),(0,o.useLayoutEffect)((()=>{S&&n((0,d.clamp)(S*w.current,i,A))}),[S,A,i,c,n]),(0,g.FD)("div",{ref:Y,css:f,children:[y&&(0,g.Y)(s.mL,{styles:h}),(0,g.Y)(p.ResizableBox,{axis:"x",width:t,css:(0,s.AH)({display:"flex",flex:`0 0 ${t}px`},""),handle:(0,g.Y)("div",{css:v,children:(0,g.Y)("div",{css:(0,s.AH)({position:"relative",width:T.spacing.sm,marginLeft:-T.spacing.xs,minHeight:"100%",cursor:"ew-resize",backgroundColor:"rgba(0,0,0,0)",zIndex:1,":hover":{backgroundColor:"rgba(0,0,0,0.1)"}},"")})}),onResize:(e,{size:t})=>{const s=(0,d.clamp)(t.width,i,A);n(s),S&&(w.current=s/S)},onResizeStart:()=>b(!0),onResizeStop:()=>b(!1),minConstraints:[i,1/0],maxConstraints:[A,1/0],children:r}),l]})})),y=n(76137),b=n(39330);var Y={name:"2wv1be",styles:"width:100%;box-sizing:border-box"};var S=({searchFilter:e,setSearchFilter:t,matchData:n,handleNextSearchMatch:r,handlePreviousSearchMatch:l})=>{const[c,d]=(0,o.useState)(e),u=(0,y.YQ)(t,350),{theme:p}=(0,a.u)();return(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",gap:p.spacing.sm},""),children:[(0,g.Y)(b.I,{componentId:"shared.model-trace-explorer.search-input",allowClear:!0,placeholder:"Search",value:c,onClear:()=>{t(""),d("")},onChange:e=>{d(e.target.value),u(e.target.value.toLowerCase())},prefix:(0,g.Y)(b.S,{}),css:Y}),n.match&&(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",marginLeft:p.spacing.xs,marginRight:p.spacing.sm,alignItems:"center"},""),children:[(0,g.FD)(a.T.Text,{css:(0,s.AH)({whiteSpace:"nowrap",marginRight:p.spacing.sm},""),children:[n.currentMatchIndex+1," / ",n.totalMatches]}),(0,g.Y)(a.B,{"data-testid":"prev-search-match",icon:(0,g.Y)(i.ChevronUpIcon,{}),onClick:l,componentId:"shared.model-trace-explorer.prev-search-match"}),(0,g.Y)(a.B,{"data-testid":"next-search-match",icon:(0,g.Y)(i.ChevronDownIcon,{}),onClick:r,componentId:"shared.model-trace-explorer.next-search-match"})]})]})};const A=1/0,w=5,T=3,M=1,k=e=>{const t=[],n=e=>{var s;e&&(t.push(e),null===(s=e.children)||void 0===s||s.forEach(n))};return e.forEach(n),t},D=(e,t=1/0)=>{const n={},s=(e,o)=>{var r;!e||o>t||(n[e.key]=e,null===(r=e.children)||void 0===r||r.forEach((e=>s(e,o+1))))};return e.forEach(s,0),n},I=e=>{if(0===e)return"0s";if(e>=6e7){return`${(e/1e6/60).toFixed(2)}m`}if(e>=1e5){return`${(e/1e6).toFixed(2)}s`}return`${(e/1e3).toFixed(2)}ms`},C=(e,t)=>{var n;return e.key===t?0:(null!==(n=e.children)&&void 0!==n?n:[]).findIndex((e=>C(e,t)>-1))},F=e=>{var t;if(!e.children||0===(null===(t=e.children)||void 0===t?void 0:t.length))return 0;const n=e.children.map(F);return Math.max(...n)+1},H=(0,o.createContext)({rootNode:null,nodeMap:{},activeView:"summary",setActiveView:()=>{},selectedNode:void 0,setSelectedNode:()=>{},activeTab:"content",setActiveTab:()=>{},showTimelineTreeGantt:!1,setShowTimelineTreeGantt:()=>{},assessmentsPaneExpanded:!1,setAssessmentsPaneExpanded:()=>{},assessmentsPaneEnabled:!0}),N=()=>(0,o.useContext)(H),R=({modelTrace:e,initialActiveView:t,selectedSpanIdOnRender:n,assessmentsPaneEnabled:s,children:r})=>{var a,i,l;const d=(0,o.useMemo)((()=>(0,c.jW)(e)),[e]),u=(0,o.useMemo)((()=>d?D([d]):{}),[d]),p=(0,c.f7)(d,n),m=null!==(a=null!==p&&void 0!==p?p:d)&&void 0!==a?a:void 0,h=(null!==(i=null===m||void 0===m||null===(l=m.assessments)||void 0===l?void 0:l.length)&&void 0!==i?i:0)>0,[f,v]=(0,o.useState)(t),[x,y]=(0,o.useState)(m),[b,Y]=(0,o.useState)(null!==x&&void 0!==x&&x.chatMessages?"chat":"content"),[S,A]=(0,o.useState)(!1),[w,T]=(0,o.useState)(h),M=(0,o.useMemo)((()=>({rootNode:d,nodeMap:u,activeView:f,setActiveView:v,activeTab:b,setActiveTab:Y,selectedNode:x,setSelectedNode:y,showTimelineTreeGantt:S,setShowTimelineTreeGantt:A,assessmentsPaneExpanded:w,setAssessmentsPaneExpanded:T,assessmentsPaneEnabled:s})),[f,u,b,d,x,S,A,w,T,s]);return(0,g.Y)(H.Provider,{value:M,children:r})},_=e=>{switch(e.section){case"inputs":case"outputs":default:return"content";case"attributes":return"attributes";case"events":return"events"}},E=({treeNode:e,selectedNode:t,setSelectedNode:n,setActiveTab:s,setExpandedKeys:r,modelTraceInfo:a})=>{var i;const[l,u]=(0,o.useState)(""),[p,m]=(0,o.useState)((()=>(e=>{const t={};e&&(0,d.compact)(k([e]).map((e=>e.type))).forEach((e=>{t[e]=!0}));return{showParents:!0,showExceptions:!0,spanTypeDisplayState:t}})(e))),[g,h]=(0,o.useState)(0),{filteredTreeNodes:f,matches:v}=(0,o.useMemo)((()=>(0,d.isNil)(e)?{filteredTreeNodes:[],matches:[]}:(0,c.vL)(e,l,p)),[null===e||void 0===e?void 0:e.key,l,p,a]),x=(0,o.useMemo)((()=>D(f)),[f]),y=(0,o.useCallback)((e=>{if(e>=v.length||e<0)return;h(e);const t=v[e];n(t.span),s(_(t));const o=((e,t)=>{const n=new Set;let s=e;for(;s&&s.parentId;)n.add(s.parentId),s=t[s.parentId];return n})(t.span,x);r((e=>new Set([...e,...o])))}),[v,n,s,x,r]),b=(0,o.useCallback)((()=>{y(g+1)}),[g,y]),Y=(0,o.useCallback)((()=>{y(g-1)}),[g,y]);return(0,o.useLayoutEffect)((()=>{if(0!==f.length)if(0!==v.length)h(0),n(v[0].span),s(_(v[0]));else{var e;const o=null!==(e=null===t||void 0===t?void 0:t.key)&&void 0!==e?e:"";if(o in x)n(x[o]);else{const e=f[0];n(e),s(null!==e&&void 0!==e&&e.chatMessages?"chat":"content")}}}),[f,v,n]),{matchData:{match:null!==(i=v[g])&&void 0!==i?i:null,totalMatches:v.length,currentMatchIndex:g},searchFilter:l.toLowerCase().trim(),setSearchFilter:u,spanFilterState:p,setSpanFilterState:m,filteredTreeNodes:f,handleNextSearchMatch:b,handlePreviousSearchMatch:Y}};var z=n(48563);const B="yellow500",O="yellow200",j=({searchFilter:e,data:t,activeMatch:n,containsActiveMatch:r})=>{const{theme:i}=(0,a.u)(),l=(0,o.useCallback)((e=>{null===e||void 0===e||e.scrollIntoView({block:"nearest",inline:"nearest"})}),[]),d=(0,o.useMemo)((()=>e?(0,c.OS)({data:t,searchFilter:e,activeMatchBackgroundColor:i.colors[B],inactiveMatchBackgroundColor:i.colors[O],containsActiveMatch:r,activeMatch:n,scrollToActiveMatch:l}):[]),[e,t,i,r,n,l]);return(0,g.Y)("pre",{css:(0,s.AH)({whiteSpace:"pre-wrap",backgroundColor:i.colors.backgroundSecondary,padding:i.spacing.sm,fontSize:i.typography.fontSizeSm},""),children:d})};var L=n(74396),K=n(55921),$=n(95451),V=n(22734);var P={name:"1qmr6ab",styles:"overflow:auto"},W={name:"uufhp1",styles:"height:auto;min-height:initial;display:inline-flex;min-width:100%;z-index:0"};const U=({children:e})=>(0,g.Y)("div",{"data-testid":"basic-table",css:P,children:(0,g.Y)(i.Table,{scrollable:!0,css:W,children:e})}),J=({children:e,node:t})=>{const{header:n,rows:s,isValid:r}=function({children:e}){var t;if(!e)return{header:void 0,rows:[],isValid:!1};const n=o.Children.toArray(e);return{header:null!==(t=n[0])&&void 0!==t?t:void 0,rows:n.slice(1).flatMap((e=>o.isValidElement(e)?o.Children.toArray(e.props.children).filter((e=>o.isValidElement(e))):[])),isValid:!0}}({children:e,node:t});return r?(0,g.Y)(G,{header:n,rows:s}):(0,g.Y)(U,{children:e,node:t})};var q={name:"qneu98",styles:"height:auto;min-height:initial;display:inline-flex;min-width:100%"};const G=({header:e,rows:t})=>{const{theme:n}=(0,a.u)(),r=o.useRef(null),l=(0,V.z)({size:t.length,parentRef:r,overscan:20}),{virtualItems:c,totalSize:d}=l;return(0,g.Y)("div",{"data-testid":"virtualized-table",ref:r,css:(0,s.AH)({overflow:"auto",maxHeight:420,border:"1px solid",borderColor:n.colors.border,borderRadius:n.borders.borderRadiusMd,marginBottom:n.spacing.md,zIndex:0},""),children:(0,g.FD)(i.Table,{css:q,children:[e,(0,g.Y)("div",{css:(0,s.AH)({position:"relative",height:`${d}px`,width:"100%",'& > div:last-child [role="cell"]':{borderBottom:"none"}},""),children:c.map((e=>{const n=e.index,o=t[n];return(0,g.Y)("div",{ref:e.measureRef,css:(0,s.AH)({position:"absolute",top:`${e.start}px`,width:"100%"},""),children:o},n)}))})]})})},Z=({children:e,node:t})=>{const n=null===t||void 0===t?void 0:t.children.some((e=>"th"===e.tagName)),{theme:s}=(0,a.u)();return(0,g.Y)(i.TableRow,{style:n?{position:"sticky",top:0,zIndex:1,backgroundColor:s.colors.backgroundPrimary}:void 0,children:e,isHeader:n})},X=({children:e,node:t})=>{const n="th"===(null===t||void 0===t?void 0:t.tagName),{theme:o}=(0,a.u)();return n?(0,g.Y)(i.TableHeader,{"data-testid":"virtualized-table-header",componentId:"virtualized-table-header",css:(0,s.AH)({paddingLeft:o.spacing.sm,borderColor:o.colors.border,color:o.colors.textPrimary},""),children:e}):(0,g.Y)(i.TableCell,{children:e})};const Q=e=>e.startsWith("data:image/png")||e.startsWith("data:image/jpeg")?e:(0,L.Lv)(e),ee=e=>{const t=(0,o.useMemo)((()=>ie({extensions:e.components})),[e.components]);return(0,g.Y)(L.oz,{components:t,remarkPlugins:re,urlTransform:Q,children:e.children})},te=({codeBlock:e,codeInline:t,node:n,...s})=>{var r,a;const i=o.useMemo((()=>{var e;const t=/language-(\w+)/.exec(null!==(e=s.className)&&void 0!==e?e:"");return t&&t[1]?t[1]:void 0}),[s.className]);return(null===n||void 0===n||null===(r=n.position)||void 0===r?void 0:r.start.line)===(null===n||void 0===n||null===(a=n.position)||void 0===a?void 0:a.end.line)?o.createElement(t,s):o.createElement(e,{...s,language:i})},ne=({children:e})=>(0,g.Y)(a.T.Text,{code:!0,children:e});var se={name:"bjn8wh",styles:"position:relative"};const oe=o.memo((({children:e,language:t})=>{const{theme:n}=(0,a.u)(),s=String(e).replace(/\n$/,"");return(0,g.Y)("div",{css:se,children:(0,g.Y)($.z7,{actions:(0,g.Y)($.VE,{componentId:"genai.util.markdown-copy-code-block",copyText:s}),theme:n.isDarkMode?"duotoneDark":"light",children:s,language:t&&le(t)?t:"text",style:{padding:"8px 0",borderRadius:8,width:"100%",boxSizing:"border-box",maxHeight:640,display:"flex",flexDirection:"column-reverse"},showLineNumbers:!0})})})),re=[K.A];var ae={name:"qhxz92",styles:"max-width:100%"};const ie=e=>({a:({href:e,children:t})=>(0,g.Y)(a.T.Link,{componentId:"codegen_webapp_js_genai_util_markdown.tsx_71",href:e,id:null!==e&&void 0!==e&&e.startsWith("#user-content-fn-")?e.replace("#user-content-fn-","user-content-fnref-"):void 0,disabled:null===e||void 0===e?void 0:e.startsWith("."),children:null!==e&&void 0!==e&&e.startsWith("#user-content-fn-")?(0,g.FD)(g.FK,{children:["[",t,"]"]}):t,openInNewTab:!(e&&e.startsWith("#"))}),code:t=>{var n,s,o,r;return(0,g.Y)(te,{...t,codeBlock:null!==(n=null===(s=e.extensions)||void 0===s?void 0:s.codeBlock)&&void 0!==n?n:oe,codeInline:null!==(o=null===(r=e.extensions)||void 0===r?void 0:r.codeInline)&&void 0!==o?o:ne})},p:({children:e})=>(0,g.Y)(a.T.Paragraph,{children:e}),h1:({children:e})=>(0,g.Y)(a.T.Title,{level:1,children:e}),h2:({children:e})=>(0,g.Y)(a.T.Title,{level:2,children:e}),h3:({children:e})=>(0,g.Y)(a.T.Title,{level:3,children:e}),h4:({children:e})=>(0,g.Y)(a.T.Title,{level:4,children:e}),h5:({children:e})=>(0,g.Y)(a.T.Title,{level:5,children:e}),table:({children:e,node:t})=>(0,g.Y)(J,{children:e,node:t}),tr:({children:e,node:t})=>(0,g.Y)(Z,{children:e,node:t}),th:({children:e,node:t})=>(0,g.Y)(X,{children:e,node:t}),td:({children:e})=>(0,g.Y)(i.TableCell,{children:e,multiline:!0}),thead:({children:e})=>(0,g.Y)(g.FK,{children:e}),tbody:({children:e})=>(0,g.Y)(g.FK,{children:e}),img:({src:e,alt:t})=>(0,g.Y)("img",{src:e,alt:t,css:ae})}),le=e=>{switch(e){case"go":case"java":case"javascript":case"json":case"python":case"sql":case"text":case"yaml":return!0;default:return!1}};var ce={name:"bjn8wh",styles:"position:relative"},de={name:"n31mhe",styles:"width:100%;padding:0"};function ue({data:e,searchFilter:t="",activeMatch:n=null,containsActiveMatch:r=!1,renderMode:c=z.cC.JSON,initialExpanded:u=!1}){const p=Boolean(t)&&!(0,d.isNil)(n)&&e.toLowerCase().includes(t),{theme:m}=(0,a.u)(),[h,f]=(0,o.useState)("json"===c),[v,x]=(0,o.useState)(u||p),y=(0,o.useRef)(null),b=(0,o.useMemo)((()=>{if("json"===c)return e;const t=JSON.parse(e);return(0,d.isString)(t)?t:e}),[e,c]),Y=h||b.split("\n").length>4||b.length>300,S=(0,o.useMemo)((()=>{if(Y&&!v){const e=b.split("\n").slice(0,4).join("\n");return e.length>300?e.slice(0,300):e}return b}),[b,Y,v]);(0,o.useEffect)((()=>{y.current&&f(y.current.scrollWidth>y.current.clientWidth)}),[c,e]);const A=(0,o.useCallback)((e=>(0,g.Y)("pre",{...e,ref:y})),[]);return p?(0,g.Y)(j,{data:e,searchFilter:t,activeMatch:n,containsActiveMatch:!n.isKeyMatch&&r}):(0,g.FD)("div",{css:ce,children:["markdown"===c?(0,g.Y)("div",{css:(0,s.AH)({padding:m.spacing.md,backgroundColor:m.colors.backgroundSecondary,marginBottom:-m.spacing.md},""),children:(0,g.Y)(ee,{children:S})}):(0,g.FD)(g.FK,{children:[(0,g.Y)($.VE,{componentId:"shared.model-trace-explorer.copy-snippet",copyText:e,size:"small",css:(0,s.AH)({position:"absolute",top:m.spacing.xs,right:m.spacing.xs,zIndex:1},"")},"copy-snippet"),(0,g.Y)($.z7,{PreTag:A,showLineNumbers:!0,language:c,lineProps:{style:{wordBreak:"break-word",whiteSpace:"pre-wrap"}},wrapLines:v,theme:m.isDarkMode?"duotoneDark":"light",style:{backgroundColor:m.colors.backgroundSecondary,padding:m.spacing.sm,paddingBottom:Y?0:m.spacing.sm,paddingRight:2*m.spacing.md,overflow:v?"auto":"hidden",textOverflow:"ellipsis",fontSize:m.typography.fontSizeSm,lineHeight:m.typography.lineHeightBase},children:S})]}),Y&&(0,g.Y)("div",{css:(0,s.AH)({backgroundColor:m.colors.backgroundSecondary},""),children:(0,g.Y)(a.B,{css:de,componentId:v?"shared.model-trace-explorer.snippet-see-less":"shared.model-trace-explorer.snippet-see-more",icon:v?(0,g.Y)(i.ChevronUpIcon,{}):(0,g.Y)(i.ChevronDownIcon,{}),type:"tertiary",onClick:()=>x(!v),children:v?(0,g.Y)(l.sA,{id:"AgjhWE",defaultMessage:"See less"}):(0,g.Y)(l.sA,{id:"HYQHVk",defaultMessage:"See more"})})})]})}const pe=({title:e,searchFilter:t,isActiveMatch:n})=>{const{theme:r}=(0,a.u)(),i=(0,o.useCallback)((e=>{null===e||void 0===e||e.scrollIntoView({block:"nearest",inline:"nearest"})}),[]),l=e.toLowerCase();if(!l.includes(t))return(0,g.Y)("div",{children:e});const c=l.indexOf(t),d=c+t.length,u=n?r.colors[B]:r.colors[O];return(0,g.FD)("div",{children:[e.slice(0,c),(0,g.Y)("span",{ref:n?i:null,css:(0,s.AH)({backgroundColor:u,scrollMarginTop:50},""),children:e.slice(c,d)}),e.slice(d)]})};function me(e,t){return t||(e?z.cC.MARKDOWN:z.cC.JSON)}function ge(e){switch(e){case z.cC.JSON:return"JSON";case z.cC.TEXT:return"Text";case z.cC.MARKDOWN:return"Markdown";case z.cC.PYTHON:return"Python"}}var he={name:"bjn8wh",styles:"position:relative"},fe={name:"1boj65s",styles:"max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},ve={name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"},xe={name:"2fp7nl",styles:"height:min-content;margin:0"};function ye({title:e,tokens:t,data:n,searchFilter:r="",activeMatch:l=null,containsActiveMatch:c=!1,initialRenderMode:u}){var p;const m=(0,o.useMemo)((()=>JSON.parse(n)),[n]),h=(0,d.isString)(m),{theme:f}=(0,a.u)(),[v,x]=(0,o.useState)(me(h,u)),y=c&&null!==(p=null===l||void 0===l?void 0:l.isKeyMatch)&&void 0!==p&&p,b=h&&!r;return(0,o.useEffect)((()=>{x(me(h,u))}),[h,u]),(0,g.Y)("div",{css:he,children:(0,g.FD)("div",{css:(0,s.AH)({borderRadius:f.borders.borderRadiusSm,border:`1px solid ${f.colors.border}`,overflow:"hidden"},""),children:[(e||b)&&(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:f.spacing.sm},""),children:[(0,g.Y)(a.T.Title,{css:fe,level:4,color:"secondary",withoutMargins:!0,children:(0,g.Y)(pe,{title:e,searchFilter:r,isActiveMatch:y})}),(0,g.Y)("div",{css:ve,children:b&&(0,g.FD)(i.DropdownMenu.Root,{children:[(0,g.Y)(i.DropdownMenu.Trigger,{asChild:!0,children:(0,g.Y)(i.Tag,{componentId:"shared.model-trace-explorer.snippet-render-mode-tag",css:xe,children:(0,g.FD)("div",{css:(0,s.AH)({paddingLeft:f.spacing.xs,marginRight:f.spacing.xs,cursor:"pointer"},""),children:[(0,g.Y)(a.T.Text,{size:"sm",color:"secondary",children:ge(v)}),(0,g.Y)(i.ChevronDownIcon,{})]})})}),(0,g.FD)(i.DropdownMenu.Content,{children:[(0,g.Y)(i.DropdownMenu.RadioGroup,{componentId:"shared.model-trace-explorer.snippet-render-mode-radio",value:v,onValueChange:e=>x(e),children:Object.values(z.cC).map((e=>e===z.cC.PYTHON?null:(0,g.FD)(i.DropdownMenu.RadioItem,{value:e,children:[(0,g.Y)(i.DropdownMenu.ItemIndicator,{}),ge(e)]},e)))}),(0,g.Y)(i.DropdownMenu.Arrow,{})]})]})})]}),(0,g.Y)(ue,{data:n,searchFilter:r,activeMatch:l,containsActiveMatch:c,renderMode:v})]})})}function be({activeSpan:e,searchFilter:t,activeMatch:n}){const{theme:o}=(0,a.u)(),{attributes:r}=e,c=(0,d.keys)(r).length>0,u=!(0,d.isNil)(n)&&n.span.key===e.key;return!c||(0,d.isNil)(r)?(0,g.Y)("div",{css:(0,s.AH)({marginTop:o.spacing.md},""),children:(0,g.Y)(i.Empty,{description:(0,g.Y)(l.sA,{id:"B5K1Ix",defaultMessage:"No attributes found"})})}):(0,g.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:o.spacing.sm,padding:o.spacing.md},""),children:Object.entries(r).map((([e,s])=>(0,g.Y)(ye,{title:e,data:JSON.stringify(s,null,2),searchFilter:t,activeMatch:n,containsActiveMatch:u&&"attributes"===n.section&&n.key===e},e)))})}function Ye({paramName:e,paramProperties:t,isRequired:n}){const{theme:o}=(0,a.u)(),{type:r,description:i,enum:c}=t,d=r||i||c,u=d?{borderTopLeftRadius:o.borders.borderRadiusMd,borderTopRightRadius:o.borders.borderRadiusMd,borderBottom:`1px solid ${o.colors.border}`}:{borderRadius:o.borders.borderRadiusMd};return(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:o.borders.borderRadiusMd,border:`1px solid ${o.colors.border}`},""),children:[(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",backgroundColor:o.colors.backgroundSecondary,padding:`${o.spacing.sm}px ${o.spacing.md}px`,gap:o.spacing.sm,...u},""),children:[(0,g.Y)(a.T.Title,{withoutMargins:!0,style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:e}),n&&(0,g.Y)(a.T.Text,{withoutMargins:!0,color:"error",children:(0,g.Y)(l.sA,{id:"JmNdE4",defaultMessage:"required"})})]}),d&&(0,g.FD)("div",{css:(0,s.AH)({display:"grid",gridTemplateColumns:"auto 1fr",gridTemplateRows:"auto",gap:o.spacing.md,padding:`${o.spacing.sm}px ${o.spacing.md}px`},""),children:[r&&(0,g.FD)(g.FK,{children:[(0,g.Y)(a.T.Text,{withoutMargins:!0,bold:!0,children:(0,g.Y)(l.sA,{id:"CbRDlp",defaultMessage:"Type"})}),(0,g.Y)(a.T.Text,{withoutMargins:!0,code:!0,children:r})]}),i&&(0,g.FD)(g.FK,{children:[(0,g.Y)(a.T.Text,{withoutMargins:!0,bold:!0,children:(0,g.Y)(l.sA,{id:"SLjN1/",defaultMessage:"Description"})}),(0,g.Y)(a.T.Text,{withoutMargins:!0,children:i})]}),c&&(0,g.FD)(g.FK,{children:[(0,g.Y)(a.T.Text,{withoutMargins:!0,bold:!0,children:(0,g.Y)(l.sA,{id:"/WK1x1",defaultMessage:"Enum Values"})}),(0,g.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:o.spacing.sm,flexWrap:"wrap"},""),children:c.map((e=>(0,g.Y)(a.T.Text,{withoutMargins:!0,code:!0,children:e},e)))})]})]})]})}function Se({tool:e}){var t,n,r;const{theme:l}=(0,a.u)(),[c,d]=(0,o.useState)(!1),u=e.function.description,p=null===(t=e.function.parameters)||void 0===t?void 0:t.properties,m=null!==(n=null===(r=e.function.parameters)||void 0===r?void 0:r.required)&&void 0!==n?n:[],h=u||p,f=h?{":hover":{backgroundColor:l.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:l.borders.borderRadiusMd,border:`1px solid ${l.colors.border}`,backgroundColor:l.colors.backgroundPrimary},""),"data-testid":"model-trace-explorer-chat-tool",children:[(0,g.FD)("div",{role:"button",css:(0,s.AH)({display:"flex",flexDirection:"row",gap:l.spacing.sm,alignItems:"center",borderBottom:h&&c?`1px solid ${l.colors.border}`:"none",padding:l.spacing.sm,...f},""),onClick:()=>d(!c),"data-testid":"model-trace-explorer-chat-tool-toggle",children:[h&&(c?(0,g.Y)(i.ChevronDownIcon,{}):(0,g.Y)(a.q,{})),(0,g.Y)(a.T.Text,{bold:!0,withoutMargins:!0,style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:e.function.name})]}),h&&c&&(0,g.FD)("div",{css:(0,s.AH)({padding:l.spacing.sm},""),children:[u&&(0,g.Y)(a.T.Paragraph,{style:{whiteSpace:"pre-wrap",marginBottom:l.spacing.sm,padding:`0px ${l.spacing.xs}px`},children:e.function.description}),p&&(0,g.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:l.spacing.sm},""),children:Object.keys(p).map((e=>(0,g.Y)(Ye,{paramName:e,paramProperties:p[e],isRequired:m.includes(e)},e)))})]})]})}var Ae=n(48443),we=n(86494);const Te=e=>{switch(e){case"system":return(0,g.Y)(we.P,{type:z.Dy.SYSTEM});case"user":return(0,g.Y)(we.P,{type:z.Dy.USER});case"tool":case"function":return(0,g.Y)(we.P,{type:z.Dy.WRENCH});default:return(0,g.Y)(we.P,{type:z.Dy.MODELS})}},Me=e=>{switch(e.role){case"system":return(0,g.Y)(l.sA,{id:"+gqcru",defaultMessage:"System"});case"user":return(0,g.Y)(l.sA,{id:"t+aG6y",defaultMessage:"User"});case"assistant":return(0,g.Y)(l.sA,{id:"Hvznjh",defaultMessage:"Assistant"});case"tool":return e.name?e.name:(0,g.Y)(l.sA,{id:"dPn3az",defaultMessage:"Tool"});case"function":return(0,g.Y)(l.sA,{id:"5ZUAC2",defaultMessage:"Function"});default:return e.role}};var ke={name:"7dymr5",styles:"white-space:nowrap;display:inline-flex;align-items:center;flex:1;min-width:0"},De={name:"12wal98",styles:"text-overflow:ellipsis;overflow:hidden;white-space:nowrap"};const Ie=({isExpandable:e,expanded:t,setExpanded:n,message:o})=>{const{theme:r}=(0,a.u)(),c=e?{":hover":{backgroundColor:r.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,g.FD)("div",{role:"button",css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:r.spacing.sm,gap:r.spacing.sm,...c},""),onClick:()=>n(!t),children:[e&&(t?(0,g.Y)(i.ChevronDownIcon,{}):(0,g.Y)(a.q,{})),Te(o.role),o.tool_call_id?(0,g.Y)(a.T.Text,{color:"secondary",css:ke,children:(0,g.Y)(l.sA,{id:"mWl3Qv",defaultMessage:"{toolName} was called in {toolCallId}",values:{toolName:(0,g.Y)(a.T.Text,{css:(0,s.AH)({marginRight:r.spacing.xs},""),bold:!0,children:Me(o)}),toolCallId:(0,g.Y)(Ae.T,{componentId:"test",content:o.tool_call_id,children:(0,g.Y)("div",{css:(0,s.AH)({display:"inline-flex",flexShrink:1,overflow:"hidden",marginLeft:r.spacing.xs},""),children:(0,g.Y)(a.T.Text,{css:De,code:!0,children:o.tool_call_id})})})}})}):(0,g.Y)(a.T.Text,{bold:!0,children:Me(o)})]})};var Ce={name:"12wal98",styles:"text-overflow:ellipsis;overflow:hidden;white-space:nowrap"};function Fe({toolCall:e}){const{theme:t}=(0,a.u)();return(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:[(0,g.Y)(a.T.Text,{color:"secondary",css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:`0px ${t.spacing.sm+t.spacing.xs}px`},""),children:(0,g.Y)(l.sA,{id:"hV4vVj",defaultMessage:"called {functionName} in {toolCallId}",values:{functionName:(0,g.FD)(i.Tag,{color:"purple",componentId:"shared.model-trace-explorer.function-name-tag",css:(0,s.AH)({margin:`0px ${t.spacing.xs}px`},""),children:[(0,g.Y)(i.FunctionIcon,{}),(0,g.Y)(a.T.Text,{css:(0,s.AH)({whiteSpace:"nowrap",marginLeft:t.spacing.xs},""),children:e.function.name})]}),toolCallId:(0,g.Y)(Ae.T,{componentId:"test",content:e.id,children:(0,g.Y)("div",{css:(0,s.AH)({display:"inline-flex",flexShrink:1,overflow:"hidden",marginLeft:t.spacing.xs},""),children:(0,g.Y)(a.T.Text,{css:Ce,code:!0,color:"secondary",children:e.id})})})}})}),(0,g.Y)(ue,{data:e.function.arguments})]},e.id)}function He({content:e,shouldDisplayCodeSnippet:t}){const{theme:n}=(0,a.u)();return e?t?(0,g.Y)(ue,{data:e,searchFilter:"",activeMatch:null,containsActiveMatch:!1,renderMode:z.cC.JSON}):(0,g.Y)("div",{css:(0,s.AH)({padding:n.spacing.sm,paddingTop:0,marginBottom:-n.typography.fontSizeBase},""),children:(0,g.Y)(ee,{children:e})}):null}function Ne({message:e,className:t}){var n;const{theme:r}=(0,a.u)(),[c,u]=(0,o.useState)(!1),{content:p,isJson:m}=(e=>{try{return{content:JSON.stringify(JSON.parse(e),null,2),isJson:!0}}catch(t){return{content:e,isJson:!1}}})(null!==(n=e.content)&&void 0!==n?n:""),h=m&&("tool"===e.role||"function"===e.role),f=!h&&p.length>300,v=f&&!c?`${p.slice(0,300)}...`:p;return(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:r.borders.borderRadiusSm,border:`1px solid ${r.colors.border}`,backgroundColor:r.colors.backgroundPrimary,overflow:"hidden"},""),className:t,children:[(0,g.Y)(Ie,{isExpandable:f,expanded:c,setExpanded:u,message:e}),(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:r.spacing.sm},""),children:[!(0,d.isNil)(e.tool_calls)&&e.tool_calls.map((e=>(0,g.Y)(Fe,{toolCall:e},e.id))),(0,g.Y)(He,{content:v,shouldDisplayCodeSnippet:h})]}),f&&(0,g.Y)(a.B,{componentId:c?"shared.model-trace-explorer.chat-message-see-less":"shared.model-trace-explorer.chat-message-see-more",icon:c?(0,g.Y)(i.ChevronUpIcon,{}):(0,g.Y)(i.ChevronDownIcon,{}),type:"tertiary",onClick:()=>u(!c),css:(0,s.AH)({display:"flex",width:"100%",padding:r.spacing.md,borderRadius:"0px !important"},""),children:c?(0,g.Y)(l.sA,{id:"gTEFCD",defaultMessage:"See less"}):(0,g.Y)(l.sA,{id:"6fP+8o",defaultMessage:"See more"})})]})}function Re({messages:e}){const{theme:t}=(0,a.u)();return(0,d.isNil)(e)?null:(0,g.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:e.map(((e,t)=>(0,g.Y)(Ne,{message:e},t)))})}var _e={name:"1d3w5wq",styles:"width:100%"};const Ee=({sectionKey:e,title:t,children:n,withBorder:r=!1,className:l})=>{const[c,d]=(0,o.useState)(!0),{theme:u}=(0,a.u)();return(0,g.FD)("div",{className:l,css:(0,s.AH)({display:"flex",flexDirection:"column",borderRadius:u.borders.borderRadiusMd},""),children:[(0,g.FD)("div",{css:(0,s.AH)({alignItems:"center",display:"flex",flexDirection:"row",gap:u.spacing.xs,padding:r?u.spacing.sm:0,background:r?u.colors.backgroundSecondary:void 0,borderTopLeftRadius:u.borders.borderRadiusMd,borderTopRightRadius:u.borders.borderRadiusMd,borderBottomLeftRadius:c?0:u.borders.borderRadiusMd,borderBottomRightRadius:c?0:u.borders.borderRadiusMd,border:r?`1px solid ${u.colors.border}`:void 0,marginBottom:r?0:u.spacing.sm},""),children:[(0,g.Y)(a.B,{size:"small",componentId:`shared.model-trace-explorer.expand-${e}`,type:"tertiary",icon:c?(0,g.Y)(i.ChevronDownIcon,{}):(0,g.Y)(a.q,{}),onClick:()=>d(!c)}),(0,g.Y)(a.T.Title,{withoutMargins:!0,level:4,css:_e,children:t})]}),c&&(0,g.Y)("div",{css:(0,s.AH)({border:r?`1px solid ${u.colors.border}`:void 0,borderTop:"none",borderBottomLeftRadius:r?u.borders.borderRadiusMd:void 0,borderBottomRightRadius:r?u.borders.borderRadiusMd:void 0,padding:r?u.spacing.sm:0},""),children:n})]})};function ze({chatMessages:e,chatTools:t}){const{theme:n}=(0,a.u)();return(0,g.FD)("div",{css:(0,s.AH)({overflowY:"auto",padding:n.spacing.md},""),"data-testid":"model-trace-explorer-chat-tab",children:[t&&(0,g.Y)(Ee,{css:(0,s.AH)({marginBottom:n.spacing.sm},""),title:(0,g.Y)(l.sA,{id:"Cjq57+",defaultMessage:"Tools"}),sectionKey:"messages",children:(0,g.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:t.map((e=>(0,g.Y)(Se,{tool:e},e.function.name)))})}),(0,g.Y)(Ee,{title:(0,g.Y)(l.sA,{id:"AAdQxU",defaultMessage:"Messages"}),sectionKey:"messages",children:(0,g.Y)(Re,{messages:e})})]})}var Be={name:"1s4awny",styles:"display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%"},Oe={name:"uqztsn",styles:"display:flex;flex-direction:row;justify-content:space-between;width:100%"};function je({activeSpan:e,className:t,searchFilter:n,activeMatch:r}){const{theme:i}=(0,a.u)(),u=(0,o.useMemo)((()=>(0,c.g_)(null===e||void 0===e?void 0:e.inputs)),[e]),p=(0,o.useMemo)((()=>(0,c.g_)(null===e||void 0===e?void 0:e.outputs)),[e]);if((0,d.isNil)(e))return null;const m=u.length>0,h=p.length>0,f=!(0,d.isNil)(r)&&r.span.key===e.key;return(0,g.FD)("div",{"data-testid":"model-trace-explorer-default-span-view",children:[m&&(0,g.Y)(Ee,{withBorder:!0,css:(0,s.AH)({marginBottom:i.spacing.sm},""),sectionKey:"input",title:(0,g.Y)("div",{css:Be,children:(0,g.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"})}),children:(0,g.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:i.spacing.sm},""),children:u.map((({key:e,value:t},s)=>(0,g.Y)(ye,{title:e,data:t,searchFilter:n,activeMatch:r,containsActiveMatch:f&&"inputs"===r.section&&r.key===e},e||s)))})}),h&&(0,g.Y)(Ee,{withBorder:!0,sectionKey:"output",title:(0,g.Y)("div",{css:Oe,children:(0,g.Y)(l.sA,{id:"ZstVNI",defaultMessage:"Outputs"})}),children:(0,g.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:i.spacing.sm},""),children:p.map((({key:e,value:t})=>(0,g.Y)(ye,{title:e,data:t,searchFilter:n,activeMatch:r,containsActiveMatch:f&&"outputs"===r.section&&r.key===e},e)))})})]})}const Le=e=>e?{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}:{whiteSpace:"nowrap"},Ke=({itemKey:e,itemValue:t,charLimit:n=18,maxWidth:o=150,className:r})=>{const{shouldTruncateKey:l,shouldTruncateValue:c}=function(e,t,n){const s=e.length+t.length,o=e.length>t.length,r=o?t.length:e.length;return s<=n?{shouldTruncateKey:!1,shouldTruncateValue:!1}:r>n/2?{shouldTruncateKey:!0,shouldTruncateValue:!0}:{shouldTruncateKey:o,shouldTruncateValue:!o}}(e,t,n);return(0,g.Y)(Ae.T,{componentId:"shared.model-trace-explorer.key-value-tag.hover-tooltip",content:`${e}: ${t}`,children:(0,g.Y)(i.Tag,{componentId:"shared.model-trace-explorer.key-value-tag",className:r,children:(0,g.FD)("span",{css:(0,s.AH)({maxWidth:o,display:"inline-flex"},""),children:[(0,g.Y)(a.T.Text,{bold:!0,css:Le(l),size:"sm",children:e}),":\xa0",(0,g.Y)(a.T.Text,{css:Le(c),size:"sm",children:t})]})})})};var $e={name:"1fttcpj",styles:"display:flex;flex-direction:column"};function Ve({text:e,metadataTags:t,setExpanded:n,logDocumentClick:o}){const{theme:r}=(0,a.u)();return(0,g.FD)("div",{css:$e,children:[(0,g.Y)("div",{role:"button",onClick:()=>{n(!1),null===o||void 0===o||o("collapse")},css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",cursor:"pointer",padding:`${r.spacing.sm}px ${r.spacing.md}px`,height:r.typography.lineHeightBase,boxSizing:"content-box","&:hover":{backgroundColor:r.colors.backgroundSecondary}},""),children:(0,g.Y)(i.FileDocumentIcon,{})}),(0,g.Y)("div",{css:(0,s.AH)({padding:r.spacing.md,paddingBottom:0},""),children:(0,g.Y)(ee,{children:e})}),(0,g.Y)("div",{css:(0,s.AH)({padding:r.spacing.md,paddingTop:0},""),children:t.map((({key:e,value:t})=>(0,g.Y)(Ke,{itemKey:e,itemValue:t},e)))}),(0,g.Y)(a.B,{css:(0,s.AH)({width:"100%",padding:r.spacing.sm},""),componentId:"shared.model-trace-explorer.retriever-document-collapse",icon:(0,g.Y)(i.ChevronUpIcon,{}),type:"tertiary",onClick:()=>n(!1),children:(0,g.Y)(l.sA,{id:"AgjhWE",defaultMessage:"See less"})})]})}var Pe={name:"ti75j2",styles:"margin:0"},We={name:"1r5gb7q",styles:"display:inline-block"},Ue={name:"1tma7dt",styles:"white-space:nowrap;margin:0"};function Je({text:e,metadataTags:t,setExpanded:n,logDocumentClick:o}){const{theme:r}=(0,a.u)();return(0,g.FD)("div",{role:"button",onClick:()=>{n(!0),null===o||void 0===o||o("expand")},css:(0,s.AH)({display:"flex",flexDirection:"row",padding:`${r.spacing.sm}px ${r.spacing.md}px`,gap:r.spacing.sm,alignItems:"center",justifyContent:"space-between",cursor:"pointer","&:hover":{backgroundColor:r.colors.backgroundSecondary}},""),children:[(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:r.spacing.sm,alignItems:"center",minWidth:0,flexShrink:1},""),children:[(0,g.Y)(i.FileDocumentIcon,{}),(0,g.Y)(a.T.Text,{ellipsis:!0,size:"md",children:e})]}),(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:r.spacing.sm},""),children:[t.length>0?(0,g.Y)(Ke,{css:Pe,itemKey:t[0].key,itemValue:t[0].value}):null,t.length>1?(0,g.Y)(Ae.T,{componentId:"shared.model-trace-explorer.tag-count.hover-tooltip",content:t.slice(1).map((({key:e,value:t})=>(0,g.Y)("span",{css:We,children:`${e}: ${t}`},e))),children:(0,g.FD)(i.Tag,{componentId:"shared.model-trace-explorer.tag-count",css:Ue,children:["+",t.length-1]})}):null]})]})}function qe({text:e,metadata:t}){const[n,s]=(0,o.useState)(!1),r=(0,c.g_)(t);return n?(0,g.Y)(Ve,{text:e,metadataTags:r,setExpanded:s}):(0,g.Y)(Je,{text:e,metadataTags:r,setExpanded:s})}var Ge={name:"s5xdrg",styles:"display:flex;align-items:center"},Ze={name:"s5xdrg",styles:"display:flex;align-items:center"};function Xe({shouldRenderMarkdown:e,setShouldRenderMarkdown:t}){const{theme:n}=(0,a.u)();return(0,g.FD)(i.SegmentedControlGroup,{"data-testid":"model-trace-explorer-render-mode-toggle",name:"render-mode",size:"small",componentId:`shared.model-trace-explorer.toggle-markdown-rendering-${!e}`,value:e,onChange:e=>{t(e.target.value)},children:[(0,g.Y)(i.SegmentedControlButton,{"data-testid":"model-trace-explorer-render-raw-input-button",value:!1,children:(0,g.Y)(Ae.T,{componentId:"shared.model-trace-explorer.raw-input-rendering-tooltip",content:(0,g.Y)(l.sA,{id:"NMxAot",defaultMessage:"Raw input"}),children:(0,g.Y)("div",{css:Ge,children:(0,g.Y)(i.TextBoxIcon,{css:(0,s.AH)({fontSize:n.typography.fontSizeLg},"")})})})}),(0,g.Y)(i.SegmentedControlButton,{"data-testid":"model-trace-explorer-render-default-button",value:!0,children:(0,g.Y)(Ae.T,{componentId:"shared.model-trace-explorer.default-rendering-tooltip",content:(0,g.Y)(l.sA,{id:"xwe7WH",defaultMessage:"Default rendering"}),children:(0,g.Y)("div",{css:Ze,children:(0,g.Y)(i.MIcon,{css:(0,s.AH)({fontSize:n.typography.fontSizeLg},"")})})})})]})}var Qe={name:"1s4awny",styles:"display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%"};function et({activeSpan:e,className:t,searchFilter:n,activeMatch:r}){const{theme:u}=(0,a.u)(),[p,m]=(0,o.useState)(!0),h=(0,o.useMemo)((()=>(0,c.g_)(e.inputs)),[e]),f=e.outputs,v=h.length>0,x=!(0,d.isNil)(r)&&r.span.key===e.key,y=x&&"outputs"===r.section;return(0,g.FD)("div",{className:t,"data-testid":"model-trace-explorer-retriever-span-view",children:[v&&(0,g.Y)(Ee,{sectionKey:"input",css:(0,s.AH)({marginBottom:u.spacing.sm},""),title:(0,g.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),children:(0,g.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm},""),children:h.map((({key:e,value:t},s)=>(0,g.Y)(ye,{title:e,data:t,searchFilter:n,activeMatch:r,containsActiveMatch:x&&"inputs"===r.section&&r.key===e},e||s)))})}),(0,g.Y)(Ee,{sectionKey:"output",title:(0,g.FD)("div",{css:Qe,children:[(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:u.spacing.sm},""),children:[(0,g.Y)(l.sA,{id:"ThYYz6",defaultMessage:"Documents"}),(0,g.Y)(i.Tag,{componentId:"shared.model-trace-explorer.document-count",children:f.length})]}),!y&&(0,g.Y)(Xe,{shouldRenderMarkdown:p,setShouldRenderMarkdown:m})]}),children:p&&!y?(0,g.Y)("div",{css:(0,s.AH)({border:`1px solid ${u.colors.border}`,borderRadius:u.legacyBorders.borderRadiusMd},""),children:f.map(((e,t)=>(0,g.Y)("div",{css:(0,s.AH)({borderBottom:t!==f.length-1?`1px solid ${u.colors.border}`:""},""),children:(0,g.Y)(qe,{text:e.page_content,metadata:e.metadata},t)},t)))}):(0,g.Y)("div",{css:(0,s.AH)({border:`1px solid ${u.colors.border}`,borderRadius:u.legacyBorders.borderRadiusMd,padding:u.spacing.md},""),children:(0,g.Y)(ye,{title:"",data:JSON.stringify(f,null,2),searchFilter:n,activeMatch:r,containsActiveMatch:x&&"outputs"===r.section})})})]})}function tt({activeSpan:e,className:t,searchFilter:n,activeMatch:o}){const{theme:r}=(0,a.u)();return!(0,d.isNil)(e)&&(0,c.vl)(e)?(0,g.Y)("div",{css:(0,s.AH)({overflowY:"auto",padding:r.spacing.md},""),className:t,"data-testid":"model-trace-explorer-content-tab",children:(0,g.Y)(et,{activeSpan:e,className:t,searchFilter:n,activeMatch:o})}):(0,g.Y)("div",{css:(0,s.AH)({overflowY:"auto",padding:r.spacing.md},""),className:t,"data-testid":"model-trace-explorer-content-tab",children:(0,g.Y)(je,{activeSpan:e,className:t,searchFilter:n,activeMatch:o})})}function nt({activeSpan:e,searchFilter:t,activeMatch:n}){const{theme:o}=(0,a.u)(),{events:r}=e,u=!(0,d.isNil)(n)&&n.span.key===e.key;return Array.isArray(r)&&0!==r.length?(0,g.Y)("div",{css:(0,s.AH)({padding:o.spacing.md},""),children:r.map(((e,r)=>{const l=e.attributes,d="exception"===e.name?(0,g.FD)(g.FK,{children:[(0,g.Y)(i.XCircleIcon,{css:(0,s.AH)({marginRight:o.spacing.sm},""),color:"danger"}),(0,g.Y)(a.T.Text,{color:"error",bold:!0,children:"Exception"})]}):e.name;return l?(0,g.Y)(Ee,{sectionKey:e.name,title:d,withBorder:!0,children:(0,g.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:o.spacing.sm},""),children:Object.keys(l).map((s=>{const o=(0,c.Q0)(e.name,r,s);return(0,g.Y)(ye,{title:s,data:JSON.stringify(l[s],null,2),searchFilter:t,activeMatch:n,containsActiveMatch:u&&"events"===n.section&&n.key===o,initialRenderMode:z.cC.TEXT},o)}))})},`${e.name}-${r}`):null}))}):(0,g.Y)("div",{css:(0,s.AH)({marginTop:o.spacing.md},""),children:(0,g.Y)(i.Empty,{description:(0,g.Y)(l.sA,{id:"xnr5KT",defaultMessage:"No events found"})})})}function st({count:e}){const{theme:t}=(0,a.u)();return(0,g.Y)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",justifyContent:"center",borderRadius:t.typography.fontSizeBase,height:t.typography.fontSizeBase,backgroundColor:t.colors.actionDangerPrimaryBackgroundDefault,padding:t.spacing.xs,marginLeft:t.spacing.xs,boxSizing:"border-box"},""),children:(0,g.Y)("span",{css:(0,s.AH)({color:t.colors.actionPrimaryTextDefault,fontSize:11},""),children:e})})}var ot={name:"4zleql",styles:"display:block"},rt={name:"oit39a",styles:"& > span{display:flex;align-items:center;}"};const at=()=>{const{assessmentsPaneExpanded:e,setAssessmentsPaneExpanded:t,assessmentsPaneEnabled:n}=N();return(0,g.Y)(i.SegmentedControlGroup,{css:ot,name:"shared.model-trace-explorer.assessments-pane-toggle",componentId:"shared.model-trace-explorer.assessments-pane-toggle",value:e,size:"small",children:(0,g.Y)(i.SegmentedControlButton,{value:!0,disabled:!n,icon:(0,g.Y)(i.GavelIcon,{}),onClick:()=>null===t||void 0===t?void 0:t(!e),css:rt,children:!e&&(0,g.Y)(l.sA,{id:"r/fxMt",defaultMessage:"Assessments"})})})};var it=n(26955),lt=n(80001);const ct=({name:e,setName:t,nameError:n,setNameError:s,handleChangeSchema:r})=>{const{schemas:a}=(0,lt.a)(),c=(0,l.tz)(),d=a.map((e=>{var t;return null!==(t=e.name)&&void 0!==t?t:""})),[u,p]=(0,o.useState)(null),[m,h]=(0,o.useState)(a),f=(0,o.useMemo)((()=>{const t=[...m];if(e&&!d.includes(e)){const n=(e=>({name:e,assessmentType:"feedback",dataType:"boolean"}))(e);t.unshift(n)}return t}),[e,m,d]),v=(0,o.useCallback)((e=>{p(e),r(e),s(null)}),[r,s]),x=(0,i.useComboboxState)({componentId:"shared.model-trace-explorer.assessment-name-typeahead",allItems:a,items:f,setItems:h,multiSelect:!1,setInputValue:e=>{t(e),s(null)},itemToString:e=>{var t;return null!==(t=null===e||void 0===e?void 0:e.name)&&void 0!==t?t:""},matcher:(e,t)=>{var n,s;return null!==(n=null===e||void 0===e||null===(s=e.name)||void 0===s?void 0:s.toLowerCase().includes(t.toLowerCase()))&&void 0!==n&&n},formValue:u,formOnChange:v,preventUnsetOnBlur:!0});return(0,g.FD)(i.TypeaheadComboboxRoot,{onKeyDown:e=>{"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||e.stopPropagation()},id:"shared.model-trace-explorer.assessment-name-typeahead",comboboxState:x,children:[(0,g.Y)(i.TypeaheadComboboxInput,{"data-testid":"assessment-name-typeahead-input",placeholder:c.formatMessage({id:"gN67TK",defaultMessage:"Enter an assessment name"}),validationState:n?"error":void 0,comboboxState:x,formOnChange:v,onPressEnter:()=>{f.length>0&&v(f[0])},allowClear:!0,showComboboxToggleButton:!0}),n&&(0,g.Y)(i.FormUI.Message,{type:"error",message:n}),(0,g.Y)(i.TypeaheadComboboxMenu,{comboboxState:x,children:f.map(((e,t)=>{var n,s,o;return(0,g.Y)(i.TypeaheadComboboxMenuItem,{"data-testid":`assessment-name-typeahead-item-${null!==(n=null===e||void 0===e?void 0:e.name)&&void 0!==n?n:""}`,item:e,index:t,comboboxState:x,children:null!==(o=null===e||void 0===e?void 0:e.name)&&void 0!==o?o:""},`assessment-name-typeahead-${null!==(s=null===e||void 0===e?void 0:e.name)&&void 0!==s?s:""}`)}))})]})},dt=250,ut=(e,t=new Date)=>{const n=Math.max(0,Math.floor((t.getTime()-e)/1e3));let s=Math.floor(n/31536e3);return s>=1?(0,g.Y)(l.sA,{id:"16BvfJ",defaultMessage:"{timeSince, plural, =1 {1 year} other {# years}} ago",values:{timeSince:s}}):(s=Math.floor(n/2592e3),s>=1?(0,g.Y)(l.sA,{id:"5ZAXeS",defaultMessage:"{timeSince, plural, =1 {1 month} other {# months}} ago",values:{timeSince:s}}):(s=Math.floor(n/86400),s>=1?(0,g.Y)(l.sA,{id:"tLb7+M",defaultMessage:"{timeSince, plural, =1 {1 day} other {# days}} ago",values:{timeSince:s}}):(s=Math.floor(n/3600),s>=1?(0,g.Y)(l.sA,{id:"aOW396",defaultMessage:"{timeSince, plural, =1 {1 hour} other {# hours}} ago",values:{timeSince:s}}):(s=Math.floor(n/60),s>=1?(0,g.Y)(l.sA,{id:"7jsqqe",defaultMessage:"{timeSince, plural, =1 {1 minute} other {# minutes}} ago",values:{timeSince:s}}):(0,g.Y)(l.sA,{id:"93iLUV",defaultMessage:"{timeSince, plural, =1 {1 second} other {# seconds}} ago",values:{timeSince:n}})))))},pt=({formValue:e,dataType:t,isFeedback:n})=>n?{feedback:{value:e}}:"json"===t?{expectation:{serialized_value:{value:String(e),serialization_format:"JSON_FORMAT"}}}:{expectation:{value:e}};var mt={name:"t152af",styles:"margin-top:8px;color:red"};var gt={name:"t152af",styles:"margin-top:8px;color:red"};var ht={name:"t152af",styles:"margin-top:8px;color:red"};var ft=n(27288),vt=n(77020),xt=n(39416);const yt=fetch;function bt(e){if(void 0!==e)return"string"===typeof e||e instanceof FormData||e instanceof Blob?e:JSON.stringify(e)}const Yt=async(e,t="GET",n)=>{const s=await yt(e,{method:t,body:bt(n),headers:n?{"Content-Type":"application/json"}:{}});if(!s.ok){const e=(0,xt.a$)(s);if(e){try{const t=(await s.json()).message;e.message=null!==t&&void 0!==t?t:e.message}catch{}throw e}}return s.json()},St=({payload:e})=>Yt(`/ajax-api/3.0/mlflow/traces/${e.assessment.trace_id}/assessments`,"POST",e),At={json:({value:e,valueError:t,setValue:n,setValueError:s,isSubmitting:o})=>(0,g.FD)("div",{children:[(0,g.Y)(b.I.TextArea,{"data-testid":"assessment-value-json-input",componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(e),autoSize:{minRows:1,maxRows:5},onKeyDown:e=>e.stopPropagation(),onChange:e=>{n(e.target.value),s(null)},validationState:t?"error":void 0,disabled:o}),t&&(0,g.Y)(i.FormUI.Message,{id:"shared.model-trace-explorer.assessment-edit-value-json-error",message:t,type:"error"})]}),string:({value:e,valueError:t,setValue:n,setValueError:s,isSubmitting:o})=>(0,g.FD)("div",{children:[(0,g.Y)(b.I,{"data-testid":"assessment-value-string-input",componentId:"shared.model-trace-explorer.assessment-value-string-input",value:String(e),onKeyDown:e=>e.stopPropagation(),onChange:e=>{n(e.target.value),s(null)},disabled:o,allowClear:!0}),t&&(0,g.Y)("div",{css:ht,children:t})]}),boolean:({value:e,valueError:t,setValue:n,setValueError:s,isSubmitting:o})=>(0,g.FD)("div",{children:[(0,g.FD)(i.SegmentedControlGroup,{"data-testid":"assessment-value-boolean-input",componentId:"shared.model-trace-explorer.assessment-value-boolean-input",name:"shared.model-trace-explorer.assessment-value-boolean-input",value:e,disabled:o,onChange:e=>{n(e.target.value),s(null)},children:[(0,g.Y)(i.SegmentedControlButton,{value:!0,children:"True"}),(0,g.Y)(i.SegmentedControlButton,{value:!1,children:"False"})]}),t&&(0,g.Y)("div",{css:mt,children:t})]}),number:({value:e,valueError:t,setValue:n,setValueError:s,isSubmitting:o})=>(0,g.FD)("div",{children:[(0,g.Y)(b.I,{"data-testid":"assessment-value-number-input",componentId:"shared.model-trace-explorer.assessment-value-number-input",value:String(e),onKeyDown:e=>e.stopPropagation(),onChange:e=>{n(e.target.value?Number(e.target.value):""),s(null)},type:"number",disabled:o,allowClear:!0}),t&&(0,g.Y)("div",{css:gt,children:t})]})},wt=(0,o.forwardRef)((({assessmentName:e,spanId:t,traceId:n,setExpanded:r},u)=>{var p;const{theme:m}=(0,a.u)(),[h,f]=(0,o.useState)(""),[v,x]=(0,o.useState)("feedback"),[y,Y]=(0,o.useState)("boolean"),[S,A]=(0,o.useState)(!0),[w,T]=(0,o.useState)(""),[M,k]=(0,o.useState)(null),[D,I]=(0,o.useState)(null),C=!(0,d.isNil)(e),F=null!==(p=At[y])&&void 0!==p?p:At.string,{createAssessmentMutation:H,isLoading:N}=(({traceId:e,onSuccess:t,onError:n,onSettled:s})=>{const o=(0,l.tz)(),r=(0,ft.jE)(),{mutate:a,isLoading:i}=(0,vt.n)({mutationFn:e=>St({payload:e}),onSuccess:()=>{r.invalidateQueries({queryKey:[c.BS,e]}),null===t||void 0===t||t()},onError:e=>{(0,c.ij)(o.formatMessage({id:"L3szkg",defaultMessage:"Failed to create assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===n||void 0===n||n(e)},onSettled:()=>{null===s||void 0===s||s()}});return{createAssessmentMutation:a,isLoading:i}})({traceId:n,onSettled:()=>{r(!1)}}),R=(0,o.useCallback)((async()=>{var s;if("json"===y)try{JSON.parse(S)}catch(a){return void I((0,g.Y)(l.sA,{id:"VXduJD",defaultMessage:"The provided value is not valid JSON"}))}if(!C&&""===h)return void k((0,g.Y)(l.sA,{id:"WHf+VX",defaultMessage:"Please enter a name"}));const o=pt({formValue:S,dataType:y,isFeedback:"feedback"===v}),r={assessment:{assessment_name:C?e:h,trace_id:n,source:{source_type:"HUMAN",source_id:null!==(s=(0,it.w)())&&void 0!==s?s:""},span_id:t,rationale:w,...o}};H(r)}),[y,S,v,C,e,h,n,t,w,H]),_=(0,o.useCallback)((e=>{if(!e)return f(""),x("feedback"),Y("boolean"),A(!0),T(""),void I(null);switch(f(e.name),x(e.assessmentType),Y(e.dataType),e.dataType){case"string":case"json":A("");break;case"number":A(0);break;case"boolean":A(!0)}}),[]);return(0,g.FD)("div",{ref:u,css:(0,s.AH)({display:"flex",flexDirection:"column",gap:m.spacing.xs,marginTop:m.spacing.sm,border:`1px solid ${m.colors.border}`,padding:m.spacing.sm,borderRadius:m.borders.borderRadiusSm},""),children:[(0,g.Y)(a.T.Text,{size:"sm",color:"secondary",children:(0,g.Y)(l.sA,{id:"+SBxBK",defaultMessage:"Assessment Type"})}),(0,g.FD)(i.SimpleSelect,{id:"shared.model-trace-explorer.assessment-type-select",componentId:"shared.model-trace-explorer.assessment-type-select",value:v,disabled:N,onChange:e=>{x(e.target.value),"feedback"===e.target.value&&"json"===y&&Y("string")},children:[(0,g.Y)(i.SimpleSelectOption,{value:"feedback",children:(0,g.Y)(l.sA,{id:"0AOcOr",defaultMessage:"Feedback"})}),(0,g.Y)(i.SimpleSelectOption,{value:"expectation",children:(0,g.Y)(l.sA,{id:"tEaqGu",defaultMessage:"Expectation"})})]}),(0,g.Y)(a.T.Text,{css:(0,s.AH)({marginTop:m.spacing.xs},""),size:"sm",color:"secondary",children:(0,g.Y)(l.sA,{id:"AdlJNW",defaultMessage:"Assessment Name"})}),C?(0,g.Y)(a.T.Text,{children:e}):(0,g.Y)(ct,{name:h,setName:f,handleChangeSchema:_,nameError:M,setNameError:k}),(0,g.Y)(a.T.Text,{css:(0,s.AH)({marginTop:m.spacing.xs},""),size:"sm",color:"secondary",children:(0,g.Y)(l.sA,{id:"q8rYCQ",defaultMessage:"Data Type"})}),(0,g.FD)(i.SimpleSelect,{id:"shared.model-trace-explorer.assessment-data-type-select",componentId:"shared.model-trace-explorer.assessment-data-type-select",value:y,disabled:N,onChange:e=>{Y(e.target.value),I(null)},children:["expectation"===v&&(0,g.Y)(i.SimpleSelectOption,{value:"json",children:(0,g.Y)(l.sA,{id:"GKVTw4",defaultMessage:"JSON"})}),(0,g.Y)(i.SimpleSelectOption,{value:"string",children:(0,g.Y)(l.sA,{id:"cBSSLp",defaultMessage:"String"})}),(0,g.Y)(i.SimpleSelectOption,{value:"boolean",children:(0,g.Y)(l.sA,{id:"k0l8lF",defaultMessage:"Boolean"})}),(0,g.Y)(i.SimpleSelectOption,{value:"number",children:(0,g.Y)(l.sA,{id:"C9ccNu",defaultMessage:"Number"})})]}),(0,g.Y)(a.T.Text,{css:(0,s.AH)({marginTop:m.spacing.xs},""),size:"sm",color:"secondary",children:(0,g.Y)(l.sA,{id:"ms+6Z2",defaultMessage:"Value"})}),(0,g.Y)(F,{value:S,valueError:D,setValue:A,setValueError:I,isSubmitting:N}),(0,g.Y)(a.T.Text,{css:(0,s.AH)({marginTop:m.spacing.xs},""),size:"sm",color:"secondary",children:(0,g.Y)(l.sA,{id:"wDMTm8",defaultMessage:"Rationale"})}),(0,g.Y)(b.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-rationale-input",value:w,autoSize:{minRows:1,maxRows:5},disabled:N,onKeyDown:e=>e.stopPropagation(),onChange:e=>T(e.target.value)}),(0,g.FD)("div",{css:(0,s.AH)({display:"flex",justifyContent:"flex-end",marginTop:m.spacing.xs},""),children:[(0,g.Y)(a.B,{componentId:"shared.model-trace-explorer.assessment-create-button",disabled:N,onClick:()=>r(!1),children:(0,g.Y)(l.sA,{id:"+33ShX",defaultMessage:"Cancel"})}),(0,g.Y)(a.B,{css:(0,s.AH)({marginLeft:m.spacing.sm},""),type:"primary",componentId:"shared.model-trace-explorer.assessment-create-button",onClick:R,loading:N,children:(0,g.Y)(l.sA,{id:"Me7xpG",defaultMessage:"Create"})})]})]})})),Tt=({title:e,assessmentName:t,spanId:n,traceId:s})=>{const[r,l]=(0,o.useState)(!1),c=(0,o.useRef)(null);return(0,o.useEffect)((()=>{r&&c.current&&c.current.scrollIntoView({behavior:"smooth",block:"start"})}),[r]),(0,g.FD)("div",{children:[(0,g.Y)(a.B,{size:"small",componentId:"shared.model-trace-explorer.add-new-assessment",icon:(0,g.Y)(i.PlusIcon,{}),onClick:()=>l(!0),children:e}),r&&(0,g.Y)(wt,{ref:c,assessmentName:t,spanId:n,traceId:s,setExpanded:l})]})},Mt=({assessment:e,setIsEditing:t,setShowDeleteModal:n})=>{var s;const o="feedback"in e,r=((null!==(s=(0,it.w)())&&void 0!==s?s:"")===e.source.source_id||o&&"HUMAN"!==e.source.source_type)&&t;return(0,g.FD)(i.DropdownMenu.Root,{children:[(0,g.Y)(i.DropdownMenu.Trigger,{asChild:!0,children:(0,g.Y)(a.B,{componentId:"shared.model-trace-explorer.assessment-more-button",icon:(0,g.Y)(i.OverflowIcon,{}),size:"small"})}),(0,g.FD)(i.DropdownMenu.Content,{minWidth:100,children:[r&&(0,g.FD)(i.DropdownMenu.Item,{componentId:"shared.model-trace-explorer.assessment-edit-button",onClick:()=>null===t||void 0===t?void 0:t(!0),children:[(0,g.Y)(i.DropdownMenu.IconWrapper,{children:(0,g.Y)(i.PencilIcon,{})}),(0,g.Y)(l.sA,{id:"UQhorr",defaultMessage:"Edit"})]}),(0,g.FD)(i.DropdownMenu.Item,{componentId:"shared.model-trace-explorer.assessment-delete-button",onClick:()=>n(!0),children:[(0,g.Y)(i.DropdownMenu.IconWrapper,{children:(0,g.Y)(i.TrashIcon,{})}),(0,g.Y)(l.sA,{id:"aZV8M7",defaultMessage:"Delete"})]})]})]})},kt=({assessment:e,isModalVisible:t,setIsModalVisible:n})=>{const s=(0,l.tz)(),r=(0,ft.jE)(),{mutate:a,isLoading:i}=(0,vt.n)({mutationFn:()=>(({traceId:e,assessmentId:t})=>Yt(`/ajax-api/3.0/mlflow/traces/${e}/assessments/${t}`,"DELETE"))({traceId:e.trace_id,assessmentId:e.assessment_id}),onSuccess:()=>{r.invalidateQueries({queryKey:[c.BS,e.trace_id]})},onError:e=>{(0,c.ij)(s.formatMessage({id:"iRNZkJ",defaultMessage:"Failed to delete assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)}))},onSettled:()=>{n(!1)}}),d=(0,o.useCallback)((()=>{a()}),[a]);return(0,g.Y)(Ae.d,{componentId:"shared.model-trace-explorer.assessment-delete-modal",visible:t,onOk:d,okButtonProps:{danger:!0,loading:i},okText:(0,g.Y)(l.sA,{id:"vlUEAo",defaultMessage:"Delete"}),onCancel:()=>{n(!1)},cancelText:(0,g.Y)(l.sA,{id:"gFYM0j",defaultMessage:"Cancel"}),confirmLoading:i,title:(0,g.Y)(l.sA,{id:"mqqEUj",defaultMessage:"Delete assessment"}),children:(0,g.Y)(l.sA,{id:"puATD8",defaultMessage:"Are you sure you want to delete this assessment?"})})};var Dt=n(1644);const It=({assessment:e,onSuccess:t,onError:n,onSettled:s})=>{const o=(0,l.tz)(),r=(0,ft.jE)(),{mutate:a,isLoading:i}=(0,vt.n)({mutationFn:t=>(({traceId:e,assessmentId:t,payload:n})=>Yt(`/ajax-api/3.0/mlflow/traces/${e}/assessments/${t}`,"PATCH",n))({traceId:e.trace_id,assessmentId:e.assessment_id,payload:t}),onError:e=>{(0,c.ij)(o.formatMessage({id:"+hZB4c",defaultMessage:"Failed to update assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===n||void 0===n||n(e)},onSuccess:()=>{r.invalidateQueries({queryKey:[c.BS,e.trace_id]}),null===t||void 0===t||t()},onSettled:()=>{null===s||void 0===s||s()}});return{updateAssessmentMutation:a,isLoading:i}},Ct=({assessment:e,onSuccess:t,onSettled:n,onCancel:r})=>{var u;const p="feedback"in e,m=(0,Dt.e)(e),h=((e,t)=>{if("string"===typeof e){if(""===e)return"boolean";if(t)return"string";try{return JSON.parse(e),"json"}catch(n){return"string"}}return"boolean"===typeof e||"number"===typeof e?typeof e:"boolean"})(m,p),f=(e=>"string"===typeof e?e||null:"boolean"===typeof e||"number"===typeof e?e:null)(m),v=null!==(u=(0,it.w)())&&void 0!==u?u:"",{theme:x}=(0,a.u)(),[y,Y]=(0,o.useState)(h),[S,A]=(0,o.useState)(f),[w,T]=(0,o.useState)(e.rationale),[M,k]=(0,o.useState)(null),{updateAssessmentMutation:D,isLoading:I}=It({assessment:e,onSuccess:t,onSettled:n}),{overrideAssessmentMutation:C,isLoading:F}=(({traceId:e,onSuccess:t,onError:n,onSettled:s})=>{const o=(0,l.tz)(),r=(0,ft.jE)(),{mutate:a,isLoading:i}=(0,vt.n)({mutationFn:({oldAssessment:e,value:t,rationale:n})=>{var s;const o={...e,...t,rationale:n,source:{source_id:null!==(s=(0,it.w)())&&void 0!==s?s:"",source_type:"HUMAN"},overrides:e.assessment_id},r={assessment:(0,d.omit)(o,"assessment_id","create_time","last_update_time","overriddenAssessments")};return St({payload:r})},onError:e=>{(0,c.ij)(o.formatMessage({id:"X11caV",defaultMessage:"Failed to override assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===n||void 0===n||n(e)},onSuccess:()=>{r.invalidateQueries({queryKey:[c.BS,e]}),null===t||void 0===t||t()},onSettled:()=>{null===s||void 0===s||s()}});return{overrideAssessmentMutation:a,isLoading:i}})({traceId:e.trace_id,onSuccess:t,onSettled:n}),H=I||F,N=(0,o.useCallback)((async()=>{if("json"===y)try{JSON.parse(S)}catch(n){return void k((0,g.Y)(l.sA,{id:"8I9ipd",defaultMessage:"The provided value is not valid JSON"}))}const t=pt({formValue:S,dataType:y,isFeedback:p});if(v!==e.source.source_id&&p)C({oldAssessment:e,value:t,...w?{rationale:w}:{}});else{const e={assessment:{...t,rationale:w},update_mask:(p?"feedback":"expectation")+",rationale"};D(e)}}),[y,S,p,v,e,w,D,C]);return(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:x.spacing.xs,marginTop:x.spacing.sm,border:`1px solid ${x.colors.border}`,padding:x.spacing.sm,borderRadius:x.borders.borderRadiusSm},""),children:[(0,g.Y)(a.T.Text,{css:(0,s.AH)({marginTop:x.spacing.xs},""),size:"sm",color:"secondary",children:(0,g.Y)(l.sA,{id:"b7OpMB",defaultMessage:"Data Type"})}),(0,g.FD)(i.SimpleSelect,{id:"shared.model-trace-explorer.assessment-edit-data-type-select",componentId:"shared.model-trace-explorer.assessment-edit-data-type-select",value:y,disabled:H,onChange:e=>{Y(e.target.value),k(null)},children:[!p&&(0,g.Y)(i.SimpleSelectOption,{value:"json",children:(0,g.Y)(l.sA,{id:"GKVTw4",defaultMessage:"JSON"})}),(0,g.Y)(i.SimpleSelectOption,{value:"string",children:(0,g.Y)(l.sA,{id:"cBSSLp",defaultMessage:"String"})}),(0,g.Y)(i.SimpleSelectOption,{value:"boolean",children:(0,g.Y)(l.sA,{id:"k0l8lF",defaultMessage:"Boolean"})}),(0,g.Y)(i.SimpleSelectOption,{value:"number",children:(0,g.Y)(l.sA,{id:"C9ccNu",defaultMessage:"Number"})})]}),(0,g.Y)(a.T.Text,{css:(0,s.AH)({marginTop:x.spacing.xs},""),size:"sm",color:"secondary",children:(0,g.Y)(l.sA,{id:"e2AObB",defaultMessage:"Value"})}),"json"===y&&(0,g.FD)(g.FK,{children:[(0,g.Y)(b.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(S),rows:3,onKeyDown:e=>e.stopPropagation(),onChange:e=>{A(e.target.value),k(null)},validationState:M?"error":void 0,disabled:H}),M&&(0,g.Y)(i.FormUI.Message,{id:"shared.model-trace-explorer.assessment-edit-value-json-error",message:M,type:"error"})]}),"string"===y&&(0,g.Y)(b.I,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(S),onKeyDown:e=>e.stopPropagation(),onChange:e=>{A(e.target.value),k(null)},disabled:H,allowClear:!0}),"boolean"===y&&(0,g.FD)(i.SegmentedControlGroup,{componentId:"shared.model-trace-explorer.assessment-edit-value-boolean-input",name:"shared.model-trace-explorer.assessment-edit-value-boolean-input",value:S,disabled:H,onChange:e=>{A(e.target.value),k(null)},children:[(0,g.Y)(i.SegmentedControlButton,{value:!0,children:"True"}),(0,g.Y)(i.SegmentedControlButton,{value:!1,children:"False"})]}),"number"===y&&(0,g.Y)(b.I,{componentId:"shared.model-trace-explorer.assessment-edit-value-number-input",value:String(S),onKeyDown:e=>e.stopPropagation(),onChange:e=>{A(e.target.value?Number(e.target.value):""),k(null)},type:"number",disabled:H,allowClear:!0}),(0,g.Y)(a.T.Text,{css:(0,s.AH)({marginTop:x.spacing.xs},""),size:"sm",color:"secondary",children:(0,g.Y)(l.sA,{id:"6BRlPU",defaultMessage:"Rationale"})}),(0,g.Y)(b.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-rationale-input",value:w,autoSize:{minRows:1,maxRows:5},disabled:H,onKeyDown:e=>e.stopPropagation(),onChange:e=>T(e.target.value)}),(0,g.FD)("div",{css:(0,s.AH)({display:"flex",justifyContent:"flex-end",marginTop:x.spacing.xs},""),children:[(0,g.Y)(a.B,{componentId:"shared.model-trace-explorer.assessment-edit-cancel-button",disabled:H,onClick:r,children:(0,g.Y)(l.sA,{id:"mIFcgu",defaultMessage:"Cancel"})}),(0,g.Y)(a.B,{css:(0,s.AH)({marginLeft:x.spacing.sm},""),type:"primary",componentId:"shared.model-trace-explorer.assessment-edit-save-button",onClick:N,loading:H,children:(0,g.Y)(l.sA,{id:"M+iC03",defaultMessage:"Save"})})]})]})};var Ft=n(15100);const Ht=({node:e})=>{var t;const{theme:n}=(0,a.u)(),{setSelectedNode:o,setActiveView:r,setShowTimelineTreeGantt:i}=N(),l=(0,c.N7)(e)>0;return(0,g.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",marginRight:n.spacing.xs,gap:n.spacing.xs,"&:hover":{textDecoration:"underline",textDecorationColor:l?n.colors.actionDangerDefaultTextDefault:n.colors.actionDefaultTextDefault,cursor:"pointer"}},""),onClick:()=>{o(e),r("detail"),i(!1)},children:[(0,g.Y)(we.P,{hasException:l,type:(0,c.tC)(null!==(t=e.type)&&void 0!==t?t:z.UG.UNKNOWN)}),(0,g.Y)(a.T.Text,{color:l?"error":"primary",css:(0,s.AH)({marginLeft:n.spacing.xs,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},""),children:e.title})]})};var Nt={name:"bcffy2",styles:"display:flex;align-items:center;justify-content:space-between"},Rt={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const _t=({expectation:e})=>{const{theme:t}=(0,a.u)(),[n,r]=(0,o.useState)(!1),[i,c]=(0,o.useState)(!1),{nodeMap:d,activeView:u}=N(),p=e.span_id?d[e.span_id]:null,m="summary"===u&&p,h=(e=>{if("value"in e)return e.value;try{return JSON.parse(e.serialized_value.value)}catch(t){return e.serialized_value.value}})(e.expectation);return(0,g.FD)("div",{css:(0,s.AH)({padding:t.spacing.sm+t.spacing.xs,paddingTop:t.spacing.sm,border:`1px solid ${t.colors.border}`,borderRadius:t.borders.borderRadiusMd,display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:[(0,g.FD)("div",{css:Nt,children:[(0,g.Y)(a.T.Text,{bold:!0,css:Rt,children:e.assessment_name}),(0,g.Y)(Mt,{assessment:e,setIsEditing:r,setShowDeleteModal:c}),(0,g.Y)(kt,{assessment:e,isModalVisible:i,setIsModalVisible:c})]}),n?(0,g.Y)(Ct,{assessment:e,onSuccess:()=>r(!1),onCancel:()=>r(!1)}):(0,g.Y)(Ft.S,{parsedValue:h}),m&&(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,g.Y)(a.T.Text,{size:"sm",color:"secondary",children:(0,g.Y)(l.sA,{id:"+hQbnS",defaultMessage:"Span"})}),(0,g.Y)(Ht,{node:p})]})]})};var Et={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"};const zt=({jsonValue:e})=>{const{theme:t}=(0,a.u)();if(!e||'""'===e)return null;let n;try{n=JSON.parse(e)}catch(c){n=e}let o="default",r=JSON.stringify(n,null,2);return"yes"===n?(o="lime",r=(0,g.FD)(g.FK,{children:[(0,g.Y)(i.CheckCircleIcon,{css:(0,s.AH)({marginRight:t.spacing.xs},"")}),(0,g.Y)(l.sA,{id:"MhOmZG",defaultMessage:"Yes"})]})):"no"===n?(o="coral",r=(0,g.FD)(g.FK,{children:[(0,g.Y)(i.XCircleIcon,{css:(0,s.AH)({marginRight:t.spacing.xs},"")}),(0,g.Y)(l.sA,{id:"M8cEQy",defaultMessage:"No"})]})):"string"===typeof n?r=n:null===n?(o="coral",r=(0,g.FD)(g.FK,{children:[(0,g.Y)(a.l,{css:(0,s.AH)({marginRight:t.spacing.xs},"")}),(0,g.Y)(l.sA,{id:"zEXwQL",defaultMessage:"Error"})]})):!0===n?(o="lime",r=(0,g.FD)(g.FK,{children:[(0,g.Y)(i.CheckCircleIcon,{css:(0,s.AH)({marginRight:t.spacing.xs},"")}),(0,g.Y)(l.sA,{id:"hWHLjo",defaultMessage:"True"})]})):!1===n&&(o="coral",r=(0,g.FD)(g.FK,{children:[(0,g.Y)(i.XCircleIcon,{css:(0,s.AH)({marginRight:t.spacing.xs},"")}),(0,g.Y)(l.sA,{id:"4U/RVz",defaultMessage:"False"})]})),(0,g.Y)(Ae.T,{componentId:"shared.model-trace-explorer.assesment-value-tooltip",content:r,children:(0,g.Y)(i.Tag,{css:(0,s.AH)({display:"inline-flex",maxWidth:"100%",minWidth:t.spacing.md,marginRight:0},""),componentId:"shared.model-trace-explorer.assesment-value-tag",color:o,children:(0,g.Y)("span",{css:Et,children:r})})})},Bt=({source:e})=>{const{theme:t}=(0,a.u)();return(0,g.Y)(Ae.T,{componentId:"shared.model-trace-explorer.assessment-source-name",content:e.source_id,children:(0,g.Y)("span",{css:(0,s.AH)({flexShrink:1,overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap",marginLeft:t.spacing.sm,minWidth:t.spacing.md},""),children:(0,g.Y)(a.T.Text,{children:(0,g.Y)("span",{css:(0,s.AH)({color:t.colors.blue500},""),children:e.source_id})})})})};var Ot={name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"};const jt=({renderConnector:e=!0,assessment:t,setIsEditing:n})=>{const{theme:r}=(0,a.u)(),[l,c]=(0,o.useState)(!1),d=(e=>{switch(e.source_type){case"HUMAN":return i.UserIcon;case"LLM_JUDGE":return i.SparkleIcon;default:return i.CodeIcon}})(t.source);return(0,g.FD)("div",{css:Ot,children:[e&&(0,g.Y)("div",{css:(0,s.AH)({position:"absolute",left:-1,top:0,width:10,height:r.typography.lineHeightBase,boxSizing:"border-box",borderBottomLeftRadius:r.borders.borderRadiusMd,borderBottom:`1px solid ${r.colors.border}`,borderLeft:`1px solid ${r.colors.border}`},"")}),(0,g.Y)(d,{size:r.typography.fontSizeSm,css:(0,s.AH)({padding:2,backgroundColor:r.colors.actionIconBackgroundHover,borderRadius:r.borders.borderRadiusFull},"")}),(0,g.Y)(Bt,{source:t.source}),(0,g.FD)("div",{css:(0,s.AH)({marginLeft:"auto",display:"flex",flexDirection:"row",alignItems:"center",gap:r.spacing.xs},""),children:[t.last_update_time&&(0,g.Y)(a.T.Text,{color:"secondary",size:"sm",css:(0,s.AH)({marginLeft:r.spacing.sm,overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap"},""),children:ut(new Date(t.last_update_time))}),(0,g.Y)(Mt,{assessment:t,setIsEditing:n,setShowDeleteModal:c}),(0,g.Y)(kt,{assessment:t,isModalVisible:l,setIsModalVisible:c})]})]})},Lt=({error:e})=>{const{theme:t}=(0,a.u)(),[n,r]=(0,o.useState)(!1);return(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,g.Y)(i.Alert,{type:"error",closable:!1,message:e.error_code,componentId:"shared.model-trace-explorer.feedback-error-item",description:(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,g.Y)("span",{children:e.error_message}),e.stack_trace&&(0,g.Y)(a.T.Link,{componentId:"shared.model-trace-explorer.feedback-error-item-stack-trace-link",onClick:()=>r(!0),children:(0,g.Y)(l.sA,{id:"z/CjX4",defaultMessage:"View stack trace"})})]})}),e.stack_trace&&(0,g.Y)(Ae.d,{title:(0,g.Y)(l.sA,{id:"KqReh3",defaultMessage:"Error stack trace"}),visible:n,componentId:"shared.model-trace-explorer.feedback-error-stack-trace-modal",footer:null,onCancel:()=>r(!1),children:(0,g.Y)(ye,{data:JSON.stringify(e.stack_trace),title:"",initialRenderMode:z.cC.TEXT})})]})};var Kt={name:"yqjhl6",styles:"display:flex;flex-direction:column;position:relative"};const $t=({feedback:e})=>{const{theme:t}=(0,a.u)(),n=e.feedback.value;return(0,g.FD)("div",{css:Kt,children:[(0,g.Y)(jt,{renderConnector:!1,assessment:e}),(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs,marginLeft:10,paddingLeft:t.spacing.md,paddingTop:t.spacing.sm,paddingBottom:t.spacing.md,paddingRight:t.spacing.lg,borderLeft:`1px solid ${t.colors.border}`},""),children:[(0,d.isNil)(e.feedback.error)?(0,g.FD)(g.FK,{children:[(0,g.Y)(a.T.Text,{size:"sm",color:"secondary",children:(0,g.Y)(l.sA,{id:"RGKRP9",defaultMessage:"Feedback"})}),(0,g.Y)("div",{children:(0,g.Y)(zt,{jsonValue:JSON.stringify(n)})})]}):(0,g.Y)(Lt,{error:e.feedback.error}),e.rationale&&(0,g.FD)(g.FK,{children:[(0,g.Y)(a.T.Text,{size:"sm",color:"secondary",css:(0,s.AH)({marginTop:t.spacing.xs},""),children:(0,g.Y)(l.sA,{id:"gYOuKs",defaultMessage:"Rationale"})}),(0,g.Y)(ee,{children:e.rationale})]})]})]})},Vt=({isModalVisible:e,setIsModalVisible:t,feedback:n})=>{const s=(0,o.useMemo)((()=>(e=>{const t=new Set,n=[];let s=e;for(;s&&!t.has(s.assessment_id);)t.add(s.assessment_id),n.push(s),s=s.overriddenAssessment;return n})(n)),[n]);return(0,g.Y)(Ae.d,{componentId:"shared.model-trace-explorer.feedback-history-modal",visible:e,footer:null,onCancel:()=>{t(!1)},title:(0,g.Y)(l.sA,{id:"n6SrIn",defaultMessage:"Edit history"}),children:s.map((e=>"feedback"in e?(0,g.Y)($t,{feedback:e},e.assessment_id):null))})};var Pt={name:"1cgftv8",styles:"&:hover{text-decoration:underline;cursor:pointer;}"},Wt={name:"16mcpms",styles:"& > div:last-of-type{margin-bottom:0;}"};const Ut=({feedback:e})=>{const[t,n]=(0,o.useState)(!1),{theme:r}=(0,a.u)(),{nodeMap:i,activeView:c}=N(),u=e.feedback.value,p=e.span_id?i[e.span_id]:null,m="summary"===c&&p;return(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:r.spacing.sm,marginLeft:r.spacing.lg},""),children:[!(0,d.isNil)(e.feedback.error)&&(0,g.Y)(Lt,{error:e.feedback.error}),m&&(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:r.spacing.xs},""),children:[(0,g.Y)(a.T.Text,{size:"sm",color:"secondary",children:(0,g.Y)(l.sA,{id:"+hQbnS",defaultMessage:"Span"})}),(0,g.Y)(Ht,{node:p})]}),(0,d.isNil)(e.feedback.error)&&(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:r.spacing.xs},""),children:[(0,g.Y)(a.T.Text,{size:"sm",color:"secondary",children:(0,g.Y)(l.sA,{id:"RGKRP9",defaultMessage:"Feedback"})}),(0,g.FD)("div",{css:(0,s.AH)({display:"flex",gap:r.spacing.xs},""),children:[(0,g.Y)(zt,{jsonValue:JSON.stringify(u)}),e.overriddenAssessment&&(0,g.FD)(g.FK,{children:[(0,g.Y)("span",{onClick:()=>n(!0),children:(0,g.Y)(a.T.Text,{css:Pt,color:"secondary",children:(0,g.Y)(l.sA,{id:"f4CfIz",defaultMessage:"(edited)"})})}),(0,g.Y)(Vt,{isModalVisible:t,setIsModalVisible:n,feedback:e})]})]})]}),e.rationale&&(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:r.spacing.xs},""),children:[(0,g.Y)(a.T.Text,{size:"sm",color:"secondary",children:(0,g.Y)(l.sA,{id:"gYOuKs",defaultMessage:"Rationale"})}),(0,g.Y)("div",{css:Wt,children:(0,g.Y)(ee,{children:e.rationale})})]})]})},Jt=({feedback:e})=>{const{theme:t}=(0,a.u)(),[n,r]=(0,o.useState)(!1);return(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs,paddingLeft:t.spacing.lg/2,marginLeft:t.spacing.lg/2,paddingTop:t.spacing.sm,paddingBottom:t.spacing.sm,borderLeft:`1px solid ${t.colors.border}`,position:"relative"},""),children:[(0,g.Y)(jt,{assessment:e,setIsEditing:r}),n?(0,g.Y)(Ct,{assessment:e,onSuccess:()=>r(!1),onCancel:()=>r(!1)}):(0,g.Y)(Ut,{feedback:e})]})};const qt=e=>{const t={"& > svg":{width:12,height:12}};switch(e){case"HUMAN":return(0,g.Y)(i.UserIcon,{css:t});case"LLM_JUDGE":return(0,g.Y)(i.SparkleIcon,{css:t});case"CODE":return(0,g.Y)(i.CodeIcon,{css:t});default:return null}};var Gt={name:"ti75j2",styles:"margin:0"};const Zt=({feedbacks:e})=>{const{theme:t}=(0,a.u)();if(e.length<2)return null;const n=(0,d.countBy)(e,(e=>e.source.source_type));return(0,g.Y)("div",{css:(0,s.AH)({display:"flex",gap:t.spacing.xs,alignItems:"center",marginLeft:t.spacing.xs},""),children:Object.entries(n).map((([e,n])=>(0,g.Y)(i.Tag,{componentId:`shared.model-trace-explorer.feedback-source-count-${e}`,css:Gt,children:(0,g.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",gap:t.spacing.xs},""),children:[qt(e),(0,g.Y)(a.T.Text,{children:n})]})},e)))})};var Xt={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Qt={name:"ozd7xs",styles:"flex-shrink:0"},en={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const tn=({jsonValue:e,feedbacks:t})=>{const{theme:n}=(0,a.u)(),[r,l]=(0,o.useState)(!1);return(0,g.FD)("div",{css:Xt,children:[(0,g.FD)("div",{css:(0,s.AH)({display:"flex",gap:n.spacing.xs,alignItems:"center"},""),children:[(0,g.Y)(a.B,{componentId:"shared.model-trace-explorer.toggle-assessment-expanded",css:Qt,size:"small",icon:r?(0,g.Y)(i.ChevronDownIcon,{}):(0,g.Y)(a.q,{}),onClick:()=>l(!r)}),(0,g.Y)(zt,{jsonValue:e}),(0,g.Y)(Zt,{feedbacks:t})]}),r&&(0,g.Y)("div",{css:en,children:t.map((e=>!1===(null===e||void 0===e?void 0:e.valid)?null:(0,g.Y)(Jt,{feedback:e},e.assessment_id)))})]})};var nn={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"},sn={name:"ozd7xs",styles:"flex-shrink:0"};const on=({name:e,valuesMap:t,traceId:n,activeSpanId:r})=>{const{theme:l}=(0,a.u)(),c=(e=>{const t=e.split("/");return 1===t.length?e:2===t.length?t[1]:t.slice(2).join("/")})(e),[u,p]=(0,o.useState)(!1),m=Object.values(t).flat().some((e=>!(0,d.isNil)(e.feedback.error)));return(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",marginBottom:l.spacing.sm,border:`1px solid ${l.colors.border}`,borderRadius:l.borders.borderRadiusMd,padding:l.spacing.sm+l.spacing.xs,paddingTop:l.spacing.sm,gap:l.spacing.sm},""),children:[(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:l.spacing.sm},""),children:[(0,g.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",gap:l.spacing.sm,flex:1,minWidth:0},""),children:[(0,g.Y)(a.T.Text,{bold:!0,css:nn,children:c}),m&&(0,g.Y)(a.l,{css:sn,color:"danger"})]}),(0,g.Y)(Ae.T,{content:"Add new feedback",componentId:"shared.model-trace-explorer.add-feedback-in-group-tooltip",children:(0,g.Y)(a.B,{componentId:"shared.model-trace-explorer.add-feedback",css:(0,s.AH)({flexShrink:0,marginRight:-l.spacing.xs},""),size:"small",icon:(0,g.Y)(i.PlusIcon,{}),onClick:()=>p(!0)})})]}),Object.entries(t).map((([e,t])=>(0,g.Y)(tn,{jsonValue:e,feedbacks:t},e))),u&&(0,g.Y)(wt,{assessmentName:e,spanId:r,traceId:n,setExpanded:p})]})};var rn={name:"4c6dm7",styles:"display:flex;flex-direction:row;justify-content:space-between"};const an=({assessments:e,traceId:t,activeSpanId:n})=>{const{theme:r}=(0,a.u)(),{setAssessmentsPaneExpanded:i}=N(),[c,u]=(0,o.useMemo)((()=>(0,d.partition)(e,(e=>"feedback"in e))),[e]),p=(0,o.useMemo)((()=>(e=>{const t={};return e.forEach((e=>{if(!1===e.valid)return;let n=null;""!==e.feedback.value&&(n=JSON.stringify(e.feedback.value));const{assessment_name:s}=e;t[s]||(t[s]={});const o=t[s];(0,d.isNil)(n)||(o[n]||(o[n]=[]),o[n].push(e))})),Object.entries(t).toSorted((([e],[t])=>e.localeCompare(t)))})(c)),[c]),m=u.toSorted(((e,t)=>e.assessment_name.localeCompare(t.assessment_name)));return(0,g.FD)("div",{"data-testid":"assessments-pane",css:(0,s.AH)({display:"flex",flexDirection:"column",padding:r.spacing.sm,paddingTop:r.spacing.xs,height:"100%",borderLeft:`1px solid ${r.colors.border}`,overflowY:"scroll",minWidth:dt,width:"100%",boxSizing:"border-box"},""),children:[(0,g.FD)("div",{css:rn,children:[(0,g.Y)(a.T.Text,{css:(0,s.AH)({marginBottom:r.spacing.sm},""),bold:!0,children:(0,g.Y)(l.sA,{id:"++Ydlz",defaultMessage:"Assessments"})}),i&&(0,g.Y)(Ae.T,{componentId:"shared.model-trace-explorer.close-assessments-pane-tooltip",content:(0,g.Y)(l.sA,{id:"cQQnzX",defaultMessage:"Hide assessments"}),children:(0,g.Y)(a.B,{"data-testid":"close-assessments-pane-button",componentId:"shared.model-trace-explorer.close-assessments-pane",size:"small",icon:(0,g.Y)(a.C,{}),onClick:()=>i(!1)})})]}),p.map((([e,s])=>(0,g.Y)(on,{name:e,valuesMap:s,traceId:t,activeSpanId:n},e))),m.length>0&&(0,g.FD)(g.FK,{children:[(0,g.Y)(a.T.Text,{color:"secondary",css:(0,s.AH)({marginBottom:r.spacing.sm},""),children:(0,g.Y)(l.sA,{id:"UbXw8O",defaultMessage:"Expectations"})}),(0,g.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:r.spacing.sm,marginBottom:r.spacing.sm},""),children:m.map((e=>(0,g.Y)(_t,{expectation:e},e.assessment_id)))})]}),(0,g.Y)(Tt,{title:(0,g.Y)(l.sA,{id:"2+O4wk",defaultMessage:"Add new assessment"}),spanId:n,traceId:t})]})};function ln({activeSpan:e,searchFilter:t,activeMatch:n,activeTab:r,setActiveTab:u}){const{theme:p}=(0,a.u)(),[m,h]=(0,o.useState)(500),f={flex:1,marginTop:-p.spacing.md,overflowY:"auto"},{assessmentsPaneExpanded:v,assessmentsPaneEnabled:y}=N();if((0,d.isNil)(e))return(0,g.Y)(i.Empty,{description:"Please select a span to view more information"});const b=(0,c.N7)(e),Y=b>0,S=(0,g.FD)(i.Tabs.Root,{componentId:"shared.model-trace-explorer.right-pane-tabs",css:(0,s.AH)({display:"flex",flexDirection:"column",flex:1,borderLeft:`1px solid ${p.colors.border}`,minWidth:200,position:"relative"},""),value:r,onValueChange:e=>u(e),children:[(0,g.Y)("div",{css:(0,s.AH)({position:"absolute",right:v?p.spacing.xs:p.spacing.md,top:p.spacing.xs},""),children:(0,g.Y)(at,{})}),(0,g.FD)(i.Tabs.List,{css:(0,s.AH)({padding:0,paddingLeft:p.spacing.md,paddingRight:p.spacing.sm,boxSizing:"border-box",width:"100%"},""),children:[e.chatMessages&&(0,g.Y)(i.Tabs.Trigger,{value:"chat",children:(0,g.Y)(l.sA,{id:"BkDhmT",defaultMessage:"Chat"})}),(0,g.Y)(i.Tabs.Trigger,{value:"content",children:(0,g.Y)(l.sA,{id:"KW2dOC",defaultMessage:"Inputs / Outputs"})}),(0,g.Y)(i.Tabs.Trigger,{value:"attributes",children:"Attributes"}),(0,g.FD)(i.Tabs.Trigger,{value:"events",children:["Events ",Y&&(0,g.Y)(st,{count:b})]})]}),e.chatMessages&&(0,g.Y)(i.Tabs.Content,{css:f,value:"chat",children:(0,g.Y)(ze,{chatMessages:e.chatMessages,chatTools:e.chatTools})}),(0,g.Y)(i.Tabs.Content,{css:f,value:"content",children:(0,g.Y)(tt,{activeSpan:e,searchFilter:t,activeMatch:n})}),(0,g.Y)(i.Tabs.Content,{css:f,value:"attributes",children:(0,g.Y)(be,{activeSpan:e,searchFilter:t,activeMatch:n})}),(0,g.Y)(i.Tabs.Content,{css:f,value:"events",children:(0,g.Y)(nt,{activeSpan:e,searchFilter:t,activeMatch:n})})]});return y&&v?(0,g.Y)(x,{initialRatio:.7,paneWidth:m,setPaneWidth:h,leftChild:S,leftMinWidth:250,rightChild:(0,g.Y)(an,{assessments:e.assessments,traceId:e.traceId,activeSpanId:e.parentId?String(e.key):void 0}),rightMinWidth:dt}):S}const cn=o.memo(ln),dn=({spanFilterState:e,setSpanFilterState:t})=>{const{theme:n}=(0,a.u)();return(0,g.FD)(a.ax.Root,{componentId:"shared.model-trace-explorer.timeline-tree-filter-popover",children:[(0,g.Y)(a.ax.Trigger,{asChild:!0,children:(0,g.Y)(a.B,{componentId:"shared.model-trace-explorer.timeline-tree-filter-button",icon:(0,g.Y)(i.FilterIcon,{}),size:"small",children:(0,g.Y)(l.sA,{id:"Dm4Ez0",defaultMessage:"Filter"})})}),(0,g.Y)(a.ax.Content,{align:"start",children:(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingBottom:n.spacing.xs},""),children:[(0,g.Y)(a.T.Text,{bold:!0,children:(0,g.Y)(l.sA,{id:"oy2LTl",defaultMessage:"Filter"})}),(0,g.Y)(a.T.Text,{color:"secondary",children:(0,g.Y)(l.sA,{id:"rgSaFx",defaultMessage:"Span type"})}),Object.entries(e.spanTypeDisplayState).map((([o,r])=>{const l=(0,g.Y)(we.P,{type:(0,c.tC)(o)});return(0,g.FD)(i.Checkbox,{componentId:`shared.model-trace-explorer.toggle-span-filter_${o}-${!r}`,style:{width:"100%"},isChecked:r,onChange:()=>t({...e,spanTypeDisplayState:{...e.spanTypeDisplayState,[o]:!r}}),children:[l,(0,g.Y)(a.T.Text,{css:(0,s.AH)({marginLeft:n.spacing.xs},""),children:(0,c.LS)(o)})]},o)})),(0,g.Y)(a.T.Text,{color:"secondary",children:(0,g.Y)(l.sA,{id:"SrV58C",defaultMessage:"Settings"})}),(0,g.FD)(i.Checkbox,{componentId:`shared.model-trace-explorer.toggle-show-parents_${!e.showParents}`,style:{width:"100%"},isChecked:e.showParents,onChange:()=>t({...e,showParents:!e.showParents}),children:[(0,g.Y)(a.T.Text,{css:(0,s.AH)({marginRight:n.spacing.xs},""),children:(0,g.Y)(l.sA,{id:"nYSJgH",defaultMessage:"Show all parent spans"})}),(0,g.Y)(i.InfoTooltip,{componentId:"shared.model-trace-explorer.show-parents-tooltip",content:(0,g.Y)(l.sA,{id:"H9MulE",defaultMessage:"Always show parents of matched spans, regardless of filter conditions"})})]}),(0,g.FD)(i.Checkbox,{componentId:`shared.model-trace-explorer.toggle-show-parents_${!e.showExceptions}`,style:{width:"100%"},isChecked:e.showExceptions,onChange:()=>t({...e,showExceptions:!e.showExceptions}),children:[(0,g.Y)(a.T.Text,{css:(0,s.AH)({marginRight:n.spacing.xs},""),children:(0,g.Y)(l.sA,{id:"/vhBCt",defaultMessage:"Show exceptions"})}),(0,g.Y)(i.InfoTooltip,{componentId:"shared.model-trace-explorer.show-exceptions-tooltip",content:(0,g.Y)(l.sA,{id:"60b0vW",defaultMessage:"Always show spans with exceptions, regardless of filter conditions"})})]})]})})]})},un=({showTimelineInfo:e,setShowTimelineInfo:t,spanFilterState:n,setSpanFilterState:o})=>{const{theme:r}=(0,a.u)();return(0,g.FD)("div",{css:(0,s.AH)({padding:`${r.spacing.xs}px ${r.spacing.sm}px`,paddingBottom:3,borderBottom:`1px solid ${r.colors.border}`,boxSizing:"border-box",paddingLeft:r.spacing.sm,alignItems:"center",display:"flex",justifyContent:"space-between"},""),children:[(0,g.Y)(a.T.Text,{bold:!0,children:(0,g.Y)(l.sA,{id:"w48V74",defaultMessage:"Trace breakdown"})}),(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:r.spacing.sm},""),children:[(0,g.Y)(dn,{spanFilterState:n,setSpanFilterState:o}),(0,g.FD)(i.SegmentedControlGroup,{name:"size-story",value:e,onChange:e=>{t(e.target.value)},size:"small",componentId:"shared.model-trace-explorer.toggle-show-timeline",children:[(0,g.Y)(i.SegmentedControlButton,{"data-testid":"hide-timeline-info-button",icon:(0,g.Y)(Ae.T,{componentId:"shared.model-trace-explorer.hide-timeline-info-tooltip",content:(0,g.Y)(l.sA,{id:"E9fsRD",defaultMessage:"Show span tree"}),children:(0,g.Y)(i.ListBorderIcon,{})}),value:!1}),(0,g.Y)(i.SegmentedControlButton,{"data-testid":"show-timeline-info-button",icon:(0,g.Y)(Ae.T,{componentId:"shared.model-trace-explorer.show-timeline-info-tooltip",content:(0,g.Y)(l.sA,{id:"r5t1Je",defaultMessage:"Show execution timeline"}),children:(0,g.Y)(i.BarsAscendingVerticalIcon,{})}),value:!0})]})]})]})},pn=({active:e})=>{const{theme:t}=(0,a.u)(),n=e?t.colors.blue500:t.colors.border;return(0,g.Y)("div",{css:(0,s.AH)({position:"absolute",left:"100%",bottom:0,width:9,height:t.spacing.md,boxSizing:"border-box",borderTopRightRadius:t.borders.borderRadiusMd,borderTop:`1px solid ${n}`,borderRight:`1px solid ${n}`,zIndex:M},"")})},mn=({active:e})=>{const{theme:t}=(0,a.u)(),n=e?t.colors.blue500:t.colors.border;return(0,g.Y)("div",{css:(0,s.AH)({position:"absolute",left:"50%",top:0,width:8,height:t.spacing.md,boxSizing:"border-box",borderBottomLeftRadius:t.borders.borderRadiusMd,borderBottom:`1px solid ${n}`,borderLeft:`1px solid ${n}`,zIndex:e?T:M},"")})},gn=({active:e})=>{const{theme:t}=(0,a.u)(),n=e?t.colors.blue500:t.colors.border;return(0,g.Y)("div",{css:(0,s.AH)({position:"absolute",width:8,left:"50%",height:32,borderLeft:`1px solid ${n}`,boxSizing:"border-box",zIndex:e?T:M},"")})},hn=({isActiveSpan:e,isInActiveChain:t,linesToRender:n,hasChildren:o,isExpanded:r})=>0===n.length?(0,g.Y)("div",{css:(0,s.AH)({width:0,height:32,boxSizing:"border-box",position:"relative"},""),children:o&&(0,g.Y)(pn,{active:t&&!e})}):(0,g.Y)(g.FK,{children:n.map((({shouldRender:a,isActive:i},l)=>(0,g.FD)("div",{css:(0,s.AH)({width:16,height:32,boxSizing:"border-box",position:"relative"},""),children:[a&&(0,g.Y)(gn,{active:i}),l===n.length-1&&(0,g.FD)(g.FK,{children:[(0,g.Y)(mn,{active:t}),o&&r&&(0,g.Y)(pn,{active:t&&!e})]})]},l)))});var fn={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const vn=({span:e,children:t})=>{var n;const{theme:o}=(0,a.u)(),r=(0,c.tC)(null!==(n=e.type)&&void 0!==n?n:z.UG.UNKNOWN),i=o.isDarkMode?o.colors.grey800:o.colors.grey100,d=o.isDarkMode?o.colors.grey500:o.colors.grey350;return(0,g.Y)(Ae.T,{componentId:"shared.model-trace-explorer.timeline-tree-node-tooltip",hideWhenDetached:!1,content:(0,g.FD)("div",{css:fn,children:[(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:o.spacing.xs,alignItems:"center",overflow:"hidden",wordBreak:"break-all"},""),children:[(0,g.Y)(we.P,{type:r,isInTooltip:!0}),(0,g.Y)("span",{css:(0,s.AH)({color:i},""),children:e.title}),(0,g.Y)("span",{css:(0,s.AH)({marginLeft:o.spacing.xs,color:d,fontSize:o.typography.fontSizeSm},""),children:I(e.end-e.start)})]}),(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",color:i},""),children:[(0,g.Y)(l.sA,{id:"YV6xFB",defaultMessage:"Start:"})," ",I(e.start)," | ",(0,g.Y)(l.sA,{id:"q90jVU",defaultMessage:"End:"})," ",I(e.end)]})]}),side:"right",maxWidth:700,children:t})};var xn={name:"18mz9c1",styles:"display:flex;flex-direction:row;align-items:center;overflow:hidden;flex:1"},yn={name:"adzntw",styles:"overflow:hidden;white-space:nowrap;text-overflow:ellipsis;flex:1"};const bn=({node:e,selectedKey:t,expandedKeys:n,setExpandedKeys:o,traceStartTime:r,traceEndTime:l,onSelect:d,linesToRender:u})=>{var p,m;const h=n.has(e.key),{theme:f}=(0,a.u)(),v=(null!==(p=e.children)&&void 0!==p?p:[]).length>0,{setAssessmentsPaneExpanded:x}=N(),y=t===e.key,b=C(e,String(t)),Y=b>-1,S=(0,c.N7)(e)>0,A=y?f.colors.actionDefaultBackgroundHover:"transparent";return(0,g.FD)(g.FK,{children:[(0,g.Y)(vn,{span:e,children:(0,g.Y)("div",{"data-testid":`timeline-tree-node-${e.key}`,css:(0,s.AH)({display:"flex",flexDirection:"column",width:"100%",cursor:"pointer",boxSizing:"border-box",backgroundColor:A,":hover":{backgroundColor:f.colors.actionDefaultBackgroundHover},":active":{backgroundColor:f.colors.actionDefaultBackgroundPress}},""),onClick:()=>{null===d||void 0===d||d(e)},children:(0,g.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:`0px ${f.spacing.sm}px`,justifyContent:"space-between",overflow:"hidden",flex:1},""),children:(0,g.FD)("div",{css:xn,children:[v?(0,g.Y)(a.B,{size:"small","data-testid":`toggle-span-expanded-${e.key}`,css:(0,s.AH)({flexShrink:0,marginRight:f.spacing.xs},""),icon:h?(0,g.Y)(i.ChevronDownIcon,{}):(0,g.Y)(a.q,{}),onClick:t=>{t.stopPropagation();const s=new Set(n);h?s.delete(e.key):s.add(e.key),o(s)},componentId:"shared.model-trace-explorer.toggle-span"}):(0,g.Y)("div",{css:(0,s.AH)({width:24,marginRight:f.spacing.xs},"")}),(0,g.Y)(hn,{isActiveSpan:y,isInActiveChain:Y,linesToRender:u,hasChildren:v,isExpanded:h}),(0,g.Y)("span",{css:(0,s.AH)({flexShrink:0,marginRight:f.spacing.xs,borderRadius:f.borders.borderRadiusSm,border:`1px solid ${b>-1?f.colors.blue500:f.colors.backgroundSecondary}`,zIndex:T},""),children:e.icon}),(0,g.Y)(a.T.Text,{color:S?"error":"primary",css:yn,children:e.title}),e.assessments.length>0&&(0,g.FD)(i.Tag,{color:"indigo","data-testid":`assessment-tag-${e.key}`,componentId:"shared.model-trace-explorer.assessment-count",css:(0,s.AH)({margin:0,borderRadius:f.borders.borderRadiusSm},""),onClick:()=>null===x||void 0===x?void 0:x(!0),children:[(0,g.Y)(i.GavelIcon,{}),(0,g.Y)(a.T.Text,{css:(0,s.AH)({marginLeft:f.spacing.xs},""),children:e.assessments.length})]})]})})})}),h&&(null===(m=e.children)||void 0===m?void 0:m.map(((s,a)=>{var i,c;return(0,g.Y)(bn,{node:s,expandedKeys:n,setExpandedKeys:o,selectedKey:t,traceStartTime:r,traceEndTime:l,onSelect:d,linesToRender:u.concat({shouldRender:a<(null!==(i=null===(c=e.children)||void 0===c?void 0:c.length)&&void 0!==i?i:0)-1,isActive:a<b})},s.key)})))]})};var Yn={name:"1j2qjqs",styles:"flex:1;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"};const Sn=({node:e,selectedKey:t,leftOffset:n,width:r,onSelect:l,expandedKeys:c,setExpandedKeys:d})=>{var u;const{theme:p}=(0,a.u)(),m=(0,o.useRef)(null),h=(0,o.useRef)(null),f=t===e.key?p.colors.actionDefaultBackgroundHover:"transparent",v=(null!==(u=e.children)&&void 0!==u?u:[]).length>0,x=c.has(e.key);return(0,o.useLayoutEffect)((()=>{if(!m.current||!h.current)return;Math.max(m.current.offsetWidth,h.current.offsetWidth)<r-p.spacing.sm?(m.current.style.display="inline",h.current.style.display="none"):(m.current.style.display="none",h.current.style.display="inline")}),[p.spacing.sm,r]),(0,g.Y)(vn,{span:e,children:(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",cursor:"pointer",boxSizing:"border-box",paddingLeft:p.spacing.xs,paddingRight:p.spacing.sm,paddingTop:p.spacing.xs,paddingBottom:p.spacing.xs,backgroundColor:f,alignItems:"center",":hover":{backgroundColor:p.colors.actionDefaultBackgroundHover},":active":{backgroundColor:p.colors.actionDefaultBackgroundPress},zIndex:T},""),onClick:()=>null===l||void 0===l?void 0:l(e),children:[v?(0,g.Y)(a.B,{size:"small","data-testid":`toggle-timeline-span-expanded-${e.key}`,css:(0,s.AH)({flexShrink:0,marginRight:p.spacing.xs},""),icon:x?(0,g.Y)(i.ChevronDownIcon,{}):(0,g.Y)(a.q,{}),onClick:t=>{t.stopPropagation();const n=new Set(c);x?n.delete(e.key):n.add(e.key),d(n)},componentId:"shared.model-trace-explorer.toggle-timeline-span"}):(0,g.Y)("div",{css:(0,s.AH)({width:24,marginRight:p.spacing.xs},"")}),(0,g.Y)("div",{css:(0,s.AH)({width:n,flexShrink:0},"")}),(0,g.Y)("div",{css:(0,s.AH)({position:"relative",width:r,height:p.typography.lineHeightBase,backgroundColor:p.colors.blue600,borderRadius:p.borders.borderRadiusSm,flexShrink:0},""),children:(0,g.Y)(a.T.Text,{children:(0,g.Y)("span",{ref:m,css:(0,s.AH)({marginLeft:p.spacing.xs,color:p.colors.white,display:"none"},""),children:e.title})})}),(0,g.FD)("div",{css:Yn,children:[(0,g.Y)(a.T.Text,{children:(0,g.Y)("span",{ref:h,css:(0,s.AH)({marginLeft:p.spacing.xs,color:p.colors.textPrimary},""),children:e.title})}),(0,g.Y)(a.T.Text,{css:(0,s.AH)({marginLeft:p.spacing.xs},""),color:"secondary",children:I(e.end-e.start)})]})]},e.key)})};var An={name:"1c2ejnx",styles:"display:flex;flex-direction:column;position:relative;box-sizing:border-box"},wn={name:"bjn8wh",styles:"position:relative"},Tn={name:"xyyuvf",styles:"position:absolute;height:100%;width:100%"};const Mn=({nodes:e,selectedKey:t,onSelect:n,traceStartTime:r,traceEndTime:i,expandedKeys:l,setExpandedKeys:c})=>{var d,u;const{theme:p}=(0,a.u)(),h=(0,o.useRef)(null),f=null!==(d=null===(u=(0,m.wY)({ref:h}))||void 0===u?void 0:u.width)&&void 0!==d?d:0,v=(0,o.useMemo)((()=>function(e,t,n,s=60){const o=t-e;if(o<=0||n<=0)return[];const r=Math.floor(n/s);if(r<1)return[];const a=o/r,i=Math.pow(10,Math.floor(Math.log10(a))),l=a/i;let c;c=l<=1?1:l<=2?2:l<=5?5:10;const d=c*i,u=t+2*d,p=[];for(let m=Math.ceil(e/d)*d;m<=u;m+=d)p.push(Number(m.toFixed(10)));return p}(r,i,f)),[i,r,f]),x=Math.min(...v),y=(v[v.length-1]+v[v.length-2])/2,b=v.slice(0,-1),Y=e=>function(e,t,n,s){return(e-t)/(n-t)*s}(e,x,y,f);return(0,g.FD)("div",{css:An,children:[(0,g.Y)("div",{ref:h,css:(0,s.AH)({display:"flex",width:"100%",flexDirection:"row",height:p.typography.lineHeightBase,paddingLeft:32,paddingRight:p.spacing.lg,boxSizing:"border-box",position:"sticky",top:0,backgroundColor:p.colors.backgroundPrimary,zIndex:w},""),children:(0,g.Y)("div",{"data-testid":"time-marker-area",css:wn,children:b.map((e=>(0,g.Y)(a.T.Text,{css:(0,s.AH)({position:"absolute",transform:"translateX(-50%)",left:Y(e),whiteSpace:"nowrap"},""),children:I(e)},e)))})}),(0,g.Y)("div",{css:(0,s.AH)({flex:1,pointerEvents:"none",zIndex:M},""),children:(0,g.Y)("div",{css:Tn,children:b.map((e=>(0,g.Y)("div",{css:(0,s.AH)({position:"absolute",left:Y(e)+32,borderRight:`1px solid ${p.colors.border}`,height:"100%"},"")},e)))})}),e.map((e=>{const s=Y(e.start),o=Y(e.end)-s;return(0,g.Y)(Sn,{selectedKey:t,onSelect:n,node:e,leftOffset:s,width:o,expandedKeys:l,setExpandedKeys:c},e.key)}))]})};var kn={name:"1v8q7xf",styles:"flex:1;overflow:auto;min-height:100%;box-sizing:border-box;display:flex;flex-direction:column"},Dn={name:"1jyk3dc",styles:"overflow:hidden;display:flex;flex-direction:column;flex:1"},In={name:"13ku56z",styles:"display:flex;flex-direction:column;height:100%"},Cn={name:"9nf0yq",styles:"flex:1;overflow-y:auto;display:flex"};const Fn=({rootNodes:e,selectedNode:t,setSelectedNode:n,traceStartTime:r,traceEndTime:i,expandedKeys:c,setExpandedKeys:d,spanFilterState:u,setSpanFilterState:p,className:m})=>{const{theme:h}=(0,a.u)(),f=(0,o.useCallback)((e=>{null===n||void 0===n||n(e)}),[n]),{showTimelineTreeGantt:v,setShowTimelineTreeGantt:x}=N(),y=(0,o.useMemo)((()=>((e,t)=>{const n=[],s=e=>{var o;e&&(n.push(e),t.has(e.key)&&(null===(o=e.children)||void 0===o||o.forEach(s)))};return e.forEach(s),n})(e,c)),[e,c]),b=(0,o.useMemo)((()=>{var n;return(0,g.Y)("div",{css:kn,children:v?(0,g.Y)(Mn,{nodes:y,selectedKey:null!==(n=null===t||void 0===t?void 0:t.key)&&void 0!==n?n:"",onSelect:f,traceStartTime:r,traceEndTime:i,expandedKeys:c,setExpandedKeys:d}):e.map((e=>{var n;return(0,g.Y)(bn,{node:e,expandedKeys:c,setExpandedKeys:d,selectedKey:null!==(n=null===t||void 0===t?void 0:t.key)&&void 0!==n?n:"",traceStartTime:r,traceEndTime:i,onSelect:f,linesToRender:[]},e.key)}))})}),[v,y,null===t||void 0===t?void 0:t.key,f,r,i,e,c,d]);return(0,g.Y)("div",{css:(0,s.AH)({height:"100%",borderRadius:h.legacyBorders.borderRadiusMd,overflow:"hidden",display:"flex"},""),className:m,children:(0,g.Y)("div",{css:Dn,children:(0,g.FD)("div",{css:In,children:[(0,g.Y)(un,{showTimelineInfo:v,setShowTimelineInfo:x,spanFilterState:u,setSpanFilterState:p}),e.length>0?(0,g.Y)("div",{css:Cn,children:b}):(0,g.Y)("div",{css:(0,s.AH)({flex:1,display:"flex",justifyContent:"center",padding:h.spacing.md,paddingTop:h.spacing.lg},""),children:(0,g.Y)(l.sA,{id:"4pXg9j",defaultMessage:"No results found. Try using a different search term."})})]})})})};var Hn={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"},Nn={name:"82a6rk",styles:"flex:1"};const Rn=({modelTrace:e,className:t,selectedSpanId:n,onSelectSpan:r})=>{var i,l;const{theme:c}=(0,a.u)(),u=window.innerWidth<=768?.33:.25,p=(0,o.useRef)(null),[m,h]=(0,o.useState)(500),{rootNode:f,selectedNode:v,setSelectedNode:y,activeTab:b,setActiveTab:Y}=N(),{expandedKeys:w,setExpandedKeys:T}=((e={})=>{const[t,n]=(0,o.useState)((()=>{if(e.rootNodes){const t=(0,d.values)(D(e.rootNodes,e.initialExpandDepth)).map((e=>e.key));return new Set(t)}return new Set}));return{expandedKeys:t,setExpandedKeys:n}})({rootNodes:f?[f]:[],initialExpandDepth:A}),{matchData:M,searchFilter:k,setSearchFilter:I,spanFilterState:C,setSpanFilterState:H,filteredTreeNodes:R,handleNextSearchMatch:_,handlePreviousSearchMatch:z}=E({treeNode:f,selectedNode:v,setSelectedNode:y,setActiveTab:Y,setExpandedKeys:T,modelTraceInfo:null===e||void 0===e?void 0:e.info});(0,o.useLayoutEffect)((()=>{const e=(0,d.values)(D(R,A)).map((e=>e.key));T(new Set(e))}),[R,T]);const B=(0,o.useMemo)((()=>{const e=16*Math.max(...R.map(F))+7*c.spacing.lg;return Math.max(275,e)}),[R,c.spacing.lg]);return(0,g.FD)("div",{css:Hn,className:t,children:[(0,g.Y)("div",{css:(0,s.AH)({padding:c.spacing.xs,borderBottom:`1px solid ${c.colors.border}`},""),children:(0,g.Y)(S,{searchFilter:k,setSearchFilter:I,matchData:M,handleNextSearchMatch:_,handlePreviousSearchMatch:z})}),(0,g.Y)(x,{ref:p,initialRatio:u,paneWidth:m,setPaneWidth:h,leftChild:(0,g.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",flex:1,minWidth:B},""),children:(0,g.Y)(Fn,{rootNodes:R,selectedNode:v,traceStartTime:null!==(i=null===f||void 0===f?void 0:f.start)&&void 0!==i?i:0,traceEndTime:null!==(l=null===f||void 0===f?void 0:f.end)&&void 0!==l?l:0,setSelectedNode:e=>{y(e),Y(null!==e&&void 0!==e&&e.chatMessages?"chat":"content"),(0,d.isString)(null===e||void 0===e?void 0:e.key)&&(null===r||void 0===r||r(null===e||void 0===e?void 0:e.key))},css:Nn,expandedKeys:w,setExpandedKeys:T,spanFilterState:C,setSpanFilterState:H})}),leftMinWidth:B,rightChild:(0,g.Y)(cn,{activeSpan:v,searchFilter:k,activeMatch:M.match,activeTab:b,setActiveTab:Y}),rightMinWidth:500})]})},_n=()=>(0,g.Y)(i.Empty,{title:(0,g.Y)(l.sA,{id:"rjhiii",defaultMessage:"Trace failed to render"}),description:(0,g.Y)(l.sA,{id:"1a1+j5",defaultMessage:"Unfortunately, the trace could not be rendered due to an unknown error. You can reload the page to try again. If the problem persists, please contact support."}),image:(0,g.Y)(a.l,{})});var En=n(41261);const zn=({traceId:e,setModelTrace:t,setAssessmentsPaneEnabled:n,enabled:s=!0})=>{const o=[c.BS,e];return(0,En.I)({queryKey:o,queryFn:()=>(({traceId:e})=>Yt(`/ajax-api/3.0/mlflow/traces/${e}`))({traceId:e}),onSuccess:e=>{t((t=>{var n,s;return{data:t.data,info:null!==(n=null===e||void 0===e||null===(s=e.trace)||void 0===s?void 0:s.trace_info)&&void 0!==n?n:{}}})),n(!0)},onError:()=>{n(!1)},enabled:s})},Bn=({title:e,tools:t})=>{const{theme:n}=(0,a.u)();return(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,padding:n.spacing.sm,border:`1px solid ${n.colors.border}`,borderRadius:n.borders.borderRadiusSm},""),children:[e&&(0,g.Y)(a.T.Text,{css:(0,s.AH)({marginLeft:n.spacing.xs},""),bold:!0,children:e}),t.map((e=>(0,g.Y)(Se,{tool:e},e.function.name)))]})},On=({title:e,documents:t})=>{const{theme:n}=(0,a.u)();return(0,g.FD)("div",{css:(0,s.AH)({backgroundColor:n.colors.backgroundPrimary,borderRadius:n.borders.borderRadiusSm,border:`1px solid ${n.colors.border}`},""),children:[e&&(0,g.Y)("div",{css:(0,s.AH)({padding:`${n.spacing.xs}px ${n.spacing.sm}px`,borderBottom:`1px solid ${n.colors.border}`},""),children:(0,g.Y)(a.T.Text,{bold:!0,children:e})}),t.map(((e,o)=>(0,g.Y)("div",{css:(0,s.AH)({borderBottom:o!==t.length-1?`1px solid ${n.colors.border}`:""},""),children:(0,g.Y)(qe,{text:e.page_content,metadata:e.metadata},o)},o)))]})},jn=({title:e,value:t})=>{const{theme:n}=(0,a.u)(),[r,c]=(0,o.useState)(!1),d=t.length>400,u=!r&&t.length>400?t.slice(0,400)+"...":t,p=d?{":hover":{backgroundColor:n.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,g.FD)("div",{css:(0,s.AH)({border:`1px solid ${n.colors.border}`,borderRadius:n.borders.borderRadiusSm},""),children:[e&&(0,g.FD)("div",{role:"button",css:(0,s.AH)({display:"flex",justifyContent:"space-between",alignItems:"center",padding:`${n.spacing.sm}px ${n.spacing.sm+n.spacing.xs}px`,...p},""),onClick:()=>c(!r),children:[(0,g.Y)(a.T.Text,{bold:!0,children:e}),d&&(r?(0,g.Y)(i.ChevronDownIcon,{}):(0,g.Y)(a.q,{}))]}),(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingLeft:n.spacing.sm+n.spacing.xs,paddingRight:n.spacing.sm+n.spacing.xs,paddingTop:e?0:n.spacing.sm,paddingBottom:n.spacing.sm,"& > div:last-of-type":{marginBottom:0}},""),children:[(0,g.Y)(ee,{children:u}),d&&(0,g.Y)(a.T.Link,{onClick:()=>c(!r),componentId:"shared.model-trace-explorer.text-field-see-more-link",children:r?(0,g.Y)(l.sA,{id:"Y5Rr5k",defaultMessage:"See less"}):(0,g.Y)(l.sA,{id:"Hyv8Go",defaultMessage:"See more"})})]})]})},Ln=({title:e,data:t,renderMode:n})=>{const s=(0,o.useMemo)((()=>{try{return JSON.parse(t)}catch(e){return t}}),[t]),r=(0,d.isString)(s),a=(0,c.Hq)(s),i=Array.isArray(s)&&s.length>0&&(0,d.every)(s,c.PC),l=Array.isArray(s)&&s.length>0&&(0,d.every)(s,c.W0);return"json"===n?(0,g.Y)(ye,{title:e,data:t,initialRenderMode:z.cC.JSON}):"text"===n?(0,g.Y)(ye,{title:e,data:t,initialRenderMode:z.cC.TEXT}):r?(0,g.Y)(jn,{title:e,value:s}):a&&a.length>0?(0,g.Y)(Re,{messages:a}):i?(0,g.Y)(Bn,{title:e,tools:s}):l?(0,g.Y)(On,{title:e,documents:s}):(0,g.Y)(ye,{title:e,data:t})},Kn=({node:e})=>{var t;const{theme:n}=(0,a.u)(),o=(0,c.bn)(e),r=!e.parentId,l=o[0];return l?(0,g.Y)(Ee,{css:(0,s.AH)({marginBottom:r?n.spacing.sm:0},""),withBorder:r,sectionKey:l.name,title:(0,g.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",gap:n.spacing.sm},""),children:[(0,g.Y)(i.XCircleIcon,{color:"danger"}),(0,g.Y)(a.T.Text,{color:"error",bold:!0,children:"Exception"})]}),children:(0,g.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingBottom:n.spacing.sm,paddingLeft:r?0:n.spacing.lg},""),children:Object.entries(null!==(t=l.attributes)&&void 0!==t?t:{}).map((([e,t])=>(0,g.Y)(Ln,{title:e,data:JSON.stringify(t,null,2),renderMode:"text"},e)))})},l.name):null};var $n={name:"s6cpzs",styles:"display:flex;flex-direction:column;flex:1;min-width:0"},Vn={name:"bcffy2",styles:"display:flex;align-items:center;justify-content:space-between"},Pn={name:"1cgftv8",styles:"&:hover{text-decoration:underline;cursor:pointer;}"};const Wn=({node:e,renderMode:t})=>{const{theme:n}=(0,a.u)(),[r,d]=(0,o.useState)(!1),u=(0,o.useMemo)((()=>(0,c.g_)(e.inputs)),[e]),p=(0,o.useMemo)((()=>(0,c.g_)(e.outputs)),[e]),m=(0,c.bn)(e).length>0,h=u.length>0,f=p.length>0,{setSelectedNode:v,setActiveView:x,setShowTimelineTreeGantt:y}=N();return(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",minHeight:48,flexShrink:0},""),children:[(0,g.Y)("div",{css:(0,s.AH)({height:48,display:"flex",alignItems:"center"},""),children:(0,g.Y)(a.B,{size:"small","data-testid":`toggle-span-expanded-${e.key}`,css:(0,s.AH)({flexShrink:0,marginRight:n.spacing.xs},""),icon:r?(0,g.Y)(i.ChevronDownIcon,{}):(0,g.Y)(a.q,{}),onClick:()=>d(!r),componentId:"shared.model-trace-explorer.toggle-span"})}),(0,g.Y)("div",{css:(0,s.AH)({position:"relative",boxSizing:"border-box",height:"100%",borderLeft:`2px solid ${n.colors.border}`,width:12},""),children:(0,g.Y)("div",{css:(0,s.AH)({position:"absolute",left:-2,top:14,height:12,width:12,boxSizing:"border-box",borderBottomLeftRadius:n.borders.borderRadiusMd,borderBottom:`2px solid ${n.colors.border}`,borderLeft:`2px solid ${n.colors.border}`},"")})}),(0,g.FD)("div",{css:$n,children:[(0,g.FD)("div",{css:Vn,children:[(0,g.Y)(a.T.Text,{color:"secondary",css:(0,s.AH)({display:"inline-flex",alignItems:"center",height:48},""),children:(0,g.Y)(l.sA,{id:"SbMdmm",defaultMessage:"{spanName} was called",values:{spanName:(0,g.Y)(Ht,{node:e})}})}),(0,g.Y)("span",{onClick:()=>{v(e),x("detail"),y(!0)},children:(0,g.Y)(a.T.Text,{css:Pn,color:"secondary",children:I(e.end-e.start)})})]}),r&&(0,g.FD)("div",{children:[m&&(0,g.Y)(Kn,{node:e}),h&&(0,g.Y)(Ee,{sectionKey:"input",title:(0,g.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),children:(0,g.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingLeft:n.spacing.lg,marginBottom:f?0:n.spacing.sm},""),children:u.map((({key:e,value:n},s)=>(0,g.Y)(Ln,{title:e,data:n,renderMode:t},e||s)))})}),f&&(0,g.Y)(Ee,{sectionKey:"output",title:(0,g.Y)(l.sA,{id:"ZstVNI",defaultMessage:"Outputs"}),children:(0,g.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingLeft:n.spacing.lg,marginBottom:n.spacing.sm},""),children:p.map((({key:e,value:n})=>(0,g.Y)(Ln,{title:e,data:n,renderMode:t},e)))})})]})]})]})},Un=({rootNode:e,intermediateNodes:t})=>{const{theme:n}=(0,a.u)(),[r,d]=(0,o.useState)("default"),u=e.inputs,p=e.outputs,m=(0,c.bn)(e),h=t.length>0,f=m.length>0,v=(0,c.g_)(u),x=(0,c.g_)(p);return(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",flex:1,minHeight:0,padding:n.spacing.md,paddingTop:n.spacing.sm,overflow:"auto",minWidth:400},""),children:[(0,g.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",justifyContent:"flex-end",marginBottom:n.spacing.sm},""),children:(0,g.FD)("div",{css:(0,s.AH)({display:"flex",gap:n.spacing.sm},""),children:[(0,g.FD)(i.SegmentedControlGroup,{name:"render-mode",componentId:"shared.model-trace-explorer.summary-view.render-mode",value:r,size:"small",onChange:e=>d(e.target.value),children:[(0,g.Y)(i.SegmentedControlButton,{value:"default",children:(0,g.Y)(l.sA,{id:"uYkbr+",defaultMessage:"Default"})}),(0,g.Y)(i.SegmentedControlButton,{value:"json",children:(0,g.Y)(l.sA,{id:"XC1Pro",defaultMessage:"JSON"})})]}),(0,g.Y)(at,{})]})}),f&&(0,g.Y)(Kn,{node:e}),(0,g.Y)(Ee,{withBorder:!0,title:(0,g.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),css:(0,s.AH)({marginBottom:h?0:n.spacing.md},""),sectionKey:"summary-inputs",children:(0,g.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:v.map((({key:e,value:t},n)=>(0,g.Y)(Ln,{title:e,data:t,renderMode:r},e||n)))})}),h&&t.map((e=>(0,g.Y)(Wn,{node:e,renderMode:r},e.key))),(0,g.Y)(Ee,{withBorder:!0,title:(0,g.Y)(l.sA,{id:"ZstVNI",defaultMessage:"Outputs"}),sectionKey:"summary-outputs",children:(0,g.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:x.map((({key:e,value:t},n)=>(0,g.Y)(Ln,{title:e,data:t,renderMode:r},e||n)))})})]})},Jn=e=>{var t;return!!e.parentId&&([z.UG.AGENT,z.UG.RETRIEVER,z.UG.CHAT_MODEL,z.UG.TOOL,z.UG.LLM].includes(null!==(t=e.type)&&void 0!==t?t:z.UG.UNKNOWN)||(0,c.N7)(e)>0)},qn=({modelTrace:e})=>{const{theme:t}=(0,a.u)(),[n,r]=(0,o.useState)(500),{rootNode:c,nodeMap:d,assessmentsPaneEnabled:u,assessmentsPaneExpanded:p}=N(),m=(0,o.useMemo)((()=>Object.values(d).flatMap((e=>e.assessments))),[d]),h=(0,o.useMemo)((()=>{if(!c)return[];return k([c]).filter(Jn)}),[c]);return c?u&&p?(0,g.Y)(x,{initialRatio:.75,paneWidth:n,setPaneWidth:r,leftChild:(0,g.Y)(Un,{rootNode:c,intermediateNodes:h}),rightChild:(0,g.Y)(an,{assessments:m,traceId:c.traceId,activeSpanId:void 0}),leftMinWidth:400,rightMinWidth:dt}):(0,g.Y)(Un,{rootNode:c,intermediateNodes:h}):(0,g.Y)("div",{css:(0,s.AH)({marginTop:t.spacing.lg},""),children:(0,g.Y)(i.Empty,{description:(0,g.Y)(l.sA,{id:"hm98EL",defaultMessage:"No span data to display"})})})};var Gn=n(88464),Zn=n(88443);var Xn={name:"e0dnmk",styles:"cursor:pointer"};const Qn=({label:e,value:t,icon:n,tagKey:o,color:r="teal",getTruncatedLabel:l,getComponentId:c,onCopy:d})=>{const{theme:u}=(0,a.u)();return(0,g.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:u.spacing.sm},""),children:[(0,g.Y)(a.T.Text,{size:"md",color:"secondary",children:e}),(0,g.Y)(Ae.T,{componentId:c(o),content:t,maxWidth:400,children:(0,g.Y)(i.Tag,{componentId:c(o),color:r,onClick:()=>{navigator.clipboard.writeText(t),d()},css:Xn,children:(0,g.FD)("span",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",gap:u.spacing.xs},""),children:[n&&(0,g.Y)("span",{children:n}),(0,g.Y)("span",{children:l(t)})]})})})]})};var es={name:"7z0gr8",styles:"font-size:12px;display:flex;align-items:center;justify-content:center"},ts={name:"e0dnmk",styles:"cursor:pointer"};const ns=({modelTrace:e})=>{var t;(0,Gn.A)();const{theme:n}=(0,a.u)(),[r,l]=(0,o.useState)(!1),{rootNode:d}=N(),p=Object.entries(null!==(t=e.info.tags)&&void 0!==t?t:{}).filter((([e])=>{return!(t=e).startsWith("mlflow.")&&!t.startsWith("_mlflow_");var t})),m=(0,c.MF)(e),h=(0,o.useMemo)((()=>{var t,n,s;return(e=>{try{return JSON.parse(e)}catch(t){return}})(null!==(t=null===(n=e.info)||void 0===n||null===(s=n.trace_metadata)||void 0===s?void 0:s["mlflow.trace.tokenUsage"])&&void 0!==t?t:"{}")}),[e.info]),f=(0,o.useMemo)((()=>null===h||void 0===h?void 0:h.total_tokens),[h]),v=(0,o.useMemo)((()=>{if(d)return I(d.end-d.start)}),[d]),x=(0,o.useCallback)((e=>`mlflow.model_trace_explorer.header_details.tag-${e}`),[]),y=e=>((e,t)=>{const n=u().truncate(e,{length:t});return u().takeWhile(n,(e=>"\n"!==e)).join("")})(e,40),Y=(0,o.useCallback)((()=>{l(!0),setTimeout((()=>l(!1)),2e3)}),[]);return(0,g.FD)(g.FK,{children:[(0,g.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:n.spacing.md,flexWrap:"wrap"},""),children:[m&&(0,g.Y)(Qn,{label:(0,g.Y)(Zn.A,{id:"imKpxw",defaultMessage:"ID"}),value:m,tagKey:m,color:"pink",getTruncatedLabel:y,getComponentId:x,onCopy:Y}),f&&(0,g.Y)(Qn,{label:(0,g.Y)(Zn.A,{id:"zp4MBw",defaultMessage:"Token count"}),value:f.toString(),tagKey:"token-count",color:"default",getTruncatedLabel:y,getComponentId:x,onCopy:Y}),v&&(0,g.Y)(Qn,{label:(0,g.Y)(Zn.A,{id:"K1JLVU",defaultMessage:"Latency"}),icon:(0,g.Y)(b.C,{css:es}),value:v,tagKey:"latency",color:"default",getTruncatedLabel:y,getComponentId:x,onCopy:Y}),p.length>0&&(0,g.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:n.spacing.sm},""),children:[(0,g.Y)(a.T.Text,{size:"md",color:"secondary",children:(0,g.Y)(Zn.A,{id:"7KPJii",defaultMessage:"Tags"})}),(0,g.Y)(i.Overflow,{noMargin:!0,children:p.map((([e,t])=>{const n=`${e}-${t}`,s=`${e}: ${t}`;return(0,g.Y)(Ae.T,{componentId:x(n),content:s,children:(0,g.Y)(i.Tag,{componentId:x(n),color:"teal",onClick:()=>{var e;e=s,navigator.clipboard.writeText(e),Y()},css:ts,children:y(`${e}: ${t}`)})},e)}))})]})]}),r&&(0,g.FD)(i.Notification.Provider,{children:[(0,g.Y)(i.Notification.Root,{severity:"success",componentId:"mlflow.model_trace_explorer.header_details.notification",children:(0,g.Y)(i.Notification.Title,{children:(0,g.Y)(Zn.A,{id:"xgypqc",defaultMessage:"Copied to clipboard"})})}),(0,g.Y)(i.Notification.Viewport,{})]})]})};var ss={name:"lve99z",styles:"& > div:nth-of-type(2){margin-bottom:0;flex-shrink:0;}display:flex;flex-direction:column;height:100%;overflow:hidden"},os={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"},rs={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"};const as=({modelTrace:e,className:t,selectedSpanId:n,onSelectSpan:o})=>{const{theme:r}=(0,a.u)(),{activeView:c,setActiveView:d}=N();return(0,g.FD)(i.Tabs.Root,{componentId:"model-trace-explorer",value:c,onValueChange:e=>d(e),css:ss,children:[(0,g.Y)("div",{css:(0,s.AH)({paddingLeft:r.spacing.md,paddingBottom:r.spacing.sm},""),children:(0,g.Y)(ns,{modelTrace:e})}),(0,g.FD)(i.Tabs.List,{css:(0,s.AH)({paddingLeft:r.spacing.md,flexShrink:0},""),children:[(0,g.Y)(i.Tabs.Trigger,{value:"summary",children:(0,g.Y)(l.sA,{id:"paolVF",defaultMessage:"Summary"})}),(0,g.Y)(i.Tabs.Trigger,{value:"detail",children:(0,g.Y)(l.sA,{id:"Wh+aKq",defaultMessage:"Details & Timeline"})})]}),(0,g.Y)(i.Tabs.Content,{value:"summary",css:os,children:(0,g.Y)(qn,{modelTrace:e})}),(0,g.Y)(i.Tabs.Content,{value:"detail",css:rs,children:(0,g.Y)(Rn,{modelTrace:e,className:t,selectedSpanId:n,onSelectSpan:o})})]})},is=({children:e})=>(0,g.Y)(r.tH,{fallbackRender:_n,children:e}),ls=({modelTrace:e,className:t,initialActiveView:n="summary",selectedSpanId:s,onSelectSpan:r})=>{var a;const[i,l]=(0,o.useState)(e),[d,u]=(0,o.useState)(!1),p=(0,c.MF)(e),[m,h]=(a=(0,c.ob)(e),(0,o.useState)(p.startsWith("tr-")));return zn({traceId:p,setModelTrace:l,setAssessmentsPaneEnabled:h,enabled:p.startsWith("tr-")}),(0,o.useEffect)((()=>{l(e)}),[p]),(0,g.Y)(is,{traceId:p,children:(0,g.Y)(R,{modelTrace:i,initialActiveView:n,selectedSpanIdOnRender:s,assessmentsPaneEnabled:m,children:(0,g.Y)(as,{modelTrace:i,className:t,selectedSpanId:s,onSelectSpan:r})})})}},48128:function(e,t,n){n.d(t,{L:function(){return c}});var s=n(31014),o=n(96950),r=n(48443),a=n(68048),i=n(7450),l=n(50111);function c(e,t,n){const c=(0,i.tz)(),d=t||c.formatMessage({id:"hBAhI8",defaultMessage:"Copy"}),u=c.formatMessage({id:"g4hHzO",defaultMessage:"Copied"}),p=(0,o.useClipboard)(),m=(0,s.useRef)(),[g,h]=(0,s.useState)(!1),[f,v]=(0,s.useState)(!1);(0,s.useEffect)((()=>()=>{window.clearTimeout(m.current)}),[]);return{actionIcon:g?(0,l.Y)(r.C,{}):(0,l.Y)(a.CopyIcon,{}),tooltipMessage:g?u:d,copy:()=>{p.copy(e),window.clearTimeout(m.current),h(!0),null===n||void 0===n||n(),m.current=window.setTimeout((()=>{h(!1)}),3e3)},copied:g,ariaLabel:d,tooltipOpen:f||g,handleTooltipOpenChange:v}}},50211:function(e,t){t.A={'code[class*="language-"]':{textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",wordWrap:"normal",color:"rgb(77, 77, 76)",background:"#fafafa",fontFamily:"Monaco, Menlo, Ubuntu Mono, Consolas, source-code-pro, monospace",fontSize:"12px",lineHeight:"1.5em",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none"},'pre[class*="language-"]':{textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",wordWrap:"normal",color:"rgb(77, 77, 76)",background:"#fafafa",fontFamily:"Monaco, Menlo, Ubuntu Mono, Consolas, source-code-pro, monospace",fontSize:"12px",lineHeight:"1.5em",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none",overflow:"auto",position:"relative",margin:"0.5em 0",padding:"1.25em 1em"},'code[class*="language-"]::-moz-selection':{background:"#cceae7",color:"#263238"},'pre[class*="language-"]::-moz-selection':{background:"#cceae7",color:"#263238"},'code[class*="language-"] ::-moz-selection':{background:"#cceae7",color:"#263238"},'pre[class*="language-"] ::-moz-selection':{background:"#cceae7",color:"#263238"},'code[class*="language-"]::selection':{background:"#cceae7",color:"#263238"},'pre[class*="language-"]::selection':{background:"#cceae7",color:"#263238"},'code[class*="language-"] ::selection':{background:"#cceae7",color:"#263238"},'pre[class*="language-"] ::selection':{background:"#cceae7",color:"#263238"},':not(pre) > code[class*="language-"]':{whiteSpace:"normal",borderRadius:"0.2em",padding:"0.1em"},".language-css > code":{color:"#f5871f"},".language-sass > code":{color:"#f5871f"},".language-scss > code":{color:"#f5871f"},'[class*="language-"] .namespace':{Opacity:"0.7"},atrule:{color:"#7c4dff"},"attr-name":{color:"#39adb5"},"attr-value":{color:"#f6a434"},attribute:{color:"#f6a434"},boolean:{color:"#7c4dff"},builtin:{color:"#39adb5"},cdata:{color:"#39adb5"},char:{color:"#39adb5"},class:{color:"#39adb5"},"class-name":{color:"#6182b8"},comment:{color:"#8e908c"},constant:{color:"#7c4dff"},deleted:{color:"#e53935"},doctype:{color:"#aabfc9"},entity:{color:"#e53935"},function:{color:"#4271ae"},hexcode:{color:"#f5871f"},id:{color:"#7c4dff",fontWeight:"bold"},important:{color:"#7c4dff",fontWeight:"bold"},inserted:{color:"#39adb5"},keyword:{color:"#8959a8"},number:{color:"#f5871f"},operator:{color:"#3e999f"},prolog:{color:"#aabfc9"},property:{color:"#39adb5"},"pseudo-class":{color:"#f6a434"},"pseudo-element":{color:"#f6a434"},punctuation:{color:"rgb(77, 77, 76)"},regex:{color:"#6182b8"},selector:{color:"#e53935"},string:{color:"#3ba85f"},symbol:{color:"#7c4dff"},tag:{color:"#e53935"},unit:{color:"#f5871f"},url:{color:"#e53935"},variable:{color:"#c72d4c"}}},80001:function(e,t,n){n.d(t,{I:function(){return l},a:function(){return c}});var s=n(31014),o=n(9133),r=n(1644);var a=n(50111);const i=(0,s.createContext)({schemas:[]}),l=({children:e,assessments:t})=>{const n=(0,s.useMemo)((()=>(e=>{const t={},n={};for(const s of e){if(t[s.assessment_name])continue;const e=(0,r.e)(s);if((0,o.isNil)(e)){n[s.assessment_name]={name:s.assessment_name,assessmentType:"feedback"in s?"feedback":"expectation",dataType:"boolean"};continue}const a="expectation"in s&&"serialized_value"in s.expectation;let i;switch(typeof e){case"string":i=a?"json":"string";break;case"boolean":default:i="boolean";break;case"number":i="number"}t[s.assessment_name]={name:s.assessment_name,assessmentType:"feedback"in s?"feedback":"expectation",dataType:i}}for(const[s,o]of Object.entries(n))s in t||(t[s]=o);return Object.values(t)})(t)),[t]),l=(0,s.useMemo)((()=>({schemas:n})),[n]);return(0,a.Y)(i.Provider,{value:l,children:e})},c=()=>(0,s.useContext)(i)},86494:function(e,t,n){n.d(t,{P:function(){return c}});var s=n(89555),o=n(16934),r=n(68048),a=n(39330),i=n(48563),l=n(50111);const c=({type:e=i.Dy.CONNECT,isInTooltip:t=!1,hasException:n=!1,isRootSpan:c=!1})=>{const{theme:d}=(0,o.u)();let u;c?u="ai":n&&(u="danger");const p={[i.Dy.MODELS]:(0,l.Y)(r.ModelsIcon,{color:u}),[i.Dy.DOCUMENT]:(0,l.Y)(r.FileDocumentIcon,{color:u}),[i.Dy.CONNECT]:(0,l.Y)(r.ConnectIcon,{color:u}),[i.Dy.CODE]:(0,l.Y)(r.CodeIcon,{color:u}),[i.Dy.FUNCTION]:(0,l.Y)(r.FunctionIcon,{color:u}),[i.Dy.NUMBERS]:(0,l.Y)(r.NumbersIcon,{color:u}),[i.Dy.SEARCH]:(0,l.Y)(a.S,{color:u}),[i.Dy.SORT]:(0,l.Y)(r.SortUnsortedIcon,{color:u}),[i.Dy.UNKNOWN]:(0,l.Y)(r.QuestionMarkIcon,{color:u}),[i.Dy.WRENCH]:(0,l.Y)(r.WrenchIcon,{color:u}),[i.Dy.AGENT]:(0,l.Y)(r.UserSparkleIcon,{color:u}),[i.Dy.CHAIN]:(0,l.Y)(r.ChainIcon,{color:u}),[i.Dy.USER]:(0,l.Y)(r.UserIcon,{color:u}),[i.Dy.SYSTEM]:(0,l.Y)(r.GearIcon,{color:u}),[i.Dy.SAVE]:(0,l.Y)(r.SaveIcon,{color:u})};let m=d.colors.actionDefaultIconDefault,g=d.colors.actionPrimaryIcon,h=d.colors.backgroundSecondary;switch(e){case i.Dy.SEARCH:m=d.colors.textValidationSuccess,g=d.colors.green500,h=d.isDarkMode?d.colors.green800:d.colors.green100;break;case i.Dy.MODELS:m=d.isDarkMode?d.colors.blue500:d.colors.turquoise,g=d.isDarkMode?d.colors.turquoise:d.colors.blue500,h=d.isDarkMode?d.colors.blue800:d.colors.blue100;break;case i.Dy.WRENCH:m=d.isDarkMode?d.colors.red500:d.colors.red700,g=d.isDarkMode?d.colors.red700:d.colors.red500,h=d.isDarkMode?d.colors.red800:d.colors.red100}return(0,l.FD)("div",{css:(0,s.AH)({position:"relative",width:d.general.iconSize,height:d.general.iconSize,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:d.borders.borderRadiusSm,background:t?d.colors.tooltipBackgroundTooltip:h,color:t?g:m,svg:{width:d.general.iconFontSize,height:d.general.iconFontSize},flexShrink:0},""),children:[n&&(0,l.Y)("div",{css:(0,s.AH)({position:"absolute",top:-d.spacing.xs,right:-d.spacing.xs,height:d.spacing.sm,width:d.spacing.sm,borderRadius:d.borders.borderRadiusSm,backgroundColor:d.colors.actionDangerPrimaryBackgroundDefault,zIndex:5},"")}),p[e]]})}},96121:function(e,t,n){n.d(t,{KF:function(){return c},pL:function(){return d},nW:function(){return h},u6:function(){return f},Yv:function(){return b},f1:function(){return Y},iU:function(){return X},Pn:function(){return Q},DE:function(){return T},Sy:function(){return M},HD:function(){return V},oI:function(){return W},Hy:function(){return Z},W3:function(){return G},xW:function(){return z},m$:function(){return B},a8:function(){return k},bS:function(){return D},AG:function(){return H},n_:function(){return R}});var s=n(9133),o=n(46932);const r=e=>{if((0,s.isNil)(e))return!1;if((0,s.has)(e,"type")){if("text"===e.type&&(0,s.has)(e,"text")&&(0,s.isString)(e.text))return!0;if("image"===e.type&&(0,s.has)(e,"source")&&(0,s.has)(e.source,"type")){if("base64"===e.source.type&&(0,s.has)(e.source,"media_type")&&(0,s.isString)(e.source.media_type)&&["image/jpeg","image/png","image/gif","image/webp"].includes(e.source.media_type)&&(0,s.has)(e.source,"data")&&(0,s.isString)(e.source.data))return!0;if("url"===e.source.type&&(0,s.has)(e.source,"url")&&(0,s.isString)(e.source.url))return!0}if("tool_use"===e.type&&(0,s.has)(e,"id")&&(0,s.has)(e,"name")&&(0,s.has)(e,"input"))return(0,s.isString)(e.id)&&(0,s.isString)(e.name)&&(0,s.isObject)(e.input);if("tool_result"===e.type&&(0,s.has)(e,"tool_use_id")&&(0,s.has)(e,"content"))return(0,s.isString)(e.tool_use_id)&&(0,s.isString)(e.content)}return!1},a=e=>{if(!(0,s.isObject)(e))return!1;const t=(0,s.has)(e,"role")&&(0,s.isString)(e.role)&&["user","assistant"].includes(e.role),n="content"in e&&((0,s.isString)(e.content)||(0,s.isArray)(e.content)&&e.content.every(r));return t&&n},i=e=>{switch(e.type){case"text":return{type:"text",text:e.text};case"image":switch(e.source.type){case"base64":return{type:"image_url",image_url:{url:`data:${e.source.media_type};base64,${e.source.data}`}};case"url":return{type:"image_url",image_url:{url:e.source.url}}}}throw new Error(`Unsupported content block type: ${e.type}`)},l=e=>{const t=[];if("string"===typeof e.content){const n=(0,o.ZI)({type:"message",content:e.content,role:e.role});n&&t.push(n)}else{const{messages:n,textParts:s,toolCalls:r}=(e=>{const t=[],n=[],s=[];for(const o of e)"text"===o.type||"image"===o.type?n.push(i(o)):"tool_use"===o.type?s.push({id:o.id,function:{name:o.name,arguments:JSON.stringify(o.input)}}):"tool_result"===o.type&&t.push({role:"tool",tool_call_id:o.tool_use_id,content:o.content});return{messages:t,textParts:n,toolCalls:s}})(e.content);if(t.push(...n),s.length>0||r.length>0){const n=(0,o.ZI)({type:"message",content:s.length>0?s:void 0,role:e.role,...r.length>0&&{tool_calls:r}});n&&t.push(n)}}return t},c=e=>{if(!(0,s.isObject)(e))return null;if("messages"in e&&(0,s.isArray)(e.messages)&&e.messages.every(a)){const t=[];for(const n of e.messages)t.push(...l(n));return t}return null},d=e=>(0,s.isObject)(e)&&(0,s.has)(e,"type")&&"message"===e.type&&a(e)?l(e):null,u=e=>(0,s.isObject)(e)&&(0,s.isString)((0,s.get)(e,"id"))&&(0,s.isString)((0,s.get)(e,"name"))&&(0,s.isString)((0,s.get)(e,"arguments")),p=e=>{if(!(0,s.isObject)(e))return!1;const t=(0,s.get)(e,"type");if(t){if("SystemMessage"===t)return(0,s.isString)((0,s.get)(e,"content"));if("UserMessage"===t)return(0,s.has)(e,"content")&&(0,s.has)(e,"source");if("AssistantMessage"===t)return(0,s.has)(e,"content")&&(0,s.has)(e,"source");if("FunctionMessage"===t)return(0,s.has)(e,"content")&&(0,s.has)(e,"source")}return!(!(0,s.has)(e,"source")||!["system","user","assistant","function"].includes((0,s.get)(e,"source")))&&(0,s.has)(e,"content")},m=e=>(0,s.isString)(e)?(0,o.ZI)({type:"message",content:e,role:"assistant"}):(0,s.isArray)(e)&&e.every(u)?{role:"assistant",tool_calls:e.map((e=>(0,o.CL)({id:e.id,function:{name:e.name,arguments:e.arguments}})))}:null,g=e=>{if("SystemMessage"===e.type)return(0,o.ZI)({type:"message",content:e.content,role:"system"});if("UserMessage"===e.type){if((0,s.isString)(e.content))return(0,o.ZI)({type:"message",content:e.content,role:"user"});if((0,s.isArray)(e.content)){const t=e.content.filter((e=>(0,s.isString)(e)||(0,s.isObject)(e)&&"text"===e.type)).map((e=>(0,s.isString)(e)?{type:"text",text:e}:e));if(t.length>0)return(0,o.ZI)({type:"message",content:t,role:"user"})}}if("AssistantMessage"===e.type)return m(e.content);if("FunctionMessage"===e.type)return(0,o.ZI)({type:"message",content:JSON.stringify(e.content),role:"user"});if("system"===e.source)return(0,o.ZI)({type:"message",content:e.content,role:"system"});if("user"===e.source){if((0,s.isString)(e.content))return(0,o.ZI)({type:"message",content:e.content,role:"user"});if((0,s.isArray)(e.content)){const t=e.content.filter((e=>(0,s.isString)(e))).map((e=>({type:"text",text:e})));if(t.length>0)return(0,o.ZI)({type:"message",content:t,role:"user"})}}return"assistant"===e.source?m(e.content):"function"===e.source?(0,o.ZI)({type:"message",content:JSON.stringify(e.content),role:"user"}):null},h=e=>{if((0,s.isNil)(e))return null;if((0,s.isArray)(e)&&e.length>0&&e.every(p))return(0,s.compact)(e.map(g));if((0,s.isObject)(e)&&"messages"in e){const t=e.messages;if((0,s.isArray)(t)&&t.length>0&&t.every(p))return(0,s.compact)(t.map(g))}return null},f=e=>{if((0,s.isNil)(e))return null;if((0,s.isArray)(e)&&e.length>0&&e.every(p))return(0,s.compact)(e.map(g));if((0,s.isObject)(e)&&"content"in e){const t=(0,o.ZI)({role:"assistant",content:e.content,type:"message"});return t?[t]:null}return null},v=e=>{if(e.text)return{type:"text",text:e.text};if(e.json)return{type:"text",text:JSON.stringify(e.json)};if(e.image){const t=e.image.source.bytes,n=e.image.format;let s;if("string"===typeof t)s=t;else{s=Buffer.from(t).toString("base64")}return{type:"image_url",image_url:{url:`data:${`image/${n}`};base64,${s}`}}}return null},x=e=>{let t=e.role;const n=[],s=[];let r;for(const l of e.content)if(l.toolUse){const e=l.toolUse,t="string"===typeof e.input?e.input:JSON.stringify(e.input);s.push((0,o.CL)({id:e.toolUseId,function:{name:e.name,arguments:t}}))}else if(l.toolResult){r=l.toolResult.toolUseId,t="tool";for(const e of l.toolResult.content){const t=v(e);t&&n.push(t)}}else{const e=v(l);e&&n.push(e)}let a="";n.length>0&&(a=n.map((e=>"text"===e.type?e.text:"image_url"===e.type?`[Image: ${e.image_url.url}]`:"")).filter((e=>e.length>0)).join(" "));const i={role:t,content:a};return s.length>0&&(i.tool_calls=s),r&&(i.tool_call_id=r),i},y=e=>{if(!(0,s.isObject)(e))return!1;const t=(0,s.has)(e,"role")&&(0,s.isString)(e.role)&&["user","assistant","system"].includes(e.role),n=(0,s.has)(e,"content")&&(0,s.isArray)(e.content);return t&&n},b=e=>{if((0,s.isNil)(e))return null;if((0,s.isObject)(e)&&"messages"in e){const t=e.messages;if((0,s.isArray)(t)&&t.length>0&&t.every(y))return(0,s.compact)(t.map(x))}return null},Y=e=>{if((0,s.isNil)(e))return null;if((0,s.isObject)(e)&&"output"in e){const t=e.output;if((0,s.isObject)(t)&&"message"in t){const e=t.message;if(y(e))return[x(e)]}}return null},S=e=>(0,s.isObject)(e)&&"text"in e&&(0,s.isString)(e.text),A=e=>(0,s.isObject)(e)&&"role"in e&&(0,s.isString)(e.role)&&["user","model"].includes(e.role)&&(0,s.has)(e,"parts")&&Array.isArray(e.parts)&&e.parts.every(S),w=e=>(0,s.isObject)(e)&&"content"in e&&A(e.content),T=e=>{if(!(0,s.isObject)(e))return null;if("contents"in e){if((0,s.isString)(e.contents)){const t=(0,o.ZI)({type:"message",content:e.contents,role:"user"});return t&&[t]}if((0,s.isArray)(e.contents)&&e.contents.every(A))return(0,s.compact)(e.contents.map((e=>{const t="model"===e.role?"assistant":e.role;return(0,o.ZI)({type:"message",content:e.parts.map((e=>({type:"text",text:e.text}))),role:t})})))}return null},M=e=>(0,s.isObject)(e)&&"candidates"in e&&(0,s.isArray)(e.candidates)&&e.candidates.every(w)?(0,s.compact)(e.candidates.flatMap((e=>e.content)).map((e=>{const t="model"===e.role?"assistant":e.role;return(0,o.ZI)({type:"message",content:e.parts.map((e=>({type:"text",text:e.text}))),role:t})}))):null,k=e=>{var t;if(!e)return null;const n=null!==(t=e.messages)&&void 0!==t?t:e.input;return Array.isArray(n)&&0!==n.length&&n.every(o.I$)?(0,s.compact)(n.map(o.ZI)):null},D=e=>(0,o.x0)(e)?e.map((e=>{var t;return{...e.message,tool_calls:null===(t=e.message.tool_calls)||void 0===t?void 0:t.map(o.CL)}})):(0,o.in)(e)?e.choices.map((e=>{var t;return{...e.message,tool_calls:null===(t=e.message.tool_calls)||void 0===t?void 0:t.map(o.CL)}})):null,I=e=>!!((0,s.has)(e,"role")&&(0,s.has)(e,"content")&&["user","assistant","system","developer"].includes(e.role))&&((0,s.isString)(e.content)||(0,s.isArray)(e.content)&&e.content.every((e=>(0,s.has)(e,"type")&&["input_text","input_image","input_file"].includes(e.type)))),C=e=>{if(!(0,s.isObject)(e))return!1;if("message"===(0,s.get)(e,"type"))return(0,o.I$)(e);if("function_call"===(0,s.get)(e,"type"))return(0,s.isString)((0,s.get)(e,"call_id"))&&(0,s.isString)((0,s.get)(e,"name"))&&(0,s.isString)((0,s.get)(e,"arguments"));if("function_call_output"===(0,s.get)(e,"type"))return(0,s.isString)((0,s.get)(e,"call_id"))&&(0,s.isString)((0,s.get)(e,"output"));if("image_generation_call"===(0,s.get)(e,"type")){const t=(0,s.get)(e,"output_format");return(0,s.isString)((0,s.get)(e,"result"))&&(0,s.isString)(t)&&["png","jpeg","webp"].includes(t)}return"reasoning"===(0,s.get)(e,"type")&&((0,s.has)(e,"id")&&(0,s.isArray)((0,s.get)(e,"summary")))},F=e=>{if((0,s.isString)(e.content)){const t=(0,o.ZI)({type:"message",content:e.content,role:e.role});return t&&[t]}return e.content.map((t=>((e,t)=>{const n=(0,s.get)(e,"text");if("input_text"===(0,s.get)(e,"type")&&(0,s.isString)(n))return(0,o.ZI)({type:"message",content:[{type:"text",text:n}],role:t});const r=(0,s.get)(e,"image_url");return"input_image"===(0,s.get)(e,"type")&&(0,s.isString)(r)?(0,o.ZI)({type:"message",content:[{type:"image_url",image_url:{url:r}}],role:t}):null})(t,e.role))).filter((e=>null!==e))},H=e=>{const t=(0,s.get)(e,"input");if((0,s.isString)(t)){const e=(0,o.ZI)({type:"message",content:t,role:"user"});return e&&[e]}return(0,s.isArray)(t)&&t.every(I)?(0,s.compact)(t.flatMap(F)):null},N=e=>"message"===e.type?(0,o.ZI)(e):"function_call"===e.type?{role:"assistant",tool_calls:[(0,o.CL)({id:e.call_id,function:{arguments:e.arguments,name:e.name}})]}:"function_call_output"===e.type?{role:"tool",tool_call_id:e.call_id,content:e.output}:"image_generation_call"===e.type?(0,o.ZI)({type:"message",content:[{type:"image_url",image_url:{url:`data:image/${e.output_format};base64,${e.result}`}}],role:"tool"}):(e.type,null),R=e=>{if((0,s.isNil)(e))return null;const t=(0,s.get)(e,"output");return(0,s.isArray)(t)&&t.length>0&&t.every(C)?(0,s.compact)(t.map(N).filter(Boolean)):(0,s.isArray)(t)&&t.length>0&&t.every((e=>"response.output_item.done"===e.type&&C(e.item)))?(0,s.compact)(t.map((e=>N(e.item)))):null},_=e=>!!(0,s.isObject)(e)&&(!!((0,s.has)(e,"role")&&(0,s.has)(e,"content")&&["user","assistant","system","tool"].includes(e.role))||("function_call"===(0,s.get)(e,"type")?(0,s.isString)((0,s.get)(e,"call_id"))&&(0,s.isString)((0,s.get)(e,"name"))&&(0,s.isString)((0,s.get)(e,"arguments")):"function_call_output"===(0,s.get)(e,"type")&&((0,s.isString)((0,s.get)(e,"call_id"))&&(0,s.isString)((0,s.get)(e,"output"))))),E=e=>{if((0,s.has)(e,"role")&&(0,s.has)(e,"content")){if((0,s.isArray)(e.content)){const t=e.content.filter((e=>"output_text"===e.type&&(0,s.isString)(e.text))).map((e=>e.text)).join(" ");if(t)return(0,o.ZI)({...e,content:t})}return(0,o.ZI)(e)}if("function_call"===(0,s.get)(e,"type")){const t=(0,s.get)(e,"call_id"),n=(0,s.get)(e,"arguments"),r=(0,s.get)(e,"name");if((0,s.isString)(t)&&(0,s.isString)(n)&&(0,s.isString)(r))return{role:"assistant",tool_calls:[(0,o.CL)({id:t,function:{arguments:n,name:r}})]}}if("function_call_output"===(0,s.get)(e,"type")){const t=(0,s.get)(e,"call_id"),n=(0,s.get)(e,"output");if((0,s.isString)(t)&&(0,s.isString)(n))return{role:"tool",tool_call_id:t,content:n}}return null},z=e=>(0,s.isNil)(e)?null:(0,s.isArray)(e)&&e.length>0&&e.every(_)?(0,s.compact)(e.map(E)):null,B=e=>(0,s.isNil)(e)?null:(0,s.isArray)(e)&&e.length>0&&e.every(_)?(0,s.compact)(e.map(E)):null,O=e=>{var t;let n,r;switch(e.type){case"user":case"human":n="user";break;case"assistant":case"ai":n="assistant";break;case"system":n="system";break;case"tool":n="tool";break;case"function":n="function";break;default:return null}if((0,s.isString)(e.content))r=e.content;else if(Array.isArray(e.content)){r=e.content.map((e=>{var t;return(0,s.isString)(e)?e:"text"===e.type&&e.text?e.text:"image_url"===e.type&&null!==(t=e.image_url)&&void 0!==t&&t.url?`![](${e.image_url.url})`:""})).filter(Boolean).join("\n\n")}else r=void 0;const a={content:r,role:n},i=e.tool_calls,l=null===(t=e.additional_kwargs)||void 0===t?void 0:t.tool_calls;return!(0,s.isNil)(i)&&Array.isArray(i)&&i.length>0&&i.every(K)?a.tool_calls=(0,s.compact)(i.map(j)):!(0,s.isNil)(l)&&Array.isArray(l)&&l.length>0&&l.every(o.h8)&&(a.tool_calls=l.map(o.CL)),(0,s.isNil)(e.tool_call_id)||(a.tool_call_id=e.tool_call_id),a},j=e=>({id:e.id,function:{arguments:JSON.stringify(e.args,null,2),name:e.name}}),L=e=>!!e&&(!!((0,s.isNil)(e.content)||(0,s.isString)(e.content)||Array.isArray(e.content))&&["human","user","assistant","ai","system","tool","function"].includes(e.type)),K=e=>e&&(0,s.isString)(e.name)&&(0,s.has)(e,"args")&&(0,s.isString)(e.id),$=e=>e&&L(e.message),V=e=>{if(Array.isArray(e)&&1===e.length&&Array.isArray(e[0])&&e[0].length>0&&e[0].every(L)){const t=e[0].map(O);return t.some((e=>null===e))?null:t}if(Array.isArray(null===e||void 0===e?void 0:e.messages)&&e.messages.length>0&&e.messages.every(L)){const t=e.messages.map(O);return t.some((e=>null===e))?null:t}if(Array.isArray(e)&&e.length>0&&e.every(L)){const t=e.map(O);return t.some((e=>null===e))?null:t}return null},P=e=>{const t=e.map((e=>O(e.message)));return t.some((e=>null===e))?null:t},W=e=>(e=>!(!Array.isArray(e)||e.length<1)&&!(!Array.isArray(e[0])||e[0].length<1)&&e[0].every($))(e)?P(e[0]):Array.isArray(null===e||void 0===e?void 0:e.generations)&&e.generations.length>0&&e.generations[0].every($)?P(e.generations[0]):null,U=e=>{const t=(0,s.get)(e,"text");return"text"===(0,s.get)(e,"block_type")&&(0,s.isString)(t)},J=e=>{const t=(0,s.get)(e,"blocks"),n=(0,s.get)(e,"role");return(0,s.isString)(n)&&["assistant","system","user"].includes(n)&&(0,s.isArray)(t)&&t.every(U)},q=e=>(0,o.ZI)({role:e.role,content:e.blocks.map((e=>({type:"text",text:e.text})))}),G=e=>{if(!(e=>J((0,s.get)(e,"message")))(e))return null;const t=q(e.message);return t&&[t]},Z=e=>(e=>{const t=(0,s.get)(e,"messages");return(0,s.isArray)(t)&&t.every(J)})(e)?(0,s.compact)(e.messages.map(q)):null,X=e=>{if((0,s.has)(e,"messages")&&(0,s.isArray)(e.messages)){return e.messages.map((e=>(0,o.ZI)({type:"message",content:e.content,role:e.role}))).filter(Boolean)}return null},Q=e=>{if((0,s.isArray)(e)&&e.length>0&&e.every(s.isString)){const t=e.join("\n"),n=(0,o.ZI)({type:"message",content:t,role:"assistant"});return n&&[n]}return null}}}]);
//# sourceMappingURL=2121.02d55e17.chunk.js.map