{"version":3,"file":"static/js/7816.b5c1abd2.chunk.js","mappings":"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","sources":["experiment-tracking/components/traces/hooks/useEditExperimentTraceTags.tsx","experiment-tracking/components/evaluations/hooks/useDeleteTraces.tsx","shared/web-shared/genai-traces-table/enum.ts","shared/web-shared/genai-traces-table/utils/EvaluationDataParseUtils.ts","shared/web-shared/genai-traces-table/components/GenAiEvaluationTracesReview.utils.tsx","shared/web-shared/genai-traces-table/utils/Colors.ts","shared/web-shared/genai-traces-table/utils/RoutingUtils.tsx","shared/web-shared/genai-traces-table/hooks/useAssessmentFilters.tsx","shared/web-shared/genai-traces-table/hooks/useTableSort.tsx","shared/web-shared/genai-traces-table/GenAITracesTableContext.tsx","shared/web-shared/genai-traces-table/components/GenAiDeleteTraceModal.tsx","shared/web-shared/genai-traces-table/utils/FeatureUtils.ts","shared/web-shared/genai-traces-table/types.ts","shared/web-shared/genai-traces-table/hooks/useTableColumns.tsx","shared/web-shared/genai-traces-table/utils/TraceUtils.ts","shared/web-shared/genai-traces-table/GenAITracesTableActions.tsx","shared/web-shared/genai-traces-table/GenAiTracesTable.utils.ts","shared/web-shared/genai-traces-table/cellRenderers/ErrorCell.tsx","shared/web-shared/genai-traces-table/cellRenderers/NullCell.tsx","shared/web-shared/genai-traces-table/cellRenderers/StackedComponents.tsx","shared/web-shared/genai-traces-table/utils/FetchUtils.ts","shared/web-shared/genai-traces-table/utils/MlflowUtils.tsx","shared/web-shared/genai-traces-table/cellRenderers/LoggedModelCell.tsx","shared/web-shared/genai-traces-table/cellRenderers/RunName.tsx","shared/web-shared/genai-traces-table/cellRenderers/Source/ExperimentSourceTypeIcon.tsx","shared/web-shared/genai-traces-table/cellRenderers/Source/SourceRenderer.tsx","shared/web-shared/genai-traces-table/cellRenderers/StatusRenderer.tsx","shared/web-shared/genai-traces-table/cellRenderers/Tags/KeyValueTagFullViewModal.tsx","shared/web-shared/genai-traces-table/cellRenderers/Tags/KeyValueTag.tsx","shared/web-shared/genai-traces-table/cellRenderers/Tags/TagsCellRenderer.tsx","shared/web-shared/genai-traces-table/cellRenderers/TokensCell.tsx","shared/web-shared/genai-traces-table/utils/AggregationUtils.ts","shared/web-shared/genai-traces-table/utils/DisplayUtils.tsx","shared/web-shared/genai-traces-table/utils/MarkdownUtils.tsx","shared/web-shared/genai-traces-table/components/EvaluationsReviewAssessmentTag.tsx","shared/web-shared/genai-traces-table/components/RunColorCircle.tsx","shared/web-shared/genai-traces-table/cellRenderers/rendererFunctions.tsx","shared/web-shared/genai-traces-table/GenAiTracesTableBody.utils.tsx","shared/web-shared/genai-traces-table/GenAiTracesTableBodyRows.tsx","shared/web-shared/genai-traces-table/components/EvaluationsRcaStats.tsx","shared/web-shared/genai-traces-table/components/EvaluationsAssessmentHoverCard.tsx","shared/web-shared/genai-traces-table/components/charts/CategoricalAggregateChart.tsx","shared/web-shared/genai-traces-table/components/charts/NumericAggregateChart.tsx","shared/web-shared/genai-traces-table/components/charts/AssessmentColumnSummary.tsx","shared/web-shared/genai-traces-table/GenAiTracesTableHeader.tsx","shared/web-shared/genai-traces-table/cellRenderers/HeaderCellRenderer.tsx","shared/web-shared/genai-traces-table/components/EvaluationsReviewAssessmentDetailedHistory.tsx","shared/web-shared/genai-traces-table/components/EvaluationsReviewAssessmentTooltip.tsx","shared/web-shared/genai-traces-table/components/EvaluationsReviewAssessmentUpsertForm.tsx","shared/web-shared/genai-traces-table/hooks/useEditAssessmentFormState.tsx","shared/web-shared/genai-traces-table/components/EvaluationsReviewAssessments.tsx","shared/web-shared/genai-traces-table/components/EvaluationsReviewAssessmentsConfirmButton.tsx","shared/web-shared/genai-traces-table/components/VerticalBar.tsx","shared/web-shared/genai-traces-table/components/EvaluationsReviewAssessmentsSection.tsx","shared/web-shared/genai-traces-table/components/EvaluationTraceDataDrawer.tsx","shared/web-shared/genai-traces-table/components/EvaluationsReviewHeaderSection.tsx","shared/web-shared/genai-traces-table/components/EvaluationsReviewCopyButton.tsx","shared/web-shared/genai-traces-table/components/EvaluationsReviewExpandableCell.tsx","shared/web-shared/genai-traces-table/components/EvaluationsReviewTextBox.tsx","shared/web-shared/genai-traces-table/components/EvaluationsReviewInputSection.tsx","shared/web-shared/genai-traces-table/components/EvaluationsReviewResponseSection.tsx","shared/web-shared/genai-traces-table/components/EvaluationsReviewListItemIndicator.tsx","shared/web-shared/genai-traces-table/components/EvaluationsReviewRetrievalSection.tsx","shared/web-shared/genai-traces-table/components/EvaluationsReviewDetails.tsx","shared/web-shared/genai-traces-table/hooks/usePendingAssessmentEntries.ts","shared/web-shared/genai-traces-table/components/GenAiEvaluationTracesReview.tsx","shared/web-shared/genai-traces-table/hooks/useGenAITracesTableConfig.tsx","shared/web-shared/genai-traces-table/hooks/useGetTrace.tsx","shared/web-shared/genai-traces-table/components/GenAiEvaluationTracesReviewModal.tsx","shared/web-shared/genai-traces-table/GenAiTracesTableBody.tsx","shared/web-shared/genai-traces-table/GenAiTracesTableSearchInput.tsx","shared/web-shared/genai-traces-table/utils/EvaluationLogging.ts","shared/web-shared/genai-traces-table/components/EvaluationsOverviewColumnSelector.tsx","shared/web-shared/genai-traces-table/components/EvaluationsOverviewSortDropdown.tsx","shared/web-shared/genai-traces-table/components/GenAiEvaluationBadge.tsx","shared/web-shared/genai-traces-table/hooks/useActiveEvaluation.tsx","shared/web-shared/genai-traces-table/hooks/useEvaluationsSearchQuery.tsx","shared/web-shared/genai-traces-table/utils/EvaluationsFilterUtils.ts","shared/web-shared/genai-traces-table/GenAITracesTable.tsx","shared/web-shared/genai-traces-table/hooks/useGenAiExperimentRunsForComparison.tsx","shared/web-shared/genai-traces-table/hooks/useGenAiTraceEvaluationArtifacts.tsx","shared/web-shared/genai-traces-table/hooks/useMlflowTraces.tsx","shared/web-shared/genai-traces-table/components/filters/TableFilterItemTypeahead.tsx","shared/web-shared/genai-traces-table/components/filters/TableFilterItemValueInput.tsx","shared/web-shared/genai-traces-table/hooks/useExperimentVersionsQuery.tsx","shared/web-shared/genai-traces-table/components/filters/TableFilterItem.tsx","shared/web-shared/genai-traces-table/GenAiTracesTableFilter.tsx","shared/web-shared/genai-traces-table/components/EvaluationsOverviewColumnSelectorGrouped.tsx","shared/web-shared/genai-traces-table/GenAITracesTableToolbar.tsx","shared/web-shared/genai-traces-table/GenAITracesTableBodyContainer.tsx","shared/web-shared/genai-traces-table/hooks/useFilters.tsx","shared/web-shared/genai-traces-table/hooks/useGenAITracesUIState.tsx","common/components/TagSelectDropdown.tsx","common/hooks/useEditKeyValueTagsModal.tsx","shared/web-shared/model-trace-explorer/ModelTraceExplorer.utils.tsx","shared/web-shared/model-trace-explorer/ModelTrace.types.ts","experiment-tracking/utils/TraceUtils.ts","shared/web-shared/hooks/useMediaQuery.ts","shared/web-shared/hooks/useResizeObserver.tsx","common/components/KeyValueTagFullViewModal.tsx","common/components/KeyValueTag.tsx"],"sourcesContent":["import { type ModelTraceInfo } from '@databricks/web-shared/model-trace-explorer';\nimport { useEditKeyValueTagsModal } from '../../../../common/hooks/useEditKeyValueTagsModal';\nimport { MlflowService } from '../../../sdk/MlflowService';\nimport type { KeyValueEntity } from '../../../../common/types';\nimport { useCallback } from 'react';\nimport { MLFLOW_INTERNAL_PREFIX } from '../../../../common/utils/TagUtils';\n\ntype EditedModelTrace = {\n  traceRequestId: string;\n  tags: KeyValueEntity[];\n};\n\nexport const useEditExperimentTraceTags = ({\n  onSuccess,\n  existingTagKeys = [],\n  useV3Apis,\n}: {\n  onSuccess?: () => void;\n  existingTagKeys?: string[];\n  useV3Apis?: boolean;\n}) => {\n  const { showEditTagsModal, EditTagsModal } = useEditKeyValueTagsModal<EditedModelTrace>({\n    saveTagsHandler: async (editedEntity, existingTags, newTags) => {\n      if (!editedEntity.traceRequestId) {\n        return;\n      }\n      const requestId = editedEntity.traceRequestId;\n      // First, determine new tags to be added\n      const addedOrModifiedTags = newTags.filter(\n        ({ key: newTagKey, value: newTagValue }) =>\n          !existingTags.some(\n            ({ key: existingTagKey, value: existingTagValue }) =>\n              existingTagKey === newTagKey && newTagValue === existingTagValue,\n          ),\n      );\n\n      // Next, determine those to be deleted\n      const deletedTags = existingTags.filter(\n        ({ key: existingTagKey }) => !newTags.some(({ key: newTagKey }) => existingTagKey === newTagKey),\n      );\n\n      // Fire all requests at once\n      const updateRequests = Promise.all([\n        ...addedOrModifiedTags.map(({ key, value }) =>\n          useV3Apis\n            ? MlflowService.setExperimentTraceTagV3(requestId, key, value)\n            : MlflowService.setExperimentTraceTag(requestId, key, value),\n        ),\n        ...deletedTags.map(({ key }) =>\n          useV3Apis\n            ? MlflowService.deleteExperimentTraceTagV3(requestId, key)\n            : MlflowService.deleteExperimentTraceTag(requestId, key),\n        ),\n      ]);\n\n      return updateRequests;\n    },\n    valueRequired: true,\n    allAvailableTags: existingTagKeys.filter((tagKey) => tagKey && !tagKey.startsWith(MLFLOW_INTERNAL_PREFIX)),\n    onSuccess: onSuccess,\n  });\n\n  const showEditTagsModalForTrace = useCallback(\n    (trace: ModelTraceInfo) => {\n      if (!trace.request_id) {\n        return;\n      }\n      const visibleTags = trace.tags?.filter(({ key }) => key && !key.startsWith(MLFLOW_INTERNAL_PREFIX)) || [];\n      showEditTagsModal({\n        traceRequestId: trace.request_id,\n        tags: visibleTags || [],\n      });\n    },\n    [showEditTagsModal],\n  );\n\n  return {\n    showEditTagsModalForTrace,\n    EditTagsModal,\n  };\n};\n","import { useMutation, useQueryClient } from '@databricks/web-shared/query-client';\nimport { MlflowService } from '../../../sdk/MlflowService';\nimport { invalidateMlflowSearchTracesCache } from '@databricks/web-shared/genai-traces-table';\n\nexport const useDeleteTracesMutation = () => {\n  const queryClient = useQueryClient();\n  const mutation = useMutation<{ traces_deleted: number }, Error, { experimentId: string; traceRequestIds: string[] }>({\n    mutationFn: async ({ experimentId, traceRequestIds }) => {\n      // Chunk the trace IDs into groups of 100\n      const chunks = [];\n      for (let i = 0; i < traceRequestIds.length; i += 100) {\n        chunks.push(traceRequestIds.slice(i, i + 100));\n      }\n\n      // Make parallel calls for each chunk\n      const deletePromises = chunks.map((chunk) => MlflowService.deleteTracesV3(experimentId, chunk));\n\n      const results = await Promise.all(deletePromises);\n\n      // Sum up the total traces deleted\n      const totalDeleted = results.reduce((sum, result) => sum + result.traces_deleted, 0);\n\n      return { traces_deleted: totalDeleted };\n    },\n    onSuccess: () => invalidateMlflowSearchTracesCache({ queryClient }),\n  });\n\n  return mutation;\n};\n","export enum GenAiTraceEvaluationArtifactFile {\n  Evaluations = '_evaluations.json',\n  Assessments = '_assessments.json',\n  Metrics = '_metrics.json',\n}\n\nexport enum KnownEvaluationResultAssessmentMetadataFields {\n  IS_OVERALL_ASSESSMENT = 'is_overall_assessment',\n  CHUNK_INDEX = 'chunk_index',\n  IS_COPIED_FROM_AI = 'is_copied_from_ai',\n}\n\nexport enum KnownEvaluationResultAssessmentName {\n  OVERALL_ASSESSMENT = 'overall_assessment',\n  SAFETY = 'safety',\n  GROUNDEDNESS = 'groundedness',\n  CORRECTNESS = 'correctness',\n  RELEVANCE_TO_QUERY = 'relevance_to_query',\n  CHUNK_RELEVANCE = 'chunk_relevance',\n  CONTEXT_SUFFICIENCY = 'context_sufficiency',\n  GUIDELINE_ADHERENCE = 'guideline_adherence',\n  GLOBAL_GUIDELINE_ADHERENCE = 'global_guideline_adherence',\n  TOTAL_TOKEN_COUNT = 'agent/total_token_count',\n  TOTAL_INPUT_TOKEN_COUNT = 'agent/total_input_token_count',\n  TOTAL_OUTPUT_TOKEN_COUNT = 'agent/total_output_token_count',\n  DOCUMENT_RECALL = 'retrieval/ground_truth/document_recall',\n  DOCUMENT_RATINGS = 'retrieval/ground_truth/document_ratings',\n}\n","import { difference, groupBy, isNil, isNumber, isPlainObject, orderBy, zipObject } from 'lodash';\n\nimport { KnownEvaluationResultAssessmentMetadataFields, KnownEvaluationResultAssessmentName } from '../enum';\nimport type {\n  EvaluationArtifactTableEntryAssessment,\n  EvaluationArtifactTableEntryEvaluation,\n  EvaluationArtifactTableEntryMetric,\n  RawGenaiEvaluationArtifactResponse,\n  RunEvaluationResultAssessment,\n  RunEvaluationResultMetric,\n  RunEvaluationTracesDataEntry,\n  RunEvaluationTracesRetrievalChunk,\n} from '../types';\n\nexport const isEvaluationResultOverallAssessment = (assessmentEntry: RunEvaluationResultAssessment) =>\n  assessmentEntry.metadata?.[KnownEvaluationResultAssessmentMetadataFields.IS_OVERALL_ASSESSMENT] === true;\n\nexport const isEvaluationResultPerRetrievalChunkAssessment = (assessmentEntry: RunEvaluationResultAssessment) =>\n  isNumber(assessmentEntry.metadata?.[KnownEvaluationResultAssessmentMetadataFields.CHUNK_INDEX]);\n\n/**\n * Checks if the given value is a retrieved context.\n * A retrieved context is a list of objects with a `doc_uri` and `content` field.\n */\nexport const isRetrievedContext = (value: any): boolean => {\n  return Array.isArray(value) && value.every((v) => isPlainObject(v) && 'doc_uri' in v && 'content' in v);\n};\n\n/**\n * Extracts the first retrieved context value from the given record.\n * Returns undefined if no retrieved context is found.\n */\nconst getFirstRetrievedContextValue = (\n  record?: Record<string, any>,\n): { doc_uri: string; content: string }[] | undefined => {\n  return Object.values(record || {}).find(isRetrievedContext) as { doc_uri: string; content: string }[];\n};\n\n/**\n * Extracts the retrieval chunks from the given outputs, targets and per-chunk assessments.\n */\nexport const extractRetrievalChunks = (\n  outputs?: Record<string, any>,\n  targets?: Record<string, any>,\n  perChunkAssessments?: RunEvaluationResultAssessment[],\n): RunEvaluationTracesRetrievalChunk[] => {\n  // Only support one retrieved context for now, first one is used\n  const retrievedContext = getFirstRetrievedContextValue(outputs) || [];\n  const expectedRetrievedContext = getFirstRetrievedContextValue(targets);\n\n  return retrievedContext.map((retrievedContext, index) => {\n    const target = expectedRetrievedContext?.[index];\n    const assessments = (perChunkAssessments || []).filter(\n      (assessment) => (assessment.metadata || {})[KnownEvaluationResultAssessmentMetadataFields.CHUNK_INDEX] === index,\n    );\n    // Group detailed assessments by name\n    const retrievalAssessmentsByName = groupBy(assessments, 'name');\n    // Ensure each group is sorted by timestamp in descending order\n    Object.keys(retrievalAssessmentsByName).forEach((key) => {\n      retrievalAssessmentsByName[key] = orderBy(retrievalAssessmentsByName[key], 'timestamp', 'desc');\n    });\n\n    return {\n      docUrl: retrievedContext.doc_uri,\n      content: retrievedContext.content,\n      retrievalAssessmentsByName: retrievalAssessmentsByName,\n      target: target?.content,\n    };\n  });\n};\n\nexport function parseRawTableArtifact<T>(artifactData?: RawGenaiEvaluationArtifactResponse): T | undefined {\n  if (!artifactData) {\n    return undefined;\n  }\n  const { columns, data, filename } = artifactData;\n\n  if (!columns || !Array.isArray(columns)) {\n    throw new SyntaxError(`Artifact ${filename} is malformed, it does not contain \"columns\" array`);\n  }\n  if (!data || !Array.isArray(data)) {\n    throw new SyntaxError(`Artifact ${filename} is malformed, it does not contain \"data\" array`);\n  }\n\n  const normalizedColumns = columns.map((column, index) => column ?? `column_${index}`);\n\n  return data.map((row) => zipObject(normalizedColumns, row)) as T;\n}\n\nexport function mergeMetricsAndAssessmentsWithEvaluations(\n  evaluations: EvaluationArtifactTableEntryEvaluation[],\n  metrics?: EvaluationArtifactTableEntryMetric[],\n  assessments?: EvaluationArtifactTableEntryAssessment[],\n): RunEvaluationTracesDataEntry[] {\n  // Group metrics by evaluation_id.\n  const metricsByEvaluation = (metrics || []).reduce<Record<string, Record<string, RunEvaluationResultMetric>>>(\n    (acc, entry: any) => {\n      if (!acc[entry.evaluation_id]) {\n        acc[entry.evaluation_id] = {};\n      }\n      const { key, value, timestamp } = entry;\n      acc[entry.evaluation_id][key] = { key, value, timestamp };\n      return acc;\n    },\n    {},\n  );\n\n  // Group assessments by evaluation_id.\n  const assessmentsByEvaluation = (assessments || []).reduce<Record<string, RunEvaluationResultAssessment[]>>(\n    (acc, entry: EvaluationArtifactTableEntryAssessment) => {\n      if (!acc[entry.evaluation_id]) {\n        acc[entry.evaluation_id] = [];\n      }\n      acc[entry.evaluation_id].push({\n        booleanValue: !isNil(entry.boolean_value) ? Boolean(entry.boolean_value) : entry.boolean_value,\n        numericValue: !isNil(entry.numeric_value) ? Number(entry.numeric_value) : entry.numeric_value,\n        stringValue: !isNil(entry.string_value) ? String(entry.string_value) : entry.string_value,\n        metadata: entry.metadata || {},\n        ...(entry.error_code && { errorCode: entry.error_code }),\n        ...(entry.error_message && { errorMessage: entry.error_message }),\n        name: entry.name,\n        rationale: entry.rationale || null,\n        source: {\n          metadata: entry.source?.metadata ?? {},\n          sourceId: entry.source?.source_id,\n          sourceType: entry.source?.source_type,\n        },\n        timestamp: entry.timestamp,\n      });\n      return acc;\n    },\n    {},\n  );\n\n  return evaluations.map((entry: any) => {\n    // Get all assessments for the evaluation and group them by name\n    const allAssessmentsSorted = orderBy(assessmentsByEvaluation[entry.evaluation_id] || [], 'timestamp', 'desc');\n    const overallAssessments: RunEvaluationResultAssessment[] = allAssessmentsSorted\n      .filter(isEvaluationResultOverallAssessment)\n      .map((assessment) => {\n        // Find the \"[assessment_name]\" prefix and convert it to the rootCauseAssessment, removing it from the prefix.\n        // The format is: \"[assessment_name] rationale **Suggested Actions**: suggestedActions\"\n        const match = assessment.rationale?.match(/^\\[(.*?)\\](.*?)(?:\\*\\*Suggested Actions\\*\\*:(.*))?$/s);\n\n        const assessmentName = match ? match[1]?.trim() : undefined;\n        const newRationale = match ? match[2]?.trim() : undefined;\n        const suggestedActions = match ? match[3]?.trim() : undefined;\n\n        assessment.rationale = newRationale || assessment.rationale;\n        const result: RunEvaluationResultAssessment = {\n          ...assessment,\n          rootCauseAssessment: !isNil(assessmentName) ? { assessmentName, suggestedActions } : undefined,\n        };\n        return result;\n      });\n    if (overallAssessments.length === 0) {\n      // In the special case where there is no overall assessment, we create a null here so the UI can render it.\n      overallAssessments.push({\n        name: KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT,\n        rationale: null,\n        source: {\n          sourceType: 'AI_JUDGE',\n          sourceId: 'UNKNOWN',\n          metadata: {},\n        },\n        metadata: {},\n        numericValue: null,\n        booleanValue: null,\n        stringValue: null,\n        timestamp: null,\n      });\n    }\n    // TODO(nsthorat): perRetrievalChunkAsessments should be treated differently than other methods, and removed from the overall metrics.\n    const perRetrievalChunkAssessments = allAssessmentsSorted.filter(isEvaluationResultPerRetrievalChunkAssessment);\n\n    // All assessments that are not overall or per retrieval chunk are response assessments\n    const responseAssessments = difference(allAssessmentsSorted, overallAssessments, perRetrievalChunkAssessments);\n\n    // Group response assessments by name\n    const responseAssessmentsByName = groupBy(responseAssessments, 'name');\n    // Ensure each group is sorted by timestamp in descending order\n    Object.keys(responseAssessmentsByName).forEach((key) => {\n      responseAssessmentsByName[key] = orderBy(responseAssessmentsByName[key], 'timestamp', 'desc');\n    });\n\n    return {\n      evaluationId: entry.evaluation_id,\n      requestId: entry.request_id,\n      inputs: entry.inputs,\n      inputsId: entry.inputs_id,\n      outputs: entry.outputs ?? {},\n      targets: entry.targets ?? {},\n      ...(entry.error_code && { errorCode: entry.error_code }),\n      ...(entry.error_message && { errorMessage: entry.error_message }),\n      overallAssessments,\n      responseAssessmentsByName,\n      metrics: metricsByEvaluation[entry.evaluation_id] || {},\n      retrievalChunks: extractRetrievalChunks(entry.outputs, entry.targets, perRetrievalChunkAssessments),\n    };\n  });\n}\n","import { isNil, isNumber, isPlainObject, orderBy } from 'lodash';\n\nimport type { ThemeType } from '@databricks/design-system';\nimport { CheckCircleIcon, WarningIcon, XCircleIcon } from '@databricks/design-system';\nimport { defineMessage } from '@databricks/i18n';\nimport type { MessageDescriptor, IntlShape } from '@databricks/i18n';\nimport { getUser } from '@databricks/web-shared/global-settings';\n\nimport type {\n  AssessmentInfo,\n  AssessmentValueType,\n  RunEvaluationResultAssessment,\n  RunEvaluationResultAssessmentDraft,\n  RunEvaluationTracesDataEntry,\n} from '../types';\nimport { getEvaluationResultAssessmentBackgroundColor, getEvaluationResultIconColor } from '../utils/Colors';\n\nexport const INPUT_REQUEST_KEY = 'request';\nconst INPUT_MESSAGES_KEY = 'messages';\n\nexport enum KnownEvaluationResultAssessmentName {\n  OVERALL_ASSESSMENT = 'overall_assessment',\n  SAFETY = 'safety',\n  GROUNDEDNESS = 'groundedness',\n  RETRIEVAL_GROUNDEDNESS = 'retrieval_groundedness', // Updated name for groundedness\n  CORRECTNESS = 'correctness',\n  RELEVANCE_TO_QUERY = 'relevance_to_query',\n  CHUNK_RELEVANCE = 'chunk_relevance',\n  RETRIEVAL_RELEVANCE = 'retrieval_relevance', // Updated name for chunk relevance\n  CONTEXT_SUFFICIENCY = 'context_sufficiency',\n  RETRIEVAL_SUFFICIENCY = 'retrieval_sufficiency', // Updated name for context sufficiency\n  GUIDELINE_ADHERENCE = 'guideline_adherence',\n  GUIDELINES = 'guidelines', // Updated name for guideline adherence\n  GLOBAL_GUIDELINE_ADHERENCE = 'global_guideline_adherence',\n}\n\nexport const DEFAULT_ASSESSMENTS_SORT_ORDER: string[] = [\n  KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT,\n  // Correctness runs with GT, relevancy to query runs without it.\n  KnownEvaluationResultAssessmentName.CORRECTNESS,\n  KnownEvaluationResultAssessmentName.GLOBAL_GUIDELINE_ADHERENCE,\n  KnownEvaluationResultAssessmentName.GUIDELINE_ADHERENCE,\n  KnownEvaluationResultAssessmentName.GUIDELINES,\n  KnownEvaluationResultAssessmentName.RELEVANCE_TO_QUERY,\n  KnownEvaluationResultAssessmentName.CONTEXT_SUFFICIENCY,\n  KnownEvaluationResultAssessmentName.RETRIEVAL_SUFFICIENCY,\n  KnownEvaluationResultAssessmentName.CHUNK_RELEVANCE,\n  KnownEvaluationResultAssessmentName.RETRIEVAL_RELEVANCE,\n  KnownEvaluationResultAssessmentName.GROUNDEDNESS,\n  KnownEvaluationResultAssessmentName.RETRIEVAL_GROUNDEDNESS, // Updated name for groundedness\n  KnownEvaluationResultAssessmentName.SAFETY,\n];\n\nexport const getJudgeMetricsLink = (asessmentDocLink?: AssessmentLearnMoreLink) => {\n  // return OSS docs link\n  return 'https://mlflow.org/docs/latest/genai/eval-monitor/scorers/llm-judge/';\n};\n\nexport interface AssessmentLearnMoreLink {\n  basePath: string;\n  hash?: string;\n}\n\n/**\n * These will be converted to the links per-cloud:\n * https://learn.microsoft.com/en-us/azure/databricks/generative-ai/agent-evaluation/${hash}`\n * https://docs.databricks.com/en/generative-ai/agent-evaluation/${page}.html#${hash}\n */\nexport const ASSESSMENTS_DOC_LINKS: Record<string, AssessmentLearnMoreLink> = {\n  [KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT]: {\n    // TODO(nsthorat): Update this link to the overall deep link once it's available.\n    basePath: '/generative-ai/agent-evaluation/llm-judge-metrics',\n    hash: 'how-quality-is-assessed-by-llm-judges',\n  },\n  [KnownEvaluationResultAssessmentName.CORRECTNESS]: {\n    basePath: '/generative-ai/agent-evaluation/llm-judge-reference',\n    hash: 'correctness',\n  },\n  [KnownEvaluationResultAssessmentName.GROUNDEDNESS]: {\n    basePath: '/generative-ai/agent-evaluation/llm-judge-reference',\n    hash: 'groundedness',\n  },\n  [KnownEvaluationResultAssessmentName.RETRIEVAL_GROUNDEDNESS]: {\n    basePath: '/generative-ai/agent-evaluation/llm-judge-reference',\n    hash: 'groundedness',\n  },\n  [KnownEvaluationResultAssessmentName.RELEVANCE_TO_QUERY]: {\n    basePath: '/generative-ai/agent-evaluation/llm-judge-reference',\n    hash: 'answer-relevance',\n  },\n  [KnownEvaluationResultAssessmentName.SAFETY]: {\n    basePath: '/generative-ai/agent-evaluation/llm-judge-reference',\n    hash: 'safety',\n  },\n  [KnownEvaluationResultAssessmentName.CHUNK_RELEVANCE]: {\n    basePath: '/generative-ai/agent-evaluation/llm-judge-reference',\n    hash: 'chunk-relevance-precision',\n  },\n  [KnownEvaluationResultAssessmentName.RETRIEVAL_RELEVANCE]: {\n    basePath: '/generative-ai/agent-evaluation/llm-judge-reference',\n    hash: 'chunk-relevance-precision',\n  },\n  [KnownEvaluationResultAssessmentName.CONTEXT_SUFFICIENCY]: {\n    basePath: '/generative-ai/agent-evaluation/llm-judge-reference',\n    hash: 'context-sufficiency',\n  },\n  [KnownEvaluationResultAssessmentName.RETRIEVAL_SUFFICIENCY]: {\n    basePath: '/generative-ai/agent-evaluation/llm-judge-reference',\n    hash: 'context-sufficiency',\n  },\n  [KnownEvaluationResultAssessmentName.GUIDELINE_ADHERENCE]: {\n    basePath: '/generative-ai/agent-evaluation/llm-judge-reference',\n    hash: 'guideline-adherence',\n  },\n  [KnownEvaluationResultAssessmentName.GUIDELINES]: {\n    basePath: '/generative-ai/agent-evaluation/llm-judge-reference',\n    hash: 'guideline-adherence',\n  },\n};\n\nexport enum KnownEvaluationResultAssessmentStringValue {\n  YES = 'yes',\n  NO = 'no',\n  UNKNOWN = 'unknown',\n}\n\nexport function getAssessmentValueLabel(\n  intl: IntlShape,\n  theme: ThemeType,\n  assessmentInfo: AssessmentInfo,\n  value: AssessmentValueType,\n): { content: string; icon?: JSX.Element } {\n  if (assessmentInfo.dtype === 'pass-fail') {\n    if (value === KnownEvaluationResultAssessmentStringValue.YES) {\n      return {\n        content: intl.formatMessage({\n          defaultMessage: 'Pass',\n          description: 'Passing assessment label',\n        }),\n        icon: (\n          <span\n            css={{\n              color: `${getEvaluationResultIconColor(theme, assessmentInfo, {\n                stringValue: KnownEvaluationResultAssessmentStringValue.YES,\n              })} !important`,\n              svg: {\n                width: '12px',\n                height: '12px',\n              },\n            }}\n          >\n            <CheckCircleIcon\n              css={{\n                backgroundColor: getEvaluationResultAssessmentBackgroundColor(theme, assessmentInfo, {\n                  stringValue: KnownEvaluationResultAssessmentStringValue.YES,\n                }),\n                borderRadius: '50%',\n              }}\n            />\n          </span>\n        ),\n      };\n    } else if (value === KnownEvaluationResultAssessmentStringValue.NO) {\n      return {\n        content: intl.formatMessage({\n          defaultMessage: 'Fail',\n          description: 'Failing assessment label',\n        }),\n        icon: (\n          <span\n            css={{\n              color: `${getEvaluationResultIconColor(theme, assessmentInfo, {\n                stringValue: KnownEvaluationResultAssessmentStringValue.NO,\n              })} !important`,\n              svg: {\n                width: '12px',\n                height: '12px',\n              },\n            }}\n          >\n            <XCircleIcon\n              css={{\n                backgroundColor: getEvaluationResultAssessmentBackgroundColor(theme, assessmentInfo, {\n                  stringValue: KnownEvaluationResultAssessmentStringValue.NO,\n                }),\n                borderRadius: '50%',\n              }}\n            />\n          </span>\n        ),\n      };\n    } else {\n      return {\n        content: intl.formatMessage({\n          defaultMessage: 'Missing',\n          description: 'Missing assessment label',\n        }),\n        icon: (\n          <span\n            css={{\n              color: `${getEvaluationResultIconColor(theme, assessmentInfo, {\n                stringValue: KnownEvaluationResultAssessmentStringValue.UNKNOWN,\n              })} !important`,\n              svg: {\n                width: '12px',\n                height: '12px',\n              },\n            }}\n          >\n            <WarningIcon\n              css={{\n                backgroundColor: getEvaluationResultAssessmentBackgroundColor(theme, assessmentInfo, {\n                  stringValue: KnownEvaluationResultAssessmentStringValue.UNKNOWN,\n                }),\n                borderRadius: '50%',\n              }}\n            />\n          </span>\n        ),\n      };\n    }\n  } else if (assessmentInfo.dtype === 'boolean') {\n    if (value === true) {\n      return {\n        content: intl.formatMessage({\n          defaultMessage: 'True',\n          description: 'True assessment label',\n        }),\n      };\n    } else if (value === false) {\n      return {\n        content: intl.formatMessage({\n          defaultMessage: 'False',\n          description: 'False assessment label',\n        }),\n      };\n    } else {\n      return {\n        content: intl.formatMessage({\n          defaultMessage: 'null',\n          description: 'null assessment label',\n        }),\n      };\n    }\n  }\n  return {\n    content: `${value}`,\n  };\n}\n\nexport enum KnownEvaluationResultAssessmentMetadataFields {\n  IS_OVERALL_ASSESSMENT = 'is_overall_assessment',\n  CHUNK_INDEX = 'chunk_index',\n  IS_COPIED_FROM_AI = 'is_copied_from_ai',\n}\n\nexport const KnownEvaluationResultAssessmentOutputLabel: Record<string, MessageDescriptor> = {\n  response: defineMessage({\n    defaultMessage: 'Model output',\n    description: 'Evaluation review > Response section > model output > title',\n  }),\n};\n\nexport const EXPECTED_FACTS_FIELD_NAME = 'expected_facts';\n\nexport const KnownEvaluationResultAssessmentTargetLabel: Record<string, MessageDescriptor> = {\n  expected_response: defineMessage({\n    defaultMessage: 'Expected output',\n    description: 'Evaluation review > Response section > expected output > title',\n  }),\n  [EXPECTED_FACTS_FIELD_NAME]: defineMessage({\n    defaultMessage: 'Expected facts',\n    description: 'Evaluation review > Response section > expected facts > title',\n  }),\n};\n\nexport const KnownEvaluationResultAssessmentValueLabel: Record<string, MessageDescriptor> = {\n  [KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT]: defineMessage({\n    defaultMessage: 'Overall',\n    description: 'Evaluation results > known type of evaluation result assessment > overall assessment.',\n  }),\n  [KnownEvaluationResultAssessmentName.CORRECTNESS]: defineMessage({\n    defaultMessage: 'Correctness',\n    description:\n      'Evaluation results > known type of evaluation result assessment > correctness assessment. Used to indicate if the result is correct in context of LLMs evaluation. Label displayed if user provided custom value, e.g. \"Correctness: mostly yes, have gaps\"',\n  }),\n  [KnownEvaluationResultAssessmentName.GROUNDEDNESS]: defineMessage({\n    defaultMessage: 'Groundedness',\n    description:\n      'Evaluation results > known type of evaluation result assessment > groundedness assessment. Used to indicate if the result is grounded in context of LLMs evaluation. Label displayed if user provided custom value, e.g. \"Groundedness: moderately grounded\"',\n  }),\n  [KnownEvaluationResultAssessmentName.RETRIEVAL_GROUNDEDNESS]: defineMessage({\n    defaultMessage: 'Retrieval groundedness',\n    description:\n      'Evaluation results > known type of evaluation result assessment > retrieval groundedness assessment. Used to indicate if the result is grounded in context of LLMs evaluation. Label displayed if user provided custom value, e.g. \"Retrieval groundedness: moderately grounded\"',\n  }),\n  [KnownEvaluationResultAssessmentName.CONTEXT_SUFFICIENCY]: defineMessage({\n    defaultMessage: 'Context sufficiency',\n    description:\n      'Evaluation results > known type of evaluation result assessment > context sufficiency assessment. Used to indicate if the retrieved context is sufficient to generate the expected response. Label displayed if user provided custom value, e.g. \"Context Sufficiency: mostly sufficient\"',\n  }),\n  [KnownEvaluationResultAssessmentName.RETRIEVAL_SUFFICIENCY]: defineMessage({\n    defaultMessage: 'Retrieval sufficiency',\n    description:\n      'Evaluation results > known type of evaluation result assessment > retrieval sufficiency assessment. Used to indicate if the retrieved context is sufficient to generate the expected response. Label displayed if user provided custom value, e.g. \"Retrieval sufficiency: mostly sufficient\"',\n  }),\n  [KnownEvaluationResultAssessmentName.RELEVANCE_TO_QUERY]: defineMessage({\n    defaultMessage: 'Relevance',\n    description:\n      'Evaluation results > known type of evaluation result assessment > relevance assessment. Used to indicate if the result is relevant to query in context of LLMs evaluation. Label displayed if user provided custom value, e.g. \"Relevance: moderate\"',\n  }),\n  [KnownEvaluationResultAssessmentName.SAFETY]: defineMessage({\n    defaultMessage: 'Safety',\n    description:\n      'Evaluation results > known type of evaluation result assessment > safety assessment. Used to indicate if the result is safe in context of LLMs evaluation. Label displayed if user provided custom value, e.g. \"Safety: moderate\"',\n  }),\n  [KnownEvaluationResultAssessmentName.CHUNK_RELEVANCE]: defineMessage({\n    defaultMessage: 'Chunk relevance',\n    description:\n      'Evaluation results > known type of evaluation result assessment > chunk relevance assessment. Used to indicate if the result is relevant to source data chunk in context of LLMs evaluation. Label displayed if user provided custom value, e.g. \"Chunk relevance: moderate\"',\n  }),\n  [KnownEvaluationResultAssessmentName.RETRIEVAL_RELEVANCE]: defineMessage({\n    defaultMessage: 'Retrieval relevance',\n    description:\n      'Evaluation results > known type of evaluation result assessment > retrieval relevance assessment. Used to indicate if the result is relevant to source data chunk in context of LLMs evaluation. Label displayed if user provided custom value, e.g. \"Retrieval relevance: moderate\"',\n  }),\n  [KnownEvaluationResultAssessmentName.GUIDELINE_ADHERENCE]: defineMessage({\n    defaultMessage: 'Guideline adherence',\n    description:\n      'Evaluation results > known type of evaluation result assessment > guideline adherence assessment. Used to indicate if the result adheres to the guidelines in context of LLMs evaluation. Label displayed if user provided custom value, e.g. \"Guideline adherence: moderate\"',\n  }),\n  [KnownEvaluationResultAssessmentName.GUIDELINES]: defineMessage({\n    defaultMessage: 'Guidelines',\n    description:\n      'Evaluation results > known type of evaluation result assessment > guidelines assessment. Used to indicate if the result adheres to the guidelines in context of LLMs evaluation. Label displayed if user provided custom value, e.g. \"Guidelines: moderate\"',\n  }),\n  [KnownEvaluationResultAssessmentName.GLOBAL_GUIDELINE_ADHERENCE]: defineMessage({\n    defaultMessage: 'Global guideline adherence',\n    description:\n      'Evaluation results > known type of evaluation result assessment > global guideline adherence assessment. Used to indicate if the result adheres to the global guidelines in context of LLMs evaluation. Label displayed if user provided custom value, e.g. \"Global guideline adherence: moderate\"',\n  }),\n};\n\nexport const KnownEvaluationResultAssessmentValueMissingTooltip: Record<string, MessageDescriptor> = {\n  [KnownEvaluationResultAssessmentName.CORRECTNESS]: defineMessage({\n    defaultMessage:\n      'Correctness assessment is missing. This is likely because you have not provided an expected response (ground truth) or grading notes.',\n    description:\n      'Evaluation results > known type of evaluation result assessment > correctness assessment. Used to indicate if the result is correct in context of LLMs evaluation. Label displayed if user provided custom value, e.g. \"Correctness: mostly yes, have gaps\"',\n  }),\n  [KnownEvaluationResultAssessmentName.GROUNDEDNESS]: defineMessage({\n    defaultMessage:\n      'Groundedness assessment is missing. This is likely because your agent is not returning retrieved_context.',\n    description:\n      'Evaluation results > known type of evaluation result assessment > groundedness assessment. Used to indicate if the result is grounded in context of LLMs evaluation. Label displayed if user provided custom value, e.g. \"Groundedness: moderately grounded\"',\n  }),\n  [KnownEvaluationResultAssessmentName.RETRIEVAL_GROUNDEDNESS]: defineMessage({\n    defaultMessage:\n      'Retrieval Groundedness assessment is missing. This is likely because your agent is not returning retrieved_context.',\n    description:\n      'Evaluation results > known type of evaluation result assessment > retrieval groundedness assessment. Used to indicate if the result is grounded in context of LLMs evaluation. Label displayed if user provided custom value, e.g. \"Retrieval Groundedness: moderately grounded\"',\n  }),\n  [KnownEvaluationResultAssessmentName.CONTEXT_SUFFICIENCY]: defineMessage({\n    defaultMessage:\n      'Context sufficiency assessment is missing. This is likely because your agent is not returning retrieved_context.',\n    description:\n      'Evaluation results > known type of evaluation result assessment > context sufficiency assessment. Used to indicate if the retrieved context is sufficient to generate the expected response. Label displayed if user provided custom value, e.g. \"Context Sufficiency: mostly sufficient\"',\n  }),\n  [KnownEvaluationResultAssessmentName.RETRIEVAL_SUFFICIENCY]: defineMessage({\n    defaultMessage:\n      'Retrieval sufficiency assessment is missing. This is likely because your agent is not returning retrieved_context.',\n    description:\n      'Evaluation results > known type of evaluation result assessment > retrieval sufficiency assessment. Used to indicate if the retrieved context is sufficient to generate the expected response. Label displayed if user provided custom value, e.g. \"Retrieval sufficiency: mostly sufficient\"',\n  }),\n};\n\nexport const KnownEvaluationResultAssessmentValueDescription: Record<string, MessageDescriptor> = {\n  [KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT]: defineMessage({\n    defaultMessage: 'The overall assessment passes when all of the judges pass.',\n    description:\n      'Evaluation results > known type of evaluation result assessment > overall assessment > description of overall assessment',\n  }),\n  [KnownEvaluationResultAssessmentName.CORRECTNESS]: defineMessage({\n    defaultMessage:\n      \"The correctness LLM judge gives a binary evaluation and written rationale on whether the agent's generated response is factually accurate and semantically similar to the provided ground-truth response or grading notes.\",\n    description:\n      'Evaluation results > known type of evaluation result assessment > description of correctness assessment.',\n  }),\n  [KnownEvaluationResultAssessmentName.GROUNDEDNESS]: defineMessage({\n    defaultMessage:\n      \"The groundedness LLM judge returns a binary evaluation and written rationale on whether the generated response is factually consistent with the agent's retrieved context.\",\n    description: 'Evaluation results > known type of evaluation result assessment > description of groundedness judge.',\n  }),\n  [KnownEvaluationResultAssessmentName.RETRIEVAL_GROUNDEDNESS]: defineMessage({\n    defaultMessage:\n      \"The retrieval groundedness LLM judge returns a binary evaluation and written rationale on whether the generated response is factually consistent with the agent's retrieved context.\",\n    description:\n      'Evaluation results > known type of evaluation result assessment > description of retrieval groundedness judge.',\n  }),\n  [KnownEvaluationResultAssessmentName.RELEVANCE_TO_QUERY]: defineMessage({\n    defaultMessage:\n      'The relevance_to_query LLM judge determines whether the response is relevant to the input request.',\n    description: 'Evaluation results > known type of evaluation result assessment > description of relevance judge.',\n  }),\n  [KnownEvaluationResultAssessmentName.SAFETY]: defineMessage({\n    defaultMessage:\n      'The safety LLM judge returns a binary rating and a written rationale on whether the generated response has harmful or toxic content.',\n    description: 'Evaluation results > known type of evaluation result assessment > description of safety judge.',\n  }),\n  [KnownEvaluationResultAssessmentName.CHUNK_RELEVANCE]: defineMessage({\n    defaultMessage:\n      'The chunk-relevance-precision LLM judge determines whether the chunks returned by the retriever are relevant to the input request. Precision is calculated as the number of relevant chunks returned divided by the total number of chunks returned. For example, if the retriever returns four chunks, and the LLM judge determines that three of the four returned documents are relevant to the request, then llm_judged/chunk_relevance/precision is 0.75.',\n    description: 'Evaluation results > known type of evaluation result assessment > chunk relevance judge.',\n  }),\n  [KnownEvaluationResultAssessmentName.RETRIEVAL_RELEVANCE]: defineMessage({\n    defaultMessage:\n      'The retrieval-relevance LLM judge determines whether the chunks returned by the retriever are relevant to the input request. Precision is calculated as the number of relevant chunks returned divided by the total number of chunks returned. For example, if the retriever returns four chunks, and the LLM judge determines that three of the four returned documents are relevant to the request, then llm_judged/chunk_relevance/precision is 0.75.',\n    description: 'Evaluation results > known type of evaluation result assessment > retrieval relevance judge.',\n  }),\n  [KnownEvaluationResultAssessmentName.CONTEXT_SUFFICIENCY]: defineMessage({\n    defaultMessage:\n      'The context sufficiency LLM judge determines whether the retrieved context is sufficient to generate the expected response.',\n    description: 'Evaluation results > known type of evaluation result assessment > context sufficiency judge.',\n  }),\n  [KnownEvaluationResultAssessmentName.RETRIEVAL_SUFFICIENCY]: defineMessage({\n    defaultMessage:\n      'The retrieval sufficiency LLM judge determines whether the retrieved context is sufficient to generate the expected response.',\n    description: 'Evaluation results > known type of evaluation result assessment > retrieval sufficiency judge.',\n  }),\n  [KnownEvaluationResultAssessmentName.GUIDELINE_ADHERENCE]: defineMessage({\n    defaultMessage:\n      'The guideline adherence LLM judge determines whether the response adheres to the guidelines provided.',\n    description: 'Evaluation results > known type of evaluation result assessment > guideline adherence judge.',\n  }),\n  [KnownEvaluationResultAssessmentName.GUIDELINES]: defineMessage({\n    defaultMessage:\n      'The guidelines LLM judge determines whether the response adheres to the guidelines provided. All responses must adhere to guidelines.',\n    description: 'Evaluation results > known type of evaluation result assessment > guidelines judge.',\n  }),\n  [KnownEvaluationResultAssessmentName.GLOBAL_GUIDELINE_ADHERENCE]: defineMessage({\n    defaultMessage:\n      'The global guideline adherence LLM judge determines whether the response adheres to the global guidelines provided. All responses must adhere to global guidelines.',\n    description: 'Evaluation results > known type of evaluation result assessment > global guideline adherence judge.',\n  }),\n};\n\nexport const KnownEvaluationResultAssessmentValueMapping: Record<string, Record<string, MessageDescriptor>> = {\n  [KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT]: {\n    [KnownEvaluationResultAssessmentStringValue.YES]: defineMessage({\n      defaultMessage: 'Pass',\n      description:\n        'Evaluation results > overall assessment > pass value label. Displayed if evaluation result is overall considered as approved by LLM judge or human.',\n    }),\n    [KnownEvaluationResultAssessmentStringValue.NO]: defineMessage({\n      defaultMessage: 'Fail',\n      description:\n        'Evaluation results > overall assessment > fail value label. Displayed if evaluation result is overall considered as disapproved by LLM judge or human.',\n    }),\n  },\n  [KnownEvaluationResultAssessmentName.CHUNK_RELEVANCE]: {\n    [KnownEvaluationResultAssessmentStringValue.YES]: defineMessage({\n      defaultMessage: 'Relevant',\n      description:\n        'Evaluation results > chunk relevancy assessment > positive value label. Displayed if evaluation result is considered as relevant to the query.',\n    }),\n    [KnownEvaluationResultAssessmentStringValue.NO]: defineMessage({\n      defaultMessage: 'Irrelevant',\n      description:\n        'Evaluation results > chunk relevancy assessment > negative value label. Displayed if evaluation result is considered as irrelevant to the query.',\n    }),\n  },\n  [KnownEvaluationResultAssessmentName.RETRIEVAL_RELEVANCE]: {\n    [KnownEvaluationResultAssessmentStringValue.YES]: defineMessage({\n      defaultMessage: 'Relevant',\n      description:\n        'Evaluation results > retrieval relevancy assessment > positive value label. Displayed if evaluation result is considered as relevant to the query.',\n    }),\n    [KnownEvaluationResultAssessmentStringValue.NO]: defineMessage({\n      defaultMessage: 'Irrelevant',\n      description:\n        'Evaluation results > retrieval relevancy assessment > negative value label. Displayed if evaluation result is considered as irrelevant to the query.',\n    }),\n  },\n  [KnownEvaluationResultAssessmentName.CONTEXT_SUFFICIENCY]: {\n    [KnownEvaluationResultAssessmentStringValue.YES]: defineMessage({\n      defaultMessage: 'Context sufficient',\n      description:\n        'Evaluation results > context sufficiency assessment > positive value label. Displayed if retrieved context is sufficient to generate the expected response.',\n    }),\n    [KnownEvaluationResultAssessmentStringValue.NO]: defineMessage({\n      defaultMessage: 'Context insufficient',\n      description:\n        'Evaluation results > context sufficiency assessment > negative value label. Displayed if retrieved context is insufficient to generate the expected response.',\n    }),\n  },\n  [KnownEvaluationResultAssessmentName.RETRIEVAL_SUFFICIENCY]: {\n    [KnownEvaluationResultAssessmentStringValue.YES]: defineMessage({\n      defaultMessage: 'Sufficient',\n      description:\n        'Evaluation results > retrieval sufficiency assessment > positive value label. Displayed if retrieved context is sufficient to generate the expected response.',\n    }),\n    [KnownEvaluationResultAssessmentStringValue.NO]: defineMessage({\n      defaultMessage: 'Insufficient',\n      description:\n        'Evaluation results > retrieval sufficiency assessment > negative value label. Displayed if retrieved context is insufficient to generate the expected response.',\n    }),\n  },\n  [KnownEvaluationResultAssessmentName.RELEVANCE_TO_QUERY]: {\n    [KnownEvaluationResultAssessmentStringValue.YES]: defineMessage({\n      defaultMessage: 'Relevant',\n      description:\n        'Evaluation results > relevancy assessment > positive value label. Displayed if evaluation result is considered as irrelevant to the query.',\n    }),\n    [KnownEvaluationResultAssessmentStringValue.NO]: defineMessage({\n      defaultMessage: 'Irrelevant',\n      description:\n        'Evaluation results > relevancy assessment > negative value label. Displayed if evaluation result is considered as irrelevant to the query.',\n    }),\n  },\n  [KnownEvaluationResultAssessmentName.GROUNDEDNESS]: {\n    [KnownEvaluationResultAssessmentStringValue.YES]: defineMessage({\n      defaultMessage: 'Grounded',\n      description:\n        'Evaluation results > grounded assessment > positive value label. Displayed if evaluation result is considered as grounded.',\n    }),\n    [KnownEvaluationResultAssessmentStringValue.NO]: defineMessage({\n      defaultMessage: 'Not grounded',\n      description:\n        'Evaluation results > grounded assessment > negative value label. Displayed if evaluation result is considered as not grounded.',\n    }),\n  },\n  [KnownEvaluationResultAssessmentName.RETRIEVAL_GROUNDEDNESS]: {\n    [KnownEvaluationResultAssessmentStringValue.YES]: defineMessage({\n      defaultMessage: 'Grounded',\n      description:\n        'Evaluation results > retrieval grounded assessment > positive value label. Displayed if evaluation result is considered as grounded.',\n    }),\n    [KnownEvaluationResultAssessmentStringValue.NO]: defineMessage({\n      defaultMessage: 'Not grounded',\n      description:\n        'Evaluation results > retrieval grounded assessment > negative value label. Displayed if evaluation result is considered as not grounded.',\n    }),\n  },\n  [KnownEvaluationResultAssessmentName.CORRECTNESS]: {\n    [KnownEvaluationResultAssessmentStringValue.YES]: defineMessage({\n      defaultMessage: 'Correct',\n      description:\n        'Evaluation results > correctness assessment > positive value label. Displayed if evaluation result is considered as correct.',\n    }),\n    [KnownEvaluationResultAssessmentStringValue.NO]: defineMessage({\n      defaultMessage: 'Incorrect',\n      description:\n        'Evaluation results > correctness assessment > negative value label. Displayed if evaluation result is considered as incorrect.',\n    }),\n  },\n  [KnownEvaluationResultAssessmentName.SAFETY]: {\n    [KnownEvaluationResultAssessmentStringValue.YES]: defineMessage({\n      defaultMessage: 'Safe',\n      description:\n        'Evaluation results > safety assessment > positive value label. Displayed if evaluation result is considered as safe.',\n    }),\n    [KnownEvaluationResultAssessmentStringValue.NO]: defineMessage({\n      defaultMessage: 'Unsafe',\n      description:\n        'Evaluation results > safety assessment > negative value label. Displayed if evaluation result is considered as unsafe.',\n    }),\n  },\n  [KnownEvaluationResultAssessmentName.GUIDELINE_ADHERENCE]: {\n    [KnownEvaluationResultAssessmentStringValue.YES]: defineMessage({\n      defaultMessage: 'Adheres to guidelines',\n      description:\n        'Evaluation results > guideline adherence assessment > positive value label. Displayed if evaluation result adheres to the guidelines.',\n    }),\n    [KnownEvaluationResultAssessmentStringValue.NO]: defineMessage({\n      defaultMessage: 'Violates guidelines',\n      description:\n        'Evaluation results > guideline adherence assessment > negative value label. Displayed if evaluation result does not adhere to the guidelines.',\n    }),\n  },\n  [KnownEvaluationResultAssessmentName.GUIDELINES]: {\n    [KnownEvaluationResultAssessmentStringValue.YES]: defineMessage({\n      defaultMessage: 'Adheres to guidelines',\n      description:\n        'Evaluation results > guidelines assessment > positive value label. Displayed if evaluation result adheres to the guidelines.',\n    }),\n    [KnownEvaluationResultAssessmentStringValue.NO]: defineMessage({\n      defaultMessage: 'Violates guidelines',\n      description:\n        'Evaluation results > guidelines assessment > negative value label. Displayed if evaluation result does not adhere to the guidelines.',\n    }),\n  },\n  [KnownEvaluationResultAssessmentName.GLOBAL_GUIDELINE_ADHERENCE]: {\n    [KnownEvaluationResultAssessmentStringValue.YES]: defineMessage({\n      defaultMessage: 'Adheres to global guidelines',\n      description:\n        'Evaluation results > global guideline adherence assessment > positive value label. Displayed if evaluation result adheres to the global guidelines.',\n    }),\n    [KnownEvaluationResultAssessmentStringValue.NO]: defineMessage({\n      defaultMessage: 'Violates global guidelines',\n      description:\n        'Evaluation results > global guideline adherence assessment > negative value label. Displayed if evaluation result does not adhere to the global guidelines.',\n    }),\n  },\n};\n\nconst isAssessmentAiGenerated = (assessment: RunEvaluationResultAssessment) => {\n  return assessment?.source?.sourceType === 'AI_JUDGE';\n};\n\n/**\n * Returns the title for the given evaluation result.\n * If the evaluation has an input request, it will be used as the title. Otherwise, the evaluation ID will be used.\n * Stringifies the value if it's an object or an array.\n */\nexport const getEvaluationResultTitle = (evaluation: RunEvaluationTracesDataEntry): string => {\n  // Use the request as the title if defined.\n  let title = getEvaluationResultInputTitle(evaluation, INPUT_REQUEST_KEY);\n\n  if (isNil(title)) {\n    title = getEvaluationResultInputTitle(evaluation, INPUT_MESSAGES_KEY);\n  }\n\n  // If the title is still undefined, JSON-serialize the inputs.\n  if (isNil(title) && !isNil(evaluation.inputs) && Object.keys(evaluation.inputs).length > 0) {\n    title = stringifyValue(evaluation.inputs);\n  }\n\n  return title ?? evaluation.evaluationId;\n};\n\n/**\n * Returns the title for the given evaluation result and input key.\n * This is different than getEvaluationResultTitle in that it computes a title per input key. getEvaluationResultTitle returns a title for the\n * whole row (used in the header of an evaluation modal).\n */\nexport const getEvaluationResultInputTitle = (\n  evaluation: RunEvaluationTracesDataEntry,\n  inputKey: string,\n): string | undefined => {\n  if (!isNil(evaluation.inputsTitle)) {\n    return typeof evaluation.inputsTitle === 'string' ? evaluation.inputsTitle : JSON.stringify(evaluation.inputsTitle);\n  }\n  // Use the request as the title if defined.\n  let title: string | undefined = undefined;\n  // Use the last message content as the title if defined.\n  const input = evaluation.inputs[inputKey];\n  if (\n    isPlainObject(input) &&\n    !isNil(input[INPUT_MESSAGES_KEY]) &&\n    Array.isArray(input[INPUT_MESSAGES_KEY]) &&\n    !isNil(input[INPUT_MESSAGES_KEY][0]?.content)\n  ) {\n    title = input[INPUT_MESSAGES_KEY][input[INPUT_MESSAGES_KEY].length - 1]?.content;\n  } else if (!isNil(input) && Array.isArray(input) && !isNil(input[0]?.content)) {\n    // Try to parse OpenAI messages.\n    title = input[input.length - 1]?.content;\n  } else {\n    title = input ? stringifyValue(input) : undefined;\n  }\n\n  return title;\n};\n\nexport const isEvaluationResultOverallAssessment = (assessmentEntry: RunEvaluationResultAssessment) =>\n  assessmentEntry.metadata?.[KnownEvaluationResultAssessmentMetadataFields.IS_OVERALL_ASSESSMENT] === true;\n\nexport const isEvaluationResultPerRetrievalChunkAssessment = (assessmentEntry: RunEvaluationResultAssessment) =>\n  isNumber(assessmentEntry.metadata?.[KnownEvaluationResultAssessmentMetadataFields.CHUNK_INDEX]);\n\nexport const getEvaluationResultAssessmentValue = (\n  assessment: RunEvaluationResultAssessment,\n): AssessmentValueType | undefined => {\n  const value = assessment.stringValue ?? assessment.numericValue ?? assessment.booleanValue;\n  if (isNil(value)) {\n    return undefined;\n  }\n  return value;\n};\n\n/**\n * Add alpha channel to the given hex color.\n */\nexport function withAlpha(hexColor: string, opacity: number): string {\n  let color = hexColor;\n  const startsWithHash = color.startsWith('#');\n  if (startsWithHash) {\n    color = hexColor.slice(1);\n  }\n  const alpha = Math.round(Math.min(Math.max(opacity, 0), 1) * 255);\n  const hexAlpha = alpha.toString(16).toUpperCase();\n  return `${startsWithHash ? '#' : ''}${color}${hexAlpha}`;\n}\n\n/**\n * A list of known response assessment names, used to populate suggestions\n */\nexport const KnownEvaluationResponseAssessmentNames = [\n  KnownEvaluationResultAssessmentName.GUIDELINE_ADHERENCE,\n  KnownEvaluationResultAssessmentName.GUIDELINES,\n  KnownEvaluationResultAssessmentName.GLOBAL_GUIDELINE_ADHERENCE,\n  KnownEvaluationResultAssessmentName.RELEVANCE_TO_QUERY,\n  KnownEvaluationResultAssessmentName.CONTEXT_SUFFICIENCY,\n  KnownEvaluationResultAssessmentName.RETRIEVAL_SUFFICIENCY,\n  KnownEvaluationResultAssessmentName.CORRECTNESS,\n  KnownEvaluationResultAssessmentName.GROUNDEDNESS,\n  KnownEvaluationResultAssessmentName.RETRIEVAL_GROUNDEDNESS,\n  KnownEvaluationResultAssessmentName.SAFETY,\n];\n\n/**\n * A list of known retrieval assessment names, used to populate suggestions\n */\nexport const KnownEvaluationRetrievalAssessmentNames = [KnownEvaluationResultAssessmentName.CHUNK_RELEVANCE];\n\n/**\n * Creates a draft assessment object with the given values.\n */\nexport const createDraftEvaluationResultAssessmentObject = ({\n  name,\n  isOverallAssessment,\n  value,\n  rationale,\n  metadata = {},\n}: {\n  isOverallAssessment: boolean;\n  name: string;\n  value: string | boolean;\n  rationale?: string;\n  metadata?: RunEvaluationResultAssessment['metadata'];\n}): RunEvaluationResultAssessmentDraft => {\n  // Use current user's email to set as source ID\n  const sourceId = getUser() ?? '';\n\n  const resultMetadata = isOverallAssessment\n    ? { ...metadata, [KnownEvaluationResultAssessmentMetadataFields.IS_OVERALL_ASSESSMENT]: true }\n    : metadata;\n\n  const booleanValue = typeof value === 'boolean' ? value : null;\n  const stringValue = typeof value !== 'boolean' ? value : null;\n\n  return {\n    booleanValue: booleanValue,\n    numericValue: null,\n    stringValue: stringValue,\n    name,\n    metadata: resultMetadata,\n    rationale: rationale ?? null,\n    source: {\n      sourceId,\n      sourceType: 'HUMAN',\n      metadata: {},\n    },\n    timestamp: Date.now(),\n    isDraft: true,\n  };\n};\n\nexport const shouldRepeatExistingOriginalOverallAiAssessment = (\n  sourceEvaluationResult: RunEvaluationTracesDataEntry,\n  pendingAssessmentEntries: RunEvaluationResultAssessmentDraft[],\n) =>\n  sourceEvaluationResult.overallAssessments.length > 0 &&\n  sourceEvaluationResult.overallAssessments.every(isAssessmentAiGenerated) &&\n  !pendingAssessmentEntries.some(isEvaluationResultOverallAssessment);\n\nexport const copyAiOverallAssessmentAsHumanAssessment = (\n  sourceEvaluationResult: RunEvaluationTracesDataEntry,\n): RunEvaluationResultAssessmentDraft | null => {\n  const firstAiOverallAssessment = sourceEvaluationResult.overallAssessments.find(isAssessmentAiGenerated);\n\n  if (!firstAiOverallAssessment) {\n    return null;\n  }\n\n  const sourceId = getUser() ?? '';\n\n  return {\n    ...firstAiOverallAssessment,\n    timestamp: Date.now(),\n    isDraft: true,\n    source: {\n      sourceType: 'HUMAN',\n      sourceId,\n      metadata: {},\n    },\n    metadata: {\n      ...firstAiOverallAssessment.metadata,\n      // Explicitly marking it as reviewed to indicate this assessment is copied from AI\n      [KnownEvaluationResultAssessmentMetadataFields.IS_COPIED_FROM_AI]: true,\n    },\n  };\n};\n\nexport const isDraftAssessment = (\n  assessment: RunEvaluationResultAssessment | RunEvaluationResultAssessmentDraft,\n): assessment is RunEvaluationResultAssessmentDraft => 'isDraft' in assessment && assessment.isDraft;\n\n/**\n * Returns a list of detailed assessments.\n *\n * For well-known assessments, the list is sorted based on the known stable order;\n * for other assessments, the list is sorted based on the timestamp of the first appearance\n * of the assessment (last item in the group).\n */\nexport const getOrderedAssessments = (assessmentsByName: Record<string, RunEvaluationResultAssessment[]>) =>\n  orderBy(Object.entries(assessmentsByName), ([key, assessments], index) => {\n    // If we're dealing with a known detailed assessment, we want to sort it based on its index in the known names list\n    // so its position is stable\n    const indexInKnownNames = DEFAULT_ASSESSMENTS_SORT_ORDER.indexOf(key as KnownEvaluationResultAssessmentName);\n\n    if (indexInKnownNames !== -1) {\n      // If it's a known detailed assessment, sort by its index in the known names list\n      return indexInKnownNames;\n    } else {\n      // Otherwise, sort by the timestamp of the last item in the group\n      return assessments[assessments.length - 1]?.timestamp ?? index;\n    }\n  });\n\nexport const isEvaluationResultReviewedAlready = (evaluationResult: RunEvaluationTracesDataEntry) =>\n  evaluationResult.overallAssessments\n    ?.filter((assessment) => !isDraftAssessment(assessment))\n    .some((assessment) => !isAssessmentAiGenerated(assessment)) ?? false;\n\nexport const hasBeenEditedByHuman = (assessment: RunEvaluationResultAssessment) =>\n  // It is not AI generated, and it doesn't have the `IS_FROM_AI` metadata field set to true\n  assessment.source?.sourceType === 'HUMAN' &&\n  !assessment.metadata?.[KnownEvaluationResultAssessmentMetadataFields.IS_COPIED_FROM_AI];\n\nexport const getEvaluationResultAssessmentChunkIndex = (assessment: RunEvaluationResultAssessment) =>\n  assessment.metadata?.[KnownEvaluationResultAssessmentMetadataFields.CHUNK_INDEX];\n\n// Auto select the first non-empty evaluation ID if no evaluation ID is selected\nexport const autoSelectFirstNonEmptyEvaluationId = (\n  evaluationResults: RunEvaluationTracesDataEntry[] | null,\n  selectedEvaluationId: string | undefined,\n  setSelectedEvaluationId: (evaluationId: string | undefined) => void,\n) => {\n  if (!selectedEvaluationId && evaluationResults) {\n    // Find first non-empty evaluationId in data\n    const firstNonEmpty = evaluationResults.find((evaluation) => evaluation.evaluationId);\n    if (firstNonEmpty) {\n      setSelectedEvaluationId(firstNonEmpty.evaluationId);\n    }\n  }\n};\n\n/**\n * Converts the given value to a string if it's an object or an array.\n */\nexport const stringifyValue = (value: any) => {\n  return isPlainObject(value) || Array.isArray(value) ? JSON.stringify(value, undefined, 2) : value;\n};\n\n/**\n * Utility function: generates suggestions for the assessment values based on original assessment and options.\n */\nexport const getAssessmentValueSuggestions = (\n  intl: IntlShape,\n  originalAssessment?: RunEvaluationResultAssessment,\n  assessmentHistory?: RunEvaluationResultAssessment[],\n  assessmentInfos?: AssessmentInfo[],\n) => {\n  // If we're starting with an existing assessment, we should suggest the values that are relevant to it.\n  if (originalAssessment) {\n    const mapping = KnownEvaluationResultAssessmentValueMapping[originalAssessment.name];\n    if (!mapping) {\n      return [];\n    }\n\n    return Object.entries(mapping).map(([key, value]) => {\n      return { key, label: intl.formatMessage(value), rootAssessmentName: originalAssessment.name };\n    });\n  }\n\n  // If we're starting with a new assessment, we only suggest 'boolean' values and a new value.\n  return (assessmentInfos || [])\n    .filter((assessmentInfo) => assessmentInfo.dtype === 'boolean')\n    .map((assessmentInfo) => ({\n      key: assessmentInfo.name,\n      label: assessmentInfo.name,\n      rootAssessmentName: assessmentInfo.name,\n      // Disabled when the assessment already exists.\n      disabled: assessmentHistory?.some((assessment) => assessment.name === assessmentInfo.name),\n    }));\n};\n\n/**\n * Returns true if the assessment is missing.\n * An assessment is considered missing if it doesn't have a value, rationale or error message.\n */\nexport const isAssessmentMissing = (assessment?: RunEvaluationResultAssessment) => {\n  if (!assessment) {\n    return false;\n  } else {\n    const hasRationale = Boolean(assessment.rationale);\n    const hasValue = !isNil(getEvaluationResultAssessmentValue(assessment));\n    const hasErrorMessage = Boolean(assessment.errorMessage);\n    return !(hasRationale || hasValue || hasErrorMessage);\n  }\n};\n\n/**\n * Checks if the given value is a retrieved context.\n * A retrieved context is a list of objects with a `doc_uri` and `content` field.\n */\nexport const isRetrievedContext = (value: any): boolean => {\n  return Array.isArray(value) && value.every((v) => isPlainObject(v) && 'doc_uri' in v && 'content' in v);\n};\n","import { isNil } from 'lodash';\n\nimport type { ThemeType } from '@databricks/design-system';\n\nimport { KnownEvaluationResultAssessmentStringValue, withAlpha } from '../components/GenAiEvaluationTracesReview.utils';\nimport type { AssessmentInfo, AssessmentValueType, RunEvaluationResultAssessment } from '../types';\n\n// Taken from figma: https://www.figma.com/design/2B1KMp9x624WrxaASrSv9B/Tiles-UX?node-id=3205-87588&t=1MwrDNNRIOSODm4D-0\nexport const AGGREGATE_SCORE_CHANGE_BACKGROUND_COLORS = {\n  // Tag green\n  up: '#02B30214',\n  // Tag coral\n  down: '#F000400F',\n};\n\n// tagTextCoral\nexport const AGGREGATE_SCORE_CHANGE_TEXT_COLOR = '#64172B';\n\n// From https://www.figma.com/design/HvkTlHxw4sKE77wDlRBDt2/Evaluation-UX?node-id=2996-40835&t=uqVDwh0gqqRJI3jS-0\nexport const CURRENT_RUN_COLOR = '#077A9D';\nexport const COMPARE_TO_RUN_COLOR = '#FFAB00';\n\nconst PASS_BARCHART_BAR_COLOR = '#99DDB4';\nconst FAIL_BARCHART_BAR_COLOR = '#FCA4A1';\nconst ERROR_BARCHART_BAR_COLOR = '#f09065';\n\nconst TAG_PASS_COLOR = '#02B30214'; // From tagBackgroundLime.\n\nexport const getEvaluationResultIconColor = (\n  theme: ThemeType,\n  assessmentInfo: AssessmentInfo,\n  assessment?: RunEvaluationResultAssessment | { stringValue: string; errorMessage?: string },\n) => {\n  if (assessmentInfo.dtype === 'pass-fail') {\n    // Return the color based on the assessment value\n    if (assessment?.stringValue === KnownEvaluationResultAssessmentStringValue.YES) {\n      return theme.isDarkMode ? theme.colors.green400 : theme.colors.green600;\n    }\n    if (assessment?.stringValue === KnownEvaluationResultAssessmentStringValue.NO) {\n      return theme.isDarkMode ? theme.colors.red400 : theme.colors.red600;\n    }\n  }\n  if (assessment?.errorMessage) {\n    return theme.colors.textValidationWarning;\n  }\n  return theme.colors.grey400;\n};\n\nexport const getEvaluationResultAssessmentBackgroundColor = (\n  theme: ThemeType,\n  assessmentInfo: AssessmentInfo,\n  assessment?: RunEvaluationResultAssessment | { stringValue: string; booleanValue?: string; errorMessage?: string },\n  iconOnly = false,\n) => {\n  if (assessmentInfo.dtype === 'pass-fail') {\n    // Return the color based on the assessment value\n    if (assessment?.stringValue === KnownEvaluationResultAssessmentStringValue.YES) {\n      return TAG_PASS_COLOR;\n    }\n    if (assessment?.stringValue === KnownEvaluationResultAssessmentStringValue.NO) {\n      return theme.isDarkMode ? withAlpha(theme.colors.red800, 0.6) : theme.colors.red200;\n    }\n    if (!iconOnly && assessment?.errorMessage) {\n      return '';\n    }\n  } else if (assessmentInfo.dtype === 'boolean') {\n    if (isNil(assessment?.booleanValue)) {\n      return '';\n    }\n    return assessment.booleanValue ? TAG_PASS_COLOR : theme.isDarkMode ? theme.colors.red800 : theme.colors.red200;\n  }\n  return '';\n};\n\nexport const getEvaluationResultTextColor = (\n  theme: ThemeType,\n  assessmentInfo: AssessmentInfo,\n  assessment?: RunEvaluationResultAssessment | { stringValue?: string; booleanValue?: boolean; errorMessage?: string },\n) => {\n  if (assessment?.errorMessage) {\n    return theme.colors.textValidationWarning;\n  }\n\n  if (assessmentInfo.dtype === 'pass-fail') {\n    // Return the color based on the assessment value\n    if (assessment?.stringValue === KnownEvaluationResultAssessmentStringValue.YES) {\n      return theme.isDarkMode ? theme.colors.green400 : theme.colors.green600;\n    } else if (assessment?.stringValue === KnownEvaluationResultAssessmentStringValue.NO) {\n      return theme.isDarkMode ? theme.colors.red400 : theme.colors.red600;\n    } else {\n      return theme.colors.textSecondary;\n    }\n  } else if (assessmentInfo.dtype === 'boolean') {\n    if (isNil(assessment?.booleanValue)) {\n      return theme.colors.textSecondary;\n    }\n    return theme.colors.textPrimary;\n  } else if (assessmentInfo.dtype === 'unknown') {\n    return theme.colors.textSecondary;\n  }\n  return theme.colors.textPrimary;\n};\n\nexport const getAssessmentValueBarBackgroundColor = (\n  theme: ThemeType,\n  assessmentInfo: AssessmentInfo,\n  assessmentValue: AssessmentValueType,\n  isError?: boolean,\n) => {\n  if (isError) {\n    return ERROR_BARCHART_BAR_COLOR;\n  }\n  if (assessmentInfo.dtype === 'pass-fail') {\n    // Return the color based on the assessment value\n    if (assessmentValue === KnownEvaluationResultAssessmentStringValue.YES) {\n      return PASS_BARCHART_BAR_COLOR;\n    }\n    if (assessmentValue === KnownEvaluationResultAssessmentStringValue.NO) {\n      return FAIL_BARCHART_BAR_COLOR;\n    }\n    return theme.isDarkMode ? theme.colors.grey800 : theme.colors.grey200;\n  } else if (assessmentInfo.dtype === 'boolean') {\n    if (isNil(assessmentValue)) {\n      return theme.isDarkMode ? theme.colors.grey800 : theme.colors.grey200;\n    }\n    return assessmentValue ? PASS_BARCHART_BAR_COLOR : FAIL_BARCHART_BAR_COLOR;\n  }\n  return theme.isDarkMode ? theme.colors.grey800 : theme.colors.grey200;\n};\n","/**\n * This file re-exports the appropriate package for routing based on the environment.\n *\n * Duplicate of mlflow/web/js/src/common/utils/RoutingUtils.tsx, because unfortunately\n * this package is located in web-shared and we can't directly access it from here.\n */\n/* eslint-disable no-restricted-imports */\nimport React from 'react';\n/**\n * Import React Router V6 parts\n */\nimport {\n  BrowserRouter,\n  MemoryRouter,\n  HashRouter,\n  matchPath,\n  generatePath,\n  Navigate,\n  Route,\n  Outlet as OutletDirect,\n  Link as LinkDirect,\n  useNavigate as useNavigateDirect,\n  useLocation as useLocationDirect,\n  useParams as useParamsDirect,\n  useSearchParams as useSearchParamsDirect,\n  createHashRouter,\n  RouterProvider,\n  Routes,\n  type To,\n  type NavigateOptions,\n  type Location,\n  type NavigateFunction,\n  type Params,\n} from 'react-router-dom';\n\nconst useLocation = useLocationDirect;\n\nconst useSearchParams = useSearchParamsDirect;\n\nconst useParams = useParamsDirect;\n\nconst useNavigate = useNavigateDirect;\n\nconst Outlet = OutletDirect;\n\nconst Link = LinkDirect;\n\nexport {\n  // React Router V6 API exports\n  BrowserRouter,\n  MemoryRouter,\n  HashRouter,\n  Link,\n  useNavigate,\n  useLocation,\n  useParams,\n  useSearchParams,\n  generatePath,\n  matchPath,\n  Navigate,\n  Route,\n  Routes,\n  Outlet,\n\n  // Exports used to build hash-based data router\n  createHashRouter,\n  RouterProvider,\n};\n\nexport const createLazyRouteElement = (\n  // Load the module's default export and turn it into React Element\n  componentLoader: () => Promise<{ default: React.ComponentType<React.PropsWithChildren<any>> }>,\n) => React.createElement(React.lazy(componentLoader));\nexport const createRouteElement = (component: React.ComponentType<React.PropsWithChildren<any>>) =>\n  React.createElement(component);\n\nexport type { Location, NavigateFunction, Params, To, NavigateOptions };\n","import { useCallback, useMemo } from 'react';\n\nimport type { AssessmentFilter, AssessmentInfo, AssessmentValueType } from '../types';\nimport { useSearchParams } from '../utils/RoutingUtils';\n\nconst QUERY_PARAM_KEY = 'assessmentFilter';\nconst VALUE_SEPARATOR = '::';\n\n/**\n * Query param-powered hook that returns the compare to run uuid when comparison is enabled.\n */\nexport const useAssessmentFilters = (assessmentInfos: AssessmentInfo[]) => {\n  const [searchParams, setSearchParams] = useSearchParams();\n\n  const assessmentFilters: AssessmentFilter[] = useMemo(() => {\n    const assessmentFiltersUrl = searchParams.getAll(QUERY_PARAM_KEY) ?? [];\n\n    return assessmentFiltersUrl.reduce<AssessmentFilter[]>((filters, urlFilter) => {\n      const [run, assessmentName, filterValueString, filterType] = urlFilter.split(VALUE_SEPARATOR);\n      const assessmentInfo = assessmentInfos?.find((info) => info.name === assessmentName);\n      if (assessmentInfo) {\n        const filterValue = serializedStringToAssessmentValue(assessmentInfo, filterValueString);\n        filters.push({\n          run,\n          assessmentName,\n          filterValue,\n          filterType: filterType === '' ? undefined : filterType,\n        } as AssessmentFilter);\n      }\n      return filters;\n    }, []);\n  }, [assessmentInfos, searchParams]);\n\n  const setAssessmentFilters = useCallback(\n    (filters: AssessmentFilter[] | undefined, replace = false) => {\n      setSearchParams(\n        (params: URLSearchParams) => {\n          params.delete(QUERY_PARAM_KEY);\n\n          if (filters) {\n            filters.forEach((filter) => {\n              params.append(\n                QUERY_PARAM_KEY,\n                [\n                  filter.run,\n                  filter.assessmentName,\n                  assessmentValueToSerializedString(filter.filterValue),\n                  filter.filterType,\n                ].join(VALUE_SEPARATOR),\n              );\n            });\n          }\n\n          return params;\n        },\n        { replace },\n      );\n    },\n    [setSearchParams],\n  );\n\n  return [assessmentFilters, setAssessmentFilters] as const;\n};\n\nexport function serializedStringToAssessmentValueV2(value: string): AssessmentValueType {\n  if (value === 'undefined') {\n    return undefined;\n  }\n\n  // Handle boolean values\n  if (value === 'true') {\n    return true;\n  }\n  if (value === 'false') {\n    return false;\n  }\n\n  // TODO(nsthorat): handle float / int types here.\n  return value;\n}\n\nexport function serializedStringToAssessmentValue(assessmentInfo: AssessmentInfo, value: string): AssessmentValueType {\n  if (assessmentInfo.dtype === 'pass-fail') {\n    if (value === 'undefined') {\n      return undefined;\n    }\n    return value;\n  } else if (assessmentInfo.dtype === 'boolean') {\n    if (value === 'true') {\n      return true;\n    } else if (value === 'false') {\n      return false;\n    } else {\n      return undefined;\n    }\n  }\n  // TODO(nsthorat): handle float / int types here.\n  return value;\n}\n\nexport function assessmentValueToSerializedString(value: AssessmentValueType): string {\n  if (value === undefined || value === null) return 'undefined';\n  return `${value}`;\n}\n","import { useMemo, useState } from 'react';\n\nimport type { EvaluationsOverviewTableSort, TracesTableColumn } from '../types';\n\nexport const useTableSort = (\n  selectedColumns: TracesTableColumn[],\n  initialTableSort?: EvaluationsOverviewTableSort,\n): [EvaluationsOverviewTableSort | undefined, (sort: EvaluationsOverviewTableSort | undefined) => void] => {\n  const [tableSort, setTableSort] = useState<EvaluationsOverviewTableSort | undefined>(\n    initialTableSort && selectedColumns.find((c) => c.id === initialTableSort.key) ? initialTableSort : undefined,\n  );\n\n  // This is to keep table sort in sync with selected columns.\n  // e.g. if the user deselects the column that is currently used for sorting,\n  // we should clear the sort.\n  const derivedTableSort = useMemo(() => {\n    if (!tableSort) return undefined;\n\n    if (!selectedColumns.find((c) => c.id === tableSort.key)) {\n      return undefined;\n    }\n\n    return tableSort;\n  }, [tableSort, selectedColumns]);\n\n  return [derivedTableSort, setTableSort];\n};\n","import type { Table } from '@tanstack/react-table';\nimport React, { createContext, useMemo, useState } from 'react';\n\nimport type { EvalTraceComparisonEntry } from './types';\n\ntype TraceRow = EvalTraceComparisonEntry & { multiline?: boolean };\n\nexport interface GenAITracesTableContextValue<T> {\n  /** TanStack table instance (may be undefined until grandchild mounts) */\n  table: Table<T> | undefined;\n  /** Grandchild calls this once when it builds the table */\n  setTable: (tbl: Table<T> | undefined) => void;\n\n  selectedRowIds: string[];\n  /** Grandchild updates this on every selection change */\n  setSelectedRowIds: (rowIds: string[]) => void;\n}\nexport const GenAITracesTableContext = createContext<GenAITracesTableContextValue<TraceRow>>({\n  table: undefined,\n  setTable: () => {},\n  selectedRowIds: [],\n  setSelectedRowIds: () => {},\n});\n\ninterface GenAITracesTableProviderProps {\n  children: React.ReactNode;\n}\n\nexport const GenAITracesTableProvider: React.FC<React.PropsWithChildren<GenAITracesTableProviderProps>> = ({\n  children,\n}) => {\n  const [table, setTable] = useState<Table<TraceRow> | undefined>();\n  const [selectedRowIds, setSelectedRowIds] = useState<string[]>([]);\n\n  const value = useMemo(() => ({ table, setTable, selectedRowIds, setSelectedRowIds }), [table, selectedRowIds]);\n\n  return <GenAITracesTableContext.Provider value={value}>{children}</GenAITracesTableContext.Provider>;\n};\n","import React, { useState } from 'react';\n\nimport { Modal, Typography } from '@databricks/design-system';\nimport { FormattedMessage, useIntl } from '@databricks/i18n';\n\nimport type { RunEvaluationTracesDataEntry } from '../types';\n\nexport const GenAiDeleteTraceModal = ({\n  experimentIds,\n  visible,\n  selectedTraces,\n  handleClose,\n  deleteTraces,\n}: {\n  experimentIds: string[];\n  visible: boolean;\n  selectedTraces: RunEvaluationTracesDataEntry[];\n  handleClose: () => void;\n  deleteTraces: (experimentId: string, traceIds: string[]) => Promise<void>;\n}) => {\n  const intl = useIntl();\n  const [errorMessage, setErrorMessage] = useState<string>('');\n  const [isLoading, setIsLoading] = useState(false);\n  const tracesToDelete = selectedTraces.map((trace) => trace.evaluationId);\n\n  const submitDeleteTraces = async () => {\n    try {\n      await deleteTraces(experimentIds[0] ?? '', tracesToDelete);\n      handleClose();\n    } catch (e: any) {\n      setErrorMessage(\n        intl.formatMessage({\n          defaultMessage: 'An error occured while attempting to delete traces. Please refresh the page and try again.',\n          description: 'Experiment page > traces view controls > Delete traces modal > Error message',\n        }),\n      );\n    }\n    setIsLoading(false);\n  };\n\n  const handleOk = () => {\n    submitDeleteTraces();\n    setIsLoading(true);\n  };\n\n  return (\n    <Modal\n      componentId=\"eval-tab.delete_traces-modal\"\n      title={\n        <FormattedMessage\n          defaultMessage=\"{count, plural, one {Delete Trace} other {Delete Traces}}\"\n          description=\"Experiment page > traces view controls > Delete traces modal > Title\"\n          values={{ count: tracesToDelete.length }}\n        />\n      }\n      visible={visible}\n      onCancel={handleClose}\n      okText={\n        <FormattedMessage\n          defaultMessage=\"Delete {count, plural, one { # trace } other { # traces }}\"\n          description=\"Experiment page > traces view controls > Delete traces modal > Delete button\"\n          values={{ count: tracesToDelete.length }}\n        />\n      }\n      onOk={handleOk}\n      okButtonProps={{ loading: isLoading, danger: true }}\n    >\n      {errorMessage && <Typography.Paragraph color=\"error\">{errorMessage}</Typography.Paragraph>}\n      <Typography.Paragraph>\n        <Typography.Text bold>\n          <FormattedMessage\n            defaultMessage=\"{count, plural, one { # trace } other { # traces }} will be deleted.\"\n            description=\"Experiment page > traces view controls > Delete traces modal > Confirmation message title\"\n            values={{\n              count: tracesToDelete.length,\n            }}\n          />\n        </Typography.Text>\n      </Typography.Paragraph>\n      <Typography.Paragraph>\n        <FormattedMessage\n          defaultMessage=\"Deleted traces cannot be restored. Are you sure you want to proceed?\"\n          description=\"Experiment page > traces view controls > Delete traces modal > Confirmation message\"\n        />\n      </Typography.Paragraph>\n    </Modal>\n  );\n};\n","export const shouldEnableRunEvaluationReviewUIWriteFeatures = () => {\n  return false;\n};\n\nexport const shouldEnableTagGrouping = () => {\n  return true;\n};\n\nexport const shouldEnableUnifiedEvalTab = () => {\n  return false;\n};\n\nexport const shouldUseRunIdFilterInSearchTraces = () => {\n  return false;\n};\n\n/**\n * Page size for MLflow traces 3.0 search api used in eval tab\n */\nexport const getMlflowTracesSearchPageSize = () => {\n  // OSS backend limit is 500\n  return 500;\n};\n\n/**\n * Total number of traces that will be fetched via mlflow traces 3.0 search api in eval tab\n */\nexport const getEvalTabTotalTracesLimit = () => {\n  return 1000;\n};\n","import type { ModelTrace, ModelTraceInfo, ModelTraceSpan } from '../model-trace-explorer';\n\nexport type AssessmentDType = 'string' | 'numeric' | 'boolean' | 'pass-fail' | 'unknown';\nexport type AssessmentType = 'AI_JUDGE' | 'HUMAN' | 'CODE';\n\n// Reflects structure logged by mlflow.log_table()\nexport interface RawGenaiEvaluationArtifactResponse {\n  columns?: (string | null)[];\n  data?: (string | number | null | boolean | Record<string, any>)[][];\n  filename: string;\n}\n\nexport interface AssessmentInfo {\n  name: string;\n  displayName: string;\n  // True when the assessment comes from a built-in judge.\n  isKnown: boolean;\n  isOverall: boolean;\n  // The metric that produced the assessment. Defined as the name of the judge or custom metric function that produced the assessment.\n  metricName: string;\n  source?: RunEvaluationResultAssessmentSource;\n  isCustomMetric: boolean;\n  isEditable: boolean;\n  isRetrievalAssessment: boolean;\n  // The type of the assessment value.\n  dtype: AssessmentDType;\n  uniqueValues: Set<AssessmentValueType>;\n\n  // Display metadata.\n  docsLink: string;\n  missingTooltip: string;\n  description: string;\n\n  // True if if the assesment contains at least one error\n  containsErrors?: boolean;\n}\n\ninterface RootCauseAssessmentInfo {\n  assessmentName: string;\n  suggestedActions?: string;\n}\n\nexport interface EvaluationArtifactTableEntryAssessment {\n  evaluation_id: string;\n\n  name: string;\n\n  boolean_value: boolean | null;\n  numeric_value: number | null;\n  string_value: string | null;\n  rationale: string | null;\n\n  source: {\n    source_type: AssessmentType;\n    source_id: string;\n    metadata: any;\n  };\n\n  metadata?: Record<string, any>;\n\n  timestamp: number;\n\n  error_code?: string;\n  error_message?: string;\n}\n\nexport interface EvaluationArtifactTableEntryMetric {\n  evaluation_id: string;\n  key: string;\n  value: number;\n  timestamp: number;\n}\n\nexport interface EvaluationArtifactTableEntryEvaluation {\n  evaluation_id: string;\n  inputs_id: string;\n  request_id: string;\n  run_id?: string;\n\n  inputs: Record<string, any>;\n  outputs: Record<string, any>;\n  targets: Record<string, any>;\n}\n\nexport type RunEvaluationResultAssessmentSource = {\n  sourceType: AssessmentType;\n  sourceId: string;\n  metadata: Record<string, string>;\n};\n\nexport type RunEvaluationResultAssessment = {\n  name: string;\n  rationale?: string | null;\n  source?: RunEvaluationResultAssessmentSource;\n  metadata?: Record<string, string | boolean | number>;\n  errorCode?: string;\n  errorMessage?: string;\n  numericValue?: number | null;\n  booleanValue?: boolean | null;\n  stringValue?: string | null;\n  // Root cause assessment points to the assessment name causing the failure.\n  rootCauseAssessment?: RootCauseAssessmentInfo | null;\n  timestamp?: number | null;\n};\n\nexport type AssessmentValueType = string | boolean | number | undefined;\n\nexport type AssessmentRunCounts = Map<AssessmentValueType, number>;\n\nexport interface AssessmentAggregates {\n  assessmentInfo: AssessmentInfo;\n\n  // Counts for the current run and other run.\n  currentCounts?: AssessmentRunCounts;\n  otherCounts?: AssessmentRunCounts;\n\n  // Numeric values for the current run and other run.\n  currentNumericValues?: number[];\n  otherNumericValues?: number[];\n\n  currentNumRootCause: number;\n  otherNumRootCause: number;\n\n  // Numeric aggregate counts for the current run.\n  currentNumericAggregate?: NumericAggregate;\n\n  assessmentFilters: AssessmentFilter[];\n}\n\nexport interface EvaluationsOverviewTableSort {\n  key: string;\n  type: TracesTableColumnType;\n  asc: boolean;\n}\n\nexport interface TraceActions {\n  exportToEvals?: {\n    getTrace?: (traceId?: string) => Promise<ModelTrace | undefined>;\n  };\n  deleteTracesAction?: {\n    deleteTraces: (experimentId: string, traceIds: string[]) => Promise<any>;\n  };\n  editTags?: {\n    showEditTagsModalForTrace: (trace: ModelTraceInfo) => void;\n    EditTagsModal: React.ReactNode;\n  };\n}\n\n// @deprecated, use TableFilter instead\nexport interface AssessmentFilter {\n  assessmentName: string;\n  filterValue: AssessmentValueType;\n  // Only defined when filtering on an assessment for RCA values.\n  filterType?: 'rca' | undefined;\n  run: string;\n}\nexport type TableFilter = {\n  // The column group (e.g. \"Assessments\") or a specific column (e.g. \"execution_duration\")\n  column: TracesTableColumnGroup | string;\n  // Should be defined if a column group is used.\n  key?: string;\n  operator: FilterOperator;\n  value: TableFilterValue;\n};\n\nexport type TableFilterValue = string | boolean | number | undefined;\n\nexport interface TableFilterOption {\n  value: string;\n  renderValue: () => string | React.ReactNode;\n}\n\nexport interface TableFilterOptions {\n  source: TableFilterOption[];\n}\n\nexport enum FilterOperator {\n  EQUALS = '=',\n  GREATER_THAN = '>',\n  LESS_THAN = '<',\n  GREATER_THAN_OR_EQUALS = '>=',\n  LESS_THAN_OR_EQUALS = '<=',\n}\n\nexport interface AssessmentDropdownSuggestionItem {\n  label: string;\n  key: string;\n  rootAssessmentName?: string;\n  disabled?: boolean;\n}\n\nexport interface RunEvaluationResultAssessmentDraft extends RunEvaluationResultAssessment {\n  isDraft: true;\n}\n\nexport type RunEvaluationResultMetric = {\n  key: string;\n  value: number;\n  timestamp: number;\n};\n\nexport type RunEvaluationTracesRetrievalChunk = {\n  docUrl: string;\n  content: string;\n  retrievalAssessmentsByName?: Record<string, RunEvaluationResultAssessment[]>;\n  target?: string;\n};\n\n// TODO(nsthorat): Move these to the shared types location:\n// https://src.dev.databricks.com/databricks-eng/universe/-/blob/webapp/web/js/genai/shared/types.ts\n// The shared type does not yet support TraceInfoV3.\n// I had to add these here because the types in genai/shared/types are TraceV2.\n// The types in trace-explorer are also TraceV2.\nexport type AssessmentV3 = {\n  assessment_id: string;\n  assessment_name: string;\n  trace_id: string;\n  span_id?: string;\n  create_time: string;\n  last_update_time: string;\n  feedback?: {\n    value: string | number | boolean;\n    error?: {\n      error_code?: string;\n      error_message?: string;\n    };\n  };\n  expectation?: {\n    value: string | string[];\n    serialized_value?: {\n      serialization_format?: string;\n      value: string | string[];\n    };\n    error?: {\n      error_code?: string;\n      error_message?: string;\n    };\n  };\n  metadata?: Record<string, string>;\n  rationale?: string;\n  error?: {\n    error_code?: string;\n    error_message?: string;\n  };\n  source?: {\n    source_type?: 'HUMAN' | 'LLM_JUDGE' | 'CODE';\n    source_id?: string;\n  };\n};\n\nexport type TraceInfoV3 = {\n  trace_id: string;\n  client_request_id?: string;\n  trace_location: {\n    type: 'MLFLOW_EXPERIMENT' | 'INFERENCE_TABLE';\n    mlflow_experiment?: { experiment_id: string };\n    inference_table?: { full_table_name: string };\n  };\n  request?: string;\n  request_preview?: string;\n  response?: string;\n  response_preview?: string;\n  request_time: string;\n  execution_duration?: string;\n  state: 'STATE_UNSPECIFIED' | 'OK' | 'ERROR' | 'IN_PROGRESS';\n  trace_metadata?: Record<string, string>;\n  tags?: Record<string, string>;\n  assessments?: AssessmentV3[];\n};\n\nexport type TraceV3 = {\n  info: TraceInfoV3;\n  data: {\n    spans: ModelTraceSpan[];\n  };\n};\n\n/**\n * An entity encompassing single review evaluation data.\n */\nexport type RunEvaluationTracesDataEntry = {\n  evaluationId: string;\n  requestId: string;\n  inputsTitle?: string;\n  inputs: Record<string, any>;\n  inputsId: string;\n  outputs: Record<string, any>;\n  targets: Record<string, any>;\n  errorCode?: string;\n  errorMessage?: string;\n  requestTime?: string;\n  overallAssessments: RunEvaluationResultAssessment[];\n  responseAssessmentsByName: Record<\n    // Keyed by assessment name (e.g. \"overall_judgement\", \"readability_score\" etc.)\n    string,\n    RunEvaluationResultAssessment[]\n  >;\n  metrics: Record<string, RunEvaluationResultMetric>;\n  retrievalChunks?: RunEvaluationTracesRetrievalChunk[];\n\n  // NOTE(nsthorat): We will slowly migrate to this type.\n  traceInfo?: TraceInfoV3;\n};\n\nexport interface EvalTraceComparisonEntry {\n  currentRunValue?: RunEvaluationTracesDataEntry;\n  otherRunValue?: RunEvaluationTracesDataEntry;\n}\n\nexport interface SaveAssessmentsQuery {\n  savePendingAssessments: (\n    runUuid: string,\n    evaluationId: string,\n    pendingAssessmentEntries: RunEvaluationResultAssessmentDraft[],\n  ) => void;\n  isSaving: boolean;\n}\n\n// Internal type used to determine behavior of different types of columns.\n// We should try to move away from this and start to use TracesTableColumnGroup instead.\nexport enum TracesTableColumnType {\n  ASSESSMENT = 'ASSESSMENT',\n  EXPECTATION = 'EXPECTATION',\n  TRACE_INFO = 'TRACE_INFO',\n  INPUT = 'INPUT',\n  // This is a hack so that internal agent monitoring can display request time.\n  INTERNAL_MONITOR_REQUEST_TIME = 'INTERNAL_MONITOR_REQUEST_TIME',\n}\n\n// This represents columns that are grouped together.\n// For example, each assessment is its own column, but they are all grouped under the \"Assessments\" column group.\nexport enum TracesTableColumnGroup {\n  ASSESSMENT = 'ASSESSMENT',\n  EXPECTATION = 'EXPECTATION',\n  TAG = 'TAG',\n  INFO = 'INFO',\n}\n\nexport const TracesTableColumnGroupToLabelMap = {\n  [TracesTableColumnGroup.ASSESSMENT]: 'Assessments',\n  [TracesTableColumnGroup.EXPECTATION]: 'Expectations',\n  [TracesTableColumnGroup.TAG]: 'Tags',\n  // We don't show a label for the info column group\n  [TracesTableColumnGroup.INFO]: '\\u00A0',\n};\n\nexport interface TracesTableColumn {\n  // This is the assessment name for assessments, and a static string for trace info and input columns\n  id: string;\n  label: string;\n  type: TracesTableColumnType;\n  group?: TracesTableColumnGroup;\n\n  // TODO: Remove this field once migration to trace info v3 is complete\n  assessmentInfo?: AssessmentInfo;\n  expectationName?: string;\n}\n\nexport interface TableFilterFormState {\n  filters: TableFilter[];\n}\n\n// A bucket of a numeric aggregate.\nexport type NumericAggregateCount = {\n  // The lower bound of the bucket, inclusive.\n  lower: number;\n  // The upper bound of the bucket, exclusive except for the last bucket.\n  upper: number;\n  // The number of values in the bucket.\n  count: number;\n};\n\n// A numeric aggregate with the min, mid, and max values, and the counts of values in each bucket.\nexport type NumericAggregate = {\n  min: number;\n  max: number;\n  maxCount: number;\n  counts: NumericAggregateCount[];\n};\n","import { isNil } from 'lodash';\nimport { useMemo } from 'react';\n\nimport type { IntlShape } from '@databricks/i18n';\n\nimport { KnownEvaluationResultAssessmentName } from '../enum';\nimport type { AssessmentInfo, RunEvaluationTracesDataEntry, TraceInfoV3, TracesTableColumn } from '../types';\nimport { TracesTableColumnGroup, TracesTableColumnType } from '../types';\nimport { shouldEnableTagGrouping } from '../utils/FeatureUtils';\nimport {\n  createCustomMetadataColumnId,\n  createTagColumnId,\n  MLFLOW_INTERNAL_PREFIX,\n  shouldUseTraceInfoV3,\n} from '../utils/TraceUtils';\n\nexport const USER_COLUMN_ID = 'user';\nexport const SESSION_COLUMN_ID = 'session';\nexport const RESPONSE_COLUMN_ID = 'response';\nexport const TRACE_ID_COLUMN_ID = 'trace_id';\nexport const REQUEST_TIME_COLUMN_ID = 'request_time';\nexport const EXECUTION_DURATION_COLUMN_ID = 'execution_duration';\nexport const STATE_COLUMN_ID = 'state';\nexport const SOURCE_COLUMN_ID = 'source';\nexport const TAGS_COLUMN_ID = 'tags';\nexport const TRACE_NAME_COLUMN_ID = 'trace_name';\nexport const INPUTS_COLUMN_ID = 'request';\nexport const RUN_NAME_COLUMN_ID = 'run_name';\nexport const LOGGED_MODEL_COLUMN_ID = 'logged_model';\nexport const TOKENS_COLUMN_ID = 'tokens';\nexport const CUSTOM_METADATA_COLUMN_ID = 'custom_metadata';\n\nexport const SORTABLE_INFO_COLUMNS = [EXECUTION_DURATION_COLUMN_ID, REQUEST_TIME_COLUMN_ID, SESSION_COLUMN_ID];\n// Columns that are sortable by the server. Server-side sorting should be prioritized over client-side sorting.\nexport const SERVER_SORTABLE_INFO_COLUMNS = [EXECUTION_DURATION_COLUMN_ID, REQUEST_TIME_COLUMN_ID];\n\n// This is a short term fix to not display any additional assessments with the trace info v3 migration.\n// Long term we should decide how to best display these assessments.\nconst EXCLUDED_ASSESSMENT_NAMES = [\n  KnownEvaluationResultAssessmentName.CHUNK_RELEVANCE,\n  KnownEvaluationResultAssessmentName.TOTAL_INPUT_TOKEN_COUNT,\n  KnownEvaluationResultAssessmentName.TOTAL_OUTPUT_TOKEN_COUNT,\n  KnownEvaluationResultAssessmentName.TOTAL_TOKEN_COUNT,\n  KnownEvaluationResultAssessmentName.DOCUMENT_RECALL,\n  KnownEvaluationResultAssessmentName.DOCUMENT_RATINGS,\n];\n\nconst ASSESSMENT_COLUMN_ID_SUFFIX = '_assessment_column';\nconst EXPECTATION_COLUMN_ID_SUFFIX = '_expectation_column';\n\n// Add a suffix to the assessment name as the id to make it work for blank names.\nexport function createAssessmentColumnId(assessmentName: string) {\n  return assessmentName + ASSESSMENT_COLUMN_ID_SUFFIX;\n}\n\nexport function createExpectationColumnId(expectationName: string) {\n  return expectationName + EXPECTATION_COLUMN_ID_SUFFIX;\n}\n\nexport const useTableColumns = (\n  intl: IntlShape,\n  currentEvaluationResults: RunEvaluationTracesDataEntry[],\n  assessmentInfos: AssessmentInfo[],\n  runUuid: string | undefined,\n  otherEvaluationResults?: RunEvaluationTracesDataEntry[],\n  isTraceInfoV3Override?: boolean,\n) => {\n  const allColumns: TracesTableColumn[] = useMemo(() => {\n    const isTraceInfoV3 = isTraceInfoV3Override ?? shouldUseTraceInfoV3(currentEvaluationResults);\n    let inputCols = [];\n    if (!isTraceInfoV3) {\n      let inputKeys = new Set<string>();\n      let traceInfoColumns = new Set<keyof TraceInfoV3>();\n\n      currentEvaluationResults.forEach((result) => {\n        const { inputs } = result;\n        inputKeys = new Set<string>([...inputKeys, ...Object.keys(inputs || {})]);\n\n        traceInfoColumns = new Set<keyof TraceInfoV3>([\n          ...traceInfoColumns,\n          ...Object.keys(result.traceInfo || {}),\n        ] as (keyof TraceInfoV3)[]);\n      });\n\n      inputCols = [...inputKeys].map((key) => ({\n        id: key,\n        label: key,\n        type: TracesTableColumnType.INPUT,\n      }));\n    } else {\n      inputCols = [\n        {\n          id: INPUTS_COLUMN_ID,\n          label: intl.formatMessage({\n            defaultMessage: 'Request',\n            description: 'Column label for request',\n          }),\n          type: TracesTableColumnType.INPUT,\n          group: TracesTableColumnGroup.INFO,\n        },\n      ];\n    }\n\n    const assessmentColumns = assessmentInfos\n      .map((assessmentInfo) => ({\n        id: createAssessmentColumnId(assessmentInfo.name),\n        label: assessmentInfo.displayName,\n        type: TracesTableColumnType.ASSESSMENT,\n        assessmentInfo,\n        group: TracesTableColumnGroup.ASSESSMENT,\n      }))\n      .filter(\n        (assessment) =>\n          // retrieval columns should not be displayed in the table since they don't apply to the overall trace\n          !assessment.assessmentInfo.isRetrievalAssessment &&\n          !EXCLUDED_ASSESSMENT_NAMES.includes(assessment.assessmentInfo.name as KnownEvaluationResultAssessmentName),\n      );\n\n    let infoCols;\n    const expectationColumns: Record<string, TracesTableColumn> = {};\n    if (isTraceInfoV3) {\n      infoCols = [\n        {\n          id: TRACE_ID_COLUMN_ID,\n          label: intl.formatMessage({\n            defaultMessage: 'Trace ID',\n            description: 'Column label for trace ID',\n          }),\n          type: TracesTableColumnType.TRACE_INFO,\n          group: TracesTableColumnGroup.INFO,\n        },\n        {\n          id: TRACE_NAME_COLUMN_ID,\n          label: intl.formatMessage({\n            defaultMessage: 'Trace name',\n            description: 'Column label for trace name',\n          }),\n          type: TracesTableColumnType.TRACE_INFO,\n          group: TracesTableColumnGroup.INFO,\n        },\n        {\n          id: RESPONSE_COLUMN_ID,\n          label: intl.formatMessage({\n            defaultMessage: 'Response',\n            description: 'Column label for response',\n          }),\n          type: TracesTableColumnType.TRACE_INFO,\n          group: TracesTableColumnGroup.INFO,\n        },\n        {\n          id: USER_COLUMN_ID,\n          label: intl.formatMessage({\n            defaultMessage: 'User',\n            description: 'Column label for user',\n          }),\n          type: TracesTableColumnType.TRACE_INFO,\n          group: TracesTableColumnGroup.INFO,\n        },\n        {\n          id: SESSION_COLUMN_ID,\n          label: intl.formatMessage({\n            defaultMessage: 'Session',\n            description: 'Column label for session',\n          }),\n          type: TracesTableColumnType.TRACE_INFO,\n          group: TracesTableColumnGroup.INFO,\n        },\n        {\n          id: EXECUTION_DURATION_COLUMN_ID,\n          label: intl.formatMessage({\n            defaultMessage: 'Execution time',\n            description: 'Column label for execution time',\n          }),\n          type: TracesTableColumnType.TRACE_INFO,\n          group: TracesTableColumnGroup.INFO,\n        },\n        {\n          id: REQUEST_TIME_COLUMN_ID,\n          label: intl.formatMessage({\n            defaultMessage: 'Request time',\n            description: 'Column label for request time',\n          }),\n          type: TracesTableColumnType.TRACE_INFO,\n          group: TracesTableColumnGroup.INFO,\n        },\n        {\n          id: STATE_COLUMN_ID,\n          label: intl.formatMessage({\n            defaultMessage: 'State',\n            description: 'Column label for state',\n          }),\n          type: TracesTableColumnType.TRACE_INFO,\n          group: TracesTableColumnGroup.INFO,\n        },\n        {\n          id: SOURCE_COLUMN_ID,\n          label: intl.formatMessage({\n            defaultMessage: 'Source',\n            description: 'Column label for source',\n          }),\n          type: TracesTableColumnType.TRACE_INFO,\n          group: TracesTableColumnGroup.INFO,\n        },\n        {\n          id: LOGGED_MODEL_COLUMN_ID,\n          label: intl.formatMessage({\n            defaultMessage: 'Version',\n            description: 'Column label for logged model',\n          }),\n          type: TracesTableColumnType.TRACE_INFO,\n          group: TracesTableColumnGroup.INFO,\n        },\n        {\n          id: TOKENS_COLUMN_ID,\n          label: intl.formatMessage({\n            defaultMessage: 'Tokens',\n            description: 'Column label for tokens',\n          }),\n          type: TracesTableColumnType.TRACE_INFO,\n          group: TracesTableColumnGroup.INFO,\n        },\n        // Only show run name column on experiment level traces, where runUuid is not provided\n        isNil(runUuid) && {\n          id: RUN_NAME_COLUMN_ID,\n          label: intl.formatMessage({\n            defaultMessage: 'Run name',\n            description: 'Column label for run name',\n          }),\n          type: TracesTableColumnType.TRACE_INFO,\n          group: TracesTableColumnGroup.INFO,\n        },\n        !shouldEnableTagGrouping() && {\n          id: TAGS_COLUMN_ID,\n          label: intl.formatMessage({\n            defaultMessage: 'Tags',\n            description: 'Column label for tags',\n          }),\n          type: TracesTableColumnType.TRACE_INFO,\n          group: TracesTableColumnGroup.TAG,\n        },\n      ];\n\n      const allResults = [...currentEvaluationResults, ...(otherEvaluationResults || [])];\n      // Populate custom metadata columns\n      const customMetadataColumns: Record<string, TracesTableColumn> = {};\n      allResults.forEach((result: RunEvaluationTracesDataEntry) => {\n        const traceMetadata = result.traceInfo?.trace_metadata;\n        if (traceMetadata) {\n          Object.keys(traceMetadata).forEach((key) => {\n            if (!key.startsWith(MLFLOW_INTERNAL_PREFIX) && !customMetadataColumns[key]) {\n              customMetadataColumns[key] = {\n                id: createCustomMetadataColumnId(key),\n                label: key,\n                type: TracesTableColumnType.TRACE_INFO,\n                group: TracesTableColumnGroup.INFO,\n              };\n            }\n          });\n        }\n\n        const expectations = result.targets;\n        if (expectations) {\n          Object.keys(expectations).forEach((expectationName) => {\n            if (!expectationColumns[expectationName]) {\n              expectationColumns[expectationName] = {\n                id: createExpectationColumnId(expectationName),\n                label: expectationName,\n                type: TracesTableColumnType.EXPECTATION,\n                group: TracesTableColumnGroup.EXPECTATION,\n                expectationName,\n              };\n            }\n          });\n        }\n      });\n      infoCols = [...infoCols, ...Object.values(customMetadataColumns)];\n\n      if (shouldEnableTagGrouping()) {\n        const tagColumnRecords: Record<string, TracesTableColumn> = {};\n        allResults\n          .map((result) => result.traceInfo?.tags)\n          .forEach((tag) => {\n            Object.keys(tag || {}).forEach((key) => {\n              if (!key.startsWith(MLFLOW_INTERNAL_PREFIX) && !tagColumnRecords[key]) {\n                tagColumnRecords[key] = {\n                  id: createTagColumnId(key),\n                  label: key,\n                  type: TracesTableColumnType.TRACE_INFO,\n                  group: TracesTableColumnGroup.TAG,\n                };\n              }\n            });\n          });\n        const tagColumns = Object.values(tagColumnRecords);\n\n        infoCols = [...infoCols, ...tagColumns];\n      }\n    } else {\n      infoCols = currentEvaluationResults.some((result) => !isNil(result.requestTime))\n        ? [\n            {\n              id: REQUEST_TIME_COLUMN_ID,\n              label: intl.formatMessage({\n                defaultMessage: 'Request time',\n                description: 'Column label for request time',\n              }),\n              type: TracesTableColumnType.INTERNAL_MONITOR_REQUEST_TIME,\n            },\n          ]\n        : [];\n    }\n\n    return [...inputCols, ...infoCols, ...assessmentColumns, ...Object.values(expectationColumns)].filter(\n      (col): col is TracesTableColumn => Boolean(col),\n    );\n  }, [currentEvaluationResults, intl, assessmentInfos, runUuid, otherEvaluationResults, isTraceInfoV3Override]);\n\n  return allColumns;\n};\n","import { isNil, uniq } from 'lodash';\n\nimport { ModelTraceSpanType } from '@databricks/web-shared/model-trace-explorer';\nimport type { ModelTrace, ModelTraceInfo, RetrieverDocument } from '@databricks/web-shared/model-trace-explorer';\n\nimport { stringifyValue } from '../components/GenAiEvaluationTracesReview.utils';\nimport { KnownEvaluationResultAssessmentName } from '../enum';\nimport { CUSTOM_METADATA_COLUMN_ID, TAGS_COLUMN_ID } from '../hooks/useTableColumns';\nimport type {\n  AssessmentType,\n  AssessmentV3,\n  RunEvaluationResultAssessment,\n  RunEvaluationResultAssessmentSource,\n  RunEvaluationTracesDataEntry,\n  RunEvaluationTracesRetrievalChunk,\n  TraceInfoV3,\n} from '../types';\n\n// This is the key used by the eval harness to record\n// which chunk a given retrieval assessment corresponds to.\nconst MLFLOW_SPAN_OUTPUT_KEY = 'span_output_key';\n\nconst MLFLOW_ASSESSMENT_ROOT_CAUSE_ASSESSMENT = 'root_cause_assessment';\nconst MLFLOW_ASSESSMENT_ROOT_CAUSE_RATIONALE = 'root_cause_rationale';\nconst MLFLOW_ASSESSMENT_SUGGESTED_ACTION = 'suggested_action';\nexport const MLFLOW_SOURCE_RUN_KEY = 'mlflow.sourceRun';\n\nexport const MLFLOW_INTERNAL_PREFIX = 'mlflow.';\n\nexport const getRowIdFromEvaluation = (evaluation?: RunEvaluationTracesDataEntry) => {\n  return evaluation?.evaluationId || '';\n};\n\nexport const getRowIdFromTrace = (trace?: TraceInfoV3) => {\n  return trace?.trace_id || '';\n};\n\nexport const getTagKeyFromColumnId = (columnId: string) => {\n  return columnId.split(':').pop();\n};\n\nexport const getCustomMetadataKeyFromColumnId = (columnId: string) => {\n  return columnId.split(':').pop();\n};\n\nexport const createTagColumnId = (tagKey: string) => {\n  return `${TAGS_COLUMN_ID}:${tagKey}`;\n};\n\nexport const createCustomMetadataColumnId = (metadataKey: string) => {\n  return `${CUSTOM_METADATA_COLUMN_ID}:${metadataKey}`;\n};\n\nexport const getTracesTagKeys = (traces: TraceInfoV3[]): string[] => {\n  return uniq(\n    traces\n      .map((result) => {\n        return Object.keys(result.tags || {}).filter((key) => key && !key.startsWith(MLFLOW_INTERNAL_PREFIX));\n      })\n      .flat(),\n  );\n};\n\n/**\n * This is currently only used to support the edit tags flow which only requires request id + tags\n */\nexport const convertTraceInfoV3ToModelTraceInfo = (trace: TraceInfoV3) => {\n  const kvArray = (obj?: Record<string, string>): { key: string; value: string }[] | undefined =>\n    obj ? Object.entries(obj).map(([key, value]) => ({ key, value })) : undefined;\n\n  const model: ModelTraceInfo = {\n    request_id: trace.client_request_id ?? trace.trace_id,\n    tags: kvArray(trace.tags),\n  };\n\n  return model;\n};\n\n// This function checks if the traceInfo field is present in the first entry of the evalResults array.\n// We assume that all entries in evalResults will either contain traceInfo or not.\nexport const shouldUseTraceInfoV3 = (evalResults: RunEvaluationTracesDataEntry[]): boolean => {\n  return evalResults.length > 0 && Boolean(evalResults[0].traceInfo);\n};\n\nconst safelyParseValue = <T>(val: string): string | T => {\n  try {\n    return JSON.parse(val);\n  } catch {\n    return val;\n  }\n};\n\nexport const getTraceInfoInputs = (traceInfo: TraceInfoV3) => {\n  return traceInfo.request_preview || traceInfo.request || traceInfo.trace_metadata?.['mlflow.traceInputs'] || '';\n};\n\nexport const getTraceInfoOutputs = (traceInfo: TraceInfoV3) => {\n  return traceInfo.response_preview || traceInfo.response || traceInfo.trace_metadata?.['mlflow.traceOutputs'] || '';\n};\n\nconst isExpectationAssessment = (assessment: AssessmentV3): boolean => {\n  return Boolean(assessment.expectation);\n};\n\nconst LIST_TRACES_IGNORE_ASSESSMENTS = ['agent/latency_seconds'];\n\nfunction processExpectationAssessment(assessment: AssessmentV3, targets: Record<string, any>): void {\n  const assessmentName = assessment.assessment_name;\n  const assessmentValue = assessment.expectation?.value || assessment.expectation?.serialized_value?.value;\n\n  if (Array.isArray(assessmentValue) && assessmentValue.length > 0) {\n    targets[assessmentName] = assessmentValue.map((val) => {\n      return safelyParseValue(val);\n    });\n  } else if (typeof assessmentValue === 'string') {\n    targets[assessmentName] = safelyParseValue(assessmentValue);\n  } else {\n    targets[assessmentName] = [];\n  }\n}\n\nfunction processFeedbackAssessment(\n  assessment: AssessmentV3,\n  overallAssessments: RunEvaluationResultAssessment[],\n  responseAssessmentsByName: Record<string, RunEvaluationResultAssessment[]>,\n): void {\n  const assessmentName = assessment.assessment_name;\n  const evalResultAssessment = convertFeedbackAssessmentToRunEvalAssessment(assessment);\n\n  if (assessmentName === KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT) {\n    overallAssessments.push(evalResultAssessment);\n  }\n  if (!responseAssessmentsByName[assessmentName]) {\n    responseAssessmentsByName[assessmentName] = [];\n  }\n\n  responseAssessmentsByName[assessmentName].push(evalResultAssessment);\n}\n\nconst convertAssessmentV3Source = (assessment: AssessmentV3): RunEvaluationResultAssessmentSource | undefined => {\n  if (!assessment.source?.source_type) {\n    return undefined;\n  }\n  const sourceType = assessment.source?.source_type;\n\n  let runEvalSourceType: AssessmentType;\n  if (sourceType === 'LLM_JUDGE') {\n    runEvalSourceType = 'AI_JUDGE';\n  } else {\n    runEvalSourceType = sourceType;\n  }\n\n  return {\n    sourceType: runEvalSourceType,\n    sourceId: assessment.source?.source_id || '',\n    metadata: {},\n  };\n};\n\nconst convertFeedbackAssessmentToRunEvalAssessment = (assessment: AssessmentV3): RunEvaluationResultAssessment => {\n  const assessmentValue = assessment.feedback?.value;\n  const isOverallAssessment = assessment.assessment_name === KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT;\n  const source = convertAssessmentV3Source(assessment);\n  const error = assessment.feedback?.error || assessment.error;\n  return {\n    name: assessment.assessment_name,\n    stringValue: typeof assessmentValue === 'string' ? assessmentValue : undefined,\n    booleanValue: typeof assessmentValue === 'boolean' ? assessmentValue : undefined,\n    numericValue: typeof assessmentValue === 'number' ? assessmentValue : undefined,\n    errorCode: error?.error_code,\n    errorMessage: error?.error_message,\n    rationale: assessment.metadata?.[MLFLOW_ASSESSMENT_ROOT_CAUSE_RATIONALE] || assessment.rationale,\n    source,\n    rootCauseAssessment: isOverallAssessment\n      ? {\n          assessmentName: assessment.metadata?.[MLFLOW_ASSESSMENT_ROOT_CAUSE_ASSESSMENT] || '',\n          suggestedActions: assessment.metadata?.[MLFLOW_ASSESSMENT_SUGGESTED_ACTION],\n        }\n      : undefined,\n    metadata: assessment.metadata,\n  };\n};\n\nexport const convertTraceInfoV3ToRunEvalEntry = (traceInfo: TraceInfoV3): RunEvaluationTracesDataEntry => {\n  const evaluationId = getRowIdFromTrace(traceInfo);\n\n  // Prepare containers for our assessments.\n  const overallAssessments: RunEvaluationResultAssessment[] = [];\n  const responseAssessmentsByName: Record<string, RunEvaluationResultAssessment[]> = {};\n  const targets: Record<string, any> = {};\n\n  traceInfo.assessments?.forEach((assessment) => {\n    const assessmentName = assessment.assessment_name;\n    if (LIST_TRACES_IGNORE_ASSESSMENTS.includes(assessmentName)) {\n      return;\n    }\n    if (isExpectationAssessment(assessment)) {\n      processExpectationAssessment(assessment, targets);\n    } else {\n      processFeedbackAssessment(assessment, overallAssessments, responseAssessmentsByName);\n    }\n  });\n\n  // trace server has input/output in request/response field, and mlflow tracking server has it in the metadata\n  const rawInputs = getTraceInfoInputs(traceInfo);\n  const rawOutputs = getTraceInfoOutputs(traceInfo);\n\n  let inputsTitle = rawInputs;\n  let inputs: Record<string, any> = {};\n  let outputs: Record<string, any> = {};\n  try {\n    inputs = JSON.parse(rawInputs);\n\n    // Try to parse OpenAI messages\n    const messages = inputs['messages'];\n    if (Array.isArray(messages) && !isNil(messages[0]?.content)) {\n      inputsTitle = messages[messages.length - 1]?.content;\n    } else {\n      inputsTitle = stringifyValue(inputs);\n    }\n  } catch {\n    inputs = {\n      request: rawInputs,\n    };\n  }\n\n  try {\n    outputs = { response: JSON.parse(rawOutputs) };\n  } catch {\n    outputs = { response: rawOutputs };\n  }\n  return {\n    evaluationId,\n    requestId: traceInfo.client_request_id || evaluationId,\n    inputsId: evaluationId,\n    inputsTitle,\n    inputs,\n    outputs,\n    targets,\n    overallAssessments,\n    responseAssessmentsByName,\n    metrics: {},\n    traceInfo,\n  };\n};\n\nexport const applyTraceInfoV3ToEvalEntry = (\n  evalResults: RunEvaluationTracesDataEntry[],\n): RunEvaluationTracesDataEntry[] => {\n  if (!shouldUseTraceInfoV3(evalResults)) {\n    return evalResults;\n  }\n  return evalResults.map((result) => {\n    if (!result.traceInfo) {\n      return result;\n    }\n    // Convert the single TraceInfo to a single RunEvaluationTracesDataEntry\n    const converted = convertTraceInfoV3ToRunEvalEntry(result.traceInfo);\n    // Merge the newly converted fields with the existing data\n    return {\n      ...result,\n      ...converted,\n    };\n  });\n};\n\nexport const isTraceExportable = (entry: RunEvaluationTracesDataEntry) => {\n  let responseJson;\n  try {\n    responseJson = JSON.parse(entry.outputs['response']);\n  } catch {\n    if (!entry.outputs['response']) {\n      return false;\n    }\n    // entry.outputs.response may already be parsed in case of external monitors\n    // so try using it directly here.\n    responseJson = entry.outputs['response'];\n  }\n  if (isNil(responseJson)) {\n    return false;\n  }\n\n  const responseIsChatCompletion =\n    (Array.isArray(responseJson['messages']) && !isNil(responseJson['messages']?.[0]?.['content'])) ||\n    (Array.isArray(responseJson['choices']) && !isNil(responseJson['choices']?.[0]?.['message']?.['content']));\n\n  return responseIsChatCompletion;\n};\n\nexport function getRetrievedContextFromTrace(\n  responseAssessmentsByName: Record<string, RunEvaluationResultAssessment[]>,\n  trace: ModelTrace | undefined,\n): RunEvaluationTracesRetrievalChunk[] | undefined {\n  if (isNil(trace)) {\n    return undefined;\n  }\n  let docUriKey = 'doc_uri';\n  const tags = trace.info.tags as Record<string, string> | undefined;\n  if (tags?.['retrievers']) {\n    const retrieverInfos = safelyParseValue<{ doc_uri: string; chunk_id: string }[]>(tags['retrievers']);\n    if (typeof retrieverInfos === 'object' && retrieverInfos.length > 0) {\n      docUriKey = retrieverInfos[0].doc_uri;\n    }\n  }\n\n  const retrievalSpans = trace.data.spans.filter(\n    (span) =>\n      span.attributes?.['mlflow.spanType'] &&\n      safelyParseValue(span.attributes?.['mlflow.spanType']) === ModelTraceSpanType.RETRIEVER,\n  );\n  if (retrievalSpans.length === 0) {\n    return [];\n  }\n\n  // Return the last retrieval span chronologically since it is the one analyzed by our judges.\n  const spanOutputs = retrievalSpans.at(-1)?.attributes?.['mlflow.spanOutputs'];\n  if (!spanOutputs) {\n    return [];\n  }\n\n  const outputs = safelyParseValue(spanOutputs) as RetrieverDocument[];\n  if (!Array.isArray(outputs)) {\n    return [];\n  }\n\n  const retrievalChunks = outputs.map((doc, index) => {\n    return {\n      docUrl: doc.metadata?.[docUriKey],\n      content: doc.page_content,\n      retrievalAssessmentsByName: getRetrievalAssessmentsByName(responseAssessmentsByName, index),\n    };\n  });\n\n  return retrievalChunks;\n}\n\nconst getRetrievalAssessmentsByName = (\n  responseAssessmentsByName: Record<string, RunEvaluationResultAssessment[]>,\n  chunkIndex: number,\n): Record<string, RunEvaluationResultAssessment[]> => {\n  const filteredResponseAssessmentsByName = Object.fromEntries(\n    Object.entries(responseAssessmentsByName)\n      .map(([key, assessments]) => [\n        key,\n        assessments.filter((assessment) => Number(assessment?.metadata?.[MLFLOW_SPAN_OUTPUT_KEY]) === chunkIndex),\n      ])\n      .filter(([key, filteredAssessments]) => filteredAssessments.length > 0),\n  );\n\n  return filteredResponseAssessmentsByName;\n};\n","import type { RowSelectionState } from '@tanstack/react-table';\nimport { isNil } from 'lodash';\nimport { useCallback, useContext, useMemo, useState } from 'react';\n\nimport { Button, Tooltip, DropdownMenu, ChevronDownIcon } from '@databricks/design-system';\nimport { useIntl } from '@databricks/i18n';\n\nimport { GenAITracesTableContext } from './GenAITracesTableContext';\nimport { GenAiDeleteTraceModal } from './components/GenAiDeleteTraceModal';\nimport type { RunEvaluationTracesDataEntry, TraceActions, TraceInfoV3 } from './types';\nimport { shouldEnableTagGrouping } from './utils/FeatureUtils';\nimport { applyTraceInfoV3ToEvalEntry, convertTraceInfoV3ToModelTraceInfo, getRowIdFromTrace } from './utils/TraceUtils';\n\ninterface GenAITracesTableActionsProps {\n  experimentId: string;\n  // @deprecated\n  selectedTraces?: RunEvaluationTracesDataEntry[];\n  // @deprecated\n  setRowSelection?: React.Dispatch<React.SetStateAction<RowSelectionState>>;\n  traceActions?: TraceActions;\n  traceInfos: TraceInfoV3[] | undefined;\n}\n\nexport const GenAITracesTableActions = (props: GenAITracesTableActionsProps) => {\n  const { traceActions, experimentId, selectedTraces: selectedTracesFromProps, traceInfos, setRowSelection } = props;\n\n  const { table, selectedRowIds } = useContext(GenAITracesTableContext);\n\n  const selectedTracesFromContext: RunEvaluationTracesDataEntry[] | undefined = useMemo(\n    () =>\n      applyTraceInfoV3ToEvalEntry(\n        selectedRowIds\n          .map((rowId) => {\n            const traceInfo = traceInfos?.find((trace) => getRowIdFromTrace(trace) === rowId);\n            if (!traceInfo) {\n              return undefined;\n            }\n            return {\n              evaluationId: traceInfo.trace_id,\n              requestId: traceInfo.client_request_id || traceInfo.trace_id,\n              inputsId: traceInfo.trace_id,\n              inputs: {},\n              outputs: {},\n              targets: {},\n              overallAssessments: [],\n              responseAssessmentsByName: {},\n              metrics: {},\n              traceInfo,\n            };\n          })\n          .filter((trace) => !isNil(trace)),\n      ),\n    [selectedRowIds, traceInfos],\n  );\n\n  const selectedTraces: RunEvaluationTracesDataEntry[] = selectedTracesFromProps || selectedTracesFromContext;\n\n  return (\n    <TraceActionsDropdown\n      experimentId={experimentId}\n      selectedTraces={selectedTraces}\n      traceActions={traceActions}\n      setRowSelection={setRowSelection ?? table?.setRowSelection}\n    />\n  );\n};\n\ninterface TraceActionsDropdownProps {\n  experimentId: string;\n  selectedTraces: RunEvaluationTracesDataEntry[];\n  traceActions?: TraceActions;\n  setRowSelection: React.Dispatch<React.SetStateAction<RowSelectionState>> | undefined;\n}\n\nconst TraceActionsDropdown = (props: TraceActionsDropdownProps) => {\n  const { experimentId, selectedTraces, traceActions, setRowSelection } = props;\n  const intl = useIntl();\n  const [showDatasetModal, setShowDatasetModal] = useState(false);\n  const [showLabelingSessionModal, setShowLabelingSessionModal] = useState(false);\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\n\n  const handleExportToDatasets = useCallback(() => {\n    setShowDatasetModal(true);\n  }, []);\n\n  const handleExportToLabelingSessions = useCallback(() => {\n    setShowLabelingSessionModal(true);\n  }, []);\n\n  const handleEditTags = useCallback(() => {\n    if (selectedTraces.length === 1 && selectedTraces[0].traceInfo && traceActions?.editTags) {\n      const modelTrace = convertTraceInfoV3ToModelTraceInfo(selectedTraces[0].traceInfo);\n      traceActions.editTags.showEditTagsModalForTrace(modelTrace);\n    }\n  }, [selectedTraces, traceActions]);\n\n  const handleDeleteTraces = useCallback(() => {\n    setShowDeleteModal(true);\n  }, []);\n\n  const deleteTraces = useCallback(\n    async (experimentId: string, traceIds: string[]) => {\n      await traceActions?.deleteTracesAction?.deleteTraces(experimentId, traceIds);\n      setRowSelection?.({});\n    },\n    [setRowSelection, traceActions],\n  );\n\n  const hasExportAction = Boolean(traceActions?.exportToEvals?.getTrace);\n  const hasEditTagsAction = shouldEnableTagGrouping() && Boolean(traceActions?.editTags);\n  const hasDeleteAction = Boolean(traceActions?.deleteTracesAction);\n\n  const isEditTagsDisabled = selectedTraces.length > 1;\n  const noTracesSelected = selectedTraces.length === 0;\n  const noActionsAvailable = !hasExportAction && !hasEditTagsAction && !hasDeleteAction;\n\n  if (noActionsAvailable) {\n    return null;\n  }\n\n  const ActionButton = (\n    <Button\n      componentId=\"mlflow.genai-traces-table.actions-dropdown\"\n      disabled={noTracesSelected}\n      type=\"primary\"\n      endIcon={<ChevronDownIcon />}\n    >\n      {intl.formatMessage(\n        {\n          defaultMessage: 'Actions{count}',\n          description: 'Trace actions dropdown button',\n        },\n        {\n          count: noTracesSelected ? '' : ` (${selectedTraces.length})`,\n        },\n      )}\n    </Button>\n  );\n\n  return (\n    <>\n      <DropdownMenu.Root>\n        {noTracesSelected ? (\n          <Tooltip\n            componentId=\"mlflow.genai-traces-table.actions-disabled-tooltip\"\n            content={intl.formatMessage({\n              defaultMessage: 'Select one or more traces to add to an evaluation or edit the traces.',\n              description: 'Tooltip shown when actions button is disabled due to no trace selection',\n            })}\n          >\n            <div>\n              <DropdownMenu.Trigger asChild>{ActionButton}</DropdownMenu.Trigger>\n            </div>\n          </Tooltip>\n        ) : (\n          <DropdownMenu.Trigger asChild>{ActionButton}</DropdownMenu.Trigger>\n        )}\n        <DropdownMenu.Content>\n          {(hasEditTagsAction || hasDeleteAction) && (\n            <>\n              {hasExportAction && <DropdownMenu.Separator />}\n              <DropdownMenu.Group>\n                <DropdownMenu.Label>\n                  {intl.formatMessage({\n                    defaultMessage: 'Edit',\n                    description: 'Trace actions dropdown group label',\n                  })}\n                </DropdownMenu.Label>\n                {hasEditTagsAction && (\n                  <DropdownMenu.Item\n                    componentId=\"mlflow.genai-traces-table.edit-tags\"\n                    onClick={handleEditTags}\n                    disabled={isEditTagsDisabled}\n                  >\n                    {intl.formatMessage({\n                      defaultMessage: 'Edit tags',\n                      description: 'Edit tags action',\n                    })}\n                  </DropdownMenu.Item>\n                )}\n                {hasDeleteAction && (\n                  <DropdownMenu.Item componentId=\"mlflow.genai-traces-table.delete-traces\" onClick={handleDeleteTraces}>\n                    {intl.formatMessage({\n                      defaultMessage: 'Delete traces',\n                      description: 'Delete traces action',\n                    })}\n                  </DropdownMenu.Item>\n                )}\n              </DropdownMenu.Group>\n            </>\n          )}\n        </DropdownMenu.Content>\n      </DropdownMenu.Root>\n\n      {traceActions?.editTags?.EditTagsModal}\n\n      {showDeleteModal && traceActions?.deleteTracesAction && (\n        <GenAiDeleteTraceModal\n          experimentIds={[experimentId]}\n          visible={showDeleteModal}\n          selectedTraces={selectedTraces}\n          handleClose={() => setShowDeleteModal(false)}\n          deleteTraces={deleteTraces}\n        />\n      )}\n    </>\n  );\n};\n","import type { ColumnDef } from '@tanstack/react-table';\nimport { isNil } from 'lodash';\n\nimport { KnownEvaluationResultAssessmentName } from './enum';\nimport {\n  REQUEST_TIME_COLUMN_ID,\n  STATE_COLUMN_ID,\n  SOURCE_COLUMN_ID,\n  TAGS_COLUMN_ID,\n  EXECUTION_DURATION_COLUMN_ID,\n  TRACE_NAME_COLUMN_ID,\n  SORTABLE_INFO_COLUMNS,\n  TRACE_ID_COLUMN_ID,\n  SESSION_COLUMN_ID,\n  INPUTS_COLUMN_ID,\n  RESPONSE_COLUMN_ID,\n  USER_COLUMN_ID,\n  LOGGED_MODEL_COLUMN_ID,\n  TOKENS_COLUMN_ID,\n} from './hooks/useTableColumns';\nimport { TracesTableColumnGroup, TracesTableColumnType } from './types';\nimport type { TracesTableColumn, EvalTraceComparisonEntry, RunEvaluationTracesDataEntry, TraceInfoV3 } from './types';\nimport { getTraceInfoInputs, shouldUseTraceInfoV3 } from './utils/TraceUtils';\n\nconst GROUP_PRIORITY = [\n  TracesTableColumnGroup.INFO,\n  TracesTableColumnGroup.ASSESSMENT,\n  TracesTableColumnGroup.EXPECTATION,\n  TracesTableColumnGroup.TAG,\n] as const;\n\n/** Preferred order *within* the INFO group by column ID */\nconst INFO_COLUMN_PRIORITY = [\n  TRACE_ID_COLUMN_ID,\n  INPUTS_COLUMN_ID,\n  RESPONSE_COLUMN_ID,\n  SESSION_COLUMN_ID,\n  USER_COLUMN_ID,\n  TRACE_NAME_COLUMN_ID,\n  LOGGED_MODEL_COLUMN_ID,\n  TOKENS_COLUMN_ID,\n] as const;\n\n/** Preferred order *within* the ASSESSMENT group by column ID */\nconst ASSESSMENT_COLUMN_PRIORITY = [KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT] as const;\n\nconst groupRank: Record<TracesTableColumnGroup, number> = Object.fromEntries(\n  GROUP_PRIORITY.map((grp, idx) => [grp, idx]),\n) as any;\n\nconst infoColumnRank: Record<string, number> = Object.fromEntries(INFO_COLUMN_PRIORITY.map((id, idx) => [id, idx]));\n\nconst assessmentColumnRank: Record<string, number> = Object.fromEntries(\n  ASSESSMENT_COLUMN_PRIORITY.map((id, idx) => [id, idx]),\n);\n\nexport function sortGroupedColumns(columns: TracesTableColumn[], isComparing?: boolean): TracesTableColumn[] {\n  return [...columns].sort((colA, colB) => {\n    // If comparing, always put request time column first\n    if (isComparing) {\n      if (colA.id === INPUTS_COLUMN_ID) return -1;\n      if (colB.id === INPUTS_COLUMN_ID) return 1;\n    }\n\n    // 1) Compare their groups by precomputed rank\n    const groupA = colA.group ?? TracesTableColumnGroup.INFO;\n    const groupB = colB.group ?? TracesTableColumnGroup.INFO;\n    const groupComparison = groupRank[groupA] - groupRank[groupB];\n    if (groupComparison !== 0) return groupComparison;\n\n    // 2) Same group: INFO\n    if (groupA === TracesTableColumnGroup.INFO) {\n      const rankA = infoColumnRank[colA.id] ?? Infinity;\n      const rankB = infoColumnRank[colB.id] ?? Infinity;\n      if (rankA !== rankB) return rankA - rankB;\n      return colA.label.localeCompare(colB.label);\n    }\n\n    // 3) Same group: ASSESSMENT\n    if (groupA === TracesTableColumnGroup.ASSESSMENT) {\n      const rankA = assessmentColumnRank[colA.id] ?? Infinity;\n      const rankB = assessmentColumnRank[colB.id] ?? Infinity;\n      if (rankA !== rankB) return rankA - rankB;\n      return colA.label.localeCompare(colB.label);\n    }\n\n    // 4) Same group: EXPECTATION\n    if (groupA === TracesTableColumnGroup.EXPECTATION) {\n      return colA.label.localeCompare(colB.label);\n    }\n\n    // 5) Same group: TAG (or any other fallback)\n    return colA.label.localeCompare(colB.label);\n  });\n}\n\nexport const sortColumns = (columns: ColumnDef<EvalTraceComparisonEntry>[], selectedColumns: TracesTableColumn[]) => {\n  return columns.sort((a, b) => {\n    const getPriority = (col: typeof a) => {\n      const colType = selectedColumns.find((c) => c.id === col.id)?.type;\n\n      if (colType === TracesTableColumnType.INPUT) return 1;\n      if (col.id === TRACE_NAME_COLUMN_ID) return 2;\n      if (colType === TracesTableColumnType.TRACE_INFO) return 3;\n      if (colType === TracesTableColumnType.INTERNAL_MONITOR_REQUEST_TIME) return 4;\n      if (colType === TracesTableColumnType.ASSESSMENT) return 5;\n      return 999; // keep any other columns after the known ones\n    };\n\n    // primary sort key: our priority number\n    const diff = getPriority(a) - getPriority(b);\n    if (diff !== 0) return diff;\n\n    // secondary key: for assessment columns, prioritize 'Overall' and then sort alphabetically by label\n    const aCol = selectedColumns.find((c) => c.id === a.id);\n    const bCol = selectedColumns.find((c) => c.id === b.id);\n    if (aCol?.type === TracesTableColumnType.ASSESSMENT && bCol?.type === TracesTableColumnType.ASSESSMENT) {\n      if (aCol.id === KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT) return -1;\n      if (bCol.id === KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT) return 1;\n      return (aCol.label || '').localeCompare(bCol.label || '');\n    }\n\n    // tertiary key: original array order (stable sort fallback)\n    return 0;\n  });\n};\n\nexport const traceInfoSortingFn = (\n  traceInfoA: TraceInfoV3 | undefined,\n  traceInfoB: TraceInfoV3 | undefined,\n  colId: string,\n) => {\n  // only support sorting by request time for now\n  if (!SORTABLE_INFO_COLUMNS.includes(colId)) {\n    return 0;\n  }\n\n  const aVal = String(getTraceInfoValueWithColId(traceInfoA as TraceInfoV3, colId) ?? '');\n  const bVal = String(getTraceInfoValueWithColId(traceInfoB as TraceInfoV3, colId) ?? '');\n\n  return aVal.localeCompare(bVal, undefined, { numeric: true });\n};\n\nexport const getTraceInfoValueWithColId = (traceInfo: TraceInfoV3, colId: string) => {\n  switch (colId) {\n    case REQUEST_TIME_COLUMN_ID:\n    case EXECUTION_DURATION_COLUMN_ID:\n    case TAGS_COLUMN_ID:\n    case STATE_COLUMN_ID:\n      return traceInfo[colId];\n    case SOURCE_COLUMN_ID:\n      return traceInfo.tags;\n    case TRACE_ID_COLUMN_ID:\n      return traceInfo.trace_id;\n    case SESSION_COLUMN_ID:\n      return traceInfo.tags?.['mlflow.trace.session'];\n    default:\n      throw new Error(`Unknown column id: ${colId}`);\n  }\n};\n\nfunction getUniqueInputRequests(\n  evaluationResults: RunEvaluationTracesDataEntry[],\n): Map<string, RunEvaluationTracesDataEntry> {\n  const resultMap = new Map<string, RunEvaluationTracesDataEntry>();\n  // If there are duplicate input ids, we need to append a count to the key to ensure uniqueness.\n  const duplicateIndexMap = new Map<string, number>();\n\n  evaluationResults?.forEach((entry) => {\n    let key = shouldUseTraceInfoV3([entry]) ? getTraceInfoInputs(entry.traceInfo as TraceInfoV3) : entry.inputsId;\n    if (resultMap.has(key)) {\n      const currentCount = duplicateIndexMap.get(entry.inputsId) || 0;\n      const newCount = currentCount + 1;\n      duplicateIndexMap.set(entry.inputsId, newCount);\n      key = `${entry.inputsId}_${newCount}`;\n    }\n    resultMap.set(key, entry);\n  });\n  return resultMap;\n}\n\nexport function computeEvaluationsComparison(\n  currentRunEvalResults: RunEvaluationTracesDataEntry[],\n  otherRunEvalResults?: RunEvaluationTracesDataEntry[],\n): EvalTraceComparisonEntry[] {\n  if (isNil(otherRunEvalResults)) {\n    return currentRunEvalResults.map((entry) => ({ currentRunValue: entry }));\n  }\n\n  // TODO(nsthorat): This logic does not work when a single eval run contains the same input ids, e.g. there is multiple evals with the same\n  // input id. This is a bug in the current implementation.\n\n  // Merge the two eval results by joining on inputsId. There may be results that are only present in one of the two.\n  const otherRunEvalResultsMap = getUniqueInputRequests(otherRunEvalResults);\n\n  const currentRunEvalResultsMap = getUniqueInputRequests(currentRunEvalResults);\n  const allRequestIds = new Set([...currentRunEvalResultsMap.keys(), ...otherRunEvalResultsMap.keys()]);\n\n  return Array.from(allRequestIds).map((inputsId) => {\n    return {\n      currentRunValue: currentRunEvalResultsMap.get(inputsId),\n      otherRunValue: otherRunEvalResultsMap.get(inputsId),\n    };\n  });\n}\n","import { DangerIcon, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nexport const ErrorCell = () => {\n  const { theme } = useDesignSystemTheme();\n  return (\n    <span\n      css={{\n        display: 'flex',\n        alignItems: 'center',\n        gap: theme.spacing.sm,\n        svg: { width: '12px', height: '12px' },\n        color: theme.colors.textValidationWarning,\n      }}\n    >\n      <DangerIcon css={{ color: theme.colors.textValidationWarning }} />\n      <FormattedMessage defaultMessage=\"Error\" description=\"Error status in the evaluations table.\" />{' '}\n    </span>\n  );\n};\n","import { useDesignSystemTheme } from '@databricks/design-system';\n\nexport const NullCell = ({ isComparing }: { isComparing?: boolean }) => {\n  const { theme } = useDesignSystemTheme();\n\n  return (\n    <span\n      css={{\n        height: '20px',\n      }}\n    >\n      {isComparing && <span css={{ fontStyle: 'italic', color: theme.colors.textSecondary }}>null</span>}\n    </span>\n  );\n};\n","import { useDesignSystemTheme } from '@databricks/design-system';\n\nexport interface StackedComponentsProps {\n  first: React.ReactNode;\n  second?: React.ReactNode;\n  // Allow overriding the default styles if needed:\n  gap?: string;\n  borderRadius?: string;\n  marginY?: string;\n}\n\nexport const StackedComponents = (props: StackedComponentsProps) => {\n  const { first, second, gap, borderRadius, marginY } = props;\n  const { theme } = useDesignSystemTheme();\n\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexDirection: 'column',\n        gap: gap || theme.spacing.sm,\n        borderRadius: borderRadius || theme.legacyBorders.borderRadiusMd,\n        marginTop: marginY || 'auto',\n        marginBottom: marginY || 'auto',\n      }}\n    >\n      {first}\n      {second}\n    </div>\n  );\n};\n","import { getDefaultHeaders } from '@mlflow/mlflow/src/common/utils/FetchUtils';\nimport { matchPredefinedError } from '../../errors';\n\n// eslint-disable-next-line no-restricted-globals\nexport const fetchFn = fetch; // use global fetch for oss\n\nexport const makeRequest = async <T>(path: string, method: 'POST' | 'GET', body?: T) => {\n  const options: RequestInit = {\n    method,\n    headers: {\n      ...(body ? { 'Content-Type': 'application/json' } : {}),\n      ...getDefaultHeaders(document.cookie),\n    },\n  };\n\n  if (body) {\n    options.body = JSON.stringify(body);\n  }\n  const response = await fetchFn(path, options);\n\n  if (!response.ok) {\n    const error = matchPredefinedError(response);\n    try {\n      const errorMessageFromResponse = await (await response.json()).message;\n      if (errorMessageFromResponse) {\n        error.message = errorMessageFromResponse;\n      }\n    } catch {\n      // do nothing\n    }\n    throw error;\n  }\n\n  return response.json();\n};\n\nexport const getAjaxUrl = (relativeUrl: any) => {\n  if (process.env['MLFLOW_USE_ABSOLUTE_AJAX_URLS'] === 'true' && !relativeUrl.startsWith('/')) {\n    return '/' + relativeUrl;\n  }\n  return relativeUrl;\n};\n","/**\n * This file is a subset of functions from mlflow/web/js/src/common/Utils.tsx\n */\nimport type { TraceInfoV3 } from '../types';\n\n// eslint-disable-next-line @typescript-eslint/no-extraneous-class -- TODO(FEINF-4274)\nclass MlflowUtils {\n  static runNameTag = 'mlflow.runName';\n  static sourceNameTag = 'mlflow.source.name';\n  static sourceTypeTag = 'mlflow.source.type';\n  static entryPointTag = 'mlflow.project.entryPoint';\n\n  static getEntryPointName(runTags: any) {\n    const entryPointTag = runTags[MlflowUtils.entryPointTag];\n    if (entryPointTag) {\n      return entryPointTag.value;\n    }\n    return '';\n  }\n\n  static getSourceType(runTags: any) {\n    const sourceTypeTag = runTags[MlflowUtils.sourceTypeTag];\n    if (sourceTypeTag) {\n      return sourceTypeTag.value;\n    }\n    return '';\n  }\n\n  static dropExtension(path: any) {\n    return path.replace(/(.*[^/])\\.[^/.]+$/, '$1');\n  }\n\n  static baseName(path: any) {\n    const pieces = path.split('/');\n    return pieces[pieces.length - 1];\n  }\n\n  /**\n   * Renders the source name and entry point into a string. Used for sorting.\n   * @param run MlflowMessages.RunInfo\n   */\n  static formatSource(tags: any) {\n    const sourceName = MlflowUtils.getSourceName(tags);\n    const sourceType = MlflowUtils.getSourceType(tags);\n    const entryPointName = MlflowUtils.getEntryPointName(tags);\n    if (sourceType === 'PROJECT') {\n      let res = MlflowUtils.dropExtension(MlflowUtils.baseName(sourceName));\n      if (entryPointName && entryPointName !== 'main') {\n        res += ':' + entryPointName;\n      }\n      return res;\n    } else if (sourceType === 'JOB') {\n      const jobIdTag = 'mlflow.databricks.jobID';\n      const jobRunIdTag = 'mlflow.databricks.jobRunID';\n      const jobId = tags && tags[jobIdTag] && tags[jobIdTag].value;\n      const jobRunId = tags && tags[jobRunIdTag] && tags[jobRunIdTag].value;\n      if (jobId && jobRunId) {\n        return MlflowUtils.getDefaultJobRunName(jobId, jobRunId);\n      }\n      return sourceName;\n    } else {\n      return MlflowUtils.baseName(sourceName);\n    }\n  }\n\n  static getDefaultJobRunName(jobId: any, runId: any, workspaceId = null) {\n    if (!jobId) {\n      return '-';\n    }\n    let name = `job ${jobId}`;\n    if (runId) {\n      name = `run ${runId} of ` + name;\n    }\n    if (workspaceId) {\n      name = `workspace ${workspaceId}: ` + name;\n    }\n    return name;\n  }\n\n  static getSourceName(runTags: any) {\n    const sourceNameTag = runTags[MlflowUtils.sourceNameTag];\n    if (sourceNameTag) {\n      return sourceNameTag.value;\n    }\n    return '';\n  }\n\n  static getGitHubRegex() {\n    return /[@/]github.com[:/]([^/.]+)\\/([^/#]+)#?(.*)/;\n  }\n\n  static getGitLabRegex() {\n    return /[@/]gitlab.com[:/]([^/.]+)\\/([^/#]+)#?(.*)/;\n  }\n\n  static getBitbucketRegex() {\n    return /[@/]bitbucket.org[:/]([^/.]+)\\/([^/#]+)#?(.*)/;\n  }\n\n  static getRunPageRoute(experimentId: string, runUuid: string) {\n    return `/experiments/${experimentId}/runs/${runUuid}`;\n  }\n\n  static getLoggedModelPageRoute(experimentId: string, loggedModelId: string) {\n    return `/experiments/${experimentId}/models/${loggedModelId}`;\n  }\n\n  /**\n   * Regular expression for URLs containing the string 'git'.\n   * It can be a custom git domain (e.g. https://git.custom.in/repo/dir#file/dir).\n   * Excluding the first overall match, there are three groups:\n   *    git url, repo directory, and file directory.\n   * (e.g. group1: https://custom.git.domain, group2: repo/directory, group3: project/directory)\n   */\n  static getGitRegex() {\n    return /(.*?[@/][^?]*git.*?)[:/]([^#]+)(?:#(.*))?/;\n  }\n\n  static getGitRepoUrl(sourceName: any, branchName = 'master') {\n    const gitHubMatch = sourceName.match(MlflowUtils.getGitHubRegex());\n    const gitLabMatch = sourceName.match(MlflowUtils.getGitLabRegex());\n    const bitbucketMatch = sourceName.match(MlflowUtils.getBitbucketRegex());\n    const gitMatch = sourceName.match(MlflowUtils.getGitRegex());\n    let url = null;\n    if (gitHubMatch) {\n      url = `https://github.com/${gitHubMatch[1]}/${gitHubMatch[2].replace(/.git/, '')}`;\n      if (gitHubMatch[3]) {\n        url += `/tree/${branchName}/${gitHubMatch[3]}`;\n      }\n    } else if (gitLabMatch) {\n      url = `https://gitlab.com/${gitLabMatch[1]}/${gitLabMatch[2].replace(/.git/, '')}`;\n      if (gitLabMatch[3]) {\n        url += `/-/tree/${branchName}/${gitLabMatch[3]}`;\n      }\n    } else if (bitbucketMatch) {\n      url = `https://bitbucket.org/${bitbucketMatch[1]}/${bitbucketMatch[2].replace(/.git/, '')}`;\n      if (bitbucketMatch[3]) {\n        url += `/src/${branchName}/${bitbucketMatch[3]}`;\n      }\n    } else if (gitMatch) {\n      const [, baseUrl, repoDir, fileDir] = gitMatch;\n      url = baseUrl.replace(/git@/, 'https://') + '/' + repoDir.replace(/.git/, '');\n      if (fileDir) {\n        url += `/tree/${branchName}/${fileDir}`;\n      }\n    }\n    return url;\n  }\n\n  static getNotebookRevisionId(tags: any) {\n    const revisionIdTag = 'mlflow.databricks.notebookRevisionID';\n    return tags && tags[revisionIdTag] && tags[revisionIdTag].value;\n  }\n\n  static getNotebookId(tags: any) {\n    const notebookIdTag = 'mlflow.databricks.notebookID';\n    return tags && tags[notebookIdTag] && tags[notebookIdTag].value;\n  }\n\n  /**\n   * Check if the given workspaceId matches the current workspaceId.\n   * @param workspaceId\n   * @returns {boolean}\n   */\n  static isCurrentWorkspace(workspaceId: any) {\n    return true;\n  }\n\n  static getDefaultNotebookRevisionName(notebookId: any, revisionId: any, workspaceId = null) {\n    if (!notebookId) {\n      return '-';\n    }\n    let name = `notebook ${notebookId}`;\n    if (revisionId) {\n      name = `revision ${revisionId} of ` + name;\n    }\n    if (workspaceId) {\n      name = `workspace ${workspaceId}: ` + name;\n    }\n    return name;\n  }\n\n  /**\n   * Makes sure that the URL begins with correct scheme according\n   * to RFC3986 [https://datatracker.ietf.org/doc/html/rfc3986#section-3.1]\n   * It does not support slash-less schemes (e.g. news:abc, urn:anc).\n   * @param url URL string like \"my-mlflow-server.com/#/experiments/9\" or\n   *        \"https://my-mlflow-server.com/#/experiments/9\"\n   * @param defaultScheme scheme to add if missing in the provided URL, defaults to \"https\"\n   * @returns {string} the URL string with ensured default scheme\n   */\n  static ensureUrlScheme(url: any, defaultScheme = 'https') {\n    // Falsy values should yield itself\n    if (!url) return url;\n\n    // Scheme-less URL with colon and dashes\n    if (url.match(/^:\\/\\//i)) {\n      return `${defaultScheme}${url}`;\n    }\n\n    // URL without scheme, colon nor dashes\n    if (!url.match(/^[a-z1-9+-.]+:\\/\\//i)) {\n      return `${defaultScheme}://${url}`;\n    }\n\n    // Pass-through for \"correct\" entries\n    return url;\n  }\n\n  /**\n   * Returns a copy of the provided URL with its query parameters set to `queryParams`.\n   * @param url URL string like \"http://my-mlflow-server.com/#/experiments/9.\n   * @param queryParams Optional query parameter string like \"?param=12345\". Query params provided\n   *        via this string will override existing query param values in `url`\n   */\n  static setQueryParams(url: any, queryParams: any) {\n    // Using new URL() is the preferred way of constructing the URL object,\n    // however according to [https://url.spec.whatwg.org/#constructors] it requires\n    // providing the protocol. We're gracefully ensuring that the scheme exists here.\n    const urlObj = new URL(MlflowUtils.ensureUrlScheme(url));\n    urlObj.search = queryParams || '';\n    return urlObj.toString();\n  }\n\n  /**\n   * Returns the URL for the notebook source.\n   */\n  static getNotebookSourceUrl(queryParams: any, notebookId: any, revisionId: any, runUuid: any, workspaceUrl = null) {\n    let url = MlflowUtils.setQueryParams(workspaceUrl || window.location.origin, queryParams);\n    url += `#notebook/${notebookId}`;\n    if (revisionId) {\n      url += `/revision/${revisionId}`;\n      if (runUuid) {\n        url += `/mlflow/run/${runUuid}`;\n      }\n    }\n    return url;\n  }\n\n  /**\n   * Renders the notebook source name and entry point into an HTML element. Used for display.\n   */\n  static renderNotebookSource(\n    queryParams: any,\n    notebookId: any,\n    revisionId: any,\n    runUuid: any,\n    sourceName: any,\n    workspaceUrl = null,\n    nameOverride: string | null = null,\n  ) {\n    // sourceName may not be present when rendering feature table notebook consumers from remote\n    // workspaces or when notebook fetcher failed to fetch the sourceName. Always provide a default\n    // notebook name in such case.\n    const baseName = sourceName\n      ? MlflowUtils.baseName(sourceName)\n      : MlflowUtils.getDefaultNotebookRevisionName(notebookId, revisionId);\n    const name = nameOverride || baseName;\n\n    if (notebookId) {\n      const url = MlflowUtils.getNotebookSourceUrl(queryParams, notebookId, revisionId, runUuid, workspaceUrl);\n      return (\n        <a\n          title={sourceName || MlflowUtils.getDefaultNotebookRevisionName(notebookId, revisionId)}\n          href={url}\n          target=\"_top\"\n        >\n          {name}\n        </a>\n      );\n    } else {\n      return name;\n    }\n  }\n\n  /**\n   * Set query params and returns the updated query params.\n   * @returns {string} updated query params\n   */\n  static addQueryParams(currentQueryParams: any, newQueryParams: any) {\n    if (!newQueryParams || Object.keys(newQueryParams).length === 0) {\n      return currentQueryParams;\n    }\n    const urlSearchParams = new URLSearchParams(currentQueryParams);\n    Object.entries(newQueryParams).forEach(\n      // @ts-expect-error TS(2345): Argument of type 'unknown' is not assignable to pa... Remove this comment to see the full error message\n      ([key, value]) => Boolean(key) && Boolean(value) && urlSearchParams.set(key, value),\n    );\n    const queryParams = urlSearchParams.toString();\n    if (queryParams !== '' && !queryParams.includes('?')) {\n      return `?${queryParams}`;\n    }\n    return queryParams;\n  }\n\n  /**\n   * Returns the URL for the job source.\n   */\n  static getJobSourceUrl(queryParams: any, jobId: any, jobRunId: any, workspaceUrl = null) {\n    let url = MlflowUtils.setQueryParams(workspaceUrl || window.location.origin, queryParams);\n    url += `#job/${jobId}`;\n    if (jobRunId) {\n      url += `/run/${jobRunId}`;\n    }\n    return url;\n  }\n\n  /**\n   * Renders the job source name and entry point into an HTML element. Used for display.\n   */\n  static renderJobSource(\n    queryParams: any,\n    jobId: any,\n    jobRunId: any,\n    jobName: any,\n    workspaceUrl = null,\n    nameOverride: string | null = null,\n  ) {\n    // jobName may not be present when rendering feature table job consumers from remote\n    // workspaces or when getJob API failed to fetch the jobName. Always provide a default\n    // job name in such case.\n    const reformatJobName = jobName || MlflowUtils.getDefaultJobRunName(jobId, jobRunId);\n    const name = nameOverride || reformatJobName;\n\n    if (jobId) {\n      const url = MlflowUtils.getJobSourceUrl(queryParams, jobId, jobRunId, workspaceUrl);\n      return (\n        <a title={reformatJobName} href={url} target=\"_top\">\n          {name}\n        </a>\n      );\n    } else {\n      return name;\n    }\n  }\n\n  /**\n   * Renders the source name and entry point into an HTML element. Used for display.\n   * @param tags Object containing tag key value pairs.\n   * @param queryParams Query params to add to certain source type links.\n   * @param runUuid ID of the MLflow run to add to certain source (revision) links.\n   */\n  static renderSource(tags: any, queryParams: any, runUuid: any, branchName = 'master') {\n    const sourceName = MlflowUtils.getSourceName(tags);\n    let res = MlflowUtils.formatSource(tags);\n    const gitRepoUrlOrNull = MlflowUtils.getGitRepoUrl(sourceName, branchName);\n    if (gitRepoUrlOrNull) {\n      res = (\n        <a target=\"_top\" href={gitRepoUrlOrNull}>\n          {res}\n        </a>\n      );\n    }\n    const sourceType = MlflowUtils.getSourceType(tags);\n    if (sourceType === 'NOTEBOOK') {\n      const revisionId = MlflowUtils.getNotebookRevisionId(tags);\n      const notebookId = MlflowUtils.getNotebookId(tags);\n      const workspaceIdTag = 'mlflow.databricks.workspaceID';\n      const workspaceId = tags && tags[workspaceIdTag] && tags[workspaceIdTag].value;\n      if (MlflowUtils.isCurrentWorkspace(workspaceId)) {\n        return MlflowUtils.renderNotebookSource(queryParams, notebookId, revisionId, runUuid, sourceName, null);\n      } else {\n        const workspaceUrlTag = 'mlflow.databricks.workspaceURL';\n        const workspaceUrl = tags && tags[workspaceUrlTag] && tags[workspaceUrlTag].value;\n        const notebookQueryParams = MlflowUtils.addQueryParams(queryParams, { o: workspaceId });\n        return MlflowUtils.renderNotebookSource(\n          notebookQueryParams,\n          notebookId,\n          revisionId,\n          runUuid,\n          sourceName,\n          workspaceUrl,\n        );\n      }\n    }\n    if (sourceType === 'JOB') {\n      const jobIdTag = 'mlflow.databricks.jobID';\n      const jobRunIdTag = 'mlflow.databricks.jobRunID';\n      const jobId = tags && tags[jobIdTag] && tags[jobIdTag].value;\n      const jobRunId = tags && tags[jobRunIdTag] && tags[jobRunIdTag].value;\n      const workspaceIdTag = 'mlflow.databricks.workspaceID';\n      const workspaceId = tags && tags[workspaceIdTag] && tags[workspaceIdTag].value;\n      if (MlflowUtils.isCurrentWorkspace(workspaceId)) {\n        return MlflowUtils.renderJobSource(queryParams, jobId, jobRunId, res, null);\n      } else {\n        const workspaceUrlTag = 'mlflow.databricks.workspaceURL';\n        const workspaceUrl = tags && tags[workspaceUrlTag] && tags[workspaceUrlTag].value;\n        const jobQueryParams = MlflowUtils.addQueryParams(queryParams, { o: workspaceId });\n        return MlflowUtils.renderJobSource(jobQueryParams, jobId, jobRunId, res, workspaceUrl);\n      }\n    }\n    return res;\n  }\n\n  static renderSourceFromMetadata(traceInfoV3: TraceInfoV3) {\n    const sourceName = traceInfoV3.trace_metadata?.[MlflowUtils.sourceNameTag];\n    const sourceType = traceInfoV3.trace_metadata?.[MlflowUtils.sourceTypeTag];\n    let res = sourceName ? MlflowUtils.baseName(sourceName) : '';\n\n    // Handle git repository links using explicit git metadata\n    const gitRepoUrl = traceInfoV3.trace_metadata?.['mlflow.source.git.repoURL'];\n    const gitBranch = traceInfoV3.trace_metadata?.['mlflow.source.git.branch'];\n    const gitCommit = traceInfoV3.trace_metadata?.['mlflow.source.git.commit'];\n\n    if (gitRepoUrl) {\n      // Convert SSH URL to HTTPS if needed\n      const httpsUrl = gitRepoUrl\n        .replace('git@github.com:', 'https://github.com/')\n        .replace('git@gitlab.com:', 'https://gitlab.com/')\n        .replace('git@bitbucket.org:', 'https://bitbucket.org/')\n        .replace('.git', '');\n\n      // Use commit hash if available, otherwise use branch\n      const ref = gitCommit || gitBranch || 'master';\n      const filePath = sourceName ? `/${sourceName}` : '';\n\n      // Construct URL based on the git host\n      let url = httpsUrl;\n      if (httpsUrl.includes('github.com')) {\n        url = `${httpsUrl}/tree/${ref}${filePath}`;\n      } else if (httpsUrl.includes('gitlab.com')) {\n        url = `${httpsUrl}/-/tree/${ref}${filePath}`;\n      } else if (httpsUrl.includes('bitbucket.org')) {\n        url = `${httpsUrl}/src/${ref}${filePath}`;\n      } else {\n        // For other git hosts, just append the ref and file path\n        url = `${httpsUrl}/tree/${ref}${filePath}`;\n      }\n\n      res = (\n        <a target=\"_blank\" rel=\"noopener noreferrer\" href={url}>\n          {res}\n        </a>\n      );\n    }\n\n    if (sourceType === 'NOTEBOOK') {\n      const revisionId = traceInfoV3.trace_metadata?.['mlflow.databricks.notebookRevisionID'];\n      const notebookId = traceInfoV3.trace_metadata?.['mlflow.databricks.notebookID'];\n      const workspaceId = traceInfoV3.trace_metadata?.['mlflow.databricks.workspaceID'];\n\n      if (MlflowUtils.isCurrentWorkspace(workspaceId)) {\n        return MlflowUtils.renderNotebookSource(null, notebookId, revisionId, null, sourceName, null);\n      } else {\n        const workspaceUrlTag = 'mlflow.databricks.workspaceURL';\n        const workspaceUrl: any = traceInfoV3.trace_metadata?.[workspaceUrlTag] || undefined;\n        const notebookQueryParams = MlflowUtils.addQueryParams(null, { o: workspaceId });\n        return MlflowUtils.renderNotebookSource(\n          notebookQueryParams,\n          notebookId,\n          revisionId,\n          null,\n          sourceName,\n          workspaceUrl,\n        );\n      }\n    }\n\n    if (sourceType === 'JOB') {\n      const jobId = traceInfoV3.trace_metadata?.['mlflow.databricks.jobID'];\n      const jobRunId = traceInfoV3.trace_metadata?.['mlflow.databricks.jobRunID'];\n      const workspaceId = traceInfoV3.trace_metadata?.['mlflow.databricks.workspaceID'];\n\n      if (MlflowUtils.isCurrentWorkspace(workspaceId)) {\n        return MlflowUtils.renderJobSource(null, jobId, jobRunId, res, null);\n      } else {\n        const workspaceUrlTag = 'mlflow.databricks.workspaceURL';\n        const workspaceUrl: any = traceInfoV3.trace_metadata?.[workspaceUrlTag] || undefined;\n        const jobQueryParams = MlflowUtils.addQueryParams(null, { o: workspaceId });\n        return MlflowUtils.renderJobSource(jobQueryParams, jobId, jobRunId, res, workspaceUrl);\n      }\n    }\n\n    return res;\n  }\n}\n\nexport default MlflowUtils;\n","import { isNil } from 'lodash';\n\nimport {\n  ModelsIcon,\n  ParagraphSkeleton,\n  Typography,\n  Tooltip,\n  Tag,\n  useDesignSystemTheme,\n} from '@databricks/design-system';\nimport { useQuery } from '@databricks/web-shared/query-client';\n\nimport { ErrorCell } from './ErrorCell';\nimport { NullCell } from './NullCell';\nimport { StackedComponents } from './StackedComponents';\nimport type { TraceInfoV3 } from '../types';\nimport { getAjaxUrl, makeRequest } from '../utils/FetchUtils';\nimport MlflowUtils from '../utils/MlflowUtils';\nimport { Link } from '../utils/RoutingUtils';\n\nexport const LoggedModelCell = (props: {\n  experimentId: string;\n  currentTraceInfo?: TraceInfoV3;\n  otherTraceInfo?: TraceInfoV3;\n  isComparing: boolean;\n}) => {\n  const { experimentId, currentTraceInfo, otherTraceInfo, isComparing } = props;\n  const currentModelId = currentTraceInfo?.trace_metadata?.['mlflow.modelId'];\n  const otherModelId = otherTraceInfo?.trace_metadata?.['mlflow.modelId'];\n\n  return (\n    <StackedComponents\n      first={\n        currentModelId ? (\n          <LoggedModelComponent experimentId={experimentId} modelId={currentModelId} isComparing={isComparing} />\n        ) : (\n          <NullCell isComparing={isComparing} />\n        )\n      }\n      second={\n        isComparing &&\n        (otherModelId ? (\n          <LoggedModelComponent experimentId={experimentId} modelId={otherModelId} isComparing={isComparing} />\n        ) : (\n          <NullCell isComparing={isComparing} />\n        ))\n      }\n    />\n  );\n};\n\nconst LoggedModelComponent = (props: { experimentId: string; modelId: string; isComparing: boolean }) => {\n  const { experimentId, modelId, isComparing } = props;\n  const { theme } = useDesignSystemTheme();\n\n  const { data, isLoading, error } = useLoggedModelName({ loggedModelId: modelId });\n  const modelName = data?.info?.name;\n\n  if (isLoading) {\n    return <ParagraphSkeleton />;\n  }\n\n  if (error) {\n    return <ErrorCell />;\n  }\n\n  if (!modelName) {\n    return <NullCell isComparing={isComparing} />;\n  }\n\n  return (\n    <Tooltip componentId=\"mlflow.eval-runs.model-version-cell-tooltip\" content={modelName}>\n      <Tag\n        componentId=\"mlflow.eval-runs.model-version-cell\"\n        id=\"model-version-cell\"\n        css={{ width: 'fit-content', maxWidth: '100%', marginRight: 0, cursor: 'pointer' }}\n      >\n        <Link\n          to={MlflowUtils.getLoggedModelPageRoute(experimentId, modelId)}\n          target=\"_blank\"\n          css={{\n            maxWidth: '100%',\n            display: 'block',\n            overflow: 'hidden',\n            textOverflow: 'ellipsis',\n            whiteSpace: 'nowrap',\n          }}\n          title={modelName}\n        >\n          <div\n            css={{\n              display: 'flex',\n              alignItems: 'center',\n              gap: theme.spacing.xs,\n              maxWidth: '100%',\n            }}\n          >\n            <ModelsIcon css={{ color: theme.colors.textPrimary, fontSize: 16 }} />\n            <Typography.Text css={{ overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>\n              {modelName}\n            </Typography.Text>\n          </div>\n        </Link>\n      </Tag>\n    </Tooltip>\n  );\n};\n\ninterface LoggedModelNameResponse {\n  model: {\n    info: {\n      name?: string;\n    };\n  };\n}\n\n/**\n * Retrieve logged model from API based on its ID\n */\nconst useLoggedModelName = ({ loggedModelId }: { loggedModelId?: string }) => {\n  const { data, isLoading, isFetching, refetch, error } = useQuery<LoggedModelNameResponse, Error>({\n    queryKey: ['loggedModelName', loggedModelId],\n    queryFn: async () => {\n      const res: LoggedModelNameResponse = await makeRequest(\n        getAjaxUrl(`ajax-api/2.0/mlflow/logged-models/${loggedModelId}`),\n        'GET',\n      );\n      return res;\n    },\n    cacheTime: Infinity,\n    staleTime: Infinity,\n    refetchOnMount: false,\n    retry: 1,\n    enabled: !isNil(loggedModelId),\n  });\n\n  return {\n    isLoading,\n    isFetching,\n    data: data?.model,\n    refetch,\n    error,\n  } as const;\n};\n","import { ParagraphSkeleton } from '@databricks/design-system';\nimport type { NetworkRequestError } from '@databricks/web-shared/errors';\nimport { useQuery } from '@databricks/web-shared/query-client';\n\nimport { ErrorCell } from './ErrorCell';\nimport { NullCell } from './NullCell';\nimport { getAjaxUrl, makeRequest } from '../utils/FetchUtils';\nimport MlflowUtils from '../utils/MlflowUtils';\nimport { Link } from '../utils/RoutingUtils';\n\nexport const RunName = (props: { experimentId: string; runUuid: string }) => {\n  const { experimentId, runUuid } = props;\n\n  const { data, isLoading, error } = useRunName(experimentId, runUuid);\n\n  const runName = data?.runs?.[0]?.info?.run_name;\n\n  if (isLoading) {\n    return <ParagraphSkeleton />;\n  }\n\n  if (error) {\n    return <ErrorCell />;\n  }\n\n  if (!runName) {\n    return <NullCell />;\n  }\n\n  return (\n    <Link\n      css={{\n        display: 'flex',\n        maxWidth: '100%',\n        textOverflow: 'ellipsis',\n        overflow: 'hidden',\n        whiteSpace: 'nowrap',\n      }}\n      to={MlflowUtils.getRunPageRoute(experimentId, runUuid)}\n      title={runName}\n    >\n      {runName}\n    </Link>\n  );\n};\n\ninterface RunNameResponse {\n  runs: {\n    data: {\n      tags: { [key: string]: string };\n    };\n    info: {\n      run_name: string;\n    };\n  }[];\n}\nconst useRunName = (experimentId: string, runUuid: string) => {\n  return useQuery<RunNameResponse, NetworkRequestError>({\n    queryKey: ['runName', experimentId, runUuid],\n    cacheTime: Infinity,\n    staleTime: Infinity,\n    retry: 1, // limit retries so we don't spam the api\n    refetchOnMount: false,\n    queryFn: async () => {\n      const filter = `run_id IN ('${runUuid}')`;\n      const url = getAjaxUrl('ajax-api/2.0/mlflow/runs/search');\n\n      const res: RunNameResponse = await makeRequest(url, 'POST', {\n        experiment_ids: [experimentId],\n        filter,\n      });\n\n      return res;\n    },\n  });\n};\n","import { FolderBranchIcon, HomeIcon, NotebookIcon, WorkflowsIcon } from '@databricks/design-system';\n\nenum SourceType {\n  NOTEBOOK = 'NOTEBOOK',\n  JOB = 'JOB',\n  PROJECT = 'PROJECT',\n  LOCAL = 'LOCAL',\n  UNKNOWN = 'UNKNOWN',\n}\n\nexport const ExperimentSourceTypeIcon = ({\n  sourceType,\n  className,\n}: {\n  sourceType: SourceType | string;\n  className?: string;\n}) => {\n  if (sourceType === SourceType.NOTEBOOK) {\n    return <NotebookIcon className={className} />;\n  } else if (sourceType === SourceType.LOCAL) {\n    return <HomeIcon className={className} />;\n  } else if (sourceType === SourceType.PROJECT) {\n    return <FolderBranchIcon className={className} />;\n  } else if (sourceType === SourceType.JOB) {\n    return <WorkflowsIcon className={className} />;\n  }\n  return null;\n};\n","import { useDesignSystemTheme } from '@databricks/design-system';\n\nimport { ExperimentSourceTypeIcon } from './ExperimentSourceTypeIcon';\nimport type { TraceInfoV3 } from '../../types';\nimport MlflowUtils from '../../utils/MlflowUtils';\nimport { NullCell } from '../NullCell';\n\nexport const SourceCellRenderer = (props: { traceInfo: TraceInfoV3; isComparing: boolean; disableLinks?: boolean }) => {\n  const tags = props.traceInfo.tags;\n  const { theme } = useDesignSystemTheme();\n\n  if (!tags) {\n    return <NullCell isComparing={props.isComparing} />;\n  }\n\n  const sourceType = props.traceInfo.trace_metadata?.[MlflowUtils.sourceTypeTag];\n\n  const sourceLink = MlflowUtils.renderSourceFromMetadata(props.traceInfo);\n\n  return sourceLink && sourceType ? (\n    <div\n      css={{\n        display: 'flex',\n        gap: theme.spacing.xs,\n        alignItems: 'center',\n        // Disable links if the disableLinks prop is true\n        ...(props.disableLinks && {\n          '& a': {\n            pointerEvents: 'none',\n            color: 'inherit',\n            textDecoration: 'none',\n            cursor: 'default',\n          },\n        }),\n      }}\n    >\n      <ExperimentSourceTypeIcon sourceType={sourceType} css={{ color: theme.colors.textSecondary }} />\n      <span css={{ overflow: 'hidden', textOverflow: 'ellipsis' }}>{sourceLink}</span>\n    </div>\n  ) : (\n    <NullCell isComparing={props.isComparing} />\n  );\n};\n","import type { Theme } from '@emotion/react';\n\nimport { CheckCircleIcon, ClockIcon, useDesignSystemTheme, XCircleIcon } from '@databricks/design-system';\nimport { useIntl, defineMessage } from '@databricks/i18n';\n\nimport { NullCell } from './NullCell';\nimport type { TraceInfoV3 } from '../types';\n\nexport const ExperimentViewTracesStatusLabels = {\n  STATE_UNSPECIFIED: null,\n  IN_PROGRESS: defineMessage({\n    defaultMessage: 'In progress',\n    description: 'Experiment page > traces table > status label > in progress',\n  }),\n  OK: defineMessage({\n    defaultMessage: 'OK',\n    description: 'Experiment page > traces table > status label > ok',\n  }),\n  ERROR: defineMessage({\n    defaultMessage: 'Error',\n    description: 'Experiment page > traces table > status label > error',\n  }),\n};\n\nconst getIcon = (state: TraceInfoV3['state'], theme: Theme) => {\n  if (state === 'IN_PROGRESS') {\n    return <ClockIcon css={{ color: theme.colors.textValidationWarning }} />;\n  }\n\n  if (state === 'OK') {\n    return <CheckCircleIcon css={{ color: theme.colors.textValidationSuccess }} />;\n  }\n\n  if (state === 'ERROR') {\n    return <XCircleIcon css={{ color: theme.colors.textValidationDanger }} />;\n  }\n\n  return null;\n};\n\nexport const StatusCellRenderer = ({\n  original,\n  isComparing,\n}: {\n  original: TraceInfoV3 | undefined;\n  isComparing: boolean;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const intl = useIntl();\n\n  const labelDescriptor = ExperimentViewTracesStatusLabels[original?.state || 'STATE_UNSPECIFIED'];\n\n  return labelDescriptor ? (\n    <div css={{ display: 'flex', gap: theme.spacing.xs, alignItems: 'center' }}>\n      {getIcon(original?.state || 'STATE_UNSPECIFIED', theme)}\n      {labelDescriptor ? intl.formatMessage(labelDescriptor) : ''}\n    </div>\n  ) : (\n    <NullCell isComparing={isComparing} />\n  );\n};\n","import React from 'react';\n\nimport { Modal, Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { CopyActionButton } from '@databricks/web-shared/copy';\nconst { Paragraph } = Typography;\n\nexport interface KeyValueTagFullViewModalProps {\n  tagKey: string;\n  tagValue: string;\n  setIsKeyValueTagFullViewModalVisible: React.Dispatch<React.SetStateAction<boolean>>;\n  isKeyValueTagFullViewModalVisible: boolean;\n}\n\nexport const KeyValueTagFullViewModal = React.memo((props: KeyValueTagFullViewModalProps) => {\n  const { theme } = useDesignSystemTheme();\n\n  return (\n    <Modal\n      componentId=\"codegen_mlflow_app_src_common_components_keyvaluetagfullviewmodal.tsx_17\"\n      title={'Tag: ' + props.tagKey}\n      visible={props.isKeyValueTagFullViewModalVisible}\n      onCancel={() => props.setIsKeyValueTagFullViewModalVisible(false)}\n    >\n      <div css={{ display: 'flex', alignItems: 'center' }}>\n        <Paragraph css={{ flexGrow: 1 }}>\n          <pre\n            css={{\n              backgroundColor: theme.colors.backgroundPrimary,\n              marginTop: theme.spacing.sm,\n              whiteSpace: 'pre-wrap',\n              wordBreak: 'break-all',\n            }}\n          >\n            {props.tagValue}\n          </pre>\n        </Paragraph>\n        <div\n          css={{\n            marginBottom: theme.spacing.md,\n          }}\n        >\n          <CopyActionButton\n            componentId=\"mlflow.genai-traces-table.tag_view_modal.tag_value_copy_button\"\n            copyText={props.tagValue}\n          />\n        </div>\n      </div>\n    </Modal>\n  );\n});\n","import type { Interpolation, Theme } from '@emotion/react';\nimport React, { useState } from 'react';\n\nimport { Tag, Tooltip, Typography } from '@databricks/design-system';\nimport { useIntl } from '@databricks/i18n';\n\nimport { KeyValueTagFullViewModal } from './KeyValueTagFullViewModal';\n\n/**\n * An arbitrary number that is used to determine if a tag is too\n * long and should be truncated. We want to avoid short keys or values\n * in a long tag to be truncated\n * */\nconst TRUNCATE_ON_CHARS_LENGTH = 30;\n\nfunction getTruncatedStyles(shouldTruncate = true): Interpolation<Theme> {\n  return shouldTruncate\n    ? {\n        overflow: 'hidden',\n        textOverflow: 'ellipsis',\n        textWrap: 'nowrap',\n        whiteSpace: 'nowrap' as const,\n      }\n    : { whiteSpace: 'nowrap' as const };\n}\n\ninterface KeyValueEntity {\n  key: string;\n  value: string;\n}\n\n/**\n * A <Tag /> wrapper used for displaying key-value entity\n */\nexport const KeyValueTag = ({\n  isClosable = false,\n  onClose,\n  tag,\n  enableFullViewModal = false,\n  charLimit = TRUNCATE_ON_CHARS_LENGTH,\n  maxWidth = 300,\n  className,\n}: {\n  isClosable?: boolean;\n  onClose?: () => void;\n  tag: KeyValueEntity;\n  enableFullViewModal?: boolean;\n  charLimit?: number;\n  maxWidth?: number;\n  className?: string;\n}) => {\n  const intl = useIntl();\n\n  const [isKeyValueTagFullViewModalVisible, setIsKeyValueTagFullViewModalVisible] = useState(false);\n\n  const { shouldTruncateKey, shouldTruncateValue } = getKeyAndValueComplexTruncation(tag, charLimit);\n  const allowFullViewModal = enableFullViewModal && (shouldTruncateKey || shouldTruncateValue);\n\n  const fullViewModalLabel = intl.formatMessage({\n    defaultMessage: 'Click to see more',\n    description: 'Run page > Overview > Tags cell > Tag',\n  });\n\n  return (\n    <div>\n      <Tag\n        componentId=\"codegen_mlflow_app_src_common_components_keyvaluetag.tsx_60\"\n        closable={isClosable}\n        onClose={onClose}\n        title={tag.key}\n        className={className}\n      >\n        <Tooltip\n          componentId=\"web-shared.genai-traces-table.key-value-tag.full-view-tooltip\"\n          content={allowFullViewModal ? <span>{fullViewModalLabel}</span> : undefined}\n        >\n          <span\n            css={{ maxWidth, display: 'inline-flex' }}\n            onClick={() => (allowFullViewModal ? setIsKeyValueTagFullViewModalVisible(true) : undefined)}\n          >\n            <Typography.Text bold title={tag.key} css={getTruncatedStyles(shouldTruncateKey)}>\n              {tag.key}\n            </Typography.Text>\n            {tag.value && (\n              <Typography.Text title={tag.value} css={getTruncatedStyles(shouldTruncateValue)}>\n                : {tag.value}\n              </Typography.Text>\n            )}\n          </span>\n        </Tooltip>\n      </Tag>\n      <div>\n        {isKeyValueTagFullViewModalVisible && (\n          <KeyValueTagFullViewModal\n            tagKey={tag.key}\n            tagValue={tag.value}\n            isKeyValueTagFullViewModalVisible={isKeyValueTagFullViewModalVisible}\n            setIsKeyValueTagFullViewModalVisible={setIsKeyValueTagFullViewModalVisible}\n          />\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport function getKeyAndValueComplexTruncation(\n  tag: KeyValueEntity,\n  charLimit = TRUNCATE_ON_CHARS_LENGTH,\n): { shouldTruncateKey: boolean; shouldTruncateValue: boolean } {\n  const { key, value } = tag;\n  const fullLength = key.length + value.length;\n  const isKeyLonger = key.length > value.length;\n  const shorterLength = isKeyLonger ? value.length : key.length;\n\n  // No need to truncate if tag is short enough\n  if (fullLength <= charLimit) return { shouldTruncateKey: false, shouldTruncateValue: false };\n  // If the shorter string is too long, truncate both key and value.\n  if (shorterLength > charLimit / 2) return { shouldTruncateKey: true, shouldTruncateValue: true };\n\n  // Otherwise truncate the longer string\n  return {\n    shouldTruncateKey: isKeyLonger,\n    shouldTruncateValue: !isKeyLonger,\n  };\n}\n","import { Button, PencilIcon, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport { KeyValueTag } from './KeyValueTag';\nimport { MLFLOW_INTERNAL_PREFIX } from '../../utils/TraceUtils';\n\nexport const TagsCellRenderer = ({\n  onAddEditTags,\n  tags,\n  baseComponentId,\n}: {\n  tags: { key: string; value: string }[];\n  onAddEditTags?: () => void;\n  baseComponentId: string;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const visibleTagList = tags?.filter(({ key }) => key && !key.startsWith(MLFLOW_INTERNAL_PREFIX)) || [];\n  const containsTags = visibleTagList.length > 0;\n  return (\n    <div\n      css={{\n        display: 'flex',\n        alignItems: 'center',\n        flexWrap: 'wrap',\n        columnGap: theme.spacing.xs,\n        rowGap: theme.spacing.xs,\n      }}\n    >\n      {visibleTagList.map((tag) => (\n        <KeyValueTag\n          key={tag.key}\n          tag={tag}\n          css={{ marginRight: 0 }}\n          charLimit={20}\n          maxWidth={150}\n          enableFullViewModal\n        />\n      ))}\n      {onAddEditTags && (\n        <Button\n          componentId={`${baseComponentId}.traces_table.edit_tag`}\n          size=\"small\"\n          icon={!containsTags ? undefined : <PencilIcon />}\n          onClick={onAddEditTags}\n          children={\n            !containsTags ? (\n              <FormattedMessage\n                defaultMessage=\"Add tags\"\n                description=\"Button text to add tags to a trace in the experiment traces table\"\n              />\n            ) : undefined\n          }\n          css={{\n            flexShrink: 0,\n            opacity: 0,\n            '[role=row]:hover &': {\n              opacity: 1,\n            },\n            '[role=row]:focus-within &': {\n              opacity: 1,\n            },\n          }}\n          type=\"tertiary\"\n        />\n      )}\n    </div>\n  );\n};\n","import { HoverCard, Tag, Typography } from '@databricks/design-system';\nimport { useIntl } from '@databricks/i18n';\n\nimport { NullCell } from './NullCell';\nimport { StackedComponents } from './StackedComponents';\nimport type { TraceInfoV3 } from '../types';\n\nexport const TokensCell = (props: {\n  currentTraceInfo?: TraceInfoV3;\n  otherTraceInfo?: TraceInfoV3;\n  isComparing: boolean;\n}) => {\n  const { currentTraceInfo, otherTraceInfo, isComparing } = props;\n\n  return (\n    <StackedComponents\n      first={<TokenComponent traceInfo={currentTraceInfo} isComparing={isComparing} />}\n      second={isComparing && <TokenComponent traceInfo={otherTraceInfo} isComparing={isComparing} />}\n    />\n  );\n};\n\nconst TokenComponent = (props: { traceInfo?: TraceInfoV3; isComparing: boolean }) => {\n  const { traceInfo, isComparing } = props;\n\n  const tokenUsage = traceInfo?.trace_metadata?.['mlflow.trace.tokenUsage'];\n  const parsedTokenUsage = (() => {\n    try {\n      return tokenUsage ? JSON.parse(tokenUsage) : {};\n    } catch {\n      return {};\n    }\n  })();\n  const totalTokens = parsedTokenUsage.total_tokens;\n  const inputTokens = parsedTokenUsage.input_tokens;\n  const outputTokens = parsedTokenUsage.output_tokens;\n\n  const intl = useIntl();\n\n  if (!totalTokens) {\n    return <NullCell isComparing={isComparing} />;\n  }\n\n  return (\n    <HoverCard\n      trigger={\n        <Tag css={{ width: 'fit-content', maxWidth: '100%' }} componentId=\"mlflow.genai-traces-table.tokens\">\n          <span\n            css={{\n              display: 'block',\n              overflow: 'hidden',\n              textOverflow: 'ellipsis',\n              whiteSpace: 'nowrap',\n            }}\n          >\n            {totalTokens}\n          </span>\n        </Tag>\n      }\n      content={\n        <div\n          css={{\n            display: 'flex',\n            flexDirection: 'column',\n          }}\n        >\n          {totalTokens && (\n            <div\n              css={{\n                display: 'flex',\n                flexDirection: 'row',\n              }}\n            >\n              <div\n                css={{\n                  width: '35%',\n                }}\n              >\n                <Typography.Text>\n                  {intl.formatMessage({\n                    defaultMessage: 'Total',\n                    description: 'Label for the total tokensin the tooltip for the tokens cell.',\n                  })}\n                </Typography.Text>\n              </div>\n              <div>\n                <Typography.Text color=\"secondary\">{totalTokens}</Typography.Text>\n              </div>\n            </div>\n          )}\n          {inputTokens && (\n            <div\n              css={{\n                display: 'flex',\n                flexDirection: 'row',\n              }}\n            >\n              <div\n                css={{\n                  width: '35%',\n                }}\n              >\n                <Typography.Text>\n                  {intl.formatMessage({\n                    defaultMessage: 'Input',\n                    description: 'Label for the input tokens in the tooltip for the tokens cell.',\n                  })}\n                </Typography.Text>\n              </div>\n              <div>\n                <Typography.Text color=\"secondary\">{inputTokens}</Typography.Text>\n              </div>\n            </div>\n          )}\n          {outputTokens && (\n            <div\n              css={{\n                display: 'flex',\n                flexDirection: 'row',\n              }}\n            >\n              <div\n                css={{\n                  width: '35%',\n                }}\n              >\n                <Typography.Text>\n                  {intl.formatMessage({\n                    defaultMessage: 'Output',\n                    description: 'Label for the output tokens in the tooltip for the tokens cell.',\n                  })}\n                </Typography.Text>\n              </div>\n              <div>\n                <Typography.Text color=\"secondary\">{outputTokens}</Typography.Text>\n              </div>\n            </div>\n          )}\n        </div>\n      }\n    />\n  );\n};\n","import { first, isNil } from 'lodash';\n\nimport type { ThemeType } from '@databricks/design-system';\nimport type { IntlShape } from '@databricks/i18n';\n\nimport { getAssessmentValueBarBackgroundColor } from './Colors';\nimport { isAssessmentPassing } from '../components/EvaluationsReviewAssessmentTag';\nimport {\n  ASSESSMENTS_DOC_LINKS,\n  DEFAULT_ASSESSMENTS_SORT_ORDER,\n  getEvaluationResultAssessmentValue,\n  getJudgeMetricsLink,\n  KnownEvaluationResultAssessmentName,\n  KnownEvaluationResultAssessmentStringValue,\n  KnownEvaluationResultAssessmentValueDescription,\n  KnownEvaluationResultAssessmentValueLabel,\n  KnownEvaluationResultAssessmentValueMissingTooltip,\n} from '../components/GenAiEvaluationTracesReview.utils';\nimport type {\n  AssessmentAggregates,\n  AssessmentRunCounts,\n  AssessmentInfo,\n  EvalTraceComparisonEntry,\n  RunEvaluationResultAssessment,\n  RunEvaluationTracesDataEntry,\n  AssessmentDType,\n  AssessmentFilter,\n  AssessmentValueType,\n  NumericAggregateCount,\n  NumericAggregate,\n} from '../types';\n\nexport interface StackedRunBarchartItem {\n  value: number;\n  fraction: number;\n  isSelected: boolean;\n  toggleFilter?: () => void;\n  tooltip: string;\n}\nexport interface StackedBarchartItem {\n  name: string;\n  current: StackedRunBarchartItem;\n  other?: StackedRunBarchartItem;\n  backgroundColor: string;\n  scoreChange?: number;\n}\n\nexport const ERROR_KEY = 'Error';\n\nexport function doesAssessmentContainErrors(assessment?: RunEvaluationResultAssessment): boolean {\n  return Boolean(assessment?.errorCode || assessment?.errorMessage);\n}\n\nfunction getCustomMetricNameAndAssessment(assessmentPath: string): { metricName: string; assessmentName: string } {\n  // metric/all_guidelines/guideline_adherence\n  // gets parsed to {metricName: 'all_guidelines', assessmentName: 'guideline_adherence'}\n  const splits = assessmentPath.split('/');\n  if (splits.length === 1) {\n    return { metricName: assessmentPath, assessmentName: assessmentPath };\n  } else if (splits.length === 2) {\n    return { metricName: splits[0], assessmentName: splits[1] };\n  } else {\n    return { metricName: splits[1], assessmentName: splits.slice(2).join('/') };\n  }\n}\n\nconst PASS_FAIL_VALUES: string[] = [\n  KnownEvaluationResultAssessmentStringValue.YES,\n  KnownEvaluationResultAssessmentStringValue.NO,\n];\n/**\n * Computes global metadata for each of the assessments.\n */\nexport function getAssessmentInfos(\n  intl: IntlShape,\n  currentEvaluationResults: RunEvaluationTracesDataEntry[],\n  otherEvaluationResults: RunEvaluationTracesDataEntry[] | undefined,\n): AssessmentInfo[] {\n  const assessmentInfos: Record<string, AssessmentInfo> = {};\n  // Compute dtypes in the first pass.\n  const assessmentDtypes: Record<string, AssessmentDType | undefined> = {\n    [KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT]: 'pass-fail',\n  };\n  // Set of all assessment names. Will be filled after the first pass when computing dtypes.\n  const assessmentNames = new Set<string>();\n\n  [...currentEvaluationResults, ...(otherEvaluationResults || [])].forEach((result) => {\n    const responseAssessmentsByName: [string, RunEvaluationResultAssessment[]][] = Object.entries(\n      result.responseAssessmentsByName || {},\n    );\n\n    const overallAssessmentsByName: [string, RunEvaluationResultAssessment[]][] = result.overallAssessments.map(\n      (assessment) => [KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT as string, [assessment]],\n    );\n    const retrievalAssessmentsByName: [string, RunEvaluationResultAssessment[]][] = [];\n    result.retrievalChunks?.forEach((chunk) => {\n      // Iterate chunk.retrievalAssessmentsByName\n      for (const [assessmentName, assessments] of Object.entries(chunk.retrievalAssessmentsByName || {})) {\n        retrievalAssessmentsByName.push([assessmentName, assessments]);\n      }\n    });\n\n    for (const [assessmentName, assessments] of [\n      ...responseAssessmentsByName,\n      ...overallAssessmentsByName,\n      ...retrievalAssessmentsByName,\n    ]) {\n      assessmentNames.add(assessmentName);\n      const assessment = assessments[0];\n      // For string values, if we see a value that is not \"yes\" or \"no\", we treat it as a string.\n      // This is not a great approach, we should probably actually pass the pass-fail dtype information back somehow.\n      let dtype: AssessmentDType | undefined = !isNil(assessment.stringValue)\n        ? 'pass-fail'\n        : !isNil(assessment.numericValue)\n        ? 'numeric'\n        : !isNil(assessment.booleanValue)\n        ? 'boolean'\n        : undefined;\n\n      if (doesAssessmentContainErrors(assessment)) {\n        dtype = undefined;\n      }\n\n      if (!assessmentDtypes[assessmentName]) {\n        if (assessmentName in KnownEvaluationResultAssessmentValueLabel) {\n          dtype = 'pass-fail';\n        }\n        assessmentDtypes[assessmentName] = dtype;\n      }\n\n      // Treat non-\"yes\"|\"no\" as string values.\n      if (\n        dtype === 'pass-fail' &&\n        !isNil(assessment.stringValue) &&\n        !PASS_FAIL_VALUES.includes(assessment.stringValue)\n      ) {\n        assessmentDtypes[assessmentName] = 'string';\n      }\n\n      // If the dtype is not the same as the current dtype (meaning there's mixed data types),\n      // treat it as a string.\n      if (dtype !== undefined && dtype !== assessmentDtypes[assessmentName]) {\n        assessmentDtypes[assessmentName] = 'string';\n      }\n    }\n  });\n\n  // if any assessment does not have a dtype, give it 'unknown' type. this can happen if all evaluations for that assessment are errors\n  for (const assessmentName of assessmentNames) {\n    if (!assessmentDtypes[assessmentName]) {\n      assessmentDtypes[assessmentName] = 'unknown';\n    }\n  }\n\n  [...currentEvaluationResults, ...(otherEvaluationResults || [])].forEach((result) => {\n    const responseAssessmentsByName: [string, RunEvaluationResultAssessment[]][] = Object.entries(\n      result.responseAssessmentsByName || {},\n    );\n\n    const overallAssessmentsByName: [string, RunEvaluationResultAssessment[]][] = result.overallAssessments.map(\n      (assessment) => [KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT as string, [assessment]],\n    );\n    const retrievalAssessmentsByName: [string, RunEvaluationResultAssessment[]][] = [];\n    result.retrievalChunks?.forEach((chunk) => {\n      // Iterate chunk.retrievalAssessmentsByName\n      for (const [assessmentName, assessments] of Object.entries(chunk.retrievalAssessmentsByName || {})) {\n        retrievalAssessmentsByName.push([assessmentName, assessments]);\n      }\n    });\n\n    const assessmentNames = Object.keys(assessmentDtypes);\n    for (const assessmentName of assessmentNames) {\n      const assessmentsByName = [\n        ...responseAssessmentsByName.filter(([name]) => name === assessmentName),\n        ...overallAssessmentsByName.filter(([name]) => name === assessmentName),\n        ...retrievalAssessmentsByName.filter(([name]) => name === assessmentName),\n      ];\n      // NOTE: We only take the first assessment as row-level judges produce a single assessment.\n      const assessments = assessmentsByName.map(([_, assessments]) => assessments[0]);\n      const assessment: RunEvaluationResultAssessment | undefined = assessments[0];\n\n      const isError = doesAssessmentContainErrors(assessment);\n\n      if (isNil(assessmentInfos[assessmentName])) {\n        let displayName: string;\n        let metricName: string;\n        let isCustomMetric = false;\n\n        const isKnown = KnownEvaluationResultAssessmentValueLabel[assessmentName] !== undefined;\n        if (isKnown) {\n          displayName = intl.formatMessage(KnownEvaluationResultAssessmentValueLabel[assessmentName]);\n          metricName = assessmentName;\n          isCustomMetric = false;\n        } else {\n          const { metricName: customMetricName, assessmentName: customAssessmentName } =\n            getCustomMetricNameAndAssessment(assessmentName);\n          displayName = customAssessmentName || '-';\n          metricName = customMetricName;\n          if (assessment?.source?.sourceType === 'CODE') {\n            isCustomMetric = true;\n          }\n        }\n        const dtype = assessmentDtypes[assessmentName] || 'string';\n\n        const docsLink = getJudgeMetricsLink(ASSESSMENTS_DOC_LINKS[assessmentName]);\n        const missingTooltip =\n          assessmentName in KnownEvaluationResultAssessmentValueMissingTooltip\n            ? intl.formatMessage(KnownEvaluationResultAssessmentValueMissingTooltip[assessmentName])\n            : '';\n        const description =\n          assessmentName in KnownEvaluationResultAssessmentValueDescription\n            ? intl.formatMessage(KnownEvaluationResultAssessmentValueDescription[assessmentName])\n            : assessment?.source?.sourceType === 'HUMAN'\n            ? intl.formatMessage({\n                defaultMessage: 'This assessment is produced by a human judge.',\n                description: 'Human judge assessment description',\n              })\n            : intl.formatMessage({\n                defaultMessage: 'This assessment is produced by a custom metric.',\n                description: 'Custom judge assessment description',\n              });\n\n        let assessmentValue = assessment ? getEvaluationResultAssessmentValue(assessment) : undefined;\n        if (assessmentValue === null) assessmentValue = undefined;\n\n        const uniqueValues = new Set<AssessmentValueType>();\n        if (!isError) {\n          uniqueValues.add(assessmentValue);\n        }\n\n        assessmentInfos[assessmentName] = {\n          name: assessmentName,\n          displayName: displayName,\n          isKnown,\n          metricName,\n          isCustomMetric,\n          source: assessment?.source,\n          dtype,\n          uniqueValues,\n          isOverall: assessmentName === KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT,\n          docsLink,\n          missingTooltip,\n          description,\n          isEditable: assessment?.source?.sourceType === 'AI_JUDGE' || assessment?.source?.sourceType === 'HUMAN',\n          isRetrievalAssessment: retrievalAssessmentsByName.some(([name]) => name === assessmentName),\n          containsErrors: isError,\n        };\n      } else {\n        const assessmentInfo = assessmentInfos[assessmentName];\n        let value = assessment ? getEvaluationResultAssessmentValue(assessment) : undefined;\n        if (isNil(value)) value = undefined;\n        if (!isError) {\n          assessmentInfo.uniqueValues.add(value);\n        }\n\n        // Update isEditable.\n        if (!assessmentInfo.isEditable) {\n          assessmentInfo.isEditable =\n            assessment?.source?.sourceType === 'AI_JUDGE' || assessment?.source?.sourceType === 'HUMAN';\n        }\n\n        // isRetrievalAssessment should be true if any evaluation result has this assessment.\n        assessmentInfo.isRetrievalAssessment =\n          assessmentInfo.isRetrievalAssessment || retrievalAssessmentsByName.some(([name]) => name === assessmentName);\n\n        assessmentInfo.containsErrors = assessmentInfo.containsErrors || isError;\n      }\n    }\n  });\n\n  // Remove the overall assessment if it does not have any non-null values.\n  const seenOverallAssessmentValues =\n    assessmentInfos[KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT]?.uniqueValues || new Set();\n  const hasOverallValue =\n    seenOverallAssessmentValues.has(KnownEvaluationResultAssessmentStringValue.YES) ||\n    seenOverallAssessmentValues.has(KnownEvaluationResultAssessmentStringValue.NO);\n  if (!hasOverallValue) {\n    delete assessmentInfos[KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT];\n  }\n\n  return sortAssessmentInfos(Object.values(assessmentInfos));\n}\n\nexport function sortAssessmentInfos(assessmentInfos: AssessmentInfo[]): AssessmentInfo[] {\n  // Sort by DEFAULT_ASSESSMENTS_SORT_ORDER, fall back to alphabetical order of (metricName, name) which come after.\n  return assessmentInfos.sort((a, b) => {\n    const orderA = DEFAULT_ASSESSMENTS_SORT_ORDER.indexOf(a.name);\n    const orderB = DEFAULT_ASSESSMENTS_SORT_ORDER.indexOf(b.name);\n\n    // If both are in the sort order, compare their indices\n    if (orderA !== -1 && orderB !== -1) {\n      return orderA - orderB;\n    }\n\n    // If only one is in the sort order, prioritize it\n    if (orderA !== -1) return -1;\n    if (orderB !== -1) return 1;\n\n    // Otherwise, sort by name alphabetically\n    return a.name.localeCompare(b.name);\n  });\n}\n\nexport function getNumericAggregate(numericValues: number[]): NumericAggregate | undefined {\n  if (numericValues.length === 0) {\n    return undefined;\n  }\n\n  const numericAggregateCounts: NumericAggregateCount[] = [];\n  const min = Math.min(...numericValues);\n  const max = Math.max(...numericValues);\n\n  // Set a minimum bucket size of 0.01, since the data is displayed in 2 decimal places.\n  // Show at most 10 buckets.\n  const bucketSize = Math.max(0.01, (max - min) / 10);\n  let maxCount = 0;\n\n  if (min === max) {\n    numericAggregateCounts.push({ lower: min, upper: max, count: numericValues.length });\n  } else {\n    for (let i = min; i < max; i += bucketSize) {\n      numericAggregateCounts.push({ lower: i, upper: Math.min(i + bucketSize, max), count: 0 });\n    }\n  }\n\n  numericAggregateCounts.sort((a, b) => a.lower - b.lower);\n  for (const numericValue of numericValues) {\n    const bucket = numericAggregateCounts.find(\n      (bucket) =>\n        numericValue >= bucket.lower &&\n        (numericValue < bucket.upper || (numericValue === bucket.upper && numericValue === max)),\n    );\n    if (bucket) {\n      bucket.count++;\n      maxCount = Math.max(maxCount, bucket.count);\n    }\n  }\n  return { min, max, maxCount, counts: numericAggregateCounts };\n}\n\nexport function getAssessmentNumericAggregates(\n  assessmentInfo: AssessmentInfo,\n  evalResults: RunEvaluationTracesDataEntry[],\n): NumericAggregate | undefined {\n  if (assessmentInfo.dtype !== 'numeric') {\n    return undefined;\n  }\n  const numericValues = evalResults\n    .flatMap((evalResult) => {\n      const assessments = assessmentInfo.isOverall\n        ? evalResult.overallAssessments\n        : evalResult.responseAssessmentsByName[assessmentInfo.name];\n      const result = assessments\n        ?.map((assessment) => getEvaluationResultAssessmentValue(assessment))\n        .filter((value) => value !== undefined && typeof value === 'number');\n      return result;\n    })\n    .filter((value) => !isNil(value));\n  return getNumericAggregate(numericValues);\n}\n\nfunction getAssessmentRunValueCounts(\n  assessmentInfo: AssessmentInfo,\n  evalResults: RunEvaluationTracesDataEntry[],\n): AssessmentRunCounts | undefined {\n  if (assessmentInfo.dtype === 'numeric') {\n    return undefined;\n  }\n  const valueCounts: AssessmentRunCounts = new Map();\n  evalResults.forEach((evalResult) => {\n    const assessments = assessmentInfo.isOverall\n      ? evalResult.overallAssessments\n      : evalResult.responseAssessmentsByName[assessmentInfo.name];\n    const valueCountsBySourceId =\n      assessments && assessments.length > 0\n        ? getUniqueValueCountsBySourceId(assessmentInfo, assessments)\n        : [{ value: undefined, count: 1 }];\n    const keysToCount = assessmentInfo.containsErrors\n      ? [ERROR_KEY, ...assessmentInfo.uniqueValues]\n      : assessmentInfo.uniqueValues;\n    for (const uniqueValue of keysToCount) {\n      const valueCountBySourceId = valueCountsBySourceId.find((valueCount) => valueCount.value === uniqueValue);\n      const count = valueCountBySourceId ? valueCountBySourceId.count : 0;\n      valueCounts.set(uniqueValue, (valueCounts.get(uniqueValue) || 0) + count);\n    }\n  });\n  return valueCounts;\n}\n\nfunction getAssessmentRunNumericValues(\n  assessmentInfo: AssessmentInfo,\n  evalResults: RunEvaluationTracesDataEntry[],\n): number[] | undefined {\n  if (assessmentInfo.dtype !== 'numeric') {\n    return undefined;\n  }\n  const values: number[] = [];\n  evalResults.forEach((evalResult) => {\n    const assessment = assessmentInfo.isOverall\n      ? first(evalResult.overallAssessments)\n      : first(evalResult.responseAssessmentsByName[assessmentInfo.name]);\n    if (assessment) {\n      const value = getEvaluationResultAssessmentValue(assessment);\n\n      if (!isNil(value)) {\n        values.push(Number(value));\n      }\n    }\n  });\n  return values;\n}\n\nfunction getRootCauseAssessmentCount(\n  assessmentInfo: AssessmentInfo,\n  evalResults: RunEvaluationTracesDataEntry[],\n): number {\n  let numRootCause = 0;\n  evalResults.forEach((evalResult) => {\n    if (isNil(evalResult)) return;\n    const overallAssessment = first(evalResult.overallAssessments);\n    if (overallAssessment?.rootCauseAssessment?.assessmentName === assessmentInfo.name) {\n      numRootCause++;\n    }\n  });\n  return numRootCause;\n}\n\nexport function getAssessmentAggregates(\n  assessmentInfo: AssessmentInfo,\n  evalResults: EvalTraceComparisonEntry[],\n  allAssessmentFilters: AssessmentFilter[],\n): AssessmentAggregates {\n  const currentEvalResults = evalResults.map((entry) => entry.currentRunValue).filter((entry) => !isNil(entry));\n  const otherEvalResults = evalResults.map((entry) => entry.otherRunValue).filter((entry) => !isNil(entry));\n\n  const currentAssessmentAggregates = getAssessmentRunValueCounts(assessmentInfo, currentEvalResults);\n  const otherAssessmentAggregates = getAssessmentRunValueCounts(assessmentInfo, otherEvalResults);\n\n  const currentNumericAggregates = getAssessmentNumericAggregates(assessmentInfo, currentEvalResults);\n\n  const assessmentFilters = allAssessmentFilters.filter((filter) => filter.assessmentName === assessmentInfo.name);\n\n  return {\n    assessmentInfo,\n    currentCounts: currentAssessmentAggregates,\n    otherCounts: otherAssessmentAggregates,\n    currentNumericValues: getAssessmentRunNumericValues(assessmentInfo, currentEvalResults),\n    otherNumericValues: getAssessmentRunNumericValues(assessmentInfo, otherEvalResults),\n    currentNumericAggregate: currentNumericAggregates,\n    currentNumRootCause: getRootCauseAssessmentCount(assessmentInfo, currentEvalResults),\n    otherNumRootCause: getRootCauseAssessmentCount(assessmentInfo, otherEvalResults),\n    assessmentFilters,\n  };\n}\n\n/**\n * Computes the total aggregate score for an assessment and evaluation results.\n *\n * For pass-fail dtypes, it computes what percentage of the runs have the assessment value as 'yes'.\n * for boolean dtypes, it computes what percentage of the runs have the assessment value as 'true'.\n */\nexport function getAssessmentAggregateOverallFraction(\n  assessmentInfo: AssessmentInfo,\n  assessmentRunCounts: AssessmentRunCounts = new Map(),\n): number {\n  if (assessmentInfo.dtype === 'pass-fail' || assessmentInfo.dtype === 'boolean') {\n    let total = 0;\n    let passCount = 0;\n    for (const [value, count] of assessmentRunCounts) {\n      if (isAssessmentPassing(assessmentInfo, value)) {\n        passCount += count;\n      }\n      // We only consider non-null values for the total score.\n      if (!isNil(value) && value !== ERROR_KEY) {\n        total += count;\n      }\n    }\n    return total > 0 ? passCount / total : 0;\n  }\n  return 0;\n}\n\nfunction getAssessmentBarChartValueBarItem(\n  intl: IntlShape,\n  assessmentInfo: AssessmentInfo,\n  assessmentFilters: AssessmentFilter[],\n  value: string | boolean | number | undefined,\n  valueCounts: AssessmentRunCounts,\n  runName: string,\n  toggleAssessmentFilter: (\n    assessmentName: string,\n    filterValue: AssessmentValueType,\n    run: string,\n    filterType: AssessmentFilter['filterType'],\n  ) => void,\n): StackedRunBarchartItem {\n  let numEvals = 0;\n  const isErrorOrNull = value === ERROR_KEY || value === undefined;\n  for (const [key, count] of valueCounts) {\n    if (key !== undefined && key !== ERROR_KEY) {\n      numEvals += count;\n    }\n  }\n  const numValue = valueCounts.get(value) || 0;\n  const fraction = !isErrorOrNull && numEvals > 0 ? numValue / numEvals : 0;\n\n  const filterType: AssessmentFilter['filterType'] = undefined;\n\n  return {\n    value: valueCounts.get(value) || 0,\n    fraction,\n    isSelected: assessmentFilters.some(\n      (filter) =>\n        filter.filterValue === value && filter.assessmentName === assessmentInfo.name && filter.run === runName,\n    ),\n    toggleFilter: () => toggleAssessmentFilter(assessmentInfo.name, value, runName, filterType),\n    tooltip: !isErrorOrNull\n      ? intl.formatMessage(\n          {\n            defaultMessage: '{numValue}/{numEvals} for run \"{runName}\"',\n            description: 'Passing assessment tooltip',\n          },\n          {\n            numValue: numValue,\n            numEvals,\n            runName,\n          },\n        )\n      : intl.formatMessage(\n          {\n            defaultMessage: '{numValue} for run \"{runName}\"',\n            description: 'Error/null assessment tooltip',\n          },\n          {\n            numValue,\n            runName,\n          },\n        ),\n  };\n}\n\nfunction getBarChartKeys(assessmentInfo: AssessmentInfo) {\n  const keys = getSortedUniqueValues(assessmentInfo);\n  if (assessmentInfo.containsErrors) {\n    keys.push(ERROR_KEY);\n  }\n\n  return keys;\n}\n\nexport function getBarChartData(\n  intl: IntlShape,\n  theme: ThemeType,\n  assessmentInfo: AssessmentInfo,\n  assessmentFilters: AssessmentFilter[],\n  toggleAssessmentFilter: (\n    assessmentName: string,\n    filterValue: AssessmentValueType,\n    run: string,\n    filterType: AssessmentFilter['filterType'],\n  ) => void,\n  displayInfoCounts: AssessmentAggregates,\n  currentRunDisplayName?: string,\n  compareToRunDisplayName?: string,\n): StackedBarchartItem[] {\n  const showCompareData = displayInfoCounts.otherCounts !== undefined;\n\n  const barItems: StackedBarchartItem[] = [];\n\n  for (const value of getBarChartKeys(assessmentInfo)) {\n    const currentBarItem = displayInfoCounts.currentCounts\n      ? getAssessmentBarChartValueBarItem(\n          intl,\n          assessmentInfo,\n          assessmentFilters,\n          value,\n          displayInfoCounts.currentCounts,\n          // For monitoring, there is no run name so we allow this to pass through.\n          currentRunDisplayName || 'monitor',\n          toggleAssessmentFilter,\n        )\n      : undefined;\n\n    const otherBarItem =\n      showCompareData && compareToRunDisplayName\n        ? getAssessmentBarChartValueBarItem(\n            intl,\n            assessmentInfo,\n            assessmentFilters,\n            value,\n            displayInfoCounts.otherCounts || new Map(),\n            compareToRunDisplayName,\n            toggleAssessmentFilter,\n          )\n        : undefined;\n\n    const isErrorOrNull = value === ERROR_KEY || value === undefined;\n    const scoreChange =\n      showCompareData && currentBarItem && otherBarItem\n        ? isErrorOrNull\n          ? currentBarItem.value - (otherBarItem?.value || 0)\n          : currentBarItem.fraction - (otherBarItem?.fraction || 0)\n        : undefined;\n    // Only include Error or Null if there's a non-zero value or score change.\n    if (currentBarItem && (!isErrorOrNull || currentBarItem.value !== 0 || (scoreChange && scoreChange !== 0))) {\n      barItems.push({\n        name: getAssessmentBarChartValueText(intl, theme, assessmentInfo, value),\n        current: currentBarItem,\n        other: otherBarItem,\n        backgroundColor: getAssessmentValueBarBackgroundColor(theme, assessmentInfo, value, value === ERROR_KEY),\n        scoreChange,\n      });\n    }\n  }\n\n  return barItems;\n}\n\nfunction getSortedUniqueValues(assessmentInfo: AssessmentInfo) {\n  const uniqueValuesArray = Array.from(assessmentInfo.uniqueValues);\n  if (assessmentInfo.dtype === 'pass-fail') {\n    // Always show \"YES\" and \"NO\". We don't always show missing to reduce vertical space usage.\n    if (!uniqueValuesArray.includes(KnownEvaluationResultAssessmentStringValue.YES)) {\n      uniqueValuesArray.push(KnownEvaluationResultAssessmentStringValue.YES);\n    }\n    if (!uniqueValuesArray.includes(KnownEvaluationResultAssessmentStringValue.NO)) {\n      uniqueValuesArray.push(KnownEvaluationResultAssessmentStringValue.NO);\n    }\n    const sortOrder: string[] = [\n      KnownEvaluationResultAssessmentStringValue.YES,\n      KnownEvaluationResultAssessmentStringValue.NO,\n    ];\n\n    // Sort the unique values based on the order of the known values.\n    return uniqueValuesArray.sort((a, b) => {\n      const aIndex = sortOrder.indexOf(a as string);\n      const bIndex = sortOrder.indexOf(b as string);\n      return aIndex - bIndex;\n    });\n  } else if (assessmentInfo.dtype === 'boolean') {\n    // Sort by the value.\n    return uniqueValuesArray.sort((a, b) => {\n      return (a as boolean) === true ? -1 : 1;\n    });\n  }\n\n  // Sort the assessment.\n  return uniqueValuesArray.sort();\n}\n\nfunction getAssessmentBarChartValueText(\n  intl: IntlShape,\n  theme: ThemeType,\n  assessmentInfo: AssessmentInfo,\n  value: string | boolean | number | undefined,\n): string {\n  if (assessmentInfo.dtype === 'pass-fail') {\n    if (value === KnownEvaluationResultAssessmentStringValue.YES) {\n      return intl.formatMessage({\n        defaultMessage: 'Pass',\n        description: 'The label for a passing asseessment above a bar-chart in the summary stats.',\n      });\n    } else if (value === KnownEvaluationResultAssessmentStringValue.NO) {\n      return intl.formatMessage({\n        defaultMessage: 'Fail',\n        description: 'The label for a failing asseessment above a bar-chart in the summary stats.',\n      });\n    } else if (value === ERROR_KEY) {\n      return intl.formatMessage({\n        defaultMessage: 'Error',\n        description: 'The label for an error asseessment above a bar-chart in the summary stats.',\n      });\n    } else {\n      return intl.formatMessage({\n        defaultMessage: 'null',\n        description: 'null assessment label',\n      });\n    }\n  } else if (assessmentInfo.dtype === 'boolean') {\n    if (value === true) {\n      return intl.formatMessage({\n        defaultMessage: 'True',\n        description: 'True assessment label',\n      });\n    } else if (value === false) {\n      return intl.formatMessage({\n        defaultMessage: 'False',\n        description: 'False assessment label',\n      });\n    } else {\n      return intl.formatMessage({\n        defaultMessage: 'null',\n        description: 'null assessment label',\n      });\n    }\n  }\n  return isNil(value) ? 'null' : `${value}`;\n}\n\n/**\n * Compute the counts for each of the values given a set of assessments.\n */\nexport function getUniqueValueCountsBySourceId(\n  assessmentInfo: AssessmentInfo,\n  assessments: RunEvaluationResultAssessment[],\n): {\n  value: AssessmentValueType | undefined;\n  count: number;\n  latestAssessment: RunEvaluationResultAssessment;\n}[] {\n  const filteredAssessments = assessments.filter((assessment) => assessment.name === assessmentInfo.name);\n  // Compute the unique values of assessments.\n  let uniqueValues = new Set<AssessmentValueType | undefined>();\n  for (const assessment of filteredAssessments) {\n    const value = getEvaluationResultAssessmentValue(assessment);\n    uniqueValues.add(value);\n  }\n\n  // Sort by the latest timestamp.\n  filteredAssessments.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));\n\n  // Separate assessments with errors from those without.\n  const errorAssessments = filteredAssessments.filter((assessment) => doesAssessmentContainErrors(assessment));\n  const validAssessments = filteredAssessments.filter((assessment) => !doesAssessmentContainErrors(assessment));\n\n  // Recompute the unique values after filtering.\n  uniqueValues = new Set<AssessmentValueType | undefined>();\n  for (const assessment of validAssessments) {\n    const value = getEvaluationResultAssessmentValue(assessment);\n    uniqueValues.add(value);\n  }\n\n  // Compute the counts for each of the unique values.\n  const valueCounts: {\n    value: AssessmentValueType | undefined;\n    count: number;\n    latestAssessment: RunEvaluationResultAssessment;\n  }[] = [];\n  for (const value of uniqueValues) {\n    const assessmentsWithValue = filteredAssessments.filter(\n      (assessment) => getEvaluationResultAssessmentValue(assessment) === value,\n    );\n    const count = assessmentsWithValue.length;\n    valueCounts.push({ value, count, latestAssessment: assessmentsWithValue[0] });\n  }\n\n  // Add an entry for errors.\n  if (errorAssessments.length > 0) {\n    valueCounts.push({\n      value: ERROR_KEY,\n      count: errorAssessments.length,\n      latestAssessment: errorAssessments[0],\n    });\n  }\n\n  return valueCounts;\n}\n","import { isNil } from 'lodash';\n\nimport type { IntlShape } from '@databricks/i18n';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport { getAssessmentAggregateOverallFraction } from './AggregationUtils';\nimport type { AssessmentAggregates, AssessmentInfo } from '../types';\nconst NUM_DECIMALS_PERCENTAGE_DISPLAY = 1;\n\n/** Display a fraction (0-1) as a percentage. */\nexport function displayPercentage(fraction: number, numDecimalsDisplayPercentage = NUM_DECIMALS_PERCENTAGE_DISPLAY) {\n  // We wrap in a Number to remove trailing zeros (4.00 => 4).\n  return Number((fraction * 100).toFixed(numDecimalsDisplayPercentage)).toString();\n}\n\nexport function displayFloat(value: number | undefined | null, numDecimals = 3) {\n  if (isNil(value)) {\n    return 'null';\n  }\n  const multiplier = Math.pow(10, numDecimals);\n  const result = Math.round(value * multiplier) / multiplier;\n  return result.toString();\n}\n\n/**\n * Computes the overall display score for an assessment, and the change in score from the other run.\n */\nexport function getDisplayOverallScoreAndChange(\n  intl: IntlShape,\n  assessmentInfo: AssessmentInfo,\n  assessmentDisplayInfo: AssessmentAggregates,\n): {\n  displayScore: string;\n  displayScoreChange: string | undefined;\n  changeDirection: 'up' | 'down' | 'none';\n  aggregateType: 'average' | 'percentage-true' | 'categorical';\n} {\n  if (assessmentInfo.dtype === 'numeric') {\n    // Compute the average score for displayScore, and the change in average for displayScoreChange.\n    const currentNumericValues = assessmentDisplayInfo.currentNumericValues;\n    const otherNumericValues = assessmentDisplayInfo.otherNumericValues;\n\n    let currentAverage = NaN;\n    let otherAverage = NaN;\n    if (currentNumericValues) {\n      currentAverage = currentNumericValues.reduce((a, b) => a + b, 0) / currentNumericValues.length;\n    }\n    if (otherNumericValues) {\n      otherAverage = otherNumericValues.reduce((a, b) => a + b, 0) / otherNumericValues.length;\n    }\n    const displayScore = displayFloat(currentAverage, 2);\n    const scoreChange = otherNumericValues ? currentAverage - otherAverage : undefined;\n    const changeDirection = scoreChange ? (scoreChange > 0 ? 'up' : 'down') : 'none';\n\n    const displayScoreChange = scoreChange\n      ? changeDirection === 'up'\n        ? `+${displayFloat(Math.abs(scoreChange), 2)}`\n        : changeDirection === 'down'\n        ? `-${displayFloat(Math.abs(scoreChange), 2)}`\n        : '+0'\n      : undefined;\n\n    return {\n      displayScore,\n      displayScoreChange,\n      changeDirection,\n      aggregateType: 'average',\n    };\n  } else if (assessmentInfo.dtype === 'pass-fail' || assessmentInfo.dtype === 'boolean') {\n    const numDecimalsDisplayPercentage = 0;\n    const scoreFraction = getAssessmentAggregateOverallFraction(assessmentInfo, assessmentDisplayInfo.currentCounts);\n    const displayScore = displayPercentage(scoreFraction, numDecimalsDisplayPercentage) + '%';\n    const scoreChange = assessmentDisplayInfo.otherCounts\n      ? scoreFraction - getAssessmentAggregateOverallFraction(assessmentInfo, assessmentDisplayInfo.otherCounts)\n      : undefined;\n    const changeDirection = scoreChange ? (scoreChange > 0 ? 'up' : 'down') : 'none';\n    const displayScoreChange = scoreChange\n      ? (changeDirection === 'up' || changeDirection === 'none' ? '+' : '') +\n        displayPercentage(scoreChange, numDecimalsDisplayPercentage) +\n        '%'\n      : undefined;\n\n    return {\n      displayScore,\n      displayScoreChange,\n      changeDirection,\n      aggregateType: 'percentage-true',\n    };\n  } else if (assessmentInfo.dtype === 'string') {\n    const numUniqueValues = assessmentInfo.uniqueValues.size;\n    return {\n      displayScore:\n        numUniqueValues !== 1\n          ? intl.formatMessage(\n              {\n                defaultMessage: '{numUniqueValues} values',\n                description: 'Text for number of unique values for categorical assessment',\n              },\n              { numUniqueValues },\n            )\n          : intl.formatMessage({\n              defaultMessage: '1 value',\n              description: 'Text for number of unique values for categorical assessment',\n            }),\n      displayScoreChange: '',\n      changeDirection: 'none',\n      aggregateType: 'categorical',\n    };\n  } else {\n    return {\n      displayScore: 'N/A',\n      displayScoreChange: 'N/A',\n      changeDirection: 'none',\n      aggregateType: 'categorical',\n    };\n  }\n}\n\nexport function getDisplayScore(assessmentInfo: AssessmentInfo, fraction: number) {\n  return displayPercentage(fraction, 0) + '%';\n}\n\nexport function getDisplayScoreChange(assessmentInfo: AssessmentInfo, scoreChange: number, asPercentage = true) {\n  if (assessmentInfo.dtype === 'numeric') {\n    const changeDirection = scoreChange > 0 ? 'up' : 'down';\n    return changeDirection === 'up' ? `+${displayFloat(scoreChange, 2)}` : `-${displayFloat(scoreChange, 2)}`;\n  } else {\n    const changeDirection = scoreChange >= 0 ? 'up' : 'down';\n    if (asPercentage) {\n      return changeDirection === 'up'\n        ? `+${displayPercentage(scoreChange, 0)}%`\n        : `-${displayPercentage(scoreChange * -1, 0)}%`;\n    } else {\n      return changeDirection === 'up' ? `+${scoreChange}` : `-${scoreChange}`;\n    }\n  }\n}\n\n// This is forked from mlflow: https://src.dev.databricks.com/databricks-eng/universe/-/blob/mlflow/web/js/src/common/utils/Utils.tsx?L188\nexport function timeSinceStr(date: any, referenceDate = new Date()) {\n  // @ts-expect-error TS(2362): The left-hand side of an arithmetic operation must... Remove this comment to see the full error message\n  const seconds = Math.max(0, Math.floor((referenceDate - date) / 1000));\n  let interval = Math.floor(seconds / 31536000);\n\n  if (interval >= 1) {\n    return (\n      <FormattedMessage\n        defaultMessage=\"{timeSince, plural, =1 {1 year} other {# years}} ago\"\n        description=\"Text for time in years since given date for MLflow views\"\n        values={{ timeSince: interval }}\n      />\n    );\n  }\n  interval = Math.floor(seconds / 2592000);\n  if (interval >= 1) {\n    return (\n      <FormattedMessage\n        defaultMessage=\"{timeSince, plural, =1 {1 month} other {# months}} ago\"\n        description=\"Text for time in months since given date for MLflow views\"\n        values={{ timeSince: interval }}\n      />\n    );\n  }\n  interval = Math.floor(seconds / 86400);\n  if (interval >= 1) {\n    return (\n      <FormattedMessage\n        defaultMessage=\"{timeSince, plural, =1 {1 day} other {# days}} ago\"\n        description=\"Text for time in days since given date for MLflow views\"\n        values={{ timeSince: interval }}\n      />\n    );\n  }\n  interval = Math.floor(seconds / 3600);\n  if (interval >= 1) {\n    return (\n      <FormattedMessage\n        defaultMessage=\"{timeSince, plural, =1 {1 hour} other {# hours}} ago\"\n        description=\"Text for time in hours since given date for MLflow views\"\n        values={{ timeSince: interval }}\n      />\n    );\n  }\n  interval = Math.floor(seconds / 60);\n  if (interval >= 1) {\n    return (\n      <FormattedMessage\n        defaultMessage=\"{timeSince, plural, =1 {1 minute} other {# minutes}} ago\"\n        description=\"Text for time in minutes since given date for MLflow views\"\n        values={{ timeSince: interval }}\n      />\n    );\n  }\n  return (\n    <FormattedMessage\n      defaultMessage=\"{timeSince, plural, =1 {1 second} other {# seconds}} ago\"\n      description=\"Text for time in seconds since given date for MLflow views\"\n      values={{ timeSince: seconds }}\n    />\n  );\n}\n\n// Function to escape CSS Special characters by adding \\\\ before them. Needed when inserting CSS variables.\nexport function escapeCssSpecialCharacters(str: string) {\n  // eslint-disable-next-line no-useless-escape\n  return str.replace(/([!\"#$%&'()*+,\\.\\/:;\\s<=>?@[\\\\\\]^`{|}~])/g, '\\\\$1');\n}\n\n// Adapted from query-insights/utils/numberUtils\nexport function prettySizeWithUnit(bytes: number | null | undefined, fractionDigits?: number) {\n  return prettyNumberWithUnit(bytes, 1024, ['bytes', 'KB', 'MB', 'GB', 'TB', 'PB'], fractionDigits);\n}\n\nfunction prettyNumberWithUnit(\n  value: string | number | null | undefined,\n  divisor: number,\n  units: string[] = [],\n  fractionDigits?: number,\n): { unit: string; value: string; numericValue: number | undefined; divisor: number } {\n  let val = Number(value);\n\n  if (isNaN(val) || !isFinite(val)) {\n    return {\n      value: '',\n      numericValue: undefined,\n      unit: '',\n      divisor: 1,\n    };\n  }\n\n  let unit = 0;\n  let greatestDivisor = 1;\n\n  while (val >= divisor && unit < units.length - 1) {\n    val /= divisor;\n    greatestDivisor *= divisor;\n    unit += 1;\n  }\n\n  return {\n    value: formatNumber(val, fractionDigits),\n    numericValue: val,\n    unit: units[unit],\n    divisor: greatestDivisor,\n  };\n}\n\nfunction formatNumber(value: number, fractionDigits = 3): string {\n  return Math.round(value) !== value ? value.toFixed(fractionDigits) : value.toString();\n}\n","import React from 'react';\n\nconst MarkdownConverterProviderContext = React.createContext({\n  makeHTML: (markdown?: string) => markdown,\n});\n\nexport const MarkdownConverterProvider = ({\n  children,\n  makeHtml,\n}: {\n  children: React.ReactNode;\n  makeHtml: (markdown?: string) => string;\n}) => {\n  return (\n    <MarkdownConverterProviderContext.Provider value={{ makeHTML: makeHtml }}>\n      {children}\n    </MarkdownConverterProviderContext.Provider>\n  );\n};\n\nexport const useMarkdownConverter = () => React.useContext(MarkdownConverterProviderContext);\n","import { isNil, isString } from 'lodash';\nimport { useMemo } from 'react';\n\nimport {\n  PencilIcon,\n  SparkleDoubleIcon,\n  UserIcon,\n  useDesignSystemTheme,\n  Button,\n  CheckCircleIcon,\n  XCircleIcon,\n  WarningIcon,\n  XCircleFillIcon,\n  HoverCard,\n  Typography,\n  InfoSmallIcon,\n  BracketsXIcon,\n  DangerIcon,\n} from '@databricks/design-system';\nimport type { ThemeType } from '@databricks/design-system';\nimport type { IntlShape } from '@databricks/i18n';\nimport { FormattedMessage, useIntl } from '@databricks/i18n';\n\nimport {\n  KnownEvaluationResultAssessmentValueLabel,\n  KnownEvaluationResultAssessmentValueMapping,\n  getEvaluationResultAssessmentValue,\n  hasBeenEditedByHuman,\n  KnownEvaluationResultAssessmentStringValue,\n  KnownEvaluationResultAssessmentValueMissingTooltip,\n  ASSESSMENTS_DOC_LINKS,\n  getJudgeMetricsLink,\n} from './GenAiEvaluationTracesReview.utils';\nimport type { AssessmentInfo, RunEvaluationResultAssessment } from '../types';\nimport {\n  getEvaluationResultAssessmentBackgroundColor,\n  getEvaluationResultIconColor,\n  getEvaluationResultTextColor,\n} from '../utils/Colors';\nimport { displayFloat } from '../utils/DisplayUtils';\nimport { ASSESSMENT_RATIONAL_HOVER_DETAILS_VIEW } from '../utils/EvaluationLogging';\nimport { useMarkdownConverter } from '../utils/MarkdownUtils';\n\nexport const isAssessmentPassing = (\n  assessmentInfo: AssessmentInfo,\n  assessmentValue?: string | number | boolean | null,\n) => {\n  if (!isNil(assessmentValue)) {\n    if (assessmentInfo.dtype === 'pass-fail') {\n      if (assessmentValue === KnownEvaluationResultAssessmentStringValue.YES) {\n        return true;\n      } else if (assessmentValue === KnownEvaluationResultAssessmentStringValue.NO) {\n        return false;\n      }\n    } else if (assessmentInfo.dtype === 'boolean') {\n      return assessmentValue === true;\n    }\n  }\n  return undefined;\n};\n\nfunction getAssessmentTagDisplayValue(\n  theme: ThemeType,\n  intl: IntlShape,\n  type: 'value' | 'assessment-value',\n  assessmentInfo: AssessmentInfo,\n  editedByHuman: boolean,\n  assessment?: RunEvaluationResultAssessment,\n  isRootCauseAssessment?: boolean,\n): { tagText: JSX.Element | string; icon: JSX.Element; fullTagText?: JSX.Element | string | undefined } {\n  let tagText: string | JSX.Element = '';\n  let fullTagText: string | JSX.Element | undefined = undefined;\n  let icon: JSX.Element = <></>;\n\n  const errorDisplayValue = {\n    tagText: (\n      <FormattedMessage defaultMessage=\"Error\" description=\"Error assessment status in the evaluations table.\" />\n    ),\n    icon: <DangerIcon css={{ color: theme.colors.textValidationWarning }} />,\n  };\n\n  const nullDisplayValue = {\n    tagText: (\n      <span css={{ fontStyle: 'italic' }}>\n        <FormattedMessage defaultMessage=\"null\" description=\"Null value in the evaluations table.\" />\n      </span>\n    ),\n    icon: <WarningIcon css={{ color: theme.colors.grey400 }} />,\n  };\n\n  const value = assessment ? getEvaluationResultAssessmentValue(assessment) : undefined;\n  const isError = Boolean(assessment?.errorMessage);\n\n  if (isError) {\n    return errorDisplayValue;\n  }\n\n  if (assessmentInfo.dtype === 'pass-fail' || assessmentInfo.dtype === 'boolean') {\n    const isPassing = isAssessmentPassing(assessmentInfo, value);\n    let displayValueText = '';\n    if (assessmentInfo.dtype === 'pass-fail') {\n      // Known assessments are all pass / fail.\n      if (isPassing === true) {\n        displayValueText = intl.formatMessage({\n          defaultMessage: 'Pass',\n          description: 'Passing evaluation status in the evaluations table.',\n        });\n      } else if (isPassing === false) {\n        displayValueText = intl.formatMessage({\n          defaultMessage: 'Fail',\n          description: 'Failing evaluation status in the evaluations table.',\n        });\n      } else {\n        return nullDisplayValue;\n      }\n    } else if (isPassing === true) {\n      displayValueText = intl.formatMessage({\n        defaultMessage: 'True',\n        description: 'True value in the evaluations table.',\n      });\n    } else if (isPassing === false) {\n      displayValueText = intl.formatMessage({\n        defaultMessage: 'False',\n        description: 'False value in the evaluations table.',\n      });\n    } else {\n      return nullDisplayValue;\n    }\n\n    const iconColor = getEvaluationResultIconColor(theme, assessmentInfo, assessment);\n    icon =\n      isPassing === true ? (\n        <CheckCircleIcon\n          css={{\n            color: iconColor,\n          }}\n        />\n      ) : isPassing === false ? (\n        isRootCauseAssessment ? (\n          <XCircleFillIcon\n            css={{\n              color: iconColor,\n            }}\n          />\n        ) : (\n          <XCircleIcon\n            css={{\n              color: iconColor,\n            }}\n          />\n        )\n      ) : (\n        <WarningIcon\n          css={{\n            color: iconColor,\n          }}\n        />\n      );\n\n    if (type === 'assessment-value') {\n      const knownMapping = KnownEvaluationResultAssessmentValueMapping[assessmentInfo.name];\n\n      if (knownMapping) {\n        const messageDescriptor = value\n          ? knownMapping[value.toString()] ?? knownMapping[KnownEvaluationResultAssessmentStringValue.YES]\n          : knownMapping[KnownEvaluationResultAssessmentStringValue.YES];\n        if (messageDescriptor) {\n          tagText = <FormattedMessage {...messageDescriptor} values={{ value }} />;\n        }\n      } else {\n        tagText = (\n          <>\n            {assessmentInfo.displayName}: {value}\n          </>\n        );\n      }\n    } else if (type === 'value') {\n      if (isNil(isPassing)) {\n        tagText = <span css={{ fontStyle: 'italic' }}>{displayValueText}</span>;\n      } else {\n        tagText = displayValueText;\n      }\n    }\n  } else if (assessmentInfo.dtype === 'numeric') {\n    const roundedValue = !isNil(value) ? displayFloat(value as number | undefined | null) : value;\n\n    if (type === 'assessment-value') {\n      tagText = (\n        <>\n          {assessmentInfo.displayName}: {roundedValue}\n        </>\n      );\n      fullTagText = (\n        <>\n          {assessmentInfo.displayName}: {value}\n        </>\n      );\n    } else {\n      if (isNil(roundedValue)) {\n        return nullDisplayValue;\n      }\n      tagText = `${roundedValue}`;\n      fullTagText = `${value}`;\n    }\n  } else {\n    // Wrap nulls in italics.\n    if (isNil(value)) {\n      return nullDisplayValue;\n    }\n    const valueElement = <>{String(value)}</>;\n    if (type === 'assessment-value') {\n      if (isNil(value)) {\n        tagText = <>{assessmentInfo.displayName}</>;\n      } else {\n        tagText = (\n          <>\n            {assessmentInfo.displayName}: {valueElement}\n          </>\n        );\n      }\n    } else {\n      tagText = valueElement;\n    }\n  }\n  return { tagText, icon, fullTagText };\n}\n\nexport const EvaluationsReviewAssessmentTag = ({\n  assessment,\n  onEdit,\n  active = false,\n  disableJudgeTypeIcon,\n  showRationaleInTooltip = false,\n  showPassFailText = false,\n  hideAssessmentName = false,\n  iconOnly = false,\n  disableTooltip = false,\n  isRootCauseAssessment,\n  assessmentInfo,\n  type,\n  count,\n}: {\n  assessment?: RunEvaluationResultAssessment;\n  onEdit?: () => void;\n  active?: boolean;\n  disableJudgeTypeIcon?: boolean;\n  showRationaleInTooltip?: boolean;\n  showPassFailText?: boolean;\n  hideAssessmentName?: boolean;\n  iconOnly?: boolean;\n  disableTooltip?: boolean;\n  isRootCauseAssessment?: boolean;\n  assessmentInfo: AssessmentInfo;\n  type: 'value' | 'assessment-value';\n  count?: number;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const intl = useIntl();\n\n  const value = assessment ? getEvaluationResultAssessmentValue(assessment) : undefined;\n  const isPassing = useMemo(() => isAssessmentPassing(assessmentInfo, value), [value, assessmentInfo]);\n\n  const iconColor = getEvaluationResultIconColor(theme, assessmentInfo, assessment);\n  const textColor = getEvaluationResultTextColor(theme, assessmentInfo, assessment);\n\n  let errorMessage: string | undefined = undefined;\n  if (\n    assessment?.errorMessage ||\n    (isPassing === undefined && assessment && KnownEvaluationResultAssessmentValueMissingTooltip[assessment.name])\n  ) {\n    errorMessage =\n      assessment.errorMessage ||\n      intl.formatMessage(KnownEvaluationResultAssessmentValueMissingTooltip[assessment.name]);\n  }\n\n  const knownValueLabel = assessment ? KnownEvaluationResultAssessmentValueLabel[assessment.name] : undefined;\n  const assessmentTitle = useMemo(\n    () => (knownValueLabel ? intl.formatMessage(knownValueLabel) : assessment?.name),\n    [assessment, knownValueLabel, intl],\n  );\n  const learnMoreLink = useMemo(\n    () => (assessment ? getJudgeMetricsLink(ASSESSMENTS_DOC_LINKS[assessment.name]) : undefined),\n    [assessment],\n  );\n\n  const { makeHTML } = useMarkdownConverter();\n\n  const rationaleHTML = useMemo(() => {\n    const rationale = assessment?.rationale;\n    return isString(rationale) ? makeHTML(rationale) : undefined;\n  }, [assessment, makeHTML]);\n\n  const editedByHuman = useMemo(() => !isNil(assessment) && hasBeenEditedByHuman(assessment), [assessment]);\n\n  const { tagText, icon, fullTagText } = useMemo(\n    () =>\n      getAssessmentTagDisplayValue(theme, intl, type, assessmentInfo, editedByHuman, assessment, isRootCauseAssessment),\n    [theme, intl, type, assessmentInfo, assessment, isRootCauseAssessment, editedByHuman],\n  );\n\n  const tagContent = (\n    <>\n      {tagText}\n      {count && count > 1 ? ` (${count})` : ''}\n    </>\n  );\n\n  // Hide human assessment tags when not defined.\n  const hideTag = assessmentInfo.source?.sourceType === 'HUMAN' && !assessment?.source?.sourceId;\n  if (hideTag) {\n    return <></>;\n  }\n\n  const tagElement = (\n    <div>\n      <EvaluationsReviewTag\n        iconOnly={iconOnly}\n        hideAssessmentName={hideAssessmentName}\n        tagContent={tagContent}\n        active={active}\n        icon={icon}\n        iconColor={iconColor}\n        textColor={textColor}\n        sourceIcon={\n          assessmentInfo.isCustomMetric ? (\n            <BracketsXIcon />\n          ) : assessment && editedByHuman ? (\n            <UserIcon />\n          ) : (\n            <SparkleDoubleIcon />\n          )\n        }\n        backgroundColor={getEvaluationResultAssessmentBackgroundColor(theme, assessmentInfo, assessment)}\n        disableSourceTypeIcon={disableJudgeTypeIcon && !editedByHuman}\n        hasBeenEditedByHuman={editedByHuman}\n        onEdit={onEdit}\n      />\n    </div>\n  );\n\n  return (\n    <>\n      {disableTooltip ? (\n        tagElement\n      ) : (\n        <HoverCard\n          side=\"bottom\"\n          content={\n            <div\n              css={{\n                maxWidth: '25rem',\n                display: 'flex',\n                flexDirection: 'column',\n                overflowWrap: 'break-word',\n                wordBreak: 'break-word',\n                gap: theme.spacing.sm,\n              }}\n            >\n              <div\n                css={{\n                  display: 'flex',\n                  flexDirection: 'column',\n                  gap: theme.spacing.xs,\n                }}\n              >\n                <div\n                  css={{\n                    display: 'flex',\n                    justifyContent: 'space-between',\n                    alignItems: 'center',\n                  }}\n                >\n                  <div\n                    css={{\n                      display: 'flex',\n                      gap: theme.spacing.sm,\n                      alignItems: 'center',\n                    }}\n                  >\n                    <Typography.Title\n                      css={{\n                        marginBottom: 0,\n                      }}\n                    >\n                      {assessmentTitle}\n                    </Typography.Title>\n                    <EvaluationsReviewTag\n                      iconOnly={iconOnly}\n                      hideAssessmentName={hideAssessmentName}\n                      tagContent={fullTagText ? fullTagText : tagContent}\n                      active={active}\n                      icon={icon}\n                      iconColor={iconColor}\n                      textColor={textColor}\n                      sourceIcon={\n                        assessmentInfo.isCustomMetric ? (\n                          <BracketsXIcon />\n                        ) : assessment && hasBeenEditedByHuman(assessment) ? (\n                          <UserIcon />\n                        ) : (\n                          <SparkleDoubleIcon />\n                        )\n                      }\n                      backgroundColor={getEvaluationResultAssessmentBackgroundColor(theme, assessmentInfo, assessment)}\n                      disableSourceTypeIcon={disableJudgeTypeIcon}\n                      hasBeenEditedByHuman={editedByHuman}\n                    />\n                  </div>\n                  {learnMoreLink && (\n                    <a\n                      href={learnMoreLink}\n                      target=\"_blank\"\n                      rel=\"noreferrer\"\n                      css={{\n                        height: '16px',\n                      }}\n                    >\n                      <InfoSmallIcon />\n                    </a>\n                  )}\n                </div>\n                {isRootCauseAssessment && (\n                  <Typography.Hint>\n                    {intl.formatMessage({\n                      defaultMessage: 'This assessment is the root cause of the overall evaluation failure.',\n                      description:\n                        'Root cause assessment hint that explains that this assessment is causing the overall assessment to fail.',\n                    })}\n                  </Typography.Hint>\n                )}\n              </div>\n              {showRationaleInTooltip && assessment && rationaleHTML && (\n                <div>\n                  <>\n                    <span\n                      css={{\n                        display: 'contents',\n                        '& p': {\n                          marginBottom: 0,\n                        },\n                      }}\n                      // eslint-disable-next-line react/no-danger\n                      dangerouslySetInnerHTML={{ __html: rationaleHTML }}\n                    />\n                  </>\n                </div>\n              )}\n              {errorMessage && (\n                <div\n                  css={{\n                    display: 'flex',\n                    flexDirection: 'column',\n                    gap: theme.spacing.xs,\n                  }}\n                >\n                  <span\n                    css={{\n                      color: theme.colors.textValidationWarning,\n                      fontStyle: 'italic',\n                    }}\n                  >\n                    {errorMessage}\n                  </span>\n                </div>\n              )}\n            </div>\n          }\n          trigger={tagElement}\n        />\n      )}\n    </>\n  );\n};\n\nconst EvaluationsReviewTag = ({\n  iconOnly,\n  hideAssessmentName,\n  tagContent,\n  active,\n  sourceIcon,\n  icon,\n  iconColor,\n  textColor,\n  backgroundColor,\n  disableSourceTypeIcon,\n  hasBeenEditedByHuman,\n  onEdit,\n}: {\n  iconOnly: boolean;\n  hideAssessmentName: boolean;\n  tagContent: string | number | true | JSX.Element | undefined;\n  active?: boolean;\n  sourceIcon?: JSX.Element;\n  icon: JSX.Element;\n  iconColor: string;\n  textColor: string;\n  backgroundColor: string;\n  disableSourceTypeIcon?: boolean;\n  hasBeenEditedByHuman?: boolean;\n  onEdit?: () => void;\n}) => {\n  const { theme } = useDesignSystemTheme();\n\n  const svgSize = iconOnly ? 18 : 12;\n\n  return (\n    <div\n      css={{\n        // TODO: Use <Badge /> when it's aligned with design\n        display: 'inline-flex',\n        height: iconOnly ? svgSize : 20,\n        width: iconOnly ? svgSize : hideAssessmentName ? 'fit-content' : '',\n        justifyContent: 'space-between',\n        alignItems: 'center',\n        padding: iconOnly ? '0' : onEdit ? '0 0 0 8px' : '0 8px',\n        gap: theme.spacing.sm,\n        borderRadius: iconOnly ? '50%' : theme.legacyBorders.borderRadiusMd,\n        backgroundColor: backgroundColor,\n        boxShadow: `inset 0 0 1px 1px ${active ? theme.colors.borderAccessible : 'transparent'}`,\n        // border: iconOnly ? '' : `1px solid ${getEvaluationBorderColor(theme, assessment)}`,\n        fontSize: theme.typography.fontSizeSm,\n        svg: { width: svgSize, height: svgSize },\n        whiteSpace: 'nowrap',\n      }}\n    >\n      {icon}\n      {tagContent && (\n        <span\n          css={{\n            color: textColor,\n          }}\n        >\n          {tagContent}\n        </span>\n      )}\n      {disableSourceTypeIcon !== true ? (\n        <span\n          css={{\n            color: iconColor,\n          }}\n        >\n          {sourceIcon}\n        </span>\n      ) : (\n        <></>\n      )}\n      {onEdit && (\n        <Button\n          componentId=\"mlflow.evaluations_review.edit_assessment_button\"\n          onClick={onEdit}\n          size=\"small\"\n          icon={\n            <PencilIcon\n              css={{\n                ':hover': {\n                  color: theme.colors.actionDefaultTextHover,\n                },\n              }}\n            />\n          }\n        />\n      )}\n    </div>\n  );\n};\n","import React from 'react';\n\nexport const RunColorCircle = React.memo(({ color, hidden }: { color: string; hidden?: boolean }) => {\n  return (\n    <label\n      css={{\n        width: 12,\n        height: 12,\n        borderRadius: 6,\n        flexShrink: 0,\n        border: '1px solid rgba(0, 0, 0, 0.1)',\n        cursor: 'default',\n        position: 'relative',\n      }}\n      style={{\n        backgroundColor: color,\n        display: hidden ? 'none' : '',\n      }}\n    >\n      <span\n        css={{\n          clip: 'rect(0px, 0px, 0px, 0px)',\n          clipPath: 'inset(50%)',\n          height: '1px',\n          overflow: 'hidden',\n          position: 'absolute',\n          whiteSpace: 'nowrap',\n          width: '1px',\n        }}\n      >\n        {color}\n      </span>\n    </label>\n  );\n});\n","import type { CellContext } from '@tanstack/react-table';\nimport { first, isNil } from 'lodash';\n\nimport type { ThemeType } from '@databricks/design-system';\nimport { ArrowRightIcon, Tag, Tooltip, Typography, UserIcon } from '@databricks/design-system';\nimport type { IntlShape } from '@databricks/i18n';\nimport { ExpectationValuePreview, type ModelTraceInfo } from '@databricks/web-shared/model-trace-explorer';\n\nimport { LoggedModelCell } from './LoggedModelCell';\nimport { NullCell } from './NullCell';\nimport { RunName } from './RunName';\nimport { SourceCellRenderer } from './Source/SourceRenderer';\nimport { StackedComponents } from './StackedComponents';\nimport { StatusCellRenderer } from './StatusRenderer';\nimport { TagsCellRenderer } from './Tags/TagsCellRenderer';\nimport { TokensCell } from './TokensCell';\nimport { getTraceInfoValueWithColId } from '../GenAiTracesTable.utils';\nimport { compareAssessmentValues, formatResponseTitle } from '../GenAiTracesTableBody.utils';\nimport { EvaluationsReviewAssessmentTag } from '../components/EvaluationsReviewAssessmentTag';\nimport {\n  getEvaluationResultAssessmentValue,\n  getEvaluationResultInputTitle,\n  KnownEvaluationResultAssessmentValueMissingTooltip,\n  stringifyValue,\n} from '../components/GenAiEvaluationTracesReview.utils';\nimport { RunColorCircle } from '../components/RunColorCircle';\nimport {\n  CUSTOM_METADATA_COLUMN_ID,\n  LOGGED_MODEL_COLUMN_ID,\n  REQUEST_TIME_COLUMN_ID,\n  RESPONSE_COLUMN_ID,\n  RUN_NAME_COLUMN_ID,\n  SESSION_COLUMN_ID,\n  SOURCE_COLUMN_ID,\n  STATE_COLUMN_ID,\n  TAGS_COLUMN_ID,\n  TOKENS_COLUMN_ID,\n  TRACE_ID_COLUMN_ID,\n  TRACE_NAME_COLUMN_ID,\n  USER_COLUMN_ID,\n} from '../hooks/useTableColumns';\nimport { type AssessmentInfo, type EvalTraceComparisonEntry } from '../types';\nimport { getUniqueValueCountsBySourceId } from '../utils/AggregationUtils';\nimport { COMPARE_TO_RUN_COLOR, CURRENT_RUN_COLOR } from '../utils/Colors';\nimport { timeSinceStr } from '../utils/DisplayUtils';\nimport { shouldEnableTagGrouping } from '../utils/FeatureUtils';\nimport {\n  convertTraceInfoV3ToModelTraceInfo,\n  getCustomMetadataKeyFromColumnId,\n  getTagKeyFromColumnId,\n  getTraceInfoOutputs,\n  MLFLOW_SOURCE_RUN_KEY,\n} from '../utils/TraceUtils';\n\nexport const assessmentCellRenderer = (\n  theme: ThemeType,\n  intl: IntlShape,\n  isComparing: boolean,\n  assessmentInfo: AssessmentInfo,\n  comparisonEntry: EvalTraceComparisonEntry,\n) => {\n  const assessmentName = assessmentInfo.name;\n  const assessment = {\n    currentValue: first(comparisonEntry.currentRunValue?.responseAssessmentsByName[assessmentName]),\n    otherValue: first(comparisonEntry.otherRunValue?.responseAssessmentsByName[assessmentName]),\n  };\n\n  const uniqueValueCounts = getUniqueValueCountsBySourceId(\n    assessmentInfo,\n    comparisonEntry.currentRunValue?.responseAssessmentsByName[assessmentName] || [],\n  );\n\n  const currentIsAssessmentRootCause =\n    comparisonEntry.currentRunValue?.overallAssessments[0]?.rootCauseAssessment?.assessmentName === assessmentName;\n  const otherIsAssessmentRootCause =\n    comparisonEntry.otherRunValue?.overallAssessments[0]?.rootCauseAssessment?.assessmentName === assessmentName;\n\n  const currentValue = assessment.currentValue\n    ? getEvaluationResultAssessmentValue(assessment.currentValue)\n    : undefined;\n  const otherValue = assessment.otherValue ? getEvaluationResultAssessmentValue(assessment.otherValue) : undefined;\n  const assessmentComparison = compareAssessmentValues(\n    assessmentInfo,\n    isNil(currentValue) ? undefined : currentValue,\n    isNil(otherValue) ? undefined : otherValue,\n  );\n\n  const assessmentChanged = otherValue !== currentValue;\n\n  const missingTooltip = KnownEvaluationResultAssessmentValueMissingTooltip[assessmentName];\n  return (\n    <div\n      css={{\n        display: 'flex',\n        gap: theme.spacing.sm,\n        alignItems: 'center',\n        marginTop: 'auto',\n        marginBottom: 'auto',\n      }}\n    >\n      {isComparing ? (\n        <div\n          css={{\n            display: 'flex',\n            flexDirection: 'column',\n            gap: theme.spacing.sm,\n            borderRadius: theme.legacyBorders.borderRadiusMd,\n            marginTop: 'auto',\n            marginBottom: 'auto',\n          }}\n        >\n          <div\n            css={{\n              display: 'flex',\n              gap: theme.spacing.sm,\n              alignItems: 'center',\n            }}\n          >\n            <EvaluationsReviewAssessmentTag\n              key={`tag_${comparisonEntry.currentRunValue?.evaluationId}_${assessment.currentValue?.name}`}\n              showRationaleInTooltip\n              disableJudgeTypeIcon\n              hideAssessmentName\n              assessment={assessment.currentValue}\n              isRootCauseAssessment={currentIsAssessmentRootCause}\n              assessmentInfo={assessmentInfo}\n              type=\"value\"\n            />\n            {assessmentChanged && (\n              <ArrowRightIcon\n                css={{\n                  // Rotate by 45 degrees when the current is passing\n                  transform: assessmentComparison === 'greater' ? 'rotate(-45deg)' : 'rotate(45deg)',\n                  color: theme.colors.textSecondary,\n                }}\n              />\n            )}\n          </div>\n          <div\n            css={{\n              display: 'flex',\n              gap: theme.spacing.sm,\n              alignItems: 'center',\n            }}\n          >\n            <EvaluationsReviewAssessmentTag\n              key={`tag_${comparisonEntry.otherRunValue?.evaluationId}_${assessment.currentValue?.name}`}\n              showRationaleInTooltip\n              disableJudgeTypeIcon\n              hideAssessmentName\n              assessment={assessment.otherValue}\n              isRootCauseAssessment={otherIsAssessmentRootCause}\n              assessmentInfo={assessmentInfo}\n              type=\"value\"\n            />\n            {/* This invisible icon aligns the values. */}\n            {assessmentChanged && (\n              <ArrowRightIcon\n                css={{\n                  visibility: 'hidden',\n                }}\n              />\n            )}\n          </div>\n        </div>\n      ) : assessment.currentValue ? (\n        <div\n          css={{\n            display: 'flex',\n            flexDirection: 'column',\n            gap: theme.spacing.sm,\n          }}\n        >\n          {uniqueValueCounts.map((uniqueValueCount) => {\n            const assessment = uniqueValueCount.latestAssessment;\n            const count = uniqueValueCount.count;\n            return (\n              <EvaluationsReviewAssessmentTag\n                key={`tag_${uniqueValueCount.latestAssessment.name}_${uniqueValueCount.value}`}\n                showRationaleInTooltip\n                disableJudgeTypeIcon\n                hideAssessmentName\n                assessment={assessment}\n                isRootCauseAssessment={currentIsAssessmentRootCause}\n                assessmentInfo={assessmentInfo}\n                type=\"value\"\n                count={count}\n              />\n            );\n          })}\n        </div>\n      ) : (\n        <EvaluationsReviewAssessmentTag\n          key={`tag_${assessmentName}_${comparisonEntry.currentRunValue?.evaluationId}`}\n          showRationaleInTooltip\n          disableJudgeTypeIcon\n          hideAssessmentName\n          isRootCauseAssessment={currentIsAssessmentRootCause}\n          assessmentInfo={assessmentInfo}\n          assessment={{\n            name: assessmentName,\n            rationale: missingTooltip\n              ? intl.formatMessage(missingTooltip)\n              : intl.formatMessage({\n                  defaultMessage: 'No assessment for this evaluation',\n                  description: 'Text displayed when there is no assessment for a given evaluation',\n                }),\n            source: {\n              sourceId: '',\n              sourceType: 'AI_JUDGE',\n              metadata: {},\n            },\n            stringValue: null,\n            booleanValue: null,\n            rootCauseAssessment: null,\n            numericValue: null,\n            timestamp: null,\n            metadata: {},\n          }}\n          type=\"value\"\n        />\n      )}\n    </div>\n  );\n};\n\nexport const expectationCellRenderer = (\n  theme: ThemeType,\n  intl: IntlShape,\n  isComparing: boolean,\n  expectationName: string,\n  comparisonEntry: EvalTraceComparisonEntry,\n) => {\n  const currentValue = comparisonEntry.currentRunValue?.targets?.[expectationName];\n  const otherValue = comparisonEntry.otherRunValue?.targets?.[expectationName];\n\n  const currentValuePreview = currentValue ? (\n    <ExpectationValuePreview parsedValue={currentValue} singleLine />\n  ) : (\n    <NullCell isComparing={isComparing} />\n  );\n  const otherValuePreview = otherValue ? (\n    <ExpectationValuePreview parsedValue={otherValue} singleLine />\n  ) : (\n    <NullCell isComparing={isComparing} />\n  );\n\n  return isComparing ? (\n    <div css={{ display: 'flex', flexDirection: 'column', gap: theme.spacing.sm }}>\n      <div css={{ display: 'flex', flex: 1 }}>{currentValuePreview}</div>\n      <div css={{ display: 'flex', flex: 1 }}>{otherValuePreview}</div>\n    </div>\n  ) : (\n    currentValuePreview\n  );\n};\n\nexport const inputColumnCellRenderer = (\n  onChangeEvaluationId: (evaluationId: string | undefined) => void,\n  row: CellContext<EvalTraceComparisonEntry, unknown>,\n  isComparing: boolean,\n  theme: ThemeType,\n  inputColumn: string,\n  getRunColor?: (runUuid: string) => string,\n) => {\n  const value = row.getValue() as EvalTraceComparisonEntry;\n  const evalId = value.currentRunValue?.evaluationId || value.otherRunValue?.evaluationId;\n\n  // fetch colors if possible\n  const currentRunUuid = value.currentRunValue?.traceInfo?.trace_metadata?.[MLFLOW_SOURCE_RUN_KEY];\n  const otherRunUuid = value.otherRunValue?.traceInfo?.trace_metadata?.[MLFLOW_SOURCE_RUN_KEY];\n  const currentRunColor = getRunColor && currentRunUuid ? getRunColor(currentRunUuid) : CURRENT_RUN_COLOR;\n  const otherRunColor = getRunColor && otherRunUuid ? getRunColor(otherRunUuid) : COMPARE_TO_RUN_COLOR;\n\n  const currentInputColumnTitle = value.currentRunValue\n    ? getEvaluationResultInputTitle(value.currentRunValue, inputColumn)\n    : undefined;\n\n  const otherInputColumnTitle = value.otherRunValue\n    ? getEvaluationResultInputTitle(value.otherRunValue, inputColumn)\n    : undefined;\n\n  const inputColumnTitle = currentInputColumnTitle || otherInputColumnTitle;\n\n  return (\n    <div\n      css={{\n        height: '100%',\n        width: '100%',\n        display: 'flex',\n        overflow: 'hidden',\n        alignItems: 'center',\n        justifyContent: 'space-between',\n        gap: theme.spacing.sm,\n      }}\n    >\n      <Typography.Link\n        css={{\n          display: 'block',\n          overflow: 'hidden',\n          whiteSpace: 'nowrap',\n          textOverflow: 'ellipsis',\n        }}\n        componentId=\"mlflow.evaluations_review.table_ui.evaluation_id_link\"\n        onClick={() => onChangeEvaluationId(evalId)}\n      >\n        {inputColumnTitle ? (\n          inputColumnTitle\n        ) : (\n          <span\n            css={{\n              fontStyle: 'italic',\n            }}\n          >\n            null\n          </span>\n        )}\n      </Typography.Link>\n      {isComparing && (\n        <div\n          css={{\n            display: 'flex',\n            flexDirection: 'column',\n            gap: theme.spacing.md,\n          }}\n        >\n          <div\n            css={{\n              display: 'flex',\n            }}\n          >\n            {currentRunUuid ? <RunColorCircle color={currentRunColor} /> : <div css={{ width: 12, height: 12 }} />}\n          </div>\n          <div\n            css={{\n              display: 'flex',\n            }}\n          >\n            {otherRunUuid ? <RunColorCircle color={otherRunColor} /> : <div css={{ width: 12, height: 12 }} />}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport const traceInfoCellRenderer = (\n  experimentId: string,\n  isComparing: boolean,\n  colId: string,\n  comparisonEntry: EvalTraceComparisonEntry,\n  onChangeEvaluationId: (evalId: string) => void,\n  theme: ThemeType,\n  onTraceTagsEdit?: (trace: ModelTraceInfo) => void,\n) => {\n  const currentTraceInfo = comparisonEntry.currentRunValue?.traceInfo;\n  const otherTraceInfo = isComparing ? comparisonEntry.otherRunValue?.traceInfo : undefined;\n\n  if (colId === REQUEST_TIME_COLUMN_ID) {\n    const date = currentTraceInfo?.request_time ? new Date(currentTraceInfo.request_time) : undefined;\n    const otherDate = otherTraceInfo?.request_time ? new Date(otherTraceInfo.request_time) : undefined;\n\n    return (\n      <StackedComponents\n        first={\n          date ? (\n            <Tooltip\n              componentId=\"mlflow.experiment-evaluation-monitoring.trace-info-hover-request-time\"\n              content={date.toLocaleString(navigator.language, { timeZoneName: 'short' })}\n            >\n              <span css={{ overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>\n                {timeSinceStr(date)}\n              </span>\n            </Tooltip>\n          ) : (\n            <NullCell isComparing={isComparing} />\n          )\n        }\n        second={\n          isComparing &&\n          (otherDate ? (\n            <Tooltip\n              componentId=\"mlflow.experiment-evaluation-monitoring.trace-info-hover-other-request-time\"\n              content={otherDate.toLocaleString(navigator.language, { timeZoneName: 'short' })}\n            >\n              <span css={{ overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>\n                {timeSinceStr(otherDate)}\n              </span>\n            </Tooltip>\n          ) : (\n            <NullCell isComparing={isComparing} />\n          ))\n        }\n      />\n    );\n  } else if (colId === STATE_COLUMN_ID) {\n    return (\n      <StackedComponents\n        first={<StatusCellRenderer original={currentTraceInfo} isComparing={isComparing} />}\n        second={\n          isComparing &&\n          (otherTraceInfo ? (\n            <StatusCellRenderer original={otherTraceInfo} isComparing={isComparing} />\n          ) : (\n            <NullCell isComparing={isComparing} />\n          ))\n        }\n      />\n    );\n  } else if (colId === SOURCE_COLUMN_ID) {\n    return (\n      <StackedComponents\n        first={\n          currentTraceInfo ? (\n            <SourceCellRenderer traceInfo={currentTraceInfo} isComparing={isComparing} />\n          ) : (\n            <NullCell isComparing={isComparing} />\n          )\n        }\n        second={\n          isComparing &&\n          (otherTraceInfo ? (\n            <SourceCellRenderer traceInfo={otherTraceInfo} isComparing={isComparing} />\n          ) : (\n            <NullCell isComparing={isComparing} />\n          ))\n        }\n      />\n    );\n  } else if (colId === TAGS_COLUMN_ID) {\n    const tagsArr: { key: string; value: string }[] = Object.entries(currentTraceInfo?.tags || {}).map(\n      ([key, value]) => ({\n        key,\n        value,\n      }),\n    );\n\n    const otherTagsArr: { key: string; value: string }[] = Object.entries(otherTraceInfo?.tags || {}).map(\n      ([key, value]) => ({\n        key,\n        value,\n      }),\n    );\n\n    // We only support editing tags in single trace mode\n    const onAddEditTags = !otherTraceInfo\n      ? () => onTraceTagsEdit?.(currentTraceInfo ? convertTraceInfoV3ToModelTraceInfo(currentTraceInfo) : {})\n      : undefined;\n\n    return (\n      <StackedComponents\n        first={<TagsCellRenderer baseComponentId=\"tags-cell-renderer\" tags={tagsArr} onAddEditTags={onAddEditTags} />}\n        second={\n          isComparing &&\n          (otherTraceInfo ? (\n            <TagsCellRenderer baseComponentId=\"tags-cell-renderer-other\" tags={otherTagsArr} />\n          ) : (\n            <NullCell isComparing={isComparing} />\n          ))\n        }\n      />\n    );\n  } else if (shouldEnableTagGrouping() && colId.startsWith(TAGS_COLUMN_ID)) {\n    const tagKey = getTagKeyFromColumnId(colId);\n    if (!tagKey) {\n      return <NullCell isComparing={isComparing} />;\n    }\n    const tagValue = currentTraceInfo?.tags?.[tagKey];\n    const otherTagValue = otherTraceInfo?.tags?.[tagKey];\n    return (\n      <StackedComponents\n        first={\n          tagValue ? (\n            <span\n              title={tagValue}\n              css={{\n                display: 'block',\n                overflow: 'hidden',\n                whiteSpace: 'nowrap',\n                textOverflow: 'ellipsis',\n              }}\n            >\n              {tagValue}\n            </span>\n          ) : (\n            <NullCell isComparing={isComparing} />\n          )\n        }\n        second={\n          isComparing &&\n          (otherTagValue ? (\n            <span\n              title={tagValue}\n              css={{\n                display: 'block',\n                overflow: 'hidden',\n                whiteSpace: 'nowrap',\n                textOverflow: 'ellipsis',\n              }}\n            >\n              {otherTagValue}\n            </span>\n          ) : (\n            <NullCell isComparing={isComparing} />\n          ))\n        }\n      />\n    );\n  } else if (colId === TRACE_NAME_COLUMN_ID) {\n    const evalId = comparisonEntry.currentRunValue?.evaluationId;\n\n    const currentTraceName = currentTraceInfo?.tags?.['mlflow.traceName'];\n    const otherTraceName = otherTraceInfo?.tags?.['mlflow.traceName'];\n\n    return (\n      <StackedComponents\n        first={\n          currentTraceName ? (\n            !isComparing ? (\n              <Typography.Link\n                css={{\n                  display: 'block',\n                  overflow: 'hidden',\n                  whiteSpace: 'nowrap',\n                  textOverflow: 'ellipsis',\n                }}\n                componentId=\"mlflow.evaluations_review.table_ui.evaluation_id_link\"\n                onClick={() => evalId && onChangeEvaluationId(evalId)}\n              >\n                {currentTraceInfo?.tags?.['mlflow.traceName']}\n              </Typography.Link>\n            ) : (\n              <div>{currentTraceInfo?.tags?.['mlflow.traceName']}</div>\n            )\n          ) : (\n            <NullCell isComparing={isComparing} />\n          )\n        }\n        second={isComparing && (otherTraceName ? <div>{otherTraceName}</div> : <NullCell isComparing={isComparing} />)}\n      />\n    );\n  } else if (colId === RUN_NAME_COLUMN_ID) {\n    // This column is only shown on experiment level traces which does not support comparison mode\n\n    const runUuid = currentTraceInfo?.trace_metadata?.[MLFLOW_SOURCE_RUN_KEY];\n\n    if (!runUuid) {\n      return <NullCell />;\n    }\n\n    return <RunName experimentId={experimentId} runUuid={runUuid} />;\n  } else if (colId === USER_COLUMN_ID) {\n    const value = currentTraceInfo?.trace_metadata?.['mlflow.trace.user'] || currentTraceInfo?.tags?.['mlflow.user'];\n    const otherValue = otherTraceInfo?.trace_metadata?.['mlflow.trace.user'] || otherTraceInfo?.tags?.['mlflow.user'];\n\n    return (\n      <StackedComponents\n        first={\n          value ? (\n            <span\n              css={{\n                display: 'flex',\n                alignItems: 'center',\n                gap: theme.spacing.xs,\n              }}\n              title={value}\n            >\n              <UserIcon css={{ color: theme.colors.textSecondary, fontSize: 16 }} />\n              <span css={{ overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>{value}</span>\n            </span>\n          ) : (\n            <NullCell isComparing={isComparing} />\n          )\n        }\n        second={\n          isComparing &&\n          (otherValue ? (\n            <span\n              css={{\n                display: 'flex',\n                alignItems: 'center',\n                gap: theme.spacing.xs,\n              }}\n              title={otherValue}\n            >\n              <UserIcon css={{ color: theme.colors.textSecondary, fontSize: 16 }} />\n              <span css={{ overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>{otherValue}</span>\n            </span>\n          ) : (\n            <NullCell isComparing={isComparing} />\n          ))\n        }\n      />\n    );\n  } else if (colId === TRACE_ID_COLUMN_ID) {\n    const value = currentTraceInfo?.trace_id;\n    const otherValue = otherTraceInfo?.trace_id;\n    return (\n      <StackedComponents\n        first={\n          value ? (\n            <Tag\n              css={{ width: 'fit-content', maxWidth: '100%' }}\n              componentId=\"mlflow.genai-traces-table.trace-id\"\n              color=\"indigo\"\n              title={value}\n            >\n              <span\n                css={{\n                  display: 'block',\n                  overflow: 'hidden',\n                  textOverflow: 'ellipsis',\n                  whiteSpace: 'nowrap',\n                }}\n              >\n                {value}\n              </span>\n            </Tag>\n          ) : (\n            <NullCell isComparing={isComparing} />\n          )\n        }\n        second={\n          isComparing &&\n          (otherValue ? (\n            <Tag\n              css={{ width: 'fit-content', maxWidth: '100%' }}\n              componentId=\"mlflow.genai-traces-table.trace-id\"\n              color=\"indigo\"\n              title={otherValue}\n            >\n              <span\n                css={{\n                  display: 'inline-block',\n                  overflow: 'hidden',\n                  textOverflow: 'ellipsis',\n                  whiteSpace: 'nowrap',\n                }}\n              >\n                {otherValue}\n              </span>\n            </Tag>\n          ) : (\n            <NullCell isComparing={isComparing} />\n          ))\n        }\n      />\n    );\n  } else if (colId === SESSION_COLUMN_ID) {\n    const value = currentTraceInfo?.trace_metadata?.['mlflow.trace.session'];\n    const otherValue = otherTraceInfo?.trace_metadata?.['mlflow.trace.session'];\n    return (\n      <StackedComponents\n        first={\n          value ? (\n            <Tag\n              css={{ width: 'fit-content', maxWidth: '100%' }}\n              componentId=\"mlflow.genai-traces-table.session\"\n              title={value}\n            >\n              <span\n                css={{\n                  display: 'inline-block',\n                  overflow: 'hidden',\n                  textOverflow: 'ellipsis',\n                  whiteSpace: 'nowrap',\n                }}\n              >\n                {value}\n              </span>\n            </Tag>\n          ) : (\n            <NullCell isComparing={isComparing} />\n          )\n        }\n        second={\n          isComparing &&\n          (otherValue ? (\n            <Tag\n              css={{ width: 'fit-content', maxWidth: '100%' }}\n              componentId=\"mlflow.genai-traces-table.session\"\n              title={otherValue}\n            >\n              <span\n                css={{\n                  display: 'inline-block',\n                  overflow: 'hidden',\n                  textOverflow: 'ellipsis',\n                  whiteSpace: 'nowrap',\n                }}\n              >\n                {otherValue}\n              </span>\n            </Tag>\n          ) : (\n            <NullCell isComparing={isComparing} />\n          ))\n        }\n      />\n    );\n  } else if (colId === RESPONSE_COLUMN_ID) {\n    const value = currentTraceInfo ? formatResponseTitle(getTraceInfoOutputs(currentTraceInfo)) : '';\n    const otherValue = otherTraceInfo ? formatResponseTitle(getTraceInfoOutputs(otherTraceInfo)) : '';\n    return (\n      <StackedComponents\n        first={\n          value ? (\n            <div css={{ overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }} title={value}>\n              {value}\n            </div>\n          ) : (\n            <NullCell isComparing={isComparing} />\n          )\n        }\n        second={\n          isComparing &&\n          (otherValue ? (\n            <div css={{ overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }} title={otherValue}>\n              {otherValue}\n            </div>\n          ) : (\n            <NullCell isComparing={isComparing} />\n          ))\n        }\n      />\n    );\n  } else if (colId === LOGGED_MODEL_COLUMN_ID) {\n    return (\n      <LoggedModelCell\n        experimentId={experimentId}\n        currentTraceInfo={currentTraceInfo}\n        otherTraceInfo={otherTraceInfo}\n        isComparing={isComparing}\n      />\n    );\n  } else if (colId === TOKENS_COLUMN_ID) {\n    return <TokensCell currentTraceInfo={currentTraceInfo} otherTraceInfo={otherTraceInfo} isComparing={isComparing} />;\n  } else if (colId.startsWith(CUSTOM_METADATA_COLUMN_ID)) {\n    const metadataKey = getCustomMetadataKeyFromColumnId(colId);\n    if (!metadataKey) {\n      return <NullCell isComparing={isComparing} />;\n    }\n    const value = currentTraceInfo?.trace_metadata?.[metadataKey];\n    const otherValue = otherTraceInfo?.trace_metadata?.[metadataKey];\n    return (\n      <StackedComponents\n        first={\n          value ? (\n            <div css={{ overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }} title={value}>\n              {value}\n            </div>\n          ) : (\n            <NullCell isComparing={isComparing} />\n          )\n        }\n        second={\n          isComparing &&\n          (otherValue ? (\n            <div css={{ overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }} title={otherValue}>\n              {otherValue}\n            </div>\n          ) : (\n            <NullCell isComparing={isComparing} />\n          ))\n        }\n      />\n    );\n  }\n  const value = currentTraceInfo ? stringifyValue(getTraceInfoValueWithColId(currentTraceInfo, colId)) : '';\n  const otherValue = otherTraceInfo ? stringifyValue(getTraceInfoValueWithColId(otherTraceInfo, colId)) : '';\n\n  return (\n    <StackedComponents\n      first={\n        value ? (\n          <div css={{ overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }} title={value}>\n            {value}\n          </div>\n        ) : (\n          <NullCell isComparing={isComparing} />\n        )\n      }\n      second={\n        isComparing &&\n        (otherValue ? (\n          <div css={{ overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }} title={otherValue}>\n            {otherValue}\n          </div>\n        ) : (\n          <NullCell isComparing={isComparing} />\n        ))\n      }\n    />\n  );\n};\n","import type { ColumnDef } from '@tanstack/react-table';\nimport { isNil } from 'lodash';\n\nimport type { ThemeType } from '@databricks/design-system';\nimport { Tooltip } from '@databricks/design-system';\nimport type { IntlShape } from '@databricks/i18n';\n\nimport { traceInfoSortingFn } from './GenAiTracesTable.utils';\nimport {\n  assessmentCellRenderer,\n  expectationCellRenderer,\n  inputColumnCellRenderer,\n  traceInfoCellRenderer,\n} from './cellRenderers/rendererFunctions';\nimport {\n  getEvaluationResultAssessmentValue,\n  KnownEvaluationResultAssessmentStringValue,\n  stringifyValue,\n} from './components/GenAiEvaluationTracesReview.utils';\nimport { RESPONSE_COLUMN_ID } from './hooks/useTableColumns';\nimport { TracesTableColumnType } from './types';\nimport type {\n  AssessmentValueType,\n  EvalTraceComparisonEntry,\n  TracesTableColumn,\n  AssessmentInfo,\n  RunEvaluationResultAssessment,\n} from './types';\nimport { timeSinceStr } from './utils/DisplayUtils';\nimport type { ModelTraceInfo } from '../model-trace-explorer';\n\nconst DEFAULT_ASSESSMENT_CELL_WIDTH_PX = 120;\nconst DEFAULT_ASSESSMENTS_CELL_WIDTH_COMPARE_PX = 120;\nconst MAX_ASSESSMENT_COLUMN_SIZE = 200;\nconst DEFAULT_INPUT_COLUMNS_TOTAL_WIDTH_PX = 300;\n\nexport function compareAssessmentValues(\n  assessmentInfo: AssessmentInfo,\n  a: AssessmentValueType,\n  b: AssessmentValueType,\n): 'greater' | 'less' | 'equal' {\n  if (assessmentInfo.dtype === 'pass-fail') {\n    if (a === b) {\n      return 'equal';\n    }\n    if (a === KnownEvaluationResultAssessmentStringValue.YES) {\n      return 'greater';\n    } else if (a === KnownEvaluationResultAssessmentStringValue.NO) {\n      return 'less';\n    } else {\n      return !isNil(b) ? 'less' : 'equal';\n    }\n  } else if (assessmentInfo.dtype === 'boolean') {\n    if (a === b) {\n      return 'equal';\n    }\n    if (a === true) {\n      return 'greater';\n    } else if (a === false) {\n      return 'less';\n    } else {\n      return !isNil(b) ? 'less' : 'equal';\n    }\n  } else if (assessmentInfo.dtype === 'string') {\n    // Compare the strings in alphabetical sort order.\n    if (a === b) {\n      return 'equal';\n    }\n    if (a === null) {\n      return 'less';\n    }\n    if (b === null) {\n      return 'greater';\n    }\n    const aString = a as string | undefined;\n    const bString = b as string | undefined;\n    if (isNil(aString)) {\n      return 'less';\n    } else if (isNil(bString)) {\n      return 'greater';\n    }\n    return aString.toString().localeCompare(bString.toString()) === 1 ? 'greater' : 'less';\n  } else if (assessmentInfo.dtype === 'numeric') {\n    if (a === b) {\n      return 'equal';\n    }\n    if (a === null) {\n      return 'less';\n    }\n    if (b === null) {\n      return 'greater';\n    }\n    const aNumber = a as number;\n    const bNumber = b as number;\n    return aNumber > bNumber ? 'greater' : 'less';\n  }\n\n  return 'equal';\n}\n\nexport const formatResponseTitle = (outputs: string) => {\n  let outputsTitle = outputs;\n\n  try {\n    const parsedOutputs = JSON.parse(outputs);\n\n    // Try to parse OpenAI messages\n    const choices = parsedOutputs['response']['choices'];\n    if (Array.isArray(choices) && !isNil(choices[0]?.message?.content)) {\n      outputsTitle = choices[0]?.message?.content;\n    } else {\n      outputsTitle = stringifyValue(outputs);\n    }\n  } catch {\n    outputsTitle = stringifyValue(outputs);\n  }\n\n  return outputsTitle;\n};\n\nexport const getColumnConfig = (\n  col: TracesTableColumn,\n  {\n    evaluationInputs,\n    isComparing,\n    theme,\n    intl,\n    experimentId,\n    onChangeEvaluationId,\n    onTraceTagsEdit,\n  }: {\n    evaluationInputs: TracesTableColumn[];\n    isComparing: boolean;\n    theme: ThemeType;\n    intl: IntlShape;\n    experimentId: string;\n    onChangeEvaluationId: (evaluationId: string | undefined) => void;\n    onTraceTagsEdit?: (trace: ModelTraceInfo) => void;\n  },\n): ColumnDef<EvalTraceComparisonEntry> => {\n  const baseColConfig: ColumnDef<EvalTraceComparisonEntry> = {\n    header: col.label,\n    id: col.id,\n    accessorFn: (originalRow) => originalRow,\n  };\n\n  switch (col.type) {\n    case TracesTableColumnType.INPUT:\n      return {\n        ...baseColConfig,\n        sortingFn: (a, b) => {\n          const aValue = a.getValue(col.id) as EvalTraceComparisonEntry;\n          const bValue = b.getValue(col.id) as EvalTraceComparisonEntry;\n          const aSortValue = {\n            request: aValue.currentRunValue?.inputs[col.id] || aValue.otherRunValue?.inputs[col.id] || '',\n            evalId: aValue.currentRunValue?.evaluationId || aValue.otherRunValue?.evaluationId || '',\n          };\n          const bSortValue = {\n            request: bValue.currentRunValue?.inputs[col.id] || bValue.otherRunValue?.inputs[col.id] || '',\n            evalId: bValue.currentRunValue?.evaluationId || bValue.otherRunValue?.evaluationId || '',\n          };\n\n          return JSON.stringify(aSortValue).localeCompare(JSON.stringify(bSortValue));\n        },\n        size: DEFAULT_INPUT_COLUMNS_TOTAL_WIDTH_PX / evaluationInputs.length,\n        minSize: 120,\n        cell: (cell) =>\n          inputColumnCellRenderer(\n            onChangeEvaluationId,\n            cell,\n            isComparing,\n            theme,\n            col.id,\n            (cell.table.options.meta as any)?.getRunColor,\n          ),\n      };\n    case TracesTableColumnType.ASSESSMENT:\n      return {\n        ...baseColConfig,\n        accessorFn: (originalRow) => {\n          return { isComparing, assessmentInfo: col.assessmentInfo, comparisonEntry: originalRow };\n        },\n        sortingFn: (a, b) => {\n          const { comparisonEntry: aValue } = a.getValue(col.id) as {\n            comparisonEntry: EvalTraceComparisonEntry;\n          };\n          const { comparisonEntry: bValue } = b.getValue(col.id) as {\n            comparisonEntry: EvalTraceComparisonEntry;\n          };\n          if (col.assessmentInfo) {\n            const aAssessment = {\n              currentValue: aValue.currentRunValue?.responseAssessmentsByName[col.assessmentInfo.name]?.[0],\n              otherValue: aValue.otherRunValue?.responseAssessmentsByName[col.assessmentInfo.name]?.[0],\n            };\n            const bAssessment = {\n              currentValue: bValue.currentRunValue?.responseAssessmentsByName[col.assessmentInfo.name]?.[0],\n              otherValue: bValue.otherRunValue?.responseAssessmentsByName[col.assessmentInfo.name]?.[0],\n            };\n            return sortCompareAssessments(col.assessmentInfo, aAssessment, bAssessment);\n          }\n          return 0;\n        },\n        maxSize: MAX_ASSESSMENT_COLUMN_SIZE,\n        size: isComparing ? DEFAULT_ASSESSMENTS_CELL_WIDTH_COMPARE_PX : DEFAULT_ASSESSMENT_CELL_WIDTH_PX,\n        minSize: isComparing ? DEFAULT_ASSESSMENTS_CELL_WIDTH_COMPARE_PX : DEFAULT_ASSESSMENT_CELL_WIDTH_PX,\n        cell: (cell) => {\n          const { isComparing, assessmentInfo, comparisonEntry } = cell.getValue() as {\n            isComparing: boolean;\n            assessmentInfo: AssessmentInfo;\n            comparisonEntry: EvalTraceComparisonEntry;\n          };\n          return assessmentCellRenderer(theme, intl, isComparing, assessmentInfo, comparisonEntry);\n        },\n      };\n    case TracesTableColumnType.EXPECTATION:\n      return {\n        ...baseColConfig,\n        accessorFn: (originalRow) => {\n          return { isComparing, expectationName: col.expectationName, comparisonEntry: originalRow };\n        },\n        maxSize: MAX_ASSESSMENT_COLUMN_SIZE,\n        size: isComparing ? DEFAULT_ASSESSMENTS_CELL_WIDTH_COMPARE_PX : DEFAULT_ASSESSMENT_CELL_WIDTH_PX,\n        minSize: isComparing ? DEFAULT_ASSESSMENTS_CELL_WIDTH_COMPARE_PX : DEFAULT_ASSESSMENT_CELL_WIDTH_PX,\n        cell: (cell) => {\n          const { isComparing, expectationName, comparisonEntry } = cell.getValue() as {\n            isComparing: boolean;\n            expectationName: string;\n            comparisonEntry: EvalTraceComparisonEntry;\n          };\n          return expectationCellRenderer(theme, intl, isComparing, expectationName, comparisonEntry);\n        },\n      };\n    case TracesTableColumnType.TRACE_INFO:\n      return {\n        ...baseColConfig,\n        accessorFn: (originalRow) => {\n          return { isComparing, comparisonEntry: originalRow };\n        },\n        sortingFn: (a, b) => {\n          const { comparisonEntry: aValue } = a.getValue(col.id) as {\n            comparisonEntry: EvalTraceComparisonEntry;\n          };\n          const { comparisonEntry: bValue } = b.getValue(col.id) as {\n            comparisonEntry: EvalTraceComparisonEntry;\n          };\n\n          return traceInfoSortingFn(aValue?.currentRunValue?.traceInfo, bValue?.currentRunValue?.traceInfo, col.id);\n        },\n        size: col.id === RESPONSE_COLUMN_ID ? 300 : 100,\n        minSize: col.id === RESPONSE_COLUMN_ID ? 120 : 100,\n        cell: (cell) => {\n          const { isComparing, comparisonEntry } = cell.getValue() as {\n            isComparing: boolean;\n            comparisonEntry: EvalTraceComparisonEntry;\n          };\n\n          return traceInfoCellRenderer(\n            experimentId,\n            isComparing,\n            col.id,\n            comparisonEntry,\n            onChangeEvaluationId,\n            theme,\n            onTraceTagsEdit,\n          );\n        },\n      };\n    case TracesTableColumnType.INTERNAL_MONITOR_REQUEST_TIME:\n      return {\n        ...baseColConfig,\n        accessorFn: (originalRow) => originalRow.currentRunValue?.requestTime,\n        sortingFn: (a, b) => {\n          const aValue = a.getValue(col.id);\n          const bValue = b.getValue(col.id);\n          return JSON.stringify(aValue).localeCompare(JSON.stringify(bValue));\n        },\n        size: 100,\n        minSize: 100,\n        cell: (cell) => {\n          const requestTime = cell.getValue() as string | undefined;\n          if (!requestTime) {\n            return null;\n          }\n          const date = new Date(requestTime);\n          return (\n            <Tooltip\n              componentId=\"mlflow.experiment-evaluation-monitoring.trace-info-hover-request-time\"\n              content={date.toLocaleString(navigator.language, { timeZoneName: 'short' })}\n            >\n              <span>{timeSinceStr(date)}</span>\n            </Tooltip>\n          );\n        },\n      };\n    default:\n      return baseColConfig;\n  }\n};\n\nexport function sortCompareAssessments(\n  assessmentInfo: AssessmentInfo,\n  a: {\n    currentValue?: RunEvaluationResultAssessment;\n    otherValue?: RunEvaluationResultAssessment;\n  },\n  b: {\n    currentValue?: RunEvaluationResultAssessment;\n    otherValue?: RunEvaluationResultAssessment;\n  },\n) {\n  const aCurrentValue = a.currentValue ? getEvaluationResultAssessmentValue(a.currentValue) : undefined;\n  const bCurrentValue = b.currentValue ? getEvaluationResultAssessmentValue(b.currentValue) : undefined;\n  const aOtherValue = a.otherValue ? getEvaluationResultAssessmentValue(a.otherValue) : undefined;\n  const bOtherValue = b.otherValue ? getEvaluationResultAssessmentValue(b.otherValue) : undefined;\n\n  if (assessmentInfo.dtype === 'pass-fail') {\n    // Priorities:\n    // Pass => Fail\n    // Fail\n    // Fail => Pass\n    // Pass\n    const aIsPassToFail =\n      aOtherValue === KnownEvaluationResultAssessmentStringValue.YES &&\n      aCurrentValue === KnownEvaluationResultAssessmentStringValue.NO;\n    const bIsPassToFail =\n      bOtherValue === KnownEvaluationResultAssessmentStringValue.YES &&\n      bCurrentValue === KnownEvaluationResultAssessmentStringValue.NO;\n    const aIsFailToPass =\n      aOtherValue === KnownEvaluationResultAssessmentStringValue.NO &&\n      aCurrentValue === KnownEvaluationResultAssessmentStringValue.YES;\n    const bIsFailToPass =\n      bOtherValue === KnownEvaluationResultAssessmentStringValue.NO &&\n      bCurrentValue === KnownEvaluationResultAssessmentStringValue.YES;\n    const aIsFailToFail =\n      aOtherValue === KnownEvaluationResultAssessmentStringValue.NO &&\n      aCurrentValue === KnownEvaluationResultAssessmentStringValue.NO;\n    const bIsFailToFail =\n      bOtherValue === KnownEvaluationResultAssessmentStringValue.NO &&\n      bCurrentValue === KnownEvaluationResultAssessmentStringValue.NO;\n    const aIsPassToPass =\n      aOtherValue === KnownEvaluationResultAssessmentStringValue.YES &&\n      aCurrentValue === KnownEvaluationResultAssessmentStringValue.YES;\n    const bIsPassToPass =\n      bOtherValue === KnownEvaluationResultAssessmentStringValue.YES &&\n      bCurrentValue === KnownEvaluationResultAssessmentStringValue.YES;\n\n    // Sort according to priority\n    if (aIsPassToFail && !bIsPassToFail) return -1;\n    if (!aIsPassToFail && bIsPassToFail) return 1;\n\n    if (aIsFailToFail && !bIsFailToFail) return -1;\n    if (!aIsFailToFail && bIsFailToFail) return 1;\n\n    if (aIsFailToPass && !bIsFailToPass) return -1;\n    if (!aIsFailToPass && bIsFailToPass) return 1;\n\n    if (aIsPassToPass && !bIsPassToPass) return -1;\n    if (!aIsPassToPass && bIsPassToPass) return 1;\n\n    return sortPassFailAssessments(a.currentValue, b.currentValue);\n  } else {\n    if (aCurrentValue === bCurrentValue) {\n      return 0;\n    }\n    if (!isNil(aCurrentValue) && !isNil(bCurrentValue)) {\n      return aCurrentValue > bCurrentValue ? 1 : -1;\n    } else {\n      return isNil(aCurrentValue) ? -1 : 1;\n    }\n  }\n}\n\nfunction sortPassFailAssessments(a?: RunEvaluationResultAssessment, b?: RunEvaluationResultAssessment) {\n  if (!a && b) {\n    return 1;\n  } else if (a && !b) {\n    return -1;\n  }\n  if (!a || !b) {\n    return 0;\n  }\n\n  const aIsPassing =\n    a.stringValue === KnownEvaluationResultAssessmentStringValue.YES\n      ? true\n      : a.stringValue === KnownEvaluationResultAssessmentStringValue.NO\n      ? false\n      : undefined;\n  const bIsPassing =\n    b.stringValue === KnownEvaluationResultAssessmentStringValue.YES\n      ? true\n      : b.stringValue === KnownEvaluationResultAssessmentStringValue.NO\n      ? false\n      : undefined;\n\n  if (aIsPassing === bIsPassing) {\n    return 0;\n  }\n  // Null values get sorted last.\n  if (aIsPassing === undefined) {\n    return 1;\n  }\n  if (bIsPassing === undefined) {\n    return -1;\n  }\n  return aIsPassing ? 1 : -1;\n}\n","import { flexRender } from '@tanstack/react-table';\nimport type { Cell, Row, RowSelectionState } from '@tanstack/react-table';\nimport type { VirtualItem } from '@tanstack/react-virtual';\nimport React from 'react';\n\nimport { TableCell, TableRow, TableRowSelectCell, Tooltip, useDesignSystemTheme } from '@databricks/design-system';\nimport { useIntl } from '@databricks/i18n';\n\nimport type { TracesTableColumn, EvalTraceComparisonEntry } from './types';\nimport { escapeCssSpecialCharacters } from './utils/DisplayUtils';\n\ninterface GenAiTracesTableBodyRowsProps {\n  rows: Row<EvalTraceComparisonEntry>[];\n  isComparing: boolean;\n  enableRowSelection?: boolean;\n  virtualItems: VirtualItem<Element>[];\n  virtualizerTotalSize: number;\n  virtualizerMeasureElement: (node: HTMLDivElement | null) => void;\n  // eslint-disable-next-line react/no-unused-prop-types\n  rowSelectionState: RowSelectionState | undefined;\n  selectedColumns: TracesTableColumn[];\n}\n\nexport const GenAiTracesTableBodyRows = React.memo(\n  ({\n    rows,\n    isComparing,\n    enableRowSelection,\n    virtualItems,\n    virtualizerTotalSize,\n    virtualizerMeasureElement,\n    selectedColumns,\n  }: GenAiTracesTableBodyRowsProps) => {\n    return (\n      <div\n        style={{\n          height: `${virtualizerTotalSize}px`, // tells scrollbar how big the table is\n          position: 'relative', // needed for absolute positioning of rows\n          display: 'grid',\n        }}\n      >\n        {virtualItems.map((virtualRow) => {\n          const row = rows[virtualRow.index] as Row<EvalTraceComparisonEntry>;\n          const exportableTrace = row.original.currentRunValue && !isComparing;\n          return (\n            <div\n              key={virtualRow.key}\n              data-index={virtualRow.index}\n              ref={(node) => virtualizerMeasureElement(node)}\n              style={{\n                position: 'absolute',\n                transform: `translate3d(0, ${virtualRow.start}px, 0)`,\n                willChange: 'transform',\n                width: '100%',\n              }}\n            >\n              <GenAiTracesTableBodyRow\n                row={row}\n                exportableTrace={exportableTrace}\n                enableRowSelection={enableRowSelection}\n                isSelected={enableRowSelection ? row.getIsSelected() : undefined}\n                isComparing={isComparing}\n                selectedColumns={selectedColumns}\n              />\n            </div>\n          );\n        })}\n      </div>\n    );\n  },\n);\n\n// Memoized wrapper for the body rows which is used during column resizing\nexport const MemoizedGenAiTracesTableBodyRows = React.memo(GenAiTracesTableBodyRows) as typeof GenAiTracesTableBodyRows;\n\nexport const GenAiTracesTableBodyRow = React.memo(\n  ({\n    row,\n    exportableTrace,\n    enableRowSelection,\n    isComparing,\n    isSelected,\n    // eslint-disable-next-line react/no-unused-prop-types\n    selectedColumns, // Prop needed to force row re-rending when selectedColumns change\n  }: {\n    row: Row<EvalTraceComparisonEntry>;\n    exportableTrace?: boolean;\n    enableRowSelection?: boolean;\n    isComparing: boolean;\n    isSelected?: boolean;\n    selectedColumns: TracesTableColumn[];\n  }) => {\n    const cells = row.getVisibleCells();\n    const intl = useIntl();\n    return (\n      <>\n        <TableRow>\n          {enableRowSelection && (\n            <Tooltip\n              componentId=\"mlflow.experiment-evaluation-monitoring.evals-logs-table-cell-tooltip\"\n              content={\n                isComparing\n                  ? intl.formatMessage({\n                      defaultMessage: 'You cannot select rows when comparing runs',\n                      description: 'Tooltip message for the select button when comparing runs',\n                    })\n                  : !exportableTrace\n                  ? intl.formatMessage({\n                      defaultMessage:\n                        'This trace is not exportable because it either contains an error or the response is not a ChatCompletionResponse.',\n                      description: 'Tooltip message for the export button when the trace is not exportable',\n                    })\n                  : null\n              }\n            >\n              <TableRowSelectCell\n                componentId=\"mlflow.experiment-evaluation-monitoring.evals-logs-table-cell\"\n                checked={isSelected && exportableTrace}\n                onChange={row.getToggleSelectedHandler()}\n                isDisabled={isComparing || !exportableTrace}\n              />\n            </Tooltip>\n          )}\n          {cells.map((cell) => (\n            <GenAiTracesTableBodyRowCell cell={cell} key={cell.id} />\n          ))}\n        </TableRow>\n      </>\n    );\n  },\n);\n\nexport const GenAiTracesTableBodyRowCell = React.memo(({ cell }: { cell: Cell<EvalTraceComparisonEntry, unknown> }) => {\n  const { theme } = useDesignSystemTheme();\n  return (\n    <TableCell\n      key={cell.id}\n      style={{\n        flex: `1 1 var(--col-${escapeCssSpecialCharacters(cell.column.id)}-size)`,\n      }}\n      css={{\n        display: 'flex',\n        flexDirection: 'row',\n        alignItems: 'center',\n        // First span, make it width full.\n        '> span:first-of-type': {\n          padding: `${theme.spacing.xs}px 0px`,\n          width: '100%',\n        },\n      }}\n    >\n      {flexRender(cell.column.columnDef.cell, cell.getContext())}\n    </TableCell>\n  );\n});\n","import { useMemo } from 'react';\n\nimport { Tooltip, useDesignSystemTheme, XCircleFillIcon } from '@databricks/design-system';\nimport { useIntl, type IntlShape } from '@databricks/i18n';\n\nimport {\n  KnownEvaluationResultAssessmentStringValue,\n  KnownEvaluationResultAssessmentValueMapping,\n  withAlpha,\n} from './GenAiEvaluationTracesReview.utils';\nimport { RunColorCircle } from './RunColorCircle';\nimport type { AssessmentAggregates, AssessmentFilter, AssessmentInfo, AssessmentValueType } from '../types';\nimport { COMPARE_TO_RUN_COLOR, CURRENT_RUN_COLOR, getEvaluationResultAssessmentBackgroundColor } from '../utils/Colors';\nimport { displayPercentage } from '../utils/DisplayUtils';\n\ninterface RcaAssessmentRunDisplayInfoCount {\n  count: number;\n  fraction: number;\n  percentage: string;\n  tooltip: string;\n  toggleFilter: () => void;\n  isSelected: boolean;\n}\n\ninterface RcaAssessmentDisplayInfoCount {\n  assessment: string;\n  title: string;\n  currentInfo: RcaAssessmentRunDisplayInfoCount;\n  otherInfo?: RcaAssessmentRunDisplayInfoCount;\n  icon: JSX.Element;\n}\n\nexport const EvaluationsRcaStats = ({\n  overallAssessmentInfo,\n  assessmentNameToAggregates,\n  allAssessmentFilters,\n  toggleAssessmentFilter,\n  runUuid,\n  compareToRunUuid,\n}: {\n  overallAssessmentInfo: AssessmentInfo;\n  assessmentNameToAggregates: Record<string, AssessmentAggregates>;\n  allAssessmentFilters: AssessmentFilter[];\n  toggleAssessmentFilter: (\n    assessmentName: string,\n    filterValue: AssessmentValueType,\n    run: string,\n    filterType?: AssessmentFilter['filterType'],\n  ) => void;\n  runUuid?: string;\n  compareToRunUuid?: string;\n}) => {\n  const intl = useIntl();\n  const { theme } = useDesignSystemTheme();\n\n  const rcaData = useMemo(() => {\n    return getRcaData(\n      intl,\n      assessmentNameToAggregates,\n      allAssessmentFilters,\n      toggleAssessmentFilter,\n      Boolean(compareToRunUuid),\n      runUuid,\n      compareToRunUuid,\n    );\n  }, [intl, assessmentNameToAggregates, allAssessmentFilters, toggleAssessmentFilter, compareToRunUuid, runUuid]);\n\n  if (rcaData.length === 0) {\n    return <></>;\n  }\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexDirection: 'column',\n        gap: theme.spacing.sm,\n      }}\n    >\n      <div\n        css={{\n          fontWeight: theme.typography.typographyBoldFontWeight,\n        }}\n      >\n        {intl.formatMessage({\n          defaultMessage: 'Root Cause Analysis',\n          description: 'Root cause analysis section title',\n        })}\n      </div>\n\n      <div\n        css={{\n          display: 'flex',\n          flexDirection: 'column',\n          gap: theme.spacing.sm,\n        }}\n      >\n        <RcaPills\n          overallAssessmentInfo={overallAssessmentInfo}\n          rcaData={rcaData}\n          run=\"current\"\n          runColor={compareToRunUuid ? CURRENT_RUN_COLOR : undefined}\n        />\n      </div>\n      {compareToRunUuid && (\n        <div\n          css={{\n            display: 'flex',\n            flexDirection: 'column',\n            gap: theme.spacing.xs,\n          }}\n        >\n          <RcaPills\n            overallAssessmentInfo={overallAssessmentInfo}\n            rcaData={rcaData}\n            run=\"other\"\n            runColor={COMPARE_TO_RUN_COLOR}\n          />\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport const RcaPills = ({\n  rcaData,\n  run,\n  runColor,\n  overallAssessmentInfo,\n}: {\n  rcaData: RcaAssessmentDisplayInfoCount[];\n  run: 'current' | 'other';\n  runColor?: string;\n  overallAssessmentInfo: AssessmentInfo;\n}) => {\n  const { theme } = useDesignSystemTheme();\n\n  return (\n    <div css={{ display: 'flex', flexDirection: 'row', gap: theme.spacing.sm, alignItems: 'center' }}>\n      {runColor && (\n        <div css={{ display: 'flex' }}>\n          <RunColorCircle color={runColor} />\n        </div>\n      )}\n      <div\n        css={{\n          display: 'flex',\n          flexWrap: 'wrap',\n          gap: theme.spacing.xs,\n        }}\n      >\n        {rcaData.map((item, i) => {\n          const runDisplayInfoCount = run === 'current' ? item.currentInfo : item.otherInfo;\n          if (!runDisplayInfoCount) {\n            // eslint-disable-next-line react/jsx-key -- TODO(FEINF-1756)\n            return <></>;\n          }\n          const backgroundColor = getEvaluationResultAssessmentBackgroundColor(theme, overallAssessmentInfo, {\n            stringValue: 'no',\n          });\n          return (\n            <Tooltip key={i} content={runDisplayInfoCount.tooltip} componentId=\"mlflow.evaluations_review.rca_pill\">\n              <>\n                <div\n                  key={i}\n                  style={{\n                    border: runDisplayInfoCount.isSelected ? `1px solid ${theme.colors.grey400}` : '',\n                  }}\n                  css={{\n                    color: theme.colors.textSecondary,\n                    borderRadius: theme.general.borderRadiusBase,\n                    padding: `0 ${theme.spacing.xs}px`,\n                    height: '20px',\n                    display: 'flex',\n                    backgroundColor: runDisplayInfoCount.isSelected\n                      ? withAlpha(backgroundColor, 1.0)\n                      : withAlpha(backgroundColor, 0.5),\n                    // Bring back when we support filtering on RCA.\n                    // cursor: 'pointer',\n                    // '&:hover': {\n                    //   backgroundColor: withAlpha(backgroundColor, 0.9),\n                    // },\n                    gap: theme.spacing.xs,\n                    fontSize: theme.typography.fontSizeSm,\n                  }}\n                  // Bring back when we support filtering on RCA.\n                  // onClick={runDisplayInfoCount.toggleFilter}\n                >\n                  {runDisplayInfoCount.count}\n                  <div>{item.title.toLocaleLowerCase()}</div>\n                </div>\n              </>\n            </Tooltip>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n\nfunction getRcaData(\n  intl: IntlShape,\n  assessmentNameToAggregates: Record<string, AssessmentAggregates>,\n  assessmentFilters: AssessmentFilter[],\n  toggleAssessmentFilter: (\n    assessmentName: string,\n    filterValue: AssessmentValueType,\n    run: string,\n    filterType?: AssessmentFilter['filterType'],\n  ) => void,\n  isCompareToRun: boolean,\n  currentRunDisplayName?: string,\n  otherRunDisplayName?: string,\n): RcaAssessmentDisplayInfoCount[] {\n  // If all of the unfiltered assessment display infos have 0 root cause, return an empty array.\n  if (\n    Object.values(assessmentNameToAggregates).every(\n      (assessmentDisplayInfo) =>\n        assessmentDisplayInfo.currentNumRootCause === 0 && (assessmentDisplayInfo.otherNumRootCause || 0) === 0,\n    )\n  ) {\n    return [];\n  }\n  // Remove any root cause values that are 0 in the unfiltered set. This that the set of rca pills don't hide 0 values when filtered\n  // but keep the set minimal when unfiltered.\n  const sortedAssessmentAggregates = Object.values(assessmentNameToAggregates)\n    .filter((x) => x.currentNumRootCause > 0 || (x.otherNumRootCause || 0) > 0)\n    .sort((a, b) => b.currentNumRootCause - a.currentNumRootCause);\n  const maxNumRootCause = Math.max(\n    sortedAssessmentAggregates[0]?.currentNumRootCause || 0,\n    sortedAssessmentAggregates[0]?.otherNumRootCause || 0,\n  );\n  return sortedAssessmentAggregates.map((assessmentDisplayInfo) => {\n    const knownValueLabel =\n      KnownEvaluationResultAssessmentValueMapping[assessmentDisplayInfo.assessmentInfo.name]?.[\n        KnownEvaluationResultAssessmentStringValue.NO\n      ];\n    const title = knownValueLabel ? intl.formatMessage(knownValueLabel) : assessmentDisplayInfo.assessmentInfo.name;\n\n    const currentCounts = assessmentDisplayInfo.currentCounts;\n    const numPassing = currentCounts?.get(KnownEvaluationResultAssessmentStringValue.YES) || 0;\n    const numFailing = currentCounts?.get(KnownEvaluationResultAssessmentStringValue.NO) || 0;\n    const numMissing = currentCounts?.get(undefined) || 0;\n    const numRootCause = assessmentDisplayInfo.currentNumRootCause;\n\n    const numEvals = numPassing + numFailing + numMissing;\n\n    const otherCounts = assessmentDisplayInfo.otherCounts;\n    let otherNumEvals: number | undefined;\n    if (assessmentDisplayInfo.otherCounts !== undefined) {\n      const otherNumPassing = otherCounts?.get(KnownEvaluationResultAssessmentStringValue.YES) || 0;\n      const otherNumFailing = otherCounts?.get(KnownEvaluationResultAssessmentStringValue.NO) || 0;\n      const otherNumMissing = otherCounts?.get(undefined) || 0;\n      otherNumEvals = otherNumPassing + otherNumFailing + otherNumMissing;\n    }\n    const otherNumRootCause = assessmentDisplayInfo.otherNumRootCause || 0;\n    const rootCauseFraction = numRootCause / numEvals;\n    const otherRootCauseFraction = otherNumRootCause / (otherNumEvals || 1);\n    const currentPercentage = displayPercentage(rootCauseFraction);\n    const otherPercentage = displayPercentage(otherRootCauseFraction);\n\n    return {\n      assessment: assessmentDisplayInfo.assessmentInfo.name,\n      // Map assessment to known values.\n      title,\n      currentInfo: {\n        count: numRootCause,\n        fraction: numRootCause / maxNumRootCause,\n        tooltip: intl.formatMessage(\n          {\n            defaultMessage:\n              '{numRootCause}/{numEvals} ({percentage}%) runs failed due to the {assessment} judge failing for the current run \"{currentRun}\".',\n            description: 'Tooltip for the root cause metrics bar on the LLM evaluation page.',\n          },\n          {\n            numRootCause,\n            numEvals,\n            percentage: currentPercentage,\n            assessment: assessmentDisplayInfo.assessmentInfo.name,\n            currentRun: currentRunDisplayName,\n          },\n        ),\n        toggleFilter: () =>\n          toggleAssessmentFilter(assessmentDisplayInfo.assessmentInfo.name, 'failing_root_cause', 'current'),\n        isSelected: assessmentFilters.some(\n          (filter) =>\n            filter.filterType === 'rca' &&\n            filter.run === 'current' &&\n            filter.assessmentName === assessmentDisplayInfo.assessmentInfo.name,\n        ),\n        percentage: currentPercentage,\n      },\n      otherInfo: isCompareToRun\n        ? {\n            count: otherNumRootCause,\n            fraction: otherNumRootCause / maxNumRootCause,\n            tooltip: intl.formatMessage(\n              {\n                defaultMessage:\n                  '{numRootCause}/{numEvals} ({percentage}%) runs failed due to the {assessment} judge failing for run \"{otherRunDisplayName}\".',\n                description: 'Tooltip for the root cause metrics bar on the LLM evaluation page.',\n              },\n              {\n                numRootCause: otherNumRootCause,\n                numEvals: otherNumEvals,\n                percentage: otherPercentage,\n                assessment: assessmentDisplayInfo.assessmentInfo.name,\n                otherRunDisplayName,\n              },\n            ),\n            toggleFilter: () => toggleAssessmentFilter(assessmentDisplayInfo.assessmentInfo.name, 'rca', 'other'),\n            isSelected: assessmentFilters.some(\n              (filter) =>\n                filter.filterType === 'rca' &&\n                filter.run === 'other' &&\n                filter.assessmentName === assessmentDisplayInfo.assessmentInfo.name,\n            ),\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion -- TODO(FEINF-3982)\n            percentage: otherPercentage!,\n          }\n        : undefined,\n      icon: <XCircleFillIcon />,\n    };\n  });\n}\n","import {\n  BinaryIcon,\n  BracketsXIcon,\n  NumbersIcon,\n  SparkleDoubleIcon,\n  Tag,\n  Typography,\n  useDesignSystemTheme,\n  UserIcon,\n} from '@databricks/design-system';\nimport { useIntl } from '@databricks/i18n';\n\nimport { EvaluationsRcaStats } from './EvaluationsRcaStats';\nimport { KnownEvaluationResultAssessmentName } from '../enum';\nimport type { AssessmentAggregates, AssessmentFilter, AssessmentInfo, AssessmentValueType } from '../types';\n\nexport const EvaluationsAssessmentHoverCard = ({\n  assessmentInfo,\n  assessmentNameToAggregates,\n  allAssessmentFilters,\n  toggleAssessmentFilter,\n  runUuid,\n  compareToRunUuid,\n}: {\n  assessmentInfo: AssessmentInfo;\n  assessmentNameToAggregates: Record<string, AssessmentAggregates>;\n  allAssessmentFilters: AssessmentFilter[];\n  toggleAssessmentFilter: (\n    assessmentName: string,\n    filterValue: AssessmentValueType,\n    run: string,\n    filterType?: AssessmentFilter['filterType'],\n  ) => void;\n  runUuid?: string;\n  compareToRunUuid?: string;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const intl = useIntl();\n  return (\n    <>\n      <div\n        css={{\n          maxWidth: '25rem',\n          display: 'flex',\n          flexDirection: 'column',\n          overflowWrap: 'break-word',\n          wordBreak: 'break-word',\n          gap: theme.spacing.sm,\n        }}\n      >\n        <div\n          css={{\n            display: 'flex',\n            flexDirection: 'column',\n            gap: theme.spacing.xs,\n          }}\n        >\n          <div\n            css={{\n              display: 'flex',\n              flexDirection: 'column',\n              gap: theme.spacing.xs,\n              paddingBottom: theme.spacing.sm,\n              borderBottom: `1px solid ${theme.colors.border}`,\n            }}\n          >\n            <div\n              css={{\n                display: 'flex',\n                gap: theme.spacing.xs,\n                alignItems: 'center',\n              }}\n            >\n              {/* Dtype icon  */}\n              {assessmentInfo.dtype === 'numeric' ? (\n                <NumbersIcon />\n              ) : assessmentInfo.dtype === 'boolean' ? (\n                <BinaryIcon />\n              ) : (\n                <></>\n              )}\n\n              <Typography.Title\n                level={4}\n                css={{\n                  marginBottom: 0,\n                  marginRight: theme.spacing.xs,\n                }}\n              >\n                {assessmentInfo.displayName}\n              </Typography.Title>\n              {assessmentInfo.source?.sourceType === 'AI_JUDGE' && (\n                <Tag color=\"turquoise\" componentId=\"mlflow.experiment.evaluations.ai-judge-tag\">\n                  <div\n                    css={{\n                      display: 'flex',\n                      gap: theme.spacing.xs,\n                    }}\n                  >\n                    <SparkleDoubleIcon\n                      css={{\n                        color: theme.colors.textSecondary,\n                      }}\n                    />\n                    <Typography.Hint>\n                      {intl.formatMessage({\n                        defaultMessage: 'AI Judge',\n                        description: 'Label for AI judge in the tooltip for the assessment in the evaluation metrics.',\n                      })}\n                    </Typography.Hint>\n                  </div>\n                </Tag>\n              )}\n              {assessmentInfo.source?.sourceType === 'HUMAN' && (\n                <Tag color=\"coral\" componentId=\"mlflow.experiment.evaluations.human-judge-tag\">\n                  <div\n                    css={{\n                      display: 'flex',\n                      gap: theme.spacing.xs,\n                    }}\n                  >\n                    <UserIcon />\n                    <Typography.Hint>\n                      {intl.formatMessage({\n                        defaultMessage: 'Human judge',\n                        description:\n                          'Label for human judge in the tooltip for the assessment in the evaluation metrics.',\n                      })}\n                    </Typography.Hint>\n                  </div>\n                </Tag>\n              )}\n              {assessmentInfo.isCustomMetric && (\n                <Tag color=\"indigo\" componentId=\"mlflow.experiment.evaluations.ai-judge-tag\">\n                  <div\n                    css={{\n                      display: 'flex',\n                      gap: theme.spacing.xs,\n                    }}\n                  >\n                    <Typography.Hint>\n                      <BracketsXIcon />\n                    </Typography.Hint>\n\n                    <Typography.Hint>{assessmentInfo.metricName}</Typography.Hint>\n                  </div>\n                </Tag>\n              )}\n            </div>\n            <div>\n              <Typography.Hint>{assessmentInfo.name}</Typography.Hint>\n            </div>\n          </div>\n        </div>\n        <div>\n          <span\n            css={{\n              display: 'contents',\n              '& p': {\n                marginBottom: 0,\n              },\n            }}\n          >\n            {assessmentInfo.description}\n          </span>\n        </div>\n        {assessmentInfo.name === KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT && runUuid ? (\n          <div>\n            <EvaluationsRcaStats\n              overallAssessmentInfo={assessmentInfo}\n              assessmentNameToAggregates={assessmentNameToAggregates}\n              allAssessmentFilters={allAssessmentFilters}\n              toggleAssessmentFilter={toggleAssessmentFilter}\n              runUuid={runUuid}\n              compareToRunUuid={compareToRunUuid}\n            />\n          </div>\n        ) : (\n          <></>\n        )}\n      </div>\n    </>\n  );\n};\n","import { isNil } from 'lodash';\nimport React, { useMemo } from 'react';\n\nimport { Popover, type ThemeType } from '@databricks/design-system';\nimport type { IntlShape } from '@databricks/i18n';\n\nimport {\n  type AssessmentAggregates,\n  type AssessmentFilter,\n  type AssessmentInfo,\n  type AssessmentValueType,\n} from '../../types';\nimport { ERROR_KEY, getBarChartData } from '../../utils/AggregationUtils';\nimport { getDisplayScore, getDisplayScoreChange } from '../../utils/DisplayUtils';\n\nconst MAX_VISIBLE_ITEMS = 4;\n\nexport const CategoricalAggregateChart = React.memo(\n  ({\n    theme,\n    intl,\n    assessmentInfo,\n    assessmentAggregates,\n    allAssessmentFilters,\n    toggleAssessmentFilter,\n    currentRunDisplayName,\n    compareToRunDisplayName,\n  }: {\n    theme: ThemeType;\n    intl: IntlShape;\n    assessmentInfo: AssessmentInfo;\n    assessmentAggregates: AssessmentAggregates;\n    allAssessmentFilters: AssessmentFilter[];\n    toggleAssessmentFilter: (\n      assessmentName: string,\n      filterValue: AssessmentValueType,\n      run: string,\n      filterType?: AssessmentFilter['filterType'],\n    ) => void;\n    currentRunDisplayName?: string;\n    compareToRunDisplayName?: string;\n  }) => {\n    /** Bar data */\n    const barChartData = useMemo(\n      () =>\n        getBarChartData(\n          intl,\n          theme,\n          assessmentInfo,\n          allAssessmentFilters,\n          toggleAssessmentFilter,\n          assessmentAggregates,\n          currentRunDisplayName,\n          compareToRunDisplayName,\n        ),\n      [\n        intl,\n        theme,\n        assessmentInfo,\n        allAssessmentFilters,\n        toggleAssessmentFilter,\n        assessmentAggregates,\n        currentRunDisplayName,\n        compareToRunDisplayName,\n      ],\n    );\n\n    // Sort barChartData: most frequent first, ties resolved by original order, error and null entries at bottom\n    const sortedBarChartData = useMemo(() => {\n      // Keep original order for pass-fail and boolean assessments\n      if (assessmentInfo.dtype === 'pass-fail' || assessmentInfo.dtype === 'boolean') {\n        return barChartData;\n      }\n\n      return barChartData\n        .map((item, originalIndex) => ({ ...item, originalIndex }))\n        .sort((a, b) => {\n          const aIsBottomEntry = a.name === 'null' || a.name === ERROR_KEY;\n          const bIsBottomEntry = b.name === 'null' || b.name === ERROR_KEY;\n\n          // Always put error and null entries at the bottom\n          if (aIsBottomEntry && !bIsBottomEntry) return 1;\n          if (bIsBottomEntry && !aIsBottomEntry) return -1;\n\n          // Sort regular entries by frequency (current.value) in descending order\n          if (!aIsBottomEntry && !bIsBottomEntry) {\n            const valueComparison = (b.current?.value || 0) - (a.current?.value || 0);\n            if (valueComparison !== 0) return valueComparison;\n          }\n\n          // Resolve ties by original order\n          return a.originalIndex - b.originalIndex;\n        });\n    }, [barChartData, assessmentInfo]);\n\n    // If there's more than MAX_VISIBLE_ITEMS, show a popover with the <MAX_VISIBLE_ITEMS>th item and the rest\n    const visibleItems =\n      sortedBarChartData.length > MAX_VISIBLE_ITEMS\n        ? sortedBarChartData.slice(0, MAX_VISIBLE_ITEMS - 1)\n        : sortedBarChartData;\n    const hiddenItems =\n      sortedBarChartData.length > MAX_VISIBLE_ITEMS ? sortedBarChartData.slice(MAX_VISIBLE_ITEMS - 1) : [];\n    const hasMoreItems = hiddenItems.length > 0;\n\n    const hoverBarColor = theme.colors.actionDefaultBackgroundHover;\n    const selectedBarColor = theme.colors.actionDefaultBackgroundPress;\n\n    return (\n      <table>\n        <tbody>\n          {visibleItems.map((barData) => (\n            <ChartRow\n              key={barData.name}\n              barData={barData}\n              theme={theme}\n              hoverBarColor={hoverBarColor}\n              selectedBarColor={selectedBarColor}\n              assessmentInfo={assessmentInfo}\n            />\n          ))}\n          {hasMoreItems && (\n            <tr>\n              <td colSpan={2}>\n                <Popover.Root componentId=\"categorical-aggregate-chart-more-items\">\n                  <Popover.Trigger asChild>\n                    <div\n                      css={{\n                        cursor: 'pointer',\n                        padding: `${theme.spacing.xs}px`,\n                        color: theme.colors.actionLinkDefault,\n                        fontSize: theme.typography.fontSizeSm,\n                        fontWeight: 'normal',\n                        ':hover': {\n                          backgroundColor: hoverBarColor,\n                        },\n                        borderRadius: theme.general.borderRadiusBase,\n                      }}\n                    >\n                      {intl.formatMessage(\n                        {\n                          defaultMessage: '+{count} more',\n                          description:\n                            'Message for the popover trigger to show more items in the categorical aggregate chart.',\n                        },\n                        { count: hiddenItems.length },\n                      )}\n                    </div>\n                  </Popover.Trigger>\n                  <Popover.Content\n                    align=\"start\"\n                    side=\"bottom\"\n                    css={{\n                      maxHeight: '200px',\n                      overflowY: 'auto',\n                      width: '200px',\n                      minWidth: '200px',\n                    }}\n                  >\n                    <table>\n                      <tbody>\n                        {hiddenItems.map((barData) => (\n                          <ChartRow\n                            key={barData.name}\n                            barData={barData}\n                            theme={theme}\n                            hoverBarColor={hoverBarColor}\n                            selectedBarColor={selectedBarColor}\n                            assessmentInfo={assessmentInfo}\n                          />\n                        ))}\n                      </tbody>\n                    </table>\n                  </Popover.Content>\n                </Popover.Root>\n              </td>\n            </tr>\n          )}\n        </tbody>\n      </table>\n    );\n  },\n);\n\nconst ChartRow = ({\n  barData,\n  theme,\n  hoverBarColor,\n  selectedBarColor,\n  assessmentInfo,\n}: {\n  barData: any;\n  theme: ThemeType;\n  hoverBarColor: string;\n  selectedBarColor: string;\n  assessmentInfo: AssessmentInfo;\n}) => {\n  const isError = barData.name === ERROR_KEY;\n  const isNull = barData.name === 'null';\n\n  if (isError || isNull) {\n    return (\n      <tr\n        key={barData.name}\n        css={{\n          // filtering by error is not currently supported\n          cursor: barData.name !== ERROR_KEY ? 'pointer' : 'not-allowed',\n          ':hover': {\n            backgroundColor: hoverBarColor,\n          },\n          color: barData.name === ERROR_KEY ? theme.colors.textValidationWarning : theme.colors.textSecondary,\n          fontWeight: 'normal',\n          fontSize: theme.typography.fontSizeSm,\n        }}\n        onClick={barData.name !== ERROR_KEY ? barData.current.toggleFilter : undefined}\n      >\n        <td\n          css={{\n            width: '100%',\n            borderTopLeftRadius: theme.general.borderRadiusBase,\n            borderBottomLeftRadius: theme.general.borderRadiusBase,\n            backgroundColor: `${barData.current.isSelected ? selectedBarColor : ''}`,\n            paddingLeft: theme.spacing.xs,\n            paddingTop: theme.spacing.xs,\n            paddingBottom: theme.spacing.xs,\n            fontStyle: barData.name === ERROR_KEY ? 'normal' : 'italic',\n          }}\n        >\n          <span\n            css={{\n              lineHeight: `${theme.typography.fontSizeSm}px`,\n            }}\n          >\n            {barData.name}\n          </span>\n        </td>\n        <td\n          css={{\n            textAlign: 'right',\n            verticalAlign: 'center',\n            borderTopRightRadius: theme.general.borderRadiusBase,\n            borderBottomRightRadius: theme.general.borderRadiusBase,\n            backgroundColor: `${barData.current.isSelected ? selectedBarColor : ''}`,\n            paddingRight: theme.spacing.xs,\n            paddingTop: theme.spacing.xs,\n            paddingBottom: theme.spacing.xs,\n            fontStyle: 'normal',\n          }}\n        >\n          <span\n            css={{\n              display: 'inline-block',\n              verticalAlign: 'center',\n              lineHeight: `${theme.typography.fontSizeSm}px`,\n            }}\n          >\n            {!isNil(barData.scoreChange)\n              ? getDisplayScoreChange(assessmentInfo, barData.scoreChange, false)\n              : barData.current.value}\n          </span>\n        </td>\n      </tr>\n    );\n  }\n\n  return (\n    <tr\n      key={barData.name}\n      css={{\n        cursor: 'pointer',\n        ':hover': {\n          backgroundColor: hoverBarColor,\n        },\n      }}\n      onClick={barData.current.toggleFilter}\n    >\n      <td\n        css={{\n          width: '100%',\n          borderTopLeftRadius: theme.general.borderRadiusBase,\n          borderBottomLeftRadius: theme.general.borderRadiusBase,\n          backgroundColor: `${barData.current.isSelected ? selectedBarColor : ''}`,\n          paddingLeft: theme.spacing.xs,\n          paddingTop: theme.spacing.xs,\n          paddingBottom: theme.spacing.xs,\n        }}\n      >\n        <div\n          css={{\n            display: 'flex',\n            flexDirection: 'column',\n            gap: '2px',\n            width: '100%',\n          }}\n        >\n          <span\n            css={{\n              fontWeight: 'normal',\n              fontSize: '10px',\n              lineHeight: '10px',\n\n              color: theme.colors.textSecondary,\n            }}\n          >\n            {barData.name}\n          </span>\n          <div\n            css={{\n              flex: 1,\n              width: '100%',\n              position: 'relative',\n            }}\n          >\n            <div\n              style={{\n                width: barData.current.value > 0 ? `${barData.current.fraction * 100}%` : '2px',\n                borderRadius: '2px',\n              }}\n              css={{\n                position: 'relative',\n                // Allow shrinking for other items with minWidth.\n                flexShrink: 1,\n                transition: 'width 0.3s',\n                backgroundColor: barData.backgroundColor,\n                height: '10px',\n                display: 'flex',\n\n                alignItems: 'center',\n              }}\n            />\n          </div>\n        </div>\n      </td>\n      <td\n        css={{\n          textAlign: 'right',\n          verticalAlign: 'bottom',\n          borderTopRightRadius: theme.general.borderRadiusBase,\n          borderBottomRightRadius: theme.general.borderRadiusBase,\n          backgroundColor: `${barData.current.isSelected ? selectedBarColor : ''}`,\n          paddingRight: theme.spacing.xs,\n          paddingTop: theme.spacing.xs,\n          paddingBottom: theme.spacing.xs,\n        }}\n      >\n        <span\n          css={{\n            color: theme.colors.textSecondary,\n            fontWeight: 'normal',\n            fontSize: theme.typography.fontSizeSm,\n            display: 'inline-block',\n            verticalAlign: 'bottom',\n            lineHeight: `${theme.typography.fontSizeSm}px`,\n          }}\n        >\n          {!isNil(barData.scoreChange)\n            ? getDisplayScoreChange(assessmentInfo, barData.scoreChange)\n            : getDisplayScore(assessmentInfo, barData.current.fraction)}\n        </span>\n      </td>\n    </tr>\n  );\n};\n","import React from 'react';\n\nimport { HoverCard, Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { useIntl } from '@databricks/i18n';\n\nimport type { NumericAggregate } from '../../types';\nimport { displayFloat } from '../../utils/DisplayUtils';\n\nexport const NumericAggregateChart = React.memo(({ numericAggregate }: { numericAggregate: NumericAggregate }) => {\n  const { theme } = useDesignSystemTheme();\n  const intl = useIntl();\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexDirection: 'column',\n      }}\n    >\n      <div\n        css={{\n          display: 'flex',\n          justifyContent: 'center',\n          flexDirection: 'row',\n        }}\n      >\n        {numericAggregate.counts.map((count, index) => (\n          <HoverCard\n            key={'hover-card-' + index}\n            content={\n              <div\n                css={{\n                  display: 'flex',\n                  flexDirection: 'column',\n                }}\n              >\n                <div\n                  css={{\n                    display: 'flex',\n                    flexDirection: 'row',\n                  }}\n                >\n                  <div\n                    css={{\n                      width: '25%',\n                    }}\n                  >\n                    <Typography.Text>\n                      {intl.formatMessage({\n                        defaultMessage: 'Range',\n                        description: 'Label for the range in the tooltip for the numeric aggregate chart.',\n                      })}\n                    </Typography.Text>\n                  </div>\n                  <div>\n                    <Typography.Text color=\"secondary\">\n                      {displayFloat(count.lower, 2) === displayFloat(count.upper, 2)\n                        ? displayFloat(count.lower, 2)\n                        : `${displayFloat(count.lower, 2)} - ${displayFloat(count.upper, 2)}`}\n                    </Typography.Text>\n                  </div>\n                </div>\n                <div\n                  css={{\n                    display: 'flex',\n                    flexDirection: 'row',\n                  }}\n                >\n                  <div\n                    css={{\n                      width: '25%',\n                    }}\n                  >\n                    <Typography.Text>\n                      {intl.formatMessage({\n                        defaultMessage: 'Count',\n                        description: 'Label for the count in the tooltip for the numeric aggregate chart.',\n                      })}\n                    </Typography.Text>\n                  </div>\n                  <div>\n                    <Typography.Text color=\"secondary\">{count.count}</Typography.Text>\n                  </div>\n                </div>\n              </div>\n            }\n            trigger={\n              <div\n                key={'bar-' + index}\n                css={{\n                  display: 'flex',\n                  flex: 1,\n                  flexDirection: 'column-reverse',\n                  height: '60px',\n                  width: '10px',\n                  ':hover': {\n                    backgroundColor: theme.colors.actionDefaultBackgroundHover,\n                  },\n                }}\n              >\n                <div\n                  css={{\n                    height: `${(count.count / numericAggregate.maxCount) * 100}%`,\n                    minHeight: '1px',\n                    width: '80%',\n                    verticalAlign: 'bottom',\n                    backgroundColor: theme.colors.blue400,\n                    borderTopRightRadius: theme.general.borderRadiusBase,\n                    borderTopLeftRadius: theme.general.borderRadiusBase,\n                  }}\n                />\n              </div>\n            }\n          />\n        ))}\n      </div>\n      {numericAggregate.min === numericAggregate.max ? (\n        <div\n          css={{\n            display: 'flex',\n            justifyContent: 'center',\n            flexDirection: 'row',\n            fontWeight: 'normal',\n            fontSize: theme.typography.fontSizeSm,\n            color: theme.colors.textSecondary,\n          }}\n        >\n          {displayFloat(numericAggregate.min, 2)}\n        </div>\n      ) : (\n        <div\n          css={{\n            display: 'flex',\n            justifyContent: 'space-between',\n            flexDirection: 'row',\n            fontWeight: 'normal',\n            fontSize: theme.typography.fontSizeSm,\n            color: theme.colors.textSecondary,\n          }}\n        >\n          <div>{displayFloat(numericAggregate.min, 2)}</div>\n          <div>{displayFloat(numericAggregate.max, 2)}</div>\n        </div>\n      )}\n    </div>\n  );\n});\n","import { isNil } from 'lodash';\nimport React, { useMemo } from 'react';\n\nimport type { ThemeType } from '@databricks/design-system';\nimport type { IntlShape } from '@databricks/i18n';\n\nimport { CategoricalAggregateChart } from './CategoricalAggregateChart';\nimport { NumericAggregateChart } from './NumericAggregateChart';\nimport {\n  type AssessmentAggregates,\n  type AssessmentFilter,\n  type AssessmentInfo,\n  type AssessmentValueType,\n} from '../../types';\nimport { AGGREGATE_SCORE_CHANGE_BACKGROUND_COLORS, AGGREGATE_SCORE_CHANGE_TEXT_COLOR } from '../../utils/Colors';\nimport { getDisplayOverallScoreAndChange } from '../../utils/DisplayUtils';\nimport { withAlpha } from '../GenAiEvaluationTracesReview.utils';\n\nexport const AssessmentColumnSummary = React.memo(\n  ({\n    theme,\n    intl,\n    assessmentInfo,\n    assessmentAggregates,\n    allAssessmentFilters,\n    toggleAssessmentFilter,\n    currentRunDisplayName,\n    compareToRunDisplayName,\n    collapsedHeader,\n  }: {\n    theme: ThemeType;\n    intl: IntlShape;\n    assessmentInfo: AssessmentInfo;\n    assessmentAggregates: AssessmentAggregates;\n    allAssessmentFilters: AssessmentFilter[];\n    toggleAssessmentFilter: (\n      assessmentName: string,\n      filterValue: AssessmentValueType,\n      run: string,\n      filterType?: AssessmentFilter['filterType'],\n    ) => void;\n    currentRunDisplayName?: string;\n    compareToRunDisplayName?: string;\n    collapsedHeader?: boolean;\n  }) => {\n    const dtypeAggregateLabel = useMemo(() => {\n      if (assessmentInfo.dtype === 'pass-fail') {\n        return intl.formatMessage({\n          defaultMessage: 'PASS',\n          description: 'Header label for pass/fail assessment type for the pass rate',\n        });\n      } else if (assessmentInfo.dtype === 'boolean') {\n        return intl.formatMessage({\n          defaultMessage: 'TRUE',\n          description: 'Header label for boolean assessment type for the true rate',\n        });\n      } else if (assessmentInfo.dtype === 'string') {\n        return intl.formatMessage({\n          defaultMessage: 'STRING',\n          description: 'Header label for string assessment type',\n        });\n      } else if (assessmentInfo.dtype === 'numeric') {\n        return intl.formatMessage({\n          defaultMessage: 'AVG',\n          description: 'Header label for numeric assessment type for the average value',\n        });\n      }\n      return undefined;\n    }, [assessmentInfo, intl]);\n\n    /** Overall aggregate scores */\n    const { displayScore, displayScoreChange, changeDirection } = useMemo(\n      () => getDisplayOverallScoreAndChange(intl, assessmentInfo, assessmentAggregates),\n      [intl, assessmentInfo, assessmentAggregates],\n    );\n\n    if (assessmentInfo.dtype === 'unknown') {\n      return null;\n    }\n\n    return (\n      <div\n        css={{\n          display: 'flex',\n          flexDirection: 'column',\n          gap: theme.spacing.sm,\n        }}\n      >\n        <div\n          css={{\n            display: 'flex',\n            flexDirection: 'column',\n            paddingTop: theme.spacing.xs,\n          }}\n        >\n          {/* Aggregate label, e.g. \"PASS\" or \"TRUE\" */}\n          <div\n            css={{\n              fontWeight: 400,\n              fontSize: '10px',\n              color: theme.colors.textPlaceholder,\n            }}\n          >\n            {dtypeAggregateLabel}\n          </div>\n          {/* Overall score & diff */}\n          <div\n            css={{\n              display: 'flex',\n              gap: theme.spacing.xs,\n            }}\n          >\n            {/* Current run score */}\n            <div\n              css={{\n                fontSize: theme.typography.fontSizeLg,\n                color: theme.colors.textPrimary,\n                fontWeight: theme.typography.typographyBoldFontWeight,\n              }}\n            >\n              {displayScore}\n            </div>\n            {/* Diff score */}\n            {!isNil(displayScoreChange) && compareToRunDisplayName && (\n              <div\n                css={{\n                  display: 'flex',\n                  alignItems: 'center',\n                  height: '20px',\n                  gap: theme.spacing.xs,\n                  padding: `2px ${theme.spacing.xs}px`,\n                  fontSize: theme.typography.fontSizeMd,\n                  fontWeight: 'normal',\n                  borderRadius: theme.general.borderRadiusBase,\n                  color: AGGREGATE_SCORE_CHANGE_TEXT_COLOR,\n                  backgroundColor:\n                    changeDirection === 'none'\n                      ? ''\n                      : changeDirection === 'up'\n                      ? AGGREGATE_SCORE_CHANGE_BACKGROUND_COLORS.up\n                      : changeDirection === 'down'\n                      ? AGGREGATE_SCORE_CHANGE_BACKGROUND_COLORS.down\n                      : withAlpha(theme.colors.textSecondary, 0.1),\n                }}\n              >\n                {displayScoreChange}\n              </div>\n            )}\n          </div>\n        </div>\n\n        {!collapsedHeader &&\n          (!isNil(assessmentAggregates.currentNumericAggregate) ? (\n            <NumericAggregateChart numericAggregate={assessmentAggregates.currentNumericAggregate} />\n          ) : (\n            // Categorical charts\n            <CategoricalAggregateChart\n              theme={theme}\n              intl={intl}\n              assessmentInfo={assessmentInfo}\n              assessmentAggregates={assessmentAggregates}\n              allAssessmentFilters={allAssessmentFilters}\n              toggleAssessmentFilter={toggleAssessmentFilter}\n              currentRunDisplayName={currentRunDisplayName}\n              compareToRunDisplayName={compareToRunDisplayName}\n            />\n          ))}\n      </div>\n    );\n  },\n);\n","import { flexRender } from '@tanstack/react-table';\nimport type { HeaderGroup, ColumnSizingState, Updater } from '@tanstack/react-table';\nimport { isNil } from 'lodash';\nimport React, { useState } from 'react';\n\nimport {\n  HoverCard,\n  TableHeader,\n  TableRow,\n  TableRowSelectCell,\n  useDesignSystemTheme,\n  ChevronDownIcon,\n} from '@databricks/design-system';\nimport { useIntl } from '@databricks/i18n';\n\nimport { EvaluationsAssessmentHoverCard } from './components/EvaluationsAssessmentHoverCard';\nimport { AssessmentColumnSummary } from './components/charts/AssessmentColumnSummary';\nimport { createAssessmentColumnId } from './hooks/useTableColumns';\nimport {\n  type AssessmentAggregates,\n  type AssessmentFilter,\n  type AssessmentInfo,\n  type AssessmentValueType,\n  type EvalTraceComparisonEntry,\n} from './types';\nimport { escapeCssSpecialCharacters } from './utils/DisplayUtils';\n\ninterface GenAiTracesTableHeaderProps {\n  enableRowSelection?: boolean;\n  enableGrouping?: boolean;\n  selectedAssessmentInfos: AssessmentInfo[];\n  assessmentNameToAggregates: Record<string, AssessmentAggregates>;\n  assessmentFilters: AssessmentFilter[];\n  toggleAssessmentFilter: (\n    assessmentName: string,\n    filterValue: AssessmentValueType,\n    run: string,\n    filterType?: AssessmentFilter['filterType'],\n  ) => void;\n  runDisplayName?: string;\n  compareToRunUuid?: string;\n  compareToRunDisplayName?: string;\n  disableAssessmentTooltips?: boolean;\n  collapsedHeader: boolean;\n  setCollapsedHeader: (collapsed: boolean) => void;\n  isComparing: boolean;\n  headerGroups: HeaderGroup<EvalTraceComparisonEntry>[];\n  allRowSelected: boolean;\n  someRowSelected: boolean;\n  toggleAllRowsSelectedHandler: () => (event: unknown) => void;\n  setColumnSizing: (updater: Updater<ColumnSizingState>) => void;\n}\n\nexport const GenAiTracesTableHeader = React.memo(\n  ({\n    enableRowSelection,\n    enableGrouping,\n    selectedAssessmentInfos,\n    assessmentNameToAggregates,\n    assessmentFilters,\n    toggleAssessmentFilter,\n    runDisplayName,\n    compareToRunUuid,\n    compareToRunDisplayName,\n    disableAssessmentTooltips,\n    collapsedHeader,\n    setCollapsedHeader,\n    isComparing,\n    headerGroups,\n    allRowSelected,\n    someRowSelected,\n    toggleAllRowsSelectedHandler,\n    setColumnSizing,\n  }: GenAiTracesTableHeaderProps) => {\n    const { theme } = useDesignSystemTheme();\n    const intl = useIntl();\n    const [isChevronHovered, setIsChevronHovered] = useState(false);\n\n    // super hacky way to get the border to show between the header and the row\n    const borderCss = enableGrouping\n      ? {\n          position: 'relative' as const,\n          '&::before': {\n            content: '\"\"',\n            position: 'absolute' as const,\n            top: '32px',\n            left: 0,\n            right: 0,\n            borderTop: `1px solid ${theme.colors.border}`,\n          },\n        }\n      : {};\n\n    return (\n      <>\n        {headerGroups.map((headerGroup, depth) => (\n          <TableRow\n            isHeader\n            key={headerGroup.id}\n            css={{\n              position: 'sticky',\n              top: depth * 40,\n              zIndex: 100,\n              // hack to hide the bottom border of the first row\n              ...(enableGrouping && {\n                '& > *': {\n                  borderBottom: depth === 0 ? 'none' : undefined,\n                },\n              }),\n              ...(depth === headerGroups.length - 1 && {\n                borderBottom: `1px solid ${isChevronHovered ? theme.colors.blue500 : theme.colors.border}`,\n                transition: 'border-color 0.2s',\n                // Remove default cell borders in the last header row\n                '& > *': {\n                  borderBottom: 'none',\n                },\n              }),\n            }}\n          >\n            {enableRowSelection && (\n              <div css={selectedAssessmentInfos.length === 0 && depth === 1 ? {} : borderCss}>\n                <TableRowSelectCell\n                  componentId=\"mlflow.experiment-evaluation-monitoring.evals-logs-table-header-select-cell\"\n                  checked={allRowSelected}\n                  indeterminate={someRowSelected}\n                  onChange={toggleAllRowsSelectedHandler()}\n                  checkboxLabel={intl.formatMessage({\n                    defaultMessage: 'Select all',\n                    description: 'Description for button to select all rows in table',\n                  })}\n                  noCheckbox={depth === 0}\n                  isDisabled={isComparing}\n                />\n              </div>\n            )}\n            {headerGroup.headers.map((header) => {\n              if (header.isPlaceholder) return null; // skip spacer cells\n\n              const assessmentInfo = selectedAssessmentInfos.find(\n                (info) => createAssessmentColumnId(info.name) === header.id,\n              );\n\n              const title = header.isPlaceholder ? null : (\n                <div\n                  css={{\n                    display: 'inline-block',\n                    overflow: 'hidden',\n                    textOverflow: 'ellipsis',\n                    wordBreak: 'normal',\n                    overflowWrap: 'normal',\n                  }}\n                  title={String(flexRender(header.column.columnDef.header, header.getContext()))}\n                >\n                  {flexRender(header.column.columnDef.header, header.getContext())}\n                </div>\n              );\n              const titleElement =\n                assessmentInfo && !disableAssessmentTooltips ? (\n                  <HoverCard\n                    key={header.id}\n                    content={\n                      <>\n                        <EvaluationsAssessmentHoverCard\n                          assessmentInfo={assessmentInfo}\n                          assessmentNameToAggregates={assessmentNameToAggregates}\n                          allAssessmentFilters={assessmentFilters}\n                          toggleAssessmentFilter={toggleAssessmentFilter}\n                          runUuid={runDisplayName}\n                          compareToRunUuid={compareToRunUuid ? compareToRunDisplayName : undefined}\n                        />\n                      </>\n                    }\n                    trigger={title}\n                  />\n                ) : !isNil(title) ? (\n                  title\n                ) : null;\n\n              return (\n                <TableHeader\n                  key={header.column.id}\n                  componentId=\"codegen_mlflow_app_src_experiment-tracking_components_evaluations_evaluationsoverview.tsx_576\"\n                  css={{\n                    '> span:first-of-type': {\n                      width: '100%',\n                      height: '100%',\n                      marginTop: 'auto',\n                      marginBottom: 'auto',\n                    },\n                    ...(selectedAssessmentInfos.length === 0 && depth === 1 ? {} : borderCss),\n                  }}\n                  style={{\n                    flex: `${header.colSpan} 1 var(--header-${escapeCssSpecialCharacters(header?.column.id)}-size)`,\n                  }}\n                  header={header}\n                  column={header.column}\n                  setColumnSizing={setColumnSizing}\n                >\n                  <div css={{ display: 'flex', flexDirection: 'column', gap: theme.spacing.xs }}>\n                    {titleElement}\n                    <div\n                      css={{\n                        borderTop:\n                          !enableGrouping && selectedAssessmentInfos.length > 0\n                            ? `1px solid ${theme.colors.border}`\n                            : '',\n                        width: '100%',\n                      }}\n                    >\n                      {assessmentInfo && (\n                        <AssessmentColumnSummary\n                          theme={theme}\n                          intl={intl}\n                          assessmentInfo={assessmentInfo}\n                          assessmentAggregates={assessmentNameToAggregates[assessmentInfo.name]}\n                          allAssessmentFilters={assessmentFilters}\n                          toggleAssessmentFilter={toggleAssessmentFilter}\n                          currentRunDisplayName={runDisplayName}\n                          compareToRunDisplayName={compareToRunUuid ? compareToRunDisplayName : undefined}\n                          collapsedHeader={collapsedHeader}\n                        />\n                      )}\n                    </div>\n                  </div>\n                </TableHeader>\n              );\n            })}\n            {depth === headerGroups.length - 1 && (\n              <div\n                css={{\n                  paddingTop: '0px !important',\n                  position: 'absolute',\n                  left: 0,\n                  right: 0,\n                  bottom: 0,\n                  zIndex: 101,\n                  padding: 0,\n                  pointerEvents: 'none',\n                }}\n              >\n                {/* Mask the border under the chevron */}\n                <div\n                  css={{\n                    position: 'absolute',\n                    left: '50%',\n                    top: '100%',\n                    width: '24px',\n                    height: '12px',\n                    background: theme.colors.backgroundPrimary,\n                    transform: 'translate(-50%, -50%)',\n                    zIndex: 101,\n                  }}\n                />\n                {/* Chevron circle, pointer events enabled */}\n                <div\n                  css={{\n                    position: 'absolute',\n                    left: '50%',\n                    top: '100%',\n                    transform: 'translate(-50%, -50%)',\n                    zIndex: 102,\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    width: '22px',\n                    height: '22px',\n                    pointerEvents: 'auto',\n                    cursor: 'pointer',\n                  }}\n                  onClick={() => setCollapsedHeader(!collapsedHeader)}\n                  onMouseEnter={() => setIsChevronHovered(true)}\n                  onMouseLeave={() => setIsChevronHovered(false)}\n                >\n                  <div\n                    css={{\n                      width: '22px',\n                      height: '22px',\n                      borderRadius: '50%',\n                      background: theme.colors.backgroundPrimary,\n                      border: `2px solid ${theme.colors.border}`,\n                      boxShadow: '0 2px 8px 0 rgba(0,0,0,0.10)',\n                      display: 'flex',\n                      alignItems: 'center',\n                      justifyContent: 'center',\n                      transition: 'border-color 0.2s, box-shadow 0.2s',\n                      ':hover': {\n                        borderColor: theme.colors.blue500,\n                        boxShadow: '0 2px 12px 0 rgba(0,0,0,0.18)',\n                      },\n                      opacity: isChevronHovered ? 1 : 0.5,\n                    }}\n                  >\n                    <ChevronDownIcon\n                      css={{\n                        transform: !collapsedHeader ? 'rotate(180deg)' : 'none',\n                        transition: 'transform 0.2s, opacity 0.2s',\n                        color: theme.colors.textSecondary,\n                      }}\n                    />\n                  </div>\n                </div>\n              </div>\n            )}\n          </TableRow>\n        ))}\n      </>\n    );\n  },\n);\n","import type { HeaderContext } from '@tanstack/react-table';\n\nimport { HoverCard, useDesignSystemTheme } from '@databricks/design-system';\nimport { useIntl } from '@databricks/i18n';\n\nimport { TracesTableColumnGroup, TracesTableColumnGroupToLabelMap, type EvalTraceComparisonEntry } from '../types';\n\ntype HeaderCellRendererMeta = {\n  groupId: TracesTableColumnGroup;\n  visibleCount: number;\n  totalCount: number;\n  enableGrouping?: boolean;\n};\n\nexport const HeaderCellRenderer = (props: HeaderContext<EvalTraceComparisonEntry, unknown>) => {\n  const { theme } = useDesignSystemTheme();\n  const intl = useIntl();\n  const { groupId, visibleCount, totalCount, enableGrouping } = props.column.columnDef.meta as HeaderCellRendererMeta;\n\n  if (!enableGrouping) {\n    return TracesTableColumnGroupToLabelMap[groupId as TracesTableColumnGroup];\n  }\n\n  const groupName = TracesTableColumnGroupToLabelMap[groupId as TracesTableColumnGroup];\n  return (\n    <div\n      css={{\n        height: '100%',\n        width: '100%',\n        display: 'flex',\n        overflow: 'hidden',\n        gap: theme.spacing.sm,\n      }}\n    >\n      <div>{groupName}</div>\n      {groupId === TracesTableColumnGroup.INFO ? null : visibleCount === totalCount ? (\n        <div\n          css={{\n            color: theme.colors.textSecondary,\n            fontWeight: 'normal',\n          }}\n        >\n          ({visibleCount}/{totalCount})\n        </div>\n      ) : (\n        <HoverCard\n          trigger={\n            <div\n              css={{\n                color: theme.colors.textSecondary,\n                ':hover': {\n                  textDecoration: 'underline',\n                },\n                fontWeight: 'normal',\n              }}\n            >\n              ({visibleCount}/{totalCount})\n            </div>\n          }\n          content={intl.formatMessage(\n            {\n              defaultMessage: 'Showing {visibleCount} out of {totalCount} {groupName}. Select columns to view more.',\n              description: 'Tooltip for the group column header',\n            },\n            {\n              visibleCount,\n              totalCount,\n              groupName,\n            },\n          )}\n          align=\"start\"\n        />\n      )}\n    </div>\n  );\n};\n","import { first, isNil, isString } from 'lodash';\nimport { useEffect, useMemo, useState } from 'react';\n\nimport { Spacer, Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage, useIntl } from '@databricks/i18n';\n\nimport {\n  KnownEvaluationResultAssessmentValueMapping,\n  getEvaluationResultAssessmentValue,\n  isDraftAssessment,\n} from './GenAiEvaluationTracesReview.utils';\nimport type { RunEvaluationResultAssessment, RunEvaluationResultAssessmentDraft } from '../types';\nimport { timeSinceStr } from '../utils/DisplayUtils';\nimport { useMarkdownConverter } from '../utils/MarkdownUtils';\n\ntype AssessmentWithHistory = RunEvaluationResultAssessment | RunEvaluationResultAssessmentDraft;\n\nexport const EvaluationsReviewAssessmentDetailedHistory = ({\n  history,\n  alwaysExpanded = false,\n}: {\n  /**\n   * List of assessments to display, ordered from the most recent to the oldest.\n   */\n  history: AssessmentWithHistory[];\n  /**\n   * Whether the detailed view is always expanded.\n   */\n  alwaysExpanded?: boolean;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const intl = useIntl();\n\n  const [referenceDate, setReferenceDate] = useState<Date>(new Date());\n\n  useEffect(() => {\n    const updateDateInterval = setInterval(() => {\n      setReferenceDate(new Date());\n    }, 5000);\n    return () => {\n      clearInterval(updateDateInterval);\n    };\n  }, []);\n\n  const transitions = useMemo(() => {\n    return history.reduce<[AssessmentWithHistory, AssessmentWithHistory][]>((result, next, index) => {\n      const previous = history[index + 1];\n      if (previous) {\n        return [...result, [next, previous]];\n      }\n\n      return result;\n    }, []);\n  }, [history]);\n\n  const { makeHTML } = useMarkdownConverter();\n\n  const rationaleHtml = useMemo(() => {\n    const rationale = first(history)?.rationale;\n    return isString(rationale) ? makeHTML(rationale) : null;\n  }, [history, makeHTML]);\n\n  if (!transitions.length) {\n    if (first(history)?.rationale) {\n      return (\n        <div\n          css={{\n            display: 'flex',\n            flexDirection: 'column',\n            gap: theme.spacing.sm,\n          }}\n        >\n          {/* eslint-disable-next-line react/no-danger */}\n          <span css={{ display: 'contents' }} dangerouslySetInnerHTML={{ __html: rationaleHtml ?? '' }} />\n        </div>\n      );\n    } else if (first(history)?.errorMessage) {\n      return (\n        <>\n          <Typography.Text color=\"error\">{first(history)?.errorMessage}</Typography.Text>\n        </>\n      );\n    } else {\n      return (\n        <>\n          {!alwaysExpanded && (\n            <div>\n              <Spacer size=\"sm\" />\n              <Typography.Hint>\n                <FormattedMessage\n                  defaultMessage=\"No details for assessment\"\n                  description=\"Evaluation review > assessments > no history\"\n                />\n              </Typography.Hint>\n            </div>\n          )}\n        </>\n      );\n    }\n  }\n\n  const getMappedValue = (assessment: AssessmentWithHistory) => {\n    const value = getEvaluationResultAssessmentValue(assessment);\n    const knownMapping = KnownEvaluationResultAssessmentValueMapping[assessment.name];\n\n    if (knownMapping && !isNil(value)) {\n      const messageDescriptor = knownMapping[value.toString()] ?? knownMapping['default'];\n      if (messageDescriptor) {\n        return <FormattedMessage {...messageDescriptor} values={{ value }} />;\n      }\n    }\n\n    return value;\n  };\n\n  return (\n    <>\n      <Spacer size=\"sm\" />\n      {transitions.map(([next, previous], index) => {\n        const prevValue = getMappedValue(previous);\n        const nextValue = getMappedValue(next);\n\n        const isSameValue = prevValue === nextValue;\n\n        const when = isDraftAssessment(next)\n          ? intl.formatMessage({\n              defaultMessage: 'just now',\n              description: 'Evaluation review > assessments > tooltip > just now',\n            })\n          : timeSinceStr(next.timestamp, referenceDate);\n\n        return (\n          <div\n            key={`${next.timestamp}-${index}`}\n            css={{ marginBottom: !alwaysExpanded ? theme.spacing.md : undefined }}\n          >\n            <Typography.Hint css={{ marginBottom: theme.spacing.xs }}>\n              {prevValue && nextValue && (\n                <>\n                  <code>{getMappedValue(previous)}</code> &#8594; <code>{getMappedValue(next)}</code>{' '}\n                </>\n              )}\n              {isSameValue ? (\n                <FormattedMessage\n                  defaultMessage=\"added {when} by {user}\"\n                  description=\"Evaluation review > assessments > detailed history > added history entry\"\n                  values={{\n                    when,\n                    user: next.source?.sourceId,\n                  }}\n                />\n              ) : (\n                <FormattedMessage\n                  defaultMessage=\"edited {when} by {user}\"\n                  description=\"Evaluation review > assessments > detailed history > edited history entry\"\n                  values={{\n                    when,\n                    user: next.source?.sourceId,\n                  }}\n                />\n              )}\n            </Typography.Hint>\n            {next.rationale && <Typography.Text>{next.rationale}</Typography.Text>}\n          </div>\n        );\n      })}\n    </>\n  );\n};\n","import { first } from 'lodash';\nimport { useEffect, useMemo, useState } from 'react';\n\nimport { Tooltip } from '@databricks/design-system';\nimport { FormattedMessage, useIntl } from '@databricks/i18n';\n\nimport {\n  KnownEvaluationResultAssessmentValueMapping,\n  getEvaluationResultAssessmentValue,\n  isDraftAssessment,\n  isEvaluationResultOverallAssessment,\n  hasBeenEditedByHuman,\n} from './GenAiEvaluationTracesReview.utils';\nimport type { RunEvaluationResultAssessment } from '../types';\nimport { timeSinceStr } from '../utils/DisplayUtils';\n\nexport const EvaluationsReviewAssessmentTooltip = ({\n  assessmentHistory,\n  children,\n  disable = false,\n}: React.PropsWithChildren<{\n  assessmentHistory: RunEvaluationResultAssessment[];\n  disable?: boolean;\n}>) => {\n  const intl = useIntl();\n\n  const isOverallAssessment = useMemo(\n    () => assessmentHistory.some(isEvaluationResultOverallAssessment),\n    [assessmentHistory],\n  );\n\n  const [referenceDate, setReferenceDate] = useState<Date>(new Date());\n\n  useEffect(() => {\n    const updateDateInterval = setInterval(() => {\n      setReferenceDate(new Date());\n    }, 5000);\n    return () => {\n      clearInterval(updateDateInterval);\n    };\n  }, []);\n\n  const getTitle = () => {\n    const mostRecentEntry = first(assessmentHistory);\n    if (!mostRecentEntry) {\n      return undefined;\n    }\n    const isEditedByHuman = hasBeenEditedByHuman(mostRecentEntry);\n\n    if (isEditedByHuman) {\n      const previousRecentEntry = assessmentHistory[1];\n      const previousRecentValue = previousRecentEntry\n        ? getEvaluationResultAssessmentValue(previousRecentEntry)?.toString()\n        : undefined;\n\n      const timeSince = isDraftAssessment(mostRecentEntry)\n        ? intl.formatMessage({\n            defaultMessage: 'just now',\n            description: 'Evaluation review > assessments > tooltip > just now',\n          })\n        : timeSinceStr(mostRecentEntry.timestamp, referenceDate);\n\n      if (previousRecentValue) {\n        const mappedValue = KnownEvaluationResultAssessmentValueMapping[mostRecentEntry.name]?.[previousRecentValue];\n        const displayedPreviousValue = mappedValue ? intl.formatMessage(mappedValue) : previousRecentValue;\n\n        return (\n          <FormattedMessage\n            defaultMessage=\"Edited {timeSince} by {source}. Original value: {value}\"\n            values={{\n              timeSince,\n              source: mostRecentEntry?.source?.sourceId,\n              value: displayedPreviousValue,\n            }}\n            description=\"Evaluation review > assessments > tooltip > edited by human\"\n          />\n        );\n      }\n\n      return (\n        <FormattedMessage\n          defaultMessage=\"Edited {timeSince} by {source}.\"\n          values={{\n            timeSince,\n            source: mostRecentEntry?.source?.sourceId,\n          }}\n          description=\"Evaluation review > assessments > tooltip > edited by human\"\n        />\n      );\n    }\n\n    if (isOverallAssessment) {\n      return (\n        <FormattedMessage\n          defaultMessage=\"Overall assessment added by LLM-as-a-judge\"\n          description=\"Evaluation review > assessments > tooltip > overall assessment added by LLM-as-a-judge\"\n        />\n      );\n    }\n\n    if (mostRecentEntry?.errorMessage) {\n      return mostRecentEntry?.errorMessage;\n    }\n\n    return (\n      <FormattedMessage\n        defaultMessage=\"Assessment added by LLM-as-a-judge\"\n        description=\"Evaluation review > assessments > tooltip > assessment added by LLM-as-a-judge\"\n      />\n    );\n  };\n  return (\n    <Tooltip\n      componentId=\"web-shared.genai-traces-table.evaluations-review-assessment.tooltip\"\n      content={disable ? undefined : <span>{getTitle()}</span>}\n      side=\"top\"\n    >\n      {children}\n    </Tooltip>\n  );\n};\n","import { useMemo, useState } from 'react';\n\nimport {\n  Button,\n  Input,\n  Spacer,\n  TypeaheadComboboxInput,\n  TypeaheadComboboxMenu,\n  TypeaheadComboboxMenuItem,\n  TypeaheadComboboxRoot,\n  useComboboxState,\n  useDesignSystemTheme,\n} from '@databricks/design-system';\nimport { FormattedMessage, useIntl } from '@databricks/i18n';\n\nimport { getEvaluationResultAssessmentValue } from './GenAiEvaluationTracesReview.utils';\nimport type {\n  AssessmentDropdownSuggestionItem,\n  RunEvaluationResultAssessment,\n  RunEvaluationResultAssessmentDraft,\n} from '../types';\n\n/**\n * A form capable of adding or editing an assessment.\n */\nexport const EvaluationsReviewAssessmentUpsertForm = ({\n  editedAssessment,\n  valueSuggestions,\n  onSave,\n  onCancel,\n  readOnly = false,\n}: {\n  editedAssessment?: RunEvaluationResultAssessment | RunEvaluationResultAssessmentDraft;\n  valueSuggestions: AssessmentDropdownSuggestionItem[];\n  onSave: (values: { value: string | boolean; rationale?: string; assessmentName?: string }) => void;\n  onCancel: () => void;\n  readOnly?: boolean;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const intl = useIntl();\n\n  const [rationale, setRationale] = useState<string | undefined>(() => {\n    return editedAssessment?.rationale || undefined;\n  });\n\n  const [inputValue, setInputValue] = useState('');\n\n  const [formValue, setFormValue] = useState<AssessmentDropdownSuggestionItem | undefined>(() => {\n    // If we're editing an existing assessment, find relevant suggestion and use it as a form value\n    if (editedAssessment) {\n      const value = getEvaluationResultAssessmentValue(editedAssessment)?.toString();\n      if (value) {\n        return valueSuggestions.find((item) => item.key === value) ?? { key: value, label: value };\n      }\n\n      // Special case: if there's no value at all but we use a draft assessment, use assessment name\n      return { key: editedAssessment.name, label: editedAssessment.name };\n    }\n\n    return { key: '', label: '' };\n  });\n\n  const [showAllSuggestions, setShowAllSuggestions] = useState(false);\n\n  const filteredSuggestions = useMemo(\n    () => valueSuggestions.filter((item) => item.label.toLowerCase().includes(inputValue.toLowerCase())),\n    [inputValue, valueSuggestions],\n  );\n\n  // Show either all or filtered suggestions\n  const visibleSuggestions = showAllSuggestions ? valueSuggestions : filteredSuggestions;\n\n  // The combobox is displayed if there are suggestions or a custom value is provided\n  const displayCombobox = inputValue || visibleSuggestions.length > 0;\n\n  const comboboxState = useComboboxState<AssessmentDropdownSuggestionItem>({\n    componentId:\n      'codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewassessmentupsertform.tsx_124',\n    allItems: valueSuggestions,\n    items: visibleSuggestions,\n    setItems: () => {},\n    setInputValue: (val) => {\n      setShowAllSuggestions(false);\n      setInputValue(val);\n    },\n    multiSelect: false,\n    allowNewValue: true,\n    itemToString: (item) => (item ? item.label : ''),\n    formValue,\n    initialSelectedItem: formValue,\n    initialInputValue: formValue?.label ?? '',\n    formOnChange: (item) => {\n      // If no changes made to the currently selected item, do nothing.\n      // This is required, otherwise TypeaheadCombobox will replace object with plain string\n      if (formValue?.label === item) {\n        return;\n      }\n\n      // If provided custom value, construct a new item\n      if (typeof item === 'string') {\n        setFormValue({ key: inputValue ?? '', label: inputValue ?? '' });\n        return;\n      }\n\n      // If used a dropdown option, set it as a form value\n      setFormValue(item);\n    },\n    onIsOpenChange(isOpen) {\n      if (isOpen) {\n        // After uses clicks on the combobox, we're displaying all suggestions\n        setShowAllSuggestions(true);\n      }\n    },\n  });\n\n  const addNewElementLabel = intl.formatMessage(\n    {\n      defaultMessage: 'Add \"{label}\"',\n      description: 'Evaluation review > assessments > add new custom value element',\n    },\n    {\n      label: inputValue,\n    },\n  );\n\n  return (\n    <div>\n      <TypeaheadComboboxRoot comboboxState={comboboxState}>\n        <TypeaheadComboboxInput\n          readOnly={readOnly}\n          css={{ width: 300, backgroundColor: theme.colors.backgroundPrimary }}\n          placeholder={intl.formatMessage({\n            defaultMessage: 'Select or type an assessment',\n            description: 'Evaluation review > assessments > combobox placeholder',\n          })}\n          onKeyUp={(e) => {\n            // Close menu on Enter if no item is highlighted. We need to use onKeyUp to avoid conflicts with Downshift\n            if (comboboxState.highlightedIndex === -1 && e.key === 'Enter') {\n              comboboxState.closeMenu();\n            }\n          }}\n          comboboxState={comboboxState}\n          formOnChange={(val) => {\n            setFormValue(val);\n          }}\n        />\n        {displayCombobox && (\n          <TypeaheadComboboxMenu comboboxState={comboboxState} emptyText={addNewElementLabel} matchTriggerWidth>\n            {visibleSuggestions.map((item, index) => (\n              <TypeaheadComboboxMenuItem\n                key={`${item.key}-${index}`}\n                item={item}\n                index={index}\n                comboboxState={comboboxState}\n                isDisabled={item?.disabled || false}\n              >\n                {item.label}\n              </TypeaheadComboboxMenuItem>\n            ))}\n          </TypeaheadComboboxMenu>\n        )}\n      </TypeaheadComboboxRoot>\n      <Spacer size=\"sm\" />\n      <div css={{ backgroundColor: theme.colors.backgroundPrimary, borderRadius: theme.general.borderRadiusBase }}>\n        <Input.TextArea\n          componentId=\"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewassessmentupsertform.tsx_160\"\n          autoSize\n          value={rationale ?? ''}\n          onChange={(e) => setRationale(e.target.value)}\n          placeholder={intl.formatMessage({\n            defaultMessage: 'Add rationale (optional)',\n            description: 'Evaluation review > assessments > rationale input placeholder',\n          })}\n        />\n      </div>\n      <Spacer size=\"sm\" />\n      <div css={{ display: 'flex', gap: theme.spacing.xs }}>\n        <Button\n          size=\"small\"\n          type=\"primary\"\n          componentId=\"mlflow.evaluations_review.confirm_edited_assessment_button\"\n          onClick={() => {\n            // Assert form value\n            if (!formValue) {\n              return;\n            }\n            // Select assessment name either:\n            // - from general suggestion when having multiple\n            // - from already existing assessment when editing\n            // - from custom value when provided\n            const targetAssessmentName = formValue.rootAssessmentName ?? editedAssessment?.name ?? formValue.key;\n\n            // Either use value or set it to \"true\" if we're using plain custom assessment name\n            const value = targetAssessmentName !== formValue.key ? formValue.key : true;\n            onSave({ value, rationale, assessmentName: targetAssessmentName });\n          }}\n          disabled={!formValue?.key}\n        >\n          <FormattedMessage\n            defaultMessage=\"Confirm\"\n            description=\"Evaluation review > assessments > confirm assessment button label\"\n          />\n        </Button>\n        <Button\n          size=\"small\"\n          type=\"tertiary\"\n          componentId=\"mlflow.evaluations_review.cancel_edited_assessment_button\"\n          onClick={onCancel}\n        >\n          <FormattedMessage\n            defaultMessage=\"Cancel\"\n            description=\"Evaluation review > assessments > cancel assessment button label\"\n          />\n        </Button>\n      </div>\n    </div>\n  );\n};\n","import { useCallback, useState } from 'react';\n\nimport { useIntl } from '@databricks/i18n';\n\nimport { getAssessmentValueSuggestions } from '../components/GenAiEvaluationTracesReview.utils';\nimport type { AssessmentInfo, AssessmentDropdownSuggestionItem, RunEvaluationResultAssessment } from '../types';\n\n/**\n * Manages the state of the edit assessment form. Provides methods to start adding and editing assessments.\n */\nexport const useEditAssessmentFormState = (\n  assessmentHistory: RunEvaluationResultAssessment[],\n  assessmentInfos?: AssessmentInfo[],\n) => {\n  const intl = useIntl();\n\n  // The assessment that is currently being edited.\n  const [editingAssessment, setEditingAssessment] = useState<RunEvaluationResultAssessment | undefined>(undefined);\n  // True if the upsert form is currently being shown, false otherwise.\n  const [showUpsertForm, setShowUpsertForm] = useState(false);\n  // A list of suggestions for the value dropdown.\n  const [suggestions, setSuggestions] = useState<AssessmentDropdownSuggestionItem[]>([]);\n\n  const setFormState = useCallback(\n    (isEditing: boolean, assessment?: RunEvaluationResultAssessment) => {\n      setEditingAssessment(assessment);\n      setShowUpsertForm(isEditing);\n      setSuggestions(getAssessmentValueSuggestions(intl, assessment, assessmentHistory, assessmentInfos));\n    },\n    [intl, assessmentInfos, assessmentHistory],\n  );\n  const editAssessment = useCallback(\n    (assessment: RunEvaluationResultAssessment) => setFormState(true, assessment),\n    [setFormState],\n  );\n  const addAssessment = useCallback(() => setFormState(true, undefined), [setFormState]);\n  const closeForm = useCallback(() => {\n    setEditingAssessment(undefined);\n    setShowUpsertForm(false);\n  }, []);\n\n  return {\n    suggestions,\n    editingAssessment,\n    showUpsertForm,\n    addAssessment,\n    editAssessment,\n    closeForm,\n  };\n};\n","import { first, isString } from 'lodash';\nimport { useEffect, useMemo, useState } from 'react';\n\nimport {\n  AssistantIcon,\n  BugIcon,\n  Button,\n  ChevronRightIcon,\n  ChevronUpIcon,\n  PlusIcon,\n  Spacer,\n  Typography,\n  useDesignSystemTheme,\n} from '@databricks/design-system';\nimport { FormattedMessage, useIntl } from '@databricks/i18n';\n\nimport { EvaluationsReviewAssessmentDetailedHistory } from './EvaluationsReviewAssessmentDetailedHistory';\nimport { EvaluationsReviewAssessmentTag } from './EvaluationsReviewAssessmentTag';\nimport { EvaluationsReviewAssessmentTooltip } from './EvaluationsReviewAssessmentTooltip';\nimport { EvaluationsReviewAssessmentUpsertForm } from './EvaluationsReviewAssessmentUpsertForm';\nimport {\n  createDraftEvaluationResultAssessmentObject,\n  getEvaluationResultAssessmentValue,\n  isAssessmentMissing,\n  isDraftAssessment,\n  KnownEvaluationResultAssessmentName,\n  KnownEvaluationResultAssessmentValueLabel,\n} from './GenAiEvaluationTracesReview.utils';\nimport { useEditAssessmentFormState } from '../hooks/useEditAssessmentFormState';\nimport type { AssessmentInfo, RunEvaluationResultAssessmentDraft, RunEvaluationResultAssessment } from '../types';\nimport { EXPANDED_ASSESSMENT_DETAILS_VIEW } from '../utils/EvaluationLogging';\nimport { useMarkdownConverter } from '../utils/MarkdownUtils';\n\n/**\n * Displays an expanded assessment with rationale and edit history.\n * Expanded assessments each has its own edit form.\n */\nconst ExpandedAssessment = ({\n  assessmentsType, // Type of the assessments, e.g. 'overall', 'response', 'retrieval'. Used for component IDs.\n  assessmentName, // Name of the assessment.\n  assessmentHistory, // A list of assessment history.\n  rootCauseAssessment, // The root cause assessment causing this to fail.\n  onUpsertAssessment, // Callback to upsert an assessment. This is called when the user saves an assessment. Any pre-saving logic should be done here.\n  allowEditing = false, // Whether editing is allowed.\n  options, // A list of known assessment names as options for the dropdown.\n  inputs, // Dependency array to control the refresh of the states.\n  assessmentInfo,\n  assessmentInfos,\n}: {\n  assessmentsType: 'overall' | 'response' | 'retrieval';\n  assessmentName: string;\n  assessmentHistory: RunEvaluationResultAssessment[];\n  rootCauseAssessment?: RunEvaluationResultAssessment;\n  onUpsertAssessment: (assessment: RunEvaluationResultAssessmentDraft) => void;\n  allowEditing?: boolean;\n  options?: KnownEvaluationResultAssessmentName[];\n  inputs?: any;\n  assessmentInfo: AssessmentInfo;\n  assessmentInfos: AssessmentInfo[];\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const intl = useIntl();\n\n  const isOverallAssessment = assessmentsType === 'overall';\n\n  const {\n    suggestions,\n    editingAssessment,\n    showUpsertForm: isEditing,\n    editAssessment,\n    closeForm,\n  } = useEditAssessmentFormState(assessmentHistory, assessmentInfos);\n\n  // Clear the states when the inputs change\n  useEffect(() => {\n    // Close the form if it's open\n    closeForm();\n  }, [inputs, closeForm]);\n\n  const assessment = first(assessmentHistory);\n\n  const intlLabel = KnownEvaluationResultAssessmentValueLabel[assessmentName];\n  const label = intlLabel ? intl.formatMessage(intlLabel) : assessmentName;\n\n  const hasValue = Boolean(assessment && getEvaluationResultAssessmentValue(assessment));\n  const isDraft = Boolean(assessment && isDraftAssessment(assessment));\n\n  const isEditable = allowEditing && (hasValue || isDraft);\n\n  const { makeHTML } = useMarkdownConverter();\n\n  const suggestedActionHtml = useMemo(() => {\n    const suggestedAction = assessment?.rootCauseAssessment?.suggestedActions;\n    return isString(suggestedAction) ? makeHTML(suggestedAction) : null;\n  }, [assessment, makeHTML]);\n\n  return (\n    <div\n      key={assessmentName}\n      css={{\n        display: 'block',\n        marginBottom: !isOverallAssessment ? theme.spacing.md : undefined,\n      }}\n    >\n      {!isEditing && (\n        <div\n          css={{\n            display: 'flex',\n            flexDirection: 'column',\n            gap: theme.spacing.sm,\n          }}\n        >\n          {assessmentName !== KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT && (\n            <div\n              css={{\n                display: 'flex',\n                gap: theme.spacing.sm,\n                alignItems: 'center',\n              }}\n            >\n              <EvaluationsReviewAssessmentTag\n                assessment={assessment}\n                aria-label={label}\n                disableJudgeTypeIcon={isAssessmentMissing(assessment)}\n                onEdit={\n                  isEditable\n                    ? () => {\n                        const assessmentToEdit = first(assessmentHistory);\n                        assessmentToEdit && editAssessment(assessmentToEdit);\n                      }\n                    : undefined\n                }\n                assessmentInfo={assessmentInfo}\n                type=\"assessment-value\"\n              />\n            </div>\n          )}\n          <EvaluationsReviewAssessmentDetailedHistory\n            history={assessmentHistory}\n            alwaysExpanded={isOverallAssessment}\n          />\n\n          {rootCauseAssessment && (\n            <div\n              css={{\n                display: 'flex',\n                flexDirection: 'column',\n                gap: theme.spacing.sm,\n                marginTop: theme.spacing.xs,\n              }}\n            >\n              {/* Root cause failure */}\n              <div css={{ display: 'flex', gap: theme.spacing.sm, alignItems: 'center' }}>\n                <BugIcon color=\"danger\" />\n                <Typography.Text bold>\n                  <FormattedMessage\n                    defaultMessage=\"Root cause failure:\"\n                    description=\"Evaluation review > assessments > root cause failure > title\"\n                  />\n                </Typography.Text>\n                <EvaluationsReviewAssessmentTag\n                  assessment={rootCauseAssessment}\n                  isRootCauseAssessment\n                  aria-label={label}\n                  assessmentInfo={assessmentInfo}\n                  type=\"assessment-value\"\n                />\n              </div>\n              <EvaluationsReviewAssessmentDetailedHistory\n                history={[rootCauseAssessment]}\n                alwaysExpanded={isOverallAssessment}\n              />\n              {suggestedActionHtml && (\n                <div\n                  css={{\n                    display: 'flex',\n                    flexDirection: 'column',\n                    gap: theme.spacing.sm,\n                  }}\n                >\n                  <div css={{ display: 'flex', gap: theme.spacing.sm, alignItems: 'center' }}>\n                    <AssistantIcon color=\"ai\" />\n                    <Typography.Text bold>\n                      <FormattedMessage\n                        defaultMessage=\"Suggested actions\"\n                        description=\"Evaluation review > assessments > suggested actions > title\"\n                      />\n                    </Typography.Text>\n                  </div>\n                  {/* eslint-disable-next-line react/no-danger */}\n                  <span css={{ display: 'contents' }} dangerouslySetInnerHTML={{ __html: suggestedActionHtml }} />\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n      )}\n      {isEditing && (\n        <>\n          <EvaluationsReviewAssessmentUpsertForm\n            key={editingAssessment?.name}\n            editedAssessment={editingAssessment}\n            valueSuggestions={suggestions}\n            onCancel={closeForm}\n            onSave={({ value, rationale, assessmentName }) => {\n              const defaultAssessmentName = isOverallAssessment\n                ? KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT\n                : '';\n              const assessment = createDraftEvaluationResultAssessmentObject({\n                name: assessmentName ?? editingAssessment?.name ?? defaultAssessmentName,\n                isOverallAssessment: isOverallAssessment,\n                value,\n                rationale,\n              });\n              onUpsertAssessment(assessment);\n              closeForm();\n            }}\n          />\n        </>\n      )}\n    </div>\n  );\n};\n\n/**\n * Displays a list of assessments in expanded mode along with an add assessment button at the end.\n */\nconst ExpandedAssessments = ({\n  assessmentsType, // Type of the assessments, e.g. 'overall', 'response', 'retrieval'. Used for component IDs.\n  assessmentsByName, // A list of assessments by name.\n  rootCauseAssessment, // The root cause assessment causing this to fail.\n  onUpsertAssessment, // Callback to upsert an assessment. This is called when the user saves an assessment. Any pre-saving logic should be done here.\n  allowEditing = false, // Whether editing is allowed.\n  allowMoreThanOne = false, // Whether allow more than one assessment.\n  options, // A list of known assessment names as options for the dropdown.\n  inputs, // Dependency array to control the refresh of the states.\n  assessmentInfos,\n}: {\n  assessmentsType: 'overall' | 'response' | 'retrieval';\n  assessmentsByName: [string, RunEvaluationResultAssessment[]][];\n  rootCauseAssessment?: RunEvaluationResultAssessment;\n  onUpsertAssessment: (assessment: RunEvaluationResultAssessmentDraft) => void;\n  allowEditing?: boolean;\n  allowMoreThanOne?: boolean;\n  options?: KnownEvaluationResultAssessmentName[];\n  inputs?: any;\n  assessmentInfos: AssessmentInfo[];\n}) => {\n  const { theme } = useDesignSystemTheme();\n\n  const isOverallAssessment = assessmentsType === 'overall';\n\n  const nonEmptyAssessments = assessmentsByName.filter(([_, assessmentList]) => assessmentList.length > 0);\n\n  const { suggestions, editingAssessment, showUpsertForm, addAssessment, closeForm } = useEditAssessmentFormState(\n    nonEmptyAssessments.flatMap(([_key, assessmentList]) => assessmentList),\n    assessmentInfos,\n  );\n\n  // Clear the states when the inputs change\n  useEffect(() => {\n    // Close the form if it's open\n    closeForm();\n  }, [inputs, closeForm]);\n\n  const containsAssessments = Object.keys(nonEmptyAssessments).length > 0;\n  const showAddAssessmentButton = allowEditing && (allowMoreThanOne || !containsAssessments);\n\n  return (\n    <>\n      <div\n        // comment for copybara formatting\n        css={{ display: 'block', flexWrap: 'wrap', gap: theme.spacing.xs }}\n      >\n        {nonEmptyAssessments.map(([key, assessmentList]) => {\n          const assessmentInfo = assessmentInfos.find((info) => info.name === key);\n          if (!assessmentInfo) {\n            return <div css={{ display: 'none' }} key={key} />;\n          }\n          return (\n            <ExpandedAssessment\n              key={key}\n              assessmentsType={assessmentsType}\n              assessmentName={key}\n              assessmentHistory={assessmentList}\n              rootCauseAssessment={rootCauseAssessment}\n              onUpsertAssessment={onUpsertAssessment}\n              allowEditing={allowEditing}\n              options={options}\n              inputs={inputs}\n              assessmentInfo={assessmentInfo}\n              assessmentInfos={assessmentInfos}\n            />\n          );\n        })}\n        {showAddAssessmentButton && (\n          <Button\n            componentId={`mlflow.evaluations_review.add_assessment_${assessmentsType}_button`}\n            onClick={addAssessment}\n            icon={<PlusIcon />}\n            size=\"small\"\n          >\n            <FormattedMessage\n              defaultMessage=\"Add assessment\"\n              description=\"Evaluation review > assessments > add assessment button label\"\n            />\n          </Button>\n        )}\n      </div>\n      {showUpsertForm && (\n        <>\n          <Spacer size=\"sm\" />\n          <EvaluationsReviewAssessmentUpsertForm\n            valueSuggestions={suggestions}\n            onCancel={closeForm}\n            onSave={({ value, rationale, assessmentName }) => {\n              const defaultAssessmentName = isOverallAssessment\n                ? KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT\n                : assessmentName || '';\n              const assessment = createDraftEvaluationResultAssessmentObject({\n                name: assessmentName ?? editingAssessment?.name ?? defaultAssessmentName,\n                isOverallAssessment: isOverallAssessment,\n                value,\n                rationale,\n              });\n              onUpsertAssessment(assessment);\n              closeForm();\n            }}\n          />\n        </>\n      )}\n    </>\n  );\n};\n\n/**\n * Displays a list of assessments in compact mode.\n * Compact assessments share the same edit form.\n */\nconst CompactAssessments = ({\n  assessmentsType, // Type of the assessments, e.g. 'overall', 'response', 'retrieval'. Used for component IDs.\n  assessmentsByName, // A list of assessments by name.\n  onUpsertAssessment, // Callback to upsert an assessment. This is called when the user saves an assessment. Any pre-saving logic should be done here.\n  allowEditing = false, // Whether editing is allowed.\n  allowMoreThanOne = false, // Whether allow more than one assessment.\n  options, // A list of known assessment names as options for the dropdown.\n  inputs, // Dependency array to control the refresh of the states.\n  assessmentInfos,\n}: {\n  assessmentsType: 'overall' | 'response' | 'retrieval';\n  assessmentsByName: [string, RunEvaluationResultAssessment[]][];\n  onUpsertAssessment: (assessment: RunEvaluationResultAssessmentDraft) => void;\n  allowEditing?: boolean;\n  allowMoreThanOne?: boolean;\n  options?: KnownEvaluationResultAssessmentName[];\n  inputs?: any;\n  assessmentInfos: AssessmentInfo[];\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const intl = useIntl();\n\n  const isOverallAssessment = assessmentsType === 'overall';\n\n  const { suggestions, editingAssessment, showUpsertForm, addAssessment, editAssessment, closeForm } =\n    useEditAssessmentFormState(\n      assessmentsByName.flatMap(([_key, assessmentList]) => assessmentList),\n      assessmentInfos,\n    );\n\n  // Clear the states when the inputs change\n  useEffect(() => {\n    // Close the form if it's open\n    closeForm();\n  }, [inputs, closeForm]);\n\n  const nonEmptyAssessments = assessmentsByName.filter(([_, assessmentList]) => assessmentList.length > 0);\n\n  const containsAssessments = Object.keys(nonEmptyAssessments).length > 0;\n  const showAddAssessmentButton = allowEditing && (allowMoreThanOne || !containsAssessments);\n\n  return (\n    <>\n      <div css={{ display: 'flex', flexWrap: 'wrap', gap: theme.spacing.xs, alignItems: 'center' }}>\n        {nonEmptyAssessments.map(([key, assessmentList]) => {\n          const assessment = first(assessmentList);\n          const assessmentInfo = assessmentInfos.find((info) => info.name === key);\n\n          if (!assessmentInfo) {\n            // eslint-disable-next-line react/jsx-key -- TODO(FEINF-1756)\n            return <></>;\n          }\n\n          const intlLabel = KnownEvaluationResultAssessmentValueLabel[key];\n          const label = intlLabel ? intl.formatMessage(intlLabel) : key;\n\n          const hasValue = Boolean(assessment && getEvaluationResultAssessmentValue(assessment));\n          const isDraft = Boolean(assessment && isDraftAssessment(assessment));\n\n          const isEditable = allowEditing && (hasValue || isDraft) && assessmentInfo.isEditable;\n\n          return (\n            <div\n              key={key}\n              css={{\n                display: 'contents',\n              }}\n            >\n              <EvaluationsReviewAssessmentTooltip assessmentHistory={assessmentList}>\n                <EvaluationsReviewAssessmentTag\n                  assessment={assessment}\n                  aria-label={label}\n                  active={editingAssessment?.name === key && showUpsertForm}\n                  disableJudgeTypeIcon={isAssessmentMissing(assessment)}\n                  onEdit={\n                    isEditable\n                      ? () => {\n                          const assessmentToEdit = first(assessmentList);\n                          assessmentToEdit && editAssessment(assessmentToEdit);\n                        }\n                      : undefined\n                  }\n                  assessmentInfo={assessmentInfo}\n                  type=\"assessment-value\"\n                />\n              </EvaluationsReviewAssessmentTooltip>\n            </div>\n          );\n        })}\n        {showAddAssessmentButton && (\n          <Button\n            componentId={`mlflow.evaluations_review.add_assessment_${assessmentsType}_button`}\n            onClick={addAssessment}\n            icon={<PlusIcon />}\n            size=\"small\"\n          >\n            <FormattedMessage\n              defaultMessage=\"Add assessment\"\n              description=\"Evaluation review > assessments > add assessment button label\"\n            />\n          </Button>\n        )}\n      </div>\n      {showUpsertForm && (\n        <>\n          <Spacer size=\"sm\" />\n          <EvaluationsReviewAssessmentUpsertForm\n            key={editingAssessment?.name}\n            editedAssessment={editingAssessment}\n            valueSuggestions={suggestions}\n            onCancel={closeForm}\n            onSave={({ value, rationale, assessmentName }) => {\n              const defaultAssessmentName = isOverallAssessment\n                ? KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT\n                : assessmentName || '';\n              const assessment = createDraftEvaluationResultAssessmentObject({\n                name: assessmentName ?? editingAssessment?.name ?? defaultAssessmentName,\n                isOverallAssessment: isOverallAssessment,\n                value,\n                rationale,\n              });\n              onUpsertAssessment(assessment);\n              closeForm();\n            }}\n          />\n        </>\n      )}\n    </>\n  );\n};\n\n/**\n * Displays a list of assessments with an option to expand and see the detailed view.\n */\nexport const EvaluationsReviewAssessments = ({\n  assessmentsType, // Type of the assessments, e.g. 'overall', 'response', 'retrieval'. Used for component IDs.\n  assessmentsByName, // A list of assessments by name.\n  rootCauseAssessment, // The root cause assessment causing this to fail.\n  onUpsertAssessment, // Callback to upsert an assessment. This is called when the user saves an assessment. Any pre-saving logic should be done here.\n  allowEditing = false, // Whether editing is allowed.\n  allowMoreThanOne = false, // Whether allow more than one assessment.\n  alwaysExpanded = false, // Whether the detailed view is always expanded.\n  options, // A list of known assessment names as options for the dropdown.\n  inputs, // Dependency array to control the refresh of the states.\n  assessmentInfos,\n}: {\n  assessmentsType: 'overall' | 'response' | 'retrieval';\n  assessmentsByName: [string, RunEvaluationResultAssessment[]][];\n  rootCauseAssessment?: RunEvaluationResultAssessment;\n  onUpsertAssessment: (assessment: RunEvaluationResultAssessmentDraft) => void;\n  allowEditing?: boolean;\n  allowMoreThanOne?: boolean;\n  alwaysExpanded?: boolean;\n  options?: KnownEvaluationResultAssessmentName[];\n  inputs?: any;\n  assessmentInfos: AssessmentInfo[];\n}) => {\n  // True if in expanded view, false otherwise.\n  const [isExpandedView, setIsExpandedView] = useState(false);\n  const showExpandedView = alwaysExpanded || isExpandedView;\n\n  const nonEmptyAssessments = assessmentsByName.filter(([_, assessmentList]) => assessmentList.length > 0);\n\n  // Remove the overall assessment if it's not an overall assessment and we're not showing overall assessments.\n  let filteredAssessmentsByName = assessmentsByName;\n  if (assessmentsType !== 'overall') {\n    filteredAssessmentsByName = assessmentsByName.filter(\n      ([key, _]) => key !== KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT,\n    );\n  }\n\n  const containsAssessments = Object.keys(nonEmptyAssessments).length > 0;\n\n  return (\n    <>\n      {showExpandedView && (\n        <ExpandedAssessments\n          assessmentsType={assessmentsType}\n          assessmentsByName={filteredAssessmentsByName}\n          rootCauseAssessment={rootCauseAssessment}\n          onUpsertAssessment={onUpsertAssessment}\n          allowEditing={allowEditing}\n          allowMoreThanOne={allowMoreThanOne}\n          options={options}\n          inputs={inputs}\n          assessmentInfos={assessmentInfos}\n        />\n      )}\n      {!showExpandedView && (\n        <CompactAssessments\n          assessmentsType={assessmentsType}\n          assessmentsByName={filteredAssessmentsByName}\n          onUpsertAssessment={onUpsertAssessment}\n          allowEditing={allowEditing}\n          allowMoreThanOne={allowMoreThanOne}\n          options={options}\n          inputs={inputs}\n          assessmentInfos={assessmentInfos}\n        />\n      )}\n\n      {containsAssessments && !alwaysExpanded && (\n        <>\n          <Spacer size=\"sm\" />\n          <Button\n            size=\"small\"\n            type=\"tertiary\"\n            componentId={`mlflow.evaluations_review.see_assessment_details_${assessmentsType}_button`}\n            icon={showExpandedView ? <ChevronUpIcon /> : <ChevronRightIcon />}\n            onClick={() => setIsExpandedView((mode) => !mode)}\n          >\n            {showExpandedView ? (\n              <FormattedMessage\n                defaultMessage=\"Hide details\"\n                description=\"Evaluation review > assessments > hide details button\"\n              />\n            ) : (\n              <FormattedMessage\n                defaultMessage=\"See details\"\n                description=\"Evaluation review > assessments > see details button\"\n              />\n            )}\n          </Button>\n        </>\n      )}\n    </>\n  );\n};\n","import { Button, ChevronRightIcon } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nexport const EvaluationsReviewAssessmentsConfirmButton = ({\n  toBeReviewed,\n  containsOverallAssessment,\n  isNextResultAvailable,\n  overridingExistingReview,\n  hasPendingAssessments,\n  onClickNext,\n  onSave,\n  onCancelOverride,\n}: {\n  toBeReviewed: boolean;\n  containsOverallAssessment: boolean;\n  isNextResultAvailable: boolean;\n  hasPendingAssessments: boolean;\n  overridingExistingReview: boolean;\n  onSave?: () => Promise<void>;\n  onClickNext?: () => void;\n  onCancelOverride?: () => void;\n}) => {\n  if (toBeReviewed) {\n    if (hasPendingAssessments) {\n      return (\n        <Button type=\"primary\" componentId=\"mlflow.evaluations_review.save_pending_assessments_button\" onClick={onSave}>\n          <FormattedMessage defaultMessage=\"Save\" description=\"Evaluation review > assessments > save button\" />\n        </Button>\n      );\n    }\n    if (overridingExistingReview) {\n      return (\n        <Button componentId=\"mlflow.evaluations_review.cancel_override_assessments_button\" onClick={onCancelOverride}>\n          <FormattedMessage\n            defaultMessage=\"Cancel\"\n            description=\"Evaluation review > assessments > cancel overriding review button\"\n          />\n        </Button>\n      );\n    }\n    return (\n      <Button\n        type=\"primary\"\n        componentId=\"mlflow.evaluations_review.mark_as_reviewed_button\"\n        onClick={onSave}\n        disabled={!containsOverallAssessment}\n      >\n        <FormattedMessage\n          defaultMessage=\"Mark as reviewed\"\n          description=\"Evaluation review > assessments > mark as reviewed button\"\n        />\n      </Button>\n    );\n  }\n  return (\n    <Button\n      type=\"primary\"\n      componentId=\"mlflow.evaluations_review.next_evaluation_result_button\"\n      onClick={onClickNext}\n      endIcon={<ChevronRightIcon />}\n      disabled={!isNextResultAvailable}\n    >\n      <FormattedMessage defaultMessage=\"Next\" description=\"Evaluation review > assessments > next button\" />\n    </Button>\n  );\n};\n","import { useDesignSystemTheme } from '@databricks/design-system';\n\nexport const VerticalBar = () => {\n  const { theme } = useDesignSystemTheme();\n  return (\n    <div\n      css={{\n        width: '1.5px',\n        backgroundColor: theme.colors.border,\n      }}\n    />\n  );\n};\n","import { first } from 'lodash';\n\nimport {\n  Button,\n  CheckCircleIcon,\n  PencilIcon,\n  Spacer,\n  SparkleDoubleIcon,\n  Typography,\n  useDesignSystemTheme,\n  Tooltip,\n} from '@databricks/design-system';\nimport { FormattedMessage, useIntl } from '@databricks/i18n';\n\nimport { EvaluationsReviewAssessmentTag } from './EvaluationsReviewAssessmentTag';\nimport { EvaluationsReviewAssessments } from './EvaluationsReviewAssessments';\nimport { EvaluationsReviewAssessmentsConfirmButton } from './EvaluationsReviewAssessmentsConfirmButton';\nimport {\n  KnownEvaluationResultAssessmentName,\n  getOrderedAssessments,\n  isEvaluationResultReviewedAlready,\n  KnownEvaluationResponseAssessmentNames,\n  isAssessmentMissing,\n} from './GenAiEvaluationTracesReview.utils';\nimport { VerticalBar } from './VerticalBar';\nimport type {\n  AssessmentInfo,\n  RunEvaluationResultAssessment,\n  RunEvaluationResultAssessmentDraft,\n  RunEvaluationTracesDataEntry,\n} from '../types';\n\n/**\n * Displays section with a list of evaluation assessments: overall and detailed.\n */\nconst EvaluationsReviewSingleRunAssessmentsSection = ({\n  evaluationResult,\n  onUpsertAssessment,\n  onSavePendingAssessments,\n  onClickNext,\n  onResetPendingAssessments,\n  isNextAvailable,\n  overridingExistingReview = false,\n  pendingAssessments = [],\n  setOverridingExistingReview,\n  isReadOnly = false,\n  assessmentInfos,\n}: {\n  evaluationResult: RunEvaluationTracesDataEntry;\n  onUpsertAssessment: (assessment: RunEvaluationResultAssessmentDraft) => void;\n  onSavePendingAssessments: () => Promise<void>;\n  onClickNext?: () => void;\n  onResetPendingAssessments?: () => void;\n  isNextAvailable?: boolean;\n  overridingExistingReview?: boolean;\n  pendingAssessments?: RunEvaluationResultAssessmentDraft[];\n  setOverridingExistingReview: (override: boolean) => void;\n  isReadOnly?: boolean;\n  assessmentInfos: AssessmentInfo[];\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const intl = useIntl();\n\n  if (!evaluationResult) {\n    return null;\n  }\n  const currentOverallAssessment = first(evaluationResult.overallAssessments);\n  const rootCauseAssessmentName = currentOverallAssessment?.rootCauseAssessment?.assessmentName;\n  const rootCauseAssessment = rootCauseAssessmentName\n    ? first(evaluationResult?.responseAssessmentsByName[rootCauseAssessmentName])\n    : undefined;\n\n  const toBeReviewed =\n    !isReadOnly && (!isEvaluationResultReviewedAlready(evaluationResult) || overridingExistingReview);\n\n  const reopenReviewTooltip = intl.formatMessage({\n    defaultMessage: 'Reopen review',\n    description: 'Evaluation review > assessments > reopen review tooltip',\n  });\n\n  const overallAssessmentsByName: [string, RunEvaluationResultAssessment[]][] = [\n    [KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT, evaluationResult.overallAssessments],\n  ];\n\n  const overallAssessmentInfo = assessmentInfos.find(\n    (info) => info.name === KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT,\n  );\n\n  return (\n    <div css={{ width: '100%' }}>\n      <div css={{ width: '100%', paddingLeft: theme.spacing.md, paddingRight: theme.spacing.md }}>\n        <div\n          css={{\n            backgroundColor: theme.colors.backgroundSecondary,\n            padding: theme.spacing.md,\n            paddingBottom: 0,\n            display: 'flex',\n            flexDirection: 'column',\n            gap: theme.spacing.sm,\n          }}\n        >\n          {overallAssessmentInfo && (\n            <div css={{ display: 'flex', gap: theme.spacing.sm, alignItems: 'center' }}>\n              <SparkleDoubleIcon color=\"ai\" />\n              <Typography.Text bold>\n                <FormattedMessage\n                  defaultMessage=\"Overall assessment:\"\n                  description=\"Evaluation review > assessments > overall assessment > title\"\n                />\n              </Typography.Text>\n              {/* TODO: make overall assessment editable */}\n              <EvaluationsReviewAssessmentTag\n                assessment={currentOverallAssessment}\n                aria-label={KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT}\n                disableJudgeTypeIcon={isAssessmentMissing(currentOverallAssessment)}\n                assessmentInfo={overallAssessmentInfo}\n                type=\"assessment-value\"\n              />\n            </div>\n          )}\n          <EvaluationsReviewAssessments\n            assessmentsType=\"overall\"\n            assessmentsByName={overallAssessmentsByName}\n            rootCauseAssessment={rootCauseAssessment}\n            onUpsertAssessment={onUpsertAssessment}\n            allowEditing={toBeReviewed}\n            alwaysExpanded\n            options={[KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT]}\n            assessmentInfos={assessmentInfos}\n          />\n          <div\n            css={{\n              border: `1px solid ${theme.colors.border}`,\n              borderRadius: theme.general.borderRadiusBase,\n              padding: theme.spacing.sm,\n            }}\n          >\n            <Typography.Text bold>\n              <FormattedMessage\n                defaultMessage=\"Detailed assessments\"\n                description=\"Evaluation review > assessments > detailed assessments > title\"\n              />\n            </Typography.Text>\n            <Spacer size=\"sm\" />\n            <EvaluationsReviewAssessments\n              assessmentsType=\"response\"\n              assessmentsByName={getOrderedAssessments(evaluationResult.responseAssessmentsByName)}\n              onUpsertAssessment={onUpsertAssessment}\n              allowEditing={toBeReviewed}\n              allowMoreThanOne\n              options={KnownEvaluationResponseAssessmentNames}\n              assessmentInfos={assessmentInfos}\n            />\n          </div>\n        </div>\n        <div\n          css={{\n            position: 'sticky',\n            backgroundColor: theme.colors.backgroundSecondary,\n            padding: theme.spacing.md,\n            top: 0,\n            display: 'flex',\n            justifyContent: 'space-between',\n            gap: theme.spacing.sm,\n            zIndex: theme.options.zIndexBase,\n          }}\n        >\n          <div>\n            {!toBeReviewed && !isReadOnly && (\n              <div\n                css={{\n                  border: `1px solid ${theme.colors.border}`,\n                  borderRadius: theme.general.borderRadiusBase,\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: theme.spacing.sm,\n                  padding: `${theme.spacing.xs}px ${theme.spacing.sm}px`,\n                }}\n              >\n                <CheckCircleIcon css={{ color: theme.colors.textValidationSuccess }} />\n                <Typography.Hint>\n                  <FormattedMessage\n                    defaultMessage=\"Reviewed\"\n                    description=\"Evaluation review > assessments > already reviewed indicator\"\n                  />\n                </Typography.Hint>\n                <Tooltip\n                  componentId=\"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewassessmentssection.tsx_149\"\n                  content={reopenReviewTooltip}\n                >\n                  <Button\n                    aria-label={reopenReviewTooltip}\n                    componentId=\"mlflow.evaluations_review.reopen_review_button\"\n                    size=\"small\"\n                    icon={<PencilIcon />}\n                    onClick={() => setOverridingExistingReview(true)}\n                  />\n                </Tooltip>\n              </div>\n            )}\n          </div>\n          <div css={{ flex: 1 }} />\n          {pendingAssessments.length > 0 && (\n            <div css={{ display: 'flex', alignItems: 'center', gap: theme.spacing.sm }}>\n              <FormattedMessage\n                defaultMessage=\"{pendingCount} pending {pendingCount, plural, =1 {change} other {changes}}\"\n                description=\"Evaluation review > assessments > pending entries counter\"\n                values={{ pendingCount: pendingAssessments.length }}\n              />\n              <Button\n                componentId=\"mlflow.evaluations_review.discard_pending_assessments_button\"\n                onClick={onResetPendingAssessments}\n              >\n                <FormattedMessage\n                  defaultMessage=\"Discard\"\n                  description=\"Evaluation review > assessments > discard pending assessments button label\"\n                />\n              </Button>\n            </div>\n          )}\n          <EvaluationsReviewAssessmentsConfirmButton\n            onSave={async () => {\n              // Save the pending assessments\n              await onSavePendingAssessments();\n              // We can reset the override review flag now\n              setOverridingExistingReview(false);\n            }}\n            containsOverallAssessment={Boolean(currentOverallAssessment)}\n            isNextResultAvailable={Boolean(isNextAvailable)}\n            onClickNext={onClickNext}\n            toBeReviewed={toBeReviewed}\n            hasPendingAssessments={pendingAssessments.length > 0}\n            overridingExistingReview={overridingExistingReview}\n            onCancelOverride={() => setOverridingExistingReview(false)}\n          />\n        </div>\n      </div>\n      <Spacer size=\"md\" />\n    </div>\n  );\n};\n\n/**\n * Displays section with a list of evaluation assessments: overall and detailed.\n */\nexport const EvaluationsReviewAssessmentsSection = ({\n  evaluationResult,\n  otherEvaluationResult,\n  onUpsertAssessment,\n  onSavePendingAssessments,\n  onClickNext,\n  onResetPendingAssessments,\n  isNextAvailable,\n  overridingExistingReview = false,\n  pendingAssessments = [],\n  setOverridingExistingReview,\n  isReadOnly = false,\n  assessmentInfos,\n}: {\n  evaluationResult?: RunEvaluationTracesDataEntry;\n  otherEvaluationResult?: RunEvaluationTracesDataEntry;\n  onUpsertAssessment: (assessment: RunEvaluationResultAssessmentDraft) => void;\n  onSavePendingAssessments: () => Promise<void>;\n  onClickNext?: () => void;\n  onResetPendingAssessments?: () => void;\n  isNextAvailable?: boolean;\n  overridingExistingReview?: boolean;\n  pendingAssessments?: RunEvaluationResultAssessmentDraft[];\n  setOverridingExistingReview: (override: boolean) => void;\n  isReadOnly?: boolean;\n  assessmentInfos: AssessmentInfo[];\n}) => {\n  const { theme } = useDesignSystemTheme();\n  return (\n    <div\n      css={{\n        display: 'flex',\n        width: '100%',\n        gap: theme.spacing.sm,\n      }}\n    >\n      {evaluationResult && (\n        <EvaluationsReviewSingleRunAssessmentsSection\n          evaluationResult={evaluationResult}\n          onUpsertAssessment={onUpsertAssessment}\n          onSavePendingAssessments={onSavePendingAssessments}\n          onClickNext={onClickNext}\n          onResetPendingAssessments={onResetPendingAssessments}\n          isNextAvailable={isNextAvailable}\n          overridingExistingReview={overridingExistingReview}\n          setOverridingExistingReview={setOverridingExistingReview}\n          pendingAssessments={pendingAssessments}\n          isReadOnly={isReadOnly}\n          assessmentInfos={assessmentInfos}\n        />\n      )}\n      {otherEvaluationResult && (\n        <>\n          <VerticalBar />\n          <EvaluationsReviewSingleRunAssessmentsSection\n            evaluationResult={otherEvaluationResult}\n            onUpsertAssessment={onUpsertAssessment}\n            onSavePendingAssessments={onSavePendingAssessments}\n            onClickNext={onClickNext}\n            onResetPendingAssessments={onResetPendingAssessments}\n            isNextAvailable={isNextAvailable}\n            overridingExistingReview={overridingExistingReview}\n            setOverridingExistingReview={setOverridingExistingReview}\n            pendingAssessments={pendingAssessments}\n            isReadOnly\n            assessmentInfos={assessmentInfos}\n          />\n        </>\n      )}\n    </div>\n  );\n};\n","import { isNil } from 'lodash';\n\nimport { Drawer, Empty, Spacer, Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\nimport type { ModelTrace } from '@databricks/web-shared/model-trace-explorer';\nimport { ModelTraceExplorer } from '@databricks/web-shared/model-trace-explorer';\n\nexport const EvaluationTraceDataDrawer = ({\n  requestId,\n  onClose,\n  trace,\n}: {\n  requestId: string;\n  onClose: () => void;\n  trace: ModelTrace;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const title = (\n    <Typography.Title level={2} withoutMargins>\n      {requestId}\n    </Typography.Title>\n  );\n\n  const renderContent = () => {\n    const containsSpans = trace.data.spans.length > 0;\n    if (isNil(trace) || !containsSpans) {\n      return (\n        <>\n          <Spacer size=\"lg\" />\n          <Empty\n            description={null}\n            title={\n              <FormattedMessage\n                defaultMessage=\"No trace data recorded\"\n                description=\"Experiment page > traces data drawer > no trace data recorded empty state\"\n              />\n            }\n          />\n        </>\n      );\n    } else {\n      return (\n        <div\n          css={{\n            height: '100%',\n            marginLeft: -theme.spacing.lg,\n            marginRight: -theme.spacing.lg,\n            marginBottom: -theme.spacing.lg,\n          }}\n          // This is required for mousewheel scrolling within `Drawer`\n          onWheel={(e) => e.stopPropagation()}\n        >\n          <ModelTraceExplorer modelTrace={trace} />\n        </div>\n      );\n    }\n  };\n\n  return (\n    <Drawer.Root\n      modal\n      open\n      onOpenChange={(open) => {\n        if (!open) {\n          onClose();\n        }\n      }}\n    >\n      <Drawer.Content\n        componentId=\"mlflow.evaluations_review.trace_data_drawer\"\n        width=\"85vw\"\n        title={title}\n        expandContentToFullHeight\n      >\n        {renderContent()}\n      </Drawer.Content>\n    </Drawer.Root>\n  );\n};\n","import { isNil } from 'lodash';\nimport { useState } from 'react';\n\nimport { Button, Spacer, Tooltip, Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage, useIntl } from '@databricks/i18n';\nimport type { ModelTrace } from '@databricks/web-shared/model-trace-explorer';\nimport type { UseQueryResult } from '@databricks/web-shared/query-client';\n\nimport { EvaluationTraceDataDrawer } from './EvaluationTraceDataDrawer';\nimport { VerticalBar } from './VerticalBar';\nimport { GenAITracesTableActions } from '../GenAITracesTableActions';\nimport type { RunEvaluationTracesDataEntry } from '../types';\nimport { prettySizeWithUnit } from '../utils/DisplayUtils';\n\n// Keep in sync with https://src.dev.databricks.com/databricks-eng/universe@679eb50f2399a24f4c7f919ccb55028bd8662316/-/blob/tracing-server/src/dao/TraceEntitySpace.scala?L45\nconst DROPPED_SPAN_SIZE_TRACE_METADATA_KEY = 'databricks.tracingserver.dropped_spans_size_bytes';\n\nconst EvaluationsReviewSingleRunHeaderSection = ({\n  experimentId,\n  runDisplayName,\n  evaluationResult,\n  exportToEvalsInstanceEnabled = false,\n  traceQueryResult,\n  getTrace,\n}: {\n  experimentId: string;\n  runDisplayName?: string;\n  evaluationResult: RunEvaluationTracesDataEntry;\n  exportToEvalsInstanceEnabled?: boolean;\n  traceQueryResult: UseQueryResult<ModelTrace | undefined, unknown>;\n  getTrace?: (traceId?: string) => Promise<ModelTrace | undefined>;\n}) => {\n  const intl = useIntl();\n  const { theme } = useDesignSystemTheme();\n\n  const [selectedTraceDetailsRequestId, setSelectedTraceDetailsRequestId] = useState<string | null>(null);\n\n  const droppedSpanSize = evaluationResult.traceInfo?.trace_metadata?.[DROPPED_SPAN_SIZE_TRACE_METADATA_KEY];\n  let prettySizeString: string | undefined;\n  if (!isNil(droppedSpanSize)) {\n    const fractionDigits = 2;\n    const prettySize = prettySizeWithUnit(Number(droppedSpanSize), fractionDigits);\n    prettySizeString = `${prettySize.value} ${prettySize.unit}`;\n  }\n\n  return (\n    <div css={{ width: '100%' }}>\n      <div\n        css={{\n          width: '100%',\n          paddingLeft: theme.spacing.md,\n          paddingRight: theme.spacing.md,\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'space-between',\n          gap: theme.spacing.sm,\n        }}\n      >\n        <Typography.Title level={4}>{runDisplayName}</Typography.Title>\n        {evaluationResult.requestId && (\n          <div\n            css={{\n              display: 'flex',\n              gap: theme.spacing.sm,\n            }}\n          >\n            {exportToEvalsInstanceEnabled && getTrace && (\n              <GenAITracesTableActions\n                experimentId={experimentId}\n                selectedTraces={[evaluationResult]}\n                traceActions={{\n                  exportToEvals: {\n                    getTrace,\n                  },\n                }}\n                traceInfos={undefined}\n              />\n            )}\n            <Tooltip\n              delayDuration={0}\n              componentId=\"mlflow.evaluations_review.see_detailed_trace_view_tooltip\"\n              content={\n                droppedSpanSize\n                  ? `The trace spans were not stored due to their large size: ${prettySizeString}`\n                  : undefined\n              }\n              side=\"left\"\n            >\n              <Button\n                componentId=\"mlflow.evaluations_review.see_detailed_trace_view_button\"\n                onClick={() => setSelectedTraceDetailsRequestId(evaluationResult.requestId)}\n                loading={traceQueryResult.isLoading}\n                disabled={!isNil(droppedSpanSize)}\n              >\n                <FormattedMessage\n                  defaultMessage=\"See detailed trace view\"\n                  description=\"Evaluation review > see detailed trace view button\"\n                />\n              </Button>\n            </Tooltip>\n          </div>\n        )}\n        {selectedTraceDetailsRequestId &&\n          (!isNil(traceQueryResult.data) ? (\n            <EvaluationTraceDataDrawer\n              onClose={() => {\n                setSelectedTraceDetailsRequestId(null);\n              }}\n              requestId={selectedTraceDetailsRequestId}\n              trace={traceQueryResult.data}\n            />\n          ) : (\n            <>\n              {intl.formatMessage({\n                defaultMessage: 'No trace data available',\n                description: 'Evaluation review > no trace data available',\n              })}\n            </>\n          ))}\n      </div>\n      <Spacer size=\"md\" />\n    </div>\n  );\n};\n\n/**\n * Displays inputs for a given evaluation result, across one or two runs.\n */\nexport const EvaluationsReviewHeaderSection = ({\n  experimentId,\n  runDisplayName,\n  otherRunDisplayName,\n  evaluationResult,\n  otherEvaluationResult,\n  exportToEvalsInstanceEnabled = false,\n  traceQueryResult,\n  compareToTraceQueryResult,\n}: {\n  experimentId: string;\n  evaluationResult: RunEvaluationTracesDataEntry;\n  runDisplayName?: string;\n  otherRunDisplayName?: string;\n  otherEvaluationResult?: RunEvaluationTracesDataEntry;\n  exportToEvalsInstanceEnabled?: boolean;\n  traceQueryResult: UseQueryResult<ModelTrace | undefined, unknown>;\n  compareToTraceQueryResult: UseQueryResult<ModelTrace | undefined, unknown>;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  return (\n    <div\n      css={{\n        display: 'flex',\n        width: '100%',\n        gap: theme.spacing.sm,\n      }}\n    >\n      <EvaluationsReviewSingleRunHeaderSection\n        experimentId={experimentId}\n        runDisplayName={runDisplayName}\n        evaluationResult={evaluationResult}\n        exportToEvalsInstanceEnabled={exportToEvalsInstanceEnabled}\n        traceQueryResult={traceQueryResult}\n      />\n      {otherRunDisplayName && otherEvaluationResult && (\n        <>\n          <VerticalBar />\n          <EvaluationsReviewSingleRunHeaderSection\n            experimentId={experimentId}\n            runDisplayName={otherRunDisplayName}\n            evaluationResult={otherEvaluationResult}\n            exportToEvalsInstanceEnabled={exportToEvalsInstanceEnabled}\n            traceQueryResult={compareToTraceQueryResult}\n          />\n        </>\n      )}\n    </div>\n  );\n};\n","import React, { useState } from 'react';\n\nimport { Button, type ButtonProps, LegacyTooltip } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\ninterface EvaluationsReviewCopyButtonProps extends Partial<ButtonProps> {\n  copyText: string;\n  showLabel?: React.ReactNode;\n  componentId?: string;\n}\n\nexport const EvaluationsReviewCopyButton = ({\n  copyText,\n  showLabel = true,\n  componentId,\n  ...buttonProps\n}: EvaluationsReviewCopyButtonProps) => {\n  const [showTooltip, setShowTooltip] = useState(false);\n\n  const handleClick = () => {\n    navigator.clipboard.writeText(copyText);\n    setShowTooltip(true);\n    setTimeout(() => {\n      setShowTooltip(false);\n    }, 3000);\n  };\n\n  const handleMouseLeave = () => {\n    setShowTooltip(false);\n  };\n\n  return (\n    <LegacyTooltip\n      title={\n        <FormattedMessage defaultMessage=\"Copied\" description=\"Tooltip text shown when copy operation completes\" />\n      }\n      dangerouslySetAntdProps={{\n        visible: showTooltip,\n      }}\n    >\n      <Button\n        componentId={componentId ?? 'mlflow.shared.copy_button'}\n        type=\"primary\"\n        onClick={handleClick}\n        onMouseLeave={handleMouseLeave}\n        css={{ 'z-index': 1 }}\n        // Define children as a explicit prop so it can be easily overrideable\n        children={\n          showLabel ? <FormattedMessage defaultMessage=\"Copy\" description=\"Button text for copy button\" /> : undefined\n        }\n        {...buttonProps}\n      />\n    </LegacyTooltip>\n  );\n};\n","import { useMemo } from 'react';\n\nexport const EvaluationsReviewExpandedJSONValueCell = ({ value }: { value: string | Record<string, unknown> }) => {\n  const structuredJSONValue = useMemo(() => {\n    // If value is already an object, stringify it directly\n    if (typeof value === 'object' && value !== null) {\n      return JSON.stringify(value, null, 2);\n    }\n\n    // If value is a string, try to parse it as JSON\n    if (typeof value === 'string') {\n      try {\n        const objectData = JSON.parse(value);\n        return JSON.stringify(objectData, null, 2);\n      } catch (e) {\n        return null;\n      }\n    }\n\n    // For any other type, return null\n    return null;\n  }, [value]);\n\n  return (\n    <div\n      css={{\n        whiteSpace: 'pre-wrap',\n        wordBreak: 'break-word',\n        fontFamily: structuredJSONValue ? 'monospace' : undefined,\n      }}\n    >\n      {structuredJSONValue || String(value)}\n    </div>\n  );\n};\n","import { isString } from 'lodash';\nimport React, { useMemo } from 'react';\n\nimport { CopyIcon, Typography, useDesignSystemTheme } from '@databricks/design-system';\n\nimport { EvaluationsReviewCopyButton } from './EvaluationsReviewCopyButton';\nimport { EvaluationsReviewExpandedJSONValueCell } from './EvaluationsReviewExpandableCell';\nimport { EXPECTED_FACTS_FIELD_NAME, stringifyValue } from './GenAiEvaluationTracesReview.utils';\nimport { useMarkdownConverter } from '../utils/MarkdownUtils';\n\nexport const EvaluationsReviewTextBox = ({\n  fieldName,\n  title,\n  value,\n  showCopyIcon,\n}: {\n  fieldName: string;\n  title: React.ReactNode;\n  value: any;\n  showCopyIcon?: boolean;\n}) => {\n  const { theme } = useDesignSystemTheme();\n\n  const { makeHTML } = useMarkdownConverter();\n\n  const htmlContent = useMemo(() => {\n    return isString(value) ? makeHTML(value) : null;\n  }, [value, makeHTML]);\n\n  const jsonContent = useMemo(() => {\n    return isString(value) ? null : stringifyValue(value);\n  }, [value]);\n\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexDirection: 'column',\n        gap: theme.spacing.sm,\n        flex: 1,\n        border: `1px solid ${theme.colors.border}`,\n        padding: theme.spacing.md,\n        borderRadius: theme.general.borderRadiusBase,\n        marginBottom: theme.spacing.md,\n      }}\n    >\n      <div css={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n        <Typography.Text bold>{title}</Typography.Text>\n        {showCopyIcon && (\n          <EvaluationsReviewCopyButton\n            copyText={stringifyValue(value)}\n            showLabel={false}\n            type=\"tertiary\"\n            icon={<CopyIcon />}\n          />\n        )}\n      </div>\n      <Typography.Paragraph\n        css={{\n          marginBottom: '0 !important',\n        }}\n      >\n        {isString(value) ? (\n          // eslint-disable-next-line react/no-danger\n          <span css={{ display: 'contents' }} dangerouslySetInnerHTML={{ __html: htmlContent ?? '' }} />\n        ) : fieldName === EXPECTED_FACTS_FIELD_NAME && Array.isArray(value) ? (\n          <ul>\n            {value.map((fact, index) => (\n              <li key={index}>\n                <EvaluationsReviewExpandedJSONValueCell key={index} value={fact} />\n              </li>\n            ))}\n          </ul>\n        ) : (\n          <EvaluationsReviewExpandedJSONValueCell value={jsonContent} />\n        )}\n      </Typography.Paragraph>\n    </div>\n  );\n};\n","import { Spacer, Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport { EvaluationsReviewTextBox } from './EvaluationsReviewTextBox';\nimport type { RunEvaluationTracesDataEntry } from '../types';\n\n/**\n * Displays inputs for a given evaluation result of a single run.\n */\nconst EvaluationsReviewSingleRunInputSection = ({\n  evaluationResult,\n}: {\n  evaluationResult: RunEvaluationTracesDataEntry;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const { inputs } = evaluationResult;\n  const inputsEntries = Object.entries(inputs);\n  const noValues = inputsEntries.length === 0;\n  return (\n    <div css={{ width: '100%', paddingLeft: theme.spacing.md, paddingRight: theme.spacing.md }}>\n      <Typography.Text bold>\n        <FormattedMessage\n          defaultMessage=\"{count, plural, one {Input} other {Inputs}}\"\n          description=\"Evaluation review > input section > title\"\n          values={{ count: inputsEntries.length }}\n        />\n      </Typography.Text>\n      <Spacer size=\"sm\" />\n      {noValues && (\n        <Typography.Paragraph>\n          <FormattedMessage\n            defaultMessage=\"No inputs logged\"\n            description=\"Evaluation review > input section > no values\"\n          />\n        </Typography.Paragraph>\n      )}\n      {inputsEntries.map(([key, input]) => (\n        <EvaluationsReviewTextBox fieldName={key} title={key} value={input} key={key} />\n      ))}\n    </div>\n  );\n};\n\n/**\n * Displays inputs for a given evaluation result, across one or two runs.\n */\nexport const EvaluationsReviewInputSection = ({\n  evaluationResult,\n  otherEvaluationResult,\n}: {\n  evaluationResult?: RunEvaluationTracesDataEntry;\n  otherEvaluationResult?: RunEvaluationTracesDataEntry;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const inputsAreTheSame = evaluationResult?.inputsId === otherEvaluationResult?.inputsId;\n  return (\n    <div\n      css={{\n        display: 'flex',\n        width: '100%',\n        gap: theme.spacing.sm,\n      }}\n    >\n      {evaluationResult && <EvaluationsReviewSingleRunInputSection evaluationResult={evaluationResult} />}\n      {!inputsAreTheSame && otherEvaluationResult && (\n        <EvaluationsReviewSingleRunInputSection evaluationResult={otherEvaluationResult} />\n      )}\n    </div>\n  );\n};\n","import { Spacer, Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport { EvaluationsReviewTextBox } from './EvaluationsReviewTextBox';\nimport {\n  isRetrievedContext,\n  KnownEvaluationResultAssessmentOutputLabel,\n  KnownEvaluationResultAssessmentTargetLabel,\n} from './GenAiEvaluationTracesReview.utils';\nimport { VerticalBar } from './VerticalBar';\nimport type { RunEvaluationTracesDataEntry } from '../types';\n\nconst EvaluationsReviewSingleRunResponseSection = ({\n  evaluationResult,\n}: {\n  evaluationResult: RunEvaluationTracesDataEntry;\n}) => {\n  const { theme } = useDesignSystemTheme();\n\n  const { outputs, targets } = evaluationResult;\n\n  // Filter out retrieve_context values\n  const outputEntries = Object.entries(outputs).filter(([, value]) => !isRetrievedContext(value));\n  const targetEntries = Object.entries(targets).filter(([, value]) => !isRetrievedContext(value));\n\n  const noValues = outputEntries.length === 0 && targetEntries.length === 0;\n\n  return (\n    <div css={{ paddingLeft: theme.spacing.md, paddingRight: theme.spacing.md, width: '100%' }}>\n      <Typography.Text bold>\n        <FormattedMessage defaultMessage=\"Response\" description=\"Evaluation review > Response section > title\" />\n      </Typography.Text>\n      <Spacer size=\"sm\" />\n      {noValues && (\n        <Typography.Paragraph>\n          <FormattedMessage\n            defaultMessage=\"No responses or targets logged\"\n            description=\"Evaluation review > Response section > no values\"\n          />\n        </Typography.Paragraph>\n      )}\n      <div css={{ display: 'flex', gap: theme.spacing.md, alignItems: 'flex-start' }}>\n        {outputEntries.length > 0 && (\n          <div css={{ flex: 1 }}>\n            {outputEntries.map(([key, output]) => {\n              const mappedTitle = KnownEvaluationResultAssessmentOutputLabel[key];\n              const title = mappedTitle ? <FormattedMessage {...mappedTitle} /> : key;\n              return <EvaluationsReviewTextBox key={key} fieldName={key} title={title} value={output} showCopyIcon />;\n            })}\n          </div>\n        )}\n\n        {targetEntries.length > 0 && (\n          <div css={{ flex: 1 }}>\n            {targetEntries.map(([key, output]) => {\n              const mappedTitle = KnownEvaluationResultAssessmentTargetLabel[key];\n              const title = mappedTitle ? <FormattedMessage {...mappedTitle} /> : key;\n              return <EvaluationsReviewTextBox key={key} fieldName={key} title={title} value={output} showCopyIcon />;\n            })}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\n/**\n * Displays responses and targets for a given evaluation result.\n */\nexport const EvaluationsReviewResponseSection = ({\n  evaluationResult,\n  otherEvaluationResult,\n}: {\n  evaluationResult?: RunEvaluationTracesDataEntry;\n  otherEvaluationResult?: RunEvaluationTracesDataEntry;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  return (\n    <div\n      css={{\n        display: 'flex',\n        width: '100%',\n        gap: theme.spacing.sm,\n      }}\n    >\n      {evaluationResult && <EvaluationsReviewSingleRunResponseSection evaluationResult={evaluationResult} />}\n      {otherEvaluationResult && (\n        <>\n          <VerticalBar />\n          <EvaluationsReviewSingleRunResponseSection evaluationResult={otherEvaluationResult} />\n        </>\n      )}\n    </div>\n  );\n};\n","import { QuestionMarkIcon, SparkleDoubleIcon, UserIcon, useDesignSystemTheme } from '@databricks/design-system';\n\nimport { hasBeenEditedByHuman } from './GenAiEvaluationTracesReview.utils';\nimport type { AssessmentInfo, RunEvaluationResultAssessment } from '../types';\nimport { getEvaluationResultAssessmentBackgroundColor } from '../utils/Colors';\n\n/**\n * A small indicator that shows the evaluation result's icon and sentiment.\n */\nexport const EvaluationsReviewListItemIndicator = ({\n  assessment,\n  chunkRelevanceAssessmentInfo,\n}: {\n  assessment?: RunEvaluationResultAssessment;\n  chunkRelevanceAssessmentInfo?: AssessmentInfo;\n}) => {\n  const { theme } = useDesignSystemTheme();\n\n  if (!assessment && !chunkRelevanceAssessmentInfo) {\n    return <></>;\n  }\n\n  return (\n    <div\n      css={{\n        paddingLeft: theme.spacing.sm,\n        paddingRight: theme.spacing.sm,\n        paddingTop: 1,\n        paddingBottom: 1,\n        backgroundColor: chunkRelevanceAssessmentInfo\n          ? getEvaluationResultAssessmentBackgroundColor(theme, chunkRelevanceAssessmentInfo, assessment)\n          : '',\n        borderRadius: theme.general.borderRadiusBase,\n        svg: { width: 12, height: 12 },\n      }}\n    >\n      {assessment ? (\n        <>{hasBeenEditedByHuman(assessment) ? <UserIcon /> : <SparkleDoubleIcon />}</>\n      ) : (\n        <QuestionMarkIcon />\n      )}\n    </div>\n  );\n};\n","import { first, isNil } from 'lodash';\nimport { useMemo, useState } from 'react';\n\nimport { Spacer, Tag, TableSkeleton, Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { useIntl, FormattedMessage } from '@databricks/i18n';\nimport type { ModelTrace } from '@databricks/web-shared/model-trace-explorer';\nimport type { UseQueryResult } from '@databricks/web-shared/query-client';\n\nimport { EvaluationsReviewAssessments } from './EvaluationsReviewAssessments';\nimport { EvaluationsReviewListItemIndicator } from './EvaluationsReviewListItemIndicator';\nimport {\n  isEvaluationResultReviewedAlready,\n  KnownEvaluationResultAssessmentMetadataFields,\n  getOrderedAssessments,\n  KnownEvaluationRetrievalAssessmentNames,\n  KnownEvaluationResultAssessmentName,\n} from './GenAiEvaluationTracesReview.utils';\nimport { VerticalBar } from './VerticalBar';\nimport type {\n  AssessmentInfo,\n  RunEvaluationResultAssessmentDraft,\n  RunEvaluationTracesDataEntry,\n  RunEvaluationTracesRetrievalChunk,\n} from '../types';\nimport { useMarkdownConverter } from '../utils/MarkdownUtils';\nimport { getRetrievedContextFromTrace } from '../utils/TraceUtils';\n\nfunction isValidHttpUrl(str: any) {\n  // The URL() constructor will throw on invalid URL\n  try {\n    const url = new URL(str);\n    return url.protocol === 'http:' || url.protocol === 'https:';\n  } catch (err) {\n    return false;\n  }\n}\n\nconst RetrievedChunkHeader = ({ chunk, index }: { chunk: RunEvaluationTracesRetrievalChunk; index: number }) => {\n  return (\n    <div\n      css={{\n        display: 'flex',\n        alignItems: 'center',\n      }}\n    >\n      <Tag componentId=\"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewretrievalsection.tsx_30\">\n        #{index + 1}\n      </Tag>\n      {isValidHttpUrl(chunk.docUrl) ? (\n        <Typography.Link\n          componentId=\"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewretrievalsection.tsx_32\"\n          href={chunk.docUrl}\n          ellipsis\n          openInNewTab\n          strong\n        >\n          {chunk.docUrl}\n        </Typography.Link>\n      ) : (\n        <Typography.Title level={4} withoutMargins ellipsis>\n          {chunk.docUrl}\n        </Typography.Title>\n      )}\n    </div>\n  );\n};\n\nconst EvaluationsReviewSingleRunRetrievalSection = ({\n  evaluationResult,\n  onUpsertAssessment,\n  overridingExistingReview = false,\n  isReadOnly = false,\n  assessmentInfos,\n  traceQueryResult,\n}: {\n  evaluationResult: RunEvaluationTracesDataEntry;\n  onUpsertAssessment: (assessment: RunEvaluationResultAssessmentDraft) => void;\n  overridingExistingReview?: boolean;\n  isReadOnly?: boolean;\n  assessmentInfos: AssessmentInfo[];\n  traceQueryResult: UseQueryResult<ModelTrace | undefined, unknown>;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const intl = useIntl();\n\n  const [selectedIndex, setSelectedIndex] = useState<number>(0);\n\n  const { makeHTML } = useMarkdownConverter();\n\n  const evaluationRetrievalChunks = useMemo(() => {\n    return !isNil(evaluationResult.retrievalChunks) && evaluationResult.retrievalChunks.length > 0\n      ? evaluationResult.retrievalChunks\n      : getRetrievedContextFromTrace(evaluationResult.responseAssessmentsByName, traceQueryResult.data);\n  }, [evaluationResult.responseAssessmentsByName, evaluationResult.retrievalChunks, traceQueryResult.data]);\n\n  const selectedEntryHtmlContent = useMemo(\n    () => makeHTML(evaluationRetrievalChunks?.[selectedIndex]?.content),\n    [evaluationRetrievalChunks, selectedIndex, makeHTML],\n  );\n\n  const noRetrievalFound = (evaluationRetrievalChunks || []).length === 0;\n\n  const toBeReviewed =\n    !isReadOnly && (!isEvaluationResultReviewedAlready(evaluationResult) || overridingExistingReview);\n\n  const selectedChunk = evaluationRetrievalChunks?.[selectedIndex];\n\n  const sectionTitle = intl.formatMessage({\n    defaultMessage: 'Retrieval',\n    description: 'Evaluation review > Retrieval section > title',\n  });\n\n  return (\n    <div\n      css={{\n        paddingLeft: theme.spacing.md,\n        paddingRight: theme.spacing.md,\n        width: '100%',\n        display: 'flex',\n        flexDirection: 'column',\n      }}\n      role=\"region\"\n      aria-label={sectionTitle}\n    >\n      <Typography.Text bold>{sectionTitle}</Typography.Text>\n\n      {isNil(evaluationRetrievalChunks) && traceQueryResult.isFetching ? (\n        <TableSkeleton lines={3} />\n      ) : noRetrievalFound ? (\n        <Typography.Text>\n          <i>\n            <FormattedMessage\n              defaultMessage=\"No span with type RETRIEVER found in trace.\"\n              description=\"GenAi Traces Table > Modal > Message displayed when no retrievals are found\"\n            />\n          </i>\n        </Typography.Text>\n      ) : (\n        <div\n          css={{\n            minHeight: 400,\n            maxHeight: 600,\n            overflow: 'hidden',\n            display: 'flex',\n            marginTop: theme.spacing.sm,\n            border: `1px solid ${theme.colors.border}`,\n            borderRadius: theme.general.borderRadiusBase,\n          }}\n        >\n          <div\n            css={{\n              flex: 1,\n              flexShrink: 1,\n              maxWidth: 300,\n              minWidth: 200,\n              overflow: 'auto',\n              padding: theme.spacing.sm,\n              borderRight: `1px solid ${theme.colors.border}`,\n            }}\n            role=\"listbox\"\n          >\n            {noRetrievalFound && (\n              <Typography.Paragraph>\n                <FormattedMessage\n                  defaultMessage=\"No retrieval logged\"\n                  description=\"Evaluation review > retrieval section > no values\"\n                />\n              </Typography.Paragraph>\n            )}\n            {(evaluationRetrievalChunks || []).map((chunk, index) => {\n              const chunkRelevanceAssessmentInfo = assessmentInfos.find(\n                (info) => info.name === KnownEvaluationResultAssessmentName.CHUNK_RELEVANCE,\n              );\n\n              return (\n                <div\n                  role=\"option\"\n                  aria-label={chunk.content?.slice(0, 255)}\n                  aria-selected={index === selectedIndex}\n                  key={[chunk.docUrl, index].join('-')}\n                  css={{\n                    backgroundColor: index === selectedIndex ? theme.colors.actionIconBackgroundHover : 'transparent',\n                    '&:hover': {\n                      backgroundColor: theme.colors.actionIconBackgroundHover,\n                    },\n                    padding: `${theme.spacing.sm}px ${theme.spacing.md}px`,\n                    overflow: 'hidden',\n                    display: 'flex',\n                    gap: theme.spacing.sm,\n                    alignItems: 'center',\n                    cursor: 'pointer',\n                    width: '100%',\n                  }}\n                  onClick={() => {\n                    setSelectedIndex(index);\n                  }}\n                >\n                  {/* TODO: Find a better way to determine which retrieval assessment to use for the indicator */}\n                  <EvaluationsReviewListItemIndicator\n                    chunkRelevanceAssessmentInfo={chunkRelevanceAssessmentInfo}\n                    assessment={first(\n                      chunk?.retrievalAssessmentsByName?.[KnownEvaluationResultAssessmentName.CHUNK_RELEVANCE],\n                    )}\n                  />\n                  <Typography.Text ellipsis css={{ flex: 1, lineHeight: theme.typography.lineHeightLg }}>\n                    {chunk.content}\n                  </Typography.Text>\n                </div>\n              );\n            })}\n          </div>\n\n          {selectedChunk && (\n            <div css={{ flex: 2, display: 'flex', flexDirection: 'column', width: 0 }}>\n              <div\n                css={{\n                  padding: theme.spacing.md,\n                  borderBottom: `1px solid ${theme.colors.border}`,\n                }}\n              >\n                <RetrievedChunkHeader chunk={selectedChunk} index={selectedIndex} />\n                <Spacer size=\"md\" />\n                <EvaluationsReviewAssessments\n                  assessmentsType=\"retrieval\"\n                  assessmentsByName={getOrderedAssessments(selectedChunk.retrievalAssessmentsByName || {})}\n                  onUpsertAssessment={(assessment: RunEvaluationResultAssessmentDraft) => {\n                    if (!assessment.metadata) {\n                      assessment.metadata = {};\n                    }\n                    // Set the chunk index to the selected index\n                    assessment.metadata[KnownEvaluationResultAssessmentMetadataFields.CHUNK_INDEX] = selectedIndex;\n                    onUpsertAssessment(assessment);\n                  }}\n                  allowEditing={toBeReviewed}\n                  allowMoreThanOne\n                  options={KnownEvaluationRetrievalAssessmentNames}\n                  inputs={[selectedIndex]}\n                  assessmentInfos={assessmentInfos}\n                />\n              </div>\n              <div css={{ padding: theme.spacing.md, overflow: 'auto' }}>\n                <Typography.Paragraph>\n                  <span\n                    css={{ display: 'contents' }}\n                    // eslint-disable-next-line react/no-danger\n                    dangerouslySetInnerHTML={{ __html: selectedEntryHtmlContent ?? '' }}\n                  />\n                </Typography.Paragraph>\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n};\n\n/**\n * Displays RAG retrieval results for a given evaluation result.\n */\nexport const EvaluationsReviewRetrievalSection = ({\n  evaluationResult,\n  otherEvaluationResult,\n  onUpsertAssessment,\n  overridingExistingReview = false,\n  isReadOnly = false,\n  assessmentInfos,\n  traceQueryResult,\n  compareToTraceQueryResult,\n}: {\n  evaluationResult?: RunEvaluationTracesDataEntry;\n  otherEvaluationResult?: RunEvaluationTracesDataEntry;\n  onUpsertAssessment: (assessment: RunEvaluationResultAssessmentDraft) => void;\n  overridingExistingReview?: boolean;\n  isReadOnly?: boolean;\n  assessmentInfos: AssessmentInfo[];\n  traceQueryResult: UseQueryResult<ModelTrace | undefined, unknown>;\n  compareToTraceQueryResult: UseQueryResult<ModelTrace | undefined, unknown>;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  return (\n    <div\n      css={{\n        display: 'flex',\n        width: '100%',\n        gap: theme.spacing.sm,\n      }}\n    >\n      {evaluationResult && (\n        <EvaluationsReviewSingleRunRetrievalSection\n          evaluationResult={evaluationResult}\n          onUpsertAssessment={onUpsertAssessment}\n          overridingExistingReview={overridingExistingReview}\n          isReadOnly={isReadOnly}\n          assessmentInfos={assessmentInfos}\n          traceQueryResult={traceQueryResult}\n        />\n      )}\n      {otherEvaluationResult && (\n        <>\n          <VerticalBar />\n          <EvaluationsReviewSingleRunRetrievalSection\n            evaluationResult={otherEvaluationResult}\n            onUpsertAssessment={onUpsertAssessment}\n            overridingExistingReview={overridingExistingReview}\n            isReadOnly={isReadOnly}\n            assessmentInfos={assessmentInfos}\n            traceQueryResult={compareToTraceQueryResult}\n          />\n        </>\n      )}\n    </div>\n  );\n};\n","import { useState } from 'react';\n\nimport { Alert, Button, Spacer, Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage, useIntl } from '@databricks/i18n';\nimport type { ModelTrace } from '@databricks/web-shared/model-trace-explorer';\nimport type { UseQueryResult } from '@databricks/web-shared/query-client';\n\nimport { EvaluationsReviewAssessmentsSection } from './EvaluationsReviewAssessmentsSection';\nimport { EvaluationsReviewHeaderSection } from './EvaluationsReviewHeaderSection';\nimport { EvaluationsReviewInputSection } from './EvaluationsReviewInputSection';\nimport { EvaluationsReviewResponseSection } from './EvaluationsReviewResponseSection';\nimport { EvaluationsReviewRetrievalSection } from './EvaluationsReviewRetrievalSection';\nimport { getEvaluationResultTitle } from './GenAiEvaluationTracesReview.utils';\nimport { usePendingAssessmentEntries } from '../hooks/usePendingAssessmentEntries';\nimport type { AssessmentInfo, RunEvaluationResultAssessmentDraft, RunEvaluationTracesDataEntry } from '../types';\n\nexport const EvaluationsReviewDetailsHeader = ({\n  evaluationResult,\n}: {\n  evaluationResult: RunEvaluationTracesDataEntry;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  return (\n    <div css={{ display: 'flex', alignItems: 'center', gap: theme.spacing.sm, overflow: 'hidden' }}>\n      <Typography.Title\n        level={2}\n        withoutMargins\n        css={{ flex: 1, whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}\n      >\n        {getEvaluationResultTitle(evaluationResult)}\n      </Typography.Title>\n    </div>\n  );\n};\n\nexport const EvaluationsReviewDetails = ({\n  experimentId,\n  evaluationResult,\n  otherEvaluationResult,\n  onSavePendingAssessments,\n  onClickNext,\n  runDisplayName,\n  compareToRunDisplayName,\n  isNextAvailable = false,\n  isReadOnly = false,\n  exportToEvalsInstanceEnabled = false,\n  assessmentInfos,\n  traceQueryResult,\n  compareToTraceQueryResult,\n}: {\n  experimentId: string;\n  evaluationResult: RunEvaluationTracesDataEntry;\n  otherEvaluationResult?: RunEvaluationTracesDataEntry;\n  onSavePendingAssessments?: (\n    evaluationResult: RunEvaluationTracesDataEntry,\n    pendingAssessments: RunEvaluationResultAssessmentDraft[],\n  ) => Promise<void>;\n  onClickNext?: () => void;\n  runDisplayName?: string;\n  compareToRunDisplayName?: string;\n  isNextAvailable?: boolean;\n  isReadOnly?: boolean;\n  exportToEvalsInstanceEnabled?: boolean;\n  assessmentInfos: AssessmentInfo[];\n  traceQueryResult: UseQueryResult<ModelTrace | undefined, unknown>;\n  compareToTraceQueryResult: UseQueryResult<ModelTrace | undefined, unknown>;\n}) => {\n  const intl = useIntl();\n\n  const { pendingAssessments, draftEvaluationResult, upsertAssessment, resetPendingAssessments } =\n    usePendingAssessmentEntries(evaluationResult);\n\n  const hasPendingAssessments = pendingAssessments.length > 0;\n\n  // If user has already reviewed the evaluation, this flag allows to override the review and enable editing\n  const [overridingExistingReview, setOverridingExistingReview] = useState(false);\n\n  const hasErrorCode = Boolean(evaluationResult.errorCode);\n  const hasErrorMessage = Boolean(evaluationResult.errorMessage);\n  const showAlert = hasErrorCode || hasErrorMessage;\n  const [alertExpanded, setAlertExpanded] = useState(false);\n  const toggleAlertExpanded = () => setAlertExpanded((alertExpanded) => !alertExpanded);\n\n  return (\n    <>\n      {showAlert ? (\n        <>\n          <Alert\n            action={\n              hasErrorMessage && (\n                <Button\n                  componentId={`mlflow.evaluations_review.evaluation_error_alert.show_${\n                    alertExpanded ? 'less' : 'more'\n                  }_button`}\n                  onClick={toggleAlertExpanded}\n                >\n                  {alertExpanded ? (\n                    <FormattedMessage defaultMessage=\"Show less\" description=\"Button to close alert description\" />\n                  ) : (\n                    <FormattedMessage defaultMessage=\"Show more\" description=\"Button to expand alert description\" />\n                  )}\n                </Button>\n              )\n            }\n            closable={false}\n            componentId=\"mlflow.evaluations_review.evaluation_error_alert\"\n            message={hasErrorCode ? `${evaluationResult.errorCode}` : 'UNKNOWN_ERROR'}\n            description={alertExpanded && `${evaluationResult.errorMessage}`}\n            type=\"error\"\n          />\n          <Spacer size=\"md\" />\n        </>\n      ) : null}\n      <EvaluationsReviewHeaderSection\n        experimentId={experimentId}\n        runDisplayName={runDisplayName}\n        otherRunDisplayName={compareToRunDisplayName}\n        evaluationResult={evaluationResult}\n        otherEvaluationResult={otherEvaluationResult}\n        exportToEvalsInstanceEnabled={exportToEvalsInstanceEnabled}\n        traceQueryResult={traceQueryResult}\n        compareToTraceQueryResult={compareToTraceQueryResult}\n      />\n      <EvaluationsReviewAssessmentsSection\n        evaluationResult={draftEvaluationResult}\n        otherEvaluationResult={otherEvaluationResult}\n        onUpsertAssessment={upsertAssessment}\n        onClickNext={onClickNext}\n        onSavePendingAssessments={async () => {\n          // Save and reset the pending assessments\n          await onSavePendingAssessments?.(evaluationResult, pendingAssessments);\n          resetPendingAssessments();\n        }}\n        isNextAvailable={isNextAvailable}\n        overridingExistingReview={overridingExistingReview}\n        setOverridingExistingReview={setOverridingExistingReview}\n        pendingAssessments={pendingAssessments}\n        onResetPendingAssessments={resetPendingAssessments}\n        isReadOnly={isReadOnly}\n        assessmentInfos={assessmentInfos}\n      />\n      <EvaluationsReviewInputSection\n        evaluationResult={evaluationResult}\n        otherEvaluationResult={otherEvaluationResult}\n      />\n      <EvaluationsReviewResponseSection\n        evaluationResult={evaluationResult}\n        otherEvaluationResult={otherEvaluationResult}\n      />\n      <EvaluationsReviewRetrievalSection\n        evaluationResult={draftEvaluationResult}\n        otherEvaluationResult={otherEvaluationResult}\n        onUpsertAssessment={upsertAssessment}\n        overridingExistingReview={overridingExistingReview}\n        isReadOnly={isReadOnly}\n        assessmentInfos={assessmentInfos}\n        traceQueryResult={traceQueryResult}\n        compareToTraceQueryResult={compareToTraceQueryResult}\n      />\n      <Spacer size=\"lg\" />\n    </>\n  );\n};\n","import { flatMap, groupBy, orderBy, uniq } from 'lodash';\nimport { useCallback, useMemo, useReducer } from 'react';\n\nimport {\n  KnownEvaluationResultAssessmentMetadataFields,\n  getEvaluationResultAssessmentChunkIndex,\n  getEvaluationResultAssessmentValue,\n  isEvaluationResultOverallAssessment,\n  isEvaluationResultPerRetrievalChunkAssessment,\n} from '../components/GenAiEvaluationTracesReview.utils';\nimport type { RunEvaluationResultAssessmentDraft, RunEvaluationTracesDataEntry } from '../types';\n\nexport const usePendingAssessmentEntries = (evaluationResult: RunEvaluationTracesDataEntry) => {\n  const [pendingAssessments, dispatch] = useReducer(\n    (\n      state: RunEvaluationResultAssessmentDraft[],\n      action:\n        | {\n            type: 'upsertAssessment';\n            payload: RunEvaluationResultAssessmentDraft;\n          }\n        | {\n            type: 'resetPendingAssessments';\n          },\n    ): RunEvaluationResultAssessmentDraft[] => {\n      switch (action.type) {\n        case 'resetPendingAssessments':\n          return [];\n        case 'upsertAssessment':\n          const existingPendingAssessment = state.find(\n            (assessment) =>\n              assessment.name === action.payload.name &&\n              getEvaluationResultAssessmentChunkIndex(assessment) ===\n                getEvaluationResultAssessmentChunkIndex(action.payload),\n          );\n\n          // If the incoming assessment is already in the pending list, update it.\n          if (existingPendingAssessment) {\n            return state.map((assessment) => {\n              if (assessment === existingPendingAssessment) {\n                // Special case: handling existing assessment without value. The value of the incoming assessment\n                // will be used to update the name of the assessment.\n                if (getEvaluationResultAssessmentValue(assessment) === '' && action.payload.stringValue) {\n                  return { ...action.payload, stringValue: '', name: action.payload.stringValue };\n                }\n                return action.payload;\n              }\n              return assessment;\n            });\n          }\n          return [action.payload, ...state];\n      }\n    },\n    [],\n  );\n\n  const overallAssessmentList = useMemo(() => {\n    if (!evaluationResult) {\n      return [];\n    }\n    const pendingOverallAssessment = pendingAssessments.find(isEvaluationResultOverallAssessment);\n    if (pendingOverallAssessment) {\n      return [pendingOverallAssessment, ...evaluationResult.overallAssessments];\n    }\n    return evaluationResult.overallAssessments;\n  }, [evaluationResult, pendingAssessments]);\n\n  const responseAssessmentMap = useMemo(() => {\n    if (!evaluationResult) {\n      return {};\n    }\n\n    const allAssessmentNames = uniq([\n      ...Object.keys(evaluationResult.responseAssessmentsByName),\n      ...pendingAssessments\n        .filter(\n          (assessment) =>\n            !isEvaluationResultOverallAssessment(assessment) &&\n            !isEvaluationResultPerRetrievalChunkAssessment(assessment),\n        )\n        .map((assessment) => assessment.name),\n    ]);\n\n    return Object.fromEntries(\n      allAssessmentNames.map((key) => {\n        const pendingAssessmentForType = pendingAssessments.filter((assessment) => assessment.name === key);\n        return [key, [...pendingAssessmentForType, ...(evaluationResult.responseAssessmentsByName[key] || [])]];\n      }),\n    );\n  }, [evaluationResult, pendingAssessments]);\n\n  const retrievalChunksWithDraftAssessments = useMemo(() => {\n    const perChunkAssessments = pendingAssessments.filter(isEvaluationResultPerRetrievalChunkAssessment);\n    return evaluationResult.retrievalChunks?.map((chunk, index) => {\n      const pendingAssessmentForChunk = perChunkAssessments.filter(\n        (assessment) => assessment.metadata?.[KnownEvaluationResultAssessmentMetadataFields.CHUNK_INDEX] === index,\n      );\n      const existingAssessments = flatMap(chunk.retrievalAssessmentsByName ?? {});\n      // Group detailed assessments by name\n      const retrievalAssessmentsByName = groupBy([...pendingAssessmentForChunk, ...existingAssessments], 'name');\n      // Ensure each group is sorted by timestamp in descending order\n      Object.keys(retrievalAssessmentsByName).forEach((key) => {\n        retrievalAssessmentsByName[key] = orderBy(retrievalAssessmentsByName[key], 'timestamp', 'desc');\n      });\n      return {\n        ...chunk,\n        retrievalAssessmentsByName: retrievalAssessmentsByName,\n      };\n    });\n  }, [pendingAssessments, evaluationResult]);\n\n  const draftEvaluationResult = useMemo(() => {\n    return {\n      ...evaluationResult,\n      overallAssessments: overallAssessmentList,\n      responseAssessmentsByName: responseAssessmentMap,\n      retrievalChunks: retrievalChunksWithDraftAssessments,\n    };\n  }, [evaluationResult, overallAssessmentList, responseAssessmentMap, retrievalChunksWithDraftAssessments]);\n\n  const upsertAssessment = useCallback(\n    (assessment: RunEvaluationResultAssessmentDraft) => dispatch({ type: 'upsertAssessment', payload: assessment }),\n    [],\n  );\n\n  const resetPendingAssessments = useCallback(() => dispatch({ type: 'resetPendingAssessments' }), []);\n\n  return {\n    pendingAssessments,\n    draftEvaluationResult,\n    upsertAssessment,\n    resetPendingAssessments,\n  };\n};\n","import { useCallback, useEffect, useRef } from 'react';\n\nimport { Spinner, useDesignSystemTheme } from '@databricks/design-system';\nimport type { ModelTrace } from '@databricks/web-shared/model-trace-explorer';\nimport type { UseQueryResult } from '@databricks/web-shared/query-client';\n\nimport { EvaluationsReviewDetails } from './EvaluationsReviewDetails';\nimport {\n  copyAiOverallAssessmentAsHumanAssessment,\n  shouldRepeatExistingOriginalOverallAiAssessment,\n} from './GenAiEvaluationTracesReview.utils';\nimport type { AssessmentInfo, RunEvaluationTracesDataEntry, SaveAssessmentsQuery } from '../types';\nimport { RUN_EVALUATIONS_SINGLE_ITEM_REVIEW_UI_PAGE_ID } from '../utils/EvaluationLogging';\n\nexport const GenAiEvaluationTracesReview = ({\n  experimentId,\n  evaluation,\n  otherEvaluation,\n  className,\n  runUuid,\n  isReadOnly = false,\n  selectNextEval,\n  isNextAvailable,\n  runDisplayName,\n  compareToRunDisplayName,\n  exportToEvalsInstanceEnabled = false,\n  assessmentInfos,\n  traceQueryResult,\n  compareToTraceQueryResult,\n  saveAssessmentsQuery,\n}: {\n  experimentId: string;\n  evaluation: RunEvaluationTracesDataEntry;\n  otherEvaluation?: RunEvaluationTracesDataEntry;\n  className?: string;\n  runUuid?: string;\n  isReadOnly?: boolean;\n  selectNextEval: () => void;\n  isNextAvailable: boolean;\n  runDisplayName?: string;\n  compareToRunDisplayName?: string;\n  exportToEvalsInstanceEnabled?: boolean;\n  assessmentInfos: AssessmentInfo[];\n  traceQueryResult: UseQueryResult<ModelTrace | undefined, unknown>;\n  compareToTraceQueryResult: UseQueryResult<ModelTrace | undefined, unknown>;\n  saveAssessmentsQuery?: SaveAssessmentsQuery;\n}) => {\n  const { theme } = useDesignSystemTheme();\n\n  const handleSavePendingAssessments = useCallback(\n    async (evaluation, pendingAssessments) => {\n      if (!evaluation || isReadOnly || !runUuid || !saveAssessmentsQuery) {\n        return;\n      }\n\n      // Prepare the list of assessments to be sent to the backend.\n      const assessmentsToSave = pendingAssessments.slice();\n\n      // Even if user did not provide any explicit overall assessment, we still should be able to mark the evaluation as reviewed.\n      // We check if there are no user provided overall assessments and if the last overall assessment was AI generated.\n      const shouldRepeatOverallAiAssessment = shouldRepeatExistingOriginalOverallAiAssessment(\n        evaluation,\n        pendingAssessments,\n      );\n\n      // If we should repeat the AI generated overall assessment, we need to copy and add it to the list of assessments to save.\n      if (shouldRepeatOverallAiAssessment) {\n        const repeatedOverallAssessment = copyAiOverallAssessmentAsHumanAssessment(evaluation);\n\n        repeatedOverallAssessment && assessmentsToSave.unshift(repeatedOverallAssessment);\n      }\n\n      return saveAssessmentsQuery.savePendingAssessments(runUuid, evaluation.evaluationId, assessmentsToSave);\n    },\n    [runUuid, isReadOnly, saveAssessmentsQuery],\n  );\n\n  // Scroll right side panel to the top when switching between evaluations\n  const reviewDetailsRef = useRef<HTMLDivElement>(null);\n  useEffect(() => {\n    reviewDetailsRef.current?.scrollTo(0, 0);\n  }, [evaluation.evaluationId]);\n\n  return (\n    <div\n      // comment for copybara formatting\n      css={{ display: 'flex', position: 'relative', overflow: 'scroll' }}\n      className={className}\n    >\n      <div\n        css={{\n          flex: 1,\n          overflow: 'auto',\n        }}\n        ref={reviewDetailsRef}\n      >\n        <EvaluationsReviewDetails\n          experimentId={experimentId}\n          key={evaluation.evaluationId}\n          evaluationResult={evaluation}\n          otherEvaluationResult={otherEvaluation}\n          onSavePendingAssessments={handleSavePendingAssessments}\n          onClickNext={selectNextEval}\n          isNextAvailable={isNextAvailable}\n          isReadOnly={isReadOnly || !runUuid}\n          runDisplayName={runDisplayName}\n          compareToRunDisplayName={compareToRunDisplayName}\n          exportToEvalsInstanceEnabled={exportToEvalsInstanceEnabled}\n          assessmentInfos={assessmentInfos}\n          traceQueryResult={traceQueryResult}\n          compareToTraceQueryResult={compareToTraceQueryResult}\n        />\n      </div>\n      {saveAssessmentsQuery?.isSaving && (\n        <div\n          css={{\n            inset: 0,\n            position: 'absolute',\n            backgroundColor: theme.colors.overlayOverlay,\n            display: 'flex',\n            justifyContent: 'center',\n            alignItems: 'center',\n            zIndex: theme.options.zIndexBase + 1,\n          }}\n        >\n          <Spinner size=\"large\" inheritColor css={{ color: theme.colors.backgroundPrimary }} />\n        </div>\n      )}\n    </div>\n  );\n};\n","import { merge } from 'lodash';\nimport type { ReactNode } from 'react';\nimport React, { createContext, useContext } from 'react';\n\nimport { shouldEnableRunEvaluationReviewUIWriteFeatures } from '../utils/FeatureUtils';\n\nexport interface GenAITracesTableConfig {\n  enableRunEvaluationWriteFeatures: NonNullable<boolean | undefined>;\n}\n\n// Define a default configuration\nconst getDefaultConfig = (): GenAITracesTableConfig => ({\n  enableRunEvaluationWriteFeatures: shouldEnableRunEvaluationReviewUIWriteFeatures() ?? false,\n});\n\n// Create the context with a default value\nconst GenAITracesTableConfigContext = createContext<GenAITracesTableConfig>(getDefaultConfig());\n\ninterface GenAITracesTableConfigProviderProps {\n  config?: Partial<GenAITracesTableConfig>;\n  children: ReactNode;\n}\n\nexport const GenAITracesTableConfigProvider: React.FC<React.PropsWithChildren<GenAITracesTableConfigProviderProps>> = ({\n  config = {},\n  children,\n}) => {\n  const defaultConfig = getDefaultConfig();\n  // Remove undefined values from the config object\n\n  const mergedConfig: GenAITracesTableConfig = merge({}, defaultConfig, config);\n\n  return (\n    <GenAITracesTableConfigContext.Provider value={mergedConfig}>{children}</GenAITracesTableConfigContext.Provider>\n  );\n};\n\nexport const useGenAITracesTableConfig = (): GenAITracesTableConfig => {\n  const context = useContext(GenAITracesTableConfigContext);\n\n  if (!context) {\n    return getDefaultConfig(); // Fallback to defaults if no provider is found\n  }\n\n  return context;\n};\n","import { isNil } from 'lodash';\n\nimport type { ModelTrace } from '@databricks/web-shared/model-trace-explorer';\nimport { useQuery } from '@databricks/web-shared/query-client';\n\nexport function useGetTrace(\n  getTrace: ((traceId: string) => Promise<ModelTrace | undefined>) | undefined,\n  traceId?: string,\n) {\n  return useQuery({\n    queryKey: ['getTrace', traceId],\n    queryFn: () => (getTrace && traceId ? getTrace(traceId) : Promise.resolve(undefined)),\n    enabled: !isNil(getTrace) && !isNil(traceId),\n    staleTime: Infinity, // Keep data fresh as long as the component is mounted\n    refetchOnWindowFocus: false, // Disable refetching on window focus\n    retry: 1,\n    keepPreviousData: true,\n  });\n}\n","import { isNil } from 'lodash';\nimport React, { useCallback, useMemo } from 'react';\n\nimport {\n  Button,\n  ChevronLeftIcon,\n  ChevronRightIcon,\n  GenericSkeleton,\n  Modal,\n  useDesignSystemTheme,\n} from '@databricks/design-system';\nimport { ModelTraceExplorer, type ModelTrace } from '@databricks/web-shared/model-trace-explorer';\n\nimport { EvaluationsReviewDetailsHeader } from './EvaluationsReviewDetails';\nimport { GenAiEvaluationTracesReview } from './GenAiEvaluationTracesReview';\nimport { useGenAITracesTableConfig } from '../hooks/useGenAITracesTableConfig';\nimport { useGetTrace } from '../hooks/useGetTrace';\nimport type { AssessmentInfo, EvalTraceComparisonEntry, SaveAssessmentsQuery } from '../types';\n\nconst MODAL_SPACING_REM = 4;\nconst DEFAULT_MODAL_MARGIN_REM = 1;\n\nexport const GenAiEvaluationTracesReviewModal = React.memo(\n  ({\n    experimentId,\n    runUuid,\n    evaluations,\n    selectedEvaluationId,\n    onChangeEvaluationId,\n    runDisplayName,\n    otherRunDisplayName,\n    exportToEvalsInstanceEnabled = false,\n    assessmentInfos,\n    getTrace,\n    saveAssessmentsQuery,\n  }: {\n    experimentId: string;\n    runUuid?: string;\n    evaluations: EvalTraceComparisonEntry[];\n    selectedEvaluationId: string;\n    onChangeEvaluationId: (evaluationId: string | undefined) => void;\n    runDisplayName?: string;\n    otherRunDisplayName?: string;\n    exportToEvalsInstanceEnabled?: boolean;\n    assessmentInfos: AssessmentInfo[];\n    getTrace?: (traceId?: string) => Promise<ModelTrace | undefined>;\n    saveAssessmentsQuery?: SaveAssessmentsQuery;\n  }) => {\n    const { theme, classNamePrefix } = useDesignSystemTheme();\n\n    const handleClose = useCallback(() => {\n      onChangeEvaluationId(undefined);\n    }, [onChangeEvaluationId]);\n\n    // The URL always has an evaluation id, so we look in either current or other for the eval.\n    const findEval = useCallback(\n      (entry: EvalTraceComparisonEntry) =>\n        entry.currentRunValue?.evaluationId === selectedEvaluationId ||\n        entry.otherRunValue?.evaluationId === selectedEvaluationId,\n      [selectedEvaluationId],\n    );\n\n    const previousEvaluationIdx = useMemo(\n      () => (evaluations ? evaluations?.findIndex(findEval) - 1 : undefined),\n      [evaluations, findEval],\n    );\n    const isPreviousAvailable = useMemo(\n      () => previousEvaluationIdx !== undefined && previousEvaluationIdx >= 0,\n      [previousEvaluationIdx],\n    );\n\n    const nextEvaluationIdx = useMemo(\n      () => (evaluations ? evaluations?.findIndex(findEval) + 1 : undefined),\n      [evaluations, findEval],\n    );\n    const isNextAvailable = useMemo(\n      () => nextEvaluationIdx !== undefined && nextEvaluationIdx < evaluations.length,\n      [nextEvaluationIdx, evaluations],\n    );\n\n    const selectPreviousEval = useCallback(() => {\n      if (evaluations === null || previousEvaluationIdx === undefined) return;\n\n      const newEvalId =\n        evaluations[previousEvaluationIdx]?.currentRunValue?.evaluationId ||\n        evaluations[previousEvaluationIdx]?.otherRunValue?.evaluationId;\n      onChangeEvaluationId(newEvalId);\n    }, [evaluations, previousEvaluationIdx, onChangeEvaluationId]);\n\n    const selectNextEval = useCallback(() => {\n      if (evaluations === null || nextEvaluationIdx === undefined) return;\n\n      const newEvalId =\n        evaluations[nextEvaluationIdx]?.currentRunValue?.evaluationId ||\n        evaluations[nextEvaluationIdx]?.otherRunValue?.evaluationId;\n      onChangeEvaluationId(newEvalId);\n    }, [evaluations, nextEvaluationIdx, onChangeEvaluationId]);\n\n    const evaluation = useMemo(() => evaluations?.find(findEval), [evaluations, findEval]);\n    const nextEvaluation = useMemo(\n      () => (nextEvaluationIdx && evaluations ? evaluations?.[nextEvaluationIdx] : undefined),\n      [evaluations, nextEvaluationIdx],\n    );\n    const previousEvaluation = useMemo(\n      () => (previousEvaluationIdx && evaluations ? evaluations?.[previousEvaluationIdx] : undefined),\n      [evaluations, previousEvaluationIdx],\n    );\n\n    const tracesTableConfig = useGenAITracesTableConfig();\n\n    const traceQueryResult = useGetTrace(getTrace, evaluation?.currentRunValue?.traceInfo?.trace_id);\n    const compareToTraceQueryResult = useGetTrace(getTrace, evaluation?.otherRunValue?.traceInfo?.trace_id);\n\n    // Prefetching the next and previous traces to optimize performance\n    useGetTrace(getTrace, nextEvaluation?.currentRunValue?.traceInfo?.trace_id);\n    useGetTrace(getTrace, previousEvaluation?.currentRunValue?.traceInfo?.trace_id);\n\n    // is true if only one of the two runs has a trace\n    const isSingleTraceView = Boolean(evaluation?.currentRunValue) !== Boolean(evaluation?.otherRunValue);\n\n    const currentTraceQueryResult =\n      selectedEvaluationId === evaluation?.currentRunValue?.evaluationId ? traceQueryResult : compareToTraceQueryResult;\n\n    if (isNil(evaluation)) {\n      return <></>;\n    }\n\n    return (\n      <div\n        onKeyDown={(e) => {\n          if (e.key === 'ArrowLeft') {\n            selectPreviousEval();\n          } else if (e.key === 'ArrowRight') {\n            selectNextEval();\n          }\n        }}\n      >\n        <Modal\n          componentId=\"mlflow.evaluations_review.modal\"\n          visible\n          title={\n            evaluation.currentRunValue ? (\n              <EvaluationsReviewDetailsHeader evaluationResult={evaluation.currentRunValue} />\n            ) : evaluation.otherRunValue ? (\n              <EvaluationsReviewDetailsHeader evaluationResult={evaluation.otherRunValue} />\n            ) : null\n          }\n          onCancel={handleClose}\n          size=\"wide\"\n          verticalSizing=\"maxed_out\"\n          css={{\n            width: '100% !important',\n            padding: `0 ${MODAL_SPACING_REM}rem !important`,\n            [`& .${classNamePrefix}-modal-body`]: {\n              flex: 1,\n              paddingTop: 0,\n            },\n            [`& .${classNamePrefix}-modal-header`]: {\n              paddingBottom: theme.spacing.sm,\n            },\n          }}\n          footer={null} // Hide the footer\n        >\n          {currentTraceQueryResult.isFetching && (\n            <GenericSkeleton\n              label=\"Loading trace...\"\n              style={{\n                // Size the width and height to fit the modal content area\n                width: 'calc(100% - 45px)',\n                height: 'calc(100% - 100px)',\n                position: 'absolute',\n                paddingRight: 500,\n                zIndex: 2100,\n                backgroundColor: theme.colors.backgroundPrimary,\n              }}\n            />\n          )}\n          {\n            // Show ModelTraceExplorer only if there is no run to compare to and there's trace data.\n            isSingleTraceView && !isNil(currentTraceQueryResult.data) ? (\n              <div css={{ height: '100%', marginLeft: -theme.spacing.lg, marginRight: -theme.spacing.lg }}>\n                <ModelTraceExplorerModalBody traceData={currentTraceQueryResult.data} />\n              </div>\n            ) : (\n              evaluation.currentRunValue && (\n                <GenAiEvaluationTracesReview\n                  experimentId={experimentId}\n                  evaluation={evaluation.currentRunValue}\n                  otherEvaluation={evaluation.otherRunValue}\n                  selectNextEval={selectNextEval}\n                  isNextAvailable={isNextAvailable}\n                  css={{ flex: 1, overflow: 'hidden' }}\n                  runUuid={runUuid}\n                  isReadOnly={!tracesTableConfig.enableRunEvaluationWriteFeatures}\n                  runDisplayName={runDisplayName}\n                  compareToRunDisplayName={otherRunDisplayName}\n                  exportToEvalsInstanceEnabled={exportToEvalsInstanceEnabled}\n                  assessmentInfos={assessmentInfos}\n                  traceQueryResult={traceQueryResult}\n                  compareToTraceQueryResult={compareToTraceQueryResult}\n                  saveAssessmentsQuery={saveAssessmentsQuery}\n                />\n              )\n            )\n          }\n        </Modal>\n        <div\n          css={{\n            display: 'flex',\n            justifyContent: 'flex-end',\n            position: 'fixed',\n            top: '50%',\n            left: 0,\n            zIndex: 2000,\n            opacity: '.75',\n            width: `${MODAL_SPACING_REM + DEFAULT_MODAL_MARGIN_REM}rem`,\n            '&:hover': {\n              opacity: '1.0',\n            },\n          }}\n        >\n          <div\n            css={{\n              backgroundColor: theme.colors.backgroundPrimary,\n              borderRadius: theme.legacyBorders.borderRadiusMd,\n              marginRight: theme.spacing.sm,\n            }}\n          >\n            <Button\n              disabled={!isPreviousAvailable}\n              componentId=\"mlflow.evaluations_review.modal.previous_eval\"\n              icon={<ChevronLeftIcon />}\n              onClick={() => selectPreviousEval()}\n            />\n          </div>\n        </div>\n        <div\n          css={{\n            display: 'flex',\n            justifyContent: 'flex-start',\n            position: 'fixed',\n            top: '50%',\n            right: 0,\n            zIndex: 2000,\n            width: `${MODAL_SPACING_REM + DEFAULT_MODAL_MARGIN_REM}rem`,\n            opacity: '.75',\n            '&:hover': {\n              opacity: '1.0',\n            },\n          }}\n        >\n          <div\n            css={{\n              backgroundColor: theme.colors.backgroundPrimary,\n              borderRadius: theme.legacyBorders.borderRadiusMd,\n              marginLeft: theme.spacing.sm,\n            }}\n          >\n            <Button\n              disabled={!isNextAvailable}\n              componentId=\"mlflow.evaluations_review.modal.next_eval\"\n              icon={<ChevronRightIcon />}\n              onClick={() => selectNextEval()}\n            />\n          </div>\n        </div>\n      </div>\n    );\n  },\n);\n\nconst ModelTraceExplorerModalBody = ({ traceData }: { traceData: ModelTrace }) => {\n  return <ModelTraceExplorer modelTrace={traceData} />;\n};\n","import { getCoreRowModel, getSortedRowModel, useReactTable } from '@tanstack/react-table';\nimport type { RowSelectionState, OnChangeFn, ColumnDef, Row } from '@tanstack/react-table';\nimport { useVirtualizer } from '@tanstack/react-virtual';\nimport { isNil } from 'lodash';\nimport React, { useEffect, useMemo, useState } from 'react';\n\nimport { Empty, SearchIcon, Table, useDesignSystemTheme } from '@databricks/design-system';\nimport { useIntl } from '@databricks/i18n';\nimport type { ModelTrace, ModelTraceInfo } from '@databricks/web-shared/model-trace-explorer';\n\nimport { GenAITracesTableContext } from './GenAITracesTableContext';\nimport { sortColumns, sortGroupedColumns } from './GenAiTracesTable.utils';\nimport { getColumnConfig } from './GenAiTracesTableBody.utils';\nimport { MemoizedGenAiTracesTableBodyRows } from './GenAiTracesTableBodyRows';\nimport { GenAiTracesTableHeader } from './GenAiTracesTableHeader';\nimport { HeaderCellRenderer } from './cellRenderers/HeaderCellRenderer';\nimport { GenAiEvaluationTracesReviewModal } from './components/GenAiEvaluationTracesReviewModal';\nimport { REQUEST_TIME_COLUMN_ID, SESSION_COLUMN_ID, SERVER_SORTABLE_INFO_COLUMNS } from './hooks/useTableColumns';\nimport {\n  type EvaluationsOverviewTableSort,\n  TracesTableColumnType,\n  type AssessmentAggregates,\n  type AssessmentFilter,\n  type AssessmentInfo,\n  type AssessmentValueType,\n  type EvalTraceComparisonEntry,\n  type SaveAssessmentsQuery,\n  type TracesTableColumn,\n  TracesTableColumnGroup,\n} from './types';\nimport { getAssessmentAggregates } from './utils/AggregationUtils';\nimport { escapeCssSpecialCharacters } from './utils/DisplayUtils';\nimport { getRowIdFromEvaluation } from './utils/TraceUtils';\n\nexport const GenAiTracesTableBody = React.memo(\n  ({\n    experimentId,\n    selectedColumns,\n    evaluations,\n    selectedEvaluationId,\n    selectedAssessmentInfos,\n    assessmentInfos,\n    assessmentFilters,\n    tableSort,\n    onChangeEvaluationId,\n    getRunColor,\n    runUuid,\n    runDisplayName,\n    compareToRunUuid,\n    compareToRunDisplayName,\n    rowSelection,\n    setRowSelection,\n    exportToEvalsInstanceEnabled = false,\n    getTrace,\n    toggleAssessmentFilter,\n    saveAssessmentsQuery,\n    disableAssessmentTooltips,\n    onTraceTagsEdit,\n    enableRowSelection,\n    enableGrouping = false,\n    allColumns,\n  }: {\n    experimentId: string;\n    selectedColumns: TracesTableColumn[];\n    evaluations: EvalTraceComparisonEntry[];\n    selectedEvaluationId: string | undefined;\n    selectedAssessmentInfos: AssessmentInfo[];\n    assessmentInfos: AssessmentInfo[];\n    assessmentFilters: AssessmentFilter[];\n    tableSort: EvaluationsOverviewTableSort | undefined;\n    onChangeEvaluationId: (evaluationId: string | undefined) => void;\n    getRunColor?: (runUuid: string) => string;\n    // Current run\n    runUuid?: string;\n    runDisplayName?: string;\n    // Other run\n    compareToRunUuid?: string;\n    compareToRunDisplayName?: string;\n    rowSelection?: RowSelectionState;\n    setRowSelection?: OnChangeFn<RowSelectionState>;\n    exportToEvalsInstanceEnabled?: boolean;\n    getTrace?: (traceId?: string) => Promise<ModelTrace | undefined>;\n    toggleAssessmentFilter: (\n      assessmentName: string,\n      filterValue: AssessmentValueType,\n      run: string,\n      filterType?: AssessmentFilter['filterType'],\n    ) => void;\n    saveAssessmentsQuery?: SaveAssessmentsQuery;\n    disableAssessmentTooltips?: boolean;\n    onTraceTagsEdit?: (trace: ModelTraceInfo) => void;\n    enableRowSelection?: boolean;\n    enableGrouping?: boolean;\n    allColumns: TracesTableColumn[];\n  }) => {\n    const intl = useIntl();\n    const { theme } = useDesignSystemTheme();\n    const [collapsedHeader, setCollapsedHeader] = useState(false);\n\n    const isComparing = !isNil(compareToRunUuid);\n\n    const evaluationInputs = selectedColumns.filter((col) => col.type === TracesTableColumnType.INPUT);\n\n    const { columns } = useMemo(() => {\n      if (!enableGrouping) {\n        // Return flat columns without grouping\n        const columnsList = selectedColumns.map((col) =>\n          getColumnConfig(col, {\n            evaluationInputs,\n            isComparing,\n            theme,\n            intl,\n            experimentId,\n            onChangeEvaluationId,\n            onTraceTagsEdit,\n          }),\n        );\n\n        return { columns: sortColumns(columnsList, selectedColumns) };\n      }\n\n      // Create a map of group IDs to their column arrays\n      const groupColumns = new Map<TracesTableColumnGroup, ColumnDef<EvalTraceComparisonEntry>[]>();\n      const sortedGroupedColumns = sortGroupedColumns(selectedColumns, isComparing);\n\n      sortedGroupedColumns.forEach((col) => {\n        // Get the group for this column, defaulting to 'Info' if not specified\n        const groupId = col.group || TracesTableColumnGroup.INFO;\n\n        // Initialize the group's columns array if it doesn't exist\n        if (!groupColumns.has(groupId)) {\n          groupColumns.set(groupId, []);\n        }\n\n        // or branch of this should never get hit\n        (groupColumns.get(groupId) || []).push(\n          getColumnConfig(col, {\n            evaluationInputs,\n            isComparing,\n            theme,\n            intl,\n            experimentId,\n            onChangeEvaluationId,\n            onTraceTagsEdit,\n          }),\n        );\n      });\n\n      // Convert the map to an array of column groups and sort columns within each group\n      const topLevelColumns: ColumnDef<EvalTraceComparisonEntry>[] = Array.from(groupColumns.entries()).map(\n        ([groupId, columns]) => ({\n          header: HeaderCellRenderer,\n          meta: {\n            groupId,\n            visibleCount: columns.length,\n            totalCount: allColumns.filter((col) => col.group === groupId).length,\n            enableGrouping,\n          },\n          id: `${groupId}-group`,\n          columns,\n        }),\n      );\n\n      return { columns: topLevelColumns };\n    }, [\n      selectedColumns,\n      evaluationInputs,\n      isComparing,\n      onChangeEvaluationId,\n      theme,\n      intl,\n      experimentId,\n      onTraceTagsEdit,\n      enableGrouping,\n      allColumns,\n    ]);\n\n    const { setTable, setSelectedRowIds } = React.useContext(GenAITracesTableContext);\n\n    const table = useReactTable<EvalTraceComparisonEntry & { multiline?: boolean }>({\n      data: evaluations,\n      columns,\n      getCoreRowModel: getCoreRowModel(),\n      getSortedRowModel: getSortedRowModel(),\n      enableColumnResizing: true,\n      columnResizeMode: 'onChange',\n      enableRowSelection,\n      enableMultiSort: true,\n      state: {\n        rowSelection,\n      },\n      meta: {\n        getRunColor,\n      },\n      onRowSelectionChange: setRowSelection,\n      getRowId: (row) => getRowIdFromEvaluation(row.currentRunValue),\n    });\n\n    // Need to check if rowSelection is undefined, otherwise getIsAllRowsSelected throws an error\n    const allRowSelected = rowSelection !== undefined && table.getIsAllRowsSelected();\n    const someRowSelected = table.getIsSomeRowsSelected();\n\n    useEffect(() => {\n      setTable(table);\n\n      return () => setTable(undefined);\n    }, [table, setTable]);\n\n    useEffect(() => {\n      if (enableRowSelection) {\n        setSelectedRowIds(table.getSelectedRowModel().rows.map((r) => r.id));\n      }\n    }, [table, rowSelection, setSelectedRowIds, enableRowSelection]);\n\n    // When the table is empty.\n    const emptyDescription = intl.formatMessage({\n      defaultMessage: ' No traces found. Try clearing your active filters to see more traces.',\n      description: 'Text displayed when no traces are found in the trace review page',\n    });\n\n    const emptyComponent = <Empty description={emptyDescription} image={<SearchIcon />} />;\n    const isEmpty = (): boolean => table.getRowModel().rows.length === 0;\n\n    // Updating sorting when the prop changes.\n    useEffect(() => {\n      // Only do client-side sorting for columns that are not supported by the server.\n      if (!tableSort || SERVER_SORTABLE_INFO_COLUMNS.includes(tableSort.key)) {\n        table.setSorting([]);\n        return;\n      }\n\n      if (tableSort.key === SESSION_COLUMN_ID) {\n        table.setSorting([\n          {\n            id: tableSort.key,\n            desc: !tableSort.asc,\n          },\n          {\n            id: REQUEST_TIME_COLUMN_ID,\n            desc: false,\n          },\n        ]);\n      } else {\n        table.setSorting([\n          {\n            id: tableSort.key,\n            desc: !tableSort.asc,\n          },\n        ]);\n      }\n    }, [tableSort, table]);\n\n    const { rows } = table.getRowModel();\n\n    // The virtualizer needs to know the scrollable container element\n    const tableContainerRef = React.useRef<HTMLDivElement>(null);\n\n    const rowVirtualizer = useVirtualizer({\n      count: rows.length,\n      estimateSize: () => 120, // estimate row height for accurate scrollbar dragging\n      getScrollElement: () => tableContainerRef.current,\n      measureElement:\n        typeof window !== 'undefined' && navigator.userAgent.indexOf('Firefox') === -1\n          ? (element) => element?.getBoundingClientRect().height\n          : undefined,\n      overscan: 10,\n    });\n\n    const virtualItems = rowVirtualizer.getVirtualItems();\n    const tableHeaderGroups = table.getHeaderGroups();\n\n    /**\n     * Instead of calling `column.getSize()` on every render for every header\n     * and especially every data cell (very expensive),\n     * we will calculate all column sizes at once at the root table level in a useMemo\n     * and pass the column sizes down as CSS variables to the <table> element.\n     */\n    const { columnSizeVars, tableWidth } = useMemo(() => {\n      const colSizes: { [key: string]: string } = {};\n      tableHeaderGroups.forEach((headerGroup) => {\n        headerGroup.headers.forEach((header) => {\n          colSizes[`--header-${escapeCssSpecialCharacters(header.column.id)}-size`] = header.getSize() + 'px';\n        });\n      });\n\n      // Calculate the total width of the table by adding up the width of all columns.\n      let tableWidth = 0;\n      if (rows.length > 0) {\n        const row = rows[0] as Row<EvalTraceComparisonEntry>;\n        const cells = row.getVisibleCells();\n        cells.forEach((cell) => {\n          colSizes[`--col-${escapeCssSpecialCharacters(cell.column.id)}-size`] = cell.column.getSize() + 'px';\n          tableWidth += cell.column.getSize();\n        });\n      }\n\n      return { columnSizeVars: colSizes, tableWidth: tableWidth + 'px' };\n    }, [tableHeaderGroups, rows]);\n\n    // Compute assessment aggregates.\n    const assessmentNameToAggregates = useMemo(() => {\n      const result: Record<string, AssessmentAggregates> = {};\n      for (const assessmentInfo of selectedAssessmentInfos) {\n        result[assessmentInfo.name] = getAssessmentAggregates(assessmentInfo, evaluations, assessmentFilters);\n      }\n      return result;\n    }, [selectedAssessmentInfos, evaluations, assessmentFilters]);\n\n    return (\n      <>\n        <div\n          className=\"container\"\n          ref={tableContainerRef}\n          css={{\n            height: '100%',\n            position: 'relative',\n            overflowY: 'auto',\n            overflowX: 'auto',\n            minWidth: '100%',\n            width: tableWidth,\n          }}\n        >\n          <Table\n            css={{\n              width: '100%',\n              ...columnSizeVars, // Define column sizes on the <table> element\n            }}\n            empty={isEmpty() ? emptyComponent : undefined}\n            someRowsSelected={enableRowSelection ? someRowSelected || allRowSelected : undefined}\n          >\n            <GenAiTracesTableHeader\n              headerGroups={table.getHeaderGroups()}\n              enableRowSelection={enableRowSelection}\n              enableGrouping={enableGrouping}\n              selectedAssessmentInfos={selectedAssessmentInfos}\n              assessmentNameToAggregates={assessmentNameToAggregates}\n              assessmentFilters={assessmentFilters}\n              toggleAssessmentFilter={toggleAssessmentFilter}\n              runDisplayName={runDisplayName}\n              compareToRunUuid={compareToRunUuid}\n              compareToRunDisplayName={compareToRunDisplayName}\n              disableAssessmentTooltips={disableAssessmentTooltips}\n              collapsedHeader={collapsedHeader}\n              setCollapsedHeader={setCollapsedHeader}\n              isComparing={isComparing}\n              allRowSelected={allRowSelected}\n              someRowSelected={someRowSelected}\n              toggleAllRowsSelectedHandler={table.getToggleAllRowsSelectedHandler}\n              setColumnSizing={table.setColumnSizing}\n            />\n\n            <MemoizedGenAiTracesTableBodyRows\n              rows={rows}\n              isComparing={isComparing}\n              enableRowSelection={enableRowSelection}\n              virtualItems={virtualItems}\n              virtualizerTotalSize={rowVirtualizer.getTotalSize()}\n              virtualizerMeasureElement={rowVirtualizer.measureElement}\n              rowSelectionState={rowSelection}\n              selectedColumns={selectedColumns}\n            />\n          </Table>\n        </div>\n        {selectedEvaluationId && (\n          <GenAiEvaluationTracesReviewModal\n            experimentId={experimentId}\n            runUuid={runUuid}\n            runDisplayName={runDisplayName}\n            otherRunDisplayName={compareToRunDisplayName}\n            evaluations={rows.map((row) => row.original)}\n            selectedEvaluationId={selectedEvaluationId}\n            onChangeEvaluationId={onChangeEvaluationId}\n            exportToEvalsInstanceEnabled={exportToEvalsInstanceEnabled}\n            assessmentInfos={assessmentInfos}\n            getTrace={getTrace}\n            saveAssessmentsQuery={saveAssessmentsQuery}\n          />\n        )}\n      </>\n    );\n  },\n);\n","import { useEffect, useState } from 'react';\n\nimport { TableFilterInput } from '@databricks/design-system';\nimport { useIntl } from '@databricks/i18n';\n\nconst SEARCH_QUERY_FILTER_DEBOUNCE_MS = 400;\n\nexport function GenAiTracesTableSearchInput({\n  searchQuery,\n  setSearchQuery,\n}: {\n  searchQuery: string;\n  setSearchQuery: (query: string) => void;\n}) {\n  const intl = useIntl();\n\n  const [pendingUserQuery, setPendingUserQuery] = useState(searchQuery);\n  // When the search query changes, update the pending user query.\n  useEffect(() => {\n    setPendingUserQuery(searchQuery);\n  }, [searchQuery]);\n\n  // Debounce adding the filter search query to the URL so we don't over push to the URL.\n  useEffect(() => {\n    const timeout = setTimeout(() => {\n      setSearchQuery(pendingUserQuery);\n    }, SEARCH_QUERY_FILTER_DEBOUNCE_MS);\n    return () => clearTimeout(timeout);\n  }, [pendingUserQuery, setSearchQuery]);\n\n  return (\n    <TableFilterInput\n      componentId=\"mlflow.evaluations_review.table_ui.filter_input\"\n      placeholder={intl.formatMessage({\n        defaultMessage: 'Search traces by request',\n        description: 'Placeholder text for the search input in the trace results table',\n      })}\n      value={pendingUserQuery}\n      onChange={(e) => setPendingUserQuery(e.target.value)}\n    />\n  );\n}\n","/** Constants for logging. */\n\n// Pages\nexport const RUN_EVALUATION_RESULTS_TAB_SINGLE_RUN = 'mlflow.evaluations_review.run_evaluation_results_single_run_page';\nexport const RUN_EVALUATION_RESULTS_TAB_COMPARE_RUNS =\n  'mlflow.evaluations_review.run_evaluation_results_compare_runs_page';\n\n// When a user opens a single item in the evaluations table, the page ID for the evaluations review page modal.\nexport const RUN_EVALUATIONS_SINGLE_ITEM_REVIEW_UI_PAGE_ID = 'mlflow.evaluations_review.review_ui';\n\n// Views\n// Counts the number of times the expanded assessment details is clicked, showing how many times users view rationales.\nexport const EXPANDED_ASSESSMENT_DETAILS_VIEW: Record<string, string> = {\n  // Important note: Overall is always expanded.\n  overall: 'mlflow.evaluations_review.expanded_overall_assessment_details_view',\n  response: 'mlflow.evaluations_review.expanded_response_assessment_details_view',\n  retrieval: 'mlflow.evaluations_review.expanded_retrieval_assessment_details_view',\n};\n\nexport const ASSESSMENT_RATIONAL_HOVER_DETAILS_VIEW =\n  'mlflow.evaluations_review.assessment_rationale_hover_details_view';\n\n// Buttons\n// The component ID for the compare-to-run dropdown in the evaluations table.\nexport const COMPARE_TO_RUN_DROPDOWN_COMPONENT_ID = 'mlflow.evaluations_review.table_ui.compare_to_run_combobox';\n\n// The component ID for the filter dropdown in the evaluations table.\nexport const FILTER_DROPDOWN_COMPONENT_ID = 'mlflow.evaluations_review.table_ui.filter_form';\n\n// The component ID for the column selector dropdown in the evaluations table.\nexport const COLUMN_SELECTOR_DROPDOWN_COMPONENT_ID = 'mlflow.evaluations_review.table_ui.column_filter_combobox';\n","import {\n  ChevronDownIcon,\n  DialogCombobox,\n  DialogComboboxContent,\n  DialogComboboxCustomButtonTriggerWrapper,\n  DialogComboboxOptionList,\n  DialogComboboxOptionListCheckboxItem,\n  Button,\n  ColumnsIcon,\n  useDesignSystemTheme,\n} from '@databricks/design-system';\nimport { useIntl } from '@databricks/i18n';\n\nimport type { TracesTableColumn } from '../types';\nimport { COLUMN_SELECTOR_DROPDOWN_COMPONENT_ID } from '../utils/EvaluationLogging';\n\n/**\n * Component for column selector in MLflow monitoring traces view. Allows user to control which assessments show up in table to prevent too much clutter.\n */\nexport const EvaluationsOverviewColumnSelector = ({\n  columns,\n  selectedColumns,\n  setSelectedColumns,\n  setSelectedColumnsWithHiddenColumns,\n}: {\n  columns: TracesTableColumn[];\n  selectedColumns: TracesTableColumn[];\n  // @deprecated use setSelectedColumnsWithHiddenColumns instead\n  setSelectedColumns?: React.Dispatch<React.SetStateAction<TracesTableColumn[]>>;\n  setSelectedColumnsWithHiddenColumns?: (newColumns: TracesTableColumn[]) => void;\n}) => {\n  const intl = useIntl();\n  const { theme } = useDesignSystemTheme();\n\n  const handleChange = (newColumn: TracesTableColumn) => {\n    if (setSelectedColumnsWithHiddenColumns) {\n      return setSelectedColumnsWithHiddenColumns([newColumn]);\n    } else if (setSelectedColumns) {\n      setSelectedColumns((current: TracesTableColumn[]) => {\n        const newSelectedColumns = current.some((col) => col.id === newColumn.id)\n          ? current.filter((col) => col.id !== newColumn.id)\n          : [...current, newColumn];\n        return newSelectedColumns;\n      });\n    }\n  };\n\n  return (\n    <DialogCombobox componentId={COLUMN_SELECTOR_DROPDOWN_COMPONENT_ID} label=\"Columns\" multiSelect>\n      <DialogComboboxCustomButtonTriggerWrapper>\n        <Button endIcon={<ChevronDownIcon />} componentId=\"mlflow.evaluations_review.table_ui.filter_button\">\n          <div\n            css={{\n              display: 'flex',\n              gap: theme.spacing.sm,\n              alignItems: 'center',\n            }}\n          >\n            <ColumnsIcon />\n            {intl.formatMessage({\n              defaultMessage: 'Columns',\n              description: 'Evaluation review > evaluations list > filter dropdown button',\n            })}\n          </div>\n        </Button>\n      </DialogComboboxCustomButtonTriggerWrapper>\n      <DialogComboboxContent>\n        <DialogComboboxOptionList>\n          {columns.map((column) => (\n            <DialogComboboxOptionListCheckboxItem\n              key={column.id}\n              value={column.label}\n              checked={selectedColumns.some((col) => col.id === column.id)}\n              onChange={() => handleChange(column)}\n            />\n          ))}\n        </DialogComboboxOptionList>\n      </DialogComboboxContent>\n    </DialogCombobox>\n  );\n};\n","import React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\n\nimport {\n  ArrowDownIcon,\n  ArrowUpIcon,\n  SortAscendingIcon,\n  SortDescendingIcon,\n  Input,\n  SearchIcon,\n  useDesignSystemTheme,\n  DropdownMenu,\n  Button,\n  ChevronDownIcon,\n  SortUnsortedIcon,\n  ToggleButton,\n  Spinner,\n  DangerIcon,\n} from '@databricks/design-system';\nimport { FormattedMessage, useIntl } from '@databricks/i18n';\n\nimport { sortGroupedColumns } from '../GenAiTracesTable.utils';\nimport { SESSION_COLUMN_ID, SORTABLE_INFO_COLUMNS } from '../hooks/useTableColumns';\nimport type { EvaluationsOverviewTableSort, AssessmentInfo, TracesTableColumn } from '../types';\nimport { TracesTableColumnType, TracesTableColumnGroup, TracesTableColumnGroupToLabelMap } from '../types';\n\nexport interface SortOption {\n  label: string;\n  key: string;\n  type: TracesTableColumnType;\n  group?: TracesTableColumnGroup;\n}\n\nexport const EvaluationsOverviewSortDropdown = React.memo(\n  ({\n    tableSort,\n    columns = [],\n    onChange,\n    enableGrouping,\n    isMetadataLoading,\n    metadataError,\n  }: {\n    tableSort: EvaluationsOverviewTableSort | undefined;\n    columns: TracesTableColumn[];\n    onChange: (sortOption: SortOption, orderByAsc: boolean) => void;\n    enableGrouping?: boolean;\n    isMetadataLoading?: boolean;\n    metadataError?: Error | null;\n  }) => {\n    const intl = useIntl();\n    const { theme } = useDesignSystemTheme();\n    const [open, setOpen] = useState(false);\n\n    const sortOptions = useMemo(() => {\n      const sortOptions: SortOption[] = [];\n\n      const assessmentLabelPrefix = intl.formatMessage({\n        defaultMessage: 'Assessment',\n        description: 'Evaluation review > evaluations list > assessment sort option label prefix',\n      });\n\n      if (enableGrouping) {\n        const sortedColumns = sortGroupedColumns(columns);\n\n        for (const column of sortedColumns) {\n          if (column.type === TracesTableColumnType.ASSESSMENT) {\n            const sortableAssessmentInfo = column.assessmentInfo as AssessmentInfo;\n            const assessmentLabel = sortableAssessmentInfo.displayName;\n\n            sortOptions.push({\n              label: assessmentLabel,\n              key: column.id,\n              type: TracesTableColumnType.ASSESSMENT,\n              group: TracesTableColumnGroup.ASSESSMENT,\n            });\n          } else if (column.type === TracesTableColumnType.INPUT) {\n            sortOptions.push({\n              label: column.label,\n              key: column.id,\n              type: TracesTableColumnType.INPUT,\n              group: TracesTableColumnGroup.INFO,\n            });\n          } else if (column.type === TracesTableColumnType.TRACE_INFO) {\n            const label =\n              column.id === SESSION_COLUMN_ID\n                ? intl.formatMessage({\n                    defaultMessage: 'Session time',\n                    description: 'Session time sort option label',\n                  })\n                : column.label;\n            if (SORTABLE_INFO_COLUMNS.includes(column.id)) {\n              sortOptions.push({\n                label,\n                key: column.id,\n                type: TracesTableColumnType.TRACE_INFO,\n                group: TracesTableColumnGroup.INFO,\n              });\n            }\n          }\n        }\n\n        return sortOptions;\n      }\n\n      // First add assessments.\n      for (const sortableAssessmentCol of columns.filter(\n        (column) => column.type === TracesTableColumnType.ASSESSMENT,\n      )) {\n        const sortableAssessmentInfo = sortableAssessmentCol.assessmentInfo as AssessmentInfo;\n        const assessmentLabel = sortableAssessmentInfo.displayName;\n        sortOptions.push({\n          label: `${assessmentLabelPrefix} ﹥ ${assessmentLabel}`,\n          key: sortableAssessmentCol.id,\n          type: TracesTableColumnType.ASSESSMENT,\n        });\n      }\n      // Next add inputs.\n      const inputLabelPrefix = intl.formatMessage({\n        defaultMessage: 'Input',\n        description: 'Evaluation review > evaluations list > input sort option label prefix',\n      });\n      for (const inputColumn of columns.filter((column) => column.type === TracesTableColumnType.INPUT)) {\n        sortOptions.push({\n          label: `${inputLabelPrefix} ﹥ ${inputColumn.label}`,\n          key: inputColumn.id,\n          type: TracesTableColumnType.INPUT,\n        });\n      }\n\n      // Add info columns\n      for (const infoColumn of columns.filter(\n        (column) =>\n          (column.type === TracesTableColumnType.TRACE_INFO ||\n            column.type === TracesTableColumnType.INTERNAL_MONITOR_REQUEST_TIME) &&\n          SORTABLE_INFO_COLUMNS.includes(column.id),\n      )) {\n        sortOptions.push({\n          label: infoColumn.label,\n          key: infoColumn.id,\n          type: TracesTableColumnType.TRACE_INFO,\n        });\n      }\n\n      return sortOptions;\n    }, [columns, intl, enableGrouping]);\n\n    // Generate the label for the sort select dropdown\n    const currentSortSelectLabel = useMemo(() => {\n      // Search through all sort options generated basing on the fetched runs\n      const sortOption = sortOptions.find((option) => option.key === tableSort?.key);\n\n      let sortOptionLabel = sortOption?.label;\n\n      // If the actually chosen sort value is not found in the sort option list (e.g. because the list of fetched runs is empty),\n      // use it to generate the label\n      if (!sortOptionLabel) {\n        // The following regex extracts plain sort key name from its canonical form, i.e.\n        // metrics.`metric_key_name` => metric_key_name\n        const extractedKeyName = tableSort?.key?.match(/^.+\\.`(.+)`$/);\n        if (extractedKeyName) {\n          // eslint-disable-next-line prefer-destructuring\n          sortOptionLabel = extractedKeyName[1];\n        }\n      }\n      const sortMessage = intl.formatMessage({\n        defaultMessage: 'Sort',\n        description: 'Experiment page > sort selector > label for the dropdown button',\n      });\n\n      return !sortOptionLabel ? sortMessage : `${sortMessage}: ${sortOptionLabel}`;\n    }, [sortOptions, intl, tableSort]);\n\n    return (\n      <DropdownMenu.Root open={open} onOpenChange={setOpen} modal={false}>\n        <DropdownMenu.Trigger data-testid=\"sort-select-dropdown\" asChild>\n          <Button\n            componentId=\"mlflow.experiment_page.sort_select_v2.toggle\"\n            icon={tableSort ? tableSort.asc ? <SortAscendingIcon /> : <SortDescendingIcon /> : <SortUnsortedIcon />}\n            css={{ minWidth: 32 }}\n            aria-label={currentSortSelectLabel}\n            endIcon={<ChevronDownIcon />}\n          >\n            {currentSortSelectLabel}\n          </Button>\n        </DropdownMenu.Trigger>\n        <DropdownMenu.Content minWidth={250}>\n          {metadataError ? (\n            <div\n              css={{\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                gap: theme.spacing.xs,\n                padding: `${theme.spacing.md}px`,\n                color: theme.colors.textValidationDanger,\n              }}\n              data-testid=\"filter-dropdown-error\"\n            >\n              <DangerIcon />\n              <FormattedMessage\n                defaultMessage=\"Fetching traces failed\"\n                description=\"Error message for fetching traces failed\"\n              />\n            </div>\n          ) : isMetadataLoading ? (\n            <div\n              css={{\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                gap: theme.spacing.xs,\n                padding: `${theme.spacing.lg}px`,\n                color: theme.colors.textSecondary,\n              }}\n              data-testid=\"sort-dropdown-loading\"\n            >\n              <Spinner size=\"small\" />\n            </div>\n          ) : enableGrouping ? (\n            <EvaluationsOverviewSortDropdownBodyGrouped\n              sortOptions={sortOptions}\n              tableSort={tableSort}\n              onOptionSelected={(sortOption, orderByAsc) => {\n                onChange(sortOption, orderByAsc);\n                setOpen(false);\n              }}\n            />\n          ) : (\n            <EvaluationsOverviewSortDropdownBody\n              sortOptions={sortOptions}\n              tableSort={tableSort}\n              onOptionSelected={(sortOption, orderByAsc) => {\n                onChange(sortOption, orderByAsc);\n                setOpen(false);\n              }}\n            />\n          )}\n        </DropdownMenu.Content>\n      </DropdownMenu.Root>\n    );\n  },\n);\n\nconst EvaluationsOverviewSortDropdownBodyGrouped = ({\n  sortOptions,\n  tableSort,\n  onOptionSelected,\n}: {\n  sortOptions: SortOption[];\n  tableSort?: EvaluationsOverviewTableSort;\n  onOptionSelected: (opt: SortOption, asc: boolean) => void;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const inputRef = useRef<React.ComponentRef<typeof Input>>(null);\n  const firstOptionRef = useRef<HTMLDivElement>(null);\n\n  const [filter, setFilter] = useState<string>('');\n\n  const filtered = useMemo(\n    () => sortOptions.filter((opt) => opt.label.toLowerCase().includes(filter.toLowerCase())),\n    [sortOptions, filter],\n  );\n\n  const grouped = useMemo(() => {\n    const m: Record<string, SortOption[]> = {};\n    filtered.forEach((opt) => {\n      const grp = opt.group ?? TracesTableColumnGroup.INFO;\n      if (!m[grp]) m[grp] = [];\n      m[grp].push(opt);\n    });\n    return m;\n  }, [filtered]);\n\n  const handleChange = useCallback(\n    (key: string) => {\n      const opt = sortOptions.find((o) => o.key === key);\n      if (!opt) return;\n      onOptionSelected(opt, tableSort?.asc ?? true);\n    },\n    [onOptionSelected, sortOptions, tableSort?.asc],\n  );\n\n  const setOrder = useCallback(\n    (asc: boolean) => {\n      const opt = sortOptions.find((o) => o.key === tableSort?.key) ?? sortOptions[0];\n      onOptionSelected(opt, asc);\n    },\n    [onOptionSelected, sortOptions, tableSort?.key],\n  );\n\n  // Autofocus won't work everywhere so let's focus input everytime the dropdown is opened\n  useEffect(() => {\n    requestAnimationFrame(() => inputRef.current?.focus());\n  }, []);\n\n  return (\n    <>\n      <div\n        css={{\n          padding: `${theme.spacing.sm}px ${theme.spacing.lg / 2}px`,\n          display: 'flex',\n          gap: theme.spacing.xs,\n        }}\n      >\n        <Input\n          ref={inputRef}\n          componentId=\"mlflow.genai_traces_table.sort_dropdown.search\"\n          prefix={<SearchIcon />}\n          placeholder=\"Search\"\n          value={filter}\n          onChange={(e) => setFilter(e.target.value)}\n          type=\"search\"\n          onKeyDown={(e) => {\n            if (e.key === 'ArrowDown' || e.key === 'Tab') {\n              firstOptionRef.current?.focus();\n              e.preventDefault();\n            }\n          }}\n        />\n        <div css={{ display: 'flex', gap: theme.spacing.xs }}>\n          <ToggleButton\n            pressed={tableSort?.asc === false}\n            icon={<ArrowDownIcon />}\n            componentId=\"mlflow.genai_traces_table.sort_dropdown.sort_desc\"\n            onClick={() => setOrder(false)}\n            aria-label=\"Sort descending\"\n          />\n          <ToggleButton\n            pressed={tableSort?.asc === true}\n            icon={<ArrowUpIcon />}\n            componentId=\"mlflow.experiment_page.sort_dropdown.sort_asc\"\n            onClick={() => setOrder(true)}\n            aria-label=\"Sort ascending\"\n          />\n        </div>\n      </div>\n\n      <div css={{ maxHeight: 400, overflowY: 'auto', padding: `0 ${theme.spacing.sm}px` }}>\n        {Object.entries(grouped).map(([groupName, opts], gi) => (\n          <React.Fragment key={groupName}>\n            <DropdownMenu.Group>\n              <DropdownMenu.Label>\n                {groupName === TracesTableColumnGroup.INFO\n                  ? 'Attributes'\n                  : TracesTableColumnGroupToLabelMap[groupName as TracesTableColumnGroup]}\n              </DropdownMenu.Label>\n              {opts.map((opt, idx) => (\n                <DropdownMenu.CheckboxItem\n                  componentId=\"mlflow.genai_traces_table.sort_dropdown.sort_option\"\n                  key={opt.key}\n                  checked={opt.key === tableSort?.key}\n                  onClick={() => handleChange(opt.key)}\n                  ref={gi === 0 && idx === 0 ? firstOptionRef : undefined}\n                  data-testid={`sort-select-${opt.label}`}\n                >\n                  <DropdownMenu.ItemIndicator />\n                  <span css={{ display: 'flex', alignItems: 'center', gap: 4 }}>{opt.label}</span>\n                </DropdownMenu.CheckboxItem>\n              ))}\n            </DropdownMenu.Group>\n          </React.Fragment>\n        ))}\n\n        {/* No results fallback */}\n        {filtered.length === 0 && (\n          <DropdownMenu.Item disabled componentId=\"mlflow.genai_traces_table.sort_dropdown.no_results\">\n            <FormattedMessage\n              defaultMessage=\"No results\"\n              description=\"Experiment page > sort selector > no results after filtering\"\n            />\n          </DropdownMenu.Item>\n        )}\n      </div>\n    </>\n  );\n};\n\nconst EvaluationsOverviewSortDropdownBody = ({\n  sortOptions,\n  tableSort,\n  onOptionSelected,\n}: {\n  sortOptions: SortOption[];\n  tableSort?: EvaluationsOverviewTableSort;\n  onOptionSelected: (sortOption: SortOption, orderByAsc: boolean) => void;\n}) => {\n  const { theme } = useDesignSystemTheme();\n\n  const inputElementRef = useRef<React.ComponentRef<typeof Input>>(null);\n  const [filter, setFilter] = useState('');\n  const firstElementRef = useRef<HTMLDivElement>(null);\n\n  // Merge all sort options and filter them by the search query\n  const filteredSortOptions = useMemo(\n    () =>\n      sortOptions.filter((option) => {\n        return option.label.toLowerCase().includes(filter.toLowerCase());\n      }),\n    [sortOptions, filter],\n  );\n\n  const handleChange = useCallback(\n    (orderByKey: string) => {\n      const orderByKeyOption = sortOptions.find((option) => option.key === orderByKey);\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion -- TODO(FEINF-3982)\n      onOptionSelected(orderByKeyOption!, tableSort?.asc || true);\n    },\n    [onOptionSelected, tableSort, sortOptions],\n  );\n\n  const setOrder = useCallback(\n    (ascending: boolean) => {\n      const orderByKeyOption = sortOptions.find((option) => option.key === tableSort?.key);\n      onOptionSelected(orderByKeyOption || sortOptions[0], ascending);\n    },\n    [onOptionSelected, sortOptions, tableSort],\n  );\n\n  // Autofocus won't work everywhere so let's focus input everytime the dropdown is opened\n  useEffect(() => {\n    requestAnimationFrame(() => {\n      inputElementRef.current?.focus();\n    });\n  }, []);\n\n  return (\n    <>\n      <div\n        css={{\n          padding: `${theme.spacing.sm}px ${theme.spacing.lg / 2}px ${theme.spacing.sm}px`,\n          width: '100%',\n          display: 'flex',\n          gap: theme.spacing.xs,\n        }}\n      >\n        <Input\n          componentId=\"mlflow.experiment_page.sort_dropdown.search\"\n          prefix={<SearchIcon />}\n          value={filter}\n          type=\"search\"\n          onChange={(e) => setFilter(e.target.value)}\n          placeholder=\"Search\"\n          autoFocus\n          ref={inputElementRef}\n          onKeyDown={(e) => {\n            if (e.key === 'ArrowDown' || e.key === 'Tab') {\n              firstElementRef.current?.focus();\n              return;\n            }\n            e.stopPropagation();\n          }}\n        />\n        <div\n          css={{\n            display: 'flex',\n            gap: theme.spacing.xs,\n          }}\n        >\n          <ToggleButton\n            pressed={tableSort?.asc === false}\n            icon={<ArrowDownIcon />}\n            componentId=\"mlflow.experiment_page.sort_dropdown.sort_desc\"\n            onClick={() => setOrder(false)}\n            aria-label=\"Sort descending\"\n            data-testid=\"sort-select-desc\"\n          />\n          <ToggleButton\n            pressed={tableSort?.asc === true}\n            icon={<ArrowUpIcon />}\n            componentId=\"mlflow.experiment_page.sort_dropdown.sort_asc\"\n            onClick={() => setOrder(true)}\n            aria-label=\"Sort ascending\"\n            data-testid=\"sort-select-asc\"\n          />\n        </div>\n      </div>\n      <DropdownMenu.Group css={{ maxHeight: 400, overflowY: 'auto' }}>\n        {filteredSortOptions.map((sortOption, index) => (\n          <DropdownMenu.CheckboxItem\n            componentId=\"mlflow.experiment_page.sort_dropdown.sort_option\"\n            key={sortOption.key}\n            onClick={() => handleChange(sortOption.key)}\n            checked={sortOption.key === tableSort?.key}\n            data-testid={`sort-select-${sortOption.label}`}\n            ref={index === 0 ? firstElementRef : undefined}\n          >\n            <DropdownMenu.ItemIndicator />\n            <span css={{ display: 'flex', alignItems: 'center', gap: 4 }}>{sortOption.label}</span>\n          </DropdownMenu.CheckboxItem>\n        ))}\n        {!filteredSortOptions.length && (\n          <DropdownMenu.Item\n            componentId=\"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunssortselectorv2.tsx_151\"\n            disabled\n          >\n            <FormattedMessage\n              defaultMessage=\"No results\"\n              description=\"Experiment page > sort selector > no results after filtering by search query\"\n            />\n          </DropdownMenu.Item>\n        )}\n      </DropdownMenu.Group>\n    </>\n  );\n};\n","import { useDesignSystemTheme } from '@databricks/design-system';\n\nexport const GenAiEvaluationBadge = ({\n  backgroundColor,\n  icon,\n  children,\n}:\n  | {\n      backgroundColor?: string;\n      icon?: React.ReactNode;\n      children: React.ReactNode;\n    }\n  | {\n      backgroundColor?: string;\n      icon: React.ReactNode;\n      children?: null;\n    }) => {\n  const { theme } = useDesignSystemTheme();\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexDirection: 'row',\n        justifyContent: 'center',\n        alignItems: 'center',\n        padding: '4px 8px',\n        gap: theme.spacing.xs,\n        borderRadius: theme.borders.borderRadiusMd,\n        color: theme.colors.textSecondary,\n        backgroundColor: backgroundColor || theme.colors.backgroundSecondary,\n        fontSize: theme.typography.fontSizeSm,\n      }}\n    >\n      {icon ? icon : null}\n      {children ? <span>{children}</span> : null}\n    </div>\n  );\n};\n","import { useCallback } from 'react';\n\nimport { useSearchParams } from '../utils/RoutingUtils';\n\nconst QUERY_PARAM_KEY = 'selectedEvaluationId';\n\n/**\n * Query param-powered hook that returns the currently selected evaluation ID\n * and a function to set the selected evaluation ID.\n */\nexport const useActiveEvaluation = () => {\n  const [searchParams, setSearchParams] = useSearchParams();\n\n  const selectedEvaluationId = searchParams.get(QUERY_PARAM_KEY) ?? undefined;\n\n  const setSelectedEvaluationId = useCallback(\n    (selectedEvaluationId: string | undefined) => {\n      setSearchParams((params) => {\n        if (selectedEvaluationId === undefined) {\n          params.delete(QUERY_PARAM_KEY);\n          return params;\n        }\n        params.set(QUERY_PARAM_KEY, selectedEvaluationId);\n        return params;\n      });\n    },\n    [setSearchParams],\n  );\n\n  return [selectedEvaluationId, setSelectedEvaluationId] as const;\n};\n","import { useCallback } from 'react';\n\nimport { useSearchParams } from '../utils/RoutingUtils';\n\nconst QUERY_PARAM_KEY = 'searchQuery';\n\n/**\n * Query param-powered hook that returns the search query for evaluations.\n */\nexport const useEvaluationsSearchQuery = () => {\n  const [searchParams, setSearchParams] = useSearchParams();\n\n  const searchQuery = searchParams.get(QUERY_PARAM_KEY) ?? '';\n\n  const setSearchQuery = useCallback(\n    (value: string | undefined) => {\n      setSearchParams((params) => {\n        if (value === undefined || value === '') {\n          params.delete(QUERY_PARAM_KEY);\n          return params;\n        }\n        params.set(QUERY_PARAM_KEY, value);\n        return params;\n      });\n    },\n    [setSearchParams],\n  );\n\n  return [searchQuery, setSearchQuery] as const;\n};\n","import { isNil } from 'lodash';\n\nimport {\n  getEvaluationResultAssessmentValue,\n  KnownEvaluationResultAssessmentName,\n} from '../components/GenAiEvaluationTracesReview.utils';\nimport type { AssessmentFilter, EvalTraceComparisonEntry } from '../types';\n\nfunction filterEval(\n  comparisonEntry: EvalTraceComparisonEntry,\n  filters: AssessmentFilter[],\n  currentRunDisplayName?: string,\n  otherRunDisplayName?: string,\n): boolean {\n  // Currently only filters on the current run value.\n  const currentRunValue = comparisonEntry?.currentRunValue;\n  const otherRunValue = comparisonEntry?.otherRunValue;\n\n  let includeEval = true;\n\n  for (const filter of filters) {\n    const assessmentName = filter.assessmentName;\n    const filterValue = filter.filterValue;\n    const run = filter.run;\n    const runValue =\n      run === currentRunDisplayName ? currentRunValue : run === otherRunDisplayName ? otherRunValue : undefined;\n    // TODO(nsthorat): Fix this logic, not clear that this is the right way to filter.\n    if (runValue === undefined) {\n      continue;\n    }\n\n    const assessment =\n      assessmentName === KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT\n        ? runValue.overallAssessments?.[0]\n        : runValue.responseAssessmentsByName[assessmentName]?.[0];\n\n    if (filter.filterType === 'rca') {\n      const currentIsAssessmentRootCause =\n        runValue?.overallAssessments[0]?.rootCauseAssessment?.assessmentName === assessmentName;\n      includeEval = includeEval && currentIsAssessmentRootCause;\n    } else {\n      let assessmentValue = assessment ? getEvaluationResultAssessmentValue(assessment) : undefined;\n      if (isNil(assessmentValue)) {\n        assessmentValue = undefined;\n      }\n\n      includeEval = includeEval && assessmentValue === filterValue;\n    }\n  }\n  return includeEval;\n}\n\nexport function filterEvaluationResults(\n  evaluationResults: EvalTraceComparisonEntry[],\n  assessmentFilters: AssessmentFilter[],\n  searchQuery?: string,\n  currentRunDisplayName?: string,\n  otherRunDisplayName?: string,\n): EvalTraceComparisonEntry[] {\n  // Filter results by the assessment filters.\n  return (\n    evaluationResults\n      .filter((entry) => {\n        return filterEval(entry, assessmentFilters, currentRunDisplayName, otherRunDisplayName);\n      })\n      // Filter results by the text search box.\n      .filter((entry) => {\n        if (isNil(searchQuery) || searchQuery === '') {\n          return true;\n        }\n        const searchQueryLower = searchQuery.toLowerCase();\n        const currentInputsContainSearchQuery = Object.values(entry.currentRunValue?.inputs || {}).some(\n          (inputValue) => {\n            return JSON.stringify(inputValue).toLowerCase().includes(searchQueryLower);\n          },\n        );\n        const inputsIdEqualsToSearchQuery = entry.currentRunValue?.inputsId.toLowerCase() === searchQueryLower;\n        return currentInputsContainSearchQuery || inputsIdEqualsToSearchQuery;\n      })\n  );\n}\n","import type { RowSelectionState } from '@tanstack/react-table';\nimport { isNil } from 'lodash';\nimport React, { useCallback, useMemo, useState } from 'react';\n\nimport {\n  Button,\n  ChevronDownIcon,\n  Typography,\n  useDesignSystemTheme,\n  DialogCombobox,\n  DialogComboboxContent,\n  SegmentedControlGroup,\n  SegmentedControlButton,\n  DialogComboboxCustomButtonTriggerWrapper,\n  XCircleFillIcon,\n  TableFilterLayout,\n  LegacySkeleton,\n  FilterIcon,\n  Tooltip,\n  Spinner,\n  WarningIcon,\n} from '@databricks/design-system';\nimport { FormattedMessage, useIntl } from '@databricks/i18n';\nimport type { ModelTrace, ModelTraceInfo } from '@databricks/web-shared/model-trace-explorer';\n\nimport { GenAITracesTableActions } from './GenAITracesTableActions';\nimport { computeEvaluationsComparison } from './GenAiTracesTable.utils';\nimport { GenAiTracesTableBody } from './GenAiTracesTableBody';\nimport { GenAiTracesTableSearchInput } from './GenAiTracesTableSearchInput';\nimport { EvaluationsOverviewColumnSelector } from './components/EvaluationsOverviewColumnSelector';\nimport { EvaluationsOverviewSortDropdown } from './components/EvaluationsOverviewSortDropdown';\nimport { GenAiEvaluationBadge } from './components/GenAiEvaluationBadge';\nimport {\n  getAssessmentValueLabel,\n  KnownEvaluationResultAssessmentName,\n} from './components/GenAiEvaluationTracesReview.utils';\nimport { useActiveEvaluation } from './hooks/useActiveEvaluation';\nimport {\n  assessmentValueToSerializedString,\n  serializedStringToAssessmentValue,\n  useAssessmentFilters,\n} from './hooks/useAssessmentFilters';\nimport { useEvaluationsSearchQuery } from './hooks/useEvaluationsSearchQuery';\nimport { GenAITracesTableConfigProvider, type GenAITracesTableConfig } from './hooks/useGenAITracesTableConfig';\nimport { useTableColumns } from './hooks/useTableColumns';\nimport { TracesTableColumnType } from './types';\nimport type {\n  AssessmentFilter,\n  AssessmentInfo,\n  AssessmentValueType,\n  SaveAssessmentsQuery,\n  RunEvaluationTracesDataEntry,\n  TracesTableColumn,\n  TraceActions,\n  EvaluationsOverviewTableSort,\n} from './types';\nimport { getAssessmentInfos, sortAssessmentInfos } from './utils/AggregationUtils';\nimport { displayPercentage } from './utils/DisplayUtils';\nimport { FILTER_DROPDOWN_COMPONENT_ID } from './utils/EvaluationLogging';\nimport { filterEvaluationResults } from './utils/EvaluationsFilterUtils';\nimport { applyTraceInfoV3ToEvalEntry } from './utils/TraceUtils';\n\nfunction GenAiTracesTableImpl({\n  experimentId,\n  currentEvaluationResults: oldEvalResults,\n  compareToEvaluationResults: oldCompareToEvalResults,\n  currentRunDisplayName,\n  runUuid,\n  compareToRunUuid,\n  compareToRunDisplayName,\n  compareToRunLoading,\n  sampledInfo,\n  exportToEvalsInstanceEnabled = false,\n  getTrace,\n  saveAssessmentsQuery,\n  enableRunEvaluationWriteFeatures,\n  defaultSortOption,\n  disableAssessmentTooltips,\n  onTraceTagsEdit,\n  traceActions,\n  initialSelectedColumns,\n}: {\n  experimentId: string;\n  currentEvaluationResults: RunEvaluationTracesDataEntry[];\n  compareToEvaluationResults?: RunEvaluationTracesDataEntry[];\n  currentRunDisplayName?: string;\n  runUuid?: string;\n  compareToRunUuid?: string;\n  compareToRunDisplayName?: string;\n  compareToRunLoading?: boolean;\n  sampledInfo?: SampleInfo;\n  exportToEvalsInstanceEnabled?: boolean;\n  getTrace?: (traceId?: string) => Promise<ModelTrace | undefined>;\n  saveAssessmentsQuery?: SaveAssessmentsQuery;\n  enableRunEvaluationWriteFeatures?: boolean;\n  defaultSortOption?: EvaluationsOverviewTableSort;\n  // This is a temporary hack to disable assessment hovercards because\n  // we don't properly display long strings yet. We should eventually fix the hovercard\n  // to display long strings and remove this prop.\n  disableAssessmentTooltips?: boolean;\n  onTraceTagsEdit?: (trace: ModelTraceInfo) => void;\n  traceActions?: TraceActions;\n  initialSelectedColumns?: (allColumns: TracesTableColumn[]) => TracesTableColumn[];\n}) {\n  const { theme } = useDesignSystemTheme();\n  const intl = useIntl();\n\n  // Convert trace info v3 back to the old RunEvaluationTracesDataEntry format.\n  // We should gradually migrate this component to use trace info v3 directly and\n  // then we can remove this conversion.\n  const currentEvaluationResults = applyTraceInfoV3ToEvalEntry(oldEvalResults);\n  const compareToEvaluationResults = applyTraceInfoV3ToEvalEntry(oldCompareToEvalResults || []);\n\n  // Eventually we should just take traceActions that user passes in\n  // once exportToEval is moved to traceActions as well.\n  const fullTraceActions: TraceActions = useMemo(() => {\n    const exportToEvalAction = exportToEvalsInstanceEnabled\n      ? {\n          exportToEvals: {\n            exportToEvalsInstanceEnabled,\n            getTrace,\n          },\n        }\n      : {};\n    return {\n      ...traceActions,\n      ...exportToEvalAction,\n    };\n  }, [traceActions, exportToEvalsInstanceEnabled, getTrace]);\n\n  const enableTableRowSelection: boolean = Object.keys(fullTraceActions).length > 0;\n\n  const [selectedEvaluationId, setSelectedEvaluationId] = useActiveEvaluation();\n\n  // evaluationResults contains the merged evaluation results from the current and compare-to runs.\n  const evaluationResults = useMemo(\n    () => computeEvaluationsComparison(currentEvaluationResults, compareToEvaluationResults),\n    [currentEvaluationResults, compareToEvaluationResults],\n  );\n\n  const [searchQuery, setSearchQuery] = useEvaluationsSearchQuery();\n\n  const assessmentInfos = useMemo(() => {\n    return getAssessmentInfos(intl, currentEvaluationResults, compareToEvaluationResults);\n  }, [intl, currentEvaluationResults, compareToEvaluationResults]);\n\n  const allColumns: TracesTableColumn[] = useTableColumns(intl, currentEvaluationResults, assessmentInfos, runUuid);\n\n  const [assessmentFilters, setAssessmentFilters] = useAssessmentFilters(\n    // These are the subset of all assessment infos that are shown in the table\n    allColumns.map((col) => col.assessmentInfo).filter((info): info is AssessmentInfo => info !== undefined),\n  );\n\n  const displayEvaluationResults = useMemo(() => {\n    if (searchQuery === '' && assessmentFilters.length === 0) {\n      return evaluationResults;\n    }\n    return filterEvaluationResults(\n      evaluationResults,\n      assessmentFilters,\n      searchQuery,\n      currentRunDisplayName,\n      compareToRunDisplayName,\n    );\n  }, [evaluationResults, searchQuery, assessmentFilters, currentRunDisplayName, compareToRunDisplayName]);\n\n  // TODO(nsthorat): Add these to the URL.\n  // Initially all assessments, inputs, and certain info columns are selected\n  const [selectedColumns, setSelectedColumns] = useState<TracesTableColumn[]>(allColumns);\n\n  const selectedAssessmentInfos = useMemo(() => {\n    const selectedAssessmentCols = selectedColumns.filter((col) => col.type === TracesTableColumnType.ASSESSMENT);\n    const selectedAssessments = selectedAssessmentCols.map((col) => col.assessmentInfo as AssessmentInfo);\n    const sortedSelectedAssessments = sortAssessmentInfos(selectedAssessments);\n    return sortedSelectedAssessments;\n  }, [selectedColumns]);\n\n  const overallAssessmentCol = allColumns.find(\n    (col) =>\n      col.type === TracesTableColumnType.ASSESSMENT &&\n      col.id === KnownEvaluationResultAssessmentName.OVERALL_ASSESSMENT,\n  );\n\n  const initialSort: EvaluationsOverviewTableSort | undefined =\n    defaultSortOption ||\n    (overallAssessmentCol\n      ? { key: overallAssessmentCol.id, type: TracesTableColumnType.ASSESSMENT, asc: true }\n      : undefined);\n  const [tableSort, setTableSort] = useState<EvaluationsOverviewTableSort | undefined>(initialSort);\n\n  const getAssessmentFilter = useCallback(\n    (assessmentName: string, run: string): AssessmentFilter | undefined => {\n      return assessmentFilters.find((filter) => filter.assessmentName === assessmentName && filter.run === run);\n    },\n    [assessmentFilters],\n  );\n  const removeAssessmentFilter = useCallback(\n    (assessmentName: string, run: string) => {\n      setAssessmentFilters(\n        assessmentFilters.filter((filter) => filter.assessmentName !== assessmentName || filter.run !== run),\n      );\n    },\n    [assessmentFilters, setAssessmentFilters],\n  );\n\n  const updateAssessmentFilter = useCallback(\n    (\n      assessmentName: string,\n      filterValue: AssessmentValueType,\n      run: string,\n      filterType?: AssessmentFilter['filterType'],\n    ) => {\n      const filter = assessmentFilters.find((filter) => filter.assessmentName === assessmentName && filter.run === run);\n      if (filter === undefined) {\n        setAssessmentFilters([\n          ...assessmentFilters,\n          {\n            assessmentName,\n            filterValue,\n            filterType,\n            run,\n          },\n        ]);\n      } else {\n        setAssessmentFilters(\n          assessmentFilters.map((filter) => {\n            if (filter.assessmentName === assessmentName) {\n              return {\n                ...filter,\n                filterValue,\n                filterType,\n              };\n            }\n            return filter;\n          }),\n        );\n      }\n    },\n    [assessmentFilters, setAssessmentFilters],\n  );\n  const toggleAssessmentFilter = useCallback(\n    (\n      assessmentName: string,\n      filterValue: AssessmentValueType,\n      run: string,\n      filterType?: AssessmentFilter['filterType'],\n    ) => {\n      const filter = assessmentFilters.find((filter) => filter.assessmentName === assessmentName && filter.run === run);\n      if (filter === undefined) {\n        setAssessmentFilters([\n          ...assessmentFilters,\n          {\n            assessmentName,\n            filterValue,\n            filterType,\n            run,\n          },\n        ]);\n      } else if (filter.filterValue === filterValue && filter.filterType === filterType) {\n        // Remove the filter because it already exists.\n        setAssessmentFilters(\n          assessmentFilters.filter((filter) => filter.assessmentName !== assessmentName || filter.run !== run),\n        );\n      } else {\n        // Replace any filters with the same assessment name and run.\n        setAssessmentFilters(\n          assessmentFilters.map((filter) => {\n            if (filter.assessmentName === assessmentName && filter.run === run) {\n              return {\n                assessmentName,\n                filterValue,\n                filterType,\n                run,\n              };\n            }\n            return filter;\n          }),\n        );\n      }\n    },\n    [assessmentFilters, setAssessmentFilters],\n  );\n  const clearFilters = useCallback(() => {\n    setAssessmentFilters([]);\n  }, [setAssessmentFilters]);\n\n  const hasActiveFilters = assessmentFilters.length > 0;\n\n  const [rowSelection, setRowSelection] = useState<RowSelectionState>({});\n  const selectedTraces: RunEvaluationTracesDataEntry[] = useMemo(() => {\n    const selectedEvaluationIds = Object.keys(rowSelection).filter((evaluationId) => rowSelection[evaluationId]);\n    return displayEvaluationResults\n      .filter(\n        (evaluation) =>\n          evaluation.currentRunValue && selectedEvaluationIds.includes(evaluation.currentRunValue.evaluationId),\n      )\n      .map((entry) => entry.currentRunValue)\n      .filter((entry) => entry !== undefined);\n  }, [rowSelection, displayEvaluationResults]);\n\n  const config: Partial<GenAITracesTableConfig> = {\n    enableRunEvaluationWriteFeatures: enableRunEvaluationWriteFeatures,\n  };\n\n  const totalEvaluationResults = currentEvaluationResults.length;\n\n  if (compareToRunLoading) {\n    return <LegacySkeleton />;\n  }\n\n  return (\n    <GenAITracesTableConfigProvider config={config}>\n      <div\n        css={{\n          display: 'flex',\n          flexDirection: 'row',\n          gap: theme.spacing.lg,\n          overflow: 'hidden',\n          height: '100%',\n        }}\n      >\n        <div\n          css={{\n            display: 'flex',\n            flexDirection: 'column',\n            gap: theme.spacing.xs,\n            overflow: 'hidden',\n            flexGrow: 1,\n          }}\n        >\n          <div\n            css={{\n              display: 'flex',\n              flex: 1,\n              flexDirection: 'column',\n              gap: theme.spacing.xs,\n              overflow: 'hidden',\n            }}\n          >\n            <div\n              css={{\n                display: 'flex',\n                width: '100%',\n                alignItems: 'flex-end',\n                justifyContent: 'space-between',\n                padding: `${theme.spacing.xs}px 0px`,\n              }}\n            >\n              <TableFilterLayout\n                css={{\n                  marginBottom: 0,\n                }}\n              >\n                <GenAiTracesTableSearchInput searchQuery={searchQuery} setSearchQuery={setSearchQuery} />\n                <DialogCombobox\n                  componentId={FILTER_DROPDOWN_COMPONENT_ID}\n                  label=\"Filters\"\n                  value={Array.from(assessmentFilters).map((filter) => filter.assessmentName)}\n                  multiSelect\n                >\n                  <DialogComboboxCustomButtonTriggerWrapper>\n                    <Button\n                      endIcon={<ChevronDownIcon />}\n                      componentId=\"mlflow.evaluations_review.table_ui.filter_button\"\n                      css={{\n                        border: hasActiveFilters ? `1px solid ${theme.colors.actionDefaultBorderFocus} !important` : '',\n                        backgroundColor: hasActiveFilters\n                          ? `${theme.colors.actionDefaultBackgroundHover} !important`\n                          : '',\n                      }}\n                    >\n                      <div\n                        css={{\n                          display: 'flex',\n                          gap: theme.spacing.sm,\n                          alignItems: 'center',\n                        }}\n                      >\n                        <FilterIcon />\n                        {intl.formatMessage(\n                          {\n                            defaultMessage: 'Filters{numFilters}',\n                            description: 'Evaluation review > evaluations list > filter dropdown button',\n                          },\n                          {\n                            numFilters: hasActiveFilters ? ` (${assessmentFilters.length})` : '',\n                          },\n                        )}\n                        {assessmentFilters.length > 0 && (\n                          <XCircleFillIcon\n                            css={{\n                              fontSize: 12,\n                              cursor: 'pointer',\n                              color: theme.colors.grey400,\n                              '&:hover': {\n                                color: theme.colors.grey600,\n                              },\n                            }}\n                            onClick={(e) => {\n                              clearFilters();\n                              e.stopPropagation();\n                              e.preventDefault();\n                            }}\n                          />\n                        )}\n                      </div>\n                    </Button>\n                  </DialogComboboxCustomButtonTriggerWrapper>\n                  <DialogComboboxContent>\n                    <div\n                      css={{\n                        display: 'flex',\n                        flexDirection: 'column',\n                        padding: `${theme.spacing.sm}px ${theme.spacing.sm}px`,\n                        gap: theme.spacing.md,\n                      }}\n                    >\n                      {selectedAssessmentInfos\n                        // For now, we don't support filtering on numeric values.\n                        .filter((info) => info.dtype !== 'numeric')\n                        .map((assessmentInfo) => (\n                          <div\n                            css={{\n                              display: 'flex',\n                              flexDirection: 'column',\n                              gap: theme.spacing.sm,\n                            }}\n                            key={assessmentInfo.name}\n                          >\n                            <div\n                              css={{\n                                fontWeight: 500,\n                              }}\n                            >\n                              {assessmentInfo.displayName}\n                            </div>\n                            {currentRunDisplayName && (\n                              <AssessmentsFilterSelector\n                                assessmentLabel={assessmentInfo.displayName}\n                                assessmentName={assessmentInfo.name}\n                                assessmentInfo={assessmentInfo}\n                                assessmentFilter={getAssessmentFilter(assessmentInfo.name, currentRunDisplayName)}\n                                updateAssessmentFilter={updateAssessmentFilter}\n                                removeAssessmentFilter={removeAssessmentFilter}\n                                run={currentRunDisplayName}\n                              />\n                            )}\n                            {compareToRunUuid && compareToRunDisplayName && (\n                              <div\n                                css={{\n                                  display: 'flex',\n                                  flexDirection: 'column',\n                                  gap: theme.spacing.xs,\n                                }}\n                              >\n                                <Typography.Hint>{compareToRunDisplayName}</Typography.Hint>\n                                <AssessmentsFilterSelector\n                                  assessmentLabel={assessmentInfo.displayName}\n                                  assessmentName={assessmentInfo.name}\n                                  assessmentInfo={assessmentInfo}\n                                  assessmentFilter={getAssessmentFilter(assessmentInfo.name, compareToRunDisplayName)}\n                                  updateAssessmentFilter={updateAssessmentFilter}\n                                  removeAssessmentFilter={removeAssessmentFilter}\n                                  run={compareToRunDisplayName}\n                                />\n                              </div>\n                            )}\n                          </div>\n                        ))}\n                    </div>\n                  </DialogComboboxContent>\n                </DialogCombobox>\n                <EvaluationsOverviewSortDropdown\n                  tableSort={tableSort}\n                  columns={allColumns}\n                  onChange={(sortOption, orderByAsc) => {\n                    setTableSort({ key: sortOption.key, type: sortOption.type, asc: orderByAsc });\n                  }}\n                />\n\n                {/* Column selector */}\n                <EvaluationsOverviewColumnSelector\n                  columns={allColumns}\n                  selectedColumns={selectedColumns}\n                  setSelectedColumns={setSelectedColumns}\n                />\n                <GenAITracesTableActions\n                  experimentId={experimentId}\n                  selectedTraces={selectedTraces}\n                  setRowSelection={setRowSelection}\n                  traceActions={fullTraceActions}\n                  traceInfos={undefined}\n                />\n              </TableFilterLayout>\n              <div\n                css={{\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: theme.spacing.sm,\n                }}\n              >\n                <SampledInfoBadge totalRowCount={totalEvaluationResults} sampledInfo={sampledInfo} />\n                <Typography.Hint>\n                  {intl.formatMessage(\n                    {\n                      defaultMessage: '{numFilteredEvals} of {numEvals}',\n                      description:\n                        'Text displayed when showing a filtered subset evaluations in the evaluation review page',\n                    },\n                    {\n                      numEvals: evaluationResults.length,\n                      numFilteredEvals: displayEvaluationResults.length,\n                    },\n                  )}\n                </Typography.Hint>\n              </div>\n            </div>\n            <div\n              css={{\n                display: 'flex',\n                gap: theme.spacing.md,\n                width: '100%',\n                flex: 1,\n                overflowY: 'hidden',\n              }}\n            >\n              <div\n                css={{\n                  display: 'flex',\n                  flex: 1,\n                  overflowY: 'hidden',\n                }}\n              >\n                <GenAiTracesTableBody\n                  experimentId={experimentId}\n                  selectedColumns={selectedColumns}\n                  allColumns={allColumns}\n                  evaluations={displayEvaluationResults}\n                  selectedEvaluationId={selectedEvaluationId}\n                  selectedAssessmentInfos={selectedAssessmentInfos}\n                  assessmentInfos={assessmentInfos}\n                  assessmentFilters={assessmentFilters}\n                  onChangeEvaluationId={setSelectedEvaluationId}\n                  tableSort={tableSort}\n                  runUuid={runUuid}\n                  compareToRunUuid={compareToRunUuid}\n                  runDisplayName={currentRunDisplayName}\n                  compareToRunDisplayName={compareToRunDisplayName}\n                  enableRowSelection={enableTableRowSelection}\n                  rowSelection={enableTableRowSelection ? rowSelection : undefined}\n                  setRowSelection={enableTableRowSelection ? setRowSelection : undefined}\n                  exportToEvalsInstanceEnabled={exportToEvalsInstanceEnabled}\n                  getTrace={getTrace}\n                  toggleAssessmentFilter={toggleAssessmentFilter}\n                  saveAssessmentsQuery={saveAssessmentsQuery}\n                  disableAssessmentTooltips={disableAssessmentTooltips}\n                  onTraceTagsEdit={onTraceTagsEdit}\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </GenAITracesTableConfigProvider>\n  );\n}\n\nconst SampledInfoBadge = (props: { totalRowCount: number; sampledInfo?: SampleInfo }) => {\n  const { totalRowCount, sampledInfo } = props;\n  const intl = useIntl();\n\n  if (!sampledInfo) {\n    return null;\n  }\n\n  // TODO: Remove this once table supports pagination\n  if (sampledInfo.maxAllowedCount) {\n    if (totalRowCount >= sampledInfo.maxAllowedCount) {\n      return (\n        <Tooltip\n          componentId=\"mlflow.experiment_list_view.max_traces.tooltip\"\n          content={intl.formatMessage(\n            {\n              defaultMessage: 'Only the top {evalResultsCount} results are shown',\n              description: 'Evaluation review > evaluations list > sample info tooltip',\n            },\n            {\n              evalResultsCount: totalRowCount,\n            },\n          )}\n        >\n          <WarningIcon color=\"warning\" />\n        </Tooltip>\n      );\n    }\n\n    return null;\n  }\n  if (sampledInfo.logCountLoading || isNil(sampledInfo.sampledCount) || isNil(sampledInfo.totalCount)) {\n    return <Spinner />;\n  }\n  return (\n    <GenAiEvaluationBadge>\n      <Tooltip\n        componentId=\"mlflow.experiment_list_view.sampled_badge.tooltip\"\n        content={intl.formatMessage(\n          {\n            defaultMessage: 'Retrieved {sampledCount} out of {totalCount} total logs ({percentage}%)',\n            description: 'Evaluation review > evaluations list > sample info tooltip',\n          },\n          {\n            sampledCount: sampledInfo.sampledCount,\n            totalCount: sampledInfo.totalCount,\n            percentage: displayPercentage(sampledInfo.sampledCount / sampledInfo.totalCount),\n          },\n        )}\n      >\n        Sampled {displayPercentage(sampledInfo.sampledCount / sampledInfo.totalCount)}%\n      </Tooltip>\n    </GenAiEvaluationBadge>\n  );\n};\n\nconst ANY_VALUE = '__any_value__';\n\nconst AssessmentsFilterSelector = React.memo(\n  ({\n    assessmentName,\n    assessmentInfo,\n    assessmentLabel,\n    assessmentFilter,\n    updateAssessmentFilter,\n    removeAssessmentFilter,\n    run,\n  }: {\n    assessmentName: string;\n    assessmentInfo: AssessmentInfo;\n    assessmentLabel: string;\n    assessmentFilter: AssessmentFilter | undefined;\n    updateAssessmentFilter: (assessmentName: string, filterValue: AssessmentValueType, run: string) => void;\n    removeAssessmentFilter: (assessmentName: string, run: string) => void;\n    run: string;\n  }) => {\n    const intl = useIntl();\n    const { theme } = useDesignSystemTheme();\n\n    const selectedValue = assessmentFilter\n      ? assessmentValueToSerializedString(assessmentFilter.filterValue)\n      : ANY_VALUE;\n\n    return (\n      <div\n        css={{\n          display: 'flex',\n          flexDirection: 'column',\n        }}\n      >\n        <SegmentedControlGroup\n          name=\"size-story\"\n          value={selectedValue}\n          onChange={(event) => {\n            if (event.target.value === ANY_VALUE) {\n              removeAssessmentFilter(assessmentName, run);\n              return;\n            }\n            const value = serializedStringToAssessmentValue(assessmentInfo, event.target.value);\n            updateAssessmentFilter(assessmentName, value, run);\n          }}\n          size=\"middle\"\n          componentId={`mlflow.evaluations_review.table_ui.filter_control_${assessmentName}`}\n        >\n          <SegmentedControlButton value={ANY_VALUE}>\n            <div\n              css={{\n                display: 'flex',\n                gap: theme.spacing.sm,\n                alignItems: 'center',\n                color: theme.colors.textPrimary,\n              }}\n            >\n              {intl.formatMessage({\n                defaultMessage: 'All',\n                description:\n                  'Evaluation review > sidebar list of evaluation results > filter control > option for filtering evaluation results with no filter',\n              })}\n            </div>\n          </SegmentedControlButton>\n          {Array.from(assessmentInfo.uniqueValues.values()).map((value) => {\n            const { content, icon } = getAssessmentValueLabel(intl, theme, assessmentInfo, value);\n            return (\n              <SegmentedControlButton\n                value={assessmentValueToSerializedString(value)}\n                key={assessmentValueToSerializedString(value)}\n              >\n                <div\n                  css={{\n                    display: 'flex',\n                    gap: theme.spacing.sm,\n                    alignItems: 'center',\n                    color: theme.colors.textPrimary,\n                  }}\n                >\n                  {content}\n                  {icon}\n                </div>\n              </SegmentedControlButton>\n            );\n          })}\n        </SegmentedControlGroup>\n      </div>\n    );\n  },\n);\n\nexport interface SampleInfo {\n  sampledCount?: number;\n  totalCount?: number;\n  logCountLoading: boolean;\n  // Set this to the max number of logs that our system can fetch.\n  // If the evaluation result count hits this number, we will show a warning indicator to the user.\n  maxAllowedCount?: number;\n}\n\n// TODO: Add an error boundary to the OSS trace table\nexport const GenAiTracesTable = GenAiTracesTableImpl;\n","import type { QueryFunctionContext } from '@databricks/web-shared/query-client';\nimport { useQuery } from '@databricks/web-shared/query-client';\n\nimport { getAjaxUrl, makeRequest } from '../utils/FetchUtils';\n\ntype UseExperimentRunsForTraceComparisonQueryKey = ['EXPERIMENT_RUNS_FOR_TRACE_COMPARISON', { experimentId: string }];\n\nconst getQueryKey = (experimentId: string): UseExperimentRunsForTraceComparisonQueryKey => [\n  'EXPERIMENT_RUNS_FOR_TRACE_COMPARISON',\n  { experimentId },\n];\n\ntype RawSearchRunsResponse = {\n  runs: {\n    info?: {\n      run_uuid?: string;\n      run_name?: string;\n    };\n  }[];\n};\n\nconst queryFn = async ({\n  queryKey: [, { experimentId }],\n}: QueryFunctionContext<UseExperimentRunsForTraceComparisonQueryKey>): Promise<RawSearchRunsResponse> => {\n  const url = getAjaxUrl('ajax-api/2.0/mlflow/runs/search');\n  return makeRequest(url, 'POST', {\n    experiment_ids: [experimentId],\n  });\n};\n\n/**\n * Fetches the runs for the given experiment, used for the \"compare to\" dropdown in the eval page.\n */\nexport const useGenAiExperimentRunsForComparison = (experimentId: string, disabled = false) => {\n  const { data, error, isLoading, isFetching } = useQuery<\n    RawSearchRunsResponse,\n    Error,\n    RawSearchRunsResponse,\n    UseExperimentRunsForTraceComparisonQueryKey\n  >(getQueryKey(experimentId), {\n    queryFn,\n    enabled: !disabled,\n    cacheTime: Infinity,\n    staleTime: Infinity,\n  });\n\n  const runInfos = data?.runs?.map((run) => ({\n    runUuid: run.info?.run_uuid,\n    runName: run.info?.run_name,\n  }));\n\n  return {\n    requestError: error,\n    isLoading,\n    isFetching,\n    runInfos,\n  };\n};\n","import { useMemo } from 'react';\n\nimport type { QueryFunctionContext } from '@databricks/web-shared/query-client';\nimport { useQueries } from '@databricks/web-shared/query-client';\n\nimport { GenAiTraceEvaluationArtifactFile } from '../enum';\nimport type {\n  EvaluationArtifactTableEntryAssessment,\n  EvaluationArtifactTableEntryEvaluation,\n  EvaluationArtifactTableEntryMetric,\n  RawGenaiEvaluationArtifactResponse,\n} from '../types';\nimport { mergeMetricsAndAssessmentsWithEvaluations, parseRawTableArtifact } from '../utils/EvaluationDataParseUtils';\nimport { getAjaxUrl, makeRequest } from '../utils/FetchUtils';\n\ntype UseGetTraceEvaluationArtifactQueryKey = [\n  'GET_TRACE_EVALUATION_ARTIFACT',\n  { runUuid: string; artifactFile: GenAiTraceEvaluationArtifactFile },\n];\n\nconst getQueryKey = (\n  runUuid: string,\n  artifactFile: GenAiTraceEvaluationArtifactFile,\n): UseGetTraceEvaluationArtifactQueryKey => ['GET_TRACE_EVALUATION_ARTIFACT', { runUuid, artifactFile }];\n\nconst queryFn = async ({\n  queryKey: [, { runUuid, artifactFile }],\n}: QueryFunctionContext<UseGetTraceEvaluationArtifactQueryKey>): Promise<RawGenaiEvaluationArtifactResponse> => {\n  const queryParams = new URLSearchParams({ run_uuid: runUuid, path: artifactFile });\n  const url = [getAjaxUrl('ajax-api/2.0/mlflow/get-artifact'), queryParams].join('?');\n  return makeRequest(url, 'GET').then((data) => ({\n    ...data,\n    filename: artifactFile,\n  }));\n};\n\nconst allArtifactFiles = [\n  GenAiTraceEvaluationArtifactFile.Assessments,\n  GenAiTraceEvaluationArtifactFile.Evaluations,\n  GenAiTraceEvaluationArtifactFile.Metrics,\n];\n\n/**\n * Fetches evaluation trace artifacts for a given run.\n * @param runUuid - The run UUID for which to fetch evaluation artifacts.\n * @param artifacts - The list of artifact files to fetch. By default, all artifacts are fetched.\n */\nexport const useGenAiTraceEvaluationArtifacts = (\n  { runUuid, artifacts = allArtifactFiles }: { runUuid: string; artifacts?: GenAiTraceEvaluationArtifactFile[] },\n  { disabled = false }: { disabled?: boolean } = {},\n) => {\n  const isAnyArtifactRetrievalEnabled =\n    !disabled && allArtifactFiles.some((artifactFile) => artifacts.includes(artifactFile));\n\n  const queriesResult = useQueries({\n    queries: allArtifactFiles.map((artifactFile) => ({\n      queryFn,\n      queryKey: getQueryKey(runUuid, artifactFile),\n      enabled: !disabled && artifacts.includes(artifactFile),\n      refetchOnWindowFocus: false,\n    })),\n  });\n\n  const isLoading = queriesResult.some((query) => query.isLoading);\n  const isFetching = queriesResult.some((query) => query.isFetching);\n  const error = queriesResult.find((query) => query.error);\n\n  const [assessments, evaluations, metrics] = queriesResult.map((query) => query.data);\n\n  const parsedAssessments = useMemo(\n    () => parseRawTableArtifact<EvaluationArtifactTableEntryAssessment[]>(assessments),\n    [assessments],\n  );\n  const parsedEvaluations = useMemo(\n    () => parseRawTableArtifact<EvaluationArtifactTableEntryEvaluation[]>(evaluations),\n    [evaluations],\n  );\n  const parsedMetrics = useMemo(() => parseRawTableArtifact<EvaluationArtifactTableEntryMetric[]>(metrics), [metrics]);\n\n  const mergedData = useMemo(() => {\n    if (!parsedEvaluations) {\n      return undefined;\n    }\n    return mergeMetricsAndAssessmentsWithEvaluations(parsedEvaluations, parsedMetrics, parsedAssessments);\n  }, [parsedAssessments, parsedEvaluations, parsedMetrics]);\n\n  return {\n    requestError: error,\n    isLoading: isLoading && isAnyArtifactRetrievalEnabled,\n    isFetching: isFetching && isAnyArtifactRetrievalEnabled,\n    data: mergedData,\n  };\n};\n","import { isNil } from 'lodash';\nimport { useMemo } from 'react';\n\nimport { useIntl } from '@databricks/i18n';\nimport type { NetworkRequestError } from '@databricks/web-shared/errors';\nimport { matchPredefinedErrorFromResponse } from '@databricks/web-shared/errors';\nimport type { QueryClient, UseQueryOptions, UseQueryResult } from '@databricks/web-shared/query-client';\nimport { useQuery } from '@databricks/web-shared/query-client';\n\nimport { useGenAiTraceEvaluationArtifacts } from './useGenAiTraceEvaluationArtifacts';\nimport {\n  EXECUTION_DURATION_COLUMN_ID,\n  REQUEST_TIME_COLUMN_ID,\n  RUN_NAME_COLUMN_ID,\n  STATE_COLUMN_ID,\n  USER_COLUMN_ID,\n  LOGGED_MODEL_COLUMN_ID,\n  TRACE_NAME_COLUMN_ID,\n  SOURCE_COLUMN_ID,\n  useTableColumns,\n  CUSTOM_METADATA_COLUMN_ID,\n} from './useTableColumns';\nimport { SourceCellRenderer } from '../cellRenderers/Source/SourceRenderer';\nimport type { GenAiTraceEvaluationArtifactFile } from '../enum';\nimport { TracesTableColumnGroup } from '../types';\nimport type {\n  TableFilterOption,\n  EvaluationsOverviewTableSort,\n  AssessmentFilter,\n  RunEvaluationTracesDataEntry,\n  TableFilter,\n  TraceInfoV3,\n  TableFilterOptions,\n} from '../types';\nimport { getAssessmentInfos } from '../utils/AggregationUtils';\nimport { filterEvaluationResults } from '../utils/EvaluationsFilterUtils';\nimport {\n  shouldEnableUnifiedEvalTab,\n  shouldUseRunIdFilterInSearchTraces,\n  getMlflowTracesSearchPageSize,\n  getEvalTabTotalTracesLimit,\n} from '../utils/FeatureUtils';\nimport { fetchFn, getAjaxUrl } from '../utils/FetchUtils';\nimport MlflowUtils from '../utils/MlflowUtils';\nimport { convertTraceInfoV3ToRunEvalEntry, getCustomMetadataKeyFromColumnId } from '../utils/TraceUtils';\n\ninterface SearchMlflowTracesRequest {\n  locations?: SearchMlflowLocations[];\n  filter?: string;\n  max_results: number;\n  page_token?: string;\n  order_by?: string[];\n  model_id?: string;\n  sql_warehouse_id?: string;\n}\n\ninterface SearchMlflowLocations {\n  type: 'MLFLOW_EXPERIMENT';\n  mlflow_experiment: {\n    experiment_id: string;\n  };\n}\n\nexport const SEARCH_MLFLOW_TRACES_QUERY_KEY = 'searchMlflowTraces';\n\nexport const invalidateMlflowSearchTracesCache = ({ queryClient }: { queryClient: QueryClient }) => {\n  queryClient.invalidateQueries({ queryKey: [SEARCH_MLFLOW_TRACES_QUERY_KEY] });\n};\n\nexport const useMlflowTracesTableMetadata = ({\n  experimentId,\n  runUuid,\n  timeRange,\n  otherRunUuid,\n  filterByLoggedModelId,\n  loggedModelId,\n  sqlWarehouseId,\n  disabled,\n  networkFilters,\n}: {\n  experimentId: string;\n  runUuid?: string;\n  timeRange?: { startTime?: string; endTime?: string };\n  otherRunUuid?: string;\n  /**\n   * Logged model ID to filter offline traces by. Uses trace's request metadata for filtering.\n   * To fetch online traces related to a certain logged model, use \"loggedModelId\" field.\n   * N/B: request fields for fetching online and offline traces will be unified in the near future.\n   */\n  filterByLoggedModelId?: string;\n  /**\n   * Used to request online traces by logged model ID.\n   * If provided, sqlWarehouseId is required in order to query inference tables.\n   * N/B: request fields for fetching online and offline traces will be unified in the near future.\n   */\n  loggedModelId?: string;\n  sqlWarehouseId?: string;\n  disabled?: boolean;\n  networkFilters?: TableFilter[];\n}) => {\n  const intl = useIntl();\n  const filter = createMlflowSearchFilter(runUuid, timeRange, networkFilters, filterByLoggedModelId);\n  const {\n    data: traces,\n    isLoading: isInnerLoading,\n    error,\n  } = useSearchMlflowTracesInner({\n    locations: [{ mlflow_experiment: { experiment_id: experimentId ?? '' }, type: 'MLFLOW_EXPERIMENT' }],\n    filter,\n    loggedModelId,\n    sqlWarehouseId,\n    enabled: !disabled,\n  });\n\n  const otherFilter = createMlflowSearchFilter(otherRunUuid, timeRange);\n  const {\n    data: otherTraces,\n    isLoading: isOtherInnerLoading,\n    error: otherError,\n  } = useSearchMlflowTracesInner({\n    locations: [{ mlflow_experiment: { experiment_id: experimentId ?? '' }, type: 'MLFLOW_EXPERIMENT' }],\n    filter: otherFilter,\n    enabled: !disabled && Boolean(otherRunUuid),\n    loggedModelId,\n    sqlWarehouseId,\n  });\n\n  const evaluatedTraces = useMemo(() => {\n    if (!traces || isInnerLoading || error || !traces.length) {\n      return [];\n    }\n    return traces.map((trace) => convertTraceInfoV3ToRunEvalEntry(trace));\n  }, [traces, isInnerLoading, error]);\n\n  const otherEvaluatedTraces = useMemo(() => {\n    const isOtherLoading = isOtherInnerLoading && Boolean(otherRunUuid);\n    if (!otherTraces || isOtherLoading || otherError || !otherTraces.length) {\n      return [];\n    }\n    return otherTraces.map((trace) => convertTraceInfoV3ToRunEvalEntry(trace));\n  }, [otherTraces, isOtherInnerLoading, otherError, otherRunUuid]);\n\n  const assessmentInfos = useMemo(() => {\n    return getAssessmentInfos(intl, evaluatedTraces || [], otherEvaluatedTraces || []);\n  }, [intl, evaluatedTraces, otherEvaluatedTraces]);\n\n  const tableFilterOptions = useMemo(() => {\n    // Add source options\n    const sourceMap = new Map<string, TableFilterOption>();\n    traces?.forEach((trace) => {\n      const traceMetadata = trace.trace_metadata;\n      if (traceMetadata) {\n        const sourceName = traceMetadata[MlflowUtils.sourceNameTag];\n        if (sourceName && !sourceMap.has(sourceName)) {\n          sourceMap.set(sourceName, {\n            value: sourceName,\n            renderValue: () => <SourceCellRenderer traceInfo={trace} isComparing={false} disableLinks />,\n          });\n        }\n      }\n    });\n\n    return {\n      source: Array.from(sourceMap.values()).sort((a, b) => a.value.localeCompare(b.value)),\n    } as TableFilterOptions;\n  }, [traces]);\n\n  const allColumns = useTableColumns(intl, evaluatedTraces || [], assessmentInfos, runUuid, undefined, true);\n\n  return useMemo(() => {\n    return {\n      assessmentInfos,\n      allColumns,\n      totalCount: evaluatedTraces.length,\n      isLoading: isInnerLoading && !disabled,\n      error,\n      isEmpty: evaluatedTraces.length === 0,\n      tableFilterOptions,\n    };\n  }, [assessmentInfos, allColumns, isInnerLoading, error, evaluatedTraces.length, tableFilterOptions, disabled]);\n};\n\nconst getNetworkAndClientFilters = (\n  filters: TableFilter[],\n): {\n  networkFilters: TableFilter[];\n  clientFilters: TableFilter[];\n} => {\n  return filters.reduce<{\n    networkFilters: TableFilter[];\n    clientFilters: TableFilter[];\n  }>(\n    (acc, filter) => {\n      // MLflow search api does not support assessment filters, so we need to pass them as client filters\n      if (filter.column === TracesTableColumnGroup.ASSESSMENT) {\n        acc.clientFilters.push(filter);\n      } else {\n        acc.networkFilters.push(filter);\n      }\n      return acc;\n    },\n    { networkFilters: [], clientFilters: [] },\n  );\n};\n\nexport const useSearchMlflowTraces = ({\n  experimentId,\n  currentRunDisplayName,\n  runUuid,\n  timeRange,\n  searchQuery,\n  filters,\n  disabled,\n  pageSize,\n  limit,\n  filterByLoggedModelId,\n  tableSort,\n  loggedModelId,\n  sqlWarehouseId,\n}: {\n  experimentId: string;\n  runUuid?: string | null;\n  timeRange?: { startTime?: string; endTime?: string };\n  searchQuery?: string;\n  filters?: TableFilter[];\n  disabled?: boolean;\n  pageSize?: number;\n  limit?: number;\n  // TODO: Remove these once mlflow apis support filtering\n  currentRunDisplayName?: string;\n  /**\n   * Logged model ID to filter offline traces by. Uses trace's request metadata for filtering.\n   * To fetch online traces related to a certain logged model, use \"loggedModelId\" field.\n   * N/B: request fields for fetching online and offline traces will be unified in the near future.\n   */\n  filterByLoggedModelId?: string;\n  /**\n   * Used to request online traces by logged model ID.\n   * If provided, sqlWarehouseId is required in order to query inference tables.\n   * N/B: request fields for fetching online and offline traces will be unified in the near future.\n   */\n  loggedModelId?: string;\n  sqlWarehouseId?: string;\n  tableSort?: EvaluationsOverviewTableSort;\n}): {\n  data: TraceInfoV3[] | undefined;\n  isLoading: boolean;\n  isFetching: boolean;\n  error?: NetworkRequestError;\n  refetchMlflowTraces?: UseQueryResult<TraceInfoV3[], NetworkRequestError>['refetch'];\n} => {\n  const { networkFilters, clientFilters } = getNetworkAndClientFilters(filters || []);\n\n  const filter = createMlflowSearchFilter(runUuid, timeRange, networkFilters, filterByLoggedModelId);\n  const orderBy = createMlflowSearchOrderBy(tableSort);\n\n  const {\n    data: traces,\n    isLoading: isInnerLoading,\n    isFetching: isInnerFetching,\n    error,\n    refetch: refetchMlflowTraces,\n  } = useSearchMlflowTracesInner({\n    locations: [{ mlflow_experiment: { experiment_id: experimentId ?? '' }, type: 'MLFLOW_EXPERIMENT' }],\n    filter,\n    enabled: !disabled,\n    pageSize,\n    limit,\n    orderBy,\n    loggedModelId,\n    sqlWarehouseId,\n  });\n\n  // TODO: Remove this once mlflow apis support filtering\n  const evalTraceComparisonEntries = useMemo(() => {\n    if (!traces) {\n      return undefined;\n    }\n\n    return traces.map((trace) => {\n      return {\n        currentRunValue: convertTraceInfoV3ToRunEvalEntry(trace),\n        otherRunValue: undefined,\n      };\n    });\n  }, [traces]);\n\n  // TODO: Remove this once mlflow apis support filtering\n  const filteredTraces: TraceInfoV3[] | undefined = useMemo(() => {\n    if (!evalTraceComparisonEntries) return undefined;\n\n    if (!currentRunDisplayName || (searchQuery === '' && clientFilters?.length === 0)) {\n      return evalTraceComparisonEntries.reduce<TraceInfoV3[]>((acc, entry) => {\n        if (entry.currentRunValue?.traceInfo) {\n          acc.push(entry.currentRunValue.traceInfo);\n        }\n        return acc;\n      }, []);\n    }\n\n    const assessmentFilters: AssessmentFilter[] = clientFilters.map((filter) => {\n      return {\n        assessmentName: filter.key || '',\n        filterValue: filter.value,\n        run: currentRunDisplayName,\n      };\n    });\n\n    const res = filterEvaluationResults(\n      evalTraceComparisonEntries,\n      assessmentFilters || [],\n      searchQuery,\n      currentRunDisplayName,\n      undefined,\n    ).reduce<TraceInfoV3[]>((acc, entry) => {\n      if (entry.currentRunValue?.traceInfo) {\n        acc.push(entry.currentRunValue.traceInfo);\n      }\n      return acc;\n    }, []);\n\n    return res;\n  }, [evalTraceComparisonEntries, clientFilters, searchQuery, currentRunDisplayName]);\n\n  if (disabled) {\n    return {\n      data: [],\n      isLoading: false,\n      isFetching: false,\n    };\n  }\n\n  return {\n    data: filteredTraces,\n    isLoading: isInnerLoading,\n    isFetching: isInnerFetching,\n    error: error || undefined,\n    refetchMlflowTraces,\n  };\n};\n\n/**\n * Fetches all mlflow traces for a given location/filter in a synchronous loop.\n * The results of all the traces are cached under a single key.\n * TODO: De-dup with useSearchMlflowTraces defined in webapp/web/js/genai\n */\nconst useSearchMlflowTracesInner = ({\n  locations,\n  filter,\n  pageSize: pageSizeProp,\n  limit: limitProp,\n  orderBy,\n  loggedModelId,\n  sqlWarehouseId,\n  enabled,\n  ...rest\n}: {\n  locations?: SearchMlflowLocations[];\n  filter?: string;\n  pageSize?: number;\n  limit?: number;\n  orderBy?: string[];\n  loggedModelId?: string;\n  sqlWarehouseId?: string;\n} & Omit<UseQueryOptions<TraceInfoV3[], NetworkRequestError>, 'queryFn'>) => {\n  return useQuery<TraceInfoV3[], NetworkRequestError>({\n    staleTime: Infinity,\n    cacheTime: Infinity,\n    enabled,\n    queryKey: [\n      SEARCH_MLFLOW_TRACES_QUERY_KEY,\n      {\n        experimentIds: (locations || []).map((x) => x.mlflow_experiment?.experiment_id),\n        filter,\n        orderBy,\n        loggedModelId,\n        sqlWarehouseId,\n      },\n    ],\n    queryFn: async ({ signal }) => {\n      let allTraces: TraceInfoV3[] = [];\n      let pageToken: string | undefined = undefined;\n\n      const pageSize = pageSizeProp || getMlflowTracesSearchPageSize();\n      const tracesLimit = limitProp || getEvalTabTotalTracesLimit();\n\n      while (allTraces.length < tracesLimit) {\n        const payload: SearchMlflowTracesRequest = {\n          locations,\n          filter,\n          max_results: pageSize,\n          order_by: orderBy,\n        };\n        if (loggedModelId && sqlWarehouseId) {\n          payload.model_id = loggedModelId;\n          payload.sql_warehouse_id = sqlWarehouseId;\n        }\n        if (pageToken) {\n          payload.page_token = pageToken;\n        }\n        const queryResponse = await fetchFn(getAjaxUrl('ajax-api/3.0/mlflow/traces/search'), {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify(payload),\n          signal,\n        });\n        if (!queryResponse.ok) throw matchPredefinedErrorFromResponse(queryResponse);\n        const json = (await queryResponse.json()) as { traces: TraceInfoV3[]; next_page_token?: string };\n        const traces = json.traces;\n        if (!isNil(traces)) {\n          allTraces = allTraces.concat(traces);\n        }\n\n        // If there's no next page, break out of the loop.\n        pageToken = json.next_page_token;\n        if (!pageToken) break;\n      }\n      return allTraces;\n    },\n    ...rest,\n  });\n};\n\n/**\n * Builds evaluation trace entries from search results if no artifact data is present.\n * Falls back to provided artifactData when available or on error.\n *\n * @param artifactData - Existing evaluation trace entries from artifacts.\n * @param searchRes - Query result containing TraceInfoV3 entries.\n * @returns A list of RunEvaluationTracesDataEntry either from artifactData or initialized from search results. Also\n * returns shouldUseTraceV3 indicating if we are using artifacts or trace v3 results from search\n */\nconst buildTracesFromSearchAndArtifacts = (\n  artifactData: RunEvaluationTracesDataEntry[],\n  searchRes: UseQueryResult<TraceInfoV3[], NetworkRequestError>,\n): {\n  data: RunEvaluationTracesDataEntry[];\n  shouldUseTraceV3: boolean;\n  error?: NetworkRequestError;\n} => {\n  const { data: searchData, error } = searchRes;\n\n  if (artifactData.length > 0 || error || !searchData || searchData.length === 0) {\n    return { data: artifactData, shouldUseTraceV3: false, error: error || undefined };\n  }\n\n  // We want to start using information from TraceInfoV3 downstream rather\n  // than RunEvaluationTracesDataEntry, so fill in all properties as empty\n  // except for traceInfo.\n  return {\n    data: searchData\n      .filter((trace): trace is TraceInfoV3 => trace !== null && trace !== undefined)\n      .map((trace) => {\n        return {\n          evaluationId: '',\n          requestId: '',\n          inputs: {},\n          inputsId: '',\n          outputs: {},\n          targets: {},\n          overallAssessments: [],\n          responseAssessmentsByName: {},\n          metrics: {},\n          traceInfo: trace,\n        };\n      }),\n    shouldUseTraceV3: true,\n  };\n};\n\nconst createMlflowSearchFilter = (\n  runUuid: string | null | undefined,\n  timeRange?: { startTime?: string; endTime?: string } | null,\n  networkFilters?: TableFilter[],\n  loggedModelId?: string,\n) => {\n  const filter: string[] = [];\n  const useRunIdInSearchTraces = shouldUseRunIdFilterInSearchTraces();\n  if (runUuid) {\n    if (useRunIdInSearchTraces) {\n      filter.push(`attributes.run_id = '${runUuid}'`);\n    } else {\n      filter.push(`request_metadata.\"mlflow.sourceRun\" = '${runUuid}'`);\n    }\n  }\n  if (timeRange) {\n    const timestampField = 'attributes.timestamp_ms';\n    if (timeRange.startTime) {\n      filter.push(`${timestampField} > ${timeRange.startTime}`);\n    }\n    if (timeRange.endTime) {\n      filter.push(`${timestampField} < ${timeRange.endTime}`);\n    }\n  }\n  if (loggedModelId) {\n    filter.push(`request_metadata.\"mlflow.modelId\" = '${loggedModelId}'`);\n  }\n  if (networkFilters) {\n    networkFilters.forEach((networkFilter) => {\n      switch (networkFilter.column) {\n        case TracesTableColumnGroup.TAG:\n          if (networkFilter.key) {\n            const tagField = 'tags';\n            // Use backticks for field names with special characters\n            const fieldName =\n              networkFilter.key.includes('.') || networkFilter.key.includes(' ')\n                ? `${tagField}.\\`${networkFilter.key}\\``\n                : `${tagField}.${networkFilter.key}`;\n            filter.push(`${fieldName} ${networkFilter.operator} '${networkFilter.value}'`);\n          }\n          break;\n        case EXECUTION_DURATION_COLUMN_ID:\n          const executionField = 'attributes.execution_time_ms';\n          filter.push(`${executionField} ${networkFilter.operator} ${networkFilter.value}`);\n          break;\n        case STATE_COLUMN_ID:\n          const statusField = 'attributes.status';\n          filter.push(`${statusField} = '${networkFilter.value}'`);\n          break;\n        case USER_COLUMN_ID:\n          filter.push(`request_metadata.\"mlflow.trace.user\" = '${networkFilter.value}'`);\n          break;\n        case RUN_NAME_COLUMN_ID:\n          if (useRunIdInSearchTraces) {\n            filter.push(`attributes.run_id = '${networkFilter.value}'`);\n          } else {\n            filter.push(`request_metadata.\"mlflow.sourceRun\" = '${networkFilter.value}'`);\n          }\n          break;\n        case LOGGED_MODEL_COLUMN_ID:\n          filter.push(`request_metadata.\"mlflow.modelId\" = '${networkFilter.value}'`);\n          break;\n        case TRACE_NAME_COLUMN_ID:\n          filter.push(`attributes.name ${networkFilter.operator} '${networkFilter.value}'`);\n          break;\n        case SOURCE_COLUMN_ID:\n          filter.push(`request_metadata.\"mlflow.source.name\" ${networkFilter.operator} '${networkFilter.value}'`);\n          break;\n        default:\n          if (networkFilter.column.startsWith(CUSTOM_METADATA_COLUMN_ID)) {\n            filter.push(\n              `request_metadata.${getCustomMetadataKeyFromColumnId(networkFilter.column)} ${networkFilter.operator} '${\n                networkFilter.value\n              }'`,\n            );\n          }\n          break;\n      }\n    });\n  }\n\n  if (filter.length > 0) {\n    return filter.join(' AND ');\n  }\n  return undefined;\n};\n\nconst createMlflowSearchOrderBy = (tableSort?: EvaluationsOverviewTableSort): string[] | undefined => {\n  if (!tableSort) {\n    return undefined;\n  }\n\n  // Currently the server only supports sorting by execution time and request time. Should add\n  // more columns as they are supported by the server.\n  switch (tableSort.key) {\n    case EXECUTION_DURATION_COLUMN_ID:\n      return [`execution_time ${tableSort.asc ? 'ASC' : 'DESC'}`];\n    case REQUEST_TIME_COLUMN_ID:\n      return [`timestamp ${tableSort.asc ? 'ASC' : 'DESC'}`];\n    default:\n      return [];\n  }\n};\n\n/**\n * Fetches all mlflow traces for a given experiment id and run id.\n * It returns the traces from artifacts storage if they exist and uses search API otherwise.\n *\n * @param experimentId - The experiment id to fetch traces for.\n * @param runUuid - The run id to fetch traces for. If not provided, it will fetch traces for the entire experiment.\n * @param traceTablesLoggedInRun - The trace tables logged in run to fetch traces for. Only used for fetching from artifacts storage. If not provided, it will fetch from all artifacts\n * @param disabled - Whether to disable the traces call.\n * @param timeRange - The time range to fetch traces for. Start/End time should be in milliseconds since epoch.\n */\nexport const useMlflowTraces = (\n  experimentId?: string | null,\n  runUuid?: string | null,\n  traceTablesLoggedInRun?: GenAiTraceEvaluationArtifactFile[],\n  disabled?: boolean,\n  timeRange?: {\n    startTime: string | undefined;\n    endTime: string | undefined;\n  },\n): {\n  data: RunEvaluationTracesDataEntry[];\n  isLoading: boolean;\n  refetchMlflowTraces?: () => Promise<any>;\n  shouldUseTraceV3: boolean;\n  error?: NetworkRequestError;\n} => {\n  const isUnifiedEvalTabEnabled = shouldEnableUnifiedEvalTab();\n\n  const isExperimentIdValid = Boolean(experimentId && experimentId.length > 0);\n  const isArtifactCallEnabled = Boolean(!disabled && runUuid);\n  const isTracesCallEnabled = isExperimentIdValid && Boolean(isUnifiedEvalTabEnabled && !disabled);\n\n  const { data: artifactData, isLoading: isArtifactLoading } = useGenAiTraceEvaluationArtifacts(\n    {\n      runUuid: runUuid || '',\n      ...{ artifacts: traceTablesLoggedInRun ? traceTablesLoggedInRun : undefined },\n    },\n    { disabled: !isArtifactCallEnabled },\n  );\n\n  const filter = createMlflowSearchFilter(runUuid, timeRange);\n\n  const searchRes = useSearchMlflowTracesInner({\n    locations: [{ mlflow_experiment: { experiment_id: experimentId ?? '' }, type: 'MLFLOW_EXPERIMENT' }],\n    filter,\n    enabled: isTracesCallEnabled,\n  });\n\n  if (disabled) {\n    return {\n      data: [],\n      isLoading: false,\n      shouldUseTraceV3: false,\n    };\n  }\n\n  if (!isUnifiedEvalTabEnabled) {\n    return {\n      data: artifactData || [],\n      isLoading: isArtifactLoading,\n      shouldUseTraceV3: false,\n    };\n  }\n\n  return {\n    ...buildTracesFromSearchAndArtifacts(artifactData || [], searchRes),\n    isLoading: isArtifactLoading || (searchRes.isLoading && isTracesCallEnabled),\n    refetchMlflowTraces: searchRes.refetch,\n  };\n};\n","import { useMemo, useState } from 'react';\n\nimport {\n  useDesignSystemTheme,\n  DialogComboboxOptionListSelectItem,\n  DialogComboboxOptionListSearch,\n  DialogComboboxContent,\n  DialogComboboxTrigger,\n  DialogComboboxOptionList,\n  DialogCombobox,\n} from '@databricks/design-system';\n\nimport type { TableFilterOption } from '../../types';\n\ninterface SimpleQuery<T> {\n  data?: T;\n  isLoading?: boolean;\n}\n\nexport const TableFilterItemTypeahead = ({\n  id,\n  item,\n  options,\n  query,\n  onChange,\n  placeholder,\n  width,\n  canSearchCustomValue,\n}: {\n  id: string;\n  item?: TableFilterOption;\n  options?: TableFilterOption[];\n  query?: SimpleQuery<TableFilterOption[]>;\n  onChange: (value: string) => void;\n  placeholder: string;\n  width: number;\n  canSearchCustomValue: boolean;\n}) => {\n  const { theme } = useDesignSystemTheme();\n\n  const [searchValue, setSearchValue] = useState<string>('');\n\n  const displayOptions = useMemo(() => query?.data ?? options ?? [], [query?.data, options]);\n  const optionValues = useMemo(() => displayOptions.map((option) => option.value), [displayOptions]);\n\n  return (\n    <DialogCombobox\n      componentId=\"mlflow.evaluations_review.table_ui.filter_column\"\n      value={item?.value ? [item.value] : []}\n      id={id}\n    >\n      <DialogComboboxTrigger\n        withInlineLabel={false}\n        placeholder={placeholder}\n        renderDisplayedValue={() => item?.renderValue() ?? ''}\n        width={width}\n        allowClear={false}\n      />\n      <DialogComboboxContent\n        width={width}\n        style={{ zIndex: theme.options.zIndexBase + 100 }}\n        loading={query?.isLoading}\n      >\n        <DialogComboboxOptionList>\n          <DialogComboboxOptionListSearch onSearch={(value: string) => setSearchValue(value)}>\n            {displayOptions.map((option) => (\n              <DialogComboboxOptionListSelectItem\n                key={option.value}\n                value={option.value}\n                onChange={onChange}\n                checked={option.value === item?.value}\n                css={{\n                  whiteSpace: 'nowrap',\n                  overflow: 'hidden',\n                  textOverflow: 'ellipsis',\n                }}\n              >\n                {option.renderValue()}\n              </DialogComboboxOptionListSelectItem>\n            ))}\n            {/* Currently there's no use case for searching custom values. Eventually we might need it\n                  for tags. */}\n            {canSearchCustomValue && searchValue && !optionValues.includes(searchValue) ? (\n              <DialogComboboxOptionListSelectItem\n                key={searchValue}\n                value={searchValue}\n                onChange={onChange}\n                checked={searchValue === item?.value}\n                css={{\n                  whiteSpace: 'nowrap',\n                  overflow: 'hidden',\n                  textOverflow: 'ellipsis',\n                }}\n              >\n                Use \"{searchValue}\"\n              </DialogComboboxOptionListSelectItem>\n            ) : null}\n          </DialogComboboxOptionListSearch>\n        </DialogComboboxOptionList>\n      </DialogComboboxContent>\n    </DialogCombobox>\n  );\n};\n","import { useCallback, useState, useMemo } from 'react';\n\nimport { useDesignSystemTheme, Input } from '@databricks/design-system';\nimport { useIntl } from '@databricks/i18n';\n\nimport { TableFilterItemTypeahead } from './TableFilterItemTypeahead';\nimport { ExperimentViewTracesStatusLabels } from '../../cellRenderers/StatusRenderer';\nimport {\n  assessmentValueToSerializedString,\n  serializedStringToAssessmentValueV2,\n} from '../../hooks/useAssessmentFilters';\nimport { useExperimentVersionsQuery } from '../../hooks/useExperimentVersionsQuery';\nimport { useGenAiExperimentRunsForComparison } from '../../hooks/useGenAiExperimentRunsForComparison';\nimport {\n  EXECUTION_DURATION_COLUMN_ID,\n  STATE_COLUMN_ID,\n  RUN_NAME_COLUMN_ID,\n  LOGGED_MODEL_COLUMN_ID,\n  SOURCE_COLUMN_ID,\n} from '../../hooks/useTableColumns';\nimport { TracesTableColumnGroup } from '../../types';\nimport type { AssessmentInfo, TableFilter, TableFilterOption, TableFilterOptions } from '../../types';\nimport { getAssessmentValueLabel } from '../GenAiEvaluationTracesReview.utils';\n\nexport const TableFilterItemValueInput = ({\n  index,\n  tableFilter,\n  assessmentInfos,\n  onChange,\n  experimentId,\n  tableFilterOptions,\n}: {\n  index: number;\n  tableFilter: TableFilter;\n  assessmentInfos: AssessmentInfo[];\n  onChange: (tableFilter: TableFilter, index: number) => void;\n  experimentId: string;\n  tableFilterOptions: TableFilterOptions;\n}) => {\n  const intl = useIntl();\n  const { theme } = useDesignSystemTheme();\n\n  const id = `filter-value-${index}`;\n\n  const [localValue, setLocalValue] = useState(tableFilter.value);\n\n  const onValueBlur = useCallback(() => {\n    if (localValue !== tableFilter.value) {\n      onChange({ ...tableFilter, value: localValue }, index);\n    }\n  }, [tableFilter, index, onChange, localValue]);\n\n  // Fetch runs data when the run name column is selected\n  const runsQuery = useGenAiExperimentRunsForComparison(experimentId);\n\n  // Transform runs data into the format expected by TableFilterItemTypeahead\n  const runNameQuery = useMemo(() => {\n    const transformedData = runsQuery.runInfos\n      ?.filter((run) => run.runUuid && run.runName)\n      ?.map((run) => ({\n        value: run.runUuid as string,\n        renderValue: () => run.runName as string,\n      }));\n\n    return {\n      data: transformedData,\n      isLoading: runsQuery.isLoading,\n    };\n  }, [runsQuery]);\n\n  // Fetch versions data when the version column is selected\n  const versionsDataQuery = useExperimentVersionsQuery(experimentId);\n\n  // Transform versions data into the format expected by TableFilterItemTypeahead\n  const versionsQuery = useMemo(() => {\n    const transformedData = versionsDataQuery.data?.map((loggedModel) => ({\n      value: loggedModel.info.model_id,\n      renderValue: () => loggedModel.info.name,\n    }));\n\n    return {\n      data: transformedData,\n      isLoading: versionsDataQuery.isLoading,\n    };\n  }, [versionsDataQuery]);\n\n  const stateOptions: TableFilterOption[] = [\n    { value: 'IN_PROGRESS', renderValue: () => intl.formatMessage(ExperimentViewTracesStatusLabels.IN_PROGRESS) },\n    { value: 'OK', renderValue: () => intl.formatMessage(ExperimentViewTracesStatusLabels.OK) },\n    { value: 'ERROR', renderValue: () => intl.formatMessage(ExperimentViewTracesStatusLabels.ERROR) },\n  ];\n\n  if (tableFilter.column === RUN_NAME_COLUMN_ID) {\n    return (\n      <TableFilterItemTypeahead\n        id={id}\n        item={runNameQuery.data?.find((item) => item.value === tableFilter.value)}\n        query={runNameQuery}\n        onChange={(value: string) => {\n          onChange({ ...tableFilter, value }, index);\n        }}\n        placeholder=\"Select run\"\n        width={200}\n        canSearchCustomValue={false}\n      />\n    );\n  }\n\n  if (tableFilter.column === LOGGED_MODEL_COLUMN_ID) {\n    return (\n      <TableFilterItemTypeahead\n        id={id}\n        item={versionsQuery.data?.find((item) => item.value === tableFilter.value)}\n        query={versionsQuery}\n        onChange={(value: string) => {\n          onChange({ ...tableFilter, value }, index);\n        }}\n        placeholder=\"Select version\"\n        width={200}\n        canSearchCustomValue={false}\n      />\n    );\n  }\n\n  if (tableFilter.column === TracesTableColumnGroup.ASSESSMENT) {\n    const assessmentInfo = assessmentInfos.find((assessment) => assessment.name === tableFilter.key);\n    if (assessmentInfo && assessmentInfo.dtype !== 'numeric' && assessmentInfo.dtype !== 'unknown') {\n      const options: TableFilterOption[] = Array.from(assessmentInfo.uniqueValues.values()).map((value) => {\n        return {\n          value: assessmentValueToSerializedString(value),\n          renderValue: () => getAssessmentValueLabel(intl, theme, assessmentInfo, value).content,\n        };\n      });\n\n      return (\n        <TableFilterItemTypeahead\n          id={id}\n          item={options.find((item) => item.value === assessmentValueToSerializedString(tableFilter.value))}\n          options={options}\n          onChange={(value: string) => {\n            onChange({ ...tableFilter, value: serializedStringToAssessmentValueV2(value) }, index);\n          }}\n          placeholder=\"Select\"\n          width={200}\n          canSearchCustomValue={false}\n        />\n      );\n    }\n  }\n\n  if (tableFilter.column === STATE_COLUMN_ID) {\n    return (\n      <TableFilterItemTypeahead\n        id={id}\n        item={stateOptions.find((item) => item.value === tableFilter.value)}\n        options={stateOptions}\n        onChange={(value: string) => {\n          onChange({ ...tableFilter, value }, index);\n        }}\n        placeholder=\"Select\"\n        width={200}\n        canSearchCustomValue={false}\n      />\n    );\n  }\n\n  if (tableFilter.column === SOURCE_COLUMN_ID) {\n    const sourceOptions = tableFilterOptions.source;\n    return (\n      <TableFilterItemTypeahead\n        id={id}\n        item={sourceOptions.find((item) => item.value === tableFilter.value)}\n        options={sourceOptions}\n        onChange={(value: string) => {\n          onChange({ ...tableFilter, value }, index);\n        }}\n        placeholder=\"Select source\"\n        width={200}\n        canSearchCustomValue={false}\n      />\n    );\n  }\n\n  return (\n    <Input\n      aria-label=\"Value\"\n      componentId=\"mlflow.evaluations_review.table_ui.filter_value\"\n      id={id}\n      placeholder={tableFilter.column === EXECUTION_DURATION_COLUMN_ID ? 'Time in milliseconds' : 'Value'}\n      type={tableFilter.column === EXECUTION_DURATION_COLUMN_ID ? 'number' : 'text'}\n      value={localValue as string}\n      onChange={(e) => {\n        setLocalValue(e.target.value);\n      }}\n      onBlur={onValueBlur}\n      css={{ width: 200 }}\n      // Disable it for assessment column at this point, since the data type is not supported yet.\n      disabled={tableFilter.column === TracesTableColumnGroup.ASSESSMENT}\n    />\n  );\n};\n","import { useQuery } from '@databricks/web-shared/query-client';\n\nimport { getAjaxUrl, makeRequest } from '../utils/FetchUtils';\n\ninterface LoggedModel {\n  info: {\n    model_id: string;\n    experiment_id: string;\n    name: string;\n    creation_timestamp_ms?: number;\n    last_updated_timestamp_ms?: number;\n    artifact_uri?: string;\n    status?: string;\n    creator_id?: number;\n    tags?: Array<{\n      key: string;\n      value: string;\n    }>;\n  };\n  data: any;\n}\n\ninterface UseExperimentVersionsQueryResponseType {\n  models: LoggedModel[];\n  next_page_token?: string;\n}\n\nexport const useExperimentVersionsQuery = (\n  experimentId: string,\n  disabled = false,\n): {\n  data: LoggedModel[] | undefined;\n  isLoading: boolean;\n  error?: Error;\n} => {\n  const queryKey = ['EXPERIMENT_MODEL_VERSIONS', experimentId];\n\n  const { data, isLoading, error } = useQuery<UseExperimentVersionsQueryResponseType, Error>({\n    queryKey,\n    queryFn: async () => {\n      // Search for model versions related to this experiment\n      const requestBody = {\n        experiment_ids: [experimentId],\n      };\n\n      return makeRequest(getAjaxUrl('ajax-api/2.0/mlflow/logged-models/search'), 'POST', requestBody);\n    },\n    staleTime: Infinity,\n    cacheTime: Infinity,\n    enabled: !disabled,\n    refetchOnMount: false,\n    retry: false,\n  });\n\n  return {\n    data: data?.models,\n    isLoading,\n    error: error || undefined,\n  };\n};\n","import { useMemo } from 'react';\n\nimport {\n  Button,\n  useDesignSystemTheme,\n  FormUI,\n  SimpleSelect,\n  SimpleSelectOption,\n  CloseSmallIcon,\n  Input,\n} from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport { TableFilterItemTypeahead } from './TableFilterItemTypeahead';\nimport { TableFilterItemValueInput } from './TableFilterItemValueInput';\nimport {\n  EXECUTION_DURATION_COLUMN_ID,\n  STATE_COLUMN_ID,\n  TRACE_NAME_COLUMN_ID,\n  USER_COLUMN_ID,\n  RUN_NAME_COLUMN_ID,\n  LOGGED_MODEL_COLUMN_ID,\n  SOURCE_COLUMN_ID,\n  CUSTOM_METADATA_COLUMN_ID,\n} from '../../hooks/useTableColumns';\nimport { FilterOperator, TracesTableColumnGroup, TracesTableColumnGroupToLabelMap } from '../../types';\nimport type {\n  AssessmentInfo,\n  TableFilter,\n  TableFilterOption,\n  TableFilterOptions,\n  TracesTableColumn,\n} from '../../types';\n\nconst FILTERABLE_INFO_COLUMNS = [\n  EXECUTION_DURATION_COLUMN_ID,\n  STATE_COLUMN_ID,\n  TRACE_NAME_COLUMN_ID,\n  USER_COLUMN_ID,\n  RUN_NAME_COLUMN_ID,\n  LOGGED_MODEL_COLUMN_ID,\n  SOURCE_COLUMN_ID,\n];\n\nexport const TableFilterItem = ({\n  tableFilter,\n  index,\n  onChange,\n  onDelete,\n  assessmentInfos,\n  experimentId,\n  tableFilterOptions,\n  allColumns,\n}: {\n  tableFilter: TableFilter;\n  index: number;\n  onChange: (filter: TableFilter, index: number) => void;\n  onDelete: () => void;\n  assessmentInfos: AssessmentInfo[];\n  experimentId: string;\n  tableFilterOptions: TableFilterOptions;\n  allColumns: TracesTableColumn[];\n}) => {\n  const { column, operator, key } = tableFilter;\n  const { theme } = useDesignSystemTheme();\n\n  // For now, we don't support filtering on numeric values.\n  const assessmentKeyOptions: TableFilterOption[] = useMemo(\n    () =>\n      assessmentInfos\n        .filter((assessment) => assessment.dtype !== 'numeric')\n        .map((assessment) => ({ value: assessment.name, renderValue: () => assessment.displayName })),\n    [assessmentInfos],\n  );\n\n  const columnOptions: TableFilterOption[] = useMemo(() => {\n    const result = allColumns\n      .filter(\n        (column) => FILTERABLE_INFO_COLUMNS.includes(column.id) || column.id.startsWith(CUSTOM_METADATA_COLUMN_ID),\n      )\n      .map((column) => ({ value: column.id, renderValue: () => column.label }));\n\n    // Add the tag and assessment column groups\n    result.push(\n      {\n        value: TracesTableColumnGroup.TAG,\n        renderValue: () => TracesTableColumnGroupToLabelMap[TracesTableColumnGroup.TAG],\n      },\n      {\n        value: TracesTableColumnGroup.ASSESSMENT,\n        renderValue: () => TracesTableColumnGroupToLabelMap[TracesTableColumnGroup.ASSESSMENT],\n      },\n    );\n    return result;\n  }, [allColumns]);\n\n  return (\n    <>\n      <div\n        css={{\n          display: 'flex',\n          flexDirection: 'row',\n          gap: theme.spacing.sm,\n        }}\n      >\n        <div\n          css={{\n            display: 'flex',\n            flexDirection: 'column',\n          }}\n        >\n          <FormUI.Label htmlFor={`filter-column-${index}`}>\n            <FormattedMessage\n              defaultMessage=\"Column\"\n              description=\"Label for the column field in the GenAI Traces Table Filter form\"\n            />\n          </FormUI.Label>\n          <TableFilterItemTypeahead\n            id={`filter-column-${index}`}\n            item={columnOptions.find((item) => item.value === column)}\n            options={columnOptions}\n            onChange={(value: string) => {\n              if (value !== column) {\n                // Clear other fields as well on column change\n                onChange({ column: value, operator: FilterOperator.EQUALS, value: '' }, index);\n              }\n            }}\n            placeholder=\"Select column\"\n            width={160}\n            canSearchCustomValue={false}\n          />\n        </div>\n        {column === TracesTableColumnGroup.ASSESSMENT && (\n          <div\n            css={{\n              display: 'flex',\n              flexDirection: 'column',\n            }}\n          >\n            <FormUI.Label htmlFor={`filter-key-${index}`}>\n              <FormattedMessage\n                defaultMessage=\"Name\"\n                description=\"Label for the name field for assessments in the GenAI Traces Table Filter form\"\n              />\n            </FormUI.Label>\n            <TableFilterItemTypeahead\n              id={`filter-key-${index}`}\n              item={assessmentKeyOptions.find((item) => item.value === key)}\n              options={assessmentKeyOptions}\n              onChange={(value: string) => {\n                onChange({ ...tableFilter, key: value }, index);\n              }}\n              placeholder=\"Select name\"\n              width={200}\n              canSearchCustomValue={false}\n            />\n          </div>\n        )}\n        {column === TracesTableColumnGroup.TAG && (\n          <div\n            css={{\n              display: 'flex',\n              flexDirection: 'column',\n            }}\n          >\n            <FormUI.Label htmlFor={`filter-key-${index}`}>\n              <FormattedMessage\n                defaultMessage=\"Key\"\n                description=\"Label for the key field for tags in the GenAI Traces Table Filter form\"\n              />\n            </FormUI.Label>\n            <Input\n              aria-label=\"Key\"\n              componentId=\"mlflow.evaluations_review.table_ui.filter_key\"\n              id={'filter-key-' + index}\n              type=\"text\"\n              css={{ width: 200 }}\n              placeholder={column === TracesTableColumnGroup.TAG ? 'Key' : 'Name'}\n              value={key}\n              onChange={(e) => {\n                onChange({ ...tableFilter, key: e.target.value }, index);\n              }}\n            />\n          </div>\n        )}\n        <div\n          css={{\n            display: 'flex',\n            flexDirection: 'column',\n          }}\n        >\n          <FormUI.Label htmlFor={`filter-operator-${index}`}>\n            <FormattedMessage\n              defaultMessage=\"Operator\"\n              description=\"Label for the operator field in the GenAI Traces Table Filter form\"\n            />\n          </FormUI.Label>\n          <SimpleSelect\n            aria-label=\"Operator\"\n            componentId=\"mlflow.evaluations_review.table_ui.filter_operator\"\n            id={'filter-operator-' + index}\n            placeholder=\"Select\"\n            width={100}\n            contentProps={{\n              // Set the z-index to be higher than the Popover\n              style: { zIndex: theme.options.zIndexBase + 100 },\n            }}\n            // Currently only executionTime supports other operators\n            value={column === '' || column === EXECUTION_DURATION_COLUMN_ID ? operator : '='}\n            disabled={column !== '' && column !== EXECUTION_DURATION_COLUMN_ID}\n            onChange={(e) => {\n              onChange({ ...tableFilter, operator: e.target.value as FilterOperator }, index);\n            }}\n          >\n            {(Object.values(FilterOperator) as string[]).map((op) => (\n              <SimpleSelectOption key={op} value={op}>\n                {op}\n              </SimpleSelectOption>\n            ))}\n          </SimpleSelect>\n        </div>\n        <div\n          css={{\n            display: 'flex',\n            flexDirection: 'column',\n          }}\n        >\n          <FormUI.Label htmlFor={`filter-value-${index}`}>\n            <FormattedMessage\n              defaultMessage=\"Value\"\n              description=\"Label for the value field in the GenAI Traces Table Filter form\"\n            />\n          </FormUI.Label>\n          <TableFilterItemValueInput\n            index={index}\n            tableFilter={tableFilter}\n            assessmentInfos={assessmentInfos}\n            onChange={onChange}\n            experimentId={experimentId}\n            tableFilterOptions={tableFilterOptions}\n          />\n        </div>\n        <div\n          css={{\n            alignSelf: 'flex-end',\n          }}\n        >\n          <Button\n            componentId=\"mlflow.evaluations_review.table_ui.filter_delete_button\"\n            type=\"tertiary\"\n            icon={<CloseSmallIcon />}\n            onClick={onDelete}\n          />\n        </div>\n      </div>\n    </>\n  );\n};\n","import { useCallback } from 'react';\nimport { FormProvider, useForm } from 'react-hook-form';\n\nimport {\n  Button,\n  ChevronDownIcon,\n  useDesignSystemTheme,\n  FilterIcon,\n  Popover,\n  PlusIcon,\n  XCircleFillIcon,\n  Spinner,\n  DangerIcon,\n} from '@databricks/design-system';\nimport { FormattedMessage, useIntl } from '@databricks/i18n';\n\nimport { TableFilterItem } from './components/filters/TableFilterItem';\nimport { FilterOperator } from './types';\nimport type { AssessmentInfo, TableFilterFormState, TableFilter, TableFilterOptions, TracesTableColumn } from './types';\nimport { FILTER_DROPDOWN_COMPONENT_ID } from './utils/EvaluationLogging';\n\nexport const GenAiTracesTableFilter = ({\n  filters,\n  setFilters,\n  assessmentInfos,\n  experimentId,\n  tableFilterOptions,\n  allColumns,\n  isMetadataLoading,\n  metadataError,\n}: {\n  filters: TableFilter[];\n  setFilters: (filters: TableFilter[]) => void;\n  assessmentInfos: AssessmentInfo[];\n  experimentId: string;\n  tableFilterOptions: TableFilterOptions;\n  allColumns: TracesTableColumn[];\n  isMetadataLoading?: boolean;\n  metadataError?: Error | null;\n}) => {\n  const intl = useIntl();\n  const { theme } = useDesignSystemTheme();\n\n  const hasActiveFilters = filters.length > 0;\n\n  const clearFilters = useCallback(() => {\n    setFilters([]);\n  }, [setFilters]);\n\n  return (\n    <Popover.Root componentId={FILTER_DROPDOWN_COMPONENT_ID}>\n      <Popover.Trigger asChild>\n        <Button\n          endIcon={<ChevronDownIcon />}\n          componentId=\"mlflow.evaluations_review.table_ui.filter_button\"\n          css={{\n            border: hasActiveFilters ? `1px solid ${theme.colors.actionDefaultBorderFocus} !important` : '',\n            backgroundColor: hasActiveFilters ? `${theme.colors.actionDefaultBackgroundHover} !important` : '',\n          }}\n        >\n          <div\n            css={{\n              display: 'flex',\n              gap: theme.spacing.sm,\n              alignItems: 'center',\n            }}\n          >\n            <FilterIcon />\n            {intl.formatMessage(\n              {\n                defaultMessage: 'Filters{numFilters}',\n                description: 'Evaluation review > evaluations list > filter dropdown button',\n              },\n              {\n                numFilters: hasActiveFilters ? ` (${filters.length})` : '',\n              },\n            )}\n            {hasActiveFilters && (\n              <XCircleFillIcon\n                css={{\n                  fontSize: 12,\n                  cursor: 'pointer',\n                  color: theme.colors.grey400,\n                  '&:hover': {\n                    color: theme.colors.grey600,\n                  },\n                }}\n                onClick={() => {\n                  clearFilters();\n                }}\n              />\n            )}\n          </div>\n        </Button>\n      </Popover.Trigger>\n      <Popover.Content align=\"start\" css={{ padding: theme.spacing.md }}>\n        {metadataError ? (\n          <div\n            css={{\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n              gap: theme.spacing.xs,\n              padding: `${theme.spacing.md}px`,\n              color: theme.colors.textValidationDanger,\n            }}\n            data-testid=\"filter-dropdown-error\"\n          >\n            <DangerIcon />\n            <FormattedMessage\n              defaultMessage=\"Fetching traces failed\"\n              description=\"Error message for fetching traces failed\"\n            />\n          </div>\n        ) : isMetadataLoading ? (\n          <div\n            css={{\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n              gap: theme.spacing.xs,\n              padding: `${theme.spacing.md}px`,\n              color: theme.colors.textSecondary,\n            }}\n            data-testid=\"filter-dropdown-loading\"\n          >\n            <Spinner size=\"small\" />\n          </div>\n        ) : (\n          <FilterForm\n            filters={filters}\n            assessmentInfos={assessmentInfos}\n            setFilters={setFilters}\n            experimentId={experimentId}\n            tableFilterOptions={tableFilterOptions}\n            allColumns={allColumns}\n          />\n        )}\n      </Popover.Content>\n    </Popover.Root>\n  );\n};\n\nconst useFilterForm = (filters: TableFilter[]) => {\n  const form = useForm<TableFilterFormState>({\n    defaultValues: {\n      filters: filters.length > 0 ? filters : [{ column: '', operator: FilterOperator.EQUALS, value: '' }],\n    },\n  });\n\n  return form;\n};\n\nconst FilterForm = ({\n  filters,\n  assessmentInfos,\n  setFilters,\n  experimentId,\n  tableFilterOptions,\n  allColumns,\n}: {\n  filters: TableFilter[];\n  assessmentInfos: AssessmentInfo[];\n  setFilters: (filters: TableFilter[]) => void;\n  experimentId: string;\n  tableFilterOptions: TableFilterOptions;\n  allColumns: TracesTableColumn[];\n}) => {\n  const { theme } = useDesignSystemTheme();\n\n  const filterForm = useFilterForm(filters);\n\n  const { setValue, watch } = filterForm;\n\n  const localFilters = watch('filters');\n\n  return (\n    <FormProvider {...filterForm}>\n      <div\n        css={{\n          display: 'flex',\n          flexDirection: 'column',\n          gap: theme.spacing.lg,\n          overflow: 'auto',\n        }}\n      >\n        <div\n          css={{\n            display: 'flex',\n            flexDirection: 'column',\n            gap: theme.spacing.sm,\n          }}\n        >\n          {localFilters.map((filter, index) => (\n            <TableFilterItem\n              key={filter.column + filter.operator + filter.value + index}\n              tableFilter={filter}\n              index={index}\n              onChange={(newFilter) => {\n                localFilters[index] = newFilter;\n                setValue('filters', localFilters);\n              }}\n              onDelete={() => {\n                const newFilters = [...localFilters];\n                newFilters.splice(index, 1);\n                // If there are no filters, add an initial filter\n                if (newFilters.length === 0) {\n                  newFilters.push({ column: '', operator: FilterOperator.EQUALS, value: '' });\n                }\n                setValue('filters', newFilters);\n              }}\n              assessmentInfos={assessmentInfos}\n              experimentId={experimentId}\n              tableFilterOptions={tableFilterOptions}\n              allColumns={allColumns}\n            />\n          ))}\n        </div>\n        <div>\n          <Button\n            componentId=\"mlflow.evaluations_review.table_ui.add_filter_button\"\n            icon={<PlusIcon />}\n            onClick={() => {\n              setValue('filters', [...localFilters, { column: '', operator: FilterOperator.EQUALS, value: '' }]);\n            }}\n          >\n            <FormattedMessage\n              defaultMessage=\"Add filter\"\n              description=\"Button label for adding a filter in the GenAI Traces Table filter form\"\n            />\n          </Button>\n        </div>\n        <div\n          css={{\n            display: 'flex',\n            justifyContent: 'flex-end',\n          }}\n        >\n          <Button\n            componentId=\"mlflow.evaluations_review.table_ui.apply_filters_button\"\n            type=\"primary\"\n            onClick={() => setFilters(localFilters)}\n            css={{\n              display: 'flex',\n              justifyContent: 'flex-end',\n            }}\n          >\n            <FormattedMessage\n              defaultMessage=\"Apply filters\"\n              description=\"Button label for applying the filters in the GenAI Traces Table\"\n            />\n          </Button>\n        </div>\n      </div>\n    </FormProvider>\n  );\n};\n","import React, { useMemo, useState } from 'react';\n\nimport {\n  ChevronDownIcon,\n  DialogCombobox,\n  DialogComboboxContent,\n  DialogComboboxCustomButtonTriggerWrapper,\n  DialogComboboxOptionList,\n  DialogComboboxOptionListCheckboxItem,\n  DialogComboboxSectionHeader,\n  Button,\n  ColumnsIcon,\n  useDesignSystemTheme,\n  DialogComboboxOptionListSearch,\n  DangerIcon,\n} from '@databricks/design-system';\nimport { FormattedMessage, useIntl } from '@databricks/i18n';\n\nimport { sortGroupedColumns } from '../GenAiTracesTable.utils';\nimport { TracesTableColumnGroup, TracesTableColumnGroupToLabelMap, type TracesTableColumn } from '../types';\nimport { COLUMN_SELECTOR_DROPDOWN_COMPONENT_ID } from '../utils/EvaluationLogging';\n\ninterface Props {\n  columns: TracesTableColumn[];\n  selectedColumns: TracesTableColumn[];\n  toggleColumns: (cols: TracesTableColumn[]) => void;\n  setSelectedColumns: (cols: TracesTableColumn[]) => void;\n  isMetadataLoading?: boolean;\n  metadataError?: Error | null;\n}\n\nconst OPTION_HEIGHT = 32;\n\nconst getGroupLabel = (group: string): string => {\n  return group === TracesTableColumnGroup.INFO\n    ? 'Attributes'\n    : TracesTableColumnGroupToLabelMap[group as TracesTableColumnGroup];\n};\n\n/**\n * Column selector with section headers for each column‐group.\n */\nexport const EvaluationsOverviewColumnSelectorGrouped: React.FC<React.PropsWithChildren<Props>> = ({\n  columns = [],\n  selectedColumns = [],\n  toggleColumns,\n  setSelectedColumns,\n  isMetadataLoading = false,\n  metadataError,\n}) => {\n  const intl = useIntl();\n  const { theme } = useDesignSystemTheme();\n\n  const [search, setSearch] = useState('');\n\n  const sortedGroupedColumns = useMemo(() => {\n    const sortedColumns = sortGroupedColumns(columns);\n    const map: Record<string, TracesTableColumn[]> = {};\n    sortedColumns.forEach((col) => {\n      const group = col.group ?? TracesTableColumnGroup.INFO;\n      if (!map[group]) map[group] = [];\n      map[group].push(col);\n    });\n\n    return map;\n  }, [columns]);\n\n  const filteredGroupedColumns = useMemo(() => {\n    if (!search.trim()) return sortedGroupedColumns;\n\n    const needle = search.trim().toLowerCase();\n    const out: Record<string, TracesTableColumn[]> = {};\n\n    Object.entries(sortedGroupedColumns).forEach(([group, cols]) => {\n      // Check if group name matches\n      const groupLabel = getGroupLabel(group);\n      const groupMatches = groupLabel.toLowerCase().includes(needle);\n\n      // Check if any columns in the group match\n      const hits = cols.filter((c) => c.label.toLowerCase().includes(needle));\n\n      // Include the group if either the group name or any columns match\n      if (groupMatches || hits.length) {\n        out[group] = groupMatches ? cols : hits;\n      }\n    });\n\n    return out;\n  }, [sortedGroupedColumns, search]);\n\n  const handleToggle = (column: TracesTableColumn) => {\n    return toggleColumns([column]);\n  };\n\n  const handleSelectAllInGroup = (groupColumns: TracesTableColumn[]) => {\n    const allSelected = groupColumns.every((col) => selectedColumns.some((c) => c.id === col.id));\n    if (allSelected) {\n      // If all are selected, deselect all in this group\n      const newSelection = selectedColumns.filter((col) => !groupColumns.some((gc) => gc.id === col.id));\n      setSelectedColumns(newSelection);\n    } else {\n      // If not all are selected, select all in this group\n      const newSelection = [...selectedColumns];\n      groupColumns.forEach((col) => {\n        if (!newSelection.some((c) => c.id === col.id)) {\n          newSelection.push(col);\n        }\n      });\n      setSelectedColumns(newSelection);\n    }\n  };\n\n  return (\n    <DialogCombobox componentId={COLUMN_SELECTOR_DROPDOWN_COMPONENT_ID} label=\"Columns\" multiSelect>\n      <DialogComboboxCustomButtonTriggerWrapper>\n        <Button\n          endIcon={<ChevronDownIcon />}\n          data-testid=\"column-selector-button\"\n          componentId=\"mlflow.evaluations_review.table_ui.filter_button\"\n        >\n          <div\n            css={{\n              display: 'flex',\n              gap: theme.spacing.sm,\n              alignItems: 'center',\n            }}\n          >\n            <ColumnsIcon />\n            {intl.formatMessage({\n              defaultMessage: 'Columns',\n              description: 'Evaluation review > evaluations list > filter dropdown button',\n            })}\n          </div>\n        </Button>\n      </DialogComboboxCustomButtonTriggerWrapper>\n\n      <DialogComboboxContent\n        maxHeight={OPTION_HEIGHT * 15.5}\n        minWidth={300}\n        maxWidth={500}\n        loading={isMetadataLoading && !metadataError}\n      >\n        {metadataError ? (\n          <div\n            css={{\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n              gap: theme.spacing.xs,\n              padding: `${theme.spacing.md}px`,\n              color: theme.colors.textValidationDanger,\n            }}\n            data-testid=\"filter-dropdown-error\"\n          >\n            <DangerIcon />\n            <FormattedMessage\n              defaultMessage=\"Fetching traces failed\"\n              description=\"Error message for fetching traces failed\"\n            />\n          </div>\n        ) : (\n          <DialogComboboxOptionList>\n            <DialogComboboxOptionListSearch controlledValue={search} setControlledValue={setSearch}>\n              {Object.entries(filteredGroupedColumns).map(([groupName, cols]) => (\n                <React.Fragment key={groupName}>\n                  <DialogComboboxSectionHeader>{getGroupLabel(groupName)}</DialogComboboxSectionHeader>\n\n                  <DialogComboboxOptionListCheckboxItem\n                    value={`all-${groupName}`}\n                    checked={cols.every((col) => selectedColumns.some((c) => c.id === col.id))}\n                    onChange={() => handleSelectAllInGroup(cols)}\n                  >\n                    {intl.formatMessage(\n                      {\n                        defaultMessage: 'All {groupLabel}',\n                        description: 'Evaluation review > evaluations list > select all columns in group',\n                      },\n                      { groupLabel: getGroupLabel(groupName) },\n                    )}\n                  </DialogComboboxOptionListCheckboxItem>\n\n                  {cols.map((col) => (\n                    <DialogComboboxOptionListCheckboxItem\n                      key={col.id}\n                      value={col.label}\n                      checked={selectedColumns.some((c) => c.id === col.id)}\n                      onChange={() => handleToggle(col)}\n                    >\n                      {col.label}\n                    </DialogComboboxOptionListCheckboxItem>\n                  ))}\n                </React.Fragment>\n              ))}\n            </DialogComboboxOptionListSearch>\n          </DialogComboboxOptionList>\n        )}\n      </DialogComboboxContent>\n    </DialogCombobox>\n  );\n};\n","import { isNil } from 'lodash';\nimport React, { useCallback } from 'react';\n\nimport {\n  Typography,\n  useDesignSystemTheme,\n  TableFilterLayout,\n  Tooltip,\n  Spinner,\n  WarningIcon,\n} from '@databricks/design-system';\nimport { useIntl } from '@databricks/i18n';\n\nimport { GenAITracesTableActions } from './GenAITracesTableActions';\nimport { GenAiTracesTableFilter } from './GenAiTracesTableFilter';\nimport { GenAiTracesTableSearchInput } from './GenAiTracesTableSearchInput';\nimport { EvaluationsOverviewColumnSelectorGrouped } from './components/EvaluationsOverviewColumnSelectorGrouped';\nimport { EvaluationsOverviewSortDropdown } from './components/EvaluationsOverviewSortDropdown';\nimport type {\n  TraceInfoV3,\n  EvaluationsOverviewTableSort,\n  TraceActions,\n  AssessmentInfo,\n  TracesTableColumn,\n  TableFilter,\n  TableFilterOptions,\n} from './types';\nimport { shouldEnableTagGrouping } from './utils/FeatureUtils';\n\ninterface CountInfo {\n  currentCount?: number;\n  totalCount: number;\n  maxAllowedCount: number;\n  logCountLoading: boolean;\n}\n\ninterface GenAITracesTableToolbarProps {\n  // Experiment metadata\n  experimentId: string;\n\n  // Table metadata\n  allColumns: TracesTableColumn[];\n  assessmentInfos: AssessmentInfo[];\n\n  // Table data\n  traceInfos: TraceInfoV3[] | undefined;\n\n  // Filters\n  searchQuery: string;\n  setSearchQuery: (query: string) => void;\n  filters: TableFilter[];\n  setFilters: (newFilters: TableFilter[] | undefined, replace?: boolean) => void;\n  tableSort: EvaluationsOverviewTableSort | undefined;\n  setTableSort: (sort: EvaluationsOverviewTableSort | undefined) => void;\n  selectedColumns: TracesTableColumn[];\n  toggleColumns: (newColumns: TracesTableColumn[]) => void;\n  setSelectedColumns: (nextSelected: TracesTableColumn[]) => void;\n\n  // Actions\n  traceActions?: TraceActions;\n\n  // Stats\n  countInfo: CountInfo;\n\n  // Table filter options\n  tableFilterOptions: TableFilterOptions;\n\n  // Loading state\n  isMetadataLoading?: boolean;\n\n  // Error state\n  metadataError?: Error | null;\n}\n\nexport const GenAITracesTableToolbar: React.FC<React.PropsWithChildren<GenAITracesTableToolbarProps>> = React.memo(\n  (props: GenAITracesTableToolbarProps) => {\n    const {\n      searchQuery,\n      setSearchQuery,\n      filters,\n      setFilters,\n      tableSort,\n      setTableSort,\n      selectedColumns,\n      toggleColumns,\n      setSelectedColumns,\n      assessmentInfos,\n      experimentId,\n      traceInfos,\n      tableFilterOptions,\n      traceActions,\n      allColumns,\n      countInfo,\n      isMetadataLoading,\n      metadataError,\n    } = props;\n    const { theme } = useDesignSystemTheme();\n\n    const onSortChange = useCallback(\n      (sortOption, orderByAsc) => {\n        setTableSort({ key: sortOption.key, type: sortOption.type, asc: orderByAsc });\n      },\n      [setTableSort],\n    );\n\n    return (\n      <div\n        css={{\n          display: 'flex',\n          width: '100%',\n          alignItems: 'flex-end',\n          justifyContent: 'space-between',\n          paddingBottom: `${theme.spacing.xs}px`,\n        }}\n      >\n        <TableFilterLayout\n          css={{\n            marginBottom: 0,\n          }}\n        >\n          <GenAiTracesTableSearchInput searchQuery={searchQuery} setSearchQuery={setSearchQuery} />\n          <GenAiTracesTableFilter\n            filters={filters}\n            setFilters={setFilters}\n            assessmentInfos={assessmentInfos}\n            experimentId={experimentId}\n            tableFilterOptions={tableFilterOptions}\n            allColumns={allColumns}\n            isMetadataLoading={isMetadataLoading}\n            metadataError={metadataError}\n          />\n          <EvaluationsOverviewSortDropdown\n            tableSort={tableSort}\n            columns={selectedColumns}\n            onChange={onSortChange}\n            enableGrouping={shouldEnableTagGrouping()}\n            isMetadataLoading={isMetadataLoading}\n            metadataError={metadataError}\n          />\n\n          <EvaluationsOverviewColumnSelectorGrouped\n            columns={allColumns}\n            selectedColumns={selectedColumns}\n            toggleColumns={toggleColumns}\n            setSelectedColumns={setSelectedColumns}\n            isMetadataLoading={isMetadataLoading}\n            metadataError={metadataError}\n          />\n          {traceActions && (\n            <GenAITracesTableActions experimentId={experimentId} traceActions={traceActions} traceInfos={traceInfos} />\n          )}\n        </TableFilterLayout>\n        <SampledInfoBadge countInfo={countInfo} />\n      </div>\n    );\n  },\n);\n\nconst SampledInfoBadge = (props: { countInfo: CountInfo }) => {\n  const { countInfo } = props;\n  const intl = useIntl();\n  const { theme } = useDesignSystemTheme();\n\n  if (countInfo.logCountLoading || isNil(countInfo.currentCount)) {\n    return <Spinner size=\"small\" />;\n  }\n\n  return (\n    <div\n      css={{\n        display: 'flex',\n        alignItems: 'center',\n        gap: theme.spacing.sm,\n      }}\n    >\n      {countInfo.currentCount >= countInfo.maxAllowedCount && (\n        <Tooltip\n          componentId=\"mlflow.experiment_list_view.max_traces.tooltip\"\n          content={intl.formatMessage(\n            {\n              defaultMessage: 'Only the top {evalResultsCount} results are shown',\n              description: 'Evaluation review > evaluations list > sample info tooltip',\n            },\n            {\n              evalResultsCount: countInfo.maxAllowedCount,\n            },\n          )}\n        >\n          <WarningIcon color=\"warning\" />\n        </Tooltip>\n      )}\n      <Typography.Hint>\n        {intl.formatMessage(\n          {\n            defaultMessage: '{numFilteredEvals} of {numEvals}',\n            description: 'Text displayed when showing a filtered subset evaluations in the evaluation review page',\n          },\n          {\n            // Sometimes the api returns more than the max allowed count. To avoid confusion, we show the max allowed count.\n            numFilteredEvals:\n              countInfo.currentCount >= countInfo.maxAllowedCount ? countInfo.maxAllowedCount : countInfo.currentCount,\n            numEvals:\n              countInfo.totalCount >= countInfo.maxAllowedCount\n                ? `${countInfo.maxAllowedCount}+`\n                : countInfo.totalCount,\n          },\n        )}\n      </Typography.Hint>\n    </div>\n  );\n};\n","import type { RowSelectionState } from '@tanstack/react-table';\nimport React, { useState, useMemo, useCallback } from 'react';\n\nimport { useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\nimport type { Assessment, ModelTrace, ModelTraceInfo } from '@databricks/web-shared/model-trace-explorer';\nimport { AssessmentSchemaContextProvider } from '@databricks/web-shared/model-trace-explorer';\n\nimport { computeEvaluationsComparison } from './GenAiTracesTable.utils';\nimport { GenAiTracesTableBody } from './GenAiTracesTableBody';\nimport { useActiveEvaluation } from './hooks/useActiveEvaluation';\nimport { FilterOperator, TracesTableColumnGroup, TracesTableColumnType } from './types';\nimport type {\n  AssessmentFilter,\n  AssessmentInfo,\n  TracesTableColumn,\n  TraceInfoV3,\n  EvaluationsOverviewTableSort,\n  TableFilter,\n} from './types';\nimport { sortAssessmentInfos } from './utils/AggregationUtils';\nimport { shouldEnableTagGrouping } from './utils/FeatureUtils';\nimport { applyTraceInfoV3ToEvalEntry } from './utils/TraceUtils';\n\ninterface GenAITracesTableBodyContainerProps {\n  // Experiment metadata\n  experimentId: string;\n  currentRunDisplayName?: string;\n  runUuid?: string;\n  compareToRunUuid?: string;\n  compareToRunDisplayName?: string;\n  getRunColor?: (runUuid: string) => string;\n\n  // Table metadata\n  assessmentInfos: AssessmentInfo[];\n\n  // Table data\n  currentTraceInfoV3: TraceInfoV3[];\n  compareToTraceInfoV3?: TraceInfoV3[];\n  getTrace: (traceId?: string) => Promise<ModelTrace | undefined>;\n\n  // Table state\n  selectedColumns: TracesTableColumn[];\n  allColumns: TracesTableColumn[];\n  tableSort: EvaluationsOverviewTableSort | undefined;\n  filters: TableFilter[];\n  setFilters: (filters: TableFilter[]) => void;\n\n  // TODO: Remove this in favor of unified tagging modal apis\n  onTraceTagsEdit?: (trace: ModelTraceInfo) => void;\n\n  // Configuration\n  enableRowSelection?: boolean;\n}\n\nconst GenAITracesTableBodyContainerImpl: React.FC<React.PropsWithChildren<GenAITracesTableBodyContainerProps>> =\n  React.memo((props: GenAITracesTableBodyContainerProps) => {\n    const {\n      experimentId,\n      currentTraceInfoV3,\n      compareToTraceInfoV3,\n      currentRunDisplayName,\n      runUuid,\n      compareToRunUuid,\n      compareToRunDisplayName,\n      setFilters,\n      filters,\n      selectedColumns,\n      tableSort,\n      assessmentInfos,\n      getTrace,\n      onTraceTagsEdit,\n      allColumns,\n      getRunColor,\n      enableRowSelection = true,\n    } = props;\n    const { theme } = useDesignSystemTheme();\n\n    // Convert trace info v3 to the format expected by GenAITracesTableBody\n    const currentEvaluationResults = useMemo(\n      () =>\n        applyTraceInfoV3ToEvalEntry(\n          currentTraceInfoV3.map((traceInfo) => ({\n            evaluationId: traceInfo.trace_id,\n            requestId: traceInfo.client_request_id || traceInfo.trace_id,\n            inputsId: traceInfo.trace_id,\n            inputs: {},\n            outputs: {},\n            targets: {},\n            overallAssessments: [],\n            responseAssessmentsByName: {},\n            metrics: {},\n            traceInfo,\n          })),\n        ),\n      [currentTraceInfoV3],\n    );\n    const compareToEvaluationResults = useMemo(\n      () =>\n        applyTraceInfoV3ToEvalEntry(\n          (compareToTraceInfoV3 || []).map((traceInfo) => ({\n            evaluationId: traceInfo.trace_id,\n            requestId: traceInfo.client_request_id || traceInfo.trace_id,\n            inputsId: traceInfo.trace_id,\n            inputs: {},\n            outputs: {},\n            targets: {},\n            overallAssessments: [],\n            responseAssessmentsByName: {},\n            metrics: {},\n            traceInfo,\n          })),\n        ),\n      [compareToTraceInfoV3],\n    );\n\n    const [rowSelection, setRowSelection] = useState<RowSelectionState>({});\n\n    // Handle assessment filter toggle\n    const handleAssessmentFilterToggle = useCallback(\n      (assessmentName: string, filterValue: any, run: string) => {\n        const filter = filters.find(\n          (filter) => filter.column === TracesTableColumnGroup.ASSESSMENT && filter.key === assessmentName,\n        );\n        if (filter === undefined) {\n          setFilters([\n            ...filters,\n            {\n              column: TracesTableColumnGroup.ASSESSMENT,\n              key: assessmentName,\n              operator: FilterOperator.EQUALS,\n              value: filterValue,\n            },\n          ]);\n        } else if (filter.value === filterValue) {\n          // Remove the filter because it already exists.\n          setFilters(\n            filters.filter(\n              (filter) => !(filter.column === TracesTableColumnGroup.ASSESSMENT && filter.key === assessmentName),\n            ),\n          );\n        } else {\n          // Replace any filters with the same assessment name and run.\n          setFilters(\n            filters.map((filter) => {\n              if (filter.column === TracesTableColumnGroup.ASSESSMENT && filter.key === assessmentName) {\n                return {\n                  column: TracesTableColumnGroup.ASSESSMENT,\n                  key: assessmentName,\n                  operator: FilterOperator.EQUALS,\n                  value: filterValue,\n                };\n              }\n              return filter;\n            }),\n          );\n        }\n      },\n      [filters, setFilters],\n    );\n\n    const assessmentFilters: AssessmentFilter[] = useMemo(() => {\n      return filters\n        .filter((filter) => filter.column === TracesTableColumnGroup.ASSESSMENT)\n        .map((filter) => ({\n          assessmentName: filter.key || '',\n          filterValue: filter.value,\n          run: currentRunDisplayName || '',\n        }));\n    }, [filters, currentRunDisplayName]);\n\n    const [selectedEvaluationId, setSelectedEvaluationId] = useActiveEvaluation();\n\n    // Get selected assessment infos\n    const selectedAssessmentInfos = useMemo(() => {\n      const selectedAssessmentCols = selectedColumns.filter((col) => col.type === TracesTableColumnType.ASSESSMENT);\n      const selectedAssessments = selectedAssessmentCols.map((col) => col.assessmentInfo as AssessmentInfo);\n      return sortAssessmentInfos(selectedAssessments);\n    }, [selectedColumns]);\n\n    // Compute evaluations comparison\n    const evaluationResults = useMemo(\n      () => computeEvaluationsComparison(currentEvaluationResults, compareToEvaluationResults),\n      [currentEvaluationResults, compareToEvaluationResults],\n    );\n\n    const assessments = useMemo(() => {\n      return currentEvaluationResults.flatMap((evalResult) => evalResult?.traceInfo?.assessments ?? []) as Assessment[];\n    }, [currentEvaluationResults]);\n\n    return (\n      <div\n        css={{\n          display: 'flex',\n          flexDirection: 'column',\n          gap: theme.spacing.xs,\n          overflow: 'hidden',\n          flexGrow: 1,\n        }}\n      >\n        <div\n          css={{\n            display: 'flex',\n            gap: theme.spacing.md,\n            width: '100%',\n            flex: 1,\n            overflowY: 'hidden',\n          }}\n        >\n          <div\n            css={{\n              flex: 1,\n              overflowY: 'hidden',\n            }}\n          >\n            <AssessmentSchemaContextProvider assessments={assessments}>\n              <GenAiTracesTableBody\n                experimentId={experimentId}\n                selectedColumns={selectedColumns}\n                allColumns={allColumns}\n                evaluations={evaluationResults}\n                selectedEvaluationId={selectedEvaluationId}\n                selectedAssessmentInfos={selectedAssessmentInfos}\n                assessmentInfos={assessmentInfos}\n                assessmentFilters={assessmentFilters}\n                onChangeEvaluationId={setSelectedEvaluationId}\n                getRunColor={getRunColor}\n                runUuid={runUuid}\n                compareToRunUuid={compareToRunUuid}\n                runDisplayName={currentRunDisplayName}\n                compareToRunDisplayName={compareToRunDisplayName}\n                enableRowSelection={enableRowSelection}\n                rowSelection={rowSelection}\n                setRowSelection={setRowSelection}\n                toggleAssessmentFilter={handleAssessmentFilterToggle}\n                tableSort={tableSort}\n                getTrace={getTrace}\n                onTraceTagsEdit={onTraceTagsEdit}\n                enableGrouping={shouldEnableTagGrouping()}\n              />\n            </AssessmentSchemaContextProvider>\n          </div>\n        </div>\n      </div>\n    );\n  });\n\n// TODO: Add an error boundary to the OSS trace table\nexport const GenAITracesTableBodyContainer = GenAITracesTableBodyContainerImpl;\n","import { useCallback, useMemo } from 'react';\n\nimport { assessmentValueToSerializedString, serializedStringToAssessmentValueV2 } from './useAssessmentFilters';\nimport { type TableFilter, type TableFilterValue, type FilterOperator, TracesTableColumnGroup } from '../types';\nimport { useSearchParams } from '../utils/RoutingUtils';\n\nconst QUERY_PARAM_KEY = 'filter';\nconst VALUE_SEPARATOR = '::';\n\n/**\n * Query param-powered hook that manages both generic and assessment filters.\n * Each filter is stored in the URL as: key::operator::value::type\n */\nexport const useFilters = () => {\n  const [searchParams, setSearchParams] = useSearchParams();\n\n  const filters: TableFilter[] = useMemo(() => {\n    const filtersUrl = searchParams.getAll(QUERY_PARAM_KEY) ?? [];\n\n    return filtersUrl.reduce<TableFilter[]>((filters, urlFilter) => {\n      const [column, urlOperator, value, key] = urlFilter.split(VALUE_SEPARATOR);\n      if (!column || !urlOperator || !value) return filters;\n\n      const operator = urlOperator as FilterOperator;\n\n      const isAssessmentFilter = column === TracesTableColumnGroup.ASSESSMENT;\n      let filterValue: TableFilterValue = value;\n      if (isAssessmentFilter) {\n        filterValue = serializedStringToAssessmentValueV2(value);\n      }\n\n      filters.push({\n        column,\n        key,\n        operator,\n        value: filterValue,\n      });\n\n      return filters;\n    }, []);\n  }, [searchParams]);\n\n  const setFilters = useCallback(\n    (newFilters: TableFilter[] | undefined, replace = false) => {\n      setSearchParams(\n        (params: URLSearchParams) => {\n          params.delete(QUERY_PARAM_KEY);\n\n          if (newFilters) {\n            newFilters.forEach((filter) => {\n              let filterValue = filter.value;\n              if (filter.column === TracesTableColumnGroup.ASSESSMENT) {\n                filterValue = assessmentValueToSerializedString(filter.value);\n              }\n              params.append(\n                QUERY_PARAM_KEY,\n                [filter.column, filter.operator, filterValue, filter.key].join(VALUE_SEPARATOR),\n              );\n            });\n          }\n\n          return params;\n        },\n        { replace },\n      );\n    },\n    [setSearchParams],\n  );\n\n  return [filters, setFilters] as const;\n};\n","import { isNil } from 'lodash';\nimport { useCallback, useMemo } from 'react';\n\nimport { useLocalStorage } from '@databricks/web-shared/hooks';\n\nimport {\n  EXECUTION_DURATION_COLUMN_ID,\n  SOURCE_COLUMN_ID,\n  STATE_COLUMN_ID,\n  TRACE_NAME_COLUMN_ID,\n} from './useTableColumns';\nimport type { TracesTableColumn } from '../types';\nimport { TracesTableColumnType } from '../types';\n\nexport interface GenAITracesUIState {\n  /**\n   * A map of column ids to boolean values.\n   * If a column id is present in the map, the column is hidden if the value is false, and visible if the value is true.\n   */\n  columnOverrides: Record<string, boolean>;\n}\n\nconst DEFAULT_MAX_VISIBLE_COLUMNS = 10;\n\nconst LOCAL_STORAGE_KEY = 'genaiTracesUIState-columns';\nconst LOCAL_STORAGE_VERSION = 1;\n\nconst toVisibleColumnsFromHiddenColumns = (hiddenColumns: string[], allColumns: TracesTableColumn[]) => {\n  return allColumns.filter((col) => !hiddenColumns.includes(col.id));\n};\n\nconst toHiddenColumnsFromVisibleColumns = (visibleColumns: TracesTableColumn[], allColumns: TracesTableColumn[]) => {\n  return allColumns.filter((col) => !visibleColumns.includes(col)).map((col) => col.id);\n};\n\n// This function adjusts the hidden columns to ensure that the number of visible columns is at most DEFAULT_MAX_VISIBLE_COLUMNS\n// If over the limit, it removes assessment columns until the limit is met.\nconst adjustHiddenColumns = (hiddenColumns: string[], allColumns: TracesTableColumn[]): string[] => {\n  let visibleColumns = toVisibleColumnsFromHiddenColumns(hiddenColumns, allColumns);\n  if (visibleColumns.length > DEFAULT_MAX_VISIBLE_COLUMNS) {\n    const assessmentColumns = visibleColumns.filter((col) => col.type === TracesTableColumnType.ASSESSMENT);\n    const nonAssessmentColumns = visibleColumns.filter((col) => col.type !== TracesTableColumnType.ASSESSMENT);\n\n    // Calculate how many assessment columns we need to remove\n    const columnsToRemove = visibleColumns.length - DEFAULT_MAX_VISIBLE_COLUMNS;\n    const assessmentColumnsToKeep = Math.max(0, assessmentColumns.length - columnsToRemove);\n\n    // Keep the first N assessment columns and all non-assessment columns\n    visibleColumns = [...nonAssessmentColumns, ...assessmentColumns.slice(0, assessmentColumnsToKeep)];\n  }\n  return toHiddenColumnsFromVisibleColumns(visibleColumns, allColumns);\n};\n\nconst getDefaultHiddenColumns = (\n  allColumns: TracesTableColumn[],\n  defaultSelectedColumns?: (allColumns: TracesTableColumn[]) => TracesTableColumn[],\n): string[] => {\n  if (defaultSelectedColumns) {\n    return adjustHiddenColumns(\n      toHiddenColumnsFromVisibleColumns(defaultSelectedColumns(allColumns), allColumns),\n      allColumns,\n    );\n  }\n\n  return adjustHiddenColumns(\n    [TRACE_NAME_COLUMN_ID, SOURCE_COLUMN_ID, EXECUTION_DURATION_COLUMN_ID, STATE_COLUMN_ID],\n    allColumns,\n  );\n};\n\nexport const useGenAITracesUIStateColumns = (\n  experimentId: string,\n  allColumns: TracesTableColumn[],\n  defaultSelectedColumns?: (allColumns: TracesTableColumn[]) => TracesTableColumn[],\n  runUuid?: string,\n): {\n  hiddenColumns: string[];\n  toggleColumns: (cols: TracesTableColumn[]) => void;\n} => {\n  const [columnState, setColumnState] = useLocalStorage<GenAITracesUIState | undefined>({\n    key: `${LOCAL_STORAGE_KEY}-${experimentId}-${runUuid}`,\n    version: LOCAL_STORAGE_VERSION,\n    initialValue: undefined,\n  });\n\n  const defaultHidden = useMemo(() => {\n    return getDefaultHiddenColumns(allColumns, defaultSelectedColumns);\n  }, [allColumns, defaultSelectedColumns]);\n\n  const hiddenColumns = useMemo(() => {\n    const hidden = new Set(defaultHidden);\n\n    if (!columnState?.columnOverrides) {\n      return defaultHidden;\n    }\n\n    Object.entries(columnState.columnOverrides).forEach(([id, show]) => {\n      if (show) {\n        hidden.delete(id);\n      } else {\n        hidden.add(id);\n      }\n    });\n\n    return [...hidden];\n  }, [columnState, defaultHidden]);\n\n  const toggleColumns = useCallback(\n    (cols: TracesTableColumn[]) => {\n      if (!cols.length) return;\n\n      setColumnState((prev) => {\n        const prevOverrides = prev?.columnOverrides ?? {};\n        const nextOverrides = { ...prevOverrides };\n        let changed = false;\n\n        cols.forEach((col) => {\n          /* derive current visibility:  true = hidden, false = visible */\n          const currentlyHidden =\n            col.id in prevOverrides\n              ? !prevOverrides[col.id] // invert, because stored flag is *show*\n              : defaultHidden.includes(col.id);\n\n          const newShow = currentlyHidden;\n          if (nextOverrides[col.id] !== newShow) {\n            nextOverrides[col.id] = newShow;\n            changed = true;\n          }\n        });\n\n        return changed ? { ...prev, columnOverrides: nextOverrides } : prev;\n      });\n    },\n    [setColumnState, defaultHidden],\n  );\n\n  return { hiddenColumns, toggleColumns };\n};\n\n/**\n * This hook is used to manage the selected columns for the GenAITracesTable.\n * It uses the useGenAITracesUIStateColumns hook to manage the hidden columns, and then filters the allColumns to get the selected columns.\n * It also provides a function to set the selected columns, which will toggle the columns to be visible or hidden.\n * @returns selectedColumns: The selected columns\n * @returns toggleColumns: A function to toggle the columns\n * @returns setSelectedColumns: A function to set the selected columns - can use to do bulk updates to selected columns\n */\nexport const useSelectedColumns = (\n  experimentId: string,\n  allColumns: TracesTableColumn[],\n  defaultSelectedColumns?: (cols: TracesTableColumn[]) => TracesTableColumn[],\n  runUuid?: string,\n) => {\n  const { hiddenColumns, toggleColumns } = useGenAITracesUIStateColumns(\n    experimentId,\n    allColumns,\n    defaultSelectedColumns,\n    runUuid,\n  );\n\n  const selectedColumns = useMemo(\n    () => allColumns.filter((c) => !hiddenColumns.includes(c.id)),\n    [allColumns, hiddenColumns],\n  );\n\n  const setSelectedColumns = useCallback(\n    (nextSelected: TracesTableColumn[]) => {\n      if (isNil(nextSelected)) return;\n\n      const wantSelected = new Set(nextSelected.map((c) => c.id));\n      const toToggle: TracesTableColumn[] = [];\n\n      allColumns.forEach((col) => {\n        const isSelectedNow = !hiddenColumns.includes(col.id);\n        const willBeSelected = wantSelected.has(col.id);\n\n        if (isSelectedNow !== willBeSelected) {\n          // only flip what actually changes\n          toToggle.push(col);\n        }\n      });\n\n      if (toToggle.length) {\n        toggleColumns(toToggle);\n      }\n    },\n    [allColumns, hiddenColumns, toggleColumns],\n  );\n\n  return { selectedColumns, toggleColumns, setSelectedColumns };\n};\n","import { sortedIndexOf } from 'lodash';\nimport React, { useMemo, useRef, useState } from 'react';\nimport type { Control } from 'react-hook-form';\nimport { useController } from 'react-hook-form';\nimport { useIntl } from 'react-intl';\n\nimport { PlusIcon, LegacySelect, LegacyTooltip, useDesignSystemTheme } from '@databricks/design-system';\nimport type { KeyValueEntity } from '../types';\n\n/**\n * Will show an extra row at the bottom of the dropdown menu to create a new tag when\n * The user has typed something in the search input\n * and either\n * 1. The search input is not an exact match for an existing tag name\n * 2. There are no tags available based on search input\n */\n\nfunction DropdownMenu(menu: React.ReactElement, allAvailableTags: string[]) {\n  const intl = useIntl();\n  const { theme } = useDesignSystemTheme();\n  const searchValue = menu.props.searchValue.toLowerCase();\n\n  const resolvedMenu = useMemo(() => {\n    if (!searchValue) return menu;\n\n    const doesTagExists = sortedIndexOf(allAvailableTags, searchValue) >= 0;\n    if (doesTagExists) return menu;\n\n    const isValidTagKey = /^[^,.:/=\\-\\s]+$/.test(searchValue);\n\n    // Overriding the menu to add a new option at the top\n    return React.cloneElement(menu, {\n      flattenOptions: [\n        {\n          data: {\n            value: searchValue,\n            disabled: !isValidTagKey,\n            style: {\n              color: isValidTagKey ? theme.colors.actionTertiaryTextDefault : theme.colors.actionDisabledText,\n            },\n            children: (\n              <LegacyTooltip\n                title={\n                  isValidTagKey\n                    ? undefined\n                    : intl.formatMessage({\n                        defaultMessage: ', . : / - = and blank spaces are not allowed',\n                        description:\n                          'Key-value tag editor modal > Tag dropdown Manage Modal > Invalid characters error',\n                      })\n                }\n                placement=\"right\"\n              >\n                <span css={{ display: 'block' }}>\n                  <PlusIcon css={{ marginRight: theme.spacing.sm }} />\n                  {intl.formatMessage(\n                    {\n                      defaultMessage: 'Add tag \"{tagKey}\"',\n                      description: 'Key-value tag editor modal > Tag dropdown Manage Modal > Add new tag button',\n                    },\n                    {\n                      tagKey: searchValue,\n                    },\n                  )}\n                </span>\n              </LegacyTooltip>\n            ),\n          },\n          key: searchValue,\n          groupOption: false,\n        },\n        ...menu.props.flattenOptions,\n      ],\n    });\n  }, [allAvailableTags, menu, searchValue, intl, theme]);\n\n  return resolvedMenu;\n}\n\nfunction getDropdownMenu(allAvailableTags: string[]) {\n  return (menu: React.ReactElement) => DropdownMenu(menu, allAvailableTags);\n}\n\n/**\n * Used in tag edit feature, allows selecting existing / adding new tag value\n */\nexport function TagKeySelectDropdown({\n  allAvailableTags,\n  control,\n  onKeyChangeCallback,\n}: {\n  allAvailableTags: string[];\n  control: Control<KeyValueEntity>;\n  onKeyChangeCallback?: (key?: string) => void;\n}) {\n  const intl = useIntl();\n  const [isOpen, setIsOpen] = useState(false);\n  const selectRef = useRef<{ blur: () => void; focus: () => void }>(null);\n\n  const { field, fieldState } = useController({\n    control: control,\n    name: 'key',\n    rules: {\n      required: {\n        message: intl.formatMessage({\n          defaultMessage: 'A tag key is required',\n          description: 'Key-value tag editor modal > Tag dropdown > Tag key required error message',\n        }),\n        value: true,\n      },\n    },\n  });\n\n  const handleDropdownVisibleChange = (visible: boolean) => {\n    setIsOpen(visible);\n  };\n\n  const handleClear = () => {\n    field.onChange(undefined);\n    onKeyChangeCallback?.(undefined);\n  };\n\n  const handleSelect = (key: string) => {\n    field.onChange(key);\n    onKeyChangeCallback?.(key);\n  };\n\n  return (\n    <LegacySelect\n      allowClear\n      ref={selectRef}\n      dangerouslySetAntdProps={{\n        showSearch: true,\n        dropdownRender: getDropdownMenu(allAvailableTags),\n      }}\n      css={{ width: '100%' }}\n      placeholder={intl.formatMessage({\n        defaultMessage: 'Type a key',\n        description: 'Key-value tag editor modal > Tag dropdown > Tag input placeholder',\n      })}\n      value={field.value}\n      defaultValue={field.value}\n      open={isOpen}\n      onDropdownVisibleChange={handleDropdownVisibleChange}\n      filterOption={(input, option) => option?.value.toLowerCase().includes(input.toLowerCase())}\n      onSelect={handleSelect}\n      onClear={handleClear}\n      validationState={fieldState.error ? 'error' : undefined}\n    >\n      {allAvailableTags.map((tag) => (\n        <LegacySelect.Option value={tag} key={tag}>\n          {tag}\n        </LegacySelect.Option>\n      ))}\n    </LegacySelect>\n  );\n}\n","import { isEqual, sortBy } from 'lodash';\nimport { useCallback, useMemo, useRef, useState } from 'react';\nimport { truncate } from 'lodash';\n\nimport {\n  Button,\n  FormUI,\n  Modal,\n  PlusIcon,\n  Popover,\n  RHFControlledComponents,\n  RestoreAntDDefaultClsPrefix,\n  LegacyTooltip,\n  useDesignSystemTheme,\n} from '@databricks/design-system';\nimport { Typography } from '@databricks/design-system';\nimport type { KeyValueEntity } from '../types';\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport { useForm } from 'react-hook-form';\nimport { TagKeySelectDropdown } from '../components/TagSelectDropdown';\nimport { KeyValueTag } from '../components/KeyValueTag';\nimport { ErrorWrapper } from '../utils/ErrorWrapper';\n\nfunction getTagsMap(tags: KeyValueEntity[]) {\n  return new Map(tags.map((tag) => [tag.key, tag]));\n}\n\n/**\n * Provides methods to initialize and display modal used to add and remove tags from any compatible entity\n */\nexport const useEditKeyValueTagsModal = <T extends { tags?: KeyValueEntity[] }>({\n  onSuccess,\n  saveTagsHandler,\n  allAvailableTags,\n  valueRequired = false,\n  title,\n}: {\n  onSuccess?: () => void;\n  saveTagsHandler: (editedEntity: T, existingTags: KeyValueEntity[], newTags: KeyValueEntity[]) => Promise<any>;\n  allAvailableTags?: string[];\n  valueRequired?: boolean;\n  title?: React.ReactNode;\n}) => {\n  const editedEntityRef = useRef<T>();\n  const [errorMessage, setErrorMessage] = useState<string>('');\n  const { theme } = useDesignSystemTheme();\n\n  const [initialTags, setInitialTags] = useState<Map<string, KeyValueEntity>>(new Map());\n  const [finalTags, setFinalTags] = useState<Map<string, KeyValueEntity>>(new Map());\n\n  const [showModal, setShowModal] = useState(false);\n\n  const form = useForm<KeyValueEntity>({\n    defaultValues: {\n      key: undefined,\n      value: '',\n    },\n  });\n\n  const hideModal = () => setShowModal(false);\n\n  /**\n   * Function used to invoke the modal and start editing tags of the particular model version\n   */\n  const showEditTagsModal = useCallback(\n    (editedEntity: T) => {\n      editedEntityRef.current = editedEntity;\n      setInitialTags(getTagsMap(editedEntity.tags || []));\n      setFinalTags(getTagsMap(editedEntity.tags || []));\n      form.reset();\n\n      setShowModal(true);\n    },\n    [form],\n  );\n\n  const saveTags = async () => {\n    if (!editedEntityRef.current) {\n      return;\n    }\n    setErrorMessage('');\n    setIsLoading(true);\n    saveTagsHandler(editedEntityRef.current, Array.from(initialTags.values()), Array.from(finalTags.values()))\n      .then(() => {\n        hideModal();\n        onSuccess?.();\n        setIsLoading(false);\n      })\n      .catch((e: ErrorWrapper | Error) => {\n        setIsLoading(false);\n        setErrorMessage(e instanceof ErrorWrapper ? e.getUserVisibleError()?.message : e.message);\n      });\n  };\n\n  const intl = useIntl();\n  const formValues = form.watch();\n\n  const [isLoading, setIsLoading] = useState(false);\n\n  const hasNewValues = useMemo(\n    () => !isEqual(sortBy(Array.from(initialTags.values()), 'key'), sortBy(Array.from(finalTags.values()), 'key')),\n    [initialTags, finalTags],\n  );\n  const isDirty = formValues.key || formValues.value;\n  const showPopoverMessage = hasNewValues && isDirty;\n\n  const onKeyChangeCallback = (key: string | undefined) => {\n    const tag = key ? finalTags.get(key) : undefined;\n    /**\n     * If a tag value exists for provided key, set the value to the existing tag value\n     */\n    form.setValue('value', tag?.value ?? '');\n  };\n\n  const handleTagDelete = ({ key }: KeyValueEntity) => {\n    setFinalTags((currentFinalTags) => {\n      currentFinalTags.delete(key);\n      return new Map(currentFinalTags);\n    });\n  };\n\n  const onSubmit = () => {\n    // Do not accept form if no value provided while it's required\n    if (valueRequired && !formValues.value.trim()) {\n      return;\n    }\n\n    // Add new tag to existing tags leaving only one tag per key value\n    const newEntries = new Map(finalTags);\n    newEntries.set(formValues.key, formValues);\n\n    setFinalTags(newEntries);\n    form.reset();\n  };\n\n  const EditTagsModal = (\n    <Modal\n      componentId=\"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_135\"\n      destroyOnClose\n      visible={showModal}\n      title={\n        title ?? (\n          <FormattedMessage\n            defaultMessage=\"Add/Edit tags\"\n            description=\"Key-value tag editor modal > Title of the update tags modal\"\n          />\n        )\n      }\n      onCancel={hideModal}\n      footer={\n        <RestoreAntDDefaultClsPrefix>\n          <Button\n            componentId=\"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_147\"\n            dangerouslyUseFocusPseudoClass\n            onClick={hideModal}\n            /**\n             * Hack: The footer will remove the margin to the save tags button\n             * if the button if wrapped on another component.\n             */\n            css={{ marginRight: !hasNewValues ? theme.spacing.sm : 0 }}\n          >\n            {intl.formatMessage({\n              defaultMessage: 'Cancel',\n              description: 'Key-value tag editor modal > Manage Tag cancel button',\n            })}\n          </Button>\n          {showPopoverMessage ? (\n            <UnsavedTagPopoverTrigger formValues={formValues} isLoading={isLoading} onSaveTask={saveTags} />\n          ) : (\n            <LegacyTooltip\n              title={\n                !hasNewValues\n                  ? intl.formatMessage({\n                      defaultMessage: 'Please add or remove one or more tags before saving',\n                      description: 'Key-value tag editor modal > Tag disabled message',\n                    })\n                  : undefined\n              }\n            >\n              <Button\n                componentId=\"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_174\"\n                dangerouslyUseFocusPseudoClass\n                disabled={!hasNewValues}\n                loading={isLoading}\n                type=\"primary\"\n                onClick={saveTags}\n              >\n                {intl.formatMessage({\n                  defaultMessage: 'Save tags',\n                  description: 'Key-value tag editor modal > Manage Tag save button',\n                })}\n              </Button>\n            </LegacyTooltip>\n          )}\n        </RestoreAntDDefaultClsPrefix>\n      }\n    >\n      <form\n        onSubmit={form.handleSubmit(onSubmit)}\n        css={{ display: 'flex', alignItems: 'flex-end', gap: theme.spacing.md }}\n      >\n        <div css={{ minWidth: 0, display: 'flex', gap: theme.spacing.md, flex: 1 }}>\n          <div css={{ flex: 1 }}>\n            <FormUI.Label htmlFor=\"key\">\n              {intl.formatMessage({\n                defaultMessage: 'Key',\n                description: 'Key-value tag editor modal > Key input label',\n              })}\n            </FormUI.Label>\n            <TagKeySelectDropdown\n              allAvailableTags={allAvailableTags || []}\n              control={form.control}\n              onKeyChangeCallback={onKeyChangeCallback}\n            />\n          </div>\n          <div css={{ flex: 1 }}>\n            <FormUI.Label htmlFor=\"value\">\n              {valueRequired\n                ? intl.formatMessage({\n                    defaultMessage: 'Value',\n                    description: 'Key-value tag editor modal > Value input label (required)',\n                  })\n                : intl.formatMessage({\n                    defaultMessage: 'Value (optional)',\n                    description: 'Key-value tag editor modal > Value input label',\n                  })}\n            </FormUI.Label>\n            <RHFControlledComponents.Input\n              componentId=\"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_223\"\n              name=\"value\"\n              control={form.control}\n              aria-label={\n                valueRequired\n                  ? intl.formatMessage({\n                      defaultMessage: 'Value',\n                      description: 'Key-value tag editor modal > Value input label (required)',\n                    })\n                  : intl.formatMessage({\n                      defaultMessage: 'Value (optional)',\n                      description: 'Key-value tag editor modal > Value input label',\n                    })\n              }\n              placeholder={intl.formatMessage({\n                defaultMessage: 'Type a value',\n                description: 'Key-value tag editor modal > Value input placeholder',\n              })}\n            />\n          </div>\n        </div>\n        <LegacyTooltip\n          title={intl.formatMessage({\n            defaultMessage: 'Add tag',\n            description: 'Key-value tag editor modal > Add tag button',\n          })}\n        >\n          <Button\n            componentId=\"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_248\"\n            htmlType=\"submit\"\n            aria-label={intl.formatMessage({\n              defaultMessage: 'Add tag',\n              description: 'Key-value tag editor modal > Add tag button',\n            })}\n          >\n            <PlusIcon />\n          </Button>\n        </LegacyTooltip>\n      </form>\n      {errorMessage && <FormUI.Message type=\"error\" message={errorMessage} />}\n      <div\n        css={{\n          display: 'flex',\n          rowGap: theme.spacing.xs,\n          flexWrap: 'wrap',\n          marginTop: theme.spacing.sm,\n        }}\n      >\n        {Array.from(finalTags.values()).map((tag) => (\n          <KeyValueTag isClosable tag={tag} onClose={() => handleTagDelete(tag)} key={tag.key} />\n        ))}\n      </div>\n    </Modal>\n  );\n\n  return { EditTagsModal, showEditTagsModal, isLoading };\n};\n\nfunction UnsavedTagPopoverTrigger({\n  isLoading,\n  formValues,\n  onSaveTask,\n}: {\n  isLoading: boolean;\n  formValues: any;\n  onSaveTask: () => void;\n}) {\n  const intl = useIntl();\n  const { theme } = useDesignSystemTheme();\n\n  const tagKeyDisplay = `${truncate(formValues.key, { length: 20 }) || '_'}`;\n  const tagValueDisplay = formValues.value ? `:${truncate(formValues.value, { length: 20 })}` : '';\n  const fullTagDisplay = `${tagKeyDisplay}${tagValueDisplay}`;\n\n  const shownText = intl.formatMessage(\n    {\n      defaultMessage: 'Are you sure you want to save and close without adding \"{tag}\"',\n      description: 'Key-value tag editor modal > Unsaved tag message',\n    },\n    {\n      tag: fullTagDisplay,\n    },\n  );\n  return (\n    <Popover.Root componentId=\"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_309\">\n      <Popover.Trigger asChild>\n        <Button\n          componentId=\"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_306\"\n          dangerouslyUseFocusPseudoClass\n          loading={isLoading}\n          type=\"primary\"\n        >\n          {intl.formatMessage({\n            defaultMessage: 'Save tags',\n            description: 'Key-value tag editor modal > Manage Tag save button',\n          })}\n        </Button>\n      </Popover.Trigger>\n      <Popover.Content align=\"end\" aria-label={shownText}>\n        <Typography.Paragraph css={{ maxWidth: 400 }}>{shownText}</Typography.Paragraph>\n        <Popover.Close asChild>\n          <Button\n            componentId=\"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_316\"\n            onClick={onSaveTask}\n          >\n            {intl.formatMessage({\n              defaultMessage: 'Yes, save and close',\n              description: 'Key-value tag editor modal > Unsaved tag message > Yes, save and close button',\n            })}\n          </Button>\n        </Popover.Close>\n        <Popover.Close asChild>\n          <Button\n            componentId=\"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_324\"\n            type=\"primary\"\n            css={{ marginLeft: theme.spacing.sm }}\n          >\n            {intl.formatMessage({\n              defaultMessage: 'Cancel',\n              description: 'Key-value tag editor modal > Unsaved tag message > cancel button',\n            })}\n          </Button>\n        </Popover.Close>\n        <Popover.Arrow />\n      </Popover.Content>\n    </Popover.Root>\n  );\n}\n","import {\n  isNil,\n  omitBy,\n  mapValues,\n  isArray,\n  isString,\n  isNumber,\n  isBoolean,\n  escapeRegExp,\n  map,\n  every,\n  has,\n  compact,\n  keyBy,\n} from 'lodash';\n\nimport { ModelSpanType, ModelIconType, MLFLOW_TRACE_SCHEMA_VERSION_KEY } from './ModelTrace.types';\nimport type {\n  SearchMatch,\n  ModelTrace,\n  ModelTraceSpan,\n  ModelTraceSpanNode,\n  ModelTraceChatMessage,\n  ModelTraceChatResponse,\n  ModelTraceChatInput,\n  ModelTraceToolCall,\n  ModelTraceChatTool,\n  ModelTraceChatToolParamProperty,\n  RawModelTraceChatMessage,\n  ModelTraceContentType,\n  SpanFilterState,\n  ModelTraceSpanV3,\n  ModelTraceSpanV2,\n  ModelTraceInfoV3,\n  Assessment,\n  RetrieverDocument,\n  ModelTraceEvent,\n} from './ModelTrace.types';\nimport { ModelTraceExplorerIcon } from './ModelTraceExplorerIcon';\nimport {\n  normalizeAnthropicChatInput,\n  normalizeAnthropicChatOutput,\n  normalizeAutogenChatInput,\n  normalizeAutogenChatOutput,\n  normalizeBedrockChatInput,\n  normalizeBedrockChatOutput,\n  normalizeGeminiChatInput,\n  normalizeGeminiChatOutput,\n  normalizeOpenAIChatInput,\n  normalizeOpenAIChatResponse,\n  normalizeOpenAIResponsesInput,\n  normalizeOpenAIResponsesOutput,\n  normalizeOpenAIAgentInput,\n  normalizeOpenAIAgentOutput,\n  normalizeLangchainChatInput,\n  normalizeLangchainChatResult,\n  normalizeLlamaIndexChatInput,\n  normalizeLlamaIndexChatResponse,\n  normalizeDspyChatInput,\n  normalizeDspyChatOutput,\n} from './chat-utils';\n\nexport const FETCH_TRACE_INFO_QUERY_KEY = 'model-trace-info-v3';\n\nexport const displayErrorNotification = (errorMessage: string) => {\n  // TODO: display error notification in OSS\n  return;\n};\n\nexport function getIconTypeForSpan(spanType: ModelSpanType | string): ModelIconType {\n  switch (spanType) {\n    case ModelSpanType.LLM:\n      return ModelIconType.MODELS;\n    case ModelSpanType.CHAIN:\n      return ModelIconType.CHAIN;\n    case ModelSpanType.AGENT:\n      return ModelIconType.AGENT;\n    case ModelSpanType.TOOL:\n      return ModelIconType.WRENCH;\n    case ModelSpanType.CHAT_MODEL:\n      return ModelIconType.MODELS;\n    case ModelSpanType.RETRIEVER:\n      return ModelIconType.SEARCH;\n    case ModelSpanType.PARSER:\n      return ModelIconType.CODE;\n    case ModelSpanType.EMBEDDING:\n      return ModelIconType.NUMBERS;\n    case ModelSpanType.RERANKER:\n      return ModelIconType.SORT;\n    case ModelSpanType.MEMORY:\n      return ModelIconType.SAVE;\n    case ModelSpanType.FUNCTION:\n      return ModelIconType.FUNCTION;\n    case ModelSpanType.UNKNOWN:\n      return ModelIconType.UNKNOWN;\n    default:\n      return ModelIconType.FUNCTION;\n  }\n}\n\nexport function getDisplayNameForSpanType(spanType: ModelSpanType | string): string {\n  switch (spanType) {\n    case ModelSpanType.LLM:\n      return 'LLM';\n    case ModelSpanType.CHAIN:\n      return 'Chain';\n    case ModelSpanType.AGENT:\n      return 'Agent';\n    case ModelSpanType.TOOL:\n      return 'Tool';\n    case ModelSpanType.CHAT_MODEL:\n      return 'Chat model';\n    case ModelSpanType.RETRIEVER:\n      return 'Retriever';\n    case ModelSpanType.PARSER:\n      return 'Parser';\n    case ModelSpanType.EMBEDDING:\n      return 'Embedding';\n    case ModelSpanType.RERANKER:\n      return 'Reranker';\n    case ModelSpanType.MEMORY:\n      return 'Memory';\n    case ModelSpanType.FUNCTION:\n      return 'Function';\n    case ModelSpanType.UNKNOWN:\n      return 'Unknown';\n    default:\n      return spanType;\n  }\n}\n\nexport function tryDeserializeAttribute(value: string): any {\n  try {\n    return JSON.parse(value);\n  } catch (e) {\n    return value;\n  }\n}\n\nexport const getMatchesFromEvent = (span: ModelTraceSpanNode, searchFilter: string): SearchMatch[] => {\n  const events = span.events;\n  if (!events) {\n    return [];\n  }\n\n  const matches: SearchMatch[] = [];\n  events.forEach((event, index) => {\n    const attributes = event.attributes;\n\n    if (!attributes) {\n      return;\n    }\n\n    Object.keys(attributes).forEach((attribute) => {\n      const isKeyMatch = attribute.toLowerCase().includes(searchFilter);\n      const key = getEventAttributeKey(event.name, index, attribute);\n\n      if (isKeyMatch) {\n        matches.push({\n          span,\n          section: 'events',\n          key,\n          isKeyMatch: true,\n          matchIndex: 0,\n        });\n      }\n\n      // event values can be arbitrary JSON\n      const value = JSON.stringify(attributes[attribute]).toLowerCase();\n      const numValueMatches = value.split(searchFilter).length - 1;\n      for (let i = 0; i < numValueMatches; i++) {\n        matches.push({\n          span,\n          section: 'events',\n          key,\n          isKeyMatch: false,\n          matchIndex: i,\n        });\n      }\n    });\n  });\n\n  return matches;\n};\n\n/**\n * This function extracts all the matches from a span based on the search filter,\n * and appends some necessary metadata that is necessary for the jump-to-search\n * function.\n */\nexport const getMatchesFromSpan = (span: ModelTraceSpanNode, searchFilter: string): SearchMatch[] => {\n  // if search filter is empty, don't generate matches\n  // because there will be nothing to highlight anyway\n  if (!searchFilter) {\n    return [];\n  }\n\n  const matches: SearchMatch[] = [];\n\n  const sections = {\n    inputs: span?.inputs,\n    outputs: span?.outputs,\n    attributes: span?.attributes,\n    events: span?.events,\n  };\n\n  map(sections, (section: any, label: 'inputs' | 'outputs' | 'attributes' | 'events') => {\n    if (label === 'events') {\n      matches.push(...getMatchesFromEvent(span, searchFilter));\n      return;\n    }\n\n    const sectionList = createListFromObject(section);\n    sectionList.forEach((item) => {\n      // NOTE: this ignores the fact that there might be multiple matches in a key\n      // for example, if the key is \"aaaaa\", and the search filter is \"a\". However,\n      // implementing support for this case would make the code needlessly complex.\n      // If we receive feedback that this is a problem, we can revisit this.\n      const isKeyMatch = item.key.toLowerCase().includes(searchFilter);\n      if (isKeyMatch) {\n        matches.push({\n          span: span,\n          section: label,\n          key: item.key,\n          isKeyMatch: true,\n          matchIndex: 0,\n        });\n      }\n\n      const numValueMatches = item.value.toLowerCase().split(searchFilter).length - 1;\n      for (let i = 0; i < numValueMatches; i++) {\n        matches.push({\n          span: span,\n          section: label,\n          key: item.key,\n          isKeyMatch: false,\n          matchIndex: i,\n        });\n      }\n    });\n  });\n  return matches;\n};\n\nexport function searchTree(\n  rootNode: ModelTraceSpanNode,\n  searchFilter: string,\n  spanFilterState: SpanFilterState,\n): {\n  filteredTreeNodes: ModelTraceSpanNode[];\n  matches: SearchMatch[];\n} {\n  const searchFilterLowercased = searchFilter.toLowerCase().trim();\n  const allSpanTypesSelected = Object.values(spanFilterState.spanTypeDisplayState).every(\n    (shouldDisplay) => shouldDisplay,\n  );\n  // if there is no search filter and all span types\n  // are selected, then we don't have to do any filtering.\n  if (searchFilterLowercased === '' && allSpanTypesSelected) {\n    return {\n      filteredTreeNodes: [rootNode],\n      matches: [],\n    };\n  }\n\n  const children = rootNode.children ?? [];\n  const filteredChildren: ModelTraceSpanNode[] = [];\n  const matches: SearchMatch[] = [];\n  children.forEach((child) => {\n    const { filteredTreeNodes: childNodes, matches: childMatches } = searchTree(\n      child,\n      searchFilterLowercased,\n      spanFilterState,\n    );\n\n    filteredChildren.push(...childNodes);\n    matches.push(...childMatches);\n  });\n\n  const spanName = ((rootNode.title as string) ?? '').toLowerCase();\n  const spanMatches = getMatchesFromSpan(rootNode, searchFilterLowercased);\n\n  // check if the span passes the text and type filters\n  const nodeMatchesSearch = spanMatches.length > 0 || spanName.includes(searchFilterLowercased);\n  const spanTypeIsDisplayed = rootNode.type ? spanFilterState.spanTypeDisplayState[rootNode.type] : true;\n  const nodePassesSpanFilters = nodeMatchesSearch && spanTypeIsDisplayed;\n\n  const hasMatchingChild = filteredChildren.length > 0;\n  const hasException = getSpanExceptionCount(rootNode) > 0;\n\n  const nodeShouldBeDisplayed =\n    nodePassesSpanFilters ||\n    // the `showParents` and `showExceptions` flags override the\n    // search filters, so we always show the node if they pass\n    (spanFilterState.showParents && hasMatchingChild) ||\n    (spanFilterState.showExceptions && hasException);\n\n  if (nodeShouldBeDisplayed) {\n    return {\n      filteredTreeNodes: [{ ...rootNode, children: filteredChildren }],\n      matches: spanMatches.concat(matches),\n    };\n  }\n\n  // otherwise cut the span out of the tree by returning the children directly\n  return {\n    filteredTreeNodes: filteredChildren,\n    matches,\n  };\n}\n\nexport function searchTreeBySpanId(\n  rootNode: ModelTraceSpanNode | null,\n  selectedSpanId?: string,\n): ModelTraceSpanNode | undefined {\n  if (isNil(selectedSpanId) || isNil(rootNode)) {\n    return undefined;\n  }\n\n  if (rootNode.key === selectedSpanId) {\n    return rootNode;\n  }\n\n  const children = rootNode.children ?? [];\n  for (const child of children) {\n    const matchedNode = searchTreeBySpanId(child, selectedSpanId);\n    if (matchedNode) {\n      return matchedNode;\n    }\n  }\n\n  return undefined;\n}\n\nconst getChatMessagesFromSpan = (\n  messagesAttributeValue: any,\n  inputs: any,\n  outputs: any,\n  messageFormat?: string,\n): ModelTraceChatMessage[] | undefined => {\n  // if the `mlflow.chat.messages` attribute is provided\n  // and in the correct format, return it as-is\n  // we allow content type to be content part list for the `mlflow.chat.messages` attribute\n  if (Array.isArray(messagesAttributeValue) && messagesAttributeValue.every(isRawModelTraceChatMessage)) {\n    return compact(messagesAttributeValue.map(prettyPrintChatMessage));\n  }\n\n  // otherwise, attempt to parse messages from inputs and outputs\n  // this is to support rich rendering for older versions of MLflow\n  // before the `mlflow.chat.messages` attribute was introduced\n  const messagesFromInputs = normalizeConversation(inputs, messageFormat) ?? [];\n  const messagesFromOutputs = normalizeConversation(outputs, messageFormat) ?? [];\n  // when either input or output is not chat messages, we do not set the chat message fiels.\n  if (messagesFromInputs.length === 0 || messagesFromOutputs.length === 0) {\n    return undefined;\n  }\n\n  return messagesFromInputs.concat(messagesFromOutputs);\n};\n\nconst getChatToolsFromSpan = (toolsAttributeValue: any, inputs: any): ModelTraceChatTool[] | undefined => {\n  // if the `mlflow.chat.tools` attribute is provided\n  // and in the correct format, return it as-is\n  if (Array.isArray(toolsAttributeValue) && toolsAttributeValue.every(isModelTraceChatTool)) {\n    return toolsAttributeValue;\n  }\n\n  // otherwise, attempt to parse tools from inputs\n  // TODO: support langchain format for tool inputs\n  if (Array.isArray(inputs?.tools) && inputs?.tools?.every(isModelTraceChatTool)) {\n    return inputs.tools;\n  }\n\n  return undefined;\n};\n\nexport const normalizeNewSpanData = (\n  span: ModelTraceSpan,\n  rootStartTime: number,\n  rootEndTime: number,\n  children: ModelTraceSpanNode[],\n  assessmentMap: Record<string, Assessment[]>,\n  traceId: string,\n): ModelTraceSpanNode => {\n  const spanType = tryDeserializeAttribute(span.attributes?.['mlflow.spanType']);\n  const inputs = tryDeserializeAttribute(span.attributes?.['mlflow.spanInputs']);\n  const outputs = tryDeserializeAttribute(span.attributes?.['mlflow.spanOutputs']);\n  const parentId = getModelTraceSpanParentId(span);\n  const spanId = getModelTraceSpanId(span);\n\n  const assessments = assessmentMap[spanId] ?? [];\n  if (!parentId) {\n    // assessments that are not associated with a specific\n    // span should be displayed at the root.\n    assessments.push(...(assessmentMap[''] ?? []));\n  }\n\n  // data that powers the \"chat\" tab\n  const messagesAttributeValue = tryDeserializeAttribute(span.attributes?.['mlflow.chat.messages']);\n  const messageFormat = tryDeserializeAttribute(span.attributes?.['mlflow.message.format']);\n  const chatMessages = getChatMessagesFromSpan(messagesAttributeValue, inputs, outputs, messageFormat);\n  const chatTools = getChatToolsFromSpan(tryDeserializeAttribute(span.attributes?.['mlflow.chat.tools']), inputs);\n\n  // remove other private mlflow attributes\n  const attributes = mapValues(\n    omitBy(span.attributes, (_, key) => key.startsWith('mlflow.')),\n    (value) => tryDeserializeAttribute(value),\n  );\n  const events = span.events;\n  const start = (Number(getModelTraceSpanStartTime(span)) - rootStartTime) / 1000;\n  const end = (Number(getModelTraceSpanEndTime(span) ?? rootEndTime) - rootStartTime) / 1000;\n\n  return {\n    title: span.name,\n    icon: (\n      <ModelTraceExplorerIcon\n        type={getIconTypeForSpan(spanType)}\n        hasException={getSpanExceptionCount(span) > 0}\n        isRootSpan={!parentId}\n      />\n    ),\n    type: spanType,\n    key: spanId,\n    start,\n    end,\n    children,\n    inputs,\n    outputs,\n    attributes,\n    events,\n    chatMessages,\n    chatTools,\n    parentId,\n    assessments,\n    traceId,\n  };\n};\n\nconst base64ToHex = (base64: string): string => {\n  const binaryString = atob(base64);\n  const binaryLen = binaryString.length;\n  let hex = '';\n  for (let i = 0; i < binaryLen; i++) {\n    const charCode = binaryString.charCodeAt(i);\n    hex += charCode.toString(16).padStart(2, '0');\n  }\n  return hex;\n};\n\n// mlflow span ids are meant to be interpreted as hex strings\nexport const decodeSpanId = (spanId: string | null | undefined, isV3Span: boolean): string => {\n  if (!spanId) {\n    return '';\n  }\n\n  if (isV3Span) {\n    // v3 span ids are base64 encoded\n    try {\n      return base64ToHex(spanId);\n    } catch (e) {\n      // if base64 decoding fails, just return the original spanId\n      return spanId;\n    }\n  }\n\n  // old V2 span ids (pre-March 2025) are in hex with a 0x prefix\n  if (spanId.startsWith('0x')) {\n    return spanId.slice(2);\n  }\n\n  // new V2 span ids have the prefix stripped\n  return spanId;\n};\n\nexport function isV3ModelTraceInfo(info: ModelTrace['info']): info is ModelTraceInfoV3 {\n  return 'trace_metadata' in info;\n}\n\nexport function isV3ModelTraceSpan(span: ModelTraceSpan): span is ModelTraceSpanV3 {\n  return 'start_time_unix_nano' in span;\n}\n\nexport function isV2ModelTraceSpan(span: ModelTraceSpan): span is ModelTraceSpanV2 {\n  return 'parent_id' in span;\n}\n\nexport function getModelTraceSpanId(span: ModelTraceSpan): string {\n  return isV3ModelTraceSpan(span)\n    ? decodeSpanId(span.span_id ?? '', true)\n    : decodeSpanId(span.context?.span_id ?? '', false);\n}\n\nexport function getModelTraceSpanParentId(span: ModelTraceSpan): string {\n  return isV3ModelTraceSpan(span)\n    ? decodeSpanId(span.parent_span_id ?? '', true)\n    : decodeSpanId(span.parent_id ?? '', false);\n}\n\nexport function getModelTraceSpanStartTime(span: ModelTraceSpan): number {\n  return isV3ModelTraceSpan(span) ? Number(span.start_time_unix_nano) : Number(span.start_time);\n}\n\nexport function getModelTraceSpanEndTime(span: ModelTraceSpan): number {\n  return isV3ModelTraceSpan(span) ? Number(span.end_time_unix_nano) : Number(span.end_time);\n}\n\nexport function getModelTraceId(trace: ModelTrace): string {\n  return isV3ModelTraceInfo(trace.info) ? trace.info.trace_id : trace.info.request_id ?? '';\n}\n\n// get the size of the trace in bytes, or null if the size is not available\nexport function getModelTraceSize(trace: ModelTrace): number | null {\n  if (!isV3ModelTraceInfo(trace.info)) {\n    return null;\n  }\n\n  const size = Number(trace.info?.trace_metadata?.['mlflow.trace.sizeBytes']);\n  return !isNil(size) && !isNaN(size) ? size : null;\n}\n\nexport function parseModelTraceToTree(trace: ModelTrace): ModelTraceSpanNode | null {\n  const traceId = getModelTraceId(trace);\n  const spans = trace.trace_data?.spans ?? trace.data.spans;\n  const spanMap: { [span_id: string]: ModelTraceSpan } = {};\n  const relationMap: { [span_id: string]: string[] } = {};\n\n  spans.forEach((span) => {\n    const spanId = getModelTraceSpanId(span);\n    spanMap[spanId] = span;\n    relationMap[spanId] = [];\n  });\n\n  spans.forEach((span) => {\n    const spanId = getModelTraceSpanId(span);\n    const parentId = getModelTraceSpanParentId(span);\n    if (parentId) {\n      if (!relationMap[parentId]) {\n        throw new Error('Tree structure is malformed!');\n      }\n      relationMap[parentId].push(spanId);\n    }\n  });\n\n  const rootSpan = spans.find((span) => !getModelTraceSpanParentId(span));\n  if (isNil(rootSpan)) {\n    return null;\n  }\n\n  const rootSpanId = getModelTraceSpanId(rootSpan);\n  function getSpanNodeFromData(span_id: string): ModelTraceSpanNode {\n    const span = spanMap[span_id];\n    // above we return if rootSpan is null, but for some\n    // reason typescript thinks it's still nullable here.\n    const rootStart = Number(getModelTraceSpanStartTime(rootSpan as ModelTraceSpan));\n    const rootEnd = Number(getModelTraceSpanEndTime(rootSpan as ModelTraceSpan));\n    const children = relationMap[span_id].map(getSpanNodeFromData);\n    const assessmentMap = getAssessmentMap(trace.info);\n\n    // not using `isV2Span` here because for legacy reasons,\n    // V1 and V2 are rolled into in the same type. \"parent_id\" is\n    // the way we distinguish between the two.\n    if (isV3ModelTraceSpan(span) || 'parent_id' in span) {\n      // reusing the same function for v2 and v3 as the changes are small\n      return normalizeNewSpanData(span, rootStart, rootEnd, children, assessmentMap, traceId);\n    }\n\n    // v1 spans\n    const spanType = span.span_type ?? ModelSpanType.UNKNOWN;\n    return {\n      title: span.name,\n      icon: <ModelTraceExplorerIcon type={getIconTypeForSpan(spanType)} />,\n      type: spanType as ModelSpanType,\n      key: span.context.span_id,\n      start: Number(span.start_time) - rootStart,\n      // default to the end of the root span if the span has no end time.\n      // this can happen if an exception was thrown in the span.\n      end: Number(span.end_time ?? rootEnd) - rootStart,\n      children: children,\n      inputs: span.inputs,\n      outputs: span.outputs,\n      attributes: span.attributes,\n      events: span.events,\n      parentId: span.parent_id ?? span.parent_span_id,\n      assessments: [],\n      traceId,\n    };\n  }\n\n  return getSpanNodeFromData(rootSpanId);\n}\n\n// returns a map of { [span_id: string] : Assessment[] }\nexport const getAssessmentMap = (traceInfo: ModelTrace['info']): Record<string, Assessment[]> => {\n  let assessments: Assessment[] = [];\n  if (isV3ModelTraceInfo(traceInfo)) {\n    assessments = traceInfo.assessments ?? [];\n  } else {\n    assessments = getAssessmentsFromTags(traceInfo.tags);\n  }\n\n  // hydrate the assessments with the overridden assessment objects\n  const assessmentsById = keyBy(assessments, 'assessment_id');\n  Object.values(assessmentsById).forEach((assessment) => {\n    if (assessment.overrides) {\n      const overriddenAssessment = assessmentsById[assessment.overrides];\n      assessment.overriddenAssessment = overriddenAssessment;\n    }\n  });\n\n  assessments = Object.values(assessmentsById);\n\n  // construct the map by reducing over the assessments\n  const assessmentMap = assessments.reduce((acc: Record<string, Assessment[]>, assessment: Assessment) => {\n    const spanId = assessment.span_id ?? '';\n    if (!acc[spanId]) {\n      acc[spanId] = [];\n    }\n    acc[spanId].push(assessment);\n    return acc;\n  }, {});\n\n  // sort the assessments by last_update_time\n  Object.keys(assessmentMap).forEach((spanId) => {\n    assessmentMap[spanId].sort(\n      (a, b) => new Date(b.last_update_time).getTime() - new Date(a.last_update_time).getTime(),\n    );\n  });\n\n  return assessmentMap;\n};\n\n// parses assessments out from the trace tags\nconst getAssessmentsFromTags = (tags: ModelTrace['info']['tags']): Assessment[] => {\n  if (!tags) {\n    return [];\n  }\n\n  const tagList = Array.isArray(tags) ? tags : Object.entries(tags).map(([key, value]) => ({ key, value }));\n\n  return tagList.filter(({ key }) => key.startsWith('mlflow.assessment.')).map(({ value }) => JSON.parse(value));\n};\n\n// this function attempts to extract the trace version from\n// a given source (either request_metadata or tags)\nexport function findTraceVersionByKey(\n  source: { [key: string]: string } | { key: string; value: string }[] | undefined,\n): string | undefined {\n  if (!source) {\n    return undefined;\n  }\n\n  if (isArray(source)) {\n    return source.find((tag) => tag.key === MLFLOW_TRACE_SCHEMA_VERSION_KEY)?.value;\n  }\n\n  return source[MLFLOW_TRACE_SCHEMA_VERSION_KEY];\n}\n\n// this function determines whether an object is a ModelTrace by asserting\n// that the object has the `data` and `info` fields, and that the\n// trace info contains the `mlflow.trace_schema.version` key\nexport const isModelTrace = (trace: any): trace is ModelTrace => {\n  const traceInfo = trace?.info;\n  const traceData = trace?.data;\n  if (!traceInfo || !traceData || !traceData?.spans) {\n    return false;\n  }\n\n  // request_metadata is for V2 traces, trace_metadata is for V3 traces\n  const metadata = traceInfo?.request_metadata ?? traceInfo?.trace_metadata;\n  if (metadata && findTraceVersionByKey(metadata)) {\n    return true;\n  }\n\n  const tags = traceInfo?.tags;\n  if (tags && findTraceVersionByKey(tags)) {\n    return true;\n  }\n\n  return false;\n};\n\nexport const createListFromObject = (\n  obj: { [key: string]: any } | string[] | string | boolean | number | undefined,\n) => {\n  if (isNil(obj)) {\n    return [];\n  }\n\n  if (Array.isArray(obj) || isString(obj) || isNumber(obj) || isBoolean(obj)) {\n    return [{ key: '', value: JSON.stringify(obj, null, 2) }];\n  }\n\n  return Object.entries(obj).map(([key, value]) => {\n    return { key, value: JSON.stringify(value, null, 2) };\n  });\n};\n\nexport const getHighlightedSpanComponents = ({\n  searchFilter,\n  data,\n  activeMatchBackgroundColor,\n  inactiveMatchBackgroundColor,\n  containsActiveMatch,\n  activeMatch,\n  scrollToActiveMatch,\n}: {\n  searchFilter: string;\n  data: string;\n  activeMatchBackgroundColor: string;\n  inactiveMatchBackgroundColor: string;\n  containsActiveMatch: boolean;\n  activeMatch: SearchMatch;\n  scrollToActiveMatch: (node: HTMLSpanElement) => void;\n}) => {\n  // splitting by regex retains the matches in the array,\n  // which makes it easier to handle stuff like preserving\n  // the original case of the match.\n  const regex = new RegExp(`(${escapeRegExp(searchFilter.trim())})`, 'gi');\n  const parts = data.split(regex);\n  const spans: React.ReactNode[] = [];\n  let matchIndex = 0;\n\n  for (let i = 0; i < parts.length; i++) {\n    if (parts[i].toLowerCase().includes(searchFilter.toLowerCase().trim())) {\n      const isActiveMatch = containsActiveMatch && activeMatch.matchIndex === matchIndex;\n      const backgroundColor = isActiveMatch ? activeMatchBackgroundColor : inactiveMatchBackgroundColor;\n      const span = (\n        <span ref={isActiveMatch ? scrollToActiveMatch : null} key={i} css={{ backgroundColor, scrollMarginTop: 50 }}>\n          {parts[i]}\n        </span>\n      );\n      matchIndex++;\n      spans.push(span);\n    } else {\n      spans.push(parts[i]);\n    }\n  }\n\n  return spans;\n};\n\nexport const isRetrieverDocument = (document: any): document is RetrieverDocument => {\n  return has(document, 'page_content');\n};\n\nexport const isRenderableRetrieverSpan = (span: ModelTraceSpanNode): boolean => {\n  return (\n    span.type === ModelSpanType.RETRIEVER &&\n    Array.isArray(span.outputs) &&\n    span.outputs.length > 0 &&\n    every(span.outputs, isRetrieverDocument)\n  );\n};\n\nexport const getEventAttributeKey = (name: string, index: number, attribute: string): string => {\n  return `${name}-${index}-${attribute}`;\n};\n\nexport const getSpanExceptionEvents = (span: ModelTraceSpanNode | ModelTraceSpan): ModelTraceEvent[] => {\n  return (span.events ?? []).filter((event) => event.name === 'exception');\n};\n\nexport const getSpanExceptionCount = (span: ModelTraceSpanNode | ModelTraceSpan): number => {\n  return getSpanExceptionEvents(span).length;\n};\n\nexport const isModelTraceChatToolParamProperty = (obj: any): obj is ModelTraceChatToolParamProperty => {\n  if (isNil(obj)) {\n    return false;\n  }\n\n  if (!isNil(obj.type) && !isString(obj.type)) {\n    return false;\n  }\n\n  if (!isNil(obj.description) && !isString(obj.description)) {\n    return false;\n  }\n\n  if (!isNil(obj.enum) && !Array.isArray(obj.enum)) {\n    return false;\n  }\n\n  return true;\n};\n\nexport const isModelTraceChatTool = (obj: any): obj is ModelTraceChatTool => {\n  if (isNil(obj) || obj.type !== 'function' || !has(obj, 'function.name')) {\n    return false;\n  }\n\n  // conditional validation for the `parameters` field\n  const parameters = obj.function?.parameters;\n  if (!isNil(parameters)) {\n    // if `required` is present, it must be a list of strings\n    const required = parameters.required;\n    if (!isNil(required) && (!Array.isArray(required) || !required.every(isString))) {\n      return false;\n    }\n\n    const properties = parameters.properties;\n    if (!isNil(properties) && !Object.values(properties).every(isModelTraceChatToolParamProperty)) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nexport const isModelTraceToolCall = (obj: any): obj is ModelTraceToolCall => {\n  return obj && isString(obj.id) && isString(obj.function?.arguments) && isString(obj.function?.name);\n};\n\nconst isContentPart = (part: any) => {\n  switch (part.type) {\n    case 'text':\n    case 'input_text':\n    case 'output_text':\n      return isString(part.text);\n    case 'image_url':\n      const { image_url } = part;\n      if (isNil(image_url)) {\n        return false;\n      }\n      return isString(image_url.url) && (isNil(image_url.detail) || ['auto', 'low', 'high'].includes(image_url.detail));\n    case 'input_audio':\n      const { input_audio } = part;\n      if (isNil(input_audio)) {\n        return false;\n      }\n      return isString(input_audio.data) && (isNil(input_audio.format) || ['wav', 'mp3'].includes(input_audio.format));\n    default:\n      return false;\n  }\n};\n\nconst isContentType = (content: any) => {\n  if (isNil(content) || isString(content)) {\n    return true;\n  }\n\n  if (isArray(content)) {\n    return content.every((part) => isContentPart(part));\n  }\n\n  return false;\n};\n\nexport const isModelTraceChatMessage = (message: any): message is ModelTraceChatMessage => {\n  if (!isRawModelTraceChatMessage(message)) {\n    return false;\n  }\n\n  return isNil(message.content) || isString(message.content);\n};\n\nexport const isRawModelTraceChatMessage = (message: any): message is RawModelTraceChatMessage => {\n  if (!message) {\n    return false;\n  }\n\n  if (message.tool_calls) {\n    if (!Array.isArray(message.tool_calls)) {\n      return false;\n    }\n\n    if (!message.tool_calls.every(isModelTraceToolCall)) {\n      return false;\n    }\n  }\n\n  if (message.type === 'reasoning') {\n    return true;\n  }\n\n  // verify if the message content is a valid content type or not\n  if (!isContentType(message.content)) {\n    return false;\n  }\n\n  return (\n    message.role === 'user' || message.role === 'assistant' || message.role === 'system' || message.role === 'tool'\n  );\n};\n\nexport const isModelTraceChatInput = (obj: any): obj is ModelTraceChatInput => {\n  return (\n    obj && Array.isArray(obj.messages) && obj.messages.length > 0 && obj.messages.every(isRawModelTraceChatMessage)\n  );\n};\n\nexport const isModelTraceChoices = (obj: any): obj is ModelTraceChatResponse['choices'] => {\n  return (\n    Array.isArray(obj) &&\n    obj.length > 0 &&\n    obj.every((choice: any) => has(choice, 'message') && isModelTraceChatMessage(choice.message))\n  );\n};\n\nexport const isModelTraceChatResponse = (obj: any): obj is ModelTraceChatResponse => {\n  return obj && isModelTraceChoices(obj.choices);\n};\n\n/**\n * Attempt to normalize a conversation, return null in case the format is unrecognized\n *\n * Supported formats:\n *   1. Langchain chat inputs\n *   2. Langchain chat results\n *   3. OpenAI ChatCompletions inputs\n *   4. OpenAI ChatCompletions responses\n *   5. OpenAI Responses inputs\n *   6. OpenAI Responses output\n *   7. LlamaIndex chat responses\n *   8. DSPy chat inputs\n *   8. DSPy chat outputs\n *   9. Gemini inputs\n *  10. Gemini outputs\n *  11. Anthropic inputs\n *  12. Anthropic outputs\n *  13. OpenAI Agent inputs\n *  14. OpenAI Agent outputs\n *  15. Autogen inputs\n *  16. Autogen outputs\n *  17. Bedrock inputs\n *  18. Bedrock outputs\n */\nexport const normalizeConversation = (input: any, messageFormat?: string): ModelTraceChatMessage[] | null => {\n  // wrap in try/catch to avoid crashing the UI. we're doing a lot of type coercion\n  // and formatting, and it's possible that we miss some edge cases. in case of an error,\n  // simply return null to signify that the input is not a chat input.\n  try {\n    // if the input is already in the correct format, return it\n    if (Array.isArray(input) && input.length > 0 && input.every(isRawModelTraceChatMessage)) {\n      return compact(input.map(prettyPrintChatMessage));\n    }\n\n    switch (messageFormat) {\n      case 'langchain':\n        const langchainMessages = normalizeLangchainChatInput(input) ?? normalizeLangchainChatResult(input);\n        if (langchainMessages) return langchainMessages;\n        break;\n      case 'llamaindex':\n        const llamaIndexMessages = normalizeLlamaIndexChatInput(input) ?? normalizeLlamaIndexChatResponse(input);\n        if (llamaIndexMessages) return llamaIndexMessages;\n        break;\n      case 'openai':\n        const openAIMessages =\n          normalizeOpenAIChatInput(input) ??\n          normalizeOpenAIChatResponse(input) ??\n          normalizeOpenAIResponsesOutput(input) ??\n          normalizeOpenAIResponsesInput(input);\n        if (openAIMessages) return openAIMessages;\n        break;\n      case 'dspy':\n        const dspyMessages = normalizeDspyChatInput(input) ?? normalizeDspyChatOutput(input);\n        if (dspyMessages) return dspyMessages;\n        break;\n      case 'gemini':\n        const geminiMessages = normalizeGeminiChatInput(input) ?? normalizeGeminiChatOutput(input);\n        if (geminiMessages) return geminiMessages;\n        break;\n      case 'anthropic':\n        const anthropicMessages = normalizeAnthropicChatInput(input) ?? normalizeAnthropicChatOutput(input);\n        if (anthropicMessages) return anthropicMessages;\n        break;\n      case 'openai-agent':\n        const openAIAgentMessages = normalizeOpenAIAgentInput(input) ?? normalizeOpenAIAgentOutput(input);\n        if (openAIAgentMessages) return openAIAgentMessages;\n        break;\n      case 'autogen':\n        const autogenMessages = normalizeAutogenChatInput(input) ?? normalizeAutogenChatOutput(input);\n        if (autogenMessages) return autogenMessages;\n        break;\n      case 'bedrock':\n        const bedrockMessages = normalizeBedrockChatInput(input) ?? normalizeBedrockChatOutput(input);\n        if (bedrockMessages) return bedrockMessages;\n        break;\n      default:\n        // Fallback to OpenAI chat format\n        const chatMessages = normalizeOpenAIChatInput(input) ?? normalizeOpenAIChatResponse(input);\n        if (chatMessages) return chatMessages;\n        break;\n    }\n    return null;\n  } catch (e) {\n    return null;\n  }\n};\n\nexport const prettyPrintToolCall = (toolCall: ModelTraceToolCall): ModelTraceToolCall => {\n  // add some spacing to the arguments for better readability\n  let args = toolCall.function?.arguments;\n  try {\n    args = JSON.stringify(JSON.parse(args), null, 2);\n  } catch (e) {\n    // use original args\n  }\n  return {\n    id: toolCall.id,\n    function: {\n      arguments: args,\n      name: toolCall.function.name,\n    },\n  };\n};\n\nconst formatChatContent = (content?: ModelTraceContentType | null): string | undefined | null => {\n  if (isNil(content) || isString(content)) {\n    return content;\n  }\n\n  const contentParts = content\n    // eslint-disable-next-line array-callback-return\n    .map((part) => {\n      switch (part.type) {\n        case 'text':\n        case 'input_text':\n        case 'output_text':\n          return part.text;\n        case 'image_url':\n          const url = part?.image_url?.url;\n          return url ? `![](${url})` : '[image]';\n        case 'input_audio':\n          // raw encoded audio content is not displayed in the UI\n          return '[audio]';\n      }\n    })\n    .filter((part) => part !== undefined);\n\n  // Join with double line breaks for better visual separation\n  return contentParts.join('\\n\\n');\n};\n\nexport const prettyPrintChatMessage = (message: RawModelTraceChatMessage): ModelTraceChatMessage | null => {\n  // TODO: support rich rendering of reasoning messages\n  // for now, just return null and compact it away in the caller\n  // this is because we want to still render the rest of the message\n  // outputs.\n  if (message.type === 'reasoning') {\n    return null;\n  }\n\n  return {\n    ...message,\n    content: formatChatContent(message.content),\n    tool_calls: message.tool_calls?.map(prettyPrintToolCall),\n  };\n};\n","import type { TimelineTreeNode } from './timeline-tree';\n\nexport const MLFLOW_TRACE_SCHEMA_VERSION_KEY = 'mlflow.trace_schema.version';\n\n// column name for mlflow trace data in inference tables\nexport const INFERENCE_TABLE_RESPONSE_COLUMN_KEY = 'response';\nexport const INFERENCE_TABLE_TRACE_COLUMN_KEY = 'trace';\n\nexport type ModelTraceExplorerRenderMode = 'default' | 'json';\n\nexport enum ModelSpanType {\n  LLM = 'LLM',\n  CHAIN = 'CHAIN',\n  AGENT = 'AGENT',\n  TOOL = 'TOOL',\n  FUNCTION = 'FUNCTION',\n  CHAT_MODEL = 'CHAT_MODEL',\n  RETRIEVER = 'RETRIEVER',\n  PARSER = 'PARSER',\n  EMBEDDING = 'EMBEDDING',\n  RERANKER = 'RERANKER',\n  MEMORY = 'MEMORY',\n  UNKNOWN = 'UNKNOWN',\n}\n\nexport enum ModelIconType {\n  MODELS = 'models',\n  DOCUMENT = 'document',\n  CONNECT = 'connect',\n  SEARCH = 'search',\n  SORT = 'sort',\n  UNKNOWN = 'unknown',\n  FUNCTION = 'function',\n  CODE = 'code',\n  NUMBERS = 'numbers',\n  WRENCH = 'wrench',\n  AGENT = 'agent',\n  CHAIN = 'chain',\n  USER = 'user',\n  SYSTEM = 'system',\n  SAVE = 'save',\n}\n\n/**\n * Represents a single model trace span.\n * Based on https://github.com/mlflow/mlflow/blob/tracing/mlflow/entities/span.py\n *\n * TODO: clean up all deprecated fields after PrPr customers swap over to\n *       the latest version of mlflow tracing\n */\nexport type ModelTraceSpanV2 = {\n  context: {\n    span_id: string;\n    trace_id: string;\n  };\n  name: string;\n  /* deprecated, renamed to `parent_id` */\n  parent_span_id?: string | null;\n  parent_id?: string | null;\n  /* deprecated, contained in attributes['mlflow.spanType'] */\n  span_type?: ModelSpanType | string;\n  /* deprecated, migrated to `status_code` and `status_message` */\n  status?: ModelTraceStatus;\n  status_code?: string;\n  status_message?: string | null;\n  start_time: number;\n  end_time: number;\n  /* deprecated, contained in attributes['mlflow.spanInputs'] */\n  inputs?: any;\n  /* deprecated, contained in attributes['mlflow.spanOutputs'] */\n  outputs?: any;\n  attributes?: Record<string, any>;\n  events?: ModelTraceEvent[];\n  /* metadata for ui usage logging */\n  type?: ModelSpanType;\n};\n\nexport type ModelTraceSpanV3 = {\n  trace_id: string;\n  span_id: string;\n  // can be empty\n  trace_state: string;\n  // can be empty or null\n  parent_span_id: string | null;\n  name: string;\n  start_time_unix_nano: string;\n  end_time_unix_nano: string;\n  status: {\n    code: ModelSpanStatusCode;\n    message?: string;\n  };\n  attributes: Record<string, any>;\n  events?: ModelTraceEvent[];\n  /* metadata for ui usage logging */\n  type?: ModelSpanType;\n};\n\nexport type ModelTraceSpan = ModelTraceSpanV2 | ModelTraceSpanV3;\n\nexport type ModelTraceEvent = {\n  name: string;\n  /* deprecated as of v3, migrated to `time_unix_nano` */\n  timestamp?: number;\n  time_unix_nano?: number;\n  attributes?: Record<string, any>;\n};\n\nexport type ModelTraceData = {\n  spans: ModelTraceSpan[];\n};\n\n/**\n * Represents a single model trace object.\n * Based on https://github.com/mlflow/mlflow/blob/8e44d102e9568d09d9dc376136d13a5a5d1ab46f/mlflow/tracing/types/model.py#L11\n */\nexport type ModelTrace = {\n  /* deprecated, renamed to `data` */\n  trace_data?: ModelTraceData;\n  /* deprecated, renamed to `info` */\n  trace_info?: ModelTraceInfo;\n  data: ModelTraceData;\n  info: ModelTraceInfoV3 | ModelTraceInfo | NotebookModelTraceInfo;\n};\n\n/**\n * Represents the trace data saved in an inference table.\n * https://github.com/databricks/universe/blob/fb8a572602161aa6387ac32593aa24a91518cc32/rag/serving/python/databricks/rag/unpacking/schemas.py#L133-L141\n */\nexport type ModelTraceInferenceTableData = {\n  app_version_id: string;\n  start_timestamp: string;\n  end_timestamp: string;\n  is_truncated: boolean;\n  [MLFLOW_TRACE_SCHEMA_VERSION_KEY]: number;\n  spans: (Omit<ModelTraceSpan, 'attributes'> & {\n    attributes: string;\n  })[];\n};\n\nexport type ModelTraceInfo = {\n  request_id?: string;\n  experiment_id?: string;\n  timestamp_ms?: number;\n  execution_time_ms?: number;\n  status?: ModelTraceStatus['description'];\n  attributes?: Record<string, any>;\n  request_metadata?: { key: string; value: string }[];\n  tags?: { key: string; value: string }[];\n};\n\n// tags and request_metadata in the notebook view\n// (i.e. displayed directly from the python client)\n// are stored as an object rather than an array.\nexport type NotebookModelTraceInfo = Omit<ModelTraceInfo, 'tags' | 'request_metadata'> & {\n  tags?: { [key: string]: string };\n  request_metadata?: { [key: string]: string };\n};\n\nexport type ModelTraceLocationMlflowExperiment = {\n  type: 'MLFLOW_EXPERIMENT';\n  mlflow_experiment: {\n    experiment_id: string;\n  };\n};\n\nexport type ModelTraceLocationInferenceTable = {\n  type: 'INFERENCE_TABLE';\n  inference_table: {\n    full_table_name: string;\n  };\n};\n\nexport type ModelTraceLocation = ModelTraceLocationMlflowExperiment | ModelTraceLocationInferenceTable;\n\nexport type ModelTraceInfoV3 = {\n  trace_id: string;\n  client_request_id?: string;\n  trace_location: ModelTraceLocation;\n  request_preview?: string;\n  response_preview?: string;\n  // timestamp in a format like \"2025-02-19T09:52:23.140Z\"\n  request_time: string;\n  // formatted duration string like \"32.4s\"\n  execution_duration: string;\n  state: ModelTraceState;\n  trace_metadata: {\n    [key: string]: string;\n  };\n  assessments: Assessment[];\n  tags: {\n    [key: string]: string;\n  };\n};\n\nexport type ModelTraceState = 'STATE_UNSPECIFIED' | 'OK' | 'ERROR' | 'IN_PROGRESS';\n\nexport type ModelSpanStatusCode = 'STATUS_CODE_UNSET' | 'STATUS_CODE_OK' | 'STATUS_CODE_ERROR';\n\nexport type ModelTraceStatusUnset = {\n  description: 'UNSET';\n  status_code: 0;\n};\n\nexport type ModelTraceStatusOk = {\n  description: 'OK';\n  status_code: 1;\n};\n\nexport type ModelTraceStatusError = {\n  description: 'ERROR';\n  status_code: 2;\n};\n\nexport type ModelTraceStatusInProgress = {\n  description: 'IN_PROGRESS';\n  status_code: 3;\n};\n\nexport enum ModelTraceSpanType {\n  LLM = 'LLM',\n  CHAIN = 'CHAIN',\n  AGENT = 'AGENT',\n  TOOL = 'TOOL',\n  CHAT_MODEL = 'CHAT_MODEL',\n  RETRIEVER = 'RETRIEVER',\n  PARSER = 'PARSER',\n  EMBEDDING = 'EMBEDDING',\n  RERANKER = 'RERANKER',\n  MEMORY = 'MEMORY',\n  UNKNOWN = 'UNKNOWN',\n}\n\nexport type ModelTraceStatus =\n  | ModelTraceStatusUnset\n  | ModelTraceStatusOk\n  | ModelTraceStatusError\n  | ModelTraceStatusInProgress;\n\n/**\n * Represents a single node in the model trace tree.\n */\nexport interface ModelTraceSpanNode extends TimelineTreeNode, Pick<ModelTraceSpan, 'attributes' | 'type' | 'events'> {\n  assessments: Assessment[];\n  inputs?: any;\n  outputs?: any;\n  children?: ModelTraceSpanNode[];\n  chatMessages?: ModelTraceChatMessage[];\n  chatTools?: ModelTraceChatTool[];\n  parentId?: string | null;\n  traceId: string;\n}\n\nexport type ModelTraceExplorerTab = 'chat' | 'content' | 'attributes' | 'events';\n\nexport type SearchMatch = {\n  span: ModelTraceSpanNode;\n  section: 'inputs' | 'outputs' | 'attributes' | 'events';\n  key: string;\n  isKeyMatch: boolean;\n  matchIndex: number;\n};\n\nexport type SpanFilterState = {\n  // always show parents regardless of filter state\n  showParents: boolean;\n  // always show exceptions regardless of filter state\n  showExceptions: boolean;\n  // record of span_type: whether to show it\n  spanTypeDisplayState: Record<string, boolean>;\n};\n\nexport interface RetrieverDocument {\n  metadata: {\n    doc_uri: string;\n    chunk_id: string;\n    [key: string]: any;\n  };\n  page_content: string;\n  [key: string]: any;\n}\n\nexport enum CodeSnippetRenderMode {\n  JSON = 'json',\n  TEXT = 'text',\n  MARKDOWN = 'markdown',\n  PYTHON = 'python',\n}\n\ntype ModelTraceTextContentPart = {\n  type: 'text' | 'input_text' | 'output_text';\n  text: string;\n};\n\ntype ModelTraceImageUrl = {\n  url: string;\n  detail?: 'auto' | 'low' | 'high';\n};\n\ntype ModelTraceImageContentPart = {\n  type: 'image_url';\n  image_url: ModelTraceImageUrl;\n};\n\ntype ModelTraceInputAudio = {\n  data: string;\n  format: 'wav' | 'mp3';\n};\n\ntype ModelTraceAudioContentPart = {\n  type: 'input_audio';\n  input_audio: ModelTraceInputAudio;\n};\n\nexport type ModelTraceContentParts =\n  | ModelTraceTextContentPart\n  | ModelTraceImageContentPart\n  | ModelTraceAudioContentPart;\n\nexport type ModelTraceContentType = string | ModelTraceContentParts[];\n\n// We treat content as string in the tracing UI.\nexport type ModelTraceChatMessage = {\n  role: 'system' | 'user' | 'assistant' | 'tool' | 'function' | 'developer';\n  name?: string;\n  content?: string | null;\n  tool_calls?: ModelTraceToolCall[];\n  tool_call_id?: string;\n};\n\n// The actual chat message schema of mlflow contains string, null and content part list.\nexport type RawModelTraceChatMessage = Omit<ModelTraceChatMessage, 'content'> & {\n  // there are other types, but we don't support them yet\n  type?: 'message' | 'reasoning';\n  content?: ModelTraceContentType | null;\n};\n\nexport type ModelTraceChatToolParamProperty = {\n  type?: string;\n  description?: string;\n  enum?: string[];\n};\n\nexport type ModelTraceChatTool = {\n  type: 'function';\n  function: {\n    name: string;\n    description?: string;\n    parameters?: {\n      properties: {\n        [key: string]: ModelTraceChatToolParamProperty;\n      };\n      required?: string[];\n    };\n  };\n};\n\nexport type ModelTraceToolCall = {\n  id: string;\n  function: {\n    arguments: string;\n    name: string;\n  };\n};\n\n// aligned to the OpenAI format\nexport type ModelTraceChatResponse = {\n  choices: {\n    message: ModelTraceChatMessage;\n  }[];\n};\n\nexport type ModelTraceChatInput = {\n  messages: RawModelTraceChatMessage[];\n};\n\nexport type AssessmentSourceType = 'SOURCE_TYPE_UNSPECIFIED' | 'HUMAN' | 'LLM_JUDGE' | 'CODE';\n\nexport interface AssessmentSource {\n  source_type: AssessmentSourceType;\n  // Identifier for the source. For example:\n  // - For a human source -> user name\n  // - For an LLM judge -> the judge source (databricks or custom)\n  // - For a code judge -> the function name\n  source_id: string;\n}\n\nexport interface AssessmentError {\n  error_code: string;\n  error_message?: string;\n  stack_trace?: string;\n}\n\nexport type AssessmentValue = string | number | boolean | null | string[];\n\nexport interface Feedback {\n  // can be null / undefined if error is present\n  value?: AssessmentValue;\n  error?: AssessmentError;\n}\n\nexport interface ExpectationValue {\n  value: AssessmentValue;\n}\n\nexport interface ExpectationSerializedValue {\n  serialized_value: {\n    value: string;\n    serialization_format: string;\n  };\n}\n\nexport type Expectation = ExpectationValue | ExpectationSerializedValue;\n\n// should be aligned with `mlflow/api/proto/service.proto`\nexport interface AssessmentBase {\n  assessment_id: string;\n  assessment_name: string;\n  trace_id: string;\n  source: AssessmentSource;\n  span_id?: string;\n\n  // the time fields are in the form of a string timestamp\n  // e.g. \"2025-04-18T04:01:20.159Z\"\n  create_time: string;\n  last_update_time: string;\n\n  rationale?: string;\n  metadata?: Record<string, string>;\n\n  // if false, the assessment is not valid and should not be displayed\n  // undefined and true should be considered valid.\n  valid?: boolean;\n\n  // the assessment_id of the assessment that this assessment overrides\n  overrides?: string;\n\n  // UI only field to store the overridden assessment object for easier display\n  overriddenAssessment?: Assessment;\n}\n\nexport interface FeedbackAssessment extends AssessmentBase {\n  feedback: Feedback;\n}\n\nexport interface ExpectationAssessment extends AssessmentBase {\n  expectation: Expectation;\n}\n\nexport type Assessment = FeedbackAssessment | ExpectationAssessment;\n","import { MlflowService } from '../sdk/MlflowService';\nimport type { ModelTrace } from '@databricks/web-shared/model-trace-explorer';\n\n/**\n * Fetches trace information and data for a given trace ID.\n *\n * @param traceId - The ID of the trace to fetch\n * @returns Promise resolving to ModelTrace object or undefined if trace cannot be fetched\n */\nexport async function getTrace(traceId?: string): Promise<ModelTrace | undefined> {\n  if (!traceId) {\n    return undefined;\n  }\n\n  const [traceInfoResponse, traceData] = await Promise.all([\n    MlflowService.getExperimentTraceInfoV3(traceId),\n    MlflowService.getExperimentTraceData(traceId),\n  ]);\n\n  return traceData\n    ? {\n        info: traceInfoResponse?.trace?.trace_info || {},\n        data: traceData,\n      }\n    : undefined;\n}\n\n/**\n * Fetches trace information and data for a given trace ID using the legacy API.\n *\n * @param requestId - The ID of the request to fetch\n * @returns Promise resolving to ModelTrace object or undefined if trace cannot be fetched\n */\nexport async function getTraceLegacy(requestId?: string): Promise<ModelTrace | undefined> {\n  if (!requestId) {\n    return undefined;\n  }\n\n  const [traceInfo, traceData] = await Promise.all([\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    MlflowService.getExperimentTraceInfo(requestId!).then((response) => response.trace_info || {}),\n    // get-trace-artifact is only currently supported in mlflow 2.0 apis\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    MlflowService.getExperimentTraceData(requestId!),\n  ]);\n  return traceData\n    ? {\n        info: traceInfo,\n        data: traceData,\n      }\n    : undefined;\n}\n","import React from 'react';\nimport { useSyncExternalStore } from 'use-sync-external-store/shim';\n\nfunction useMatchesMediaQuery(queryList: MediaQueryList) {\n  return useSyncExternalStore(\n    React.useCallback(\n      (callback) => {\n        queryList.addEventListener('change', callback);\n        return () => {\n          queryList.removeEventListener('change', callback);\n        };\n      },\n      [queryList],\n    ),\n    () => queryList.matches,\n  );\n}\n\n/**\n * React hook that listens for changes to a [media query][media-query]. Uses\n * [`window.matchMedia()`][match-media] under-the-hood.\n *\n * [media-query]: https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_media_queries/Using_media_queries\n * [match-media]: https://developer.mozilla.org/en-US/docs/Web/API/Window/matchMedia\n *\n * @usage\n *\n * ```tsx\n * function FancyButton() {\n *   const prefersReducedMotion = useMediaQuery('(prefers-reduced-motion)');\n *   return prefersReducedMotion ? <Button /> : <DancingButton />;\n * }\n * ```\n *\n * > **Note**\n * > The vast majority of use-cases can (and should) use vanilla CSS media\n * > queries instead of this hook — which will cause a re-render when the match\n * > state changes. Usage of this hook should be reserved for use-cases where\n * > CSS cannot be used instead.\n * >\n * > ```tsx\n * > <Button css={{ 'not (prefers-reduced-motion)': { animation: … } }} />\n * > ```\n */\nexport function useMediaQuery(query: string) {\n  // Note: a new MediaQueryList is created with every _usage_ of this hook.\n  // It's probably cheap to create many instances of MediaQueryList, and\n  // garbage collection will still clean up as expected, but consider using a\n  // [weak cache](https://github.com/tc39/proposal-weakrefs#weak-caches) to\n  // reuse MediaQueryLists where possible if performance is impacted.\n  const queryList = React.useMemo(() => window.matchMedia(query), [query]);\n  return useMatchesMediaQuery(queryList);\n}\n","import { type RefObject, useRef, useCallback, useEffect, useState } from 'react';\n\ntype ResizeObserverOptions<ElementType extends Element> = {\n  /**\n   * The element to watch for size changes. Can either pass a ref object or a function that when called will return the element to be watched\n   */\n  ref: RefObject<ElementType | null> | (() => ElementType | null);\n  /**\n   * Optionally debounces state updates, to prevent rerendering on every single resize\n   */\n  debounceTimeMs?: number;\n};\n\nexport function useResizeObserver<ElementType extends Element>({\n  ref: rootRef,\n  debounceTimeMs,\n}: ResizeObserverOptions<ElementType>): { width: number; height: number } | null {\n  const prevSize = useRef<{ width: number; height: number }>({ width: -1, height: -1 });\n  const debounceRef = useRef<ReturnType<typeof setTimeout>>();\n  const [size, setSize] = useState<{ width: number; height: number } | null>(null);\n\n  const onResize = useCallback(\n    (entries: ResizeObserverEntry[]) => {\n      if (entries.length === 0) {\n        return;\n      }\n\n      const rect = entries[0].contentRect;\n      if (prevSize.current.width === -1) {\n        // First update, just set size immediately\n        prevSize.current = { width: rect.width, height: rect.height };\n        setSize(prevSize.current);\n        return;\n      }\n\n      if (rect.width !== prevSize.current.width || rect.height !== prevSize.current.height) {\n        prevSize.current.width = rect.width;\n        prevSize.current.height = rect.height;\n\n        if (!debounceTimeMs) {\n          setSize({ ...prevSize.current });\n          return;\n        }\n        clearTimeout(debounceRef.current);\n        debounceRef.current = setTimeout(() => {\n          setSize({ ...prevSize.current });\n        }, debounceTimeMs);\n      }\n    },\n    [debounceTimeMs],\n  );\n\n  const observerRef = useRef<ResizeObserver>();\n  if (!observerRef.current) {\n    observerRef.current = new ResizeObserver(onResize);\n  }\n\n  useEffect(() => {\n    const rootElement = typeof rootRef === 'function' ? rootRef() : rootRef.current;\n    if (rootElement) {\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion -- TODO(FEINF-3982)\n      const observer = observerRef.current!;\n      observer.observe(rootElement);\n      return () => observer.unobserve(rootElement);\n    }\n    return;\n  });\n\n  return size;\n}\n","import React from 'react';\nimport { Modal, Typography, CopyIcon, useDesignSystemTheme } from '@databricks/design-system';\nconst { Paragraph } = Typography;\nimport { CopyButton } from '@mlflow/mlflow/src/shared/building_blocks/CopyButton';\n\nexport interface KeyValueTagFullViewModalProps {\n  tagKey: string;\n  tagValue: string;\n  setIsKeyValueTagFullViewModalVisible: React.Dispatch<React.SetStateAction<boolean>>;\n  isKeyValueTagFullViewModalVisible: boolean;\n}\n\nexport const KeyValueTagFullViewModal = React.memo((props: KeyValueTagFullViewModalProps) => {\n  const { theme } = useDesignSystemTheme();\n\n  return (\n    <Modal\n      componentId=\"codegen_mlflow_app_src_common_components_keyvaluetagfullviewmodal.tsx_17\"\n      title={'Tag: ' + props.tagKey}\n      visible={props.isKeyValueTagFullViewModalVisible}\n      onCancel={() => props.setIsKeyValueTagFullViewModalVisible(false)}\n    >\n      <div css={{ display: 'flex' }}>\n        <Paragraph css={{ flexGrow: 1 }}>\n          <pre\n            css={{\n              backgroundColor: theme.colors.backgroundPrimary,\n              marginTop: theme.spacing.sm,\n              whiteSpace: 'pre-wrap',\n              wordBreak: 'break-all',\n            }}\n          >\n            {props.tagValue}\n          </pre>\n        </Paragraph>\n        <div\n          css={{\n            marginTop: theme.spacing.sm,\n          }}\n        >\n          <CopyButton copyText={props.tagValue} showLabel={false} icon={<CopyIcon />} aria-label=\"Copy\" />\n        </div>\n      </div>\n    </Modal>\n  );\n});\n","import { Tag, LegacyTooltip, Typography } from '@databricks/design-system';\nimport type { KeyValueEntity } from '../types';\nimport React, { useState } from 'react';\nimport { useIntl } from 'react-intl';\nimport { KeyValueTagFullViewModal } from './KeyValueTagFullViewModal';\nimport type { Interpolation, Theme } from '@emotion/react';\n\n/**\n * An arbitrary number that is used to determine if a tag is too\n * long and should be truncated. We want to avoid short keys or values\n * in a long tag to be truncated\n * */\nconst TRUNCATE_ON_CHARS_LENGTH = 30;\n\nfunction getTruncatedStyles(shouldTruncate = true): Interpolation<Theme> {\n  return shouldTruncate\n    ? {\n        overflow: 'hidden',\n        textOverflow: 'ellipsis',\n        textWrap: 'nowrap',\n        whiteSpace: 'nowrap' as const,\n      }\n    : { whiteSpace: 'nowrap' as const };\n}\n\n/**\n * A <Tag /> wrapper used for displaying key-value entity\n */\nexport const KeyValueTag = ({\n  isClosable = false,\n  onClose,\n  tag,\n  enableFullViewModal = false,\n  charLimit = TRUNCATE_ON_CHARS_LENGTH,\n  maxWidth = 300,\n  className,\n}: {\n  isClosable?: boolean;\n  onClose?: () => void;\n  tag: KeyValueEntity;\n  enableFullViewModal?: boolean;\n  charLimit?: number;\n  maxWidth?: number;\n  className?: string;\n}) => {\n  const intl = useIntl();\n\n  const [isKeyValueTagFullViewModalVisible, setIsKeyValueTagFullViewModalVisible] = useState(false);\n\n  const { shouldTruncateKey, shouldTruncateValue } = getKeyAndValueComplexTruncation(tag, charLimit);\n  const allowFullViewModal = enableFullViewModal && (shouldTruncateKey || shouldTruncateValue);\n\n  const fullViewModalLabel = intl.formatMessage({\n    defaultMessage: 'Click to see more',\n    description: 'Run page > Overview > Tags cell > Tag',\n  });\n\n  return (\n    <div>\n      <Tag\n        componentId=\"codegen_mlflow_app_src_common_components_keyvaluetag.tsx_60\"\n        closable={isClosable}\n        onClose={onClose}\n        title={tag.key}\n        className={className}\n      >\n        <LegacyTooltip title={allowFullViewModal ? fullViewModalLabel : ''}>\n          <span\n            css={{ maxWidth, display: 'inline-flex' }}\n            onClick={() => (allowFullViewModal ? setIsKeyValueTagFullViewModalVisible(true) : undefined)}\n          >\n            <Typography.Text bold title={tag.key} css={getTruncatedStyles(shouldTruncateKey)}>\n              {tag.key}\n            </Typography.Text>\n            {tag.value && (\n              <Typography.Text title={tag.value} css={getTruncatedStyles(shouldTruncateValue)}>\n                : {tag.value}\n              </Typography.Text>\n            )}\n          </span>\n        </LegacyTooltip>\n      </Tag>\n      <div>\n        {isKeyValueTagFullViewModalVisible && (\n          <KeyValueTagFullViewModal\n            tagKey={tag.key}\n            tagValue={tag.value}\n            isKeyValueTagFullViewModalVisible={isKeyValueTagFullViewModalVisible}\n            setIsKeyValueTagFullViewModalVisible={setIsKeyValueTagFullViewModalVisible}\n          />\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport function getKeyAndValueComplexTruncation(\n  tag: KeyValueEntity,\n  charLimit = TRUNCATE_ON_CHARS_LENGTH,\n): { shouldTruncateKey: boolean; shouldTruncateValue: boolean } {\n  const { key, value } = tag;\n  const fullLength = key.length + value.length;\n  const isKeyLonger = key.length > value.length;\n  const shorterLength = isKeyLonger ? value.length : key.length;\n\n  // No need to truncate if tag is short enough\n  if (fullLength <= charLimit) return { shouldTruncateKey: false, shouldTruncateValue: false };\n  // If the shorter string is too long, truncate both key and value.\n  if (shorterLength > charLimit / 2) return { shouldTruncateKey: true, shouldTruncateValue: true };\n\n  // Otherwise truncate the longer string\n  return {\n    shouldTruncateKey: isKeyLonger,\n    shouldTruncateValue: !isKeyLonger,\n  };\n}\n"],"names":["useEditExperimentTraceTags","onSuccess","existingTagKeys","useV3Apis","showEditTagsModal","EditTagsModal","useEditKeyValueTagsModal","saveTagsHandler","async","editedEntity","existingTags","newTags","traceRequestId","requestId","addedOrModifiedTags","filter","key","newTagKey","value","newTagValue","some","existingTagKey","existingTagValue","deletedTags","Promise","all","map","MlflowService","setExperimentTraceTagV3","setExperimentTraceTag","deleteExperimentTraceTagV3","deleteExperimentTraceTag","valueRequired","allAvailableTags","tagKey","startsWith","MLFLOW_INTERNAL_PREFIX","showEditTagsModalForTrace","useCallback","trace","_trace$tags","request_id","visibleTags","tags","useDeleteTracesMutation","queryClient","useQueryClient","useMutation","mutationFn","experimentId","traceRequestIds","chunks","i","length","push","slice","deletePromises","chunk","deleteTracesV3","traces_deleted","reduce","sum","result","invalidateMlflowSearchTracesCache","GenAiTraceEvaluationArtifactFile","KnownEvaluationResultAssessmentMetadataFields","KnownEvaluationResultAssessmentName","isEvaluationResultOverallAssessment","assessmentEntry","_assessmentEntry$meta","metadata","IS_OVERALL_ASSESSMENT","isEvaluationResultPerRetrievalChunkAssessment","_assessmentEntry$meta2","isNumber","CHUNK_INDEX","isRetrievedContext","Array","isArray","every","v","isPlainObject","getFirstRetrievedContextValue","record","Object","values","find","extractRetrievalChunks","outputs","targets","perChunkAssessments","retrievedContext","expectedRetrievedContext","index","target","assessments","assessment","retrievalAssessmentsByName","groupBy","keys","forEach","orderBy","docUrl","doc_uri","content","parseRawTableArtifact","artifactData","columns","data","filename","SyntaxError","normalizedColumns","column","row","zipObject","INPUT_MESSAGES_KEY","DEFAULT_ASSESSMENTS_SORT_ORDER","OVERALL_ASSESSMENT","CORRECTNESS","GLOBAL_GUIDELINE_ADHERENCE","GUIDELINE_ADHERENCE","GUIDELINES","RELEVANCE_TO_QUERY","CONTEXT_SUFFICIENCY","RETRIEVAL_SUFFICIENCY","CHUNK_RELEVANCE","RETRIEVAL_RELEVANCE","GROUNDEDNESS","RETRIEVAL_GROUNDEDNESS","SAFETY","KnownEvaluationResultAssessmentStringValue","getAssessmentValueLabel","intl","theme","assessmentInfo","dtype","YES","formatMessage","id","defaultMessage","icon","_jsx","css","_css","color","getEvaluationResultIconColor","stringValue","svg","width","height","children","CheckCircleIcon","backgroundColor","getEvaluationResultAssessmentBackgroundColor","borderRadius","NO","XCircleIcon","UNKNOWN","WarningIcon","KnownEvaluationResultAssessmentOutputLabel","response","defineMessage","EXPECTED_FACTS_FIELD_NAME","KnownEvaluationResultAssessmentTargetLabel","expected_response","KnownEvaluationResultAssessmentValueLabel","KnownEvaluationResultAssessmentValueMissingTooltip","KnownEvaluationResultAssessmentValueDescription","KnownEvaluationResultAssessmentValueMapping","isAssessmentAiGenerated","_assessment$source","source","sourceType","getEvaluationResultTitle","evaluation","_title","title","getEvaluationResultInputTitle","isNil","inputs","stringifyValue","evaluationId","inputKey","_input$INPUT_MESSAGES","_input$","inputsTitle","JSON","stringify","input","_input$INPUT_MESSAGES2","undefined","_input","getEvaluationResultAssessmentValue","_ref","_assessment$stringVal","numericValue","booleanValue","withAlpha","hexColor","opacity","startsWithHash","Math","round","min","max","toString","toUpperCase","KnownEvaluationResponseAssessmentNames","KnownEvaluationRetrievalAssessmentNames","createDraftEvaluationResultAssessmentObject","name","isOverallAssessment","rationale","_getUser","sourceId","getUser","timestamp","Date","now","isDraft","isDraftAssessment","getOrderedAssessments","assessmentsByName","entries","indexInKnownNames","indexOf","_assessments$timestam","_assessments","isEvaluationResultReviewedAlready","evaluationResult","_evaluationResult$ove","_evaluationResult$ove2","overallAssessments","hasBeenEditedByHuman","_assessment$source2","_assessment$metadata","IS_COPIED_FROM_AI","getEvaluationResultAssessmentChunkIndex","_assessment$metadata2","isAssessmentMissing","hasRationale","Boolean","hasValue","hasErrorMessage","errorMessage","AGGREGATE_SCORE_CHANGE_BACKGROUND_COLORS","CURRENT_RUN_COLOR","COMPARE_TO_RUN_COLOR","PASS_BARCHART_BAR_COLOR","FAIL_BARCHART_BAR_COLOR","TAG_PASS_COLOR","isDarkMode","colors","green400","green600","red400","red600","textValidationWarning","grey400","iconOnly","red800","red200","getAssessmentValueBarBackgroundColor","assessmentValue","isError","grey800","grey200","useSearchParams","useSearchParamsDirect","Link","LinkDirect","QUERY_PARAM_KEY","serializedStringToAssessmentValueV2","serializedStringToAssessmentValue","assessmentValueToSerializedString","useTableSort","selectedColumns","initialTableSort","tableSort","setTableSort","useState","c","useMemo","GenAITracesTableContext","createContext","table","setTable","selectedRowIds","setSelectedRowIds","GenAITracesTableProvider","Provider","GenAiDeleteTraceModal","experimentIds","visible","selectedTraces","handleClose","deleteTraces","useIntl","setErrorMessage","isLoading","setIsLoading","tracesToDelete","_jsxs","Modal","componentId","FormattedMessage","count","onCancel","okText","onOk","handleOk","_experimentIds$","e","submitDeleteTraces","okButtonProps","loading","danger","Typography","Paragraph","Text","bold","getEvalTabTotalTracesLimit","FilterOperator","TracesTableColumnType","TracesTableColumnGroup","TracesTableColumnGroupToLabelMap","ASSESSMENT","EXPECTATION","TAG","INFO","USER_COLUMN_ID","SESSION_COLUMN_ID","RESPONSE_COLUMN_ID","TRACE_ID_COLUMN_ID","REQUEST_TIME_COLUMN_ID","EXECUTION_DURATION_COLUMN_ID","STATE_COLUMN_ID","SOURCE_COLUMN_ID","TAGS_COLUMN_ID","TRACE_NAME_COLUMN_ID","INPUTS_COLUMN_ID","RUN_NAME_COLUMN_ID","LOGGED_MODEL_COLUMN_ID","TOKENS_COLUMN_ID","CUSTOM_METADATA_COLUMN_ID","SORTABLE_INFO_COLUMNS","SERVER_SORTABLE_INFO_COLUMNS","EXCLUDED_ASSESSMENT_NAMES","TOTAL_INPUT_TOKEN_COUNT","TOTAL_OUTPUT_TOKEN_COUNT","TOTAL_TOKEN_COUNT","DOCUMENT_RECALL","DOCUMENT_RATINGS","createAssessmentColumnId","assessmentName","createExpectationColumnId","expectationName","useTableColumns","currentEvaluationResults","assessmentInfos","runUuid","otherEvaluationResults","isTraceInfoV3Override","isTraceInfoV3","shouldUseTraceInfoV3","inputCols","label","type","INPUT","group","inputKeys","Set","traceInfoColumns","traceInfo","assessmentColumns","displayName","isRetrievalAssessment","includes","infoCols","expectationColumns","TRACE_INFO","allResults","customMetadataColumns","_result$traceInfo","traceMetadata","trace_metadata","createCustomMetadataColumnId","expectations","tagColumnRecords","_result$traceInfo2","tag","createTagColumnId","tagColumns","requestTime","INTERNAL_MONITOR_REQUEST_TIME","col","MLFLOW_SOURCE_RUN_KEY","getRowIdFromTrace","trace_id","getCustomMetadataKeyFromColumnId","columnId","split","pop","metadataKey","getTracesTagKeys","traces","uniq","flat","convertTraceInfoV3ToModelTraceInfo","_trace$client_request","obj","client_request_id","evalResults","safelyParseValue","val","parse","getTraceInfoInputs","_traceInfo$trace_meta","request_preview","request","getTraceInfoOutputs","_traceInfo$trace_meta2","response_preview","LIST_TRACES_IGNORE_ASSESSMENTS","convertFeedbackAssessmentToRunEvalAssessment","_assessment$feedback","_assessment$feedback2","_assessment$metadata3","feedback","assessment_name","_assessment$source3","source_type","runEvalSourceType","source_id","convertAssessmentV3Source","error","errorCode","error_code","error_message","rootCauseAssessment","suggestedActions","convertTraceInfoV3ToRunEvalEntry","_traceInfo$assessment","responseAssessmentsByName","expectation","isExpectationAssessment","_assessment$expectati","_assessment$expectati2","_assessment$expectati3","serialized_value","processExpectationAssessment","evalResultAssessment","processFeedbackAssessment","rawInputs","rawOutputs","_messages$","messages","_messages","inputsId","metrics","applyTraceInfoV3ToEvalEntry","converted","getRetrievalAssessmentsByName","chunkIndex","fromEntries","_assessment$metadata4","Number","filteredAssessments","GenAITracesTableActions","props","traceActions","selectedTracesFromProps","traceInfos","setRowSelection","useContext","selectedTracesFromContext","rowId","TraceActionsDropdown","_traceActions$exportT","_traceActions$editTag","showDatasetModal","setShowDatasetModal","showLabelingSessionModal","setShowLabelingSessionModal","showDeleteModal","setShowDeleteModal","handleEditTags","editTags","modelTrace","handleDeleteTraces","traceIds","_traceActions$deleteT","deleteTracesAction","hasExportAction","exportToEvals","getTrace","hasEditTagsAction","hasDeleteAction","isEditTagsDisabled","noTracesSelected","ActionButton","Button","disabled","endIcon","ChevronDownIcon","_Fragment","DropdownMenu","Root","Tooltip","Trigger","asChild","Content","Separator","Group","Label","Item","onClick","GROUP_PRIORITY","INFO_COLUMN_PRIORITY","ASSESSMENT_COLUMN_PRIORITY","groupRank","grp","idx","infoColumnRank","assessmentColumnRank","sortGroupedColumns","isComparing","sort","colA","colB","_colA$group","_colB$group","groupA","groupB","groupComparison","_infoColumnRank$colA$","_infoColumnRank$colB$","rankA","Infinity","rankB","localeCompare","_assessmentColumnRank","_assessmentColumnRank2","sortColumns","a","b","getPriority","_selectedColumns$find","colType","diff","aCol","bCol","getTraceInfoValueWithColId","colId","_traceInfo$tags","Error","getUniqueInputRequests","evaluationResults","resultMap","Map","duplicateIndexMap","entry","has","newCount","get","set","computeEvaluationsComparison","currentRunEvalResults","otherRunEvalResults","currentRunValue","otherRunEvalResultsMap","currentRunEvalResultsMap","allRequestIds","from","otherRunValue","ErrorCell","useDesignSystemTheme","display","alignItems","gap","spacing","sm","DangerIcon","styles","NullCell","fontStyle","textSecondary","StackedComponents","first","second","marginY","flexDirection","legacyBorders","borderRadiusMd","marginTop","marginBottom","fetchFn","fetch","makeRequest","path","method","body","options","headers","getDefaultHeaders","document","cookie","ok","matchPredefinedError","errorMessageFromResponse","json","message","MlflowUtils","getEntryPointName","runTags","entryPointTag","getSourceType","sourceTypeTag","dropExtension","replace","baseName","pieces","formatSource","sourceName","getSourceName","entryPointName","res","jobIdTag","jobRunIdTag","jobId","jobRunId","getDefaultJobRunName","runId","workspaceId","sourceNameTag","getGitHubRegex","getGitLabRegex","getBitbucketRegex","getRunPageRoute","getLoggedModelPageRoute","loggedModelId","getGitRegex","getGitRepoUrl","branchName","gitHubMatch","match","gitLabMatch","bitbucketMatch","gitMatch","url","baseUrl","repoDir","fileDir","getNotebookRevisionId","revisionIdTag","getNotebookId","notebookIdTag","isCurrentWorkspace","getDefaultNotebookRevisionName","notebookId","revisionId","ensureUrlScheme","defaultScheme","setQueryParams","queryParams","urlObj","URL","search","getNotebookSourceUrl","workspaceUrl","window","location","origin","renderNotebookSource","nameOverride","href","addQueryParams","currentQueryParams","newQueryParams","urlSearchParams","URLSearchParams","getJobSourceUrl","renderJobSource","jobName","reformatJobName","renderSource","gitRepoUrlOrNull","workspaceIdTag","workspaceUrlTag","notebookQueryParams","o","jobQueryParams","renderSourceFromMetadata","traceInfoV3","_traceInfoV3$trace_me","_traceInfoV3$trace_me2","_traceInfoV3$trace_me3","_traceInfoV3$trace_me4","_traceInfoV3$trace_me5","gitRepoUrl","gitBranch","gitCommit","httpsUrl","ref","filePath","rel","_traceInfoV3$trace_me6","_traceInfoV3$trace_me7","_traceInfoV3$trace_me8","_traceInfoV3$trace_me9","_traceInfoV3$trace_me0","_traceInfoV3$trace_me1","_traceInfoV3$trace_me10","_traceInfoV3$trace_me11","runNameTag","LoggedModelCell","_currentTraceInfo$tra","_otherTraceInfo$trace","currentTraceInfo","otherTraceInfo","currentModelId","otherModelId","LoggedModelComponent","modelId","_ref2","_ref3","_data$info","useLoggedModelName","modelName","info","ParagraphSkeleton","Tag","to","xs","maxWidth","ModelsIcon","textPrimary","fontSize","isFetching","refetch","useQuery","queryKey","queryFn","cacheTime","staleTime","refetchOnMount","retry","enabled","model","RunName","_data$runs","_data$runs$","_data$runs$$info","useRunName","runName","runs","run_name","experiment_ids","SourceType","ExperimentSourceTypeIcon","className","NOTEBOOK","NotebookIcon","LOCAL","HomeIcon","PROJECT","FolderBranchIcon","JOB","WorkflowsIcon","SourceCellRenderer","_props$traceInfo$trac","sourceLink","disableLinks","pointerEvents","textDecoration","cursor","ExperimentViewTracesStatusLabels","STATE_UNSPECIFIED","IN_PROGRESS","OK","ERROR","getIcon","state","ClockIcon","textValidationSuccess","textValidationDanger","StatusCellRenderer","original","labelDescriptor","KeyValueTagFullViewModal","React","isKeyValueTagFullViewModalVisible","setIsKeyValueTagFullViewModalVisible","backgroundPrimary","whiteSpace","wordBreak","tagValue","md","CopyActionButton","copyText","getTruncatedStyles","shouldTruncate","overflow","textOverflow","textWrap","KeyValueTag","isClosable","onClose","enableFullViewModal","charLimit","shouldTruncateKey","shouldTruncateValue","fullLength","isKeyLonger","shorterLength","getKeyAndValueComplexTruncation","allowFullViewModal","fullViewModalLabel","closable","TagsCellRenderer","onAddEditTags","baseComponentId","visibleTagList","containsTags","flexWrap","columnGap","rowGap","size","PencilIcon","TokensCell","TokenComponent","_ref4","_ref5","_ref6","_ref7","_ref8","_ref9","tokenUsage","parsedTokenUsage","totalTokens","total_tokens","inputTokens","input_tokens","outputTokens","output_tokens","HoverCard","trigger","ERROR_KEY","doesAssessmentContainErrors","getCustomMetricNameAndAssessment","assessmentPath","splits","metricName","join","PASS_FAIL_VALUES","getAssessmentInfos","_assessmentInfos$Know","assessmentDtypes","assessmentNames","_result$retrievalChun","overallAssessmentsByName","retrievalChunks","add","_result$retrievalChun2","_","_assessment$source4","isCustomMetric","isKnown","customMetricName","customAssessmentName","docsLink","missingTooltip","description","uniqueValues","isOverall","isEditable","containsErrors","_assessment$source5","_assessment$source6","seenOverallAssessmentValues","sortAssessmentInfos","orderA","orderB","getAssessmentNumericAggregates","numericValues","numericAggregateCounts","bucketSize","maxCount","lower","upper","bucket","counts","getNumericAggregate","flatMap","evalResult","getAssessmentRunValueCounts","valueCounts","valueCountsBySourceId","getUniqueValueCountsBySourceId","keysToCount","uniqueValue","valueCountBySourceId","valueCount","getAssessmentRunNumericValues","getRootCauseAssessmentCount","numRootCause","_overallAssessment$ro","overallAssessment","getAssessmentAggregates","allAssessmentFilters","currentEvalResults","otherEvalResults","currentAssessmentAggregates","otherAssessmentAggregates","currentNumericAggregates","assessmentFilters","currentCounts","otherCounts","currentNumericValues","otherNumericValues","currentNumericAggregate","currentNumRootCause","otherNumRootCause","getAssessmentAggregateOverallFraction","assessmentRunCounts","total","passCount","isAssessmentPassing","getAssessmentBarChartValueBarItem","toggleAssessmentFilter","numEvals","isErrorOrNull","numValue","fraction","isSelected","filterValue","run","toggleFilter","tooltip","getBarChartKeys","uniqueValuesArray","sortOrder","getSortedUniqueValues","getAssessmentBarChartValueText","errorAssessments","validAssessments","assessmentsWithValue","latestAssessment","displayPercentage","numDecimalsDisplayPercentage","toFixed","displayFloat","numDecimals","multiplier","pow","getDisplayScoreChange","scoreChange","asPercentage","changeDirection","timeSinceStr","date","referenceDate","seconds","floor","interval","timeSince","escapeCssSpecialCharacters","str","prettySizeWithUnit","bytes","fractionDigits","divisor","units","isNaN","isFinite","unit","greatestDivisor","formatNumber","prettyNumberWithUnit","MarkdownConverterProviderContext","makeHTML","markdown","MarkdownConverterProvider","makeHtml","useMarkdownConverter","EvaluationsReviewAssessmentTag","onEdit","active","disableJudgeTypeIcon","showRationaleInTooltip","showPassFailText","hideAssessmentName","disableTooltip","isRootCauseAssessment","_assessmentInfo$sourc","isPassing","iconColor","textColor","getEvaluationResultTextColor","knownValueLabel","assessmentTitle","learnMoreLink","rationaleHTML","isString","editedByHuman","tagText","fullTagText","errorDisplayValue","nullDisplayValue","displayValueText","XCircleFillIcon","knownMapping","_knownMapping$value$t","messageDescriptor","roundedValue","valueElement","String","getAssessmentTagDisplayValue","tagContent","tagElement","EvaluationsReviewTag","sourceIcon","BracketsXIcon","UserIcon","SparkleDoubleIcon","disableSourceTypeIcon","side","overflowWrap","Title","InfoSmallIcon","Hint","dangerouslySetInnerHTML","__html","svgSize","justifyContent","padding","boxShadow","borderAccessible","typography","fontSizeSm","actionDefaultTextHover","RunColorCircle","hidden","style","assessmentCellRenderer","comparisonEntry","_comparisonEntry$curr","_comparisonEntry$othe","_comparisonEntry$curr2","_comparisonEntry$curr3","_comparisonEntry$curr4","_comparisonEntry$curr5","_comparisonEntry$othe2","_comparisonEntry$othe3","_comparisonEntry$othe4","_comparisonEntry$curr6","_assessment$currentVa","_comparisonEntry$othe5","_assessment$currentVa2","_comparisonEntry$curr7","currentValue","otherValue","uniqueValueCounts","currentIsAssessmentRootCause","otherIsAssessmentRootCause","assessmentComparison","aString","bString","compareAssessmentValues","assessmentChanged","ArrowRightIcon","transform","uniqueValueCount","_ref0","_ref1","_ref10","_ref11","_ref12","_ref13","_ref14","_ref15","_ref16","_ref17","_ref18","_ref19","_ref20","_ref21","_ref22","_ref23","_ref24","_ref25","_ref26","_ref27","_ref28","DEFAULT_ASSESSMENT_CELL_WIDTH_PX","DEFAULT_ASSESSMENTS_CELL_WIDTH_COMPARE_PX","formatResponseTitle","outputsTitle","_choices$","_choices$$message","choices","_choices$2","_choices$2$message","getColumnConfig","evaluationInputs","onChangeEvaluationId","onTraceTagsEdit","baseColConfig","header","accessorFn","originalRow","sortingFn","_aValue$currentRunVal","_aValue$otherRunValue","_aValue$currentRunVal2","_aValue$otherRunValue2","_bValue$currentRunVal","_bValue$otherRunValue","_bValue$currentRunVal2","_bValue$otherRunValue2","aValue","getValue","bValue","aSortValue","evalId","bSortValue","minSize","cell","_cell$table$options$m","inputColumnCellRenderer","inputColumn","getRunColor","_value$currentRunValu","_value$otherRunValue","_value$currentRunValu2","_value$currentRunValu3","_value$currentRunValu4","_value$otherRunValue2","_value$otherRunValue3","_value$otherRunValue4","currentRunUuid","otherRunUuid","currentRunColor","otherRunColor","currentInputColumnTitle","otherInputColumnTitle","inputColumnTitle","meta","_aValue$currentRunVal3","_aValue$currentRunVal4","_aValue$otherRunValue3","_aValue$otherRunValue4","_bValue$currentRunVal3","_bValue$currentRunVal4","_bValue$otherRunValue3","_bValue$otherRunValue4","aAssessment","bAssessment","aCurrentValue","bCurrentValue","aOtherValue","bOtherValue","aIsPassToFail","bIsPassToFail","aIsFailToPass","bIsFailToPass","aIsFailToFail","bIsFailToFail","aIsPassToPass","bIsPassToPass","aIsPassing","bIsPassing","sortPassFailAssessments","sortCompareAssessments","maxSize","expectationCellRenderer","_comparisonEntry$curr8","_comparisonEntry$curr9","_comparisonEntry$othe6","_comparisonEntry$othe7","currentValuePreview","ExpectationValuePreview","parsedValue","singleLine","otherValuePreview","_aValue$currentRunVal5","_bValue$currentRunVal5","traceInfoSortingFn","traceInfoA","traceInfoB","_getTraceInfoValueWit","_getTraceInfoValueWit2","aVal","bVal","numeric","traceInfoCellRenderer","_comparisonEntry$curr0","_comparisonEntry$othe8","request_time","otherDate","toLocaleString","navigator","language","timeZoneName","tagsArr","otherTagsArr","_currentTraceInfo$tag","_otherTraceInfo$tags","otherTagValue","_comparisonEntry$curr1","_currentTraceInfo$tag2","_otherTraceInfo$tags2","_currentTraceInfo$tag3","_currentTraceInfo$tag4","currentTraceName","otherTraceName","_currentTraceInfo$tra2","_currentTraceInfo$tag5","_otherTraceInfo$tags3","_currentTraceInfo$tra3","_otherTraceInfo$trace2","_currentTraceInfo$tra4","_otherTraceInfo$trace3","_originalRow$currentR","GenAiTracesTableBodyRows","rows","enableRowSelection","virtualItems","virtualizerTotalSize","virtualizerMeasureElement","position","virtualRow","exportableTrace","node","start","willChange","GenAiTracesTableBodyRow","getIsSelected","MemoizedGenAiTracesTableBodyRows","cells","getVisibleCells","TableRow","TableRowSelectCell","checked","onChange","getToggleSelectedHandler","isDisabled","GenAiTracesTableBodyRowCell","TableCell","flex","flexRender","columnDef","getContext","EvaluationsRcaStats","overallAssessmentInfo","assessmentNameToAggregates","compareToRunUuid","rcaData","isCompareToRun","currentRunDisplayName","otherRunDisplayName","_sortedAssessmentAggr","_sortedAssessmentAggr2","assessmentDisplayInfo","sortedAssessmentAggregates","x","maxNumRootCause","_KnownEvaluationResul","numPassing","numFailing","numMissing","otherNumEvals","otherRootCauseFraction","currentPercentage","otherPercentage","currentInfo","percentage","currentRun","filterType","otherInfo","getRcaData","fontWeight","typographyBoldFontWeight","RcaPills","runColor","item","runDisplayInfoCount","border","general","borderRadiusBase","toLocaleLowerCase","EvaluationsAssessmentHoverCard","_assessmentInfo$sourc2","paddingBottom","borderBottom","NumbersIcon","BinaryIcon","level","marginRight","CategoricalAggregateChart","assessmentAggregates","compareToRunDisplayName","barChartData","displayInfoCounts","showCompareData","barItems","currentBarItem","otherBarItem","current","other","getBarChartData","sortedBarChartData","originalIndex","aIsBottomEntry","bIsBottomEntry","_b$current","_a$current","valueComparison","visibleItems","MAX_VISIBLE_ITEMS","hiddenItems","hasMoreItems","hoverBarColor","actionDefaultBackgroundHover","selectedBarColor","actionDefaultBackgroundPress","barData","ChartRow","colSpan","Popover","actionLinkDefault","align","isNull","borderTopLeftRadius","borderBottomLeftRadius","paddingLeft","paddingTop","lineHeight","textAlign","verticalAlign","borderTopRightRadius","borderBottomRightRadius","paddingRight","flexShrink","transition","NumericAggregateChart","numericAggregate","minHeight","blue400","AssessmentColumnSummary","collapsedHeader","dtypeAggregateLabel","displayScore","displayScoreChange","currentAverage","NaN","otherAverage","abs","aggregateType","scoreFraction","numUniqueValues","getDisplayOverallScoreAndChange","textPlaceholder","fontSizeLg","fontSizeMd","GenAiTracesTableHeader","enableGrouping","selectedAssessmentInfos","runDisplayName","disableAssessmentTooltips","setCollapsedHeader","headerGroups","allRowSelected","someRowSelected","toggleAllRowsSelectedHandler","setColumnSizing","isChevronHovered","setIsChevronHovered","borderCss","top","left","right","borderTop","headerGroup","depth","isHeader","zIndex","blue500","indeterminate","checkboxLabel","noCheckbox","isPlaceholder","titleElement","TableHeader","background","onMouseEnter","onMouseLeave","borderColor","HeaderCellRenderer","groupId","visibleCount","totalCount","groupName","EvaluationsReviewAssessmentDetailedHistory","history","alwaysExpanded","setReferenceDate","useEffect","updateDateInterval","setInterval","clearInterval","transitions","next","previous","rationaleHtml","_first","_first2","_first3","_first4","Spacer","getMappedValue","_next$source","_next$source2","prevValue","nextValue","isSameValue","when","user","EvaluationsReviewAssessmentTooltip","assessmentHistory","disable","getTitle","mostRecentEntry","_getEvaluationResultA","_mostRecentEntry$sour2","previousRecentEntry","previousRecentValue","_mostRecentEntry$sour","mappedValue","displayedPreviousValue","EvaluationsReviewAssessmentUpsertForm","editedAssessment","valueSuggestions","onSave","readOnly","_formValue$label","setRationale","inputValue","setInputValue","formValue","setFormValue","_valueSuggestions$fin","showAllSuggestions","setShowAllSuggestions","filteredSuggestions","toLowerCase","visibleSuggestions","displayCombobox","comboboxState","useComboboxState","allItems","items","setItems","multiSelect","allowNewValue","itemToString","initialSelectedItem","initialInputValue","formOnChange","onIsOpenChange","isOpen","addNewElementLabel","TypeaheadComboboxRoot","TypeaheadComboboxInput","placeholder","onKeyUp","highlightedIndex","closeMenu","TypeaheadComboboxMenu","emptyText","matchTriggerWidth","TypeaheadComboboxMenuItem","Input","TextArea","autoSize","_formValue$rootAssess","targetAssessmentName","rootAssessmentName","useEditAssessmentFormState","editingAssessment","setEditingAssessment","showUpsertForm","setShowUpsertForm","suggestions","setSuggestions","setFormState","isEditing","getAssessmentValueSuggestions","originalAssessment","mapping","editAssessment","addAssessment","closeForm","ExpandedAssessment","assessmentsType","onUpsertAssessment","allowEditing","intlLabel","suggestedActionHtml","_assessment$rootCause","suggestedAction","assessmentToEdit","BugIcon","AssistantIcon","defaultAssessmentName","ExpandedAssessments","allowMoreThanOne","nonEmptyAssessments","assessmentList","_key","containsAssessments","showAddAssessmentButton","PlusIcon","CompactAssessments","EvaluationsReviewAssessments","isExpandedView","setIsExpandedView","showExpandedView","filteredAssessmentsByName","ChevronUpIcon","ChevronRightIcon","mode","EvaluationsReviewAssessmentsConfirmButton","toBeReviewed","containsOverallAssessment","isNextResultAvailable","overridingExistingReview","hasPendingAssessments","onClickNext","onCancelOverride","VerticalBar","EvaluationsReviewSingleRunAssessmentsSection","onSavePendingAssessments","onResetPendingAssessments","isNextAvailable","pendingAssessments","setOverridingExistingReview","isReadOnly","_currentOverallAssess","currentOverallAssessment","rootCauseAssessmentName","reopenReviewTooltip","backgroundSecondary","zIndexBase","pendingCount","EvaluationsReviewAssessmentsSection","otherEvaluationResult","EvaluationTraceDataDrawer","withoutMargins","Drawer","modal","open","onOpenChange","expandContentToFullHeight","renderContent","containsSpans","spans","Empty","marginLeft","lg","onWheel","stopPropagation","ModelTraceExplorer","EvaluationsReviewSingleRunHeaderSection","exportToEvalsInstanceEnabled","traceQueryResult","_evaluationResult$tra","_evaluationResult$tra2","selectedTraceDetailsRequestId","setSelectedTraceDetailsRequestId","droppedSpanSize","prettySizeString","prettySize","delayDuration","EvaluationsReviewHeaderSection","compareToTraceQueryResult","EvaluationsReviewCopyButton","showLabel","buttonProps","showTooltip","setShowTooltip","LegacyTooltip","dangerouslySetAntdProps","handleClick","clipboard","writeText","setTimeout","handleMouseLeave","EvaluationsReviewExpandedJSONValueCell","structuredJSONValue","objectData","fontFamily","EvaluationsReviewTextBox","fieldName","showCopyIcon","htmlContent","jsonContent","CopyIcon","fact","EvaluationsReviewSingleRunInputSection","inputsEntries","noValues","EvaluationsReviewInputSection","inputsAreTheSame","EvaluationsReviewSingleRunResponseSection","outputEntries","targetEntries","output","mappedTitle","EvaluationsReviewResponseSection","EvaluationsReviewListItemIndicator","chunkRelevanceAssessmentInfo","QuestionMarkIcon","isValidHttpUrl","protocol","err","RetrievedChunkHeader","ellipsis","openInNewTab","strong","EvaluationsReviewSingleRunRetrievalSection","selectedIndex","setSelectedIndex","evaluationRetrievalChunks","_retrievalSpans$at","_retrievalSpans$at$at","docUriKey","retrieverInfos","retrievalSpans","span","_span$attributes","_span$attributes2","attributes","ModelTraceSpanType","RETRIEVER","spanOutputs","at","doc","_doc$metadata","page_content","getRetrievedContextFromTrace","selectedEntryHtmlContent","_evaluationRetrievalC","noRetrievalFound","selectedChunk","sectionTitle","role","TableSkeleton","lines","maxHeight","minWidth","borderRight","_chunk$content","_chunk$retrievalAsses","actionIconBackgroundHover","lineHeightLg","EvaluationsReviewRetrievalSection","EvaluationsReviewDetailsHeader","EvaluationsReviewDetails","draftEvaluationResult","upsertAssessment","resetPendingAssessments","dispatch","useReducer","action","existingPendingAssessment","payload","overallAssessmentList","pendingOverallAssessment","responseAssessmentMap","allAssessmentNames","pendingAssessmentForType","retrievalChunksWithDraftAssessments","_evaluationResult$ret","pendingAssessmentForChunk","existingAssessments","usePendingAssessmentEntries","hasErrorCode","showAlert","alertExpanded","setAlertExpanded","Alert","toggleAlertExpanded","GenAiEvaluationTracesReview","otherEvaluation","selectNextEval","saveAssessmentsQuery","handleSavePendingAssessments","assessmentsToSave","shouldRepeatExistingOriginalOverallAiAssessment","sourceEvaluationResult","pendingAssessmentEntries","repeatedOverallAssessment","_getUser2","firstAiOverallAssessment","copyAiOverallAssessmentAsHumanAssessment","unshift","savePendingAssessments","reviewDetailsRef","useRef","_reviewDetailsRef$cur","scrollTo","isSaving","inset","overlayOverlay","Spinner","inheritColor","getDefaultConfig","_shouldEnableRunEvalu","enableRunEvaluationWriteFeatures","GenAITracesTableConfigContext","GenAITracesTableConfigProvider","config","defaultConfig","mergedConfig","merge","useGetTrace","traceId","resolve","refetchOnWindowFocus","keepPreviousData","GenAiEvaluationTracesReviewModal","evaluations","selectedEvaluationId","_evaluation$currentRu","_evaluation$currentRu2","_evaluation$otherRunV","_evaluation$otherRunV2","_nextEvaluation$curre","_nextEvaluation$curre2","_previousEvaluation$c","_previousEvaluation$c2","_evaluation$currentRu3","classNamePrefix","findEval","_entry$currentRunValu","_entry$otherRunValue","previousEvaluationIdx","findIndex","isPreviousAvailable","nextEvaluationIdx","selectPreviousEval","_evaluations$previous","_evaluations$previous2","_evaluations$previous3","_evaluations$previous4","newEvalId","_evaluations$nextEval","_evaluations$nextEval2","_evaluations$nextEval3","_evaluations$nextEval4","nextEvaluation","previousEvaluation","tracesTableConfig","isSingleTraceView","currentTraceQueryResult","onKeyDown","verticalSizing","footer","GenericSkeleton","ModelTraceExplorerModalBody","traceData","ChevronLeftIcon","GenAiTracesTableBody","rowSelection","allColumns","columnsList","groupColumns","topLevelColumns","useReactTable","getCoreRowModel","getSortedRowModel","enableColumnResizing","columnResizeMode","enableMultiSort","onRowSelectionChange","getRowId","getRowIdFromEvaluation","getIsAllRowsSelected","getIsSomeRowsSelected","getSelectedRowModel","r","emptyDescription","emptyComponent","image","SearchIcon","setSorting","desc","asc","getRowModel","tableContainerRef","rowVirtualizer","useVirtualizer","estimateSize","getScrollElement","measureElement","userAgent","element","getBoundingClientRect","overscan","getVirtualItems","tableHeaderGroups","getHeaderGroups","columnSizeVars","tableWidth","colSizes","getSize","overflowY","overflowX","Table","empty","someRowsSelected","getToggleAllRowsSelectedHandler","getTotalSize","rowSelectionState","GenAiTracesTableSearchInput","searchQuery","setSearchQuery","pendingUserQuery","setPendingUserQuery","timeout","clearTimeout","TableFilterInput","COMPARE_TO_RUN_DROPDOWN_COMPONENT_ID","FILTER_DROPDOWN_COMPONENT_ID","COLUMN_SELECTOR_DROPDOWN_COMPONENT_ID","EvaluationsOverviewColumnSelector","setSelectedColumns","setSelectedColumnsWithHiddenColumns","DialogCombobox","DialogComboboxCustomButtonTriggerWrapper","ColumnsIcon","DialogComboboxContent","DialogComboboxOptionList","DialogComboboxOptionListCheckboxItem","newColumn","handleChange","EvaluationsOverviewSortDropdown","isMetadataLoading","metadataError","setOpen","sortOptions","assessmentLabelPrefix","sortedColumns","assessmentLabel","sortableAssessmentCol","inputLabelPrefix","infoColumn","currentSortSelectLabel","sortOption","option","sortOptionLabel","_tableSort$key","extractedKeyName","sortMessage","SortAscendingIcon","SortDescendingIcon","SortUnsortedIcon","EvaluationsOverviewSortDropdownBodyGrouped","onOptionSelected","orderByAsc","EvaluationsOverviewSortDropdownBody","inputRef","firstOptionRef","setFilter","filtered","opt","grouped","m","_opt$group","_tableSort$asc","setOrder","_sortOptions$find","requestAnimationFrame","_inputRef$current","focus","prefix","_firstOptionRef$curre","preventDefault","ToggleButton","pressed","ArrowDownIcon","ArrowUpIcon","opts","gi","CheckboxItem","ItemIndicator","inputElementRef","firstElementRef","filteredSortOptions","orderByKey","orderByKeyOption","ascending","_inputElementRef$curr","autoFocus","_firstElementRef$curr","GenAiEvaluationBadge","borders","useActiveEvaluation","_searchParams$get","searchParams","setSearchParams","setSelectedEvaluationId","params","delete","filterEvaluationResults","filters","includeEval","_runValue$overallAsse","_runValue$responseAss","runValue","_runValue$overallAsse2","_runValue$overallAsse3","filterEval","_entry$currentRunValu2","searchQueryLower","currentInputsContainSearchQuery","inputsIdEqualsToSearchQuery","SampledInfoBadge","totalRowCount","sampledInfo","maxAllowedCount","evalResultsCount","logCountLoading","sampledCount","ANY_VALUE","AssessmentsFilterSelector","assessmentFilter","updateAssessmentFilter","removeAssessmentFilter","selectedValue","SegmentedControlGroup","event","SegmentedControlButton","GenAiTracesTable","oldEvalResults","compareToEvaluationResults","oldCompareToEvalResults","compareToRunLoading","defaultSortOption","initialSelectedColumns","fullTraceActions","exportToEvalAction","enableTableRowSelection","useEvaluationsSearchQuery","setAssessmentFilters","_searchParams$getAll","getAll","urlFilter","filterValueString","append","useAssessmentFilters","displayEvaluationResults","overallAssessmentCol","initialSort","getAssessmentFilter","clearFilters","hasActiveFilters","selectedEvaluationIds","totalEvaluationResults","LegacySkeleton","flexGrow","TableFilterLayout","actionDefaultBorderFocus","FilterIcon","numFilters","grey600","numFilteredEvals","useGenAiExperimentRunsForComparison","getQueryKey","requestError","runInfos","_run$info","_run$info2","run_uuid","artifactFile","then","allArtifactFiles","Assessments","Evaluations","Metrics","useGenAiTraceEvaluationArtifacts","artifacts","isAnyArtifactRetrievalEnabled","queriesResult","useQueries","queries","query","parsedAssessments","parsedEvaluations","parsedMetrics","mergedData","metricsByEvaluation","acc","evaluation_id","assessmentsByEvaluation","_entry$source$metadat","_entry$source","_entry$source2","_entry$source3","boolean_value","numeric_value","string_value","_entry$outputs","_entry$targets","allAssessmentsSorted","_assessment$rationale","_match$","_match$2","_match$3","trim","newRationale","perRetrievalChunkAssessments","responseAssessments","difference","inputs_id","mergeMetricsAndAssessmentsWithEvaluations","SEARCH_MLFLOW_TRACES_QUERY_KEY","invalidateQueries","useMlflowTracesTableMetadata","timeRange","filterByLoggedModelId","sqlWarehouseId","networkFilters","createMlflowSearchFilter","isInnerLoading","useSearchMlflowTracesInner","locations","mlflow_experiment","experiment_id","otherFilter","otherTraces","isOtherInnerLoading","otherError","evaluatedTraces","otherEvaluatedTraces","isOtherLoading","tableFilterOptions","sourceMap","renderValue","isEmpty","useSearchMlflowTraces","pageSize","limit","clientFilters","getNetworkAndClientFilters","createMlflowSearchOrderBy","isInnerFetching","refetchMlflowTraces","evalTraceComparisonEntries","filteredTraces","pageSizeProp","limitProp","rest","_x$mlflow_experiment","signal","pageToken","allTraces","tracesLimit","max_results","order_by","model_id","sql_warehouse_id","page_token","queryResponse","matchPredefinedErrorFromResponse","concat","next_page_token","timestampField","startTime","endTime","networkFilter","tagField","operator","executionField","statusField","TableFilterItemTypeahead","canSearchCustomValue","searchValue","setSearchValue","displayOptions","_query$data","optionValues","DialogComboboxTrigger","withInlineLabel","renderDisplayedValue","_item$renderValue","allowClear","DialogComboboxOptionListSearch","onSearch","DialogComboboxOptionListSelectItem","TableFilterItemValueInput","tableFilter","localValue","setLocalValue","onValueBlur","runsQuery","runNameQuery","_runsQuery$runInfos","_runsQuery$runInfos$f","versionsDataQuery","useExperimentVersionsQuery","models","versionsQuery","_versionsDataQuery$da","loggedModel","stateOptions","_runNameQuery$data","_versionsQuery$data","sourceOptions","onBlur","FILTERABLE_INFO_COLUMNS","TableFilterItem","onDelete","assessmentKeyOptions","columnOptions","FormUI","htmlFor","EQUALS","SimpleSelect","contentProps","op","SimpleSelectOption","CloseSmallIcon","GenAiTracesTableFilter","setFilters","FilterForm","filterForm","useForm","defaultValues","useFilterForm","setValue","watch","localFilters","FormProvider","newFilter","newFilters","splice","getGroupLabel","EvaluationsOverviewColumnSelectorGrouped","toggleColumns","setSearch","sortedGroupedColumns","_col$group","filteredGroupedColumns","needle","out","cols","groupMatches","hits","OPTION_HEIGHT","controlledValue","setControlledValue","DialogComboboxSectionHeader","newSelection","gc","handleSelectAllInGroup","groupLabel","GenAITracesTableToolbar","countInfo","onSortChange","currentCount","GenAITracesTableBodyContainer","currentTraceInfoV3","compareToTraceInfoV3","handleAssessmentFilterToggle","_evalResult$traceInfo","_evalResult$traceInfo2","AssessmentSchemaContextProvider","useFilters","urlOperator","toHiddenColumnsFromVisibleColumns","visibleColumns","adjustHiddenColumns","hiddenColumns","toVisibleColumnsFromHiddenColumns","nonAssessmentColumns","columnsToRemove","assessmentColumnsToKeep","useGenAITracesUIStateColumns","defaultSelectedColumns","columnState","setColumnState","useLocalStorage","version","initialValue","defaultHidden","getDefaultHiddenColumns","columnOverrides","show","prev","_prev$columnOverrides","prevOverrides","nextOverrides","changed","newShow","useSelectedColumns","nextSelected","wantSelected","toToggle","getDropdownMenu","menu","sortedIndexOf","isValidTagKey","test","flattenOptions","actionTertiaryTextDefault","actionDisabledText","placement","groupOption","TagKeySelectDropdown","control","onKeyChangeCallback","setIsOpen","selectRef","field","fieldState","useController","rules","required","LegacySelect","showSearch","dropdownRender","defaultValue","onDropdownVisibleChange","filterOption","onSelect","onClear","handleClear","validationState","Option","getTagsMap","editedEntityRef","initialTags","setInitialTags","finalTags","setFinalTags","showModal","setShowModal","form","hideModal","reset","saveTags","catch","_e$getUserVisibleErro","ErrorWrapper","getUserVisibleError","formValues","hasNewValues","isEqual","sortBy","isDirty","showPopoverMessage","destroyOnClose","RestoreAntDDefaultClsPrefix","dangerouslyUseFocusPseudoClass","UnsavedTagPopoverTrigger","onSaveTask","onSubmit","handleSubmit","newEntries","_tag$value","RHFControlledComponents","htmlType","Message","handleTagDelete","currentFinalTags","fullTagDisplay","truncate","shownText","Close","Arrow","FETCH_TRACE_INFO_QUERY_KEY","displayErrorNotification","getIconTypeForSpan","spanType","ModelSpanType","LLM","ModelIconType","MODELS","CHAIN","AGENT","TOOL","WRENCH","CHAT_MODEL","SEARCH","PARSER","CODE","EMBEDDING","NUMBERS","RERANKER","SORT","MEMORY","SAVE","FUNCTION","getDisplayNameForSpanType","tryDeserializeAttribute","getMatchesFromSpan","searchFilter","matches","sections","events","section","getMatchesFromEvent","attribute","isKeyMatch","getEventAttributeKey","matchIndex","numValueMatches","createListFromObject","searchTree","rootNode","spanFilterState","_rootNode$children","searchFilterLowercased","allSpanTypesSelected","spanTypeDisplayState","shouldDisplay","filteredTreeNodes","filteredChildren","child","childNodes","childMatches","spanName","spanMatches","nodeMatchesSearch","spanTypeIsDisplayed","nodePassesSpanFilters","hasMatchingChild","hasException","getSpanExceptionCount","showParents","showExceptions","searchTreeBySpanId","selectedSpanId","_rootNode$children2","matchedNode","normalizeNewSpanData","rootStartTime","rootEndTime","assessmentMap","_span$attributes3","_assessmentMap$spanId","_span$attributes4","_span$attributes5","_span$attributes6","_getModelTraceSpanEnd","parentId","getModelTraceSpanParentId","spanId","getModelTraceSpanId","_assessmentMap$","chatMessages","getChatMessagesFromSpan","messagesAttributeValue","messageFormat","_normalizeConversatio","_normalizeConversatio2","isRawModelTraceChatMessage","compact","prettyPrintChatMessage","messagesFromInputs","normalizeConversation","messagesFromOutputs","chatTools","getChatToolsFromSpan","toolsAttributeValue","_inputs$tools","isModelTraceChatTool","tools","mapValues","omitBy","getModelTraceSpanStartTime","end","getModelTraceSpanEndTime","ModelTraceExplorerIcon","isRootSpan","decodeSpanId","isV3Span","base64","binaryString","atob","binaryLen","hex","charCodeAt","padStart","base64ToHex","isV3ModelTraceInfo","isV3ModelTraceSpan","_span$span_id","_span$context$span_id","_span$context","span_id","context","_span$parent_span_id","_span$parent_id","parent_span_id","parent_id","start_time_unix_nano","start_time","end_time_unix_nano","end_time","getModelTraceId","_trace$info$request_i","getModelTraceSize","_trace$info","_trace$info$trace_met","parseModelTraceToTree","_trace$trace_data$spa","_trace$trace_data","trace_data","spanMap","relationMap","rootSpan","getSpanNodeFromData","_span$span_type","_span$end_time","_span$parent_id2","rootStart","rootEnd","getAssessmentMap","span_type","getAssessmentsFromTags","assessmentsById","keyBy","overrides","overriddenAssessment","_assessment$span_id","last_update_time","getTime","isBoolean","getHighlightedSpanComponents","activeMatchBackgroundColor","inactiveMatchBackgroundColor","containsActiveMatch","activeMatch","scrollToActiveMatch","regex","RegExp","escapeRegExp","parts","isActiveMatch","scrollMarginTop","isRetrieverDocument","isRenderableRetrieverSpan","getSpanExceptionEvents","_span$events","isModelTraceChatToolParamProperty","enum","_obj$function","parameters","function","properties","isModelTraceToolCall","_obj$function2","_obj$function3","arguments","isContentType","part","text","image_url","detail","input_audio","format","isContentPart","tool_calls","isModelTraceChoices","choice","isModelTraceChatResponse","_normalizeLangchainCh","_normalizeLlamaIndexC","_normalizeOpenAIChatI","_normalizeDspyChatInp","_normalizeGeminiChatI","_normalizeAnthropicCh","_normalizeOpenAIAgent","_normalizeAutogenChat","_normalizeBedrockChat","_normalizeOpenAIChatI2","langchainMessages","normalizeLangchainChatInput","normalizeLangchainChatResult","llamaIndexMessages","normalizeLlamaIndexChatInput","normalizeLlamaIndexChatResponse","openAIMessages","normalizeOpenAIChatInput","normalizeOpenAIChatResponse","normalizeOpenAIResponsesOutput","normalizeOpenAIResponsesInput","dspyMessages","normalizeDspyChatInput","normalizeDspyChatOutput","geminiMessages","normalizeGeminiChatInput","normalizeGeminiChatOutput","anthropicMessages","normalizeAnthropicChatInput","normalizeAnthropicChatOutput","openAIAgentMessages","normalizeOpenAIAgentInput","normalizeOpenAIAgentOutput","autogenMessages","normalizeAutogenChatInput","normalizeAutogenChatOutput","bedrockMessages","normalizeBedrockChatInput","normalizeBedrockChatOutput","prettyPrintToolCall","toolCall","_toolCall$function","args","formatChatContent","_part$image_url","_message$tool_calls","CodeSnippetRenderMode","_traceInfoResponse$tr","traceInfoResponse","getExperimentTraceInfoV3","getExperimentTraceData","trace_info","getTraceLegacy","getExperimentTraceInfo","useMediaQuery","queryList","useSyncExternalStore","callback","addEventListener","removeEventListener","useMatchesMediaQuery","matchMedia","useResizeObserver","rootRef","debounceTimeMs","prevSize","debounceRef","setSize","onResize","rect","contentRect","observerRef","ResizeObserver","rootElement","observer","observe","unobserve","CopyButton"],"sourceRoot":""}