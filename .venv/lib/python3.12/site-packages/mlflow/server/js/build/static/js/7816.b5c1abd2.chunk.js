"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[7816],{2250:function(e,t,s){s.d(t,{$:function(){return i}});var n=s(43683),o=s(63528),a=s(31014),r=s(98590);const i=({onSuccess:e,existingTagKeys:t=[],useV3Apis:s})=>{const{showEditTagsModal:i,EditTagsModal:l}=(0,n.Q)({saveTagsHandler:async(e,t,n)=>{if(!e.traceRequestId)return;const a=e.traceRequestId,r=n.filter((({key:e,value:s})=>!t.some((({key:t,value:n})=>t===e&&s===n)))),i=t.filter((({key:e})=>!n.some((({key:t})=>e===t))));return Promise.all([...r.map((({key:e,value:t})=>s?o.x.setExperimentTraceTagV3(a,e,t):o.x.setExperimentTraceTag(a,e,t))),...i.map((({key:e})=>s?o.x.deleteExperimentTraceTagV3(a,e):o.x.deleteExperimentTraceTag(a,e)))])},valueRequired:!0,allAvailableTags:t.filter((e=>e&&!e.startsWith(r.nt))),onSuccess:e});return{showEditTagsModalForTrace:(0,a.useCallback)((e=>{var t;if(!e.request_id)return;const s=(null===(t=e.tags)||void 0===t?void 0:t.filter((({key:e})=>e&&!e.startsWith(r.nt))))||[];i({traceRequestId:e.request_id,tags:s||[]})}),[i]),EditTagsModal:l}}},10939:function(e,t,s){s.d(t,{C:function(){return i}});var n=s(27288),o=s(77020),a=s(63528),r=s(24759);const i=()=>{const e=(0,n.jE)();return(0,o.n)({mutationFn:async({experimentId:e,traceRequestIds:t})=>{const s=[];for(let o=0;o<t.length;o+=100)s.push(t.slice(o,o+100));const n=s.map((t=>a.x.deleteTracesV3(e,t)));return{traces_deleted:(await Promise.all(n)).reduce(((e,t)=>e+t.traces_deleted),0)}},onSuccess:()=>(0,r.BL)({queryClient:e})})}},24759:function(e,t,s){s.d(t,{WB:function(){return Ea},tj:function(){return Ye},_p:function(){return Cr},sG:function(){return ye},w_:function(){return wr},o8:function(){return o},tU:function(){return js},js:function(){return za},Te:function(){return Re},Rl:function(){return Ce},TH:function(){return Qa},$W:function(){return Me},Pn:function(){return De},YO:function(){return He},$6:function(){return xe},pR:function(){return be},d9:function(){return Ze},BL:function(){return Ja},R7:function(){return Rr},Xz:function(){return ja},Ie:function(){return Wa},KW:function(){return Xa},Zn:function(){return Za},K0:function(){return Or},GY:function(){return ge}});var n=s(9133);let o=function(e){return e.Evaluations="_evaluations.json",e.Assessments="_assessments.json",e.Metrics="_metrics.json",e}({}),a=function(e){return e.IS_OVERALL_ASSESSMENT="is_overall_assessment",e.CHUNK_INDEX="chunk_index",e.IS_COPIED_FROM_AI="is_copied_from_ai",e}({}),r=function(e){return e.OVERALL_ASSESSMENT="overall_assessment",e.SAFETY="safety",e.GROUNDEDNESS="groundedness",e.CORRECTNESS="correctness",e.RELEVANCE_TO_QUERY="relevance_to_query",e.CHUNK_RELEVANCE="chunk_relevance",e.CONTEXT_SUFFICIENCY="context_sufficiency",e.GUIDELINE_ADHERENCE="guideline_adherence",e.GLOBAL_GUIDELINE_ADHERENCE="global_guideline_adherence",e.TOTAL_TOKEN_COUNT="agent/total_token_count",e.TOTAL_INPUT_TOKEN_COUNT="agent/total_input_token_count",e.TOTAL_OUTPUT_TOKEN_COUNT="agent/total_output_token_count",e.DOCUMENT_RECALL="retrieval/ground_truth/document_recall",e.DOCUMENT_RATINGS="retrieval/ground_truth/document_ratings",e}({});const i=e=>{var t;return!0===(null===(t=e.metadata)||void 0===t?void 0:t[a.IS_OVERALL_ASSESSMENT])},l=e=>{var t;return(0,n.isNumber)(null===(t=e.metadata)||void 0===t?void 0:t[a.CHUNK_INDEX])},d=e=>Array.isArray(e)&&e.every((e=>(0,n.isPlainObject)(e)&&"doc_uri"in e&&"content"in e)),u=e=>Object.values(e||{}).find(d),c=(e,t,s)=>{const o=u(e)||[],r=u(t);return o.map(((e,t)=>{const o=null===r||void 0===r?void 0:r[t],i=(s||[]).filter((e=>(e.metadata||{})[a.CHUNK_INDEX]===t)),l=(0,n.groupBy)(i,"name");return Object.keys(l).forEach((e=>{l[e]=(0,n.orderBy)(l[e],"timestamp","desc")})),{docUrl:e.doc_uri,content:e.content,retrievalAssessmentsByName:l,target:null===o||void 0===o?void 0:o.content}}))};function m(e){if(!e)return;const{columns:t,data:s,filename:o}=e;if(!t||!Array.isArray(t))throw new SyntaxError(`Artifact ${o} is malformed, it does not contain "columns" array`);if(!s||!Array.isArray(s))throw new SyntaxError(`Artifact ${o} is malformed, it does not contain "data" array`);const a=t.map(((e,t)=>null!==e&&void 0!==e?e:`column_${t}`));return s.map((e=>(0,n.zipObject)(a,e)))}var p=s(89555),g=s(68048),v=s(16934),f=s(7450),h=s(26955),y=s(50111);const E="messages";let b=function(e){return e.OVERALL_ASSESSMENT="overall_assessment",e.SAFETY="safety",e.GROUNDEDNESS="groundedness",e.RETRIEVAL_GROUNDEDNESS="retrieval_groundedness",e.CORRECTNESS="correctness",e.RELEVANCE_TO_QUERY="relevance_to_query",e.CHUNK_RELEVANCE="chunk_relevance",e.RETRIEVAL_RELEVANCE="retrieval_relevance",e.CONTEXT_SUFFICIENCY="context_sufficiency",e.RETRIEVAL_SUFFICIENCY="retrieval_sufficiency",e.GUIDELINE_ADHERENCE="guideline_adherence",e.GUIDELINES="guidelines",e.GLOBAL_GUIDELINE_ADHERENCE="global_guideline_adherence",e}({});const S=[b.OVERALL_ASSESSMENT,b.CORRECTNESS,b.GLOBAL_GUIDELINE_ADHERENCE,b.GUIDELINE_ADHERENCE,b.GUIDELINES,b.RELEVANCE_TO_QUERY,b.CONTEXT_SUFFICIENCY,b.RETRIEVAL_SUFFICIENCY,b.CHUNK_RELEVANCE,b.RETRIEVAL_RELEVANCE,b.GROUNDEDNESS,b.RETRIEVAL_GROUNDEDNESS,b.SAFETY];b.OVERALL_ASSESSMENT,b.CORRECTNESS,b.GROUNDEDNESS,b.RETRIEVAL_GROUNDEDNESS,b.RELEVANCE_TO_QUERY,b.SAFETY,b.CHUNK_RELEVANCE,b.RETRIEVAL_RELEVANCE,b.CONTEXT_SUFFICIENCY,b.RETRIEVAL_SUFFICIENCY,b.GUIDELINE_ADHERENCE,b.GUIDELINES;let A=function(e){return e.YES="yes",e.NO="no",e.UNKNOWN="unknown",e}({});function x(e,t,s,n){return"pass-fail"===s.dtype?n===A.YES?{content:e.formatMessage({id:"pm1RNL",defaultMessage:"Pass"}),icon:(0,y.Y)("span",{css:(0,p.AH)({color:`${ne(t,s,{stringValue:A.YES})} !important`,svg:{width:"12px",height:"12px"}},""),children:(0,y.Y)(g.CheckCircleIcon,{css:(0,p.AH)({backgroundColor:oe(t,s,{stringValue:A.YES}),borderRadius:"50%"},"")})})}:n===A.NO?{content:e.formatMessage({id:"9cTaBs",defaultMessage:"Fail"}),icon:(0,y.Y)("span",{css:(0,p.AH)({color:`${ne(t,s,{stringValue:A.NO})} !important`,svg:{width:"12px",height:"12px"}},""),children:(0,y.Y)(g.XCircleIcon,{css:(0,p.AH)({backgroundColor:oe(t,s,{stringValue:A.NO}),borderRadius:"50%"},"")})})}:{content:e.formatMessage({id:"27XMby",defaultMessage:"Missing"}),icon:(0,y.Y)("span",{css:(0,p.AH)({color:`${ne(t,s,{stringValue:A.UNKNOWN})} !important`,svg:{width:"12px",height:"12px"}},""),children:(0,y.Y)(v.W,{css:(0,p.AH)({backgroundColor:oe(t,s,{stringValue:A.UNKNOWN}),borderRadius:"50%"},"")})})}:"boolean"===s.dtype?!0===n?{content:e.formatMessage({id:"1Ujhc3",defaultMessage:"True"})}:!1===n?{content:e.formatMessage({id:"nvjkTA",defaultMessage:"False"})}:{content:e.formatMessage({id:"keSIQ4",defaultMessage:"null"})}:{content:`${n}`}}let I=function(e){return e.IS_OVERALL_ASSESSMENT="is_overall_assessment",e.CHUNK_INDEX="chunk_index",e.IS_COPIED_FROM_AI="is_copied_from_ai",e}({});const w={response:(0,f.zR)({id:"WiaEQ3",defaultMessage:"Model output"})},N="expected_facts",T={expected_response:(0,f.zR)({id:"CX8ytv",defaultMessage:"Expected output"}),[N]:(0,f.zR)({id:"N1G2a5",defaultMessage:"Expected facts"})},C={[b.OVERALL_ASSESSMENT]:(0,f.zR)({id:"uoJWOm",defaultMessage:"Overall"}),[b.CORRECTNESS]:(0,f.zR)({id:"7+XQ3q",defaultMessage:"Correctness"}),[b.GROUNDEDNESS]:(0,f.zR)({id:"Ws58cc",defaultMessage:"Groundedness"}),[b.RETRIEVAL_GROUNDEDNESS]:(0,f.zR)({id:"wY58OE",defaultMessage:"Retrieval groundedness"}),[b.CONTEXT_SUFFICIENCY]:(0,f.zR)({id:"GRaplV",defaultMessage:"Context sufficiency"}),[b.RETRIEVAL_SUFFICIENCY]:(0,f.zR)({id:"mdzFsD",defaultMessage:"Retrieval sufficiency"}),[b.RELEVANCE_TO_QUERY]:(0,f.zR)({id:"Yhydp3",defaultMessage:"Relevance"}),[b.SAFETY]:(0,f.zR)({id:"jMUqD1",defaultMessage:"Safety"}),[b.CHUNK_RELEVANCE]:(0,f.zR)({id:"qnMgLj",defaultMessage:"Chunk relevance"}),[b.RETRIEVAL_RELEVANCE]:(0,f.zR)({id:"opUoF8",defaultMessage:"Retrieval relevance"}),[b.GUIDELINE_ADHERENCE]:(0,f.zR)({id:"xV6NWF",defaultMessage:"Guideline adherence"}),[b.GUIDELINES]:(0,f.zR)({id:"ls3868",defaultMessage:"Guidelines"}),[b.GLOBAL_GUIDELINE_ADHERENCE]:(0,f.zR)({id:"tUAhDM",defaultMessage:"Global guideline adherence"})},_={[b.CORRECTNESS]:(0,f.zR)({id:"i7UTwK",defaultMessage:"Correctness assessment is missing. This is likely because you have not provided an expected response (ground truth) or grading notes."}),[b.GROUNDEDNESS]:(0,f.zR)({id:"jPW0Lj",defaultMessage:"Groundedness assessment is missing. This is likely because your agent is not returning retrieved_context."}),[b.RETRIEVAL_GROUNDEDNESS]:(0,f.zR)({id:"TXPJuE",defaultMessage:"Retrieval Groundedness assessment is missing. This is likely because your agent is not returning retrieved_context."}),[b.CONTEXT_SUFFICIENCY]:(0,f.zR)({id:"g0tloS",defaultMessage:"Context sufficiency assessment is missing. This is likely because your agent is not returning retrieved_context."}),[b.RETRIEVAL_SUFFICIENCY]:(0,f.zR)({id:"ffIouW",defaultMessage:"Retrieval sufficiency assessment is missing. This is likely because your agent is not returning retrieved_context."})},R={[b.OVERALL_ASSESSMENT]:(0,f.zR)({id:"hW5ehW",defaultMessage:"The overall assessment passes when all of the judges pass."}),[b.CORRECTNESS]:(0,f.zR)({id:"Y6gWro",defaultMessage:"The correctness LLM judge gives a binary evaluation and written rationale on whether the agent's generated response is factually accurate and semantically similar to the provided ground-truth response or grading notes."}),[b.GROUNDEDNESS]:(0,f.zR)({id:"+Wd9fs",defaultMessage:"The groundedness LLM judge returns a binary evaluation and written rationale on whether the generated response is factually consistent with the agent's retrieved context."}),[b.RETRIEVAL_GROUNDEDNESS]:(0,f.zR)({id:"6Q/0BO",defaultMessage:"The retrieval groundedness LLM judge returns a binary evaluation and written rationale on whether the generated response is factually consistent with the agent's retrieved context."}),[b.RELEVANCE_TO_QUERY]:(0,f.zR)({id:"oDwj2g",defaultMessage:"The relevance_to_query LLM judge determines whether the response is relevant to the input request."}),[b.SAFETY]:(0,f.zR)({id:"/gqx4n",defaultMessage:"The safety LLM judge returns a binary rating and a written rationale on whether the generated response has harmful or toxic content."}),[b.CHUNK_RELEVANCE]:(0,f.zR)({id:"aUOkOC",defaultMessage:"The chunk-relevance-precision LLM judge determines whether the chunks returned by the retriever are relevant to the input request. Precision is calculated as the number of relevant chunks returned divided by the total number of chunks returned. For example, if the retriever returns four chunks, and the LLM judge determines that three of the four returned documents are relevant to the request, then llm_judged/chunk_relevance/precision is 0.75."}),[b.RETRIEVAL_RELEVANCE]:(0,f.zR)({id:"rBydei",defaultMessage:"The retrieval-relevance LLM judge determines whether the chunks returned by the retriever are relevant to the input request. Precision is calculated as the number of relevant chunks returned divided by the total number of chunks returned. For example, if the retriever returns four chunks, and the LLM judge determines that three of the four returned documents are relevant to the request, then llm_judged/chunk_relevance/precision is 0.75."}),[b.CONTEXT_SUFFICIENCY]:(0,f.zR)({id:"bkWot5",defaultMessage:"The context sufficiency LLM judge determines whether the retrieved context is sufficient to generate the expected response."}),[b.RETRIEVAL_SUFFICIENCY]:(0,f.zR)({id:"fwxkdN",defaultMessage:"The retrieval sufficiency LLM judge determines whether the retrieved context is sufficient to generate the expected response."}),[b.GUIDELINE_ADHERENCE]:(0,f.zR)({id:"4Tg5Vr",defaultMessage:"The guideline adherence LLM judge determines whether the response adheres to the guidelines provided."}),[b.GUIDELINES]:(0,f.zR)({id:"98v9a0",defaultMessage:"The guidelines LLM judge determines whether the response adheres to the guidelines provided. All responses must adhere to guidelines."}),[b.GLOBAL_GUIDELINE_ADHERENCE]:(0,f.zR)({id:"zZ9sIi",defaultMessage:"The global guideline adherence LLM judge determines whether the response adheres to the global guidelines provided. All responses must adhere to global guidelines."})},Y={[b.OVERALL_ASSESSMENT]:{[A.YES]:(0,f.zR)({id:"Za9+Cg",defaultMessage:"Pass"}),[A.NO]:(0,f.zR)({id:"j77+aP",defaultMessage:"Fail"})},[b.CHUNK_RELEVANCE]:{[A.YES]:(0,f.zR)({id:"B1Upnc",defaultMessage:"Relevant"}),[A.NO]:(0,f.zR)({id:"M+HfWb",defaultMessage:"Irrelevant"})},[b.RETRIEVAL_RELEVANCE]:{[A.YES]:(0,f.zR)({id:"++039K",defaultMessage:"Relevant"}),[A.NO]:(0,f.zR)({id:"akmaST",defaultMessage:"Irrelevant"})},[b.CONTEXT_SUFFICIENCY]:{[A.YES]:(0,f.zR)({id:"7S/ozs",defaultMessage:"Context sufficient"}),[A.NO]:(0,f.zR)({id:"aAAHaS",defaultMessage:"Context insufficient"})},[b.RETRIEVAL_SUFFICIENCY]:{[A.YES]:(0,f.zR)({id:"rBIGDf",defaultMessage:"Sufficient"}),[A.NO]:(0,f.zR)({id:"lhFnAG",defaultMessage:"Insufficient"})},[b.RELEVANCE_TO_QUERY]:{[A.YES]:(0,f.zR)({id:"rNkAcB",defaultMessage:"Relevant"}),[A.NO]:(0,f.zR)({id:"0M7VVC",defaultMessage:"Irrelevant"})},[b.GROUNDEDNESS]:{[A.YES]:(0,f.zR)({id:"/2InJv",defaultMessage:"Grounded"}),[A.NO]:(0,f.zR)({id:"ZfsnMj",defaultMessage:"Not grounded"})},[b.RETRIEVAL_GROUNDEDNESS]:{[A.YES]:(0,f.zR)({id:"e515YD",defaultMessage:"Grounded"}),[A.NO]:(0,f.zR)({id:"uSVfB9",defaultMessage:"Not grounded"})},[b.CORRECTNESS]:{[A.YES]:(0,f.zR)({id:"eSxQmg",defaultMessage:"Correct"}),[A.NO]:(0,f.zR)({id:"LhxSrc",defaultMessage:"Incorrect"})},[b.SAFETY]:{[A.YES]:(0,f.zR)({id:"DMOaoR",defaultMessage:"Safe"}),[A.NO]:(0,f.zR)({id:"CX/MSu",defaultMessage:"Unsafe"})},[b.GUIDELINE_ADHERENCE]:{[A.YES]:(0,f.zR)({id:"ZNYFUr",defaultMessage:"Adheres to guidelines"}),[A.NO]:(0,f.zR)({id:"hIBLi9",defaultMessage:"Violates guidelines"})},[b.GUIDELINES]:{[A.YES]:(0,f.zR)({id:"luV/3W",defaultMessage:"Adheres to guidelines"}),[A.NO]:(0,f.zR)({id:"WmgIQ+",defaultMessage:"Violates guidelines"})},[b.GLOBAL_GUIDELINE_ADHERENCE]:{[A.YES]:(0,f.zR)({id:"mtYPI8",defaultMessage:"Adheres to global guidelines"}),[A.NO]:(0,f.zR)({id:"rZyNgx",defaultMessage:"Violates global guidelines"})}},M=e=>{var t;return"AI_JUDGE"===(null===e||void 0===e||null===(t=e.source)||void 0===t?void 0:t.sourceType)},k=e=>{var t;let s=D(e,"request");return(0,n.isNil)(s)&&(s=D(e,E)),(0,n.isNil)(s)&&!(0,n.isNil)(e.inputs)&&Object.keys(e.inputs).length>0&&(s=K(e.inputs)),null!==(t=s)&&void 0!==t?t:e.evaluationId},D=(e,t)=>{var s,o;if(!(0,n.isNil)(e.inputsTitle))return"string"===typeof e.inputsTitle?e.inputsTitle:JSON.stringify(e.inputsTitle);let a;const r=e.inputs[t];var i;if((0,n.isPlainObject)(r)&&!(0,n.isNil)(r[E])&&Array.isArray(r[E])&&!(0,n.isNil)(null===(s=r[E][0])||void 0===s?void 0:s.content))a=null===(i=r[E][r[E].length-1])||void 0===i?void 0:i.content;else if((0,n.isNil)(r)||!Array.isArray(r)||(0,n.isNil)(null===(o=r[0])||void 0===o?void 0:o.content))a=r?K(r):void 0;else{var l;a=null===(l=r[r.length-1])||void 0===l?void 0:l.content}return a},O=e=>{var t;return!0===(null===(t=e.metadata)||void 0===t?void 0:t[I.IS_OVERALL_ASSESSMENT])},F=e=>{var t;return(0,n.isNumber)(null===(t=e.metadata)||void 0===t?void 0:t[I.CHUNK_INDEX])},L=e=>{var t,s;const o=null!==(t=null!==(s=e.stringValue)&&void 0!==s?s:e.numericValue)&&void 0!==t?t:e.booleanValue;if(!(0,n.isNil)(o))return o};function V(e,t){let s=e;const n=s.startsWith("#");n&&(s=e.slice(1));return`${n?"#":""}${s}${Math.round(255*Math.min(Math.max(t,0),1)).toString(16).toUpperCase()}`}const H=[b.GUIDELINE_ADHERENCE,b.GUIDELINES,b.GLOBAL_GUIDELINE_ADHERENCE,b.RELEVANCE_TO_QUERY,b.CONTEXT_SUFFICIENCY,b.RETRIEVAL_SUFFICIENCY,b.CORRECTNESS,b.GROUNDEDNESS,b.RETRIEVAL_GROUNDEDNESS,b.SAFETY],U=[b.CHUNK_RELEVANCE],B=({name:e,isOverallAssessment:t,value:s,rationale:n,metadata:o={}})=>{var a;const r=null!==(a=(0,h.w)())&&void 0!==a?a:"";return{booleanValue:"boolean"===typeof s?s:null,numericValue:null,stringValue:"boolean"!==typeof s?s:null,name:e,metadata:t?{...o,[I.IS_OVERALL_ASSESSMENT]:!0}:o,rationale:null!==n&&void 0!==n?n:null,source:{sourceId:r,sourceType:"HUMAN",metadata:{}},timestamp:Date.now(),isDraft:!0}},z=e=>"isDraft"in e&&e.isDraft,$=e=>(0,n.orderBy)(Object.entries(e),(([e,t],s)=>{const n=S.indexOf(e);return-1!==n?n:null!==(o=null===(a=t[t.length-1])||void 0===a?void 0:a.timestamp)&&void 0!==o?o:s;var o,a})),j=e=>{var t,s;return null!==(t=null===(s=e.overallAssessments)||void 0===s?void 0:s.filter((e=>!z(e))).some((e=>!M(e))))&&void 0!==t&&t},P=e=>{var t,s;return"HUMAN"===(null===(t=e.source)||void 0===t?void 0:t.sourceType)&&!(null!==(s=e.metadata)&&void 0!==s&&s[I.IS_COPIED_FROM_AI])},G=e=>{var t;return null===(t=e.metadata)||void 0===t?void 0:t[I.CHUNK_INDEX]},K=e=>(0,n.isPlainObject)(e)||Array.isArray(e)?JSON.stringify(e,void 0,2):e,q=e=>{if(e){const t=Boolean(e.rationale),s=!(0,n.isNil)(L(e)),o=Boolean(e.errorMessage);return!(t||s||o)}return!1},W=e=>Array.isArray(e)&&e.every((e=>(0,n.isPlainObject)(e)&&"doc_uri"in e&&"content"in e)),Q="#02B30214",J="#F000400F",X="#077A9D",Z="#FFAB00",ee="#99DDB4",te="#FCA4A1",se="#02B30214",ne=(e,t,s)=>{if("pass-fail"===t.dtype){if((null===s||void 0===s?void 0:s.stringValue)===A.YES)return e.isDarkMode?e.colors.green400:e.colors.green600;if((null===s||void 0===s?void 0:s.stringValue)===A.NO)return e.isDarkMode?e.colors.red400:e.colors.red600}return null!==s&&void 0!==s&&s.errorMessage?e.colors.textValidationWarning:e.colors.grey400},oe=(e,t,s,o=!1)=>{if("pass-fail"===t.dtype){if((null===s||void 0===s?void 0:s.stringValue)===A.YES)return se;if((null===s||void 0===s?void 0:s.stringValue)===A.NO)return e.isDarkMode?V(e.colors.red800,.6):e.colors.red200;if(!o&&null!==s&&void 0!==s&&s.errorMessage)return""}else if("boolean"===t.dtype)return(0,n.isNil)(null===s||void 0===s?void 0:s.booleanValue)?"":s.booleanValue?se:e.isDarkMode?e.colors.red800:e.colors.red200;return""},ae=(e,t,s,o)=>o?"#f09065":"pass-fail"===t.dtype?s===A.YES?ee:s===A.NO?te:e.isDarkMode?e.colors.grey800:e.colors.grey200:"boolean"===t.dtype?(0,n.isNil)(s)?e.isDarkMode?e.colors.grey800:e.colors.grey200:s?ee:te:e.isDarkMode?e.colors.grey800:e.colors.grey200;var re=s(31014),ie=s(45810);const le=ie.ok,de=ie.N_,ue="assessmentFilter";function ce(e){if("undefined"!==e)return"true"===e||"false"!==e&&e}function me(e,t){if("pass-fail"===e.dtype){if("undefined"===t)return;return t}return"boolean"===e.dtype?"true"===t||"false"!==t&&void 0:t}function pe(e){return void 0===e||null===e?"undefined":`${e}`}const ge=(e,t)=>{const[s,n]=(0,re.useState)(t&&e.find((e=>e.id===t.key))?t:void 0);return[(0,re.useMemo)((()=>{if(s&&e.find((e=>e.id===s.key)))return s}),[s,e]),n]};var ve=s(39330),fe=s(48443);const he=(0,re.createContext)({table:void 0,setTable:()=>{},selectedRowIds:[],setSelectedRowIds:()=>{}}),ye=({children:e})=>{const[t,s]=(0,re.useState)(),[n,o]=(0,re.useState)([]),a=(0,re.useMemo)((()=>({table:t,setTable:s,selectedRowIds:n,setSelectedRowIds:o})),[t,n]);return(0,y.Y)(he.Provider,{value:a,children:e})},Ee=({experimentIds:e,visible:t,selectedTraces:s,handleClose:n,deleteTraces:o})=>{const a=(0,f.tz)(),[r,i]=(0,re.useState)(""),[l,d]=(0,re.useState)(!1),u=s.map((e=>e.evaluationId));return(0,y.FD)(fe.d,{componentId:"eval-tab.delete_traces-modal",title:(0,y.Y)(f.sA,{id:"gRz1nB",defaultMessage:"{count, plural, one {Delete Trace} other {Delete Traces}}",values:{count:u.length}}),visible:t,onCancel:n,okText:(0,y.Y)(f.sA,{id:"g56Cuk",defaultMessage:"Delete {count, plural, one { # trace } other { # traces }}",values:{count:u.length}}),onOk:()=>{(async()=>{try{var t;await o(null!==(t=e[0])&&void 0!==t?t:"",u),n()}catch(s){i(a.formatMessage({id:"zhzZUu",defaultMessage:"An error occured while attempting to delete traces. Please refresh the page and try again."}))}d(!1)})(),d(!0)},okButtonProps:{loading:l,danger:!0},children:[r&&(0,y.Y)(v.T.Paragraph,{color:"error",children:r}),(0,y.Y)(v.T.Paragraph,{children:(0,y.Y)(v.T.Text,{bold:!0,children:(0,y.Y)(f.sA,{id:"kmtWGf",defaultMessage:"{count, plural, one { # trace } other { # traces }} will be deleted.",values:{count:u.length}})})}),(0,y.Y)(v.T.Paragraph,{children:(0,y.Y)(f.sA,{id:"VfGJFc",defaultMessage:"Deleted traces cannot be restored. Are you sure you want to proceed?"})})]})},be=()=>1e3;var Se=s(80870);let Ae=function(e){return e.EQUALS="=",e.GREATER_THAN=">",e.LESS_THAN="<",e.GREATER_THAN_OR_EQUALS=">=",e.LESS_THAN_OR_EQUALS="<=",e}({}),xe=function(e){return e.ASSESSMENT="ASSESSMENT",e.EXPECTATION="EXPECTATION",e.TRACE_INFO="TRACE_INFO",e.INPUT="INPUT",e.INTERNAL_MONITOR_REQUEST_TIME="INTERNAL_MONITOR_REQUEST_TIME",e}({}),Ie=function(e){return e.ASSESSMENT="ASSESSMENT",e.EXPECTATION="EXPECTATION",e.TAG="TAG",e.INFO="INFO",e}({});const we={[Ie.ASSESSMENT]:"Assessments",[Ie.EXPECTATION]:"Expectations",[Ie.TAG]:"Tags",[Ie.INFO]:"\xa0"},Ne="user",Te="session",Ce="response",_e="trace_id",Re="request_time",Ye="execution_duration",Me="state",ke="source",De="tags",Oe="trace_name",Fe="request",Le="run_name",Ve="logged_model",He="tokens",Ue="custom_metadata",Be=[Ye,Re,Te],ze=[Ye,Re],$e=[r.CHUNK_RELEVANCE,r.TOTAL_INPUT_TOKEN_COUNT,r.TOTAL_OUTPUT_TOKEN_COUNT,r.TOTAL_TOKEN_COUNT,r.DOCUMENT_RECALL,r.DOCUMENT_RATINGS];function je(e){return e+"_assessment_column"}function Pe(e){return e+"_expectation_column"}const Ge=(e,t,s,o,a,r)=>(0,re.useMemo)((()=>{const i=null!==r&&void 0!==r?r:tt(t);let l=[];if(i)l=[{id:Fe,label:e.formatMessage({id:"Ey+oLI",defaultMessage:"Request"}),type:xe.INPUT,group:Ie.INFO}];else{let e=new Set,s=new Set;t.forEach((t=>{const{inputs:n}=t;e=new Set([...e,...Object.keys(n||{})]),s=new Set([...s,...Object.keys(t.traceInfo||{})])})),l=[...e].map((e=>({id:e,label:e,type:xe.INPUT})))}const d=s.map((e=>({id:je(e.name),label:e.displayName,type:xe.ASSESSMENT,assessmentInfo:e,group:Ie.ASSESSMENT}))).filter((e=>!e.assessmentInfo.isRetrievalAssessment&&!$e.includes(e.assessmentInfo.name)));let u;const c={};if(i){u=[{id:_e,label:e.formatMessage({id:"cv/bGM",defaultMessage:"Trace ID"}),type:xe.TRACE_INFO,group:Ie.INFO},{id:Oe,label:e.formatMessage({id:"fq8v6G",defaultMessage:"Trace name"}),type:xe.TRACE_INFO,group:Ie.INFO},{id:Ce,label:e.formatMessage({id:"BU8Jni",defaultMessage:"Response"}),type:xe.TRACE_INFO,group:Ie.INFO},{id:Ne,label:e.formatMessage({id:"JcRo6a",defaultMessage:"User"}),type:xe.TRACE_INFO,group:Ie.INFO},{id:Te,label:e.formatMessage({id:"womPSY",defaultMessage:"Session"}),type:xe.TRACE_INFO,group:Ie.INFO},{id:Ye,label:e.formatMessage({id:"FnG9dP",defaultMessage:"Execution time"}),type:xe.TRACE_INFO,group:Ie.INFO},{id:Re,label:e.formatMessage({id:"/Aup8Q",defaultMessage:"Request time"}),type:xe.TRACE_INFO,group:Ie.INFO},{id:Me,label:e.formatMessage({id:"ySuIn+",defaultMessage:"State"}),type:xe.TRACE_INFO,group:Ie.INFO},{id:ke,label:e.formatMessage({id:"vM/qUz",defaultMessage:"Source"}),type:xe.TRACE_INFO,group:Ie.INFO},{id:Ve,label:e.formatMessage({id:"ofr72S",defaultMessage:"Version"}),type:xe.TRACE_INFO,group:Ie.INFO},{id:He,label:e.formatMessage({id:"q/zoT3",defaultMessage:"Tokens"}),type:xe.TRACE_INFO,group:Ie.INFO},(0,n.isNil)(o)&&{id:Le,label:e.formatMessage({id:"dVh69l",defaultMessage:"Run name"}),type:xe.TRACE_INFO,group:Ie.INFO},!1];const s=[...t,...a||[]],r={};s.forEach((e=>{var t;const s=null===(t=e.traceInfo)||void 0===t?void 0:t.trace_metadata;s&&Object.keys(s).forEach((e=>{e.startsWith(qe)||r[e]||(r[e]={id:Xe(e),label:e,type:xe.TRACE_INFO,group:Ie.INFO})}));const n=e.targets;n&&Object.keys(n).forEach((e=>{c[e]||(c[e]={id:Pe(e),label:e,type:xe.EXPECTATION,group:Ie.EXPECTATION,expectationName:e})}))})),u=[...u,...Object.values(r)];{const e={};s.map((e=>{var t;return null===(t=e.traceInfo)||void 0===t?void 0:t.tags})).forEach((t=>{Object.keys(t||{}).forEach((t=>{t.startsWith(qe)||e[t]||(e[t]={id:Je(t),label:t,type:xe.TRACE_INFO,group:Ie.TAG})}))}));const t=Object.values(e);u=[...u,...t]}}else u=t.some((e=>!(0,n.isNil)(e.requestTime)))?[{id:Re,label:e.formatMessage({id:"/Aup8Q",defaultMessage:"Request time"}),type:xe.INTERNAL_MONITOR_REQUEST_TIME}]:[];return[...l,...u,...d,...Object.values(c)].filter((e=>Boolean(e)))}),[t,e,s,o,a,r]),Ke="mlflow.sourceRun",qe="mlflow.",We=e=>(null===e||void 0===e?void 0:e.trace_id)||"",Qe=e=>e.split(":").pop(),Je=e=>`${De}:${e}`,Xe=e=>`${Ue}:${e}`,Ze=e=>(0,n.uniq)(e.map((e=>Object.keys(e.tags||{}).filter((e=>e&&!e.startsWith(qe))))).flat()),et=e=>{var t;var s;return{request_id:null!==(t=e.client_request_id)&&void 0!==t?t:e.trace_id,tags:(s=e.tags,s?Object.entries(s).map((([e,t])=>({key:e,value:t}))):void 0)}},tt=e=>e.length>0&&Boolean(e[0].traceInfo),st=e=>{try{return JSON.parse(e)}catch{return e}},nt=e=>{var t;return e.request_preview||e.request||(null===(t=e.trace_metadata)||void 0===t?void 0:t["mlflow.traceInputs"])||""},ot=e=>{var t;return e.response_preview||e.response||(null===(t=e.trace_metadata)||void 0===t?void 0:t["mlflow.traceOutputs"])||""},at=["agent/latency_seconds"];const rt=e=>{var t,s,n,o,a;const i=null===(t=e.feedback)||void 0===t?void 0:t.value,l=e.assessment_name===r.OVERALL_ASSESSMENT,d=(e=>{var t,s,n;if(null===(t=e.source)||void 0===t||!t.source_type)return;const o=null===(s=e.source)||void 0===s?void 0:s.source_type;let a;return a="LLM_JUDGE"===o?"AI_JUDGE":o,{sourceType:a,sourceId:(null===(n=e.source)||void 0===n?void 0:n.source_id)||"",metadata:{}}})(e),u=(null===(s=e.feedback)||void 0===s?void 0:s.error)||e.error;return{name:e.assessment_name,stringValue:"string"===typeof i?i:void 0,booleanValue:"boolean"===typeof i?i:void 0,numericValue:"number"===typeof i?i:void 0,errorCode:null===u||void 0===u?void 0:u.error_code,errorMessage:null===u||void 0===u?void 0:u.error_message,rationale:(null===(n=e.metadata)||void 0===n?void 0:n.root_cause_rationale)||e.rationale,source:d,rootCauseAssessment:l?{assessmentName:(null===(o=e.metadata)||void 0===o?void 0:o.root_cause_assessment)||"",suggestedActions:null===(a=e.metadata)||void 0===a?void 0:a.suggested_action}:void 0,metadata:e.metadata}},it=e=>{var t;const s=We(e),o=[],a={},i={};null===(t=e.assessments)||void 0===t||t.forEach((e=>{const t=e.assessment_name;at.includes(t)||((e=>Boolean(e.expectation))(e)?function(e,t){var s,n,o;const a=e.assessment_name,r=(null===(s=e.expectation)||void 0===s?void 0:s.value)||(null===(n=e.expectation)||void 0===n||null===(o=n.serialized_value)||void 0===o?void 0:o.value);Array.isArray(r)&&r.length>0?t[a]=r.map((e=>st(e))):t[a]="string"===typeof r?st(r):[]}(e,i):function(e,t,s){const n=e.assessment_name,o=rt(e);n===r.OVERALL_ASSESSMENT&&t.push(o),s[n]||(s[n]=[]),s[n].push(o)}(e,o,a))}));const l=nt(e),d=ot(e);let u=l,c={},m={};try{var p;c=JSON.parse(l);const e=c.messages;var g;if(Array.isArray(e)&&!(0,n.isNil)(null===(p=e[0])||void 0===p?void 0:p.content))u=null===(g=e[e.length-1])||void 0===g?void 0:g.content;else u=K(c)}catch{c={request:l}}try{m={response:JSON.parse(d)}}catch{m={response:d}}return{evaluationId:s,requestId:e.client_request_id||s,inputsId:s,inputsTitle:u,inputs:c,outputs:m,targets:i,overallAssessments:o,responseAssessmentsByName:a,metrics:{},traceInfo:e}},lt=e=>tt(e)?e.map((e=>{if(!e.traceInfo)return e;const t=it(e.traceInfo);return{...e,...t}})):e;const dt=(e,t)=>Object.fromEntries(Object.entries(e).map((([e,s])=>[e,s.filter((e=>{var s;return Number(null===e||void 0===e||null===(s=e.metadata)||void 0===s?void 0:s.span_output_key)===t}))])).filter((([e,t])=>t.length>0))),ut=e=>{const{traceActions:t,experimentId:s,selectedTraces:o,traceInfos:a,setRowSelection:r}=e,{table:i,selectedRowIds:l}=(0,re.useContext)(he),d=(0,re.useMemo)((()=>lt(l.map((e=>{const t=null===a||void 0===a?void 0:a.find((t=>We(t)===e));if(t)return{evaluationId:t.trace_id,requestId:t.client_request_id||t.trace_id,inputsId:t.trace_id,inputs:{},outputs:{},targets:{},overallAssessments:[],responseAssessmentsByName:{},metrics:{},traceInfo:t}})).filter((e=>!(0,n.isNil)(e))))),[l,a]),u=o||d;return(0,y.Y)(ct,{experimentId:s,selectedTraces:u,traceActions:t,setRowSelection:null!==r&&void 0!==r?r:null===i||void 0===i?void 0:i.setRowSelection})},ct=e=>{var t,s;const{experimentId:n,selectedTraces:o,traceActions:a,setRowSelection:r}=e,i=(0,f.tz)(),[l,d]=(0,re.useState)(!1),[u,c]=(0,re.useState)(!1),[m,p]=(0,re.useState)(!1),h=((0,re.useCallback)((()=>{d(!0)}),[]),(0,re.useCallback)((()=>{c(!0)}),[]),(0,re.useCallback)((()=>{if(1===o.length&&o[0].traceInfo&&null!==a&&void 0!==a&&a.editTags){const e=et(o[0].traceInfo);a.editTags.showEditTagsModalForTrace(e)}}),[o,a])),E=(0,re.useCallback)((()=>{p(!0)}),[]),b=(0,re.useCallback)((async(e,t)=>{var s;await(null===a||void 0===a||null===(s=a.deleteTracesAction)||void 0===s?void 0:s.deleteTraces(e,t)),null===r||void 0===r||r({})}),[r,a]),S=Boolean(null===a||void 0===a||null===(t=a.exportToEvals)||void 0===t?void 0:t.getTrace),A=Boolean(null===a||void 0===a?void 0:a.editTags),x=Boolean(null===a||void 0===a?void 0:a.deleteTracesAction),I=o.length>1,w=0===o.length;if(!S&&!A&&!x)return null;const N=(0,y.Y)(v.B,{componentId:"mlflow.genai-traces-table.actions-dropdown",disabled:w,type:"primary",endIcon:(0,y.Y)(g.ChevronDownIcon,{}),children:i.formatMessage({id:"PwQiIn",defaultMessage:"Actions{count}"},{count:w?"":` (${o.length})`})});return(0,y.FD)(y.FK,{children:[(0,y.FD)(g.DropdownMenu.Root,{children:[w?(0,y.Y)(fe.T,{componentId:"mlflow.genai-traces-table.actions-disabled-tooltip",content:i.formatMessage({id:"HbgpOU",defaultMessage:"Select one or more traces to add to an evaluation or edit the traces."}),children:(0,y.Y)("div",{children:(0,y.Y)(g.DropdownMenu.Trigger,{asChild:!0,children:N})})}):(0,y.Y)(g.DropdownMenu.Trigger,{asChild:!0,children:N}),(0,y.Y)(g.DropdownMenu.Content,{children:(A||x)&&(0,y.FD)(y.FK,{children:[S&&(0,y.Y)(g.DropdownMenu.Separator,{}),(0,y.FD)(g.DropdownMenu.Group,{children:[(0,y.Y)(g.DropdownMenu.Label,{children:i.formatMessage({id:"gerwuf",defaultMessage:"Edit"})}),A&&(0,y.Y)(g.DropdownMenu.Item,{componentId:"mlflow.genai-traces-table.edit-tags",onClick:h,disabled:I,children:i.formatMessage({id:"A7jptW",defaultMessage:"Edit tags"})}),x&&(0,y.Y)(g.DropdownMenu.Item,{componentId:"mlflow.genai-traces-table.delete-traces",onClick:E,children:i.formatMessage({id:"G6CJOv",defaultMessage:"Delete traces"})})]})]})})]}),null===a||void 0===a||null===(s=a.editTags)||void 0===s?void 0:s.EditTagsModal,m&&(null===a||void 0===a?void 0:a.deleteTracesAction)&&(0,y.Y)(Ee,{experimentIds:[n],visible:m,selectedTraces:o,handleClose:()=>p(!1),deleteTraces:b})]})},mt=[Ie.INFO,Ie.ASSESSMENT,Ie.EXPECTATION,Ie.TAG],pt=[_e,Fe,Ce,Te,Ne,Oe,Ve,He],gt=[r.OVERALL_ASSESSMENT],vt=Object.fromEntries(mt.map(((e,t)=>[e,t]))),ft=Object.fromEntries(pt.map(((e,t)=>[e,t]))),ht=Object.fromEntries(gt.map(((e,t)=>[e,t])));function yt(e,t){return[...e].sort(((e,s)=>{var n,o;if(t){if(e.id===Fe)return-1;if(s.id===Fe)return 1}const a=null!==(n=e.group)&&void 0!==n?n:Ie.INFO,r=null!==(o=s.group)&&void 0!==o?o:Ie.INFO,i=vt[a]-vt[r];if(0!==i)return i;if(a===Ie.INFO){var l,d;const t=null!==(l=ft[e.id])&&void 0!==l?l:1/0,n=null!==(d=ft[s.id])&&void 0!==d?d:1/0;return t!==n?t-n:e.label.localeCompare(s.label)}if(a===Ie.ASSESSMENT){var u,c;const t=null!==(u=ht[e.id])&&void 0!==u?u:1/0,n=null!==(c=ht[s.id])&&void 0!==c?c:1/0;return t!==n?t-n:e.label.localeCompare(s.label)}return Ie.EXPECTATION,e.label.localeCompare(s.label)}))}const Et=(e,t)=>e.sort(((e,s)=>{const n=e=>{var s;const n=null===(s=t.find((t=>t.id===e.id)))||void 0===s?void 0:s.type;return n===xe.INPUT?1:e.id===Oe?2:n===xe.TRACE_INFO?3:n===xe.INTERNAL_MONITOR_REQUEST_TIME?4:n===xe.ASSESSMENT?5:999},o=n(e)-n(s);if(0!==o)return o;const a=t.find((t=>t.id===e.id)),i=t.find((e=>e.id===s.id));return(null===a||void 0===a?void 0:a.type)===xe.ASSESSMENT&&(null===i||void 0===i?void 0:i.type)===xe.ASSESSMENT?a.id===r.OVERALL_ASSESSMENT?-1:i.id===r.OVERALL_ASSESSMENT?1:(a.label||"").localeCompare(i.label||""):0})),bt=(e,t)=>{var s;switch(t){case Re:case Ye:case De:case Me:return e[t];case ke:return e.tags;case _e:return e.trace_id;case Te:return null===(s=e.tags)||void 0===s?void 0:s["mlflow.trace.session"];default:throw new Error(`Unknown column id: ${t}`)}};function St(e){const t=new Map,s=new Map;return null===e||void 0===e||e.forEach((e=>{let n=tt([e])?nt(e.traceInfo):e.inputsId;if(t.has(n)){const t=(s.get(e.inputsId)||0)+1;s.set(e.inputsId,t),n=`${e.inputsId}_${t}`}t.set(n,e)})),t}function At(e,t){if((0,n.isNil)(t))return e.map((e=>({currentRunValue:e})));const s=St(t),o=St(e),a=new Set([...o.keys(),...s.keys()]);return Array.from(a).map((e=>({currentRunValue:o.get(e),otherRunValue:s.get(e)})))}var xt=s(70618),It=s(9856),wt=s(58732),Nt=s(41261);const Tt=()=>{const{theme:e}=(0,v.u)();return(0,y.FD)("span",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:e.spacing.sm,svg:{width:"12px",height:"12px"},color:e.colors.textValidationWarning},""),children:[(0,y.Y)(v.l,{css:(0,p.AH)({color:e.colors.textValidationWarning},"")}),(0,y.Y)(f.sA,{id:"HdEgbb",defaultMessage:"Error"})," "]})};var Ct={name:"rhxkjj",styles:"height:20px"};const _t=({isComparing:e})=>{const{theme:t}=(0,v.u)();return(0,y.Y)("span",{css:Ct,children:e&&(0,y.Y)("span",{css:(0,p.AH)({fontStyle:"italic",color:t.colors.textSecondary},""),children:"null"})})},Rt=e=>{const{first:t,second:s,gap:n,borderRadius:o,marginY:a}=e,{theme:r}=(0,v.u)();return(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n||r.spacing.sm,borderRadius:o||r.legacyBorders.borderRadiusMd,marginTop:a||"auto",marginBottom:a||"auto"},""),children:[t,s]})};var Yt=s(53962),Mt=s(39416);const kt=fetch,Dt=async(e,t,s)=>{const n={method:t,headers:{...s?{"Content-Type":"application/json"}:{},...(0,Yt.KZ)(document.cookie)}};s&&(n.body=JSON.stringify(s));const o=await kt(e,n);if(!o.ok){const e=(0,Mt.a$)(o);try{const t=await(await o.json()).message;t&&(e.message=t)}catch{}throw e}return o.json()};class Ot{static getEntryPointName(e){const t=e[Ot.entryPointTag];return t?t.value:""}static getSourceType(e){const t=e[Ot.sourceTypeTag];return t?t.value:""}static dropExtension(e){return e.replace(/(.*[^/])\.[^/.]+$/,"$1")}static baseName(e){const t=e.split("/");return t[t.length-1]}static formatSource(e){const t=Ot.getSourceName(e),s=Ot.getSourceType(e),n=Ot.getEntryPointName(e);if("PROJECT"===s){let e=Ot.dropExtension(Ot.baseName(t));return n&&"main"!==n&&(e+=":"+n),e}if("JOB"===s){const s="mlflow.databricks.jobID",n="mlflow.databricks.jobRunID",o=e&&e[s]&&e[s].value,a=e&&e[n]&&e[n].value;return o&&a?Ot.getDefaultJobRunName(o,a):t}return Ot.baseName(t)}static getDefaultJobRunName(e,t,s=null){if(!e)return"-";let n=`job ${e}`;return t&&(n=`run ${t} of `+n),s&&(n=`workspace ${s}: `+n),n}static getSourceName(e){const t=e[Ot.sourceNameTag];return t?t.value:""}static getGitHubRegex(){return/[@/]github.com[:/]([^/.]+)\/([^/#]+)#?(.*)/}static getGitLabRegex(){return/[@/]gitlab.com[:/]([^/.]+)\/([^/#]+)#?(.*)/}static getBitbucketRegex(){return/[@/]bitbucket.org[:/]([^/.]+)\/([^/#]+)#?(.*)/}static getRunPageRoute(e,t){return`/experiments/${e}/runs/${t}`}static getLoggedModelPageRoute(e,t){return`/experiments/${e}/models/${t}`}static getGitRegex(){return/(.*?[@/][^?]*git.*?)[:/]([^#]+)(?:#(.*))?/}static getGitRepoUrl(e,t="master"){const s=e.match(Ot.getGitHubRegex()),n=e.match(Ot.getGitLabRegex()),o=e.match(Ot.getBitbucketRegex()),a=e.match(Ot.getGitRegex());let r=null;if(s)r=`https://github.com/${s[1]}/${s[2].replace(/.git/,"")}`,s[3]&&(r+=`/tree/${t}/${s[3]}`);else if(n)r=`https://gitlab.com/${n[1]}/${n[2].replace(/.git/,"")}`,n[3]&&(r+=`/-/tree/${t}/${n[3]}`);else if(o)r=`https://bitbucket.org/${o[1]}/${o[2].replace(/.git/,"")}`,o[3]&&(r+=`/src/${t}/${o[3]}`);else if(a){const[,e,s,n]=a;r=e.replace(/git@/,"https://")+"/"+s.replace(/.git/,""),n&&(r+=`/tree/${t}/${n}`)}return r}static getNotebookRevisionId(e){const t="mlflow.databricks.notebookRevisionID";return e&&e[t]&&e[t].value}static getNotebookId(e){const t="mlflow.databricks.notebookID";return e&&e[t]&&e[t].value}static isCurrentWorkspace(e){return!0}static getDefaultNotebookRevisionName(e,t,s=null){if(!e)return"-";let n=`notebook ${e}`;return t&&(n=`revision ${t} of `+n),s&&(n=`workspace ${s}: `+n),n}static ensureUrlScheme(e,t="https"){return e?e.match(/^:\/\//i)?`${t}${e}`:e.match(/^[a-z1-9+-.]+:\/\//i)?e:`${t}://${e}`:e}static setQueryParams(e,t){const s=new URL(Ot.ensureUrlScheme(e));return s.search=t||"",s.toString()}static getNotebookSourceUrl(e,t,s,n,o=null){let a=Ot.setQueryParams(o||window.location.origin,e);return a+=`#notebook/${t}`,s&&(a+=`/revision/${s}`,n&&(a+=`/mlflow/run/${n}`)),a}static renderNotebookSource(e,t,s,n,o,a=null,r=null){const i=o?Ot.baseName(o):Ot.getDefaultNotebookRevisionName(t,s),l=r||i;if(t){const r=Ot.getNotebookSourceUrl(e,t,s,n,a);return(0,y.Y)("a",{title:o||Ot.getDefaultNotebookRevisionName(t,s),href:r,target:"_top",children:l})}return l}static addQueryParams(e,t){if(!t||0===Object.keys(t).length)return e;const s=new URLSearchParams(e);Object.entries(t).forEach((([e,t])=>Boolean(e)&&Boolean(t)&&s.set(e,t)));const n=s.toString();return""===n||n.includes("?")?n:`?${n}`}static getJobSourceUrl(e,t,s,n=null){let o=Ot.setQueryParams(n||window.location.origin,e);return o+=`#job/${t}`,s&&(o+=`/run/${s}`),o}static renderJobSource(e,t,s,n,o=null,a=null){const r=n||Ot.getDefaultJobRunName(t,s),i=a||r;if(t){const n=Ot.getJobSourceUrl(e,t,s,o);return(0,y.Y)("a",{title:r,href:n,target:"_top",children:i})}return i}static renderSource(e,t,s,n="master"){const o=Ot.getSourceName(e);let a=Ot.formatSource(e);const r=Ot.getGitRepoUrl(o,n);r&&(a=(0,y.Y)("a",{target:"_top",href:r,children:a}));const i=Ot.getSourceType(e);if("NOTEBOOK"===i){const n=Ot.getNotebookRevisionId(e),a=Ot.getNotebookId(e),r="mlflow.databricks.workspaceID",i=e&&e[r]&&e[r].value;if(Ot.isCurrentWorkspace(i))return Ot.renderNotebookSource(t,a,n,s,o,null);{const r="mlflow.databricks.workspaceURL",l=e&&e[r]&&e[r].value,d=Ot.addQueryParams(t,{o:i});return Ot.renderNotebookSource(d,a,n,s,o,l)}}if("JOB"===i){const s="mlflow.databricks.jobID",n="mlflow.databricks.jobRunID",o=e&&e[s]&&e[s].value,r=e&&e[n]&&e[n].value,i="mlflow.databricks.workspaceID",l=e&&e[i]&&e[i].value;if(Ot.isCurrentWorkspace(l))return Ot.renderJobSource(t,o,r,a,null);{const s="mlflow.databricks.workspaceURL",n=e&&e[s]&&e[s].value,i=Ot.addQueryParams(t,{o:l});return Ot.renderJobSource(i,o,r,a,n)}}return a}static renderSourceFromMetadata(e){var t,s,n,o,a;const r=null===(t=e.trace_metadata)||void 0===t?void 0:t[Ot.sourceNameTag],i=null===(s=e.trace_metadata)||void 0===s?void 0:s[Ot.sourceTypeTag];let l=r?Ot.baseName(r):"";const d=null===(n=e.trace_metadata)||void 0===n?void 0:n["mlflow.source.git.repoURL"],u=null===(o=e.trace_metadata)||void 0===o?void 0:o["mlflow.source.git.branch"],c=null===(a=e.trace_metadata)||void 0===a?void 0:a["mlflow.source.git.commit"];if(d){const e=d.replace("git@github.com:","https://github.com/").replace("git@gitlab.com:","https://gitlab.com/").replace("git@bitbucket.org:","https://bitbucket.org/").replace(".git",""),t=c||u||"master",s=r?`/${r}`:"";let n=e;n=e.includes("github.com")?`${e}/tree/${t}${s}`:e.includes("gitlab.com")?`${e}/-/tree/${t}${s}`:e.includes("bitbucket.org")?`${e}/src/${t}${s}`:`${e}/tree/${t}${s}`,l=(0,y.Y)("a",{target:"_blank",rel:"noopener noreferrer",href:n,children:l})}if("NOTEBOOK"===i){var m,p,g;const t=null===(m=e.trace_metadata)||void 0===m?void 0:m["mlflow.databricks.notebookRevisionID"],s=null===(p=e.trace_metadata)||void 0===p?void 0:p["mlflow.databricks.notebookID"],n=null===(g=e.trace_metadata)||void 0===g?void 0:g["mlflow.databricks.workspaceID"];if(Ot.isCurrentWorkspace(n))return Ot.renderNotebookSource(null,s,t,null,r,null);{var v;const o="mlflow.databricks.workspaceURL",a=(null===(v=e.trace_metadata)||void 0===v?void 0:v[o])||void 0,i=Ot.addQueryParams(null,{o:n});return Ot.renderNotebookSource(i,s,t,null,r,a)}}if("JOB"===i){var f,h,E;const t=null===(f=e.trace_metadata)||void 0===f?void 0:f["mlflow.databricks.jobID"],s=null===(h=e.trace_metadata)||void 0===h?void 0:h["mlflow.databricks.jobRunID"],n=null===(E=e.trace_metadata)||void 0===E?void 0:E["mlflow.databricks.workspaceID"];if(Ot.isCurrentWorkspace(n))return Ot.renderJobSource(null,t,s,l,null);{var b;const o="mlflow.databricks.workspaceURL",a=(null===(b=e.trace_metadata)||void 0===b?void 0:b[o])||void 0,r=Ot.addQueryParams(null,{o:n});return Ot.renderJobSource(r,t,s,l,a)}}return l}}Ot.runNameTag="mlflow.runName",Ot.sourceNameTag="mlflow.source.name",Ot.sourceTypeTag="mlflow.source.type",Ot.entryPointTag="mlflow.project.entryPoint";var Ft=Ot;const Lt=e=>{var t,s;const{experimentId:n,currentTraceInfo:o,otherTraceInfo:a,isComparing:r}=e,i=null===o||void 0===o||null===(t=o.trace_metadata)||void 0===t?void 0:t["mlflow.modelId"],l=null===a||void 0===a||null===(s=a.trace_metadata)||void 0===s?void 0:s["mlflow.modelId"];return(0,y.Y)(Rt,{first:i?(0,y.Y)(Bt,{experimentId:n,modelId:i,isComparing:r}):(0,y.Y)(_t,{isComparing:r}),second:r&&(l?(0,y.Y)(Bt,{experimentId:n,modelId:l,isComparing:r}):(0,y.Y)(_t,{isComparing:r}))})};var Vt={name:"1puasmx",styles:"width:fit-content;max-width:100%;margin-right:0;cursor:pointer"},Ht={name:"1it2kpr",styles:"max-width:100%;display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Ut={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const Bt=e=>{var t;const{experimentId:s,modelId:n,isComparing:o}=e,{theme:a}=(0,v.u)(),{data:r,isLoading:i,error:l}=zt({loggedModelId:n}),d=null===r||void 0===r||null===(t=r.info)||void 0===t?void 0:t.name;return i?(0,y.Y)(g.ParagraphSkeleton,{}):l?(0,y.Y)(Tt,{}):d?(0,y.Y)(fe.T,{componentId:"mlflow.eval-runs.model-version-cell-tooltip",content:d,children:(0,y.Y)(g.Tag,{componentId:"mlflow.eval-runs.model-version-cell",id:"model-version-cell",css:Vt,children:(0,y.Y)(de,{to:Ft.getLoggedModelPageRoute(s,n),target:"_blank",css:Ht,title:d,children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:a.spacing.xs,maxWidth:"100%"},""),children:[(0,y.Y)(g.ModelsIcon,{css:(0,p.AH)({color:a.colors.textPrimary,fontSize:16},"")}),(0,y.Y)(v.T.Text,{css:Ut,children:d})]})})})}):(0,y.Y)(_t,{isComparing:o})},zt=({loggedModelId:e})=>{const{data:t,isLoading:s,isFetching:o,refetch:a,error:r}=(0,Nt.I)({queryKey:["loggedModelName",e],queryFn:async()=>await Dt(`ajax-api/2.0/mlflow/logged-models/${e}`,"GET"),cacheTime:1/0,staleTime:1/0,refetchOnMount:!1,retry:1,enabled:!(0,n.isNil)(e)});return{isLoading:s,isFetching:o,data:null===t||void 0===t?void 0:t.model,refetch:a,error:r}};var $t={name:"pzwiqy",styles:"display:flex;max-width:100%;text-overflow:ellipsis;overflow:hidden;white-space:nowrap"};const jt=e=>{var t,s,n;const{experimentId:o,runUuid:a}=e,{data:r,isLoading:i,error:l}=Pt(o,a),d=null===r||void 0===r||null===(t=r.runs)||void 0===t||null===(s=t[0])||void 0===s||null===(n=s.info)||void 0===n?void 0:n.run_name;return i?(0,y.Y)(g.ParagraphSkeleton,{}):l?(0,y.Y)(Tt,{}):d?(0,y.Y)(de,{css:$t,to:Ft.getRunPageRoute(o,a),title:d,children:d}):(0,y.Y)(_t,{})},Pt=(e,t)=>(0,Nt.I)({queryKey:["runName",e,t],cacheTime:1/0,staleTime:1/0,retry:1,refetchOnMount:!1,queryFn:async()=>{const s=`run_id IN ('${t}')`;return await Dt("ajax-api/2.0/mlflow/runs/search","POST",{experiment_ids:[e],filter:s})}});var Gt=function(e){return e.NOTEBOOK="NOTEBOOK",e.JOB="JOB",e.PROJECT="PROJECT",e.LOCAL="LOCAL",e.UNKNOWN="UNKNOWN",e}(Gt||{});const Kt=({sourceType:e,className:t})=>e===Gt.NOTEBOOK?(0,y.Y)(g.NotebookIcon,{className:t}):e===Gt.LOCAL?(0,y.Y)(g.HomeIcon,{className:t}):e===Gt.PROJECT?(0,y.Y)(g.FolderBranchIcon,{className:t}):e===Gt.JOB?(0,y.Y)(g.WorkflowsIcon,{className:t}):null;var qt={name:"1gz2b5f",styles:"overflow:hidden;text-overflow:ellipsis"};const Wt=e=>{var t;const s=e.traceInfo.tags,{theme:n}=(0,v.u)();if(!s)return(0,y.Y)(_t,{isComparing:e.isComparing});const o=null===(t=e.traceInfo.trace_metadata)||void 0===t?void 0:t[Ft.sourceTypeTag],a=Ft.renderSourceFromMetadata(e.traceInfo);return a&&o?(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:n.spacing.xs,alignItems:"center",...e.disableLinks&&{"& a":{pointerEvents:"none",color:"inherit",textDecoration:"none",cursor:"default"}}},""),children:[(0,y.Y)(Kt,{sourceType:o,css:(0,p.AH)({color:n.colors.textSecondary},"")}),(0,y.Y)("span",{css:qt,children:a})]}):(0,y.Y)(_t,{isComparing:e.isComparing})},Qt={STATE_UNSPECIFIED:null,IN_PROGRESS:(0,f.zR)({id:"y56Vz9",defaultMessage:"In progress"}),OK:(0,f.zR)({id:"Mn7Kss",defaultMessage:"OK"}),ERROR:(0,f.zR)({id:"igK5Su",defaultMessage:"Error"})},Jt=(e,t)=>"IN_PROGRESS"===e?(0,y.Y)(ve.C,{css:(0,p.AH)({color:t.colors.textValidationWarning},"")}):"OK"===e?(0,y.Y)(g.CheckCircleIcon,{css:(0,p.AH)({color:t.colors.textValidationSuccess},"")}):"ERROR"===e?(0,y.Y)(g.XCircleIcon,{css:(0,p.AH)({color:t.colors.textValidationDanger},"")}):null,Xt=({original:e,isComparing:t})=>{const{theme:s}=(0,v.u)(),n=(0,f.tz)(),o=Qt[(null===e||void 0===e?void 0:e.state)||"STATE_UNSPECIFIED"];return o?(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:s.spacing.xs,alignItems:"center"},""),children:[Jt((null===e||void 0===e?void 0:e.state)||"STATE_UNSPECIFIED",s),o?n.formatMessage(o):""]}):(0,y.Y)(_t,{isComparing:t})};var Zt=s(9650);const{Paragraph:es}=v.T;var ts={name:"s5xdrg",styles:"display:flex;align-items:center"},ss={name:"1ff36h2",styles:"flex-grow:1"};const ns=re.memo((e=>{const{theme:t}=(0,v.u)();return(0,y.Y)(fe.d,{componentId:"codegen_mlflow_app_src_common_components_keyvaluetagfullviewmodal.tsx_17",title:"Tag: "+e.tagKey,visible:e.isKeyValueTagFullViewModalVisible,onCancel:()=>e.setIsKeyValueTagFullViewModalVisible(!1),children:(0,y.FD)("div",{css:ts,children:[(0,y.Y)(es,{css:ss,children:(0,y.Y)("pre",{css:(0,p.AH)({backgroundColor:t.colors.backgroundPrimary,marginTop:t.spacing.sm,whiteSpace:"pre-wrap",wordBreak:"break-all"},""),children:e.tagValue})}),(0,y.Y)("div",{css:(0,p.AH)({marginBottom:t.spacing.md},""),children:(0,y.Y)(Zt.ad,{componentId:"mlflow.genai-traces-table.tag_view_modal.tag_value_copy_button",copyText:e.tagValue})})]})})}));function os(e=!0){return e?{overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap",whiteSpace:"nowrap"}:{whiteSpace:"nowrap"}}const as=({isClosable:e=!1,onClose:t,tag:s,enableFullViewModal:n=!1,charLimit:o=30,maxWidth:a=300,className:r})=>{const i=(0,f.tz)(),[l,d]=(0,re.useState)(!1),{shouldTruncateKey:u,shouldTruncateValue:c}=function(e,t=30){const{key:s,value:n}=e,o=s.length+n.length,a=s.length>n.length,r=a?n.length:s.length;return o<=t?{shouldTruncateKey:!1,shouldTruncateValue:!1}:r>t/2?{shouldTruncateKey:!0,shouldTruncateValue:!0}:{shouldTruncateKey:a,shouldTruncateValue:!a}}(s,o),m=n&&(u||c),h=i.formatMessage({id:"ZXUtU8",defaultMessage:"Click to see more"});return(0,y.FD)("div",{children:[(0,y.Y)(g.Tag,{componentId:"codegen_mlflow_app_src_common_components_keyvaluetag.tsx_60",closable:e,onClose:t,title:s.key,className:r,children:(0,y.Y)(fe.T,{componentId:"web-shared.genai-traces-table.key-value-tag.full-view-tooltip",content:m?(0,y.Y)("span",{children:h}):void 0,children:(0,y.FD)("span",{css:(0,p.AH)({maxWidth:a,display:"inline-flex"},""),onClick:()=>m?d(!0):void 0,children:[(0,y.Y)(v.T.Text,{bold:!0,title:s.key,css:os(u),children:s.key}),s.value&&(0,y.FD)(v.T.Text,{title:s.value,css:os(c),children:[": ",s.value]})]})})}),(0,y.Y)("div",{children:l&&(0,y.Y)(ns,{tagKey:s.key,tagValue:s.value,isKeyValueTagFullViewModalVisible:l,setIsKeyValueTagFullViewModalVisible:d})})]})};var rs={name:"1wcfv52",styles:"margin-right:0"},is={name:"14cnl6e",styles:"flex-shrink:0;opacity:0;[role=row]:hover &{opacity:1;}[role=row]:focus-within &{opacity:1;}"};const ls=({onAddEditTags:e,tags:t,baseComponentId:s})=>{const{theme:n}=(0,v.u)(),o=(null===t||void 0===t?void 0:t.filter((({key:e})=>e&&!e.startsWith(qe))))||[],a=o.length>0;return(0,y.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",flexWrap:"wrap",columnGap:n.spacing.xs,rowGap:n.spacing.xs},""),children:[o.map((e=>(0,y.Y)(as,{tag:e,css:rs,charLimit:20,maxWidth:150,enableFullViewModal:!0},e.key))),e&&(0,y.Y)(v.B,{componentId:`${s}.traces_table.edit_tag`,size:"small",icon:a?(0,y.Y)(g.PencilIcon,{}):void 0,onClick:e,children:a?void 0:(0,y.Y)(f.sA,{id:"vHNP+J",defaultMessage:"Add tags"}),css:is,type:"tertiary"})]})};const ds=e=>{const{currentTraceInfo:t,otherTraceInfo:s,isComparing:n}=e;return(0,y.Y)(Rt,{first:(0,y.Y)(Es,{traceInfo:t,isComparing:n}),second:n&&(0,y.Y)(Es,{traceInfo:s,isComparing:n})})};var us={name:"58t467",styles:"width:fit-content;max-width:100%"},cs={name:"hdknak",styles:"display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},ms={name:"1fttcpj",styles:"display:flex;flex-direction:column"},ps={name:"ho1qnd",styles:"display:flex;flex-direction:row"},gs={name:"i9sky5",styles:"width:35%"},vs={name:"ho1qnd",styles:"display:flex;flex-direction:row"},fs={name:"i9sky5",styles:"width:35%"},hs={name:"ho1qnd",styles:"display:flex;flex-direction:row"},ys={name:"i9sky5",styles:"width:35%"};const Es=e=>{var t;const{traceInfo:s,isComparing:n}=e,o=null===s||void 0===s||null===(t=s.trace_metadata)||void 0===t?void 0:t["mlflow.trace.tokenUsage"],a=(()=>{try{return o?JSON.parse(o):{}}catch{return{}}})(),r=a.total_tokens,i=a.input_tokens,l=a.output_tokens,d=(0,f.tz)();return r?(0,y.Y)(g.HoverCard,{trigger:(0,y.Y)(g.Tag,{css:us,componentId:"mlflow.genai-traces-table.tokens",children:(0,y.Y)("span",{css:cs,children:r})}),content:(0,y.FD)("div",{css:ms,children:[r&&(0,y.FD)("div",{css:ps,children:[(0,y.Y)("div",{css:gs,children:(0,y.Y)(v.T.Text,{children:d.formatMessage({id:"83wDn8",defaultMessage:"Total"})})}),(0,y.Y)("div",{children:(0,y.Y)(v.T.Text,{color:"secondary",children:r})})]}),i&&(0,y.FD)("div",{css:vs,children:[(0,y.Y)("div",{css:fs,children:(0,y.Y)(v.T.Text,{children:d.formatMessage({id:"Y7DzTT",defaultMessage:"Input"})})}),(0,y.Y)("div",{children:(0,y.Y)(v.T.Text,{color:"secondary",children:i})})]}),l&&(0,y.FD)("div",{css:hs,children:[(0,y.Y)("div",{css:ys,children:(0,y.Y)(v.T.Text,{children:d.formatMessage({id:"tGqJL4",defaultMessage:"Output"})})}),(0,y.Y)("div",{children:(0,y.Y)(v.T.Text,{color:"secondary",children:l})})]})]})}):(0,y.Y)(_t,{isComparing:n})},bs="Error";function Ss(e){return Boolean((null===e||void 0===e?void 0:e.errorCode)||(null===e||void 0===e?void 0:e.errorMessage))}function As(e){const t=e.split("/");return 1===t.length?{metricName:e,assessmentName:e}:2===t.length?{metricName:t[0],assessmentName:t[1]}:{metricName:t[1],assessmentName:t.slice(2).join("/")}}const xs=[A.YES,A.NO];function Is(e,t,s){var o;const a={},r={[b.OVERALL_ASSESSMENT]:"pass-fail"},i=new Set;[...t,...s||[]].forEach((e=>{var t;const s=Object.entries(e.responseAssessmentsByName||{}),o=e.overallAssessments.map((e=>[b.OVERALL_ASSESSMENT,[e]])),a=[];null===(t=e.retrievalChunks)||void 0===t||t.forEach((e=>{for(const[t,s]of Object.entries(e.retrievalAssessmentsByName||{}))a.push([t,s])}));for(const[l,d]of[...s,...o,...a]){i.add(l);const e=d[0];let t=(0,n.isNil)(e.stringValue)?(0,n.isNil)(e.numericValue)?(0,n.isNil)(e.booleanValue)?void 0:"boolean":"numeric":"pass-fail";Ss(e)&&(t=void 0),r[l]||(l in C&&(t="pass-fail"),r[l]=t),"pass-fail"!==t||(0,n.isNil)(e.stringValue)||xs.includes(e.stringValue)||(r[l]="string"),void 0!==t&&t!==r[l]&&(r[l]="string")}}));for(const n of i)r[n]||(r[n]="unknown");[...t,...s||[]].forEach((t=>{var s;const o=Object.entries(t.responseAssessmentsByName||{}),i=t.overallAssessments.map((e=>[b.OVERALL_ASSESSMENT,[e]])),l=[];null===(s=t.retrievalChunks)||void 0===s||s.forEach((e=>{for(const[t,s]of Object.entries(e.retrievalAssessmentsByName||{}))l.push([t,s])}));const d=Object.keys(r);for(const f of d){const t=[...o.filter((([e])=>e===f)),...i.filter((([e])=>e===f)),...l.filter((([e])=>e===f))].map((([e,t])=>t[0]))[0],s=Ss(t);if((0,n.isNil)(a[f])){var u,c,m;let n,o,i=!1;const d=void 0!==C[f];if(d)n=e.formatMessage(C[f]),o=f,i=!1;else{var p;const{metricName:e,assessmentName:s}=As(f);n=s||"-",o=e,"CODE"===(null===t||void 0===t||null===(p=t.source)||void 0===p?void 0:p.sourceType)&&(i=!0)}const g=r[f]||"string",v="https://mlflow.org/docs/latest/genai/eval-monitor/scorers/llm-judge/",h=f in _?e.formatMessage(_[f]):"",y=f in R?e.formatMessage(R[f]):"HUMAN"===(null===t||void 0===t||null===(u=t.source)||void 0===u?void 0:u.sourceType)?e.formatMessage({id:"z94r4F",defaultMessage:"This assessment is produced by a human judge."}):e.formatMessage({id:"lQ2nDn",defaultMessage:"This assessment is produced by a custom metric."});let E=t?L(t):void 0;null===E&&(E=void 0);const S=new Set;s||S.add(E),a[f]={name:f,displayName:n,isKnown:d,metricName:o,isCustomMetric:i,source:null===t||void 0===t?void 0:t.source,dtype:g,uniqueValues:S,isOverall:f===b.OVERALL_ASSESSMENT,docsLink:v,missingTooltip:h,description:y,isEditable:"AI_JUDGE"===(null===t||void 0===t||null===(c=t.source)||void 0===c?void 0:c.sourceType)||"HUMAN"===(null===t||void 0===t||null===(m=t.source)||void 0===m?void 0:m.sourceType),isRetrievalAssessment:l.some((([e])=>e===f)),containsErrors:s}}else{const e=a[f];let o=t?L(t):void 0;var g,v;if((0,n.isNil)(o)&&(o=void 0),s||e.uniqueValues.add(o),!e.isEditable)e.isEditable="AI_JUDGE"===(null===t||void 0===t||null===(g=t.source)||void 0===g?void 0:g.sourceType)||"HUMAN"===(null===t||void 0===t||null===(v=t.source)||void 0===v?void 0:v.sourceType);e.isRetrievalAssessment=e.isRetrievalAssessment||l.some((([e])=>e===f)),e.containsErrors=e.containsErrors||s}}}));const l=(null===(o=a[b.OVERALL_ASSESSMENT])||void 0===o?void 0:o.uniqueValues)||new Set;return l.has(A.YES)||l.has(A.NO)||delete a[b.OVERALL_ASSESSMENT],ws(Object.values(a))}function ws(e){return e.sort(((e,t)=>{const s=S.indexOf(e.name),n=S.indexOf(t.name);return-1!==s&&-1!==n?s-n:-1!==s?-1:-1!==n?1:e.name.localeCompare(t.name)}))}function Ns(e,t){if("numeric"!==e.dtype)return;return function(e){if(0===e.length)return;const t=[],s=Math.min(...e),n=Math.max(...e),o=Math.max(.01,(n-s)/10);let a=0;if(s===n)t.push({lower:s,upper:n,count:e.length});else for(let r=s;r<n;r+=o)t.push({lower:r,upper:Math.min(r+o,n),count:0});t.sort(((e,t)=>e.lower-t.lower));for(const r of e){const e=t.find((e=>r>=e.lower&&(r<e.upper||r===e.upper&&r===n)));e&&(e.count++,a=Math.max(a,e.count))}return{min:s,max:n,maxCount:a,counts:t}}(t.flatMap((t=>{const s=e.isOverall?t.overallAssessments:t.responseAssessmentsByName[e.name];return null===s||void 0===s?void 0:s.map((e=>L(e))).filter((e=>void 0!==e&&"number"===typeof e))})).filter((e=>!(0,n.isNil)(e))))}function Ts(e,t){if("numeric"===e.dtype)return;const s=new Map;return t.forEach((t=>{const n=e.isOverall?t.overallAssessments:t.responseAssessmentsByName[e.name],o=n&&n.length>0?Os(e,n):[{value:void 0,count:1}],a=e.containsErrors?[bs,...e.uniqueValues]:e.uniqueValues;for(const e of a){const t=o.find((t=>t.value===e)),n=t?t.count:0;s.set(e,(s.get(e)||0)+n)}})),s}function Cs(e,t){if("numeric"!==e.dtype)return;const s=[];return t.forEach((t=>{const o=e.isOverall?(0,n.first)(t.overallAssessments):(0,n.first)(t.responseAssessmentsByName[e.name]);if(o){const e=L(o);(0,n.isNil)(e)||s.push(Number(e))}})),s}function _s(e,t){let s=0;return t.forEach((t=>{var o;if((0,n.isNil)(t))return;const a=(0,n.first)(t.overallAssessments);(null===a||void 0===a||null===(o=a.rootCauseAssessment)||void 0===o?void 0:o.assessmentName)===e.name&&s++})),s}function Rs(e,t,s){const o=t.map((e=>e.currentRunValue)).filter((e=>!(0,n.isNil)(e))),a=t.map((e=>e.otherRunValue)).filter((e=>!(0,n.isNil)(e))),r=Ts(e,o),i=Ts(e,a),l=Ns(e,o),d=s.filter((t=>t.assessmentName===e.name));return{assessmentInfo:e,currentCounts:r,otherCounts:i,currentNumericValues:Cs(e,o),otherNumericValues:Cs(e,a),currentNumericAggregate:l,currentNumRootCause:_s(e,o),otherNumRootCause:_s(e,a),assessmentFilters:d}}function Ys(e,t=new Map){if("pass-fail"===e.dtype||"boolean"===e.dtype){let s=0,o=0;for(const[a,r]of t)Gs(e,a)&&(o+=r),(0,n.isNil)(a)||a===bs||(s+=r);return s>0?o/s:0}return 0}function Ms(e,t,s,n,o,a,r){let i=0;const l=n===bs||void 0===n;for(const[c,m]of o)void 0!==c&&c!==bs&&(i+=m);const d=o.get(n)||0,u=!l&&i>0?d/i:0;return{value:o.get(n)||0,fraction:u,isSelected:s.some((e=>e.filterValue===n&&e.assessmentName===t.name&&e.run===a)),toggleFilter:()=>r(t.name,n,a,undefined),tooltip:l?e.formatMessage({id:"joh88n",defaultMessage:'{numValue} for run "{runName}"'},{numValue:d,runName:a}):e.formatMessage({id:"jjidVr",defaultMessage:'{numValue}/{numEvals} for run "{runName}"'},{numValue:d,numEvals:i,runName:a})}}function ks(e){const t=function(e){const t=Array.from(e.uniqueValues);if("pass-fail"===e.dtype){t.includes(A.YES)||t.push(A.YES),t.includes(A.NO)||t.push(A.NO);const e=[A.YES,A.NO];return t.sort(((t,s)=>e.indexOf(t)-e.indexOf(s)))}if("boolean"===e.dtype)return t.sort(((e,t)=>!0===e?-1:1));return t.sort()}(e);return e.containsErrors&&t.push(bs),t}function Ds(e,t,s,o){return"pass-fail"===s.dtype?o===A.YES?e.formatMessage({id:"nDVJ/n",defaultMessage:"Pass"}):o===A.NO?e.formatMessage({id:"7Dhfxy",defaultMessage:"Fail"}):o===bs?e.formatMessage({id:"gPWxlB",defaultMessage:"Error"}):e.formatMessage({id:"keSIQ4",defaultMessage:"null"}):"boolean"===s.dtype?!0===o?e.formatMessage({id:"1Ujhc3",defaultMessage:"True"}):!1===o?e.formatMessage({id:"nvjkTA",defaultMessage:"False"}):e.formatMessage({id:"keSIQ4",defaultMessage:"null"}):(0,n.isNil)(o)?"null":`${o}`}function Os(e,t){const s=t.filter((t=>t.name===e.name));let n=new Set;for(const i of s){const e=L(i);n.add(e)}s.sort(((e,t)=>(t.timestamp||0)-(e.timestamp||0)));const o=s.filter((e=>Ss(e))),a=s.filter((e=>!Ss(e)));n=new Set;for(const i of a){const e=L(i);n.add(e)}const r=[];for(const i of n){const e=s.filter((e=>L(e)===i)),t=e.length;r.push({value:i,count:t,latestAssessment:e[0]})}return o.length>0&&r.push({value:bs,count:o.length,latestAssessment:o[0]}),r}function Fs(e,t=1){return Number((100*e).toFixed(t)).toString()}function Ls(e,t=3){if((0,n.isNil)(e))return"null";const s=Math.pow(10,t);return(Math.round(e*s)/s).toString()}function Vs(e,t,s=!0){if("numeric"===e.dtype){return"up"===(t>0?"up":"down")?`+${Ls(t,2)}`:`-${Ls(t,2)}`}{const e=t>=0?"up":"down";return s?"up"===e?`+${Fs(t,0)}%`:`-${Fs(-1*t,0)}%`:"up"===e?`+${t}`:`-${t}`}}function Hs(e,t=new Date){const s=Math.max(0,Math.floor((t-e)/1e3));let n=Math.floor(s/31536e3);return n>=1?(0,y.Y)(f.sA,{id:"16BvfJ",defaultMessage:"{timeSince, plural, =1 {1 year} other {# years}} ago",values:{timeSince:n}}):(n=Math.floor(s/2592e3),n>=1?(0,y.Y)(f.sA,{id:"5ZAXeS",defaultMessage:"{timeSince, plural, =1 {1 month} other {# months}} ago",values:{timeSince:n}}):(n=Math.floor(s/86400),n>=1?(0,y.Y)(f.sA,{id:"tLb7+M",defaultMessage:"{timeSince, plural, =1 {1 day} other {# days}} ago",values:{timeSince:n}}):(n=Math.floor(s/3600),n>=1?(0,y.Y)(f.sA,{id:"aOW396",defaultMessage:"{timeSince, plural, =1 {1 hour} other {# hours}} ago",values:{timeSince:n}}):(n=Math.floor(s/60),n>=1?(0,y.Y)(f.sA,{id:"7jsqqe",defaultMessage:"{timeSince, plural, =1 {1 minute} other {# minutes}} ago",values:{timeSince:n}}):(0,y.Y)(f.sA,{id:"93iLUV",defaultMessage:"{timeSince, plural, =1 {1 second} other {# seconds}} ago",values:{timeSince:s}})))))}function Us(e){return e.replace(/([!"#$%&'()*+,\.\/:;\s<=>?@[\\\]^`{|}~])/g,"\\$1")}function Bs(e,t){return function(e,t,s=[],n){let o=Number(e);if(isNaN(o)||!isFinite(o))return{value:"",numericValue:void 0,unit:"",divisor:1};let a=0,r=1;for(;o>=t&&a<s.length-1;)o/=t,r*=t,a+=1;return{value:zs(o,n),numericValue:o,unit:s[a],divisor:r}}(e,1024,["bytes","KB","MB","GB","TB","PB"],t)}function zs(e,t=3){return Math.round(e)!==e?e.toFixed(t):e.toString()}const $s=re.createContext({makeHTML:e=>e}),js=({children:e,makeHtml:t})=>(0,y.Y)($s.Provider,{value:{makeHTML:t},children:e}),Ps=()=>re.useContext($s);const Gs=(e,t)=>{if(!(0,n.isNil)(t))if("pass-fail"===e.dtype){if(t===A.YES)return!0;if(t===A.NO)return!1}else if("boolean"===e.dtype)return!0===t};var Ks={name:"1jwcxx3",styles:"font-style:italic"},qs={name:"1jwcxx3",styles:"font-style:italic"};var Ws={name:"1066lcq",styles:"display:flex;justify-content:space-between;align-items:center"},Qs={name:"1ykowef",styles:"margin-bottom:0"},Js={name:"6jwybp",styles:"height:16px"},Xs={name:"dao2zk",styles:"display:contents;& p{margin-bottom:0;}"};const Zs=({assessment:e,onEdit:t,active:s=!1,disableJudgeTypeIcon:o,showRationaleInTooltip:a=!1,showPassFailText:r=!1,hideAssessmentName:i=!1,iconOnly:l=!1,disableTooltip:d=!1,isRootCauseAssessment:u,assessmentInfo:c,type:m,count:h})=>{var E,b;const{theme:S}=(0,v.u)(),x=(0,f.tz)(),I=e?L(e):void 0,w=(0,re.useMemo)((()=>Gs(c,I)),[I,c]),N=ne(S,c,e),T=((e,t,s)=>null!==s&&void 0!==s&&s.errorMessage?e.colors.textValidationWarning:"pass-fail"===t.dtype?(null===s||void 0===s?void 0:s.stringValue)===A.YES?e.isDarkMode?e.colors.green400:e.colors.green600:(null===s||void 0===s?void 0:s.stringValue)===A.NO?e.isDarkMode?e.colors.red400:e.colors.red600:e.colors.textSecondary:"boolean"===t.dtype?(0,n.isNil)(null===s||void 0===s?void 0:s.booleanValue)?e.colors.textSecondary:e.colors.textPrimary:"unknown"===t.dtype?e.colors.textSecondary:e.colors.textPrimary)(S,c,e);let R;(null!==e&&void 0!==e&&e.errorMessage||void 0===w&&e&&_[e.name])&&(R=e.errorMessage||x.formatMessage(_[e.name]));const M=e?C[e.name]:void 0,k=(0,re.useMemo)((()=>M?x.formatMessage(M):null===e||void 0===e?void 0:e.name),[e,M,x]),D=(0,re.useMemo)((()=>e?(e.name,"https://mlflow.org/docs/latest/genai/eval-monitor/scorers/llm-judge/"):void 0),[e]),{makeHTML:O}=Ps(),F=(0,re.useMemo)((()=>{const t=null===e||void 0===e?void 0:e.rationale;return(0,n.isString)(t)?O(t):void 0}),[e,O]),V=(0,re.useMemo)((()=>!(0,n.isNil)(e)&&P(e)),[e]),{tagText:H,icon:U,fullTagText:B}=(0,re.useMemo)((()=>function(e,t,s,o,a,r,i){let l,d="",u=(0,y.Y)(y.FK,{});const c={tagText:(0,y.Y)(f.sA,{id:"AX7L9r",defaultMessage:"Error"}),icon:(0,y.Y)(v.l,{css:(0,p.AH)({color:e.colors.textValidationWarning},"")})},m={tagText:(0,y.Y)("span",{css:Ks,children:(0,y.Y)(f.sA,{id:"H2UIIZ",defaultMessage:"null"})}),icon:(0,y.Y)(v.W,{css:(0,p.AH)({color:e.colors.grey400},"")})},h=r?L(r):void 0;if(Boolean(null===r||void 0===r?void 0:r.errorMessage))return c;if("pass-fail"===o.dtype||"boolean"===o.dtype){const a=Gs(o,h);let l="";if("pass-fail"===o.dtype)if(!0===a)l=t.formatMessage({id:"Kya8N3",defaultMessage:"Pass"});else{if(!1!==a)return m;l=t.formatMessage({id:"bz4brG",defaultMessage:"Fail"})}else if(!0===a)l=t.formatMessage({id:"lo5Me/",defaultMessage:"True"});else{if(!1!==a)return m;l=t.formatMessage({id:"OZXWas",defaultMessage:"False"})}const c=ne(e,o,r);if(u=!0===a?(0,y.Y)(g.CheckCircleIcon,{css:(0,p.AH)({color:c},"")}):!1===a?i?(0,y.Y)(ve.X,{css:(0,p.AH)({color:c},"")}):(0,y.Y)(g.XCircleIcon,{css:(0,p.AH)({color:c},"")}):(0,y.Y)(v.W,{css:(0,p.AH)({color:c},"")}),"assessment-value"===s){const e=Y[o.name];if(e){var E;const t=h&&null!==(E=e[h.toString()])&&void 0!==E?E:e[A.YES];t&&(d=(0,y.Y)(f.sA,{...t,values:{value:h}}))}else d=(0,y.FD)(y.FK,{children:[o.displayName,": ",h]})}else"value"===s&&(d=(0,n.isNil)(a)?(0,y.Y)("span",{css:qs,children:l}):l)}else if("numeric"===o.dtype){const e=(0,n.isNil)(h)?h:Ls(h);if("assessment-value"===s)d=(0,y.FD)(y.FK,{children:[o.displayName,": ",e]}),l=(0,y.FD)(y.FK,{children:[o.displayName,": ",h]});else{if((0,n.isNil)(e))return m;d=`${e}`,l=`${h}`}}else{if((0,n.isNil)(h))return m;const e=(0,y.Y)(y.FK,{children:String(h)});d="assessment-value"===s?(0,n.isNil)(h)?(0,y.Y)(y.FK,{children:o.displayName}):(0,y.FD)(y.FK,{children:[o.displayName,": ",e]}):e}return{tagText:d,icon:u,fullTagText:l}}(S,x,m,c,0,e,u)),[S,x,m,c,e,u,V]),z=(0,y.FD)(y.FK,{children:[H,h&&h>1?` (${h})`:""]});if("HUMAN"===(null===(E=c.source)||void 0===E?void 0:E.sourceType)&&!(null!==e&&void 0!==e&&null!==(b=e.source)&&void 0!==b&&b.sourceId))return(0,y.Y)(y.FK,{});const $=(0,y.Y)("div",{children:(0,y.Y)(en,{iconOnly:l,hideAssessmentName:i,tagContent:z,active:s,icon:U,iconColor:N,textColor:T,sourceIcon:c.isCustomMetric?(0,y.Y)(g.BracketsXIcon,{}):e&&V?(0,y.Y)(g.UserIcon,{}):(0,y.Y)(g.SparkleDoubleIcon,{}),backgroundColor:oe(S,c,e),disableSourceTypeIcon:o&&!V,hasBeenEditedByHuman:V,onEdit:t})});return(0,y.Y)(y.FK,{children:d?$:(0,y.Y)(g.HoverCard,{side:"bottom",content:(0,y.FD)("div",{css:(0,p.AH)({maxWidth:"25rem",display:"flex",flexDirection:"column",overflowWrap:"break-word",wordBreak:"break-word",gap:S.spacing.sm},""),children:[(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:S.spacing.xs},""),children:[(0,y.FD)("div",{css:Ws,children:[(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:S.spacing.sm,alignItems:"center"},""),children:[(0,y.Y)(v.T.Title,{css:Qs,children:k}),(0,y.Y)(en,{iconOnly:l,hideAssessmentName:i,tagContent:B||z,active:s,icon:U,iconColor:N,textColor:T,sourceIcon:c.isCustomMetric?(0,y.Y)(g.BracketsXIcon,{}):e&&P(e)?(0,y.Y)(g.UserIcon,{}):(0,y.Y)(g.SparkleDoubleIcon,{}),backgroundColor:oe(S,c,e),disableSourceTypeIcon:o,hasBeenEditedByHuman:V})]}),D&&(0,y.Y)("a",{href:D,target:"_blank",rel:"noreferrer",css:Js,children:(0,y.Y)(fe.I,{})})]}),u&&(0,y.Y)(v.T.Hint,{children:x.formatMessage({id:"QEL+JO",defaultMessage:"This assessment is the root cause of the overall evaluation failure."})})]}),a&&e&&F&&(0,y.Y)("div",{children:(0,y.Y)(y.FK,{children:(0,y.Y)("span",{css:Xs,dangerouslySetInnerHTML:{__html:F}})})}),R&&(0,y.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:S.spacing.xs},""),children:(0,y.Y)("span",{css:(0,p.AH)({color:S.colors.textValidationWarning,fontStyle:"italic"},""),children:R})})]}),trigger:$})})},en=({iconOnly:e,hideAssessmentName:t,tagContent:s,active:n,sourceIcon:o,icon:a,iconColor:r,textColor:i,backgroundColor:l,disableSourceTypeIcon:d,hasBeenEditedByHuman:u,onEdit:c})=>{const{theme:m}=(0,v.u)(),f=e?18:12;return(0,y.FD)("div",{css:(0,p.AH)({display:"inline-flex",height:e?f:20,width:e?f:t?"fit-content":"",justifyContent:"space-between",alignItems:"center",padding:e?"0":c?"0 0 0 8px":"0 8px",gap:m.spacing.sm,borderRadius:e?"50%":m.legacyBorders.borderRadiusMd,backgroundColor:l,boxShadow:`inset 0 0 1px 1px ${n?m.colors.borderAccessible:"transparent"}`,fontSize:m.typography.fontSizeSm,svg:{width:f,height:f},whiteSpace:"nowrap"},""),children:[a,s&&(0,y.Y)("span",{css:(0,p.AH)({color:i},""),children:s}),!0!==d?(0,y.Y)("span",{css:(0,p.AH)({color:r},""),children:o}):(0,y.Y)(y.FK,{}),c&&(0,y.Y)(v.B,{componentId:"mlflow.evaluations_review.edit_assessment_button",onClick:c,size:"small",icon:(0,y.Y)(g.PencilIcon,{css:(0,p.AH)({":hover":{color:m.colors.actionDefaultTextHover}},"")})})]})};var tn={name:"1wr4ndu",styles:"width:12px;height:12px;border-radius:6px;flex-shrink:0;border:1px solid rgba(0, 0, 0, 0.1);cursor:default;position:relative"},sn={name:"mvtt3w",styles:"clip:rect(0px, 0px, 0px, 0px);clip-path:inset(50%);height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px"};const nn=re.memo((({color:e,hidden:t})=>(0,y.Y)("label",{css:tn,style:{backgroundColor:e,display:t?"none":""},children:(0,y.Y)("span",{css:sn,children:e})})));var on={name:"6dhm9o",styles:"visibility:hidden"};const an=(e,t,s,o,a)=>{var r,i,l,d,u,c,m,v,f,h,E,b,S,x;const I=o.name,w={currentValue:(0,n.first)(null===(r=a.currentRunValue)||void 0===r?void 0:r.responseAssessmentsByName[I]),otherValue:(0,n.first)(null===(i=a.otherRunValue)||void 0===i?void 0:i.responseAssessmentsByName[I])},N=Os(o,(null===(l=a.currentRunValue)||void 0===l?void 0:l.responseAssessmentsByName[I])||[]),T=(null===(d=a.currentRunValue)||void 0===d||null===(u=d.overallAssessments[0])||void 0===u||null===(c=u.rootCauseAssessment)||void 0===c?void 0:c.assessmentName)===I,C=(null===(m=a.otherRunValue)||void 0===m||null===(v=m.overallAssessments[0])||void 0===v||null===(f=v.rootCauseAssessment)||void 0===f?void 0:f.assessmentName)===I,R=w.currentValue?L(w.currentValue):void 0,Y=w.otherValue?L(w.otherValue):void 0,M=function(e,t,s){if("pass-fail"===e.dtype)return t===s?"equal":t===A.YES?"greater":t===A.NO?"less":(0,n.isNil)(s)?"equal":"less";if("boolean"===e.dtype)return t===s?"equal":!0===t?"greater":!1===t?"less":(0,n.isNil)(s)?"equal":"less";if("string"===e.dtype){if(t===s)return"equal";if(null===t)return"less";if(null===s)return"greater";const e=t,o=s;return(0,n.isNil)(e)?"less":(0,n.isNil)(o)||1===e.toString().localeCompare(o.toString())?"greater":"less"}if("numeric"===e.dtype){if(t===s)return"equal";if(null===t)return"less";if(null===s)return"greater";return t>s?"greater":"less"}return"equal"}(o,(0,n.isNil)(R)?void 0:R,(0,n.isNil)(Y)?void 0:Y),k=Y!==R,D=_[I];return(0,y.Y)("div",{css:(0,p.AH)({display:"flex",gap:e.spacing.sm,alignItems:"center",marginTop:"auto",marginBottom:"auto"},""),children:s?(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm,borderRadius:e.legacyBorders.borderRadiusMd,marginTop:"auto",marginBottom:"auto"},""),children:[(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:e.spacing.sm,alignItems:"center"},""),children:[(0,y.Y)(Zs,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,assessment:w.currentValue,isRootCauseAssessment:T,assessmentInfo:o,type:"value"},`tag_${null===(h=a.currentRunValue)||void 0===h?void 0:h.evaluationId}_${null===(E=w.currentValue)||void 0===E?void 0:E.name}`),k&&(0,y.Y)(g.ArrowRightIcon,{css:(0,p.AH)({transform:"greater"===M?"rotate(-45deg)":"rotate(45deg)",color:e.colors.textSecondary},"")})]}),(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:e.spacing.sm,alignItems:"center"},""),children:[(0,y.Y)(Zs,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,assessment:w.otherValue,isRootCauseAssessment:C,assessmentInfo:o,type:"value"},`tag_${null===(b=a.otherRunValue)||void 0===b?void 0:b.evaluationId}_${null===(S=w.currentValue)||void 0===S?void 0:S.name}`),k&&(0,y.Y)(g.ArrowRightIcon,{css:on})]})]}):w.currentValue?(0,y.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm},""),children:N.map((e=>{const t=e.latestAssessment,s=e.count;return(0,y.Y)(Zs,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,assessment:t,isRootCauseAssessment:T,assessmentInfo:o,type:"value",count:s},`tag_${e.latestAssessment.name}_${e.value}`)}))}):(0,y.Y)(Zs,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,isRootCauseAssessment:T,assessmentInfo:o,assessment:{name:I,rationale:D?t.formatMessage(D):t.formatMessage({id:"gOUJ0f",defaultMessage:"No assessment for this evaluation"}),source:{sourceId:"",sourceType:"AI_JUDGE",metadata:{}},stringValue:null,booleanValue:null,rootCauseAssessment:null,numericValue:null,timestamp:null,metadata:{}},type:"value"},`tag_${I}_${null===(x=a.currentRunValue)||void 0===x?void 0:x.evaluationId}`)})};var rn={name:"36bnqj",styles:"display:flex;flex:1"},ln={name:"36bnqj",styles:"display:flex;flex:1"};var dn={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},un={name:"1jwcxx3",styles:"font-style:italic"},cn={name:"zjik7",styles:"display:flex"},mn={name:"1suksrg",styles:"width:12px;height:12px"},pn={name:"zjik7",styles:"display:flex"},gn={name:"1suksrg",styles:"width:12px;height:12px"};var vn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},fn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},hn={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},yn={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},En={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},bn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Sn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},An={name:"58t467",styles:"width:fit-content;max-width:100%"},xn={name:"hdknak",styles:"display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},In={name:"58t467",styles:"width:fit-content;max-width:100%"},wn={name:"4fjnre",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Nn={name:"58t467",styles:"width:fit-content;max-width:100%"},Tn={name:"4fjnre",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Cn={name:"58t467",styles:"width:fit-content;max-width:100%"},_n={name:"4fjnre",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Rn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Yn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Mn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},kn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Dn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},On={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const Fn=120,Ln=120;const Vn=e=>{let t=e;try{var s,o;const i=JSON.parse(e).response.choices;var a,r;if(Array.isArray(i)&&!(0,n.isNil)(null===(s=i[0])||void 0===s||null===(o=s.message)||void 0===o?void 0:o.content))t=null===(a=i[0])||void 0===a||null===(r=a.message)||void 0===r?void 0:r.content;else t=K(e)}catch{t=K(e)}return t},Hn=(e,{evaluationInputs:t,isComparing:s,theme:o,intl:a,experimentId:r,onChangeEvaluationId:i,onTraceTagsEdit:l})=>{const d={header:e.label,id:e.id,accessorFn:e=>e};switch(e.type){case xe.INPUT:return{...d,sortingFn:(t,s)=>{var n,o,a,r,i,l,d,u;const c=t.getValue(e.id),m=s.getValue(e.id),p={request:(null===(n=c.currentRunValue)||void 0===n?void 0:n.inputs[e.id])||(null===(o=c.otherRunValue)||void 0===o?void 0:o.inputs[e.id])||"",evalId:(null===(a=c.currentRunValue)||void 0===a?void 0:a.evaluationId)||(null===(r=c.otherRunValue)||void 0===r?void 0:r.evaluationId)||""},g={request:(null===(i=m.currentRunValue)||void 0===i?void 0:i.inputs[e.id])||(null===(l=m.otherRunValue)||void 0===l?void 0:l.inputs[e.id])||"",evalId:(null===(d=m.currentRunValue)||void 0===d?void 0:d.evaluationId)||(null===(u=m.otherRunValue)||void 0===u?void 0:u.evaluationId)||""};return JSON.stringify(p).localeCompare(JSON.stringify(g))},size:300/t.length,minSize:120,cell:t=>{var n;return((e,t,s,n,o,a)=>{var r,i,l,d,u,c,m,g;const f=t.getValue(),h=(null===(r=f.currentRunValue)||void 0===r?void 0:r.evaluationId)||(null===(i=f.otherRunValue)||void 0===i?void 0:i.evaluationId),E=null===(l=f.currentRunValue)||void 0===l||null===(d=l.traceInfo)||void 0===d||null===(u=d.trace_metadata)||void 0===u?void 0:u[Ke],b=null===(c=f.otherRunValue)||void 0===c||null===(m=c.traceInfo)||void 0===m||null===(g=m.trace_metadata)||void 0===g?void 0:g[Ke],S=a&&E?a(E):X,A=a&&b?a(b):Z,x=f.currentRunValue?D(f.currentRunValue,o):void 0,I=f.otherRunValue?D(f.otherRunValue,o):void 0,w=x||I;return(0,y.FD)("div",{css:(0,p.AH)({height:"100%",width:"100%",display:"flex",overflow:"hidden",alignItems:"center",justifyContent:"space-between",gap:n.spacing.sm},""),children:[(0,y.Y)(v.T.Link,{css:dn,componentId:"mlflow.evaluations_review.table_ui.evaluation_id_link",onClick:()=>e(h),children:w||(0,y.Y)("span",{css:un,children:"null"})}),s&&(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.md},""),children:[(0,y.Y)("div",{css:cn,children:E?(0,y.Y)(nn,{color:S}):(0,y.Y)("div",{css:mn})}),(0,y.Y)("div",{css:pn,children:b?(0,y.Y)(nn,{color:A}):(0,y.Y)("div",{css:gn})})]})]})})(i,t,s,o,e.id,null===(n=t.table.options.meta)||void 0===n?void 0:n.getRunColor)}};case xe.ASSESSMENT:return{...d,accessorFn:t=>({isComparing:s,assessmentInfo:e.assessmentInfo,comparisonEntry:t}),sortingFn:(t,s)=>{const{comparisonEntry:o}=t.getValue(e.id),{comparisonEntry:a}=s.getValue(e.id);if(e.assessmentInfo){var r,i,l,d,u,c,m,p;const t={currentValue:null===(r=o.currentRunValue)||void 0===r||null===(i=r.responseAssessmentsByName[e.assessmentInfo.name])||void 0===i?void 0:i[0],otherValue:null===(l=o.otherRunValue)||void 0===l||null===(d=l.responseAssessmentsByName[e.assessmentInfo.name])||void 0===d?void 0:d[0]},s={currentValue:null===(u=a.currentRunValue)||void 0===u||null===(c=u.responseAssessmentsByName[e.assessmentInfo.name])||void 0===c?void 0:c[0],otherValue:null===(m=a.otherRunValue)||void 0===m||null===(p=m.responseAssessmentsByName[e.assessmentInfo.name])||void 0===p?void 0:p[0]};return function(e,t,s){const o=t.currentValue?L(t.currentValue):void 0,a=s.currentValue?L(s.currentValue):void 0,r=t.otherValue?L(t.otherValue):void 0,i=s.otherValue?L(s.otherValue):void 0;if("pass-fail"===e.dtype){const e=r===A.YES&&o===A.NO,n=i===A.YES&&a===A.NO,l=r===A.NO&&o===A.YES,d=i===A.NO&&a===A.YES,u=r===A.NO&&o===A.NO,c=i===A.NO&&a===A.NO,m=r===A.YES&&o===A.YES,p=i===A.YES&&a===A.YES;return e&&!n?-1:!e&&n?1:u&&!c?-1:!u&&c?1:l&&!d?-1:!l&&d?1:m&&!p?-1:!m&&p?1:function(e,t){if(!e&&t)return 1;if(e&&!t)return-1;if(!e||!t)return 0;const s=e.stringValue===A.YES||e.stringValue!==A.NO&&void 0,n=t.stringValue===A.YES||t.stringValue!==A.NO&&void 0;if(s===n)return 0;if(void 0===s)return 1;if(void 0===n)return-1;return s?1:-1}(t.currentValue,s.currentValue)}return o===a?0:(0,n.isNil)(o)||(0,n.isNil)(a)?(0,n.isNil)(o)?-1:1:o>a?1:-1}(e.assessmentInfo,t,s)}return 0},maxSize:200,size:s?Ln:Fn,minSize:s?Ln:Fn,cell:e=>{const{isComparing:t,assessmentInfo:s,comparisonEntry:n}=e.getValue();return an(o,a,t,s,n)}};case xe.EXPECTATION:return{...d,accessorFn:t=>({isComparing:s,expectationName:e.expectationName,comparisonEntry:t}),maxSize:200,size:s?Ln:Fn,minSize:s?Ln:Fn,cell:e=>{const{isComparing:t,expectationName:s,comparisonEntry:n}=e.getValue();return((e,t,s,n,o)=>{var a,r,i,l;const d=null===(a=o.currentRunValue)||void 0===a||null===(r=a.targets)||void 0===r?void 0:r[n],u=null===(i=o.otherRunValue)||void 0===i||null===(l=i.targets)||void 0===l?void 0:l[n],c=d?(0,y.Y)(Se.ExpectationValuePreview,{parsedValue:d,singleLine:!0}):(0,y.Y)(_t,{isComparing:s}),m=u?(0,y.Y)(Se.ExpectationValuePreview,{parsedValue:u,singleLine:!0}):(0,y.Y)(_t,{isComparing:s});return s?(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm},""),children:[(0,y.Y)("div",{css:rn,children:c}),(0,y.Y)("div",{css:ln,children:m})]}):c})(o,0,t,s,n)}};case xe.TRACE_INFO:return{...d,accessorFn:e=>({isComparing:s,comparisonEntry:e}),sortingFn:(t,s)=>{var n,o;const{comparisonEntry:a}=t.getValue(e.id),{comparisonEntry:r}=s.getValue(e.id);return((e,t,s)=>{var n,o;if(!Be.includes(s))return 0;const a=String(null!==(n=bt(e,s))&&void 0!==n?n:""),r=String(null!==(o=bt(t,s))&&void 0!==o?o:"");return a.localeCompare(r,void 0,{numeric:!0})})(null===a||void 0===a||null===(n=a.currentRunValue)||void 0===n?void 0:n.traceInfo,null===r||void 0===r||null===(o=r.currentRunValue)||void 0===o?void 0:o.traceInfo,e.id)},size:e.id===Ce?300:100,minSize:e.id===Ce?120:100,cell:t=>{const{isComparing:s,comparisonEntry:n}=t.getValue();return((e,t,s,n,o,a,r)=>{var i,l;const d=null===(i=n.currentRunValue)||void 0===i?void 0:i.traceInfo,u=t?null===(l=n.otherRunValue)||void 0===l?void 0:l.traceInfo:void 0;if(s===Re){const e=null!==d&&void 0!==d&&d.request_time?new Date(d.request_time):void 0,s=null!==u&&void 0!==u&&u.request_time?new Date(u.request_time):void 0;return(0,y.Y)(Rt,{first:e?(0,y.Y)(fe.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-request-time",content:e.toLocaleString(navigator.language,{timeZoneName:"short"}),children:(0,y.Y)("span",{css:vn,children:Hs(e)})}):(0,y.Y)(_t,{isComparing:t}),second:t&&(s?(0,y.Y)(fe.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-other-request-time",content:s.toLocaleString(navigator.language,{timeZoneName:"short"}),children:(0,y.Y)("span",{css:fn,children:Hs(s)})}):(0,y.Y)(_t,{isComparing:t}))})}if(s===Me)return(0,y.Y)(Rt,{first:(0,y.Y)(Xt,{original:d,isComparing:t}),second:t&&(u?(0,y.Y)(Xt,{original:u,isComparing:t}):(0,y.Y)(_t,{isComparing:t}))});if(s===ke)return(0,y.Y)(Rt,{first:d?(0,y.Y)(Wt,{traceInfo:d,isComparing:t}):(0,y.Y)(_t,{isComparing:t}),second:t&&(u?(0,y.Y)(Wt,{traceInfo:u,isComparing:t}):(0,y.Y)(_t,{isComparing:t}))});if(s===De){const e=Object.entries((null===d||void 0===d?void 0:d.tags)||{}).map((([e,t])=>({key:e,value:t}))),s=Object.entries((null===u||void 0===u?void 0:u.tags)||{}).map((([e,t])=>({key:e,value:t}))),n=u?void 0:()=>null===r||void 0===r?void 0:r(d?et(d):{});return(0,y.Y)(Rt,{first:(0,y.Y)(ls,{baseComponentId:"tags-cell-renderer",tags:e,onAddEditTags:n}),second:t&&(u?(0,y.Y)(ls,{baseComponentId:"tags-cell-renderer-other",tags:s}):(0,y.Y)(_t,{isComparing:t}))})}if(s.startsWith(De)){var c,m;const e=s.split(":").pop();if(!e)return(0,y.Y)(_t,{isComparing:t});const n=null===d||void 0===d||null===(c=d.tags)||void 0===c?void 0:c[e],o=null===u||void 0===u||null===(m=u.tags)||void 0===m?void 0:m[e];return(0,y.Y)(Rt,{first:n?(0,y.Y)("span",{title:n,css:hn,children:n}):(0,y.Y)(_t,{isComparing:t}),second:t&&(o?(0,y.Y)("span",{title:n,css:yn,children:o}):(0,y.Y)(_t,{isComparing:t}))})}if(s===Oe){var f,h,E,b,S;const e=null===(f=n.currentRunValue)||void 0===f?void 0:f.evaluationId,s=null===d||void 0===d||null===(h=d.tags)||void 0===h?void 0:h["mlflow.traceName"],a=null===u||void 0===u||null===(E=u.tags)||void 0===E?void 0:E["mlflow.traceName"];return(0,y.Y)(Rt,{first:s?t?(0,y.Y)("div",{children:null===d||void 0===d||null===(S=d.tags)||void 0===S?void 0:S["mlflow.traceName"]}):(0,y.Y)(v.T.Link,{css:En,componentId:"mlflow.evaluations_review.table_ui.evaluation_id_link",onClick:()=>e&&o(e),children:null===d||void 0===d||null===(b=d.tags)||void 0===b?void 0:b["mlflow.traceName"]}):(0,y.Y)(_t,{isComparing:t}),second:t&&(a?(0,y.Y)("div",{children:a}):(0,y.Y)(_t,{isComparing:t}))})}if(s===Le){var A;const t=null===d||void 0===d||null===(A=d.trace_metadata)||void 0===A?void 0:A[Ke];return t?(0,y.Y)(jt,{experimentId:e,runUuid:t}):(0,y.Y)(_t,{})}if(s===Ne){var x,I,w,N;const e=(null===d||void 0===d||null===(x=d.trace_metadata)||void 0===x?void 0:x["mlflow.trace.user"])||(null===d||void 0===d||null===(I=d.tags)||void 0===I?void 0:I["mlflow.user"]),s=(null===u||void 0===u||null===(w=u.trace_metadata)||void 0===w?void 0:w["mlflow.trace.user"])||(null===u||void 0===u||null===(N=u.tags)||void 0===N?void 0:N["mlflow.user"]);return(0,y.Y)(Rt,{first:e?(0,y.FD)("span",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:a.spacing.xs},""),title:e,children:[(0,y.Y)(g.UserIcon,{css:(0,p.AH)({color:a.colors.textSecondary,fontSize:16},"")}),(0,y.Y)("span",{css:bn,children:e})]}):(0,y.Y)(_t,{isComparing:t}),second:t&&(s?(0,y.FD)("span",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:a.spacing.xs},""),title:s,children:[(0,y.Y)(g.UserIcon,{css:(0,p.AH)({color:a.colors.textSecondary,fontSize:16},"")}),(0,y.Y)("span",{css:Sn,children:s})]}):(0,y.Y)(_t,{isComparing:t}))})}if(s===_e){const e=null===d||void 0===d?void 0:d.trace_id,s=null===u||void 0===u?void 0:u.trace_id;return(0,y.Y)(Rt,{first:e?(0,y.Y)(g.Tag,{css:An,componentId:"mlflow.genai-traces-table.trace-id",color:"indigo",title:e,children:(0,y.Y)("span",{css:xn,children:e})}):(0,y.Y)(_t,{isComparing:t}),second:t&&(s?(0,y.Y)(g.Tag,{css:In,componentId:"mlflow.genai-traces-table.trace-id",color:"indigo",title:s,children:(0,y.Y)("span",{css:wn,children:s})}):(0,y.Y)(_t,{isComparing:t}))})}if(s===Te){var T,C;const e=null===d||void 0===d||null===(T=d.trace_metadata)||void 0===T?void 0:T["mlflow.trace.session"],s=null===u||void 0===u||null===(C=u.trace_metadata)||void 0===C?void 0:C["mlflow.trace.session"];return(0,y.Y)(Rt,{first:e?(0,y.Y)(g.Tag,{css:Nn,componentId:"mlflow.genai-traces-table.session",title:e,children:(0,y.Y)("span",{css:Tn,children:e})}):(0,y.Y)(_t,{isComparing:t}),second:t&&(s?(0,y.Y)(g.Tag,{css:Cn,componentId:"mlflow.genai-traces-table.session",title:s,children:(0,y.Y)("span",{css:_n,children:s})}):(0,y.Y)(_t,{isComparing:t}))})}if(s===Ce){const e=d?Vn(ot(d)):"",s=u?Vn(ot(u)):"";return(0,y.Y)(Rt,{first:e?(0,y.Y)("div",{css:Rn,title:e,children:e}):(0,y.Y)(_t,{isComparing:t}),second:t&&(s?(0,y.Y)("div",{css:Yn,title:s,children:s}):(0,y.Y)(_t,{isComparing:t}))})}if(s===Ve)return(0,y.Y)(Lt,{experimentId:e,currentTraceInfo:d,otherTraceInfo:u,isComparing:t});if(s===He)return(0,y.Y)(ds,{currentTraceInfo:d,otherTraceInfo:u,isComparing:t});if(s.startsWith(Ue)){var _,R;const e=Qe(s);if(!e)return(0,y.Y)(_t,{isComparing:t});const n=null===d||void 0===d||null===(_=d.trace_metadata)||void 0===_?void 0:_[e],o=null===u||void 0===u||null===(R=u.trace_metadata)||void 0===R?void 0:R[e];return(0,y.Y)(Rt,{first:n?(0,y.Y)("div",{css:Mn,title:n,children:n}):(0,y.Y)(_t,{isComparing:t}),second:t&&(o?(0,y.Y)("div",{css:kn,title:o,children:o}):(0,y.Y)(_t,{isComparing:t}))})}const Y=d?K(bt(d,s)):"",M=u?K(bt(u,s)):"";return(0,y.Y)(Rt,{first:Y?(0,y.Y)("div",{css:Dn,title:Y,children:Y}):(0,y.Y)(_t,{isComparing:t}),second:t&&(M?(0,y.Y)("div",{css:On,title:M,children:M}):(0,y.Y)(_t,{isComparing:t}))})})(r,s,e.id,n,i,o,l)}};case xe.INTERNAL_MONITOR_REQUEST_TIME:return{...d,accessorFn:e=>{var t;return null===(t=e.currentRunValue)||void 0===t?void 0:t.requestTime},sortingFn:(t,s)=>{const n=t.getValue(e.id),o=s.getValue(e.id);return JSON.stringify(n).localeCompare(JSON.stringify(o))},size:100,minSize:100,cell:e=>{const t=e.getValue();if(!t)return null;const s=new Date(t);return(0,y.Y)(fe.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-request-time",content:s.toLocaleString(navigator.language,{timeZoneName:"short"}),children:(0,y.Y)("span",{children:Hs(s)})})}};default:return d}};const Un=re.memo((({rows:e,isComparing:t,enableRowSelection:s,virtualItems:n,virtualizerTotalSize:o,virtualizerMeasureElement:a,selectedColumns:r})=>(0,y.Y)("div",{style:{height:`${o}px`,position:"relative",display:"grid"},children:n.map((n=>{const o=e[n.index],i=o.original.currentRunValue&&!t;return(0,y.Y)("div",{"data-index":n.index,ref:e=>a(e),style:{position:"absolute",transform:`translate3d(0, ${n.start}px, 0)`,willChange:"transform",width:"100%"},children:(0,y.Y)(zn,{row:o,exportableTrace:i,enableRowSelection:s,isSelected:s?o.getIsSelected():void 0,isComparing:t,selectedColumns:r})},n.key)}))}))),Bn=re.memo(Un),zn=re.memo((({row:e,exportableTrace:t,enableRowSelection:s,isComparing:n,isSelected:o,selectedColumns:a})=>{const r=e.getVisibleCells(),i=(0,f.tz)();return(0,y.Y)(y.FK,{children:(0,y.FD)(g.TableRow,{children:[s&&(0,y.Y)(fe.T,{componentId:"mlflow.experiment-evaluation-monitoring.evals-logs-table-cell-tooltip",content:n?i.formatMessage({id:"dqfOjO",defaultMessage:"You cannot select rows when comparing runs"}):t?null:i.formatMessage({id:"V0/LoE",defaultMessage:"This trace is not exportable because it either contains an error or the response is not a ChatCompletionResponse."}),children:(0,y.Y)(g.TableRowSelectCell,{componentId:"mlflow.experiment-evaluation-monitoring.evals-logs-table-cell",checked:o&&t,onChange:e.getToggleSelectedHandler(),isDisabled:n||!t})}),r.map((e=>(0,y.Y)($n,{cell:e},e.id)))]})})})),$n=re.memo((({cell:e})=>{const{theme:t}=(0,v.u)();return(0,y.Y)(g.TableCell,{style:{flex:`1 1 var(--col-${Us(e.column.id)}-size)`},css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"center","> span:first-of-type":{padding:`${t.spacing.xs}px 0px`,width:"100%"}},""),children:(0,xt.Kv)(e.column.columnDef.cell,e.getContext())},e.id)}));const jn=({overallAssessmentInfo:e,assessmentNameToAggregates:t,allAssessmentFilters:s,toggleAssessmentFilter:n,runUuid:o,compareToRunUuid:a})=>{const r=(0,f.tz)(),{theme:i}=(0,v.u)(),l=(0,re.useMemo)((()=>function(e,t,s,n,o,a,r){var i,l;if(Object.values(t).every((e=>0===e.currentNumRootCause&&0===(e.otherNumRootCause||0))))return[];const d=Object.values(t).filter((e=>e.currentNumRootCause>0||(e.otherNumRootCause||0)>0)).sort(((e,t)=>t.currentNumRootCause-e.currentNumRootCause)),u=Math.max((null===(i=d[0])||void 0===i?void 0:i.currentNumRootCause)||0,(null===(l=d[0])||void 0===l?void 0:l.otherNumRootCause)||0);return d.map((t=>{var i;const l=null===(i=Y[t.assessmentInfo.name])||void 0===i?void 0:i[A.NO],d=l?e.formatMessage(l):t.assessmentInfo.name,c=t.currentCounts,m=(null===c||void 0===c?void 0:c.get(A.YES))||0,p=(null===c||void 0===c?void 0:c.get(A.NO))||0,g=(null===c||void 0===c?void 0:c.get(void 0))||0,v=t.currentNumRootCause,f=m+p+g,h=t.otherCounts;let E;if(void 0!==t.otherCounts){E=((null===h||void 0===h?void 0:h.get(A.YES))||0)+((null===h||void 0===h?void 0:h.get(A.NO))||0)+((null===h||void 0===h?void 0:h.get(void 0))||0)}const b=t.otherNumRootCause||0,S=b/(E||1),x=Fs(v/f),I=Fs(S);return{assessment:t.assessmentInfo.name,title:d,currentInfo:{count:v,fraction:v/u,tooltip:e.formatMessage({id:"a6bpXQ",defaultMessage:'{numRootCause}/{numEvals} ({percentage}%) runs failed due to the {assessment} judge failing for the current run "{currentRun}".'},{numRootCause:v,numEvals:f,percentage:x,assessment:t.assessmentInfo.name,currentRun:a}),toggleFilter:()=>n(t.assessmentInfo.name,"failing_root_cause","current"),isSelected:s.some((e=>"rca"===e.filterType&&"current"===e.run&&e.assessmentName===t.assessmentInfo.name)),percentage:x},otherInfo:o?{count:b,fraction:b/u,tooltip:e.formatMessage({id:"iDqqcA",defaultMessage:'{numRootCause}/{numEvals} ({percentage}%) runs failed due to the {assessment} judge failing for run "{otherRunDisplayName}".'},{numRootCause:b,numEvals:E,percentage:I,assessment:t.assessmentInfo.name,otherRunDisplayName:r}),toggleFilter:()=>n(t.assessmentInfo.name,"rca","other"),isSelected:s.some((e=>"rca"===e.filterType&&"other"===e.run&&e.assessmentName===t.assessmentInfo.name)),percentage:I}:void 0,icon:(0,y.Y)(ve.X,{})}}))}(r,t,s,n,Boolean(a),o,a)),[r,t,s,n,a,o]);return 0===l.length?(0,y.Y)(y.FK,{}):(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:i.spacing.sm},""),children:[(0,y.Y)("div",{css:(0,p.AH)({fontWeight:i.typography.typographyBoldFontWeight},""),children:r.formatMessage({id:"etvfuH",defaultMessage:"Root Cause Analysis"})}),(0,y.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:i.spacing.sm},""),children:(0,y.Y)(Gn,{overallAssessmentInfo:e,rcaData:l,run:"current",runColor:a?X:void 0})}),a&&(0,y.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:i.spacing.xs},""),children:(0,y.Y)(Gn,{overallAssessmentInfo:e,rcaData:l,run:"other",runColor:Z})})]})};var Pn={name:"zjik7",styles:"display:flex"};const Gn=({rcaData:e,run:t,runColor:s,overallAssessmentInfo:n})=>{const{theme:o}=(0,v.u)();return(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",gap:o.spacing.sm,alignItems:"center"},""),children:[s&&(0,y.Y)("div",{css:Pn,children:(0,y.Y)(nn,{color:s})}),(0,y.Y)("div",{css:(0,p.AH)({display:"flex",flexWrap:"wrap",gap:o.spacing.xs},""),children:e.map(((e,s)=>{const a="current"===t?e.currentInfo:e.otherInfo;if(!a)return(0,y.Y)(y.FK,{});const r=oe(o,n,{stringValue:"no"});return(0,y.Y)(fe.T,{content:a.tooltip,componentId:"mlflow.evaluations_review.rca_pill",children:(0,y.Y)(y.FK,{children:(0,y.FD)("div",{style:{border:a.isSelected?`1px solid ${o.colors.grey400}`:""},css:(0,p.AH)({color:o.colors.textSecondary,borderRadius:o.general.borderRadiusBase,padding:`0 ${o.spacing.xs}px`,height:"20px",display:"flex",backgroundColor:a.isSelected?V(r,1):V(r,.5),gap:o.spacing.xs,fontSize:o.typography.fontSizeSm},""),children:[a.count,(0,y.Y)("div",{children:e.title.toLocaleLowerCase()})]},s)})},s)}))})]})};var Kn={name:"dao2zk",styles:"display:contents;& p{margin-bottom:0;}"};const qn=({assessmentInfo:e,assessmentNameToAggregates:t,allAssessmentFilters:s,toggleAssessmentFilter:n,runUuid:o,compareToRunUuid:a})=>{var i,l;const{theme:d}=(0,v.u)(),u=(0,f.tz)();return(0,y.Y)(y.FK,{children:(0,y.FD)("div",{css:(0,p.AH)({maxWidth:"25rem",display:"flex",flexDirection:"column",overflowWrap:"break-word",wordBreak:"break-word",gap:d.spacing.sm},""),children:[(0,y.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:d.spacing.xs},""),children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:d.spacing.xs,paddingBottom:d.spacing.sm,borderBottom:`1px solid ${d.colors.border}`},""),children:[(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:d.spacing.xs,alignItems:"center"},""),children:["numeric"===e.dtype?(0,y.Y)(g.NumbersIcon,{}):"boolean"===e.dtype?(0,y.Y)(g.BinaryIcon,{}):(0,y.Y)(y.FK,{}),(0,y.Y)(v.T.Title,{level:4,css:(0,p.AH)({marginBottom:0,marginRight:d.spacing.xs},""),children:e.displayName}),"AI_JUDGE"===(null===(i=e.source)||void 0===i?void 0:i.sourceType)&&(0,y.Y)(g.Tag,{color:"turquoise",componentId:"mlflow.experiment.evaluations.ai-judge-tag",children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:d.spacing.xs},""),children:[(0,y.Y)(g.SparkleDoubleIcon,{css:(0,p.AH)({color:d.colors.textSecondary},"")}),(0,y.Y)(v.T.Hint,{children:u.formatMessage({id:"ov1whU",defaultMessage:"AI Judge"})})]})}),"HUMAN"===(null===(l=e.source)||void 0===l?void 0:l.sourceType)&&(0,y.Y)(g.Tag,{color:"coral",componentId:"mlflow.experiment.evaluations.human-judge-tag",children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:d.spacing.xs},""),children:[(0,y.Y)(g.UserIcon,{}),(0,y.Y)(v.T.Hint,{children:u.formatMessage({id:"BdV0qk",defaultMessage:"Human judge"})})]})}),e.isCustomMetric&&(0,y.Y)(g.Tag,{color:"indigo",componentId:"mlflow.experiment.evaluations.ai-judge-tag",children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:d.spacing.xs},""),children:[(0,y.Y)(v.T.Hint,{children:(0,y.Y)(g.BracketsXIcon,{})}),(0,y.Y)(v.T.Hint,{children:e.metricName})]})})]}),(0,y.Y)("div",{children:(0,y.Y)(v.T.Hint,{children:e.name})})]})}),(0,y.Y)("div",{children:(0,y.Y)("span",{css:Kn,children:e.description})}),e.name===r.OVERALL_ASSESSMENT&&o?(0,y.Y)("div",{children:(0,y.Y)(jn,{overallAssessmentInfo:e,assessmentNameToAggregates:t,allAssessmentFilters:s,toggleAssessmentFilter:n,runUuid:o,compareToRunUuid:a})}):(0,y.Y)(y.FK,{})]})})};var Wn={name:"1yqwqbb",styles:"max-height:200px;overflow-y:auto;width:200px;min-width:200px"};const Qn=re.memo((({theme:e,intl:t,assessmentInfo:s,assessmentAggregates:n,allAssessmentFilters:o,toggleAssessmentFilter:a,currentRunDisplayName:r,compareToRunDisplayName:i})=>{const l=(0,re.useMemo)((()=>function(e,t,s,n,o,a,r,i){const l=void 0!==a.otherCounts,d=[];for(const u of ks(s)){const c=a.currentCounts?Ms(e,s,n,u,a.currentCounts,r||"monitor",o):void 0,m=l&&i?Ms(e,s,n,u,a.otherCounts||new Map,i,o):void 0,p=u===bs||void 0===u,g=l&&c&&m?p?c.value-((null===m||void 0===m?void 0:m.value)||0):c.fraction-((null===m||void 0===m?void 0:m.fraction)||0):void 0;c&&(!p||0!==c.value||g&&0!==g)&&d.push({name:Ds(e,0,s,u),current:c,other:m,backgroundColor:ae(t,s,u,u===bs),scoreChange:g})}return d}(t,e,s,o,a,n,r,i)),[t,e,s,o,a,n,r,i]),d=(0,re.useMemo)((()=>"pass-fail"===s.dtype||"boolean"===s.dtype?l:l.map(((e,t)=>({...e,originalIndex:t}))).sort(((e,t)=>{const s="null"===e.name||e.name===bs,n="null"===t.name||t.name===bs;if(s&&!n)return 1;if(n&&!s)return-1;if(!s&&!n){var o,a;const s=((null===(o=t.current)||void 0===o?void 0:o.value)||0)-((null===(a=e.current)||void 0===a?void 0:a.value)||0);if(0!==s)return s}return e.originalIndex-t.originalIndex}))),[l,s]),u=d.length>4?d.slice(0,3):d,c=d.length>4?d.slice(3):[],m=c.length>0,g=e.colors.actionDefaultBackgroundHover,f=e.colors.actionDefaultBackgroundPress;return(0,y.Y)("table",{children:(0,y.FD)("tbody",{children:[u.map((t=>(0,y.Y)(Zn,{barData:t,theme:e,hoverBarColor:g,selectedBarColor:f,assessmentInfo:s},t.name))),m&&(0,y.Y)("tr",{children:(0,y.Y)("td",{colSpan:2,children:(0,y.FD)(v.ax.Root,{componentId:"categorical-aggregate-chart-more-items",children:[(0,y.Y)(v.ax.Trigger,{asChild:!0,children:(0,y.Y)("div",{css:(0,p.AH)({cursor:"pointer",padding:`${e.spacing.xs}px`,color:e.colors.actionLinkDefault,fontSize:e.typography.fontSizeSm,fontWeight:"normal",":hover":{backgroundColor:g},borderRadius:e.general.borderRadiusBase},""),children:t.formatMessage({id:"WELl8J",defaultMessage:"+{count} more"},{count:c.length})})}),(0,y.Y)(v.ax.Content,{align:"start",side:"bottom",css:Wn,children:(0,y.Y)("table",{children:(0,y.Y)("tbody",{children:c.map((t=>(0,y.Y)(Zn,{barData:t,theme:e,hoverBarColor:g,selectedBarColor:f,assessmentInfo:s},t.name)))})})})]})})})]})})}));var Jn={name:"5m5bfc",styles:"display:flex;flex-direction:column;gap:2px;width:100%"},Xn={name:"12n4oo4",styles:"flex:1;width:100%;position:relative"};const Zn=({barData:e,theme:t,hoverBarColor:s,selectedBarColor:o,assessmentInfo:a})=>{const r=e.name===bs,i="null"===e.name;return r||i?(0,y.FD)("tr",{css:(0,p.AH)({cursor:e.name!==bs?"pointer":"not-allowed",":hover":{backgroundColor:s},color:e.name===bs?t.colors.textValidationWarning:t.colors.textSecondary,fontWeight:"normal",fontSize:t.typography.fontSizeSm},""),onClick:e.name!==bs?e.current.toggleFilter:void 0,children:[(0,y.Y)("td",{css:(0,p.AH)({width:"100%",borderTopLeftRadius:t.general.borderRadiusBase,borderBottomLeftRadius:t.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingLeft:t.spacing.xs,paddingTop:t.spacing.xs,paddingBottom:t.spacing.xs,fontStyle:e.name===bs?"normal":"italic"},""),children:(0,y.Y)("span",{css:(0,p.AH)({lineHeight:`${t.typography.fontSizeSm}px`},""),children:e.name})}),(0,y.Y)("td",{css:(0,p.AH)({textAlign:"right",verticalAlign:"center",borderTopRightRadius:t.general.borderRadiusBase,borderBottomRightRadius:t.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingRight:t.spacing.xs,paddingTop:t.spacing.xs,paddingBottom:t.spacing.xs,fontStyle:"normal"},""),children:(0,y.Y)("span",{css:(0,p.AH)({display:"inline-block",verticalAlign:"center",lineHeight:`${t.typography.fontSizeSm}px`},""),children:(0,n.isNil)(e.scoreChange)?e.current.value:Vs(a,e.scoreChange,!1)})})]},e.name):(0,y.FD)("tr",{css:(0,p.AH)({cursor:"pointer",":hover":{backgroundColor:s}},""),onClick:e.current.toggleFilter,children:[(0,y.Y)("td",{css:(0,p.AH)({width:"100%",borderTopLeftRadius:t.general.borderRadiusBase,borderBottomLeftRadius:t.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingLeft:t.spacing.xs,paddingTop:t.spacing.xs,paddingBottom:t.spacing.xs},""),children:(0,y.FD)("div",{css:Jn,children:[(0,y.Y)("span",{css:(0,p.AH)({fontWeight:"normal",fontSize:"10px",lineHeight:"10px",color:t.colors.textSecondary},""),children:e.name}),(0,y.Y)("div",{css:Xn,children:(0,y.Y)("div",{style:{width:e.current.value>0?100*e.current.fraction+"%":"2px",borderRadius:"2px"},css:(0,p.AH)({position:"relative",flexShrink:1,transition:"width 0.3s",backgroundColor:e.backgroundColor,height:"10px",display:"flex",alignItems:"center"},"")})})]})}),(0,y.Y)("td",{css:(0,p.AH)({textAlign:"right",verticalAlign:"bottom",borderTopRightRadius:t.general.borderRadiusBase,borderBottomRightRadius:t.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingRight:t.spacing.xs,paddingTop:t.spacing.xs,paddingBottom:t.spacing.xs},""),children:(0,y.Y)("span",{css:(0,p.AH)({color:t.colors.textSecondary,fontWeight:"normal",fontSize:t.typography.fontSizeSm,display:"inline-block",verticalAlign:"bottom",lineHeight:`${t.typography.fontSizeSm}px`},""),children:(0,n.isNil)(e.scoreChange)?(l=e.current.fraction,Fs(l,0)+"%"):Vs(a,e.scoreChange)})})]},e.name);var l};var eo={name:"1fttcpj",styles:"display:flex;flex-direction:column"},to={name:"1a4tfjy",styles:"display:flex;justify-content:center;flex-direction:row"},so={name:"1fttcpj",styles:"display:flex;flex-direction:column"},no={name:"ho1qnd",styles:"display:flex;flex-direction:row"},oo={name:"18ubt2d",styles:"width:25%"},ao={name:"ho1qnd",styles:"display:flex;flex-direction:row"},ro={name:"18ubt2d",styles:"width:25%"};const io=re.memo((({numericAggregate:e})=>{const{theme:t}=(0,v.u)(),s=(0,f.tz)();return(0,y.FD)("div",{css:eo,children:[(0,y.Y)("div",{css:to,children:e.counts.map(((n,o)=>(0,y.Y)(g.HoverCard,{content:(0,y.FD)("div",{css:so,children:[(0,y.FD)("div",{css:no,children:[(0,y.Y)("div",{css:oo,children:(0,y.Y)(v.T.Text,{children:s.formatMessage({id:"kAVQ2/",defaultMessage:"Range"})})}),(0,y.Y)("div",{children:(0,y.Y)(v.T.Text,{color:"secondary",children:Ls(n.lower,2)===Ls(n.upper,2)?Ls(n.lower,2):`${Ls(n.lower,2)} - ${Ls(n.upper,2)}`})})]}),(0,y.FD)("div",{css:ao,children:[(0,y.Y)("div",{css:ro,children:(0,y.Y)(v.T.Text,{children:s.formatMessage({id:"ClYb2e",defaultMessage:"Count"})})}),(0,y.Y)("div",{children:(0,y.Y)(v.T.Text,{color:"secondary",children:n.count})})]})]}),trigger:(0,y.Y)("div",{css:(0,p.AH)({display:"flex",flex:1,flexDirection:"column-reverse",height:"60px",width:"10px",":hover":{backgroundColor:t.colors.actionDefaultBackgroundHover}},""),children:(0,y.Y)("div",{css:(0,p.AH)({height:n.count/e.maxCount*100+"%",minHeight:"1px",width:"80%",verticalAlign:"bottom",backgroundColor:t.colors.blue400,borderTopRightRadius:t.general.borderRadiusBase,borderTopLeftRadius:t.general.borderRadiusBase},"")})},"bar-"+o)},"hover-card-"+o)))}),e.min===e.max?(0,y.Y)("div",{css:(0,p.AH)({display:"flex",justifyContent:"center",flexDirection:"row",fontWeight:"normal",fontSize:t.typography.fontSizeSm,color:t.colors.textSecondary},""),children:Ls(e.min,2)}):(0,y.FD)("div",{css:(0,p.AH)({display:"flex",justifyContent:"space-between",flexDirection:"row",fontWeight:"normal",fontSize:t.typography.fontSizeSm,color:t.colors.textSecondary},""),children:[(0,y.Y)("div",{children:Ls(e.min,2)}),(0,y.Y)("div",{children:Ls(e.max,2)})]})]})})),lo=re.memo((({theme:e,intl:t,assessmentInfo:s,assessmentAggregates:o,allAssessmentFilters:a,toggleAssessmentFilter:r,currentRunDisplayName:i,compareToRunDisplayName:l,collapsedHeader:d})=>{const u=(0,re.useMemo)((()=>"pass-fail"===s.dtype?t.formatMessage({id:"Yd5ANL",defaultMessage:"PASS"}):"boolean"===s.dtype?t.formatMessage({id:"icBP3T",defaultMessage:"TRUE"}):"string"===s.dtype?t.formatMessage({id:"Jdr//R",defaultMessage:"STRING"}):"numeric"===s.dtype?t.formatMessage({id:"wDFPtr",defaultMessage:"AVG"}):void 0),[s,t]),{displayScore:c,displayScoreChange:m,changeDirection:g}=(0,re.useMemo)((()=>function(e,t,s){if("numeric"===t.dtype){const e=s.currentNumericValues,t=s.otherNumericValues;let n=NaN,o=NaN;e&&(n=e.reduce(((e,t)=>e+t),0)/e.length),t&&(o=t.reduce(((e,t)=>e+t),0)/t.length);const a=t?n-o:void 0,r=a?a>0?"up":"down":"none";return{displayScore:Ls(n,2),displayScoreChange:a?"up"===r?`+${Ls(Math.abs(a),2)}`:"down"===r?`-${Ls(Math.abs(a),2)}`:"+0":void 0,changeDirection:r,aggregateType:"average"}}if("pass-fail"===t.dtype||"boolean"===t.dtype){const e=0,n=Ys(t,s.currentCounts),o=Fs(n,e)+"%",a=s.otherCounts?n-Ys(t,s.otherCounts):void 0,r=a?a>0?"up":"down":"none";return{displayScore:o,displayScoreChange:a?("up"===r||"none"===r?"+":"")+Fs(a,e)+"%":void 0,changeDirection:r,aggregateType:"percentage-true"}}if("string"===t.dtype){const s=t.uniqueValues.size;return{displayScore:1!==s?e.formatMessage({id:"+dbgRR",defaultMessage:"{numUniqueValues} values"},{numUniqueValues:s}):e.formatMessage({id:"lKyc9r",defaultMessage:"1 value"}),displayScoreChange:"",changeDirection:"none",aggregateType:"categorical"}}return{displayScore:"N/A",displayScoreChange:"N/A",changeDirection:"none",aggregateType:"categorical"}}(t,s,o)),[t,s,o]);return"unknown"===s.dtype?null:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm},""),children:[(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",paddingTop:e.spacing.xs},""),children:[(0,y.Y)("div",{css:(0,p.AH)({fontWeight:400,fontSize:"10px",color:e.colors.textPlaceholder},""),children:u}),(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:e.spacing.xs},""),children:[(0,y.Y)("div",{css:(0,p.AH)({fontSize:e.typography.fontSizeLg,color:e.colors.textPrimary,fontWeight:e.typography.typographyBoldFontWeight},""),children:c}),!(0,n.isNil)(m)&&l&&(0,y.Y)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",height:"20px",gap:e.spacing.xs,padding:`2px ${e.spacing.xs}px`,fontSize:e.typography.fontSizeMd,fontWeight:"normal",borderRadius:e.general.borderRadiusBase,color:"#64172B",backgroundColor:"none"===g?"":"up"===g?Q:"down"===g?J:V(e.colors.textSecondary,.1)},""),children:m})]})]}),!d&&((0,n.isNil)(o.currentNumericAggregate)?(0,y.Y)(Qn,{theme:e,intl:t,assessmentInfo:s,assessmentAggregates:o,allAssessmentFilters:a,toggleAssessmentFilter:r,currentRunDisplayName:i,compareToRunDisplayName:l}):(0,y.Y)(io,{numericAggregate:o.currentNumericAggregate}))]})}));var uo={name:"10sid5d",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;word-break:normal;overflow-wrap:normal"},co={name:"190se29",styles:"padding-top:0px !important;position:absolute;left:0;right:0;bottom:0;z-index:101;padding:0;pointer-events:none"},mo={name:"14n7h35",styles:"position:absolute;left:50%;top:100%;transform:translate(-50%, -50%);z-index:102;display:flex;align-items:center;justify-content:center;width:22px;height:22px;pointer-events:auto;cursor:pointer"};const po=re.memo((({enableRowSelection:e,enableGrouping:t,selectedAssessmentInfos:s,assessmentNameToAggregates:o,assessmentFilters:a,toggleAssessmentFilter:r,runDisplayName:i,compareToRunUuid:l,compareToRunDisplayName:d,disableAssessmentTooltips:u,collapsedHeader:c,setCollapsedHeader:m,isComparing:h,headerGroups:E,allRowSelected:b,someRowSelected:S,toggleAllRowsSelectedHandler:A,setColumnSizing:x})=>{const{theme:I}=(0,v.u)(),w=(0,f.tz)(),[N,T]=(0,re.useState)(!1),C=t?{position:"relative","&::before":{content:'""',position:"absolute",top:"32px",left:0,right:0,borderTop:`1px solid ${I.colors.border}`}}:{};return(0,y.Y)(y.FK,{children:E.map(((v,f)=>(0,y.FD)(g.TableRow,{isHeader:!0,css:(0,p.AH)({position:"sticky",top:40*f,zIndex:100,...t&&{"& > *":{borderBottom:0===f?"none":void 0}},...f===E.length-1&&{borderBottom:`1px solid ${N?I.colors.blue500:I.colors.border}`,transition:"border-color 0.2s","& > *":{borderBottom:"none"}}},""),children:[e&&(0,y.Y)("div",{css:0===s.length&&1===f?{}:C,children:(0,y.Y)(g.TableRowSelectCell,{componentId:"mlflow.experiment-evaluation-monitoring.evals-logs-table-header-select-cell",checked:b,indeterminate:S,onChange:A(),checkboxLabel:w.formatMessage({id:"bO1IlR",defaultMessage:"Select all"}),noCheckbox:0===f,isDisabled:h})}),v.headers.map((e=>{if(e.isPlaceholder)return null;const m=s.find((t=>je(t.name)===e.id)),v=e.isPlaceholder?null:(0,y.Y)("div",{css:uo,title:String((0,xt.Kv)(e.column.columnDef.header,e.getContext())),children:(0,xt.Kv)(e.column.columnDef.header,e.getContext())}),h=m&&!u?(0,y.Y)(g.HoverCard,{content:(0,y.Y)(y.FK,{children:(0,y.Y)(qn,{assessmentInfo:m,assessmentNameToAggregates:o,allAssessmentFilters:a,toggleAssessmentFilter:r,runUuid:i,compareToRunUuid:l?d:void 0})}),trigger:v},e.id):(0,n.isNil)(v)?null:v;return(0,y.Y)(g.TableHeader,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_evaluationsoverview.tsx_576",css:(0,p.AH)({"> span:first-of-type":{width:"100%",height:"100%",marginTop:"auto",marginBottom:"auto"},...0===s.length&&1===f?{}:C},""),style:{flex:`${e.colSpan} 1 var(--header-${Us(null===e||void 0===e?void 0:e.column.id)}-size)`},header:e,column:e.column,setColumnSizing:x,children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:I.spacing.xs},""),children:[h,(0,y.Y)("div",{css:(0,p.AH)({borderTop:!t&&s.length>0?`1px solid ${I.colors.border}`:"",width:"100%"},""),children:m&&(0,y.Y)(lo,{theme:I,intl:w,assessmentInfo:m,assessmentAggregates:o[m.name],allAssessmentFilters:a,toggleAssessmentFilter:r,currentRunDisplayName:i,compareToRunDisplayName:l?d:void 0,collapsedHeader:c})})]})},e.column.id)})),f===E.length-1&&(0,y.FD)("div",{css:co,children:[(0,y.Y)("div",{css:(0,p.AH)({position:"absolute",left:"50%",top:"100%",width:"24px",height:"12px",background:I.colors.backgroundPrimary,transform:"translate(-50%, -50%)",zIndex:101},"")}),(0,y.Y)("div",{css:mo,onClick:()=>m(!c),onMouseEnter:()=>T(!0),onMouseLeave:()=>T(!1),children:(0,y.Y)("div",{css:(0,p.AH)({width:"22px",height:"22px",borderRadius:"50%",background:I.colors.backgroundPrimary,border:`2px solid ${I.colors.border}`,boxShadow:"0 2px 8px 0 rgba(0,0,0,0.10)",display:"flex",alignItems:"center",justifyContent:"center",transition:"border-color 0.2s, box-shadow 0.2s",":hover":{borderColor:I.colors.blue500,boxShadow:"0 2px 12px 0 rgba(0,0,0,0.18)"},opacity:N?1:.5},""),children:(0,y.Y)(g.ChevronDownIcon,{css:(0,p.AH)({transform:c?"none":"rotate(180deg)",transition:"transform 0.2s, opacity 0.2s",color:I.colors.textSecondary},"")})})})]})]},v.id)))})})),go=e=>{const{theme:t}=(0,v.u)(),s=(0,f.tz)(),{groupId:n,visibleCount:o,totalCount:a,enableGrouping:r}=e.column.columnDef.meta;if(!r)return we[n];const i=we[n];return(0,y.FD)("div",{css:(0,p.AH)({height:"100%",width:"100%",display:"flex",overflow:"hidden",gap:t.spacing.sm},""),children:[(0,y.Y)("div",{children:i}),n===Ie.INFO?null:o===a?(0,y.FD)("div",{css:(0,p.AH)({color:t.colors.textSecondary,fontWeight:"normal"},""),children:["(",o,"/",a,")"]}):(0,y.Y)(g.HoverCard,{trigger:(0,y.FD)("div",{css:(0,p.AH)({color:t.colors.textSecondary,":hover":{textDecoration:"underline"},fontWeight:"normal"},""),children:["(",o,"/",a,")"]}),content:s.formatMessage({id:"pDCDkJ",defaultMessage:"Showing {visibleCount} out of {totalCount} {groupName}. Select columns to view more."},{visibleCount:o,totalCount:a,groupName:i}),align:"start"})]})};var vo={name:"49aokf",styles:"display:contents"};const fo=({history:e,alwaysExpanded:t=!1})=>{const{theme:s}=(0,v.u)(),o=(0,f.tz)(),[a,r]=(0,re.useState)(new Date);(0,re.useEffect)((()=>{const e=setInterval((()=>{r(new Date)}),5e3);return()=>{clearInterval(e)}}),[]);const i=(0,re.useMemo)((()=>e.reduce(((t,s,n)=>{const o=e[n+1];return o?[...t,[s,o]]:t}),[])),[e]),{makeHTML:l}=Ps(),d=(0,re.useMemo)((()=>{var t;const s=null===(t=(0,n.first)(e))||void 0===t?void 0:t.rationale;return(0,n.isString)(s)?l(s):null}),[e,l]);var u,c,m;if(!i.length)return null!==(u=(0,n.first)(e))&&void 0!==u&&u.rationale?(0,y.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm},""),children:(0,y.Y)("span",{css:vo,dangerouslySetInnerHTML:{__html:null!==d&&void 0!==d?d:""}})}):null!==(c=(0,n.first)(e))&&void 0!==c&&c.errorMessage?(0,y.Y)(y.FK,{children:(0,y.Y)(v.T.Text,{color:"error",children:null===(m=(0,n.first)(e))||void 0===m?void 0:m.errorMessage})}):(0,y.Y)(y.FK,{children:!t&&(0,y.FD)("div",{children:[(0,y.Y)(fe.S,{size:"sm"}),(0,y.Y)(v.T.Hint,{children:(0,y.Y)(f.sA,{id:"Jj2kRy",defaultMessage:"No details for assessment"})})]})});const g=e=>{const t=L(e),s=Y[e.name];if(s&&!(0,n.isNil)(t)){var o;const e=null!==(o=s[t.toString()])&&void 0!==o?o:s.default;if(e)return(0,y.Y)(f.sA,{...e,values:{value:t}})}return t};return(0,y.FD)(y.FK,{children:[(0,y.Y)(fe.S,{size:"sm"}),i.map((([e,n],r)=>{var i,l;const d=g(n),u=g(e),c=d===u,m=z(e)?o.formatMessage({id:"rmAWZX",defaultMessage:"just now"}):Hs(e.timestamp,a);return(0,y.FD)("div",{css:(0,p.AH)({marginBottom:t?void 0:s.spacing.md},""),children:[(0,y.FD)(v.T.Hint,{css:(0,p.AH)({marginBottom:s.spacing.xs},""),children:[d&&u&&(0,y.FD)(y.FK,{children:[(0,y.Y)("code",{children:g(n)})," \u2192 ",(0,y.Y)("code",{children:g(e)})," "]}),c?(0,y.Y)(f.sA,{id:"2/B9Zg",defaultMessage:"added {when} by {user}",values:{when:m,user:null===(i=e.source)||void 0===i?void 0:i.sourceId}}):(0,y.Y)(f.sA,{id:"4TDvGX",defaultMessage:"edited {when} by {user}",values:{when:m,user:null===(l=e.source)||void 0===l?void 0:l.sourceId}})]}),e.rationale&&(0,y.Y)(v.T.Text,{children:e.rationale})]},`${e.timestamp}-${r}`)}))]})},ho=({assessmentHistory:e,children:t,disable:s=!1})=>{const o=(0,f.tz)(),a=(0,re.useMemo)((()=>e.some(O)),[e]),[r,i]=(0,re.useState)(new Date);(0,re.useEffect)((()=>{const e=setInterval((()=>{i(new Date)}),5e3);return()=>{clearInterval(e)}}),[]);return(0,y.Y)(fe.T,{componentId:"web-shared.genai-traces-table.evaluations-review-assessment.tooltip",content:s?void 0:(0,y.Y)("span",{children:(()=>{const t=(0,n.first)(e);if(!t)return;if(P(t)){var s,i;const n=e[1],a=n?null===(s=L(n))||void 0===s?void 0:s.toString():void 0,u=z(t)?o.formatMessage({id:"rmAWZX",defaultMessage:"just now"}):Hs(t.timestamp,r);if(a){var l,d;const e=null===(l=Y[t.name])||void 0===l?void 0:l[a],s=e?o.formatMessage(e):a;return(0,y.Y)(f.sA,{id:"kHN/4I",defaultMessage:"Edited {timeSince} by {source}. Original value: {value}",values:{timeSince:u,source:null===t||void 0===t||null===(d=t.source)||void 0===d?void 0:d.sourceId,value:s}})}return(0,y.Y)(f.sA,{id:"m8ztHR",defaultMessage:"Edited {timeSince} by {source}.",values:{timeSince:u,source:null===t||void 0===t||null===(i=t.source)||void 0===i?void 0:i.sourceId}})}return a?(0,y.Y)(f.sA,{id:"4uE8hl",defaultMessage:"Overall assessment added by LLM-as-a-judge"}):null!==t&&void 0!==t&&t.errorMessage?null===t||void 0===t?void 0:t.errorMessage:(0,y.Y)(f.sA,{id:"gn1eO9",defaultMessage:"Assessment added by LLM-as-a-judge"})})()}),side:"top",children:t})},yo=({editedAssessment:e,valueSuggestions:t,onSave:s,onCancel:n,readOnly:o=!1})=>{var a;const{theme:r}=(0,v.u)(),i=(0,f.tz)(),[l,d]=(0,re.useState)((()=>(null===e||void 0===e?void 0:e.rationale)||void 0)),[u,c]=(0,re.useState)(""),[m,h]=(0,re.useState)((()=>{if(e){var s;const o=null===(s=L(e))||void 0===s?void 0:s.toString();var n;return o?null!==(n=t.find((e=>e.key===o)))&&void 0!==n?n:{key:o,label:o}:{key:e.name,label:e.name}}return{key:"",label:""}})),[E,b]=(0,re.useState)(!1),S=(0,re.useMemo)((()=>t.filter((e=>e.label.toLowerCase().includes(u.toLowerCase())))),[u,t]),A=E?t:S,x=u||A.length>0,I=(0,g.useComboboxState)({componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewassessmentupsertform.tsx_124",allItems:t,items:A,setItems:()=>{},setInputValue:e=>{b(!1),c(e)},multiSelect:!1,allowNewValue:!0,itemToString:e=>e?e.label:"",formValue:m,initialSelectedItem:m,initialInputValue:null!==(a=null===m||void 0===m?void 0:m.label)&&void 0!==a?a:"",formOnChange:e=>{(null===m||void 0===m?void 0:m.label)!==e&&h("string"!==typeof e?e:{key:null!==u&&void 0!==u?u:"",label:null!==u&&void 0!==u?u:""})},onIsOpenChange(e){e&&b(!0)}}),w=i.formatMessage({id:"bCdY2j",defaultMessage:'Add "{label}"'},{label:u});return(0,y.FD)("div",{children:[(0,y.FD)(g.TypeaheadComboboxRoot,{comboboxState:I,children:[(0,y.Y)(g.TypeaheadComboboxInput,{readOnly:o,css:(0,p.AH)({width:300,backgroundColor:r.colors.backgroundPrimary},""),placeholder:i.formatMessage({id:"nxzK82",defaultMessage:"Select or type an assessment"}),onKeyUp:e=>{-1===I.highlightedIndex&&"Enter"===e.key&&I.closeMenu()},comboboxState:I,formOnChange:e=>{h(e)}}),x&&(0,y.Y)(g.TypeaheadComboboxMenu,{comboboxState:I,emptyText:w,matchTriggerWidth:!0,children:A.map(((e,t)=>(0,y.Y)(g.TypeaheadComboboxMenuItem,{item:e,index:t,comboboxState:I,isDisabled:(null===e||void 0===e?void 0:e.disabled)||!1,children:e.label},`${e.key}-${t}`)))})]}),(0,y.Y)(fe.S,{size:"sm"}),(0,y.Y)("div",{css:(0,p.AH)({backgroundColor:r.colors.backgroundPrimary,borderRadius:r.general.borderRadiusBase},""),children:(0,y.Y)(ve.I.TextArea,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewassessmentupsertform.tsx_160",autoSize:!0,value:null!==l&&void 0!==l?l:"",onChange:e=>d(e.target.value),placeholder:i.formatMessage({id:"r/mP0/",defaultMessage:"Add rationale (optional)"})})}),(0,y.Y)(fe.S,{size:"sm"}),(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:r.spacing.xs},""),children:[(0,y.Y)(v.B,{size:"small",type:"primary",componentId:"mlflow.evaluations_review.confirm_edited_assessment_button",onClick:()=>{var t,n;if(!m)return;const o=null!==(t=null!==(n=m.rootAssessmentName)&&void 0!==n?n:null===e||void 0===e?void 0:e.name)&&void 0!==t?t:m.key,a=o===m.key||m.key;s({value:a,rationale:l,assessmentName:o})},disabled:!(null!==m&&void 0!==m&&m.key),children:(0,y.Y)(f.sA,{id:"/k6j6v",defaultMessage:"Confirm"})}),(0,y.Y)(v.B,{size:"small",type:"tertiary",componentId:"mlflow.evaluations_review.cancel_edited_assessment_button",onClick:n,children:(0,y.Y)(f.sA,{id:"5e1r3Y",defaultMessage:"Cancel"})})]})]})},Eo=(e,t)=>{const s=(0,f.tz)(),[n,o]=(0,re.useState)(void 0),[a,r]=(0,re.useState)(!1),[i,l]=(0,re.useState)([]),d=(0,re.useCallback)(((n,a)=>{o(a),r(n),l(((e,t,s,n)=>{if(t){const s=Y[t.name];return s?Object.entries(s).map((([s,n])=>({key:s,label:e.formatMessage(n),rootAssessmentName:t.name}))):[]}return(n||[]).filter((e=>"boolean"===e.dtype)).map((e=>({key:e.name,label:e.name,rootAssessmentName:e.name,disabled:null===s||void 0===s?void 0:s.some((t=>t.name===e.name))})))})(s,a,e,t))}),[s,t,e]),u=(0,re.useCallback)((e=>d(!0,e)),[d]);return{suggestions:i,editingAssessment:n,showUpsertForm:a,addAssessment:(0,re.useCallback)((()=>d(!0,void 0)),[d]),editAssessment:u,closeForm:(0,re.useCallback)((()=>{o(void 0),r(!1)}),[])}};var bo={name:"49aokf",styles:"display:contents"};const So=({assessmentsType:e,assessmentName:t,assessmentHistory:s,rootCauseAssessment:o,onUpsertAssessment:a,allowEditing:r=!1,options:i,inputs:l,assessmentInfo:d,assessmentInfos:u})=>{const{theme:c}=(0,v.u)(),m=(0,f.tz)(),h="overall"===e,{suggestions:E,editingAssessment:S,showUpsertForm:A,editAssessment:x,closeForm:I}=Eo(s,u);(0,re.useEffect)((()=>{I()}),[l,I]);const w=(0,n.first)(s),N=C[t],T=N?m.formatMessage(N):t,_=Boolean(w&&L(w)),R=Boolean(w&&z(w)),Y=r&&(_||R),{makeHTML:M}=Ps(),k=(0,re.useMemo)((()=>{var e;const t=null===w||void 0===w||null===(e=w.rootCauseAssessment)||void 0===e?void 0:e.suggestedActions;return(0,n.isString)(t)?M(t):null}),[w,M]);return(0,y.FD)("div",{css:(0,p.AH)({display:"block",marginBottom:h?void 0:c.spacing.md},""),children:[!A&&(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:c.spacing.sm},""),children:[t!==b.OVERALL_ASSESSMENT&&(0,y.Y)("div",{css:(0,p.AH)({display:"flex",gap:c.spacing.sm,alignItems:"center"},""),children:(0,y.Y)(Zs,{assessment:w,"aria-label":T,disableJudgeTypeIcon:q(w),onEdit:Y?()=>{const e=(0,n.first)(s);e&&x(e)}:void 0,assessmentInfo:d,type:"assessment-value"})}),(0,y.Y)(fo,{history:s,alwaysExpanded:h}),o&&(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:c.spacing.sm,marginTop:c.spacing.xs},""),children:[(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:c.spacing.sm,alignItems:"center"},""),children:[(0,y.Y)(g.BugIcon,{color:"danger"}),(0,y.Y)(v.T.Text,{bold:!0,children:(0,y.Y)(f.sA,{id:"M8pHqP",defaultMessage:"Root cause failure:"})}),(0,y.Y)(Zs,{assessment:o,isRootCauseAssessment:!0,"aria-label":T,assessmentInfo:d,type:"assessment-value"})]}),(0,y.Y)(fo,{history:[o],alwaysExpanded:h}),k&&(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:c.spacing.sm},""),children:[(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:c.spacing.sm,alignItems:"center"},""),children:[(0,y.Y)(g.AssistantIcon,{color:"ai"}),(0,y.Y)(v.T.Text,{bold:!0,children:(0,y.Y)(f.sA,{id:"vCUglz",defaultMessage:"Suggested actions"})})]}),(0,y.Y)("span",{css:bo,dangerouslySetInnerHTML:{__html:k}})]})]})]}),A&&(0,y.Y)(y.FK,{children:(0,y.Y)(yo,{editedAssessment:S,valueSuggestions:E,onCancel:I,onSave:({value:e,rationale:t,assessmentName:s})=>{var n;const o=h?b.OVERALL_ASSESSMENT:"",r=B({name:null!==(n=null!==s&&void 0!==s?s:null===S||void 0===S?void 0:S.name)&&void 0!==n?n:o,isOverallAssessment:h,value:e,rationale:t});a(r),I()}},null===S||void 0===S?void 0:S.name)})]},t)};var Ao={name:"eivff4",styles:"display:none"};const xo=({assessmentsType:e,assessmentsByName:t,rootCauseAssessment:s,onUpsertAssessment:n,allowEditing:o=!1,allowMoreThanOne:a=!1,options:r,inputs:i,assessmentInfos:l})=>{const{theme:d}=(0,v.u)(),u="overall"===e,c=t.filter((([e,t])=>t.length>0)),{suggestions:m,editingAssessment:h,showUpsertForm:E,addAssessment:S,closeForm:A}=Eo(c.flatMap((([e,t])=>t)),l);(0,re.useEffect)((()=>{A()}),[i,A]);const x=Object.keys(c).length>0,I=o&&(a||!x);return(0,y.FD)(y.FK,{children:[(0,y.FD)("div",{css:(0,p.AH)({display:"block",flexWrap:"wrap",gap:d.spacing.xs},""),children:[c.map((([t,a])=>{const d=l.find((e=>e.name===t));return d?(0,y.Y)(So,{assessmentsType:e,assessmentName:t,assessmentHistory:a,rootCauseAssessment:s,onUpsertAssessment:n,allowEditing:o,options:r,inputs:i,assessmentInfo:d,assessmentInfos:l},t):(0,y.Y)("div",{css:Ao},t)})),I&&(0,y.Y)(v.B,{componentId:`mlflow.evaluations_review.add_assessment_${e}_button`,onClick:S,icon:(0,y.Y)(g.PlusIcon,{}),size:"small",children:(0,y.Y)(f.sA,{id:"vgfy8y",defaultMessage:"Add assessment"})})]}),E&&(0,y.FD)(y.FK,{children:[(0,y.Y)(fe.S,{size:"sm"}),(0,y.Y)(yo,{valueSuggestions:m,onCancel:A,onSave:({value:e,rationale:t,assessmentName:s})=>{var o;const a=u?b.OVERALL_ASSESSMENT:s||"",r=B({name:null!==(o=null!==s&&void 0!==s?s:null===h||void 0===h?void 0:h.name)&&void 0!==o?o:a,isOverallAssessment:u,value:e,rationale:t});n(r),A()}})]})]})};var Io={name:"49aokf",styles:"display:contents"};const wo=({assessmentsType:e,assessmentsByName:t,onUpsertAssessment:s,allowEditing:o=!1,allowMoreThanOne:a=!1,options:r,inputs:i,assessmentInfos:l})=>{const{theme:d}=(0,v.u)(),u=(0,f.tz)(),c="overall"===e,{suggestions:m,editingAssessment:h,showUpsertForm:E,addAssessment:S,editAssessment:A,closeForm:x}=Eo(t.flatMap((([e,t])=>t)),l);(0,re.useEffect)((()=>{x()}),[i,x]);const I=t.filter((([e,t])=>t.length>0)),w=Object.keys(I).length>0,N=o&&(a||!w);return(0,y.FD)(y.FK,{children:[(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexWrap:"wrap",gap:d.spacing.xs,alignItems:"center"},""),children:[I.map((([e,t])=>{const s=(0,n.first)(t),a=l.find((t=>t.name===e));if(!a)return(0,y.Y)(y.FK,{});const r=C[e],i=r?u.formatMessage(r):e,d=Boolean(s&&L(s)),c=Boolean(s&&z(s)),m=o&&(d||c)&&a.isEditable;return(0,y.Y)("div",{css:Io,children:(0,y.Y)(ho,{assessmentHistory:t,children:(0,y.Y)(Zs,{assessment:s,"aria-label":i,active:(null===h||void 0===h?void 0:h.name)===e&&E,disableJudgeTypeIcon:q(s),onEdit:m?()=>{const e=(0,n.first)(t);e&&A(e)}:void 0,assessmentInfo:a,type:"assessment-value"})})},e)})),N&&(0,y.Y)(v.B,{componentId:`mlflow.evaluations_review.add_assessment_${e}_button`,onClick:S,icon:(0,y.Y)(g.PlusIcon,{}),size:"small",children:(0,y.Y)(f.sA,{id:"vgfy8y",defaultMessage:"Add assessment"})})]}),E&&(0,y.FD)(y.FK,{children:[(0,y.Y)(fe.S,{size:"sm"}),(0,y.Y)(yo,{editedAssessment:h,valueSuggestions:m,onCancel:x,onSave:({value:e,rationale:t,assessmentName:n})=>{var o;const a=c?b.OVERALL_ASSESSMENT:n||"",r=B({name:null!==(o=null!==n&&void 0!==n?n:null===h||void 0===h?void 0:h.name)&&void 0!==o?o:a,isOverallAssessment:c,value:e,rationale:t});s(r),x()}},null===h||void 0===h?void 0:h.name)]})]})},No=({assessmentsType:e,assessmentsByName:t,rootCauseAssessment:s,onUpsertAssessment:n,allowEditing:o=!1,allowMoreThanOne:a=!1,alwaysExpanded:r=!1,options:i,inputs:l,assessmentInfos:d})=>{const[u,c]=(0,re.useState)(!1),m=r||u,p=t.filter((([e,t])=>t.length>0));let h=t;"overall"!==e&&(h=t.filter((([e,t])=>e!==b.OVERALL_ASSESSMENT)));const E=Object.keys(p).length>0;return(0,y.FD)(y.FK,{children:[m&&(0,y.Y)(xo,{assessmentsType:e,assessmentsByName:h,rootCauseAssessment:s,onUpsertAssessment:n,allowEditing:o,allowMoreThanOne:a,options:i,inputs:l,assessmentInfos:d}),!m&&(0,y.Y)(wo,{assessmentsType:e,assessmentsByName:h,onUpsertAssessment:n,allowEditing:o,allowMoreThanOne:a,options:i,inputs:l,assessmentInfos:d}),E&&!r&&(0,y.FD)(y.FK,{children:[(0,y.Y)(fe.S,{size:"sm"}),(0,y.Y)(v.B,{size:"small",type:"tertiary",componentId:`mlflow.evaluations_review.see_assessment_details_${e}_button`,icon:m?(0,y.Y)(g.ChevronUpIcon,{}):(0,y.Y)(v.q,{}),onClick:()=>c((e=>!e)),children:m?(0,y.Y)(f.sA,{id:"G7V4y3",defaultMessage:"Hide details"}):(0,y.Y)(f.sA,{id:"pfyUes",defaultMessage:"See details"})})]})]})},To=({toBeReviewed:e,containsOverallAssessment:t,isNextResultAvailable:s,overridingExistingReview:n,hasPendingAssessments:o,onClickNext:a,onSave:r,onCancelOverride:i})=>e?o?(0,y.Y)(v.B,{type:"primary",componentId:"mlflow.evaluations_review.save_pending_assessments_button",onClick:r,children:(0,y.Y)(f.sA,{id:"m1Nb7W",defaultMessage:"Save"})}):n?(0,y.Y)(v.B,{componentId:"mlflow.evaluations_review.cancel_override_assessments_button",onClick:i,children:(0,y.Y)(f.sA,{id:"e9qVjz",defaultMessage:"Cancel"})}):(0,y.Y)(v.B,{type:"primary",componentId:"mlflow.evaluations_review.mark_as_reviewed_button",onClick:r,disabled:!t,children:(0,y.Y)(f.sA,{id:"Ls2ris",defaultMessage:"Mark as reviewed"})}):(0,y.Y)(v.B,{type:"primary",componentId:"mlflow.evaluations_review.next_evaluation_result_button",onClick:a,endIcon:(0,y.Y)(v.q,{}),disabled:!s,children:(0,y.Y)(f.sA,{id:"CBnbqy",defaultMessage:"Next"})}),Co=()=>{const{theme:e}=(0,v.u)();return(0,y.Y)("div",{css:(0,p.AH)({width:"1.5px",backgroundColor:e.colors.border},"")})};var _o={name:"1d3w5wq",styles:"width:100%"},Ro={name:"82a6rk",styles:"flex:1"};const Yo=({evaluationResult:e,onUpsertAssessment:t,onSavePendingAssessments:s,onClickNext:o,onResetPendingAssessments:a,isNextAvailable:r,overridingExistingReview:i=!1,pendingAssessments:l=[],setOverridingExistingReview:d,isReadOnly:u=!1,assessmentInfos:c})=>{var m;const{theme:h}=(0,v.u)(),E=(0,f.tz)();if(!e)return null;const S=(0,n.first)(e.overallAssessments),A=null===S||void 0===S||null===(m=S.rootCauseAssessment)||void 0===m?void 0:m.assessmentName,x=A?(0,n.first)(null===e||void 0===e?void 0:e.responseAssessmentsByName[A]):void 0,I=!u&&(!j(e)||i),w=E.formatMessage({id:"d44IPd",defaultMessage:"Reopen review"}),N=[[b.OVERALL_ASSESSMENT,e.overallAssessments]],T=c.find((e=>e.name===b.OVERALL_ASSESSMENT));return(0,y.FD)("div",{css:_o,children:[(0,y.FD)("div",{css:(0,p.AH)({width:"100%",paddingLeft:h.spacing.md,paddingRight:h.spacing.md},""),children:[(0,y.FD)("div",{css:(0,p.AH)({backgroundColor:h.colors.backgroundSecondary,padding:h.spacing.md,paddingBottom:0,display:"flex",flexDirection:"column",gap:h.spacing.sm},""),children:[T&&(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:h.spacing.sm,alignItems:"center"},""),children:[(0,y.Y)(g.SparkleDoubleIcon,{color:"ai"}),(0,y.Y)(v.T.Text,{bold:!0,children:(0,y.Y)(f.sA,{id:"ML+mQa",defaultMessage:"Overall assessment:"})}),(0,y.Y)(Zs,{assessment:S,"aria-label":b.OVERALL_ASSESSMENT,disableJudgeTypeIcon:q(S),assessmentInfo:T,type:"assessment-value"})]}),(0,y.Y)(No,{assessmentsType:"overall",assessmentsByName:N,rootCauseAssessment:x,onUpsertAssessment:t,allowEditing:I,alwaysExpanded:!0,options:[b.OVERALL_ASSESSMENT],assessmentInfos:c}),(0,y.FD)("div",{css:(0,p.AH)({border:`1px solid ${h.colors.border}`,borderRadius:h.general.borderRadiusBase,padding:h.spacing.sm},""),children:[(0,y.Y)(v.T.Text,{bold:!0,children:(0,y.Y)(f.sA,{id:"5jXYY4",defaultMessage:"Detailed assessments"})}),(0,y.Y)(fe.S,{size:"sm"}),(0,y.Y)(No,{assessmentsType:"response",assessmentsByName:$(e.responseAssessmentsByName),onUpsertAssessment:t,allowEditing:I,allowMoreThanOne:!0,options:H,assessmentInfos:c})]})]}),(0,y.FD)("div",{css:(0,p.AH)({position:"sticky",backgroundColor:h.colors.backgroundSecondary,padding:h.spacing.md,top:0,display:"flex",justifyContent:"space-between",gap:h.spacing.sm,zIndex:h.options.zIndexBase},""),children:[(0,y.Y)("div",{children:!I&&!u&&(0,y.FD)("div",{css:(0,p.AH)({border:`1px solid ${h.colors.border}`,borderRadius:h.general.borderRadiusBase,display:"flex",alignItems:"center",gap:h.spacing.sm,padding:`${h.spacing.xs}px ${h.spacing.sm}px`},""),children:[(0,y.Y)(g.CheckCircleIcon,{css:(0,p.AH)({color:h.colors.textValidationSuccess},"")}),(0,y.Y)(v.T.Hint,{children:(0,y.Y)(f.sA,{id:"zLTdCZ",defaultMessage:"Reviewed"})}),(0,y.Y)(fe.T,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewassessmentssection.tsx_149",content:w,children:(0,y.Y)(v.B,{"aria-label":w,componentId:"mlflow.evaluations_review.reopen_review_button",size:"small",icon:(0,y.Y)(g.PencilIcon,{}),onClick:()=>d(!0)})})]})}),(0,y.Y)("div",{css:Ro}),l.length>0&&(0,y.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:h.spacing.sm},""),children:[(0,y.Y)(f.sA,{id:"MB3kda",defaultMessage:"{pendingCount} pending {pendingCount, plural, =1 {change} other {changes}}",values:{pendingCount:l.length}}),(0,y.Y)(v.B,{componentId:"mlflow.evaluations_review.discard_pending_assessments_button",onClick:a,children:(0,y.Y)(f.sA,{id:"eIWfRN",defaultMessage:"Discard"})})]}),(0,y.Y)(To,{onSave:async()=>{await s(),d(!1)},containsOverallAssessment:Boolean(S),isNextResultAvailable:Boolean(r),onClickNext:o,toBeReviewed:I,hasPendingAssessments:l.length>0,overridingExistingReview:i,onCancelOverride:()=>d(!1)})]})]}),(0,y.Y)(fe.S,{size:"md"})]})},Mo=({evaluationResult:e,otherEvaluationResult:t,onUpsertAssessment:s,onSavePendingAssessments:n,onClickNext:o,onResetPendingAssessments:a,isNextAvailable:r,overridingExistingReview:i=!1,pendingAssessments:l=[],setOverridingExistingReview:d,isReadOnly:u=!1,assessmentInfos:c})=>{const{theme:m}=(0,v.u)();return(0,y.FD)("div",{css:(0,p.AH)({display:"flex",width:"100%",gap:m.spacing.sm},""),children:[e&&(0,y.Y)(Yo,{evaluationResult:e,onUpsertAssessment:s,onSavePendingAssessments:n,onClickNext:o,onResetPendingAssessments:a,isNextAvailable:r,overridingExistingReview:i,setOverridingExistingReview:d,pendingAssessments:l,isReadOnly:u,assessmentInfos:c}),t&&(0,y.FD)(y.FK,{children:[(0,y.Y)(Co,{}),(0,y.Y)(Yo,{evaluationResult:t,onUpsertAssessment:s,onSavePendingAssessments:n,onClickNext:o,onResetPendingAssessments:a,isNextAvailable:r,overridingExistingReview:i,setOverridingExistingReview:d,pendingAssessments:l,isReadOnly:!0,assessmentInfos:c})]})]})},ko=({requestId:e,onClose:t,trace:s})=>{const{theme:o}=(0,v.u)(),a=(0,y.Y)(v.T.Title,{level:2,withoutMargins:!0,children:e});return(0,y.Y)(g.Drawer.Root,{modal:!0,open:!0,onOpenChange:e=>{e||t()},children:(0,y.Y)(g.Drawer.Content,{componentId:"mlflow.evaluations_review.trace_data_drawer",width:"85vw",title:a,expandContentToFullHeight:!0,children:(()=>{const e=s.data.spans.length>0;return(0,n.isNil)(s)||!e?(0,y.FD)(y.FK,{children:[(0,y.Y)(fe.S,{size:"lg"}),(0,y.Y)(g.Empty,{description:null,title:(0,y.Y)(f.sA,{id:"EpFST9",defaultMessage:"No trace data recorded"})})]}):(0,y.Y)("div",{css:(0,p.AH)({height:"100%",marginLeft:-o.spacing.lg,marginRight:-o.spacing.lg,marginBottom:-o.spacing.lg},""),onWheel:e=>e.stopPropagation(),children:(0,y.Y)(Se.ModelTraceExplorer,{modelTrace:s})})})()})})};var Do={name:"1d3w5wq",styles:"width:100%"};const Oo=({experimentId:e,runDisplayName:t,evaluationResult:s,exportToEvalsInstanceEnabled:o=!1,traceQueryResult:a,getTrace:r})=>{var i,l;const d=(0,f.tz)(),{theme:u}=(0,v.u)(),[c,m]=(0,re.useState)(null),g=null===(i=s.traceInfo)||void 0===i||null===(l=i.trace_metadata)||void 0===l?void 0:l["databricks.tracingserver.dropped_spans_size_bytes"];let h;if(!(0,n.isNil)(g)){const e=2,t=Bs(Number(g),e);h=`${t.value} ${t.unit}`}return(0,y.FD)("div",{css:Do,children:[(0,y.FD)("div",{css:(0,p.AH)({width:"100%",paddingLeft:u.spacing.md,paddingRight:u.spacing.md,display:"flex",alignItems:"center",justifyContent:"space-between",gap:u.spacing.sm},""),children:[(0,y.Y)(v.T.Title,{level:4,children:t}),s.requestId&&(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:u.spacing.sm},""),children:[o&&r&&(0,y.Y)(ut,{experimentId:e,selectedTraces:[s],traceActions:{exportToEvals:{getTrace:r}},traceInfos:void 0}),(0,y.Y)(fe.T,{delayDuration:0,componentId:"mlflow.evaluations_review.see_detailed_trace_view_tooltip",content:g?`The trace spans were not stored due to their large size: ${h}`:void 0,side:"left",children:(0,y.Y)(v.B,{componentId:"mlflow.evaluations_review.see_detailed_trace_view_button",onClick:()=>m(s.requestId),loading:a.isLoading,disabled:!(0,n.isNil)(g),children:(0,y.Y)(f.sA,{id:"HUC492",defaultMessage:"See detailed trace view"})})})]}),c&&((0,n.isNil)(a.data)?(0,y.Y)(y.FK,{children:d.formatMessage({id:"EZfSbs",defaultMessage:"No trace data available"})}):(0,y.Y)(ko,{onClose:()=>{m(null)},requestId:c,trace:a.data}))]}),(0,y.Y)(fe.S,{size:"md"})]})},Fo=({experimentId:e,runDisplayName:t,otherRunDisplayName:s,evaluationResult:n,otherEvaluationResult:o,exportToEvalsInstanceEnabled:a=!1,traceQueryResult:r,compareToTraceQueryResult:i})=>{const{theme:l}=(0,v.u)();return(0,y.FD)("div",{css:(0,p.AH)({display:"flex",width:"100%",gap:l.spacing.sm},""),children:[(0,y.Y)(Oo,{experimentId:e,runDisplayName:t,evaluationResult:n,exportToEvalsInstanceEnabled:a,traceQueryResult:r}),s&&o&&(0,y.FD)(y.FK,{children:[(0,y.Y)(Co,{}),(0,y.Y)(Oo,{experimentId:e,runDisplayName:s,evaluationResult:o,exportToEvalsInstanceEnabled:a,traceQueryResult:i})]})]})};var Lo={name:"1739oy8",styles:"z-index:1"};const Vo=({copyText:e,showLabel:t=!0,componentId:s,...n})=>{const[o,a]=(0,re.useState)(!1);return(0,y.Y)(g.LegacyTooltip,{title:(0,y.Y)(f.sA,{id:"X+boXI",defaultMessage:"Copied"}),dangerouslySetAntdProps:{visible:o},children:(0,y.Y)(v.B,{componentId:null!==s&&void 0!==s?s:"mlflow.shared.copy_button",type:"primary",onClick:()=>{navigator.clipboard.writeText(e),a(!0),setTimeout((()=>{a(!1)}),3e3)},onMouseLeave:()=>{a(!1)},css:Lo,children:t?(0,y.Y)(f.sA,{id:"1Iq+NW",defaultMessage:"Copy"}):void 0,...n})})},Ho=({value:e})=>{const t=(0,re.useMemo)((()=>{if("object"===typeof e&&null!==e)return JSON.stringify(e,null,2);if("string"===typeof e)try{const t=JSON.parse(e);return JSON.stringify(t,null,2)}catch(t){return null}return null}),[e]);return(0,y.Y)("div",{css:(0,p.AH)({whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:t?"monospace":void 0},""),children:t||String(e)})};var Uo={name:"1066lcq",styles:"display:flex;justify-content:space-between;align-items:center"},Bo={name:"1nko30q",styles:"margin-bottom:0 !important"},zo={name:"49aokf",styles:"display:contents"};const $o=({fieldName:e,title:t,value:s,showCopyIcon:o})=>{const{theme:a}=(0,v.u)(),{makeHTML:r}=Ps(),i=(0,re.useMemo)((()=>(0,n.isString)(s)?r(s):null),[s,r]),l=(0,re.useMemo)((()=>(0,n.isString)(s)?null:K(s)),[s]);return(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:a.spacing.sm,flex:1,border:`1px solid ${a.colors.border}`,padding:a.spacing.md,borderRadius:a.general.borderRadiusBase,marginBottom:a.spacing.md},""),children:[(0,y.FD)("div",{css:Uo,children:[(0,y.Y)(v.T.Text,{bold:!0,children:t}),o&&(0,y.Y)(Vo,{copyText:K(s),showLabel:!1,type:"tertiary",icon:(0,y.Y)(g.CopyIcon,{})})]}),(0,y.Y)(v.T.Paragraph,{css:Bo,children:(0,n.isString)(s)?(0,y.Y)("span",{css:zo,dangerouslySetInnerHTML:{__html:null!==i&&void 0!==i?i:""}}):e===N&&Array.isArray(s)?(0,y.Y)("ul",{children:s.map(((e,t)=>(0,y.Y)("li",{children:(0,y.Y)(Ho,{value:e},t)},t)))}):(0,y.Y)(Ho,{value:l})})]})},jo=({evaluationResult:e})=>{const{theme:t}=(0,v.u)(),{inputs:s}=e,n=Object.entries(s),o=0===n.length;return(0,y.FD)("div",{css:(0,p.AH)({width:"100%",paddingLeft:t.spacing.md,paddingRight:t.spacing.md},""),children:[(0,y.Y)(v.T.Text,{bold:!0,children:(0,y.Y)(f.sA,{id:"MQ4Voz",defaultMessage:"{count, plural, one {Input} other {Inputs}}",values:{count:n.length}})}),(0,y.Y)(fe.S,{size:"sm"}),o&&(0,y.Y)(v.T.Paragraph,{children:(0,y.Y)(f.sA,{id:"gPhm1b",defaultMessage:"No inputs logged"})}),n.map((([e,t])=>(0,y.Y)($o,{fieldName:e,title:e,value:t},e)))]})},Po=({evaluationResult:e,otherEvaluationResult:t})=>{const{theme:s}=(0,v.u)(),n=(null===e||void 0===e?void 0:e.inputsId)===(null===t||void 0===t?void 0:t.inputsId);return(0,y.FD)("div",{css:(0,p.AH)({display:"flex",width:"100%",gap:s.spacing.sm},""),children:[e&&(0,y.Y)(jo,{evaluationResult:e}),!n&&t&&(0,y.Y)(jo,{evaluationResult:t})]})};var Go={name:"82a6rk",styles:"flex:1"},Ko={name:"82a6rk",styles:"flex:1"};const qo=({evaluationResult:e})=>{const{theme:t}=(0,v.u)(),{outputs:s,targets:n}=e,o=Object.entries(s).filter((([,e])=>!W(e))),a=Object.entries(n).filter((([,e])=>!W(e))),r=0===o.length&&0===a.length;return(0,y.FD)("div",{css:(0,p.AH)({paddingLeft:t.spacing.md,paddingRight:t.spacing.md,width:"100%"},""),children:[(0,y.Y)(v.T.Text,{bold:!0,children:(0,y.Y)(f.sA,{id:"x6rkyu",defaultMessage:"Response"})}),(0,y.Y)(fe.S,{size:"sm"}),r&&(0,y.Y)(v.T.Paragraph,{children:(0,y.Y)(f.sA,{id:"YvxyMH",defaultMessage:"No responses or targets logged"})}),(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:t.spacing.md,alignItems:"flex-start"},""),children:[o.length>0&&(0,y.Y)("div",{css:Go,children:o.map((([e,t])=>{const s=w[e],n=s?(0,y.Y)(f.sA,{...s}):e;return(0,y.Y)($o,{fieldName:e,title:n,value:t,showCopyIcon:!0},e)}))}),a.length>0&&(0,y.Y)("div",{css:Ko,children:a.map((([e,t])=>{const s=T[e],n=s?(0,y.Y)(f.sA,{...s}):e;return(0,y.Y)($o,{fieldName:e,title:n,value:t,showCopyIcon:!0},e)}))})]})]})},Wo=({evaluationResult:e,otherEvaluationResult:t})=>{const{theme:s}=(0,v.u)();return(0,y.FD)("div",{css:(0,p.AH)({display:"flex",width:"100%",gap:s.spacing.sm},""),children:[e&&(0,y.Y)(qo,{evaluationResult:e}),t&&(0,y.FD)(y.FK,{children:[(0,y.Y)(Co,{}),(0,y.Y)(qo,{evaluationResult:t})]})]})},Qo=({assessment:e,chunkRelevanceAssessmentInfo:t})=>{const{theme:s}=(0,v.u)();return e||t?(0,y.Y)("div",{css:(0,p.AH)({paddingLeft:s.spacing.sm,paddingRight:s.spacing.sm,paddingTop:1,paddingBottom:1,backgroundColor:t?oe(s,t,e):"",borderRadius:s.general.borderRadiusBase,svg:{width:12,height:12}},""),children:e?(0,y.Y)(y.FK,{children:P(e)?(0,y.Y)(g.UserIcon,{}):(0,y.Y)(g.SparkleDoubleIcon,{})}):(0,y.Y)(g.QuestionMarkIcon,{})}):(0,y.Y)(y.FK,{})};function Jo(e){try{const t=new URL(e);return"http:"===t.protocol||"https:"===t.protocol}catch(t){return!1}}var Xo={name:"s5xdrg",styles:"display:flex;align-items:center"};const Zo=({chunk:e,index:t})=>(0,y.FD)("div",{css:Xo,children:[(0,y.FD)(g.Tag,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewretrievalsection.tsx_30",children:["#",t+1]}),Jo(e.docUrl)?(0,y.Y)(v.T.Link,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewretrievalsection.tsx_32",href:e.docUrl,ellipsis:!0,openInNewTab:!0,strong:!0,children:e.docUrl}):(0,y.Y)(v.T.Title,{level:4,withoutMargins:!0,ellipsis:!0,children:e.docUrl})]});var ea={name:"1vgo6ev",styles:"flex:2;display:flex;flex-direction:column;width:0"},ta={name:"49aokf",styles:"display:contents"};const sa=({evaluationResult:e,onUpsertAssessment:t,overridingExistingReview:s=!1,isReadOnly:o=!1,assessmentInfos:a,traceQueryResult:r})=>{const{theme:i}=(0,v.u)(),l=(0,f.tz)(),[d,u]=(0,re.useState)(0),{makeHTML:c}=Ps(),m=(0,re.useMemo)((()=>!(0,n.isNil)(e.retrievalChunks)&&e.retrievalChunks.length>0?e.retrievalChunks:function(e,t){var s,o;if((0,n.isNil)(t))return;let a="doc_uri";const r=t.info.tags;if(null!==r&&void 0!==r&&r.retrievers){const e=st(r.retrievers);"object"===typeof e&&e.length>0&&(a=e[0].doc_uri)}const i=t.data.spans.filter((e=>{var t,s;return(null===(t=e.attributes)||void 0===t?void 0:t["mlflow.spanType"])&&st(null===(s=e.attributes)||void 0===s?void 0:s["mlflow.spanType"])===Se.ModelTraceSpanType.RETRIEVER}));if(0===i.length)return[];const l=null===(s=i.at(-1))||void 0===s||null===(o=s.attributes)||void 0===o?void 0:o["mlflow.spanOutputs"];if(!l)return[];const d=st(l);return Array.isArray(d)?d.map(((t,s)=>{var n;return{docUrl:null===(n=t.metadata)||void 0===n?void 0:n[a],content:t.page_content,retrievalAssessmentsByName:dt(e,s)}})):[]}(e.responseAssessmentsByName,r.data)),[e.responseAssessmentsByName,e.retrievalChunks,r.data]),h=(0,re.useMemo)((()=>{var e;return c(null===m||void 0===m||null===(e=m[d])||void 0===e?void 0:e.content)}),[m,d,c]),E=0===(m||[]).length,S=!o&&(!j(e)||s),A=null===m||void 0===m?void 0:m[d],x=l.formatMessage({id:"iPTAj8",defaultMessage:"Retrieval"});return(0,y.FD)("div",{css:(0,p.AH)({paddingLeft:i.spacing.md,paddingRight:i.spacing.md,width:"100%",display:"flex",flexDirection:"column"},""),role:"region","aria-label":x,children:[(0,y.Y)(v.T.Text,{bold:!0,children:x}),(0,n.isNil)(m)&&r.isFetching?(0,y.Y)(g.TableSkeleton,{lines:3}):E?(0,y.Y)(v.T.Text,{children:(0,y.Y)("i",{children:(0,y.Y)(f.sA,{id:"d00egE",defaultMessage:"No span with type RETRIEVER found in trace."})})}):(0,y.FD)("div",{css:(0,p.AH)({minHeight:400,maxHeight:600,overflow:"hidden",display:"flex",marginTop:i.spacing.sm,border:`1px solid ${i.colors.border}`,borderRadius:i.general.borderRadiusBase},""),children:[(0,y.FD)("div",{css:(0,p.AH)({flex:1,flexShrink:1,maxWidth:300,minWidth:200,overflow:"auto",padding:i.spacing.sm,borderRight:`1px solid ${i.colors.border}`},""),role:"listbox",children:[E&&(0,y.Y)(v.T.Paragraph,{children:(0,y.Y)(f.sA,{id:"0Bee6A",defaultMessage:"No retrieval logged"})}),(m||[]).map(((e,t)=>{var s,o;const r=a.find((e=>e.name===b.CHUNK_RELEVANCE));return(0,y.FD)("div",{role:"option","aria-label":null===(s=e.content)||void 0===s?void 0:s.slice(0,255),"aria-selected":t===d,css:(0,p.AH)({backgroundColor:t===d?i.colors.actionIconBackgroundHover:"transparent","&:hover":{backgroundColor:i.colors.actionIconBackgroundHover},padding:`${i.spacing.sm}px ${i.spacing.md}px`,overflow:"hidden",display:"flex",gap:i.spacing.sm,alignItems:"center",cursor:"pointer",width:"100%"},""),onClick:()=>{u(t)},children:[(0,y.Y)(Qo,{chunkRelevanceAssessmentInfo:r,assessment:(0,n.first)(null===e||void 0===e||null===(o=e.retrievalAssessmentsByName)||void 0===o?void 0:o[b.CHUNK_RELEVANCE])}),(0,y.Y)(v.T.Text,{ellipsis:!0,css:(0,p.AH)({flex:1,lineHeight:i.typography.lineHeightLg},""),children:e.content})]},[e.docUrl,t].join("-"))}))]}),A&&(0,y.FD)("div",{css:ea,children:[(0,y.FD)("div",{css:(0,p.AH)({padding:i.spacing.md,borderBottom:`1px solid ${i.colors.border}`},""),children:[(0,y.Y)(Zo,{chunk:A,index:d}),(0,y.Y)(fe.S,{size:"md"}),(0,y.Y)(No,{assessmentsType:"retrieval",assessmentsByName:$(A.retrievalAssessmentsByName||{}),onUpsertAssessment:e=>{e.metadata||(e.metadata={}),e.metadata[I.CHUNK_INDEX]=d,t(e)},allowEditing:S,allowMoreThanOne:!0,options:U,inputs:[d],assessmentInfos:a})]}),(0,y.Y)("div",{css:(0,p.AH)({padding:i.spacing.md,overflow:"auto"},""),children:(0,y.Y)(v.T.Paragraph,{children:(0,y.Y)("span",{css:ta,dangerouslySetInnerHTML:{__html:null!==h&&void 0!==h?h:""}})})})]})]})]})},na=({evaluationResult:e,otherEvaluationResult:t,onUpsertAssessment:s,overridingExistingReview:n=!1,isReadOnly:o=!1,assessmentInfos:a,traceQueryResult:r,compareToTraceQueryResult:i})=>{const{theme:l}=(0,v.u)();return(0,y.FD)("div",{css:(0,p.AH)({display:"flex",width:"100%",gap:l.spacing.sm},""),children:[e&&(0,y.Y)(sa,{evaluationResult:e,onUpsertAssessment:s,overridingExistingReview:n,isReadOnly:o,assessmentInfos:a,traceQueryResult:r}),t&&(0,y.FD)(y.FK,{children:[(0,y.Y)(Co,{}),(0,y.Y)(sa,{evaluationResult:t,onUpsertAssessment:s,overridingExistingReview:n,isReadOnly:o,assessmentInfos:a,traceQueryResult:i})]})]})};var oa={name:"1cwfdr7",styles:"flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis"};const aa=({evaluationResult:e})=>{const{theme:t}=(0,v.u)();return(0,y.Y)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:t.spacing.sm,overflow:"hidden"},""),children:(0,y.Y)(v.T.Title,{level:2,withoutMargins:!0,css:oa,children:k(e)})})},ra=({experimentId:e,evaluationResult:t,otherEvaluationResult:s,onSavePendingAssessments:o,onClickNext:a,runDisplayName:r,compareToRunDisplayName:i,isNextAvailable:l=!1,isReadOnly:d=!1,exportToEvalsInstanceEnabled:u=!1,assessmentInfos:c,traceQueryResult:m,compareToTraceQueryResult:p})=>{(0,f.tz)();const{pendingAssessments:h,draftEvaluationResult:E,upsertAssessment:b,resetPendingAssessments:S}=(e=>{const[t,s]=(0,re.useReducer)(((e,t)=>{switch(t.type){case"resetPendingAssessments":return[];case"upsertAssessment":const s=e.find((e=>e.name===t.payload.name&&G(e)===G(t.payload)));return s?e.map((e=>e===s?""===L(e)&&t.payload.stringValue?{...t.payload,stringValue:"",name:t.payload.stringValue}:t.payload:e)):[t.payload,...e]}}),[]),o=(0,re.useMemo)((()=>{if(!e)return[];const s=t.find(O);return s?[s,...e.overallAssessments]:e.overallAssessments}),[e,t]),a=(0,re.useMemo)((()=>{if(!e)return{};const s=(0,n.uniq)([...Object.keys(e.responseAssessmentsByName),...t.filter((e=>!O(e)&&!F(e))).map((e=>e.name))]);return Object.fromEntries(s.map((s=>{const n=t.filter((e=>e.name===s));return[s,[...n,...e.responseAssessmentsByName[s]||[]]]})))}),[e,t]),r=(0,re.useMemo)((()=>{var s;const o=t.filter(F);return null===(s=e.retrievalChunks)||void 0===s?void 0:s.map(((e,t)=>{var s;const a=o.filter((e=>{var s;return(null===(s=e.metadata)||void 0===s?void 0:s[I.CHUNK_INDEX])===t})),r=(0,n.flatMap)(null!==(s=e.retrievalAssessmentsByName)&&void 0!==s?s:{}),i=(0,n.groupBy)([...a,...r],"name");return Object.keys(i).forEach((e=>{i[e]=(0,n.orderBy)(i[e],"timestamp","desc")})),{...e,retrievalAssessmentsByName:i}}))}),[t,e]),i=(0,re.useMemo)((()=>({...e,overallAssessments:o,responseAssessmentsByName:a,retrievalChunks:r})),[e,o,a,r]),l=(0,re.useCallback)((e=>s({type:"upsertAssessment",payload:e})),[]),d=(0,re.useCallback)((()=>s({type:"resetPendingAssessments"})),[]);return{pendingAssessments:t,draftEvaluationResult:i,upsertAssessment:l,resetPendingAssessments:d}})(t),[A,x]=(h.length,(0,re.useState)(!1)),w=Boolean(t.errorCode),N=Boolean(t.errorMessage),T=w||N,[C,_]=(0,re.useState)(!1);return(0,y.FD)(y.FK,{children:[T?(0,y.FD)(y.FK,{children:[(0,y.Y)(g.Alert,{action:N&&(0,y.Y)(v.B,{componentId:`mlflow.evaluations_review.evaluation_error_alert.show_${C?"less":"more"}_button`,onClick:()=>_((e=>!e)),children:C?(0,y.Y)(f.sA,{id:"qVQYZH",defaultMessage:"Show less"}):(0,y.Y)(f.sA,{id:"U4s/77",defaultMessage:"Show more"})}),closable:!1,componentId:"mlflow.evaluations_review.evaluation_error_alert",message:w?`${t.errorCode}`:"UNKNOWN_ERROR",description:C&&`${t.errorMessage}`,type:"error"}),(0,y.Y)(fe.S,{size:"md"})]}):null,(0,y.Y)(Fo,{experimentId:e,runDisplayName:r,otherRunDisplayName:i,evaluationResult:t,otherEvaluationResult:s,exportToEvalsInstanceEnabled:u,traceQueryResult:m,compareToTraceQueryResult:p}),(0,y.Y)(Mo,{evaluationResult:E,otherEvaluationResult:s,onUpsertAssessment:b,onClickNext:a,onSavePendingAssessments:async()=>{await(null===o||void 0===o?void 0:o(t,h)),S()},isNextAvailable:l,overridingExistingReview:A,setOverridingExistingReview:x,pendingAssessments:h,onResetPendingAssessments:S,isReadOnly:d,assessmentInfos:c}),(0,y.Y)(Po,{evaluationResult:t,otherEvaluationResult:s}),(0,y.Y)(Wo,{evaluationResult:t,otherEvaluationResult:s}),(0,y.Y)(na,{evaluationResult:E,otherEvaluationResult:s,onUpsertAssessment:b,overridingExistingReview:A,isReadOnly:d,assessmentInfos:c,traceQueryResult:m,compareToTraceQueryResult:p}),(0,y.Y)(fe.S,{size:"lg"})]})};var ia={name:"ujpwkd",styles:"display:flex;position:relative;overflow:scroll"},la={name:"1tc6xju",styles:"flex:1;overflow:auto"};const da=({experimentId:e,evaluation:t,otherEvaluation:s,className:n,runUuid:o,isReadOnly:a=!1,selectNextEval:r,isNextAvailable:i,runDisplayName:l,compareToRunDisplayName:d,exportToEvalsInstanceEnabled:u=!1,assessmentInfos:c,traceQueryResult:m,compareToTraceQueryResult:g,saveAssessmentsQuery:f})=>{const{theme:E}=(0,v.u)(),b=(0,re.useCallback)((async(e,t)=>{if(!e||a||!o||!f)return;const s=t.slice();var n,r;if(r=t,(n=e).overallAssessments.length>0&&n.overallAssessments.every(M)&&!r.some(O)){const t=(e=>{var t;const s=e.overallAssessments.find(M);if(!s)return null;const n=null!==(t=(0,h.w)())&&void 0!==t?t:"";return{...s,timestamp:Date.now(),isDraft:!0,source:{sourceType:"HUMAN",sourceId:n,metadata:{}},metadata:{...s.metadata,[I.IS_COPIED_FROM_AI]:!0}}})(e);t&&s.unshift(t)}return f.savePendingAssessments(o,e.evaluationId,s)}),[o,a,f]),S=(0,re.useRef)(null);return(0,re.useEffect)((()=>{var e;null===(e=S.current)||void 0===e||e.scrollTo(0,0)}),[t.evaluationId]),(0,y.FD)("div",{css:ia,className:n,children:[(0,y.Y)("div",{css:la,ref:S,children:(0,y.Y)(ra,{experimentId:e,evaluationResult:t,otherEvaluationResult:s,onSavePendingAssessments:b,onClickNext:r,isNextAvailable:i,isReadOnly:a||!o,runDisplayName:l,compareToRunDisplayName:d,exportToEvalsInstanceEnabled:u,assessmentInfos:c,traceQueryResult:m,compareToTraceQueryResult:g},t.evaluationId)}),(null===f||void 0===f?void 0:f.isSaving)&&(0,y.Y)("div",{css:(0,p.AH)({inset:0,position:"absolute",backgroundColor:E.colors.overlayOverlay,display:"flex",justifyContent:"center",alignItems:"center",zIndex:E.options.zIndexBase+1},""),children:(0,y.Y)(v.S,{size:"large",inheritColor:!0,css:(0,p.AH)({color:E.colors.backgroundPrimary},"")})})]})},ua=()=>{var e;return{enableRunEvaluationWriteFeatures:null!==(e=!1)&&e}},ca=(0,re.createContext)(ua()),ma=({config:e={},children:t})=>{const s=ua(),o=(0,n.merge)({},s,e);return(0,y.Y)(ca.Provider,{value:o,children:t})};function pa(e,t){return(0,Nt.I)({queryKey:["getTrace",t],queryFn:()=>e&&t?e(t):Promise.resolve(void 0),enabled:!(0,n.isNil)(e)&&!(0,n.isNil)(t),staleTime:1/0,refetchOnWindowFocus:!1,retry:1,keepPreviousData:!0})}var ga={name:"inxa61",styles:"flex:1;overflow:hidden"};const va=re.memo((({experimentId:e,runUuid:t,evaluations:s,selectedEvaluationId:o,onChangeEvaluationId:a,runDisplayName:r,otherRunDisplayName:i,exportToEvalsInstanceEnabled:l=!1,assessmentInfos:d,getTrace:u,saveAssessmentsQuery:c})=>{var m,f,h,E,b,S,A,x,I;const{theme:w,classNamePrefix:N}=(0,v.u)(),T=(0,re.useCallback)((()=>{a(void 0)}),[a]),C=(0,re.useCallback)((e=>{var t,s;return(null===(t=e.currentRunValue)||void 0===t?void 0:t.evaluationId)===o||(null===(s=e.otherRunValue)||void 0===s?void 0:s.evaluationId)===o}),[o]),_=(0,re.useMemo)((()=>s?(null===s||void 0===s?void 0:s.findIndex(C))-1:void 0),[s,C]),R=(0,re.useMemo)((()=>void 0!==_&&_>=0),[_]),Y=(0,re.useMemo)((()=>s?(null===s||void 0===s?void 0:s.findIndex(C))+1:void 0),[s,C]),M=(0,re.useMemo)((()=>void 0!==Y&&Y<s.length),[Y,s]),k=(0,re.useCallback)((()=>{var e,t,n,o;if(null===s||void 0===_)return;const r=(null===(e=s[_])||void 0===e||null===(t=e.currentRunValue)||void 0===t?void 0:t.evaluationId)||(null===(n=s[_])||void 0===n||null===(o=n.otherRunValue)||void 0===o?void 0:o.evaluationId);a(r)}),[s,_,a]),D=(0,re.useCallback)((()=>{var e,t,n,o;if(null===s||void 0===Y)return;const r=(null===(e=s[Y])||void 0===e||null===(t=e.currentRunValue)||void 0===t?void 0:t.evaluationId)||(null===(n=s[Y])||void 0===n||null===(o=n.otherRunValue)||void 0===o?void 0:o.evaluationId);a(r)}),[s,Y,a]),O=(0,re.useMemo)((()=>null===s||void 0===s?void 0:s.find(C)),[s,C]),F=(0,re.useMemo)((()=>Y&&s?null===s||void 0===s?void 0:s[Y]:void 0),[s,Y]),L=(0,re.useMemo)((()=>_&&s?null===s||void 0===s?void 0:s[_]:void 0),[s,_]),V=(0,re.useContext)(ca)||ua(),H=pa(u,null===O||void 0===O||null===(m=O.currentRunValue)||void 0===m||null===(f=m.traceInfo)||void 0===f?void 0:f.trace_id),U=pa(u,null===O||void 0===O||null===(h=O.otherRunValue)||void 0===h||null===(E=h.traceInfo)||void 0===E?void 0:E.trace_id);pa(u,null===F||void 0===F||null===(b=F.currentRunValue)||void 0===b||null===(S=b.traceInfo)||void 0===S?void 0:S.trace_id),pa(u,null===L||void 0===L||null===(A=L.currentRunValue)||void 0===A||null===(x=A.traceInfo)||void 0===x?void 0:x.trace_id);const B=Boolean(null===O||void 0===O?void 0:O.currentRunValue)!==Boolean(null===O||void 0===O?void 0:O.otherRunValue),z=o===(null===O||void 0===O||null===(I=O.currentRunValue)||void 0===I?void 0:I.evaluationId)?H:U;return(0,n.isNil)(O)?(0,y.Y)(y.FK,{}):(0,y.FD)("div",{onKeyDown:e=>{"ArrowLeft"===e.key?k():"ArrowRight"===e.key&&D()},children:[(0,y.FD)(fe.d,{componentId:"mlflow.evaluations_review.modal",visible:!0,title:O.currentRunValue?(0,y.Y)(aa,{evaluationResult:O.currentRunValue}):O.otherRunValue?(0,y.Y)(aa,{evaluationResult:O.otherRunValue}):null,onCancel:T,size:"wide",verticalSizing:"maxed_out",css:(0,p.AH)({width:"100% !important",padding:"0 4rem !important",[`& .${N}-modal-body`]:{flex:1,paddingTop:0},[`& .${N}-modal-header`]:{paddingBottom:w.spacing.sm}},""),footer:null,children:[z.isFetching&&(0,y.Y)(g.GenericSkeleton,{label:"Loading trace...",style:{width:"calc(100% - 45px)",height:"calc(100% - 100px)",position:"absolute",paddingRight:500,zIndex:2100,backgroundColor:w.colors.backgroundPrimary}}),B&&!(0,n.isNil)(z.data)?(0,y.Y)("div",{css:(0,p.AH)({height:"100%",marginLeft:-w.spacing.lg,marginRight:-w.spacing.lg},""),children:(0,y.Y)(fa,{traceData:z.data})}):O.currentRunValue&&(0,y.Y)(da,{experimentId:e,evaluation:O.currentRunValue,otherEvaluation:O.otherRunValue,selectNextEval:D,isNextAvailable:M,css:ga,runUuid:t,isReadOnly:!V.enableRunEvaluationWriteFeatures,runDisplayName:r,compareToRunDisplayName:i,exportToEvalsInstanceEnabled:l,assessmentInfos:d,traceQueryResult:H,compareToTraceQueryResult:U,saveAssessmentsQuery:c})]}),(0,y.Y)("div",{css:(0,p.AH)({display:"flex",justifyContent:"flex-end",position:"fixed",top:"50%",left:0,zIndex:2e3,opacity:".75",width:"5rem","&:hover":{opacity:"1.0"}},""),children:(0,y.Y)("div",{css:(0,p.AH)({backgroundColor:w.colors.backgroundPrimary,borderRadius:w.legacyBorders.borderRadiusMd,marginRight:w.spacing.sm},""),children:(0,y.Y)(v.B,{disabled:!R,componentId:"mlflow.evaluations_review.modal.previous_eval",icon:(0,y.Y)(v.o,{}),onClick:()=>k()})})}),(0,y.Y)("div",{css:(0,p.AH)({display:"flex",justifyContent:"flex-start",position:"fixed",top:"50%",right:0,zIndex:2e3,width:"5rem",opacity:".75","&:hover":{opacity:"1.0"}},""),children:(0,y.Y)("div",{css:(0,p.AH)({backgroundColor:w.colors.backgroundPrimary,borderRadius:w.legacyBorders.borderRadiusMd,marginLeft:w.spacing.sm},""),children:(0,y.Y)(v.B,{disabled:!M,componentId:"mlflow.evaluations_review.modal.next_eval",icon:(0,y.Y)(v.q,{}),onClick:()=>D()})})})]})})),fa=({traceData:e})=>(0,y.Y)(Se.ModelTraceExplorer,{modelTrace:e}),ha=re.memo((({experimentId:e,selectedColumns:t,evaluations:s,selectedEvaluationId:o,selectedAssessmentInfos:a,assessmentInfos:r,assessmentFilters:i,tableSort:l,onChangeEvaluationId:d,getRunColor:u,runUuid:c,runDisplayName:m,compareToRunUuid:h,compareToRunDisplayName:E,rowSelection:b,setRowSelection:S,exportToEvalsInstanceEnabled:A=!1,getTrace:x,toggleAssessmentFilter:I,saveAssessmentsQuery:w,disableAssessmentTooltips:N,onTraceTagsEdit:T,enableRowSelection:C,enableGrouping:_=!1,allColumns:R})=>{const Y=(0,f.tz)(),{theme:M}=(0,v.u)(),[k,D]=(0,re.useState)(!1),O=!(0,n.isNil)(h),F=t.filter((e=>e.type===xe.INPUT)),{columns:L}=(0,re.useMemo)((()=>{if(!_){const s=t.map((t=>Hn(t,{evaluationInputs:F,isComparing:O,theme:M,intl:Y,experimentId:e,onChangeEvaluationId:d,onTraceTagsEdit:T})));return{columns:Et(s,t)}}const s=new Map;yt(t,O).forEach((t=>{const n=t.group||Ie.INFO;s.has(n)||s.set(n,[]),(s.get(n)||[]).push(Hn(t,{evaluationInputs:F,isComparing:O,theme:M,intl:Y,experimentId:e,onChangeEvaluationId:d,onTraceTagsEdit:T}))}));const n=Array.from(s.entries()).map((([e,t])=>({header:go,meta:{groupId:e,visibleCount:t.length,totalCount:R.filter((t=>t.group===e)).length,enableGrouping:_},id:`${e}-group`,columns:t})));return{columns:n}}),[t,F,O,d,M,Y,e,T,_,R]),{setTable:V,setSelectedRowIds:H}=re.useContext(he),U=(0,xt.N4)({data:s,columns:L,getCoreRowModel:(0,It.HT)(),getSortedRowModel:(0,It.h5)(),enableColumnResizing:!0,columnResizeMode:"onChange",enableRowSelection:C,enableMultiSort:!0,state:{rowSelection:b},meta:{getRunColor:u},onRowSelectionChange:S,getRowId:e=>{return(null===(t=e.currentRunValue)||void 0===t?void 0:t.evaluationId)||"";var t}}),B=void 0!==b&&U.getIsAllRowsSelected(),z=U.getIsSomeRowsSelected();(0,re.useEffect)((()=>(V(U),()=>V(void 0))),[U,V]),(0,re.useEffect)((()=>{C&&H(U.getSelectedRowModel().rows.map((e=>e.id)))}),[U,b,H,C]);const $=Y.formatMessage({id:"+mAXPc",defaultMessage:"No traces found. Try clearing your active filters to see more traces."}),j=(0,y.Y)(g.Empty,{description:$,image:(0,y.Y)(ve.S,{})});(0,re.useEffect)((()=>{l&&!ze.includes(l.key)?l.key===Te?U.setSorting([{id:l.key,desc:!l.asc},{id:Re,desc:!1}]):U.setSorting([{id:l.key,desc:!l.asc}]):U.setSorting([])}),[l,U]);const{rows:P}=U.getRowModel(),G=re.useRef(null),K=(0,wt.Te)({count:P.length,estimateSize:()=>120,getScrollElement:()=>G.current,measureElement:"undefined"!==typeof window&&-1===navigator.userAgent.indexOf("Firefox")?e=>null===e||void 0===e?void 0:e.getBoundingClientRect().height:void 0,overscan:10}),q=K.getVirtualItems(),W=U.getHeaderGroups(),{columnSizeVars:Q,tableWidth:J}=(0,re.useMemo)((()=>{const e={};W.forEach((t=>{t.headers.forEach((t=>{e[`--header-${Us(t.column.id)}-size`]=t.getSize()+"px"}))}));let t=0;if(P.length>0){P[0].getVisibleCells().forEach((s=>{e[`--col-${Us(s.column.id)}-size`]=s.column.getSize()+"px",t+=s.column.getSize()}))}return{columnSizeVars:e,tableWidth:t+"px"}}),[W,P]),X=(0,re.useMemo)((()=>{const e={};for(const t of a)e[t.name]=Rs(t,s,i);return e}),[a,s,i]);return(0,y.FD)(y.FK,{children:[(0,y.Y)("div",{className:"container",ref:G,css:(0,p.AH)({height:"100%",position:"relative",overflowY:"auto",overflowX:"auto",minWidth:"100%",width:J},""),children:(0,y.FD)(g.Table,{css:(0,p.AH)({width:"100%",...Q},""),empty:0===U.getRowModel().rows.length?j:void 0,someRowsSelected:C?z||B:void 0,children:[(0,y.Y)(po,{headerGroups:U.getHeaderGroups(),enableRowSelection:C,enableGrouping:_,selectedAssessmentInfos:a,assessmentNameToAggregates:X,assessmentFilters:i,toggleAssessmentFilter:I,runDisplayName:m,compareToRunUuid:h,compareToRunDisplayName:E,disableAssessmentTooltips:N,collapsedHeader:k,setCollapsedHeader:D,isComparing:O,allRowSelected:B,someRowSelected:z,toggleAllRowsSelectedHandler:U.getToggleAllRowsSelectedHandler,setColumnSizing:U.setColumnSizing}),(0,y.Y)(Bn,{rows:P,isComparing:O,enableRowSelection:C,virtualItems:q,virtualizerTotalSize:K.getTotalSize(),virtualizerMeasureElement:K.measureElement,rowSelectionState:b,selectedColumns:t})]})}),o&&(0,y.Y)(va,{experimentId:e,runUuid:c,runDisplayName:m,otherRunDisplayName:E,evaluations:P.map((e=>e.original)),selectedEvaluationId:o,onChangeEvaluationId:d,exportToEvalsInstanceEnabled:A,assessmentInfos:r,getTrace:x,saveAssessmentsQuery:w})]})}));function ya({searchQuery:e,setSearchQuery:t}){const s=(0,f.tz)(),[n,o]=(0,re.useState)(e);return(0,re.useEffect)((()=>{o(e)}),[e]),(0,re.useEffect)((()=>{const e=setTimeout((()=>{t(n)}),400);return()=>clearTimeout(e)}),[n,t]),(0,y.Y)(g.TableFilterInput,{componentId:"mlflow.evaluations_review.table_ui.filter_input",placeholder:s.formatMessage({id:"zNWzj6",defaultMessage:"Search traces by request"}),value:n,onChange:e=>o(e.target.value)})}const Ea="mlflow.evaluations_review.table_ui.compare_to_run_combobox",ba="mlflow.evaluations_review.table_ui.filter_form",Sa="mlflow.evaluations_review.table_ui.column_filter_combobox",Aa=({columns:e,selectedColumns:t,setSelectedColumns:s,setSelectedColumnsWithHiddenColumns:n})=>{const o=(0,f.tz)(),{theme:a}=(0,v.u)();return(0,y.FD)(g.DialogCombobox,{componentId:Sa,label:"Columns",multiSelect:!0,children:[(0,y.Y)(g.DialogComboboxCustomButtonTriggerWrapper,{children:(0,y.Y)(v.B,{endIcon:(0,y.Y)(g.ChevronDownIcon,{}),componentId:"mlflow.evaluations_review.table_ui.filter_button",children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:a.spacing.sm,alignItems:"center"},""),children:[(0,y.Y)(g.ColumnsIcon,{}),o.formatMessage({id:"wjOGl2",defaultMessage:"Columns"})]})})}),(0,y.Y)(g.DialogComboboxContent,{children:(0,y.Y)(g.DialogComboboxOptionList,{children:e.map((e=>(0,y.Y)(g.DialogComboboxOptionListCheckboxItem,{value:e.label,checked:t.some((t=>t.id===e.id)),onChange:()=>(e=>{if(n)return n([e]);s&&s((t=>t.some((t=>t.id===e.id))?t.filter((t=>t.id!==e.id)):[...t,e]))})(e)},e.id)))})})]})};var xa={name:"9q39xd",styles:"min-width:32px"};const Ia=re.memo((({tableSort:e,columns:t=[],onChange:s,enableGrouping:n,isMetadataLoading:o,metadataError:a})=>{const r=(0,f.tz)(),{theme:i}=(0,v.u)(),[l,d]=(0,re.useState)(!1),u=(0,re.useMemo)((()=>{const e=[],s=r.formatMessage({id:"Kkuttk",defaultMessage:"Assessment"});if(n){const s=yt(t);for(const t of s)if(t.type===xe.ASSESSMENT){const s=t.assessmentInfo.displayName;e.push({label:s,key:t.id,type:xe.ASSESSMENT,group:Ie.ASSESSMENT})}else if(t.type===xe.INPUT)e.push({label:t.label,key:t.id,type:xe.INPUT,group:Ie.INFO});else if(t.type===xe.TRACE_INFO){const s=t.id===Te?r.formatMessage({id:"mrGpVQ",defaultMessage:"Session time"}):t.label;Be.includes(t.id)&&e.push({label:s,key:t.id,type:xe.TRACE_INFO,group:Ie.INFO})}return e}for(const n of t.filter((e=>e.type===xe.ASSESSMENT))){const t=n.assessmentInfo.displayName;e.push({label:`${s} \ufe65 ${t}`,key:n.id,type:xe.ASSESSMENT})}const o=r.formatMessage({id:"2plDKs",defaultMessage:"Input"});for(const n of t.filter((e=>e.type===xe.INPUT)))e.push({label:`${o} \ufe65 ${n.label}`,key:n.id,type:xe.INPUT});for(const n of t.filter((e=>(e.type===xe.TRACE_INFO||e.type===xe.INTERNAL_MONITOR_REQUEST_TIME)&&Be.includes(e.id))))e.push({label:n.label,key:n.id,type:xe.TRACE_INFO});return e}),[t,r,n]),c=(0,re.useMemo)((()=>{const t=u.find((t=>t.key===(null===e||void 0===e?void 0:e.key)));let s=null===t||void 0===t?void 0:t.label;if(!s){var n;const t=null===e||void 0===e||null===(n=e.key)||void 0===n?void 0:n.match(/^.+\.`(.+)`$/);t&&(s=t[1])}const o=r.formatMessage({id:"sKaamx",defaultMessage:"Sort"});return s?`${o}: ${s}`:o}),[u,r,e]);return(0,y.FD)(g.DropdownMenu.Root,{open:l,onOpenChange:d,modal:!1,children:[(0,y.Y)(g.DropdownMenu.Trigger,{"data-testid":"sort-select-dropdown",asChild:!0,children:(0,y.Y)(v.B,{componentId:"mlflow.experiment_page.sort_select_v2.toggle",icon:e?e.asc?(0,y.Y)(g.SortAscendingIcon,{}):(0,y.Y)(g.SortDescendingIcon,{}):(0,y.Y)(g.SortUnsortedIcon,{}),css:xa,"aria-label":c,endIcon:(0,y.Y)(g.ChevronDownIcon,{}),children:c})}),(0,y.Y)(g.DropdownMenu.Content,{minWidth:250,children:a?(0,y.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:i.spacing.xs,padding:`${i.spacing.md}px`,color:i.colors.textValidationDanger},""),"data-testid":"filter-dropdown-error",children:[(0,y.Y)(v.l,{}),(0,y.Y)(f.sA,{id:"dJaboT",defaultMessage:"Fetching traces failed"})]}):o?(0,y.Y)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:i.spacing.xs,padding:`${i.spacing.lg}px`,color:i.colors.textSecondary},""),"data-testid":"sort-dropdown-loading",children:(0,y.Y)(v.S,{size:"small"})}):n?(0,y.Y)(Na,{sortOptions:u,tableSort:e,onOptionSelected:(e,t)=>{s(e,t),d(!1)}}):(0,y.Y)(_a,{sortOptions:u,tableSort:e,onOptionSelected:(e,t)=>{s(e,t),d(!1)}})})]})}));var wa={name:"1j5vobt",styles:"display:flex;align-items:center;gap:4px"};const Na=({sortOptions:e,tableSort:t,onOptionSelected:s})=>{const{theme:n}=(0,v.u)(),o=(0,re.useRef)(null),a=(0,re.useRef)(null),[r,i]=(0,re.useState)(""),l=(0,re.useMemo)((()=>e.filter((e=>e.label.toLowerCase().includes(r.toLowerCase())))),[e,r]),d=(0,re.useMemo)((()=>{const e={};return l.forEach((t=>{var s;const n=null!==(s=t.group)&&void 0!==s?s:Ie.INFO;e[n]||(e[n]=[]),e[n].push(t)})),e}),[l]),u=(0,re.useCallback)((n=>{var o;const a=e.find((e=>e.key===n));a&&s(a,null===(o=null===t||void 0===t?void 0:t.asc)||void 0===o||o)}),[s,e,null===t||void 0===t?void 0:t.asc]),c=(0,re.useCallback)((n=>{var o;const a=null!==(o=e.find((e=>e.key===(null===t||void 0===t?void 0:t.key))))&&void 0!==o?o:e[0];s(a,n)}),[s,e,null===t||void 0===t?void 0:t.key]);return(0,re.useEffect)((()=>{requestAnimationFrame((()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.focus()}))}),[]),(0,y.FD)(y.FK,{children:[(0,y.FD)("div",{css:(0,p.AH)({padding:`${n.spacing.sm}px ${n.spacing.lg/2}px`,display:"flex",gap:n.spacing.xs},""),children:[(0,y.Y)(ve.I,{ref:o,componentId:"mlflow.genai_traces_table.sort_dropdown.search",prefix:(0,y.Y)(ve.S,{}),placeholder:"Search",value:r,onChange:e=>i(e.target.value),type:"search",onKeyDown:e=>{var t;"ArrowDown"!==e.key&&"Tab"!==e.key||(null===(t=a.current)||void 0===t||t.focus(),e.preventDefault())}}),(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:n.spacing.xs},""),children:[(0,y.Y)(g.ToggleButton,{pressed:!1===(null===t||void 0===t?void 0:t.asc),icon:(0,y.Y)(g.ArrowDownIcon,{}),componentId:"mlflow.genai_traces_table.sort_dropdown.sort_desc",onClick:()=>c(!1),"aria-label":"Sort descending"}),(0,y.Y)(g.ToggleButton,{pressed:!0===(null===t||void 0===t?void 0:t.asc),icon:(0,y.Y)(g.ArrowUpIcon,{}),componentId:"mlflow.experiment_page.sort_dropdown.sort_asc",onClick:()=>c(!0),"aria-label":"Sort ascending"})]})]}),(0,y.FD)("div",{css:(0,p.AH)({maxHeight:400,overflowY:"auto",padding:`0 ${n.spacing.sm}px`},""),children:[Object.entries(d).map((([e,s],n)=>(0,y.Y)(re.Fragment,{children:(0,y.FD)(g.DropdownMenu.Group,{children:[(0,y.Y)(g.DropdownMenu.Label,{children:e===Ie.INFO?"Attributes":we[e]}),s.map(((e,s)=>(0,y.FD)(g.DropdownMenu.CheckboxItem,{componentId:"mlflow.genai_traces_table.sort_dropdown.sort_option",checked:e.key===(null===t||void 0===t?void 0:t.key),onClick:()=>u(e.key),ref:0===n&&0===s?a:void 0,"data-testid":`sort-select-${e.label}`,children:[(0,y.Y)(g.DropdownMenu.ItemIndicator,{}),(0,y.Y)("span",{css:wa,children:e.label})]},e.key)))]})},e))),0===l.length&&(0,y.Y)(g.DropdownMenu.Item,{disabled:!0,componentId:"mlflow.genai_traces_table.sort_dropdown.no_results",children:(0,y.Y)(f.sA,{id:"WpNCQl",defaultMessage:"No results"})})]})]})};var Ta={name:"1kxd8xu",styles:"max-height:400px;overflow-y:auto"},Ca={name:"1j5vobt",styles:"display:flex;align-items:center;gap:4px"};const _a=({sortOptions:e,tableSort:t,onOptionSelected:s})=>{const{theme:n}=(0,v.u)(),o=(0,re.useRef)(null),[a,r]=(0,re.useState)(""),i=(0,re.useRef)(null),l=(0,re.useMemo)((()=>e.filter((e=>e.label.toLowerCase().includes(a.toLowerCase())))),[e,a]),d=(0,re.useCallback)((n=>{const o=e.find((e=>e.key===n));s(o,(null===t||void 0===t?void 0:t.asc)||!0)}),[s,t,e]),u=(0,re.useCallback)((n=>{const o=e.find((e=>e.key===(null===t||void 0===t?void 0:t.key)));s(o||e[0],n)}),[s,e,t]);return(0,re.useEffect)((()=>{requestAnimationFrame((()=>{var e;null===(e=o.current)||void 0===e||e.focus()}))}),[]),(0,y.FD)(y.FK,{children:[(0,y.FD)("div",{css:(0,p.AH)({padding:`${n.spacing.sm}px ${n.spacing.lg/2}px ${n.spacing.sm}px`,width:"100%",display:"flex",gap:n.spacing.xs},""),children:[(0,y.Y)(ve.I,{componentId:"mlflow.experiment_page.sort_dropdown.search",prefix:(0,y.Y)(ve.S,{}),value:a,type:"search",onChange:e=>r(e.target.value),placeholder:"Search",autoFocus:!0,ref:o,onKeyDown:e=>{var t;"ArrowDown"!==e.key&&"Tab"!==e.key?e.stopPropagation():null===(t=i.current)||void 0===t||t.focus()}}),(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:n.spacing.xs},""),children:[(0,y.Y)(g.ToggleButton,{pressed:!1===(null===t||void 0===t?void 0:t.asc),icon:(0,y.Y)(g.ArrowDownIcon,{}),componentId:"mlflow.experiment_page.sort_dropdown.sort_desc",onClick:()=>u(!1),"aria-label":"Sort descending","data-testid":"sort-select-desc"}),(0,y.Y)(g.ToggleButton,{pressed:!0===(null===t||void 0===t?void 0:t.asc),icon:(0,y.Y)(g.ArrowUpIcon,{}),componentId:"mlflow.experiment_page.sort_dropdown.sort_asc",onClick:()=>u(!0),"aria-label":"Sort ascending","data-testid":"sort-select-asc"})]})]}),(0,y.FD)(g.DropdownMenu.Group,{css:Ta,children:[l.map(((e,s)=>(0,y.FD)(g.DropdownMenu.CheckboxItem,{componentId:"mlflow.experiment_page.sort_dropdown.sort_option",onClick:()=>d(e.key),checked:e.key===(null===t||void 0===t?void 0:t.key),"data-testid":`sort-select-${e.label}`,ref:0===s?i:void 0,children:[(0,y.Y)(g.DropdownMenu.ItemIndicator,{}),(0,y.Y)("span",{css:Ca,children:e.label})]},e.key))),!l.length&&(0,y.Y)(g.DropdownMenu.Item,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunssortselectorv2.tsx_151",disabled:!0,children:(0,y.Y)(f.sA,{id:"EkUD0b",defaultMessage:"No results"})})]})]})},Ra=({backgroundColor:e,icon:t,children:s})=>{const{theme:n}=(0,v.u)();return(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",padding:"4px 8px",gap:n.spacing.xs,borderRadius:n.borders.borderRadiusMd,color:n.colors.textSecondary,backgroundColor:e||n.colors.backgroundSecondary,fontSize:n.typography.fontSizeSm},""),children:[t||null,s?(0,y.Y)("span",{children:s}):null]})},Ya="selectedEvaluationId",Ma=()=>{var e;const[t,s]=le(),n=null!==(e=t.get(Ya))&&void 0!==e?e:void 0,o=(0,re.useCallback)((e=>{s((t=>void 0===e?(t.delete(Ya),t):(t.set(Ya,e),t)))}),[s]);return[n,o]},ka="searchQuery";function Da(e,t,s,o,a){return e.filter((e=>function(e,t,s,o){const a=null===e||void 0===e?void 0:e.currentRunValue,r=null===e||void 0===e?void 0:e.otherRunValue;let i=!0;for(const m of t){var l,d;const e=m.assessmentName,t=m.filterValue,p=m.run,g=p===s?a:p===o?r:void 0;if(void 0===g)continue;const v=e===b.OVERALL_ASSESSMENT?null===(l=g.overallAssessments)||void 0===l?void 0:l[0]:null===(d=g.responseAssessmentsByName[e])||void 0===d?void 0:d[0];if("rca"===m.filterType){var u,c;const t=(null===g||void 0===g||null===(u=g.overallAssessments[0])||void 0===u||null===(c=u.rootCauseAssessment)||void 0===c?void 0:c.assessmentName)===e;i=i&&t}else{let e=v?L(v):void 0;(0,n.isNil)(e)&&(e=void 0),i=i&&e===t}}return i}(e,t,o,a))).filter((e=>{var t,o;if((0,n.isNil)(s)||""===s)return!0;const a=s.toLowerCase(),r=Object.values((null===(t=e.currentRunValue)||void 0===t?void 0:t.inputs)||{}).some((e=>JSON.stringify(e).toLowerCase().includes(a))),i=(null===(o=e.currentRunValue)||void 0===o?void 0:o.inputsId.toLowerCase())===a;return r||i}))}var Oa={name:"1ykowef",styles:"margin-bottom:0"},Fa={name:"f3vz0n",styles:"font-weight:500"},La={name:"k4cowf",styles:"display:flex;flex:1;overflow-y:hidden"};const Va=e=>{const{totalRowCount:t,sampledInfo:s}=e,o=(0,f.tz)();return s?s.maxAllowedCount?t>=s.maxAllowedCount?(0,y.Y)(fe.T,{componentId:"mlflow.experiment_list_view.max_traces.tooltip",content:o.formatMessage({id:"BpAyCF",defaultMessage:"Only the top {evalResultsCount} results are shown"},{evalResultsCount:t}),children:(0,y.Y)(v.W,{color:"warning"})}):null:s.logCountLoading||(0,n.isNil)(s.sampledCount)||(0,n.isNil)(s.totalCount)?(0,y.Y)(v.S,{}):(0,y.Y)(Ra,{children:(0,y.FD)(fe.T,{componentId:"mlflow.experiment_list_view.sampled_badge.tooltip",content:o.formatMessage({id:"TannO5",defaultMessage:"Retrieved {sampledCount} out of {totalCount} total logs ({percentage}%)"},{sampledCount:s.sampledCount,totalCount:s.totalCount,percentage:Fs(s.sampledCount/s.totalCount)}),children:["Sampled ",Fs(s.sampledCount/s.totalCount),"%"]})}):null},Ha="__any_value__";var Ua={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const Ba=re.memo((({assessmentName:e,assessmentInfo:t,assessmentLabel:s,assessmentFilter:n,updateAssessmentFilter:o,removeAssessmentFilter:a,run:r})=>{const i=(0,f.tz)(),{theme:l}=(0,v.u)(),d=n?pe(n.filterValue):Ha;return(0,y.Y)("div",{css:Ua,children:(0,y.FD)(g.SegmentedControlGroup,{name:"size-story",value:d,onChange:s=>{if(s.target.value===Ha)return void a(e,r);const n=me(t,s.target.value);o(e,n,r)},size:"middle",componentId:`mlflow.evaluations_review.table_ui.filter_control_${e}`,children:[(0,y.Y)(g.SegmentedControlButton,{value:Ha,children:(0,y.Y)("div",{css:(0,p.AH)({display:"flex",gap:l.spacing.sm,alignItems:"center",color:l.colors.textPrimary},""),children:i.formatMessage({id:"Hq/vjk",defaultMessage:"All"})})}),Array.from(t.uniqueValues.values()).map((e=>{const{content:s,icon:n}=x(i,l,t,e);return(0,y.Y)(g.SegmentedControlButton,{value:pe(e),children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:l.spacing.sm,alignItems:"center",color:l.colors.textPrimary},""),children:[s,n]})},pe(e))}))]})})})),za=function({experimentId:e,currentEvaluationResults:t,compareToEvaluationResults:s,currentRunDisplayName:n,runUuid:o,compareToRunUuid:a,compareToRunDisplayName:r,compareToRunLoading:i,sampledInfo:l,exportToEvalsInstanceEnabled:d=!1,getTrace:u,saveAssessmentsQuery:c,enableRunEvaluationWriteFeatures:m,defaultSortOption:h,disableAssessmentTooltips:E,onTraceTagsEdit:S,traceActions:A,initialSelectedColumns:x}){const{theme:I}=(0,v.u)(),w=(0,f.tz)(),N=lt(t),T=lt(s||[]),C=(0,re.useMemo)((()=>{const e=d?{exportToEvals:{exportToEvalsInstanceEnabled:d,getTrace:u}}:{};return{...A,...e}}),[A,d,u]),_=Object.keys(C).length>0,[R,Y]=Ma(),M=(0,re.useMemo)((()=>At(N,T)),[N,T]),[k,D]=(()=>{var e;const[t,s]=le();return[null!==(e=t.get(ka))&&void 0!==e?e:"",(0,re.useCallback)((e=>{s((t=>void 0===e||""===e?(t.delete(ka),t):(t.set(ka,e),t)))}),[s])]})(),O=(0,re.useMemo)((()=>Is(w,N,T)),[w,N,T]),F=Ge(w,N,O,o),[L,V]=(e=>{const[t,s]=le();return[(0,re.useMemo)((()=>{var s;return(null!==(s=t.getAll(ue))&&void 0!==s?s:[]).reduce(((t,s)=>{const[n,o,a,r]=s.split("::"),i=null===e||void 0===e?void 0:e.find((e=>e.name===o));if(i){const e=me(i,a);t.push({run:n,assessmentName:o,filterValue:e,filterType:""===r?void 0:r})}return t}),[])}),[e,t]),(0,re.useCallback)(((e,t=!1)=>{s((t=>(t.delete(ue),e&&e.forEach((e=>{t.append(ue,[e.run,e.assessmentName,pe(e.filterValue),e.filterType].join("::"))})),t)),{replace:t})}),[s])]})(F.map((e=>e.assessmentInfo)).filter((e=>void 0!==e))),H=(0,re.useMemo)((()=>""===k&&0===L.length?M:Da(M,L,k,n,r)),[M,k,L,n,r]),[U,B]=(0,re.useState)(F),z=(0,re.useMemo)((()=>ws(U.filter((e=>e.type===xe.ASSESSMENT)).map((e=>e.assessmentInfo)))),[U]),$=F.find((e=>e.type===xe.ASSESSMENT&&e.id===b.OVERALL_ASSESSMENT)),j=h||($?{key:$.id,type:xe.ASSESSMENT,asc:!0}:void 0),[P,G]=(0,re.useState)(j),K=(0,re.useCallback)(((e,t)=>L.find((s=>s.assessmentName===e&&s.run===t))),[L]),q=(0,re.useCallback)(((e,t)=>{V(L.filter((s=>s.assessmentName!==e||s.run!==t)))}),[L,V]),W=(0,re.useCallback)(((e,t,s,n)=>{const o=L.find((t=>t.assessmentName===e&&t.run===s));V(void 0===o?[...L,{assessmentName:e,filterValue:t,filterType:n,run:s}]:L.map((s=>s.assessmentName===e?{...s,filterValue:t,filterType:n}:s)))}),[L,V]),Q=(0,re.useCallback)(((e,t,s,n)=>{const o=L.find((t=>t.assessmentName===e&&t.run===s));void 0===o?V([...L,{assessmentName:e,filterValue:t,filterType:n,run:s}]):o.filterValue===t&&o.filterType===n?V(L.filter((t=>t.assessmentName!==e||t.run!==s))):V(L.map((o=>o.assessmentName===e&&o.run===s?{assessmentName:e,filterValue:t,filterType:n,run:s}:o)))}),[L,V]),J=(0,re.useCallback)((()=>{V([])}),[V]),X=L.length>0,[Z,ee]=(0,re.useState)({}),te=(0,re.useMemo)((()=>{const e=Object.keys(Z).filter((e=>Z[e]));return H.filter((t=>t.currentRunValue&&e.includes(t.currentRunValue.evaluationId))).map((e=>e.currentRunValue)).filter((e=>void 0!==e))}),[Z,H]),se={enableRunEvaluationWriteFeatures:m},ne=N.length;return i?(0,y.Y)(g.LegacySkeleton,{}):(0,y.Y)(ma,{config:se,children:(0,y.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",gap:I.spacing.lg,overflow:"hidden",height:"100%"},""),children:(0,y.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:I.spacing.xs,overflow:"hidden",flexGrow:1},""),children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flex:1,flexDirection:"column",gap:I.spacing.xs,overflow:"hidden"},""),children:[(0,y.FD)("div",{css:(0,p.AH)({display:"flex",width:"100%",alignItems:"flex-end",justifyContent:"space-between",padding:`${I.spacing.xs}px 0px`},""),children:[(0,y.FD)(g.TableFilterLayout,{css:Oa,children:[(0,y.Y)(ya,{searchQuery:k,setSearchQuery:D}),(0,y.FD)(g.DialogCombobox,{componentId:ba,label:"Filters",value:Array.from(L).map((e=>e.assessmentName)),multiSelect:!0,children:[(0,y.Y)(g.DialogComboboxCustomButtonTriggerWrapper,{children:(0,y.Y)(v.B,{endIcon:(0,y.Y)(g.ChevronDownIcon,{}),componentId:"mlflow.evaluations_review.table_ui.filter_button",css:(0,p.AH)({border:X?`1px solid ${I.colors.actionDefaultBorderFocus} !important`:"",backgroundColor:X?`${I.colors.actionDefaultBackgroundHover} !important`:""},""),children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:I.spacing.sm,alignItems:"center"},""),children:[(0,y.Y)(g.FilterIcon,{}),w.formatMessage({id:"J961B2",defaultMessage:"Filters{numFilters}"},{numFilters:X?` (${L.length})`:""}),L.length>0&&(0,y.Y)(ve.X,{css:(0,p.AH)({fontSize:12,cursor:"pointer",color:I.colors.grey400,"&:hover":{color:I.colors.grey600}},""),onClick:e=>{J(),e.stopPropagation(),e.preventDefault()}})]})})}),(0,y.Y)(g.DialogComboboxContent,{children:(0,y.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",padding:`${I.spacing.sm}px ${I.spacing.sm}px`,gap:I.spacing.md},""),children:z.filter((e=>"numeric"!==e.dtype)).map((e=>(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:I.spacing.sm},""),children:[(0,y.Y)("div",{css:Fa,children:e.displayName}),n&&(0,y.Y)(Ba,{assessmentLabel:e.displayName,assessmentName:e.name,assessmentInfo:e,assessmentFilter:K(e.name,n),updateAssessmentFilter:W,removeAssessmentFilter:q,run:n}),a&&r&&(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:I.spacing.xs},""),children:[(0,y.Y)(v.T.Hint,{children:r}),(0,y.Y)(Ba,{assessmentLabel:e.displayName,assessmentName:e.name,assessmentInfo:e,assessmentFilter:K(e.name,r),updateAssessmentFilter:W,removeAssessmentFilter:q,run:r})]})]},e.name)))})})]}),(0,y.Y)(Ia,{tableSort:P,columns:F,onChange:(e,t)=>{G({key:e.key,type:e.type,asc:t})}}),(0,y.Y)(Aa,{columns:F,selectedColumns:U,setSelectedColumns:B}),(0,y.Y)(ut,{experimentId:e,selectedTraces:te,setRowSelection:ee,traceActions:C,traceInfos:void 0})]}),(0,y.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:I.spacing.sm},""),children:[(0,y.Y)(Va,{totalRowCount:ne,sampledInfo:l}),(0,y.Y)(v.T.Hint,{children:w.formatMessage({id:"FnOQ44",defaultMessage:"{numFilteredEvals} of {numEvals}"},{numEvals:M.length,numFilteredEvals:H.length})})]})]}),(0,y.Y)("div",{css:(0,p.AH)({display:"flex",gap:I.spacing.md,width:"100%",flex:1,overflowY:"hidden"},""),children:(0,y.Y)("div",{css:La,children:(0,y.Y)(ha,{experimentId:e,selectedColumns:U,allColumns:F,evaluations:H,selectedEvaluationId:R,selectedAssessmentInfos:z,assessmentInfos:O,assessmentFilters:L,onChangeEvaluationId:Y,tableSort:P,runUuid:o,compareToRunUuid:a,runDisplayName:n,compareToRunDisplayName:r,enableRowSelection:_,rowSelection:_?Z:void 0,setRowSelection:_?ee:void 0,exportToEvalsInstanceEnabled:d,getTrace:u,toggleAssessmentFilter:Q,saveAssessmentsQuery:c,disableAssessmentTooltips:E,onTraceTagsEdit:S})})})]})})})})},$a=async({queryKey:[,{experimentId:e}]})=>Dt("ajax-api/2.0/mlflow/runs/search","POST",{experiment_ids:[e]}),ja=(e,t=!1)=>{var s;const{data:n,error:o,isLoading:a,isFetching:r}=(0,Nt.I)((e=>["EXPERIMENT_RUNS_FOR_TRACE_COMPARISON",{experimentId:e}])(e),{queryFn:$a,enabled:!t,cacheTime:1/0,staleTime:1/0});return{requestError:o,isLoading:a,isFetching:r,runInfos:null===n||void 0===n||null===(s=n.runs)||void 0===s?void 0:s.map((e=>{var t,s;return{runUuid:null===(t=e.info)||void 0===t?void 0:t.run_uuid,runName:null===(s=e.info)||void 0===s?void 0:s.run_name}}))}};var Pa=s(77735);const Ga=(e,t)=>["GET_TRACE_EVALUATION_ARTIFACT",{runUuid:e,artifactFile:t}],Ka=async({queryKey:[,{runUuid:e,artifactFile:t}]})=>{const s=["ajax-api/2.0/mlflow/get-artifact",new URLSearchParams({run_uuid:e,path:t})].join("?");return Dt(s,"GET").then((e=>({...e,filename:t})))},qa=[o.Assessments,o.Evaluations,o.Metrics],Wa=({runUuid:e,artifacts:t=qa},{disabled:s=!1}={})=>{const o=!s&&qa.some((e=>t.includes(e))),a=(0,Pa.E)({queries:qa.map((n=>({queryFn:Ka,queryKey:Ga(e,n),enabled:!s&&t.includes(n),refetchOnWindowFocus:!1})))}),d=a.some((e=>e.isLoading)),u=a.some((e=>e.isFetching)),p=a.find((e=>e.error)),[g,v,f]=a.map((e=>e.data)),h=(0,re.useMemo)((()=>m(g)),[g]),y=(0,re.useMemo)((()=>m(v)),[v]),E=(0,re.useMemo)((()=>m(f)),[f]),b=(0,re.useMemo)((()=>{if(y)return function(e,t,s){const o=(t||[]).reduce(((e,t)=>{e[t.evaluation_id]||(e[t.evaluation_id]={});const{key:s,value:n,timestamp:o}=t;return e[t.evaluation_id][s]={key:s,value:n,timestamp:o},e}),{}),a=(s||[]).reduce(((e,t)=>{var s,o,a,r;return e[t.evaluation_id]||(e[t.evaluation_id]=[]),e[t.evaluation_id].push({booleanValue:(0,n.isNil)(t.boolean_value)?t.boolean_value:Boolean(t.boolean_value),numericValue:(0,n.isNil)(t.numeric_value)?t.numeric_value:Number(t.numeric_value),stringValue:(0,n.isNil)(t.string_value)?t.string_value:String(t.string_value),metadata:t.metadata||{},...t.error_code&&{errorCode:t.error_code},...t.error_message&&{errorMessage:t.error_message},name:t.name,rationale:t.rationale||null,source:{metadata:null!==(s=null===(o=t.source)||void 0===o?void 0:o.metadata)&&void 0!==s?s:{},sourceId:null===(a=t.source)||void 0===a?void 0:a.source_id,sourceType:null===(r=t.source)||void 0===r?void 0:r.source_type},timestamp:t.timestamp}),e}),{});return e.map((e=>{var t,s;const d=(0,n.orderBy)(a[e.evaluation_id]||[],"timestamp","desc"),u=d.filter(i).map((e=>{var t,s,o,a;const r=null===(t=e.rationale)||void 0===t?void 0:t.match(/^\[(.*?)\](.*?)(?:\*\*Suggested Actions\*\*:(.*))?$/s),i=r?null===(s=r[1])||void 0===s?void 0:s.trim():void 0,l=r?null===(o=r[2])||void 0===o?void 0:o.trim():void 0,d=r?null===(a=r[3])||void 0===a?void 0:a.trim():void 0;return e.rationale=l||e.rationale,{...e,rootCauseAssessment:(0,n.isNil)(i)?void 0:{assessmentName:i,suggestedActions:d}}}));0===u.length&&u.push({name:r.OVERALL_ASSESSMENT,rationale:null,source:{sourceType:"AI_JUDGE",sourceId:"UNKNOWN",metadata:{}},metadata:{},numericValue:null,booleanValue:null,stringValue:null,timestamp:null});const m=d.filter(l),p=(0,n.difference)(d,u,m),g=(0,n.groupBy)(p,"name");return Object.keys(g).forEach((e=>{g[e]=(0,n.orderBy)(g[e],"timestamp","desc")})),{evaluationId:e.evaluation_id,requestId:e.request_id,inputs:e.inputs,inputsId:e.inputs_id,outputs:null!==(t=e.outputs)&&void 0!==t?t:{},targets:null!==(s=e.targets)&&void 0!==s?s:{},...e.error_code&&{errorCode:e.error_code},...e.error_message&&{errorMessage:e.error_message},overallAssessments:u,responseAssessmentsByName:g,metrics:o[e.evaluation_id]||{},retrievalChunks:c(e.outputs,e.targets,m)}}))}(y,E,h)}),[h,y,E]);return{requestError:p,isLoading:d&&o,isFetching:u&&o,data:b}},Qa="searchMlflowTraces",Ja=({queryClient:e})=>{e.invalidateQueries({queryKey:[Qa]})},Xa=({experimentId:e,runUuid:t,timeRange:s,otherRunUuid:n,filterByLoggedModelId:o,loggedModelId:a,sqlWarehouseId:r,disabled:i,networkFilters:l})=>{const d=(0,f.tz)(),u=tr(t,s,l,o),{data:c,isLoading:m,error:p}=er({locations:[{mlflow_experiment:{experiment_id:null!==e&&void 0!==e?e:""},type:"MLFLOW_EXPERIMENT"}],filter:u,loggedModelId:a,sqlWarehouseId:r,enabled:!i}),g=tr(n,s),{data:v,isLoading:h,error:E}=er({locations:[{mlflow_experiment:{experiment_id:null!==e&&void 0!==e?e:""},type:"MLFLOW_EXPERIMENT"}],filter:g,enabled:!i&&Boolean(n),loggedModelId:a,sqlWarehouseId:r}),b=(0,re.useMemo)((()=>!c||m||p||!c.length?[]:c.map((e=>it(e)))),[c,m,p]),S=(0,re.useMemo)((()=>{const e=h&&Boolean(n);return!v||e||E||!v.length?[]:v.map((e=>it(e)))}),[v,h,E,n]),A=(0,re.useMemo)((()=>Is(d,b||[],S||[])),[d,b,S]),x=(0,re.useMemo)((()=>{const e=new Map;return null===c||void 0===c||c.forEach((t=>{const s=t.trace_metadata;if(s){const n=s[Ft.sourceNameTag];n&&!e.has(n)&&e.set(n,{value:n,renderValue:()=>(0,y.Y)(Wt,{traceInfo:t,isComparing:!1,disableLinks:!0})})}})),{source:Array.from(e.values()).sort(((e,t)=>e.value.localeCompare(t.value)))}}),[c]),I=Ge(d,b||[],A,t,void 0,!0);return(0,re.useMemo)((()=>({assessmentInfos:A,allColumns:I,totalCount:b.length,isLoading:m&&!i,error:p,isEmpty:0===b.length,tableFilterOptions:x})),[A,I,m,p,b.length,x,i])},Za=({experimentId:e,currentRunDisplayName:t,runUuid:s,timeRange:n,searchQuery:o,filters:a,disabled:r,pageSize:i,limit:l,filterByLoggedModelId:d,tableSort:u,loggedModelId:c,sqlWarehouseId:m})=>{const{networkFilters:p,clientFilters:g}=(e=>e.reduce(((e,t)=>(t.column===Ie.ASSESSMENT?e.clientFilters.push(t):e.networkFilters.push(t),e)),{networkFilters:[],clientFilters:[]}))(a||[]),v=tr(s,n,p,d),f=sr(u),{data:h,isLoading:y,isFetching:E,error:b,refetch:S}=er({locations:[{mlflow_experiment:{experiment_id:null!==e&&void 0!==e?e:""},type:"MLFLOW_EXPERIMENT"}],filter:v,enabled:!r,pageSize:i,limit:l,orderBy:f,loggedModelId:c,sqlWarehouseId:m}),A=(0,re.useMemo)((()=>{if(h)return h.map((e=>({currentRunValue:it(e),otherRunValue:void 0})))}),[h]),x=(0,re.useMemo)((()=>{if(!A)return;if(!t||""===o&&0===(null===g||void 0===g?void 0:g.length))return A.reduce(((e,t)=>{var s;return null!==(s=t.currentRunValue)&&void 0!==s&&s.traceInfo&&e.push(t.currentRunValue.traceInfo),e}),[]);const e=g.map((e=>({assessmentName:e.key||"",filterValue:e.value,run:t})));return Da(A,e||[],o,t,void 0).reduce(((e,t)=>{var s;return null!==(s=t.currentRunValue)&&void 0!==s&&s.traceInfo&&e.push(t.currentRunValue.traceInfo),e}),[])}),[A,g,o,t]);return r?{data:[],isLoading:!1,isFetching:!1}:{data:x,isLoading:y,isFetching:E,error:b||void 0,refetchMlflowTraces:S}},er=({locations:e,filter:t,pageSize:s,limit:o,orderBy:a,loggedModelId:r,sqlWarehouseId:i,enabled:l,...d})=>(0,Nt.I)({staleTime:1/0,cacheTime:1/0,enabled:l,queryKey:[Qa,{experimentIds:(e||[]).map((e=>{var t;return null===(t=e.mlflow_experiment)||void 0===t?void 0:t.experiment_id})),filter:t,orderBy:a,loggedModelId:r,sqlWarehouseId:i}],queryFn:async({signal:l})=>{let d,u=[];const c=s||500,m=o||be();for(;u.length<m;){const s={locations:e,filter:t,max_results:c,order_by:a};r&&i&&(s.model_id=r,s.sql_warehouse_id=i),d&&(s.page_token=d);const o=await kt("ajax-api/3.0/mlflow/traces/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),signal:l});if(!o.ok)throw(0,Mt.Jg)(o);const m=await o.json(),p=m.traces;if((0,n.isNil)(p)||(u=u.concat(p)),d=m.next_page_token,!d)break}return u},...d}),tr=(e,t,s,n)=>{const o=[];if(e&&o.push(`request_metadata."mlflow.sourceRun" = '${e}'`),t){const e="attributes.timestamp_ms";t.startTime&&o.push(`${e} > ${t.startTime}`),t.endTime&&o.push(`${e} < ${t.endTime}`)}if(n&&o.push(`request_metadata."mlflow.modelId" = '${n}'`),s&&s.forEach((e=>{switch(e.column){case Ie.TAG:if(e.key){const t="tags",s=e.key.includes(".")||e.key.includes(" ")?`${t}.\`${e.key}\``:`${t}.${e.key}`;o.push(`${s} ${e.operator} '${e.value}'`)}break;case Ye:const t="attributes.execution_time_ms";o.push(`${t} ${e.operator} ${e.value}`);break;case Me:const s="attributes.status";o.push(`${s} = '${e.value}'`);break;case Ne:o.push(`request_metadata."mlflow.trace.user" = '${e.value}'`);break;case Le:o.push(`request_metadata."mlflow.sourceRun" = '${e.value}'`);break;case Ve:o.push(`request_metadata."mlflow.modelId" = '${e.value}'`);break;case Oe:o.push(`attributes.name ${e.operator} '${e.value}'`);break;case ke:o.push(`request_metadata."mlflow.source.name" ${e.operator} '${e.value}'`);break;default:e.column.startsWith(Ue)&&o.push(`request_metadata.${Qe(e.column)} ${e.operator} '${e.value}'`)}})),o.length>0)return o.join(" AND ")},sr=e=>{if(e)switch(e.key){case Ye:return["execution_time "+(e.asc?"ASC":"DESC")];case Re:return["timestamp "+(e.asc?"ASC":"DESC")];default:return[]}};var nr=s(13369);var or={name:"l8l8b8",styles:"white-space:nowrap;overflow:hidden;text-overflow:ellipsis"},ar={name:"l8l8b8",styles:"white-space:nowrap;overflow:hidden;text-overflow:ellipsis"};const rr=({id:e,item:t,options:s,query:n,onChange:o,placeholder:a,width:r,canSearchCustomValue:i})=>{const{theme:l}=(0,v.u)(),[d,u]=(0,re.useState)(""),c=(0,re.useMemo)((()=>{var e,t;return null!==(e=null!==(t=null===n||void 0===n?void 0:n.data)&&void 0!==t?t:s)&&void 0!==e?e:[]}),[null===n||void 0===n?void 0:n.data,s]),m=(0,re.useMemo)((()=>c.map((e=>e.value))),[c]);return(0,y.FD)(g.DialogCombobox,{componentId:"mlflow.evaluations_review.table_ui.filter_column",value:null!==t&&void 0!==t&&t.value?[t.value]:[],id:e,children:[(0,y.Y)(g.DialogComboboxTrigger,{withInlineLabel:!1,placeholder:a,renderDisplayedValue:()=>{var e;return null!==(e=null===t||void 0===t?void 0:t.renderValue())&&void 0!==e?e:""},width:r,allowClear:!1}),(0,y.Y)(g.DialogComboboxContent,{width:r,style:{zIndex:l.options.zIndexBase+100},loading:null===n||void 0===n?void 0:n.isLoading,children:(0,y.Y)(g.DialogComboboxOptionList,{children:(0,y.FD)(g.DialogComboboxOptionListSearch,{onSearch:e=>u(e),children:[c.map((e=>(0,y.Y)(g.DialogComboboxOptionListSelectItem,{value:e.value,onChange:o,checked:e.value===(null===t||void 0===t?void 0:t.value),css:or,children:e.renderValue()},e.value))),i&&d&&!m.includes(d)?(0,y.FD)(g.DialogComboboxOptionListSelectItem,{value:d,onChange:o,checked:d===(null===t||void 0===t?void 0:t.value),css:ar,children:['Use "',d,'"']},d):null]})})})]})};var ir={name:"833hqy",styles:"width:200px"};const lr=({index:e,tableFilter:t,assessmentInfos:s,onChange:n,experimentId:o,tableFilterOptions:a})=>{const r=(0,f.tz)(),{theme:i}=(0,v.u)(),l=`filter-value-${e}`,[d,u]=(0,re.useState)(t.value),c=(0,re.useCallback)((()=>{d!==t.value&&n({...t,value:d},e)}),[t,e,n,d]),m=ja(o),p=(0,re.useMemo)((()=>{var e,t;return{data:null===(e=m.runInfos)||void 0===e||null===(t=e.filter((e=>e.runUuid&&e.runName)))||void 0===t?void 0:t.map((e=>({value:e.runUuid,renderValue:()=>e.runName}))),isLoading:m.isLoading}}),[m]),g=((e,t=!1)=>{const s=["EXPERIMENT_MODEL_VERSIONS",e],{data:n,isLoading:o,error:a}=(0,Nt.I)({queryKey:s,queryFn:async()=>Dt("ajax-api/2.0/mlflow/logged-models/search","POST",{experiment_ids:[e]}),staleTime:1/0,cacheTime:1/0,enabled:!t,refetchOnMount:!1,retry:!1});return{data:null===n||void 0===n?void 0:n.models,isLoading:o,error:a||void 0}})(o),h=(0,re.useMemo)((()=>{var e;return{data:null===(e=g.data)||void 0===e?void 0:e.map((e=>({value:e.info.model_id,renderValue:()=>e.info.name}))),isLoading:g.isLoading}}),[g]),E=[{value:"IN_PROGRESS",renderValue:()=>r.formatMessage(Qt.IN_PROGRESS)},{value:"OK",renderValue:()=>r.formatMessage(Qt.OK)},{value:"ERROR",renderValue:()=>r.formatMessage(Qt.ERROR)}];var b,S;if(t.column===Le)return(0,y.Y)(rr,{id:l,item:null===(b=p.data)||void 0===b?void 0:b.find((e=>e.value===t.value)),query:p,onChange:s=>{n({...t,value:s},e)},placeholder:"Select run",width:200,canSearchCustomValue:!1});if(t.column===Ve)return(0,y.Y)(rr,{id:l,item:null===(S=h.data)||void 0===S?void 0:S.find((e=>e.value===t.value)),query:h,onChange:s=>{n({...t,value:s},e)},placeholder:"Select version",width:200,canSearchCustomValue:!1});if(t.column===Ie.ASSESSMENT){const o=s.find((e=>e.name===t.key));if(o&&"numeric"!==o.dtype&&"unknown"!==o.dtype){const s=Array.from(o.uniqueValues.values()).map((e=>({value:pe(e),renderValue:()=>x(r,i,o,e).content})));return(0,y.Y)(rr,{id:l,item:s.find((e=>e.value===pe(t.value))),options:s,onChange:s=>{n({...t,value:ce(s)},e)},placeholder:"Select",width:200,canSearchCustomValue:!1})}}if(t.column===Me)return(0,y.Y)(rr,{id:l,item:E.find((e=>e.value===t.value)),options:E,onChange:s=>{n({...t,value:s},e)},placeholder:"Select",width:200,canSearchCustomValue:!1});if(t.column===ke){const s=a.source;return(0,y.Y)(rr,{id:l,item:s.find((e=>e.value===t.value)),options:s,onChange:s=>{n({...t,value:s},e)},placeholder:"Select source",width:200,canSearchCustomValue:!1})}return(0,y.Y)(ve.I,{"aria-label":"Value",componentId:"mlflow.evaluations_review.table_ui.filter_value",id:l,placeholder:t.column===Ye?"Time in milliseconds":"Value",type:t.column===Ye?"number":"text",value:d,onChange:e=>{u(e.target.value)},onBlur:c,css:ir,disabled:t.column===Ie.ASSESSMENT})};const dr=[Ye,Me,Oe,Ne,Le,Ve,ke];var ur={name:"1fttcpj",styles:"display:flex;flex-direction:column"},cr={name:"1fttcpj",styles:"display:flex;flex-direction:column"},mr={name:"1fttcpj",styles:"display:flex;flex-direction:column"},pr={name:"833hqy",styles:"width:200px"},gr={name:"1fttcpj",styles:"display:flex;flex-direction:column"},vr={name:"1fttcpj",styles:"display:flex;flex-direction:column"},fr={name:"1duj7gx",styles:"align-self:flex-end"};const hr=({tableFilter:e,index:t,onChange:s,onDelete:n,assessmentInfos:o,experimentId:a,tableFilterOptions:r,allColumns:i})=>{const{column:l,operator:d,key:u}=e,{theme:c}=(0,v.u)(),m=(0,re.useMemo)((()=>o.filter((e=>"numeric"!==e.dtype)).map((e=>({value:e.name,renderValue:()=>e.displayName})))),[o]),h=(0,re.useMemo)((()=>{const e=i.filter((e=>dr.includes(e.id)||e.id.startsWith(Ue))).map((e=>({value:e.id,renderValue:()=>e.label})));return e.push({value:Ie.TAG,renderValue:()=>we[Ie.TAG]},{value:Ie.ASSESSMENT,renderValue:()=>we[Ie.ASSESSMENT]}),e}),[i]);return(0,y.Y)(y.FK,{children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",gap:c.spacing.sm},""),children:[(0,y.FD)("div",{css:ur,children:[(0,y.Y)(g.FormUI.Label,{htmlFor:`filter-column-${t}`,children:(0,y.Y)(f.sA,{id:"7HLhyL",defaultMessage:"Column"})}),(0,y.Y)(rr,{id:`filter-column-${t}`,item:h.find((e=>e.value===l)),options:h,onChange:e=>{e!==l&&s({column:e,operator:Ae.EQUALS,value:""},t)},placeholder:"Select column",width:160,canSearchCustomValue:!1})]}),l===Ie.ASSESSMENT&&(0,y.FD)("div",{css:cr,children:[(0,y.Y)(g.FormUI.Label,{htmlFor:`filter-key-${t}`,children:(0,y.Y)(f.sA,{id:"lK4Ay3",defaultMessage:"Name"})}),(0,y.Y)(rr,{id:`filter-key-${t}`,item:m.find((e=>e.value===u)),options:m,onChange:n=>{s({...e,key:n},t)},placeholder:"Select name",width:200,canSearchCustomValue:!1})]}),l===Ie.TAG&&(0,y.FD)("div",{css:mr,children:[(0,y.Y)(g.FormUI.Label,{htmlFor:`filter-key-${t}`,children:(0,y.Y)(f.sA,{id:"gST1At",defaultMessage:"Key"})}),(0,y.Y)(ve.I,{"aria-label":"Key",componentId:"mlflow.evaluations_review.table_ui.filter_key",id:"filter-key-"+t,type:"text",css:pr,placeholder:l===Ie.TAG?"Key":"Name",value:u,onChange:n=>{s({...e,key:n.target.value},t)}})]}),(0,y.FD)("div",{css:gr,children:[(0,y.Y)(g.FormUI.Label,{htmlFor:`filter-operator-${t}`,children:(0,y.Y)(f.sA,{id:"W6Sqio",defaultMessage:"Operator"})}),(0,y.Y)(g.SimpleSelect,{"aria-label":"Operator",componentId:"mlflow.evaluations_review.table_ui.filter_operator",id:"filter-operator-"+t,placeholder:"Select",width:100,contentProps:{style:{zIndex:c.options.zIndexBase+100}},value:""===l||l===Ye?d:"=",disabled:""!==l&&l!==Ye,onChange:n=>{s({...e,operator:n.target.value},t)},children:Object.values(Ae).map((e=>(0,y.Y)(g.SimpleSelectOption,{value:e,children:e},e)))})]}),(0,y.FD)("div",{css:vr,children:[(0,y.Y)(g.FormUI.Label,{htmlFor:`filter-value-${t}`,children:(0,y.Y)(f.sA,{id:"6JOLpj",defaultMessage:"Value"})}),(0,y.Y)(lr,{index:t,tableFilter:e,assessmentInfos:o,onChange:s,experimentId:a,tableFilterOptions:r})]}),(0,y.Y)("div",{css:fr,children:(0,y.Y)(v.B,{componentId:"mlflow.evaluations_review.table_ui.filter_delete_button",type:"tertiary",icon:(0,y.Y)(g.CloseSmallIcon,{}),onClick:n})})]})})};const yr=({filters:e,setFilters:t,assessmentInfos:s,experimentId:n,tableFilterOptions:o,allColumns:a,isMetadataLoading:r,metadataError:i})=>{const l=(0,f.tz)(),{theme:d}=(0,v.u)(),u=e.length>0,c=(0,re.useCallback)((()=>{t([])}),[t]);return(0,y.FD)(v.ax.Root,{componentId:ba,children:[(0,y.Y)(v.ax.Trigger,{asChild:!0,children:(0,y.Y)(v.B,{endIcon:(0,y.Y)(g.ChevronDownIcon,{}),componentId:"mlflow.evaluations_review.table_ui.filter_button",css:(0,p.AH)({border:u?`1px solid ${d.colors.actionDefaultBorderFocus} !important`:"",backgroundColor:u?`${d.colors.actionDefaultBackgroundHover} !important`:""},""),children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:d.spacing.sm,alignItems:"center"},""),children:[(0,y.Y)(g.FilterIcon,{}),l.formatMessage({id:"J961B2",defaultMessage:"Filters{numFilters}"},{numFilters:u?` (${e.length})`:""}),u&&(0,y.Y)(ve.X,{css:(0,p.AH)({fontSize:12,cursor:"pointer",color:d.colors.grey400,"&:hover":{color:d.colors.grey600}},""),onClick:()=>{c()}})]})})}),(0,y.Y)(v.ax.Content,{align:"start",css:(0,p.AH)({padding:d.spacing.md},""),children:i?(0,y.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:d.spacing.xs,padding:`${d.spacing.md}px`,color:d.colors.textValidationDanger},""),"data-testid":"filter-dropdown-error",children:[(0,y.Y)(v.l,{}),(0,y.Y)(f.sA,{id:"dJaboT",defaultMessage:"Fetching traces failed"})]}):r?(0,y.Y)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:d.spacing.xs,padding:`${d.spacing.md}px`,color:d.colors.textSecondary},""),"data-testid":"filter-dropdown-loading",children:(0,y.Y)(v.S,{size:"small"})}):(0,y.Y)(Sr,{filters:e,assessmentInfos:s,setFilters:t,experimentId:n,tableFilterOptions:o,allColumns:a})})]})};var Er={name:"skgbeu",styles:"display:flex;justify-content:flex-end"},br={name:"skgbeu",styles:"display:flex;justify-content:flex-end"};const Sr=({filters:e,assessmentInfos:t,setFilters:s,experimentId:n,tableFilterOptions:o,allColumns:a})=>{const{theme:r}=(0,v.u)(),i=(e=>(0,nr.mN)({defaultValues:{filters:e.length>0?e:[{column:"",operator:Ae.EQUALS,value:""}]}}))(e),{setValue:l,watch:d}=i,u=d("filters");return(0,y.Y)(nr.Op,{...i,children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:r.spacing.lg,overflow:"auto"},""),children:[(0,y.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:r.spacing.sm},""),children:u.map(((e,s)=>(0,y.Y)(hr,{tableFilter:e,index:s,onChange:e=>{u[s]=e,l("filters",u)},onDelete:()=>{const e=[...u];e.splice(s,1),0===e.length&&e.push({column:"",operator:Ae.EQUALS,value:""}),l("filters",e)},assessmentInfos:t,experimentId:n,tableFilterOptions:o,allColumns:a},e.column+e.operator+e.value+s)))}),(0,y.Y)("div",{children:(0,y.Y)(v.B,{componentId:"mlflow.evaluations_review.table_ui.add_filter_button",icon:(0,y.Y)(g.PlusIcon,{}),onClick:()=>{l("filters",[...u,{column:"",operator:Ae.EQUALS,value:""}])},children:(0,y.Y)(f.sA,{id:"cHgTsd",defaultMessage:"Add filter"})})}),(0,y.Y)("div",{css:Er,children:(0,y.Y)(v.B,{componentId:"mlflow.evaluations_review.table_ui.apply_filters_button",type:"primary",onClick:()=>s(u),css:br,children:(0,y.Y)(f.sA,{id:"iZ0M1Y",defaultMessage:"Apply filters"})})})]})})},Ar=e=>e===Ie.INFO?"Attributes":we[e],xr=({columns:e=[],selectedColumns:t=[],toggleColumns:s,setSelectedColumns:n,isMetadataLoading:o=!1,metadataError:a})=>{const r=(0,f.tz)(),{theme:i}=(0,v.u)(),[l,d]=(0,re.useState)(""),u=(0,re.useMemo)((()=>{const t=yt(e),s={};return t.forEach((e=>{var t;const n=null!==(t=e.group)&&void 0!==t?t:Ie.INFO;s[n]||(s[n]=[]),s[n].push(e)})),s}),[e]),c=(0,re.useMemo)((()=>{if(!l.trim())return u;const e=l.trim().toLowerCase(),t={};return Object.entries(u).forEach((([s,n])=>{const o=Ar(s).toLowerCase().includes(e),a=n.filter((t=>t.label.toLowerCase().includes(e)));(o||a.length)&&(t[s]=o?n:a)})),t}),[u,l]);return(0,y.FD)(g.DialogCombobox,{componentId:Sa,label:"Columns",multiSelect:!0,children:[(0,y.Y)(g.DialogComboboxCustomButtonTriggerWrapper,{children:(0,y.Y)(v.B,{endIcon:(0,y.Y)(g.ChevronDownIcon,{}),"data-testid":"column-selector-button",componentId:"mlflow.evaluations_review.table_ui.filter_button",children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:i.spacing.sm,alignItems:"center"},""),children:[(0,y.Y)(g.ColumnsIcon,{}),r.formatMessage({id:"wjOGl2",defaultMessage:"Columns"})]})})}),(0,y.Y)(g.DialogComboboxContent,{maxHeight:496,minWidth:300,maxWidth:500,loading:o&&!a,children:a?(0,y.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:i.spacing.xs,padding:`${i.spacing.md}px`,color:i.colors.textValidationDanger},""),"data-testid":"filter-dropdown-error",children:[(0,y.Y)(v.l,{}),(0,y.Y)(f.sA,{id:"dJaboT",defaultMessage:"Fetching traces failed"})]}):(0,y.Y)(g.DialogComboboxOptionList,{children:(0,y.Y)(g.DialogComboboxOptionListSearch,{controlledValue:l,setControlledValue:d,children:Object.entries(c).map((([e,o])=>(0,y.FD)(re.Fragment,{children:[(0,y.Y)(g.DialogComboboxSectionHeader,{children:Ar(e)}),(0,y.Y)(g.DialogComboboxOptionListCheckboxItem,{value:`all-${e}`,checked:o.every((e=>t.some((t=>t.id===e.id)))),onChange:()=>(e=>{if(e.every((e=>t.some((t=>t.id===e.id))))){const s=t.filter((t=>!e.some((e=>e.id===t.id))));n(s)}else{const s=[...t];e.forEach((e=>{s.some((t=>t.id===e.id))||s.push(e)})),n(s)}})(o),children:r.formatMessage({id:"RXL0a5",defaultMessage:"All {groupLabel}"},{groupLabel:Ar(e)})}),o.map((e=>(0,y.Y)(g.DialogComboboxOptionListCheckboxItem,{value:e.label,checked:t.some((t=>t.id===e.id)),onChange:()=>s([e]),children:e.label},e.id)))]},e)))})})})]})};var Ir={name:"1ykowef",styles:"margin-bottom:0"};const wr=re.memo((e=>{const{searchQuery:t,setSearchQuery:s,filters:n,setFilters:o,tableSort:a,setTableSort:r,selectedColumns:i,toggleColumns:l,setSelectedColumns:d,assessmentInfos:u,experimentId:c,traceInfos:m,tableFilterOptions:f,traceActions:h,allColumns:E,countInfo:b,isMetadataLoading:S,metadataError:A}=e,{theme:x}=(0,v.u)(),I=(0,re.useCallback)(((e,t)=>{r({key:e.key,type:e.type,asc:t})}),[r]);return(0,y.FD)("div",{css:(0,p.AH)({display:"flex",width:"100%",alignItems:"flex-end",justifyContent:"space-between",paddingBottom:`${x.spacing.xs}px`},""),children:[(0,y.FD)(g.TableFilterLayout,{css:Ir,children:[(0,y.Y)(ya,{searchQuery:t,setSearchQuery:s}),(0,y.Y)(yr,{filters:n,setFilters:o,assessmentInfos:u,experimentId:c,tableFilterOptions:f,allColumns:E,isMetadataLoading:S,metadataError:A}),(0,y.Y)(Ia,{tableSort:a,columns:i,onChange:I,enableGrouping:!0,isMetadataLoading:S,metadataError:A}),(0,y.Y)(xr,{columns:E,selectedColumns:i,toggleColumns:l,setSelectedColumns:d,isMetadataLoading:S,metadataError:A}),h&&(0,y.Y)(ut,{experimentId:c,traceActions:h,traceInfos:m})]}),(0,y.Y)(Nr,{countInfo:b})]})})),Nr=e=>{const{countInfo:t}=e,s=(0,f.tz)(),{theme:o}=(0,v.u)();return t.logCountLoading||(0,n.isNil)(t.currentCount)?(0,y.Y)(v.S,{size:"small"}):(0,y.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:o.spacing.sm},""),children:[t.currentCount>=t.maxAllowedCount&&(0,y.Y)(fe.T,{componentId:"mlflow.experiment_list_view.max_traces.tooltip",content:s.formatMessage({id:"BpAyCF",defaultMessage:"Only the top {evalResultsCount} results are shown"},{evalResultsCount:t.maxAllowedCount}),children:(0,y.Y)(v.W,{color:"warning"})}),(0,y.Y)(v.T.Hint,{children:s.formatMessage({id:"FnOQ44",defaultMessage:"{numFilteredEvals} of {numEvals}"},{numFilteredEvals:t.currentCount>=t.maxAllowedCount?t.maxAllowedCount:t.currentCount,numEvals:t.totalCount>=t.maxAllowedCount?`${t.maxAllowedCount}+`:t.totalCount})})]})};var Tr={name:"1is47tc",styles:"flex:1;overflow-y:hidden"};const Cr=re.memo((e=>{const{experimentId:t,currentTraceInfoV3:s,compareToTraceInfoV3:n,currentRunDisplayName:o,runUuid:a,compareToRunUuid:r,compareToRunDisplayName:i,setFilters:l,filters:d,selectedColumns:u,tableSort:c,assessmentInfos:m,getTrace:g,onTraceTagsEdit:f,allColumns:h,getRunColor:E,enableRowSelection:b=!0}=e,{theme:S}=(0,v.u)(),A=(0,re.useMemo)((()=>lt(s.map((e=>({evaluationId:e.trace_id,requestId:e.client_request_id||e.trace_id,inputsId:e.trace_id,inputs:{},outputs:{},targets:{},overallAssessments:[],responseAssessmentsByName:{},metrics:{},traceInfo:e}))))),[s]),x=(0,re.useMemo)((()=>lt((n||[]).map((e=>({evaluationId:e.trace_id,requestId:e.client_request_id||e.trace_id,inputsId:e.trace_id,inputs:{},outputs:{},targets:{},overallAssessments:[],responseAssessmentsByName:{},metrics:{},traceInfo:e}))))),[n]),[I,w]=(0,re.useState)({}),N=(0,re.useCallback)(((e,t,s)=>{const n=d.find((t=>t.column===Ie.ASSESSMENT&&t.key===e));void 0===n?l([...d,{column:Ie.ASSESSMENT,key:e,operator:Ae.EQUALS,value:t}]):n.value===t?l(d.filter((t=>!(t.column===Ie.ASSESSMENT&&t.key===e)))):l(d.map((s=>s.column===Ie.ASSESSMENT&&s.key===e?{column:Ie.ASSESSMENT,key:e,operator:Ae.EQUALS,value:t}:s)))}),[d,l]),T=(0,re.useMemo)((()=>d.filter((e=>e.column===Ie.ASSESSMENT)).map((e=>({assessmentName:e.key||"",filterValue:e.value,run:o||""})))),[d,o]),[C,_]=Ma(),R=(0,re.useMemo)((()=>ws(u.filter((e=>e.type===xe.ASSESSMENT)).map((e=>e.assessmentInfo)))),[u]),Y=(0,re.useMemo)((()=>At(A,x)),[A,x]),M=(0,re.useMemo)((()=>A.flatMap((e=>{var t,s;return null!==(t=null===e||void 0===e||null===(s=e.traceInfo)||void 0===s?void 0:s.assessments)&&void 0!==t?t:[]}))),[A]);return(0,y.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:S.spacing.xs,overflow:"hidden",flexGrow:1},""),children:(0,y.Y)("div",{css:(0,p.AH)({display:"flex",gap:S.spacing.md,width:"100%",flex:1,overflowY:"hidden"},""),children:(0,y.Y)("div",{css:Tr,children:(0,y.Y)(Se.AssessmentSchemaContextProvider,{assessments:M,children:(0,y.Y)(ha,{experimentId:t,selectedColumns:u,allColumns:h,evaluations:Y,selectedEvaluationId:C,selectedAssessmentInfos:R,assessmentInfos:m,assessmentFilters:T,onChangeEvaluationId:_,getRunColor:E,runUuid:a,compareToRunUuid:r,runDisplayName:o,compareToRunDisplayName:i,enableRowSelection:b,rowSelection:I,setRowSelection:w,toggleAssessmentFilter:N,tableSort:c,getTrace:g,onTraceTagsEdit:f,enableGrouping:!0})})})})})})),_r="filter",Rr=()=>{const[e,t]=le();return[(0,re.useMemo)((()=>{var t;return(null!==(t=e.getAll(_r))&&void 0!==t?t:[]).reduce(((e,t)=>{const[s,n,o,a]=t.split("::");if(!s||!n||!o)return e;const r=n;let i=o;return s===Ie.ASSESSMENT&&(i=ce(o)),e.push({column:s,key:a,operator:r,value:i}),e}),[])}),[e]),(0,re.useCallback)(((e,s=!1)=>{t((t=>(t.delete(_r),e&&e.forEach((e=>{let s=e.value;e.column===Ie.ASSESSMENT&&(s=pe(e.value)),t.append(_r,[e.column,e.operator,s,e.key].join("::"))})),t)),{replace:s})}),[t])]};var Yr=s(94026);const Mr=(e,t)=>t.filter((t=>!e.includes(t))).map((e=>e.id)),kr=(e,t)=>{let s=((e,t)=>t.filter((t=>!e.includes(t.id))))(e,t);if(s.length>10){const e=s.filter((e=>e.type===xe.ASSESSMENT)),t=s.filter((e=>e.type!==xe.ASSESSMENT)),n=s.length-10,o=Math.max(0,e.length-n);s=[...t,...e.slice(0,o)]}return Mr(s,t)},Dr=(e,t,s,n)=>{const[o,a]=(0,Yr.Mj)({key:`genaiTracesUIState-columns-${e}-${n}`,version:1,initialValue:void 0}),r=(0,re.useMemo)((()=>((e,t)=>kr(t?Mr(t(e),e):[Oe,ke,Ye,Me],e))(t,s)),[t,s]);return{hiddenColumns:(0,re.useMemo)((()=>{const e=new Set(r);return null!==o&&void 0!==o&&o.columnOverrides?(Object.entries(o.columnOverrides).forEach((([t,s])=>{s?e.delete(t):e.add(t)})),[...e]):r}),[o,r]),toggleColumns:(0,re.useCallback)((e=>{e.length&&a((t=>{var s;const n=null!==(s=null===t||void 0===t?void 0:t.columnOverrides)&&void 0!==s?s:{},o={...n};let a=!1;return e.forEach((e=>{const t=e.id in n?!n[e.id]:r.includes(e.id);o[e.id]!==t&&(o[e.id]=t,a=!0)})),a?{...t,columnOverrides:o}:t}))}),[a,r])}},Or=(e,t,s,o)=>{const{hiddenColumns:a,toggleColumns:r}=Dr(e,t,s,o),i=(0,re.useMemo)((()=>t.filter((e=>!a.includes(e.id)))),[t,a]),l=(0,re.useCallback)((e=>{if((0,n.isNil)(e))return;const s=new Set(e.map((e=>e.id))),o=[];t.forEach((e=>{!a.includes(e.id)!==s.has(e.id)&&o.push(e)})),o.length&&r(o)}),[t,a,r]);return{selectedColumns:i,toggleColumns:r,setSelectedColumns:l}}},43683:function(e,t,s){s.d(t,{Q:function(){return A}});var n=s(89555),o=s(9133),a=s(31014),r=s(16934),i=s(48443),l=s(68048),d=s(88464),u=s(88443),c=s(13369),m=s(50111);var p={name:"4zleql",styles:"display:block"};function g(e){return t=>function(e,t){const s=(0,d.A)(),{theme:i}=(0,r.u)(),u=e.props.searchValue.toLowerCase();return(0,a.useMemo)((()=>{if(!u)return e;if((0,o.sortedIndexOf)(t,u)>=0)return e;const r=/^[^,.:/=\-\s]+$/.test(u);return a.cloneElement(e,{flattenOptions:[{data:{value:u,disabled:!r,style:{color:r?i.colors.actionTertiaryTextDefault:i.colors.actionDisabledText},children:(0,m.Y)(l.LegacyTooltip,{title:r?void 0:s.formatMessage({id:"fWEvZL",defaultMessage:", . : / - = and blank spaces are not allowed"}),placement:"right",children:(0,m.FD)("span",{css:p,children:[(0,m.Y)(l.PlusIcon,{css:(0,n.AH)({marginRight:i.spacing.sm},"")}),s.formatMessage({id:"IJbauF",defaultMessage:'Add tag "{tagKey}"'},{tagKey:u})]})})},key:u,groupOption:!1},...e.props.flattenOptions]})}),[t,e,u,s,i])}(t,e)}var v={name:"1d3w5wq",styles:"width:100%"};function f({allAvailableTags:e,control:t,onKeyChangeCallback:s}){const n=(0,d.A)(),[o,r]=(0,a.useState)(!1),i=(0,a.useRef)(null),{field:u,fieldState:p}=(0,c.as)({control:t,name:"key",rules:{required:{message:n.formatMessage({id:"RlBbjb",defaultMessage:"A tag key is required"}),value:!0}}});return(0,m.Y)(l.LegacySelect,{allowClear:!0,ref:i,dangerouslySetAntdProps:{showSearch:!0,dropdownRender:g(e)},css:v,placeholder:n.formatMessage({id:"8ALhnh",defaultMessage:"Type a key"}),value:u.value,defaultValue:u.value,open:o,onDropdownVisibleChange:e=>{r(e)},filterOption:(e,t)=>null===t||void 0===t?void 0:t.value.toLowerCase().includes(e.toLowerCase()),onSelect:e=>{u.onChange(e),null===s||void 0===s||s(e)},onClear:()=>{u.onChange(void 0),null===s||void 0===s||s(void 0)},validationState:p.error?"error":void 0,children:e.map((e=>(0,m.Y)(l.LegacySelect.Option,{value:e,children:e},e)))})}var h=s(98597),y=s(52350);function E(e){return new Map(e.map((e=>[e.key,e])))}var b={name:"82a6rk",styles:"flex:1"},S={name:"82a6rk",styles:"flex:1"};const A=({onSuccess:e,saveTagsHandler:t,allAvailableTags:s,valueRequired:p=!1,title:g})=>{const v=(0,a.useRef)(),[A,x]=(0,a.useState)(""),{theme:w}=(0,r.u)(),[N,T]=(0,a.useState)(new Map),[C,_]=(0,a.useState)(new Map),[R,Y]=(0,a.useState)(!1),M=(0,c.mN)({defaultValues:{key:void 0,value:""}}),k=()=>Y(!1),D=(0,a.useCallback)((e=>{v.current=e,T(E(e.tags||[])),_(E(e.tags||[])),M.reset(),Y(!0)}),[M]),O=async()=>{v.current&&(x(""),H(!0),t(v.current,Array.from(N.values()),Array.from(C.values())).then((()=>{k(),null===e||void 0===e||e(),H(!1)})).catch((e=>{var t;H(!1),x(e instanceof y.s?null===(t=e.getUserVisibleError())||void 0===t?void 0:t.message:e.message)})))},F=(0,d.A)(),L=M.watch(),[V,H]=(0,a.useState)(!1),U=(0,a.useMemo)((()=>!(0,o.isEqual)((0,o.sortBy)(Array.from(N.values()),"key"),(0,o.sortBy)(Array.from(C.values()),"key"))),[N,C]),B=L.key||L.value,z=U&&B;return{EditTagsModal:(0,m.FD)(i.d,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_135",destroyOnClose:!0,visible:R,title:null!==g&&void 0!==g?g:(0,m.Y)(u.A,{id:"TBX+Gs",defaultMessage:"Add/Edit tags"}),onCancel:k,footer:(0,m.FD)(r.y,{children:[(0,m.Y)(r.B,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_147",dangerouslyUseFocusPseudoClass:!0,onClick:k,css:(0,n.AH)({marginRight:U?0:w.spacing.sm},""),children:F.formatMessage({id:"2a/rR8",defaultMessage:"Cancel"})}),z?(0,m.Y)(I,{formValues:L,isLoading:V,onSaveTask:O}):(0,m.Y)(l.LegacyTooltip,{title:U?void 0:F.formatMessage({id:"16onEc",defaultMessage:"Please add or remove one or more tags before saving"}),children:(0,m.Y)(r.B,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_174",dangerouslyUseFocusPseudoClass:!0,disabled:!U,loading:V,type:"primary",onClick:O,children:F.formatMessage({id:"801Xh4",defaultMessage:"Save tags"})})})]}),children:[(0,m.FD)("form",{onSubmit:M.handleSubmit((()=>{if(p&&!L.value.trim())return;const e=new Map(C);e.set(L.key,L),_(e),M.reset()})),css:(0,n.AH)({display:"flex",alignItems:"flex-end",gap:w.spacing.md},""),children:[(0,m.FD)("div",{css:(0,n.AH)({minWidth:0,display:"flex",gap:w.spacing.md,flex:1},""),children:[(0,m.FD)("div",{css:b,children:[(0,m.Y)(l.FormUI.Label,{htmlFor:"key",children:F.formatMessage({id:"crTWax",defaultMessage:"Key"})}),(0,m.Y)(f,{allAvailableTags:s||[],control:M.control,onKeyChangeCallback:e=>{var t;const s=e?C.get(e):void 0;M.setValue("value",null!==(t=null===s||void 0===s?void 0:s.value)&&void 0!==t?t:"")}})]}),(0,m.FD)("div",{css:S,children:[(0,m.Y)(l.FormUI.Label,{htmlFor:"value",children:p?F.formatMessage({id:"tHrp+A",defaultMessage:"Value"}):F.formatMessage({id:"4B8k46",defaultMessage:"Value (optional)"})}),(0,m.Y)(l.RHFControlledComponents.Input,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_223",name:"value",control:M.control,"aria-label":p?F.formatMessage({id:"tHrp+A",defaultMessage:"Value"}):F.formatMessage({id:"4B8k46",defaultMessage:"Value (optional)"}),placeholder:F.formatMessage({id:"FFe+Ug",defaultMessage:"Type a value"})})]})]}),(0,m.Y)(l.LegacyTooltip,{title:F.formatMessage({id:"tx3aAM",defaultMessage:"Add tag"}),children:(0,m.Y)(r.B,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_248",htmlType:"submit","aria-label":F.formatMessage({id:"tx3aAM",defaultMessage:"Add tag"}),children:(0,m.Y)(l.PlusIcon,{})})})]}),A&&(0,m.Y)(l.FormUI.Message,{type:"error",message:A}),(0,m.Y)("div",{css:(0,n.AH)({display:"flex",rowGap:w.spacing.xs,flexWrap:"wrap",marginTop:w.spacing.sm},""),children:Array.from(C.values()).map((e=>(0,m.Y)(h.t,{isClosable:!0,tag:e,onClose:()=>(({key:e})=>{_((t=>(t.delete(e),new Map(t))))})(e)},e.key)))})]}),showEditTagsModal:D,isLoading:V}};var x={name:"1y0ex1",styles:"max-width:400px"};function I({isLoading:e,formValues:t,onSaveTask:s}){const a=(0,d.A)(),{theme:i}=(0,r.u)(),l=`${`${(0,o.truncate)(t.key,{length:20})||"_"}`}${t.value?`:${(0,o.truncate)(t.value,{length:20})}`:""}`,u=a.formatMessage({id:"wcSVYI",defaultMessage:'Are you sure you want to save and close without adding "{tag}"'},{tag:l});return(0,m.FD)(r.ax.Root,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_309",children:[(0,m.Y)(r.ax.Trigger,{asChild:!0,children:(0,m.Y)(r.B,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_306",dangerouslyUseFocusPseudoClass:!0,loading:e,type:"primary",children:a.formatMessage({id:"801Xh4",defaultMessage:"Save tags"})})}),(0,m.FD)(r.ax.Content,{align:"end","aria-label":u,children:[(0,m.Y)(r.T.Paragraph,{css:x,children:u}),(0,m.Y)(r.ax.Close,{asChild:!0,children:(0,m.Y)(r.B,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_316",onClick:s,children:a.formatMessage({id:"mv6CY3",defaultMessage:"Yes, save and close"})})}),(0,m.Y)(r.ax.Close,{asChild:!0,children:(0,m.Y)(r.B,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_324",type:"primary",css:(0,n.AH)({marginLeft:i.spacing.sm},""),children:a.formatMessage({id:"geizp1",defaultMessage:"Cancel"})})}),(0,m.Y)(r.ax.Arrow,{})]})]})}},46932:function(e,t,s){s.d(t,{BS:function(){return d},CL:function(){return P},Hq:function(){return j},I$:function(){return B},LS:function(){return m},MF:function(){return w},N7:function(){return F},OS:function(){return Y},PC:function(){return V},Q0:function(){return D},W0:function(){return M},ZI:function(){return K},bn:function(){return O},f7:function(){return f},g_:function(){return R},h8:function(){return H},ij:function(){return u},in:function(){return $},jW:function(){return T},ob:function(){return N},tC:function(){return c},vL:function(){return v},vl:function(){return k},x0:function(){return z}});var n=s(89555),o=s(9133),a=s(48563),r=s(86494),i=s(96121),l=s(50111);const d="model-trace-info-v3",u=e=>{};function c(e){switch(e){case a.UG.LLM:return a.Dy.MODELS;case a.UG.CHAIN:return a.Dy.CHAIN;case a.UG.AGENT:return a.Dy.AGENT;case a.UG.TOOL:return a.Dy.WRENCH;case a.UG.CHAT_MODEL:return a.Dy.MODELS;case a.UG.RETRIEVER:return a.Dy.SEARCH;case a.UG.PARSER:return a.Dy.CODE;case a.UG.EMBEDDING:return a.Dy.NUMBERS;case a.UG.RERANKER:return a.Dy.SORT;case a.UG.MEMORY:return a.Dy.SAVE;case a.UG.FUNCTION:return a.Dy.FUNCTION;case a.UG.UNKNOWN:return a.Dy.UNKNOWN;default:return a.Dy.FUNCTION}}function m(e){switch(e){case a.UG.LLM:return"LLM";case a.UG.CHAIN:return"Chain";case a.UG.AGENT:return"Agent";case a.UG.TOOL:return"Tool";case a.UG.CHAT_MODEL:return"Chat model";case a.UG.RETRIEVER:return"Retriever";case a.UG.PARSER:return"Parser";case a.UG.EMBEDDING:return"Embedding";case a.UG.RERANKER:return"Reranker";case a.UG.MEMORY:return"Memory";case a.UG.FUNCTION:return"Function";case a.UG.UNKNOWN:return"Unknown";default:return e}}function p(e){try{return JSON.parse(e)}catch(t){return e}}const g=(e,t)=>{if(!t)return[];const s=[],n={inputs:null===e||void 0===e?void 0:e.inputs,outputs:null===e||void 0===e?void 0:e.outputs,attributes:null===e||void 0===e?void 0:e.attributes,events:null===e||void 0===e?void 0:e.events};return(0,o.map)(n,((n,o)=>{if("events"===o)return void s.push(...((e,t)=>{const s=e.events;if(!s)return[];const n=[];return s.forEach(((s,o)=>{const a=s.attributes;a&&Object.keys(a).forEach((r=>{const i=r.toLowerCase().includes(t),l=D(s.name,o,r);i&&n.push({span:e,section:"events",key:l,isKeyMatch:!0,matchIndex:0});const d=JSON.stringify(a[r]).toLowerCase().split(t).length-1;for(let t=0;t<d;t++)n.push({span:e,section:"events",key:l,isKeyMatch:!1,matchIndex:t})}))})),n})(e,t));R(n).forEach((n=>{n.key.toLowerCase().includes(t)&&s.push({span:e,section:o,key:n.key,isKeyMatch:!0,matchIndex:0});const a=n.value.toLowerCase().split(t).length-1;for(let t=0;t<a;t++)s.push({span:e,section:o,key:n.key,isKeyMatch:!1,matchIndex:t})}))})),s};function v(e,t,s){var n,o;const a=t.toLowerCase().trim(),r=Object.values(s.spanTypeDisplayState).every((e=>e));if(""===a&&r)return{filteredTreeNodes:[e],matches:[]};const i=null!==(n=e.children)&&void 0!==n?n:[],l=[],d=[];i.forEach((e=>{const{filteredTreeNodes:t,matches:n}=v(e,a,s);l.push(...t),d.push(...n)}));const u=(null!==(o=e.title)&&void 0!==o?o:"").toLowerCase(),c=g(e,a),m=c.length>0||u.includes(a),p=!e.type||s.spanTypeDisplayState[e.type],f=m&&p,h=l.length>0,y=F(e)>0;return f||s.showParents&&h||s.showExceptions&&y?{filteredTreeNodes:[{...e,children:l}],matches:c.concat(d)}:{filteredTreeNodes:l,matches:d}}function f(e,t){var s;if((0,o.isNil)(t)||(0,o.isNil)(e))return;if(e.key===t)return e;const n=null!==(s=e.children)&&void 0!==s?s:[];for(const o of n){const e=f(o,t);if(e)return e}}const h=(e,t,s,n,a,i)=>{var d,u,m,g,v,f,h,y;const E=p(null===(d=e.attributes)||void 0===d?void 0:d["mlflow.spanType"]),b=p(null===(u=e.attributes)||void 0===u?void 0:u["mlflow.spanInputs"]),w=p(null===(m=e.attributes)||void 0===m?void 0:m["mlflow.spanOutputs"]),N=A(e),T=S(e),C=null!==(g=a[T])&&void 0!==g?g:[];var _;N||C.push(...null!==(_=a[""])&&void 0!==_?_:[]);const R=((e,t,s,n)=>{var a,r;if(Array.isArray(e)&&e.every(B))return(0,o.compact)(e.map(K));const i=null!==(a=j(t,n))&&void 0!==a?a:[],l=null!==(r=j(s,n))&&void 0!==r?r:[];return 0!==i.length&&0!==l.length?i.concat(l):void 0})(p(null===(v=e.attributes)||void 0===v?void 0:v["mlflow.chat.messages"]),b,w,p(null===(f=e.attributes)||void 0===f?void 0:f["mlflow.message.format"])),Y=((e,t)=>{var s;return Array.isArray(e)&&e.every(V)?e:Array.isArray(null===t||void 0===t?void 0:t.tools)&&null!==t&&void 0!==t&&null!==(s=t.tools)&&void 0!==s&&s.every(V)?t.tools:void 0})(p(null===(h=e.attributes)||void 0===h?void 0:h["mlflow.chat.tools"]),b),M=(0,o.mapValues)((0,o.omitBy)(e.attributes,((e,t)=>t.startsWith("mlflow."))),(e=>p(e))),k=e.events,D=(Number(x(e))-t)/1e3,O=(Number(null!==(y=I(e))&&void 0!==y?y:s)-t)/1e3;return{title:e.name,icon:(0,l.Y)(r.P,{type:c(E),hasException:F(e)>0,isRootSpan:!N}),type:E,key:T,start:D,end:O,children:n,inputs:b,outputs:w,attributes:M,events:k,chatMessages:R,chatTools:Y,parentId:N,assessments:C,traceId:i}},y=(e,t)=>{if(!e)return"";if(t)try{return(e=>{const t=atob(e),s=t.length;let n="";for(let o=0;o<s;o++)n+=t.charCodeAt(o).toString(16).padStart(2,"0");return n})(e)}catch(s){return e}return e.startsWith("0x")?e.slice(2):e};function E(e){return"trace_metadata"in e}function b(e){return"start_time_unix_nano"in e}function S(e){var t,s,n;return b(e)?y(null!==(t=e.span_id)&&void 0!==t?t:"",!0):y(null!==(s=null===(n=e.context)||void 0===n?void 0:n.span_id)&&void 0!==s?s:"",!1)}function A(e){var t,s;return b(e)?y(null!==(t=e.parent_span_id)&&void 0!==t?t:"",!0):y(null!==(s=e.parent_id)&&void 0!==s?s:"",!1)}function x(e){return b(e)?Number(e.start_time_unix_nano):Number(e.start_time)}function I(e){return b(e)?Number(e.end_time_unix_nano):Number(e.end_time)}function w(e){var t;return E(e.info)?e.info.trace_id:null!==(t=e.info.request_id)&&void 0!==t?t:""}function N(e){var t,s;if(!E(e.info))return null;const n=Number(null===(t=e.info)||void 0===t||null===(s=t.trace_metadata)||void 0===s?void 0:s["mlflow.trace.sizeBytes"]);return(0,o.isNil)(n)||isNaN(n)?null:n}function T(e){var t,s;const n=w(e),i=null!==(t=null===(s=e.trace_data)||void 0===s?void 0:s.spans)&&void 0!==t?t:e.data.spans,d={},u={};i.forEach((e=>{const t=S(e);d[t]=e,u[t]=[]})),i.forEach((e=>{const t=S(e),s=A(e);if(s){if(!u[s])throw new Error("Tree structure is malformed!");u[s].push(t)}}));const m=i.find((e=>!A(e)));if((0,o.isNil)(m))return null;return function t(s){var o,i,p;const g=d[s],v=Number(x(m)),f=Number(I(m)),y=u[s].map(t),E=C(e.info);if(b(g)||"parent_id"in g)return h(g,v,f,y,E,n);const S=null!==(o=g.span_type)&&void 0!==o?o:a.UG.UNKNOWN;return{title:g.name,icon:(0,l.Y)(r.P,{type:c(S)}),type:S,key:g.context.span_id,start:Number(g.start_time)-v,end:Number(null!==(i=g.end_time)&&void 0!==i?i:f)-v,children:y,inputs:g.inputs,outputs:g.outputs,attributes:g.attributes,events:g.events,parentId:null!==(p=g.parent_id)&&void 0!==p?p:g.parent_span_id,assessments:[],traceId:n}}(S(m))}const C=e=>{let t=[];var s;E(e)?t=null!==(s=e.assessments)&&void 0!==s?s:[]:t=_(e.tags);const n=(0,o.keyBy)(t,"assessment_id");Object.values(n).forEach((e=>{if(e.overrides){const t=n[e.overrides];e.overriddenAssessment=t}})),t=Object.values(n);const a=t.reduce(((e,t)=>{var s;const n=null!==(s=t.span_id)&&void 0!==s?s:"";return e[n]||(e[n]=[]),e[n].push(t),e}),{});return Object.keys(a).forEach((e=>{a[e].sort(((e,t)=>new Date(t.last_update_time).getTime()-new Date(e.last_update_time).getTime()))})),a},_=e=>{if(!e)return[];return(Array.isArray(e)?e:Object.entries(e).map((([e,t])=>({key:e,value:t})))).filter((({key:e})=>e.startsWith("mlflow.assessment."))).map((({value:e})=>JSON.parse(e)))};const R=e=>(0,o.isNil)(e)?[]:Array.isArray(e)||(0,o.isString)(e)||(0,o.isNumber)(e)||(0,o.isBoolean)(e)?[{key:"",value:JSON.stringify(e,null,2)}]:Object.entries(e).map((([e,t])=>({key:e,value:JSON.stringify(t,null,2)}))),Y=({searchFilter:e,data:t,activeMatchBackgroundColor:s,inactiveMatchBackgroundColor:a,containsActiveMatch:r,activeMatch:i,scrollToActiveMatch:d})=>{const u=new RegExp(`(${(0,o.escapeRegExp)(e.trim())})`,"gi"),c=t.split(u),m=[];let p=0;for(let o=0;o<c.length;o++)if(c[o].toLowerCase().includes(e.toLowerCase().trim())){const e=r&&i.matchIndex===p,t=e?s:a,u=(0,l.Y)("span",{ref:e?d:null,css:(0,n.AH)({backgroundColor:t,scrollMarginTop:50},""),children:c[o]},o);p++,m.push(u)}else m.push(c[o]);return m},M=e=>(0,o.has)(e,"page_content"),k=e=>e.type===a.UG.RETRIEVER&&Array.isArray(e.outputs)&&e.outputs.length>0&&(0,o.every)(e.outputs,M),D=(e,t,s)=>`${e}-${t}-${s}`,O=e=>{var t;return(null!==(t=e.events)&&void 0!==t?t:[]).filter((e=>"exception"===e.name))},F=e=>O(e).length,L=e=>!(0,o.isNil)(e)&&(!(!(0,o.isNil)(e.type)&&!(0,o.isString)(e.type))&&(!(!(0,o.isNil)(e.description)&&!(0,o.isString)(e.description))&&!(!(0,o.isNil)(e.enum)&&!Array.isArray(e.enum)))),V=e=>{var t;if((0,o.isNil)(e)||"function"!==e.type||!(0,o.has)(e,"function.name"))return!1;const s=null===(t=e.function)||void 0===t?void 0:t.parameters;if(!(0,o.isNil)(s)){const e=s.required;if(!(0,o.isNil)(e)&&(!Array.isArray(e)||!e.every(o.isString)))return!1;const t=s.properties;if(!(0,o.isNil)(t)&&!Object.values(t).every(L))return!1}return!0},H=e=>{var t,s;return e&&(0,o.isString)(e.id)&&(0,o.isString)(null===(t=e.function)||void 0===t?void 0:t.arguments)&&(0,o.isString)(null===(s=e.function)||void 0===s?void 0:s.name)},U=e=>!(!(0,o.isNil)(e)&&!(0,o.isString)(e))||!!(0,o.isArray)(e)&&e.every((e=>(e=>{switch(e.type){case"text":case"input_text":case"output_text":return(0,o.isString)(e.text);case"image_url":const{image_url:t}=e;return!(0,o.isNil)(t)&&(0,o.isString)(t.url)&&((0,o.isNil)(t.detail)||["auto","low","high"].includes(t.detail));case"input_audio":const{input_audio:s}=e;return!(0,o.isNil)(s)&&(0,o.isString)(s.data)&&((0,o.isNil)(s.format)||["wav","mp3"].includes(s.format));default:return!1}})(e))),B=e=>{if(!e)return!1;if(e.tool_calls){if(!Array.isArray(e.tool_calls))return!1;if(!e.tool_calls.every(H))return!1}return"reasoning"===e.type||!!U(e.content)&&("user"===e.role||"assistant"===e.role||"system"===e.role||"tool"===e.role)},z=e=>Array.isArray(e)&&e.length>0&&e.every((e=>{return(0,o.has)(e,"message")&&(t=e.message,!!B(t)&&((0,o.isNil)(t.content)||(0,o.isString)(t.content)));var t})),$=e=>e&&z(e.choices),j=(e,t)=>{var s,n,a,r,l,d,u,c,m,p,g,v;try{if(Array.isArray(e)&&e.length>0&&e.every(B))return(0,o.compact)(e.map(K));switch(t){case"langchain":const t=null!==(s=(0,i.HD)(e))&&void 0!==s?s:(0,i.oI)(e);if(t)return t;break;case"llamaindex":const o=null!==(n=(0,i.Hy)(e))&&void 0!==n?n:(0,i.W3)(e);if(o)return o;break;case"openai":const f=null!==(a=null!==(r=null!==(l=(0,i.a8)(e))&&void 0!==l?l:(0,i.bS)(e))&&void 0!==r?r:(0,i.n_)(e))&&void 0!==a?a:(0,i.AG)(e);if(f)return f;break;case"dspy":const h=null!==(d=(0,i.iU)(e))&&void 0!==d?d:(0,i.Pn)(e);if(h)return h;break;case"gemini":const y=null!==(u=(0,i.DE)(e))&&void 0!==u?u:(0,i.Sy)(e);if(y)return y;break;case"anthropic":const E=null!==(c=(0,i.KF)(e))&&void 0!==c?c:(0,i.pL)(e);if(E)return E;break;case"openai-agent":const b=null!==(m=(0,i.xW)(e))&&void 0!==m?m:(0,i.m$)(e);if(b)return b;break;case"autogen":const S=null!==(p=(0,i.nW)(e))&&void 0!==p?p:(0,i.u6)(e);if(S)return S;break;case"bedrock":const A=null!==(g=(0,i.Yv)(e))&&void 0!==g?g:(0,i.f1)(e);if(A)return A;break;default:const x=null!==(v=(0,i.a8)(e))&&void 0!==v?v:(0,i.bS)(e);if(x)return x}return null}catch(f){return null}},P=e=>{var t;let s=null===(t=e.function)||void 0===t?void 0:t.arguments;try{s=JSON.stringify(JSON.parse(s),null,2)}catch(n){}return{id:e.id,function:{arguments:s,name:e.function.name}}},G=e=>{if((0,o.isNil)(e)||(0,o.isString)(e))return e;return e.map((e=>{var t;switch(e.type){case"text":case"input_text":case"output_text":return e.text;case"image_url":const s=null===e||void 0===e||null===(t=e.image_url)||void 0===t?void 0:t.url;return s?`![](${s})`:"[image]";case"input_audio":return"[audio]"}})).filter((e=>void 0!==e)).join("\n\n")},K=e=>{var t;return"reasoning"===e.type?null:{...e,content:G(e.content),tool_calls:null===(t=e.tool_calls)||void 0===t?void 0:t.map(P)}}},48563:function(e,t,s){s.d(t,{Dy:function(){return o},UG:function(){return n},VZ:function(){return a},cC:function(){return r}});let n=function(e){return e.LLM="LLM",e.CHAIN="CHAIN",e.AGENT="AGENT",e.TOOL="TOOL",e.FUNCTION="FUNCTION",e.CHAT_MODEL="CHAT_MODEL",e.RETRIEVER="RETRIEVER",e.PARSER="PARSER",e.EMBEDDING="EMBEDDING",e.RERANKER="RERANKER",e.MEMORY="MEMORY",e.UNKNOWN="UNKNOWN",e}({}),o=function(e){return e.MODELS="models",e.DOCUMENT="document",e.CONNECT="connect",e.SEARCH="search",e.SORT="sort",e.UNKNOWN="unknown",e.FUNCTION="function",e.CODE="code",e.NUMBERS="numbers",e.WRENCH="wrench",e.AGENT="agent",e.CHAIN="chain",e.USER="user",e.SYSTEM="system",e.SAVE="save",e}({}),a=function(e){return e.LLM="LLM",e.CHAIN="CHAIN",e.AGENT="AGENT",e.TOOL="TOOL",e.CHAT_MODEL="CHAT_MODEL",e.RETRIEVER="RETRIEVER",e.PARSER="PARSER",e.EMBEDDING="EMBEDDING",e.RERANKER="RERANKER",e.MEMORY="MEMORY",e.UNKNOWN="UNKNOWN",e}({}),r=function(e){return e.JSON="json",e.TEXT="text",e.MARKDOWN="markdown",e.PYTHON="python",e}({})},80870:function(e,t,s){s.d(t,{AssessmentSchemaContextProvider:function(){return r.I},ExpectationValuePreview:function(){return o.S},ModelTraceExplorer:function(){return n.a},ModelTraceExplorerSkeleton:function(){return a.F},ModelTraceSpanType:function(){return i.VZ}});var n=s(31814),o=s(15100),a=s(23684);s(31014),s(7450);s(46932);var r=s(80001),i=s(48563)},86443:function(e,t,s){s.d(t,{R:function(){return a},U:function(){return o}});var n=s(63528);async function o(e){var t;if(!e)return;const[s,o]=await Promise.all([n.x.getExperimentTraceInfoV3(e),n.x.getExperimentTraceData(e)]);return o?{info:(null===s||void 0===s||null===(t=s.trace)||void 0===t?void 0:t.trace_info)||{},data:o}:void 0}async function a(e){if(!e)return;const[t,s]=await Promise.all([n.x.getExperimentTraceInfo(e).then((e=>e.trace_info||{})),n.x.getExperimentTraceData(e)]);return s?{info:t,data:s}:void 0}},94026:function(e,t,s){s.d(t,{Mj:function(){return i.Mj},Ub:function(){return a},wY:function(){return r}});var n=s(31014),o=s(18930);function a(e){return function(e){return(0,o.useSyncExternalStore)(n.useCallback((t=>(e.addEventListener("change",t),()=>{e.removeEventListener("change",t)})),[e]),(()=>e.matches))}(n.useMemo((()=>window.matchMedia(e)),[e]))}function r({ref:e,debounceTimeMs:t}){const s=(0,n.useRef)({width:-1,height:-1}),o=(0,n.useRef)(),[a,r]=(0,n.useState)(null),i=(0,n.useCallback)((e=>{if(0===e.length)return;const n=e[0].contentRect;if(-1===s.current.width)return s.current={width:n.width,height:n.height},void r(s.current);if(n.width!==s.current.width||n.height!==s.current.height){if(s.current.width=n.width,s.current.height=n.height,!t)return void r({...s.current});clearTimeout(o.current),o.current=setTimeout((()=>{r({...s.current})}),t)}}),[t]),l=(0,n.useRef)();return l.current||(l.current=new ResizeObserver(i)),(0,n.useEffect)((()=>{const t="function"===typeof e?e():e.current;if(t){const e=l.current;return e.observe(t),()=>e.unobserve(t)}})),a}var i=s(91130)},98597:function(e,t,s){s.d(t,{t:function(){return f}});var n=s(89555),o=s(68048),a=s(16934),r=s(31014),i=s(88464),l=s(48443),d=s(56412),u=s(50111);const{Paragraph:c}=a.T;var m={name:"zjik7",styles:"display:flex"},p={name:"1ff36h2",styles:"flex-grow:1"};const g=r.memo((e=>{const{theme:t}=(0,a.u)();return(0,u.Y)(l.d,{componentId:"codegen_mlflow_app_src_common_components_keyvaluetagfullviewmodal.tsx_17",title:"Tag: "+e.tagKey,visible:e.isKeyValueTagFullViewModalVisible,onCancel:()=>e.setIsKeyValueTagFullViewModalVisible(!1),children:(0,u.FD)("div",{css:m,children:[(0,u.Y)(c,{css:p,children:(0,u.Y)("pre",{css:(0,n.AH)({backgroundColor:t.colors.backgroundPrimary,marginTop:t.spacing.sm,whiteSpace:"pre-wrap",wordBreak:"break-all"},""),children:e.tagValue})}),(0,u.Y)("div",{css:(0,n.AH)({marginTop:t.spacing.sm},""),children:(0,u.Y)(d.i,{copyText:e.tagValue,showLabel:!1,icon:(0,u.Y)(o.CopyIcon,{}),"aria-label":"Copy"})})]})})}));function v(e=!0){return e?{overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap",whiteSpace:"nowrap"}:{whiteSpace:"nowrap"}}const f=({isClosable:e=!1,onClose:t,tag:s,enableFullViewModal:l=!1,charLimit:d=30,maxWidth:c=300,className:m})=>{const p=(0,i.A)(),[f,h]=(0,r.useState)(!1),{shouldTruncateKey:y,shouldTruncateValue:E}=function(e,t=30){const{key:s,value:n}=e,o=s.length+n.length,a=s.length>n.length,r=a?n.length:s.length;return o<=t?{shouldTruncateKey:!1,shouldTruncateValue:!1}:r>t/2?{shouldTruncateKey:!0,shouldTruncateValue:!0}:{shouldTruncateKey:a,shouldTruncateValue:!a}}(s,d),b=l&&(y||E),S=p.formatMessage({id:"ZXUtU8",defaultMessage:"Click to see more"});return(0,u.FD)("div",{children:[(0,u.Y)(o.Tag,{componentId:"codegen_mlflow_app_src_common_components_keyvaluetag.tsx_60",closable:e,onClose:t,title:s.key,className:m,children:(0,u.Y)(o.LegacyTooltip,{title:b?S:"",children:(0,u.FD)("span",{css:(0,n.AH)({maxWidth:c,display:"inline-flex"},""),onClick:()=>b?h(!0):void 0,children:[(0,u.Y)(a.T.Text,{bold:!0,title:s.key,css:v(y),children:s.key}),s.value&&(0,u.FD)(a.T.Text,{title:s.value,css:v(E),children:[": ",s.value]})]})})}),(0,u.Y)("div",{children:f&&(0,u.Y)(g,{tagKey:s.key,tagValue:s.value,isKeyValueTagFullViewModalVisible:f,setIsKeyValueTagFullViewModalVisible:h})})]})}}}]);
//# sourceMappingURL=7816.b5c1abd2.chunk.js.map