{"version":3,"file":"static/js/1944.e48d5986.chunk.js","mappings":"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","sources":["shared/web-shared/errors/ErrorLogType.ts","shared/web-shared/errors/ErrorName.ts","shared/web-shared/errors/PredefinedErrors.tsx","shared/web-shared/model-trace-explorer/ModelTraceExplorer.utils.tsx","shared/web-shared/model-trace-explorer/ModelTrace.types.ts","shared/web-shared/model-trace-explorer/oss-notebook-renderer/mlflow-fetch-utils.ts","shared/web-shared/model-trace-explorer/oss-notebook-renderer/ModelTraceExplorerOSSNotebookRenderer.tsx","shared/web-shared/hooks/useResizeObserver.tsx","shared/web-shared/snippet/actions/SnippetActionButton.tsx","shared/web-shared/snippet/actions/SnippetCopyAction.tsx","shared/web-shared/snippet/index.tsx"],"sourcesContent":["export enum ErrorLogType {\n  UserInputError = 'UserInputError',\n  UnexpectedSystemStateError = 'UnexpectedSystemStateError',\n  ServerError = 'ServerError',\n  SessionError = 'SessionError',\n  NetworkError = 'NetworkError',\n  ApplicationError = 'ApplicationError',\n  UnknownError = 'UnknownError',\n}\n","export enum ErrorName {\n  BadRequestError = 'BadRequestError',\n  DatasetRunNotFoundError = 'DatasetRunNotFoundError',\n  FormValidationError = 'FormInputError',\n  GenericNetworkRequestError = 'GenericNetworkRequestError',\n  GraphQLGenericError = 'GraphQLGenericError',\n  InternalServerError = 'InternalServerError',\n  NotFoundError = 'NotFoundError',\n  PermissionError = 'PermissionError',\n  RateLimitedError = 'RateLimitedError',\n  RouteNotFoundError = 'RouteNotFoundError',\n  ServiceUnavailableError = 'ServiceUnavailableError',\n  UnauthorizedError = 'UnauthorizedError',\n  UnknownError = 'UnknownError',\n}\n","import { FormattedMessage } from 'react-intl';\n\n// eslint-disable-next-line no-restricted-imports\nimport type { ServerError } from '@apollo/client';\n\nimport { ErrorLogType } from './ErrorLogType';\nimport { ErrorName } from './ErrorName';\n\nexport type HandleableError = Error | string | Record<string, unknown> | PredefinedError | Response;\n\nexport type CausableError = Error | string | Record<string, unknown>;\n\nexport abstract class PredefinedError extends Error {\n  abstract errorLogType: ErrorLogType;\n  abstract errorName: ErrorName;\n  abstract displayMessage: React.ReactNode;\n  isUserError = false;\n\n  constructor(message?: string, cause?: CausableError) {\n    super(message);\n  }\n}\n\nexport const matchPredefinedError = (error: HandleableError) => {\n  if (error instanceof PredefinedError) {\n    return error;\n  }\n  if (error instanceof Error && ('networkError' in error || 'graphQLErrors' in error)) {\n    return matchPredefinedApolloError(error);\n  }\n\n  if (error instanceof Response) {\n    return matchPredefinedErrorFromResponse(error);\n  }\n\n  return new UnknownError(error);\n};\n\nexport function isServerError(e: unknown): e is ServerError {\n  return e instanceof Error && e.hasOwnProperty('response');\n}\n\nconst matchPredefinedApolloError = (error: Error) => {\n  // Some errors from Apollo mock provider may have `networkError` but are not `ServerError`\n  // only act on ServerError, which do have the response attached\n  if ('networkError' in error && isServerError(error.networkError)) {\n    return matchPredefinedErrorFromResponse(error.networkError.response, error.networkError);\n  }\n\n  return new GraphQLGenericError(error);\n};\n\nconst getNetworkRequestErrorDetailsFromResponse = (response: Response): NetworkRequestErrorDetails => {\n  const status = response.status;\n\n  return { status };\n};\n\nexport const matchPredefinedErrorFromResponse = (response: Response, originalError?: CausableError) => {\n  const errorDetails = NetworkRequestError.getNetworkRequestErrorDetailsFromResponse(response);\n  switch (response.status) {\n    case 400:\n      return new BadRequestError(errorDetails, originalError);\n    case 401:\n      return new UnauthorizedError(errorDetails, originalError);\n    case 403:\n      return new PermissionError(errorDetails, originalError);\n    case 404:\n      return new NotFoundError(errorDetails, originalError);\n    case 429:\n      return new RateLimitedError(errorDetails, originalError);\n    case 500:\n      return new InternalServerError(errorDetails, originalError);\n    case 503:\n      return new ServiceUnavailableError(errorDetails, originalError);\n    default:\n      return new GenericNetworkRequestError(errorDetails, originalError);\n  }\n};\n\ninterface NetworkRequestErrorDetails {\n  status?: number;\n  response?: Response;\n}\n\nexport abstract class NetworkRequestError extends PredefinedError {\n  status?: number;\n  response?: Response;\n\n  constructor(message: string, details: NetworkRequestErrorDetails, cause?: CausableError) {\n    super(message, cause);\n    this.status = details.status;\n    this.response = details.response;\n  }\n\n  static getNetworkRequestErrorDetailsFromResponse = getNetworkRequestErrorDetailsFromResponse;\n}\n\nexport class GenericNetworkRequestError extends NetworkRequestError {\n  errorLogType = ErrorLogType.ServerError;\n  errorName = ErrorName.GenericNetworkRequestError;\n  displayMessage = (\n    <FormattedMessage defaultMessage=\"A network error occurred.\" description=\"Generic message for a network error\" />\n  );\n\n  constructor(details: NetworkRequestErrorDetails, cause?: CausableError) {\n    const message = 'A network error occurred.';\n\n    super(message, details, cause);\n  }\n}\n\nexport class GraphQLGenericError extends PredefinedError {\n  errorLogType = ErrorLogType.ApplicationError;\n  errorName = ErrorName.GraphQLGenericError;\n  displayMessage = (\n    <FormattedMessage\n      defaultMessage=\"A GraphQL error occurred.\"\n      description=\"Generic message for a GraphQL error, typically due to query parsing or validation issues\"\n    />\n  );\n\n  constructor(cause?: CausableError) {\n    const message = 'A GraphQL error occurred.';\n\n    super(message, cause);\n  }\n}\n\nexport class BadRequestError extends NetworkRequestError {\n  errorLogType = ErrorLogType.UserInputError;\n  errorName = ErrorName.BadRequestError;\n  displayMessage = (\n    <FormattedMessage\n      defaultMessage=\"The request was invalid.\"\n      description=\"Bad request (HTTP STATUS 400) generic error message\"\n    />\n  );\n\n  constructor(details: NetworkRequestErrorDetails, cause?: CausableError) {\n    const message = 'The request was invalid.';\n\n    super(message, details, cause);\n  }\n}\n\nexport class InternalServerError extends NetworkRequestError {\n  errorLogType = ErrorLogType.ServerError;\n  errorName = ErrorName.InternalServerError;\n  displayMessage = (\n    <FormattedMessage\n      defaultMessage=\"Internal server error\"\n      description=\"Request failed due to internal server error (HTTP STATUS 500) generic error message\"\n    />\n  );\n\n  constructor(details: NetworkRequestErrorDetails, cause?: CausableError) {\n    const message = 'Internal server error';\n\n    super(message, details, cause);\n  }\n}\n\nexport class NotFoundError extends NetworkRequestError {\n  errorLogType = ErrorLogType.UserInputError;\n  errorName = ErrorName.NotFoundError;\n\n  displayMessage = (\n    <FormattedMessage\n      defaultMessage=\"The requested resource was not found.\"\n      description=\"Resource not found (HTTP STATUS 404) generic error message\"\n    />\n  );\n\n  isUserError = true;\n\n  constructor(details: NetworkRequestErrorDetails, cause?: CausableError) {\n    const message = 'The requested resource was not found.';\n\n    super(message, details, cause);\n  }\n}\n\nexport class PermissionError extends NetworkRequestError {\n  errorLogType = ErrorLogType.UnexpectedSystemStateError;\n  errorName = ErrorName.PermissionError;\n  displayMessage = (\n    <FormattedMessage\n      defaultMessage=\"You do not have permission to access this resource.\"\n      description=\"Generic message for a permission error (HTTP STATUS 403)\"\n    />\n  );\n  isUserError = true;\n\n  constructor(details: NetworkRequestErrorDetails, cause?: CausableError) {\n    const message = 'You do not have permission to access this resource.';\n\n    super(message, details, cause);\n  }\n}\n\nexport class RateLimitedError extends NetworkRequestError {\n  errorLogType = ErrorLogType.ServerError;\n  errorName = ErrorName.RateLimitedError;\n  displayMessage = (\n    <FormattedMessage\n      defaultMessage=\"This request exceeds the maximum queries per second limit. Please wait and try again.\"\n      description=\"Too many requests (HTTP STATUS 429) generic error message\"\n    />\n  );\n\n  constructor(details: NetworkRequestErrorDetails, cause?: CausableError) {\n    const message = 'This request exceeds the maximum queries per second limit. Please wait and try again.';\n\n    super(message, details, cause);\n  }\n}\n\nexport class ServiceUnavailableError extends NetworkRequestError {\n  errorLogType = ErrorLogType.ServerError;\n  errorName = ErrorName.InternalServerError;\n  displayMessage = (\n    <FormattedMessage\n      defaultMessage=\"Service unavailable error\"\n      description=\"Request failed due to service being available (HTTP STATUS 503) generic error message\"\n    />\n  );\n\n  constructor(details: NetworkRequestErrorDetails, cause?: CausableError) {\n    const message = 'Internal server error';\n\n    super(message, details, cause);\n  }\n}\n\nexport class UnauthorizedError extends NetworkRequestError {\n  errorLogType = ErrorLogType.SessionError;\n  errorName = ErrorName.UnauthorizedError;\n  displayMessage = (\n    <FormattedMessage\n      defaultMessage=\"User is not authorized.\"\n      description=\"Unauthorized (HTTP STATUS 401) generic error message\"\n    />\n  );\n\n  constructor(details: NetworkRequestErrorDetails, cause?: CausableError) {\n    const message = 'This request exceeds the maximum queries per second limit. Please wait and try again.';\n\n    super(message, details, cause);\n  }\n}\n\nexport class UnknownError extends PredefinedError {\n  errorLogType = ErrorLogType.UnknownError;\n  errorName = ErrorName.UnknownError;\n  displayMessage = (\n    <FormattedMessage defaultMessage=\"An unknown error occurred.\" description=\"Generic message for an unknown error\" />\n  );\n\n  constructor(cause?: CausableError) {\n    const message = 'An unknown error occurred.';\n\n    super(message, cause);\n  }\n}\n\nexport class FormValidationError extends PredefinedError {\n  errorLogType = ErrorLogType.UserInputError;\n  errorName = ErrorName.FormValidationError;\n  isUserError = true;\n  displayMessage = (\n    <FormattedMessage\n      defaultMessage=\"At least one form field has incorrect value. Please correct and try again.\"\n      description=\"Generic error message for an invalid form input\"\n    />\n  );\n\n  constructor(cause?: CausableError) {\n    const message = 'Incorrect form input.';\n\n    super(message, cause);\n  }\n}\n\n// have to be defined here to avoid circular dependencies\nexport class RouteNotFoundError extends PredefinedError {\n  errorLogType = ErrorLogType.UserInputError;\n  errorName = ErrorName.RouteNotFoundError;\n  isUserError = true;\n  displayMessage = (\n    <FormattedMessage\n      defaultMessage=\"Page not found\"\n      description=\"Error message shown to the user when they arrive at a non existent URL\"\n    />\n  );\n  constructor() {\n    super('Page not found');\n  }\n}\n","import {\n  isNil,\n  omitBy,\n  mapValues,\n  isArray,\n  isString,\n  isNumber,\n  isBoolean,\n  escapeRegExp,\n  map,\n  every,\n  has,\n  compact,\n  keyBy,\n} from 'lodash';\n\nimport { ModelSpanType, ModelIconType, MLFLOW_TRACE_SCHEMA_VERSION_KEY } from './ModelTrace.types';\nimport type {\n  SearchMatch,\n  ModelTrace,\n  ModelTraceSpan,\n  ModelTraceSpanNode,\n  ModelTraceChatMessage,\n  ModelTraceChatResponse,\n  ModelTraceChatInput,\n  ModelTraceToolCall,\n  ModelTraceChatTool,\n  ModelTraceChatToolParamProperty,\n  RawModelTraceChatMessage,\n  ModelTraceContentType,\n  SpanFilterState,\n  ModelTraceSpanV3,\n  ModelTraceSpanV2,\n  ModelTraceInfoV3,\n  Assessment,\n  RetrieverDocument,\n  ModelTraceEvent,\n} from './ModelTrace.types';\nimport { ModelTraceExplorerIcon } from './ModelTraceExplorerIcon';\nimport {\n  normalizeAnthropicChatInput,\n  normalizeAnthropicChatOutput,\n  normalizeAutogenChatInput,\n  normalizeAutogenChatOutput,\n  normalizeBedrockChatInput,\n  normalizeBedrockChatOutput,\n  normalizeGeminiChatInput,\n  normalizeGeminiChatOutput,\n  normalizeOpenAIChatInput,\n  normalizeOpenAIChatResponse,\n  normalizeOpenAIResponsesInput,\n  normalizeOpenAIResponsesOutput,\n  normalizeOpenAIAgentInput,\n  normalizeOpenAIAgentOutput,\n  normalizeLangchainChatInput,\n  normalizeLangchainChatResult,\n  normalizeLlamaIndexChatInput,\n  normalizeLlamaIndexChatResponse,\n  normalizeDspyChatInput,\n  normalizeDspyChatOutput,\n} from './chat-utils';\n\nexport const FETCH_TRACE_INFO_QUERY_KEY = 'model-trace-info-v3';\n\nexport const displayErrorNotification = (errorMessage: string) => {\n  // TODO: display error notification in OSS\n  return;\n};\n\nexport function getIconTypeForSpan(spanType: ModelSpanType | string): ModelIconType {\n  switch (spanType) {\n    case ModelSpanType.LLM:\n      return ModelIconType.MODELS;\n    case ModelSpanType.CHAIN:\n      return ModelIconType.CHAIN;\n    case ModelSpanType.AGENT:\n      return ModelIconType.AGENT;\n    case ModelSpanType.TOOL:\n      return ModelIconType.WRENCH;\n    case ModelSpanType.CHAT_MODEL:\n      return ModelIconType.MODELS;\n    case ModelSpanType.RETRIEVER:\n      return ModelIconType.SEARCH;\n    case ModelSpanType.PARSER:\n      return ModelIconType.CODE;\n    case ModelSpanType.EMBEDDING:\n      return ModelIconType.NUMBERS;\n    case ModelSpanType.RERANKER:\n      return ModelIconType.SORT;\n    case ModelSpanType.MEMORY:\n      return ModelIconType.SAVE;\n    case ModelSpanType.FUNCTION:\n      return ModelIconType.FUNCTION;\n    case ModelSpanType.UNKNOWN:\n      return ModelIconType.UNKNOWN;\n    default:\n      return ModelIconType.FUNCTION;\n  }\n}\n\nexport function getDisplayNameForSpanType(spanType: ModelSpanType | string): string {\n  switch (spanType) {\n    case ModelSpanType.LLM:\n      return 'LLM';\n    case ModelSpanType.CHAIN:\n      return 'Chain';\n    case ModelSpanType.AGENT:\n      return 'Agent';\n    case ModelSpanType.TOOL:\n      return 'Tool';\n    case ModelSpanType.CHAT_MODEL:\n      return 'Chat model';\n    case ModelSpanType.RETRIEVER:\n      return 'Retriever';\n    case ModelSpanType.PARSER:\n      return 'Parser';\n    case ModelSpanType.EMBEDDING:\n      return 'Embedding';\n    case ModelSpanType.RERANKER:\n      return 'Reranker';\n    case ModelSpanType.MEMORY:\n      return 'Memory';\n    case ModelSpanType.FUNCTION:\n      return 'Function';\n    case ModelSpanType.UNKNOWN:\n      return 'Unknown';\n    default:\n      return spanType;\n  }\n}\n\nexport function tryDeserializeAttribute(value: string): any {\n  try {\n    return JSON.parse(value);\n  } catch (e) {\n    return value;\n  }\n}\n\nexport const getMatchesFromEvent = (span: ModelTraceSpanNode, searchFilter: string): SearchMatch[] => {\n  const events = span.events;\n  if (!events) {\n    return [];\n  }\n\n  const matches: SearchMatch[] = [];\n  events.forEach((event, index) => {\n    const attributes = event.attributes;\n\n    if (!attributes) {\n      return;\n    }\n\n    Object.keys(attributes).forEach((attribute) => {\n      const isKeyMatch = attribute.toLowerCase().includes(searchFilter);\n      const key = getEventAttributeKey(event.name, index, attribute);\n\n      if (isKeyMatch) {\n        matches.push({\n          span,\n          section: 'events',\n          key,\n          isKeyMatch: true,\n          matchIndex: 0,\n        });\n      }\n\n      // event values can be arbitrary JSON\n      const value = JSON.stringify(attributes[attribute]).toLowerCase();\n      const numValueMatches = value.split(searchFilter).length - 1;\n      for (let i = 0; i < numValueMatches; i++) {\n        matches.push({\n          span,\n          section: 'events',\n          key,\n          isKeyMatch: false,\n          matchIndex: i,\n        });\n      }\n    });\n  });\n\n  return matches;\n};\n\n/**\n * This function extracts all the matches from a span based on the search filter,\n * and appends some necessary metadata that is necessary for the jump-to-search\n * function.\n */\nexport const getMatchesFromSpan = (span: ModelTraceSpanNode, searchFilter: string): SearchMatch[] => {\n  // if search filter is empty, don't generate matches\n  // because there will be nothing to highlight anyway\n  if (!searchFilter) {\n    return [];\n  }\n\n  const matches: SearchMatch[] = [];\n\n  const sections = {\n    inputs: span?.inputs,\n    outputs: span?.outputs,\n    attributes: span?.attributes,\n    events: span?.events,\n  };\n\n  map(sections, (section: any, label: 'inputs' | 'outputs' | 'attributes' | 'events') => {\n    if (label === 'events') {\n      matches.push(...getMatchesFromEvent(span, searchFilter));\n      return;\n    }\n\n    const sectionList = createListFromObject(section);\n    sectionList.forEach((item) => {\n      // NOTE: this ignores the fact that there might be multiple matches in a key\n      // for example, if the key is \"aaaaa\", and the search filter is \"a\". However,\n      // implementing support for this case would make the code needlessly complex.\n      // If we receive feedback that this is a problem, we can revisit this.\n      const isKeyMatch = item.key.toLowerCase().includes(searchFilter);\n      if (isKeyMatch) {\n        matches.push({\n          span: span,\n          section: label,\n          key: item.key,\n          isKeyMatch: true,\n          matchIndex: 0,\n        });\n      }\n\n      const numValueMatches = item.value.toLowerCase().split(searchFilter).length - 1;\n      for (let i = 0; i < numValueMatches; i++) {\n        matches.push({\n          span: span,\n          section: label,\n          key: item.key,\n          isKeyMatch: false,\n          matchIndex: i,\n        });\n      }\n    });\n  });\n  return matches;\n};\n\nexport function searchTree(\n  rootNode: ModelTraceSpanNode,\n  searchFilter: string,\n  spanFilterState: SpanFilterState,\n): {\n  filteredTreeNodes: ModelTraceSpanNode[];\n  matches: SearchMatch[];\n} {\n  const searchFilterLowercased = searchFilter.toLowerCase().trim();\n  const allSpanTypesSelected = Object.values(spanFilterState.spanTypeDisplayState).every(\n    (shouldDisplay) => shouldDisplay,\n  );\n  // if there is no search filter and all span types\n  // are selected, then we don't have to do any filtering.\n  if (searchFilterLowercased === '' && allSpanTypesSelected) {\n    return {\n      filteredTreeNodes: [rootNode],\n      matches: [],\n    };\n  }\n\n  const children = rootNode.children ?? [];\n  const filteredChildren: ModelTraceSpanNode[] = [];\n  const matches: SearchMatch[] = [];\n  children.forEach((child) => {\n    const { filteredTreeNodes: childNodes, matches: childMatches } = searchTree(\n      child,\n      searchFilterLowercased,\n      spanFilterState,\n    );\n\n    filteredChildren.push(...childNodes);\n    matches.push(...childMatches);\n  });\n\n  const spanName = ((rootNode.title as string) ?? '').toLowerCase();\n  const spanMatches = getMatchesFromSpan(rootNode, searchFilterLowercased);\n\n  // check if the span passes the text and type filters\n  const nodeMatchesSearch = spanMatches.length > 0 || spanName.includes(searchFilterLowercased);\n  const spanTypeIsDisplayed = rootNode.type ? spanFilterState.spanTypeDisplayState[rootNode.type] : true;\n  const nodePassesSpanFilters = nodeMatchesSearch && spanTypeIsDisplayed;\n\n  const hasMatchingChild = filteredChildren.length > 0;\n  const hasException = getSpanExceptionCount(rootNode) > 0;\n\n  const nodeShouldBeDisplayed =\n    nodePassesSpanFilters ||\n    // the `showParents` and `showExceptions` flags override the\n    // search filters, so we always show the node if they pass\n    (spanFilterState.showParents && hasMatchingChild) ||\n    (spanFilterState.showExceptions && hasException);\n\n  if (nodeShouldBeDisplayed) {\n    return {\n      filteredTreeNodes: [{ ...rootNode, children: filteredChildren }],\n      matches: spanMatches.concat(matches),\n    };\n  }\n\n  // otherwise cut the span out of the tree by returning the children directly\n  return {\n    filteredTreeNodes: filteredChildren,\n    matches,\n  };\n}\n\nexport function searchTreeBySpanId(\n  rootNode: ModelTraceSpanNode | null,\n  selectedSpanId?: string,\n): ModelTraceSpanNode | undefined {\n  if (isNil(selectedSpanId) || isNil(rootNode)) {\n    return undefined;\n  }\n\n  if (rootNode.key === selectedSpanId) {\n    return rootNode;\n  }\n\n  const children = rootNode.children ?? [];\n  for (const child of children) {\n    const matchedNode = searchTreeBySpanId(child, selectedSpanId);\n    if (matchedNode) {\n      return matchedNode;\n    }\n  }\n\n  return undefined;\n}\n\nconst getChatMessagesFromSpan = (\n  messagesAttributeValue: any,\n  inputs: any,\n  outputs: any,\n  messageFormat?: string,\n): ModelTraceChatMessage[] | undefined => {\n  // if the `mlflow.chat.messages` attribute is provided\n  // and in the correct format, return it as-is\n  // we allow content type to be content part list for the `mlflow.chat.messages` attribute\n  if (Array.isArray(messagesAttributeValue) && messagesAttributeValue.every(isRawModelTraceChatMessage)) {\n    return compact(messagesAttributeValue.map(prettyPrintChatMessage));\n  }\n\n  // otherwise, attempt to parse messages from inputs and outputs\n  // this is to support rich rendering for older versions of MLflow\n  // before the `mlflow.chat.messages` attribute was introduced\n  const messagesFromInputs = normalizeConversation(inputs, messageFormat) ?? [];\n  const messagesFromOutputs = normalizeConversation(outputs, messageFormat) ?? [];\n  // when either input or output is not chat messages, we do not set the chat message fiels.\n  if (messagesFromInputs.length === 0 || messagesFromOutputs.length === 0) {\n    return undefined;\n  }\n\n  return messagesFromInputs.concat(messagesFromOutputs);\n};\n\nconst getChatToolsFromSpan = (toolsAttributeValue: any, inputs: any): ModelTraceChatTool[] | undefined => {\n  // if the `mlflow.chat.tools` attribute is provided\n  // and in the correct format, return it as-is\n  if (Array.isArray(toolsAttributeValue) && toolsAttributeValue.every(isModelTraceChatTool)) {\n    return toolsAttributeValue;\n  }\n\n  // otherwise, attempt to parse tools from inputs\n  // TODO: support langchain format for tool inputs\n  if (Array.isArray(inputs?.tools) && inputs?.tools?.every(isModelTraceChatTool)) {\n    return inputs.tools;\n  }\n\n  return undefined;\n};\n\nexport const normalizeNewSpanData = (\n  span: ModelTraceSpan,\n  rootStartTime: number,\n  rootEndTime: number,\n  children: ModelTraceSpanNode[],\n  assessmentMap: Record<string, Assessment[]>,\n  traceId: string,\n): ModelTraceSpanNode => {\n  const spanType = tryDeserializeAttribute(span.attributes?.['mlflow.spanType']);\n  const inputs = tryDeserializeAttribute(span.attributes?.['mlflow.spanInputs']);\n  const outputs = tryDeserializeAttribute(span.attributes?.['mlflow.spanOutputs']);\n  const parentId = getModelTraceSpanParentId(span);\n  const spanId = getModelTraceSpanId(span);\n\n  const assessments = assessmentMap[spanId] ?? [];\n  if (!parentId) {\n    // assessments that are not associated with a specific\n    // span should be displayed at the root.\n    assessments.push(...(assessmentMap[''] ?? []));\n  }\n\n  // data that powers the \"chat\" tab\n  const messagesAttributeValue = tryDeserializeAttribute(span.attributes?.['mlflow.chat.messages']);\n  const messageFormat = tryDeserializeAttribute(span.attributes?.['mlflow.message.format']);\n  const chatMessages = getChatMessagesFromSpan(messagesAttributeValue, inputs, outputs, messageFormat);\n  const chatTools = getChatToolsFromSpan(tryDeserializeAttribute(span.attributes?.['mlflow.chat.tools']), inputs);\n\n  // remove other private mlflow attributes\n  const attributes = mapValues(\n    omitBy(span.attributes, (_, key) => key.startsWith('mlflow.')),\n    (value) => tryDeserializeAttribute(value),\n  );\n  const events = span.events;\n  const start = (Number(getModelTraceSpanStartTime(span)) - rootStartTime) / 1000;\n  const end = (Number(getModelTraceSpanEndTime(span) ?? rootEndTime) - rootStartTime) / 1000;\n\n  return {\n    title: span.name,\n    icon: (\n      <ModelTraceExplorerIcon\n        type={getIconTypeForSpan(spanType)}\n        hasException={getSpanExceptionCount(span) > 0}\n        isRootSpan={!parentId}\n      />\n    ),\n    type: spanType,\n    key: spanId,\n    start,\n    end,\n    children,\n    inputs,\n    outputs,\n    attributes,\n    events,\n    chatMessages,\n    chatTools,\n    parentId,\n    assessments,\n    traceId,\n  };\n};\n\nconst base64ToHex = (base64: string): string => {\n  const binaryString = atob(base64);\n  const binaryLen = binaryString.length;\n  let hex = '';\n  for (let i = 0; i < binaryLen; i++) {\n    const charCode = binaryString.charCodeAt(i);\n    hex += charCode.toString(16).padStart(2, '0');\n  }\n  return hex;\n};\n\n// mlflow span ids are meant to be interpreted as hex strings\nexport const decodeSpanId = (spanId: string | null | undefined, isV3Span: boolean): string => {\n  if (!spanId) {\n    return '';\n  }\n\n  if (isV3Span) {\n    // v3 span ids are base64 encoded\n    try {\n      return base64ToHex(spanId);\n    } catch (e) {\n      // if base64 decoding fails, just return the original spanId\n      return spanId;\n    }\n  }\n\n  // old V2 span ids (pre-March 2025) are in hex with a 0x prefix\n  if (spanId.startsWith('0x')) {\n    return spanId.slice(2);\n  }\n\n  // new V2 span ids have the prefix stripped\n  return spanId;\n};\n\nexport function isV3ModelTraceInfo(info: ModelTrace['info']): info is ModelTraceInfoV3 {\n  return 'trace_metadata' in info;\n}\n\nexport function isV3ModelTraceSpan(span: ModelTraceSpan): span is ModelTraceSpanV3 {\n  return 'start_time_unix_nano' in span;\n}\n\nexport function isV2ModelTraceSpan(span: ModelTraceSpan): span is ModelTraceSpanV2 {\n  return 'parent_id' in span;\n}\n\nexport function getModelTraceSpanId(span: ModelTraceSpan): string {\n  return isV3ModelTraceSpan(span)\n    ? decodeSpanId(span.span_id ?? '', true)\n    : decodeSpanId(span.context?.span_id ?? '', false);\n}\n\nexport function getModelTraceSpanParentId(span: ModelTraceSpan): string {\n  return isV3ModelTraceSpan(span)\n    ? decodeSpanId(span.parent_span_id ?? '', true)\n    : decodeSpanId(span.parent_id ?? '', false);\n}\n\nexport function getModelTraceSpanStartTime(span: ModelTraceSpan): number {\n  return isV3ModelTraceSpan(span) ? Number(span.start_time_unix_nano) : Number(span.start_time);\n}\n\nexport function getModelTraceSpanEndTime(span: ModelTraceSpan): number {\n  return isV3ModelTraceSpan(span) ? Number(span.end_time_unix_nano) : Number(span.end_time);\n}\n\nexport function getModelTraceId(trace: ModelTrace): string {\n  return isV3ModelTraceInfo(trace.info) ? trace.info.trace_id : trace.info.request_id ?? '';\n}\n\n// get the size of the trace in bytes, or null if the size is not available\nexport function getModelTraceSize(trace: ModelTrace): number | null {\n  if (!isV3ModelTraceInfo(trace.info)) {\n    return null;\n  }\n\n  const size = Number(trace.info?.trace_metadata?.['mlflow.trace.sizeBytes']);\n  return !isNil(size) && !isNaN(size) ? size : null;\n}\n\nexport function parseModelTraceToTree(trace: ModelTrace): ModelTraceSpanNode | null {\n  const traceId = getModelTraceId(trace);\n  const spans = trace.trace_data?.spans ?? trace.data.spans;\n  const spanMap: { [span_id: string]: ModelTraceSpan } = {};\n  const relationMap: { [span_id: string]: string[] } = {};\n\n  spans.forEach((span) => {\n    const spanId = getModelTraceSpanId(span);\n    spanMap[spanId] = span;\n    relationMap[spanId] = [];\n  });\n\n  spans.forEach((span) => {\n    const spanId = getModelTraceSpanId(span);\n    const parentId = getModelTraceSpanParentId(span);\n    if (parentId) {\n      if (!relationMap[parentId]) {\n        throw new Error('Tree structure is malformed!');\n      }\n      relationMap[parentId].push(spanId);\n    }\n  });\n\n  const rootSpan = spans.find((span) => !getModelTraceSpanParentId(span));\n  if (isNil(rootSpan)) {\n    return null;\n  }\n\n  const rootSpanId = getModelTraceSpanId(rootSpan);\n  function getSpanNodeFromData(span_id: string): ModelTraceSpanNode {\n    const span = spanMap[span_id];\n    // above we return if rootSpan is null, but for some\n    // reason typescript thinks it's still nullable here.\n    const rootStart = Number(getModelTraceSpanStartTime(rootSpan as ModelTraceSpan));\n    const rootEnd = Number(getModelTraceSpanEndTime(rootSpan as ModelTraceSpan));\n    const children = relationMap[span_id].map(getSpanNodeFromData);\n    const assessmentMap = getAssessmentMap(trace.info);\n\n    // not using `isV2Span` here because for legacy reasons,\n    // V1 and V2 are rolled into in the same type. \"parent_id\" is\n    // the way we distinguish between the two.\n    if (isV3ModelTraceSpan(span) || 'parent_id' in span) {\n      // reusing the same function for v2 and v3 as the changes are small\n      return normalizeNewSpanData(span, rootStart, rootEnd, children, assessmentMap, traceId);\n    }\n\n    // v1 spans\n    const spanType = span.span_type ?? ModelSpanType.UNKNOWN;\n    return {\n      title: span.name,\n      icon: <ModelTraceExplorerIcon type={getIconTypeForSpan(spanType)} />,\n      type: spanType as ModelSpanType,\n      key: span.context.span_id,\n      start: Number(span.start_time) - rootStart,\n      // default to the end of the root span if the span has no end time.\n      // this can happen if an exception was thrown in the span.\n      end: Number(span.end_time ?? rootEnd) - rootStart,\n      children: children,\n      inputs: span.inputs,\n      outputs: span.outputs,\n      attributes: span.attributes,\n      events: span.events,\n      parentId: span.parent_id ?? span.parent_span_id,\n      assessments: [],\n      traceId,\n    };\n  }\n\n  return getSpanNodeFromData(rootSpanId);\n}\n\n// returns a map of { [span_id: string] : Assessment[] }\nexport const getAssessmentMap = (traceInfo: ModelTrace['info']): Record<string, Assessment[]> => {\n  let assessments: Assessment[] = [];\n  if (isV3ModelTraceInfo(traceInfo)) {\n    assessments = traceInfo.assessments ?? [];\n  } else {\n    assessments = getAssessmentsFromTags(traceInfo.tags);\n  }\n\n  // hydrate the assessments with the overridden assessment objects\n  const assessmentsById = keyBy(assessments, 'assessment_id');\n  Object.values(assessmentsById).forEach((assessment) => {\n    if (assessment.overrides) {\n      const overriddenAssessment = assessmentsById[assessment.overrides];\n      assessment.overriddenAssessment = overriddenAssessment;\n    }\n  });\n\n  assessments = Object.values(assessmentsById);\n\n  // construct the map by reducing over the assessments\n  const assessmentMap = assessments.reduce((acc: Record<string, Assessment[]>, assessment: Assessment) => {\n    const spanId = assessment.span_id ?? '';\n    if (!acc[spanId]) {\n      acc[spanId] = [];\n    }\n    acc[spanId].push(assessment);\n    return acc;\n  }, {});\n\n  // sort the assessments by last_update_time\n  Object.keys(assessmentMap).forEach((spanId) => {\n    assessmentMap[spanId].sort(\n      (a, b) => new Date(b.last_update_time).getTime() - new Date(a.last_update_time).getTime(),\n    );\n  });\n\n  return assessmentMap;\n};\n\n// parses assessments out from the trace tags\nconst getAssessmentsFromTags = (tags: ModelTrace['info']['tags']): Assessment[] => {\n  if (!tags) {\n    return [];\n  }\n\n  const tagList = Array.isArray(tags) ? tags : Object.entries(tags).map(([key, value]) => ({ key, value }));\n\n  return tagList.filter(({ key }) => key.startsWith('mlflow.assessment.')).map(({ value }) => JSON.parse(value));\n};\n\n// this function attempts to extract the trace version from\n// a given source (either request_metadata or tags)\nexport function findTraceVersionByKey(\n  source: { [key: string]: string } | { key: string; value: string }[] | undefined,\n): string | undefined {\n  if (!source) {\n    return undefined;\n  }\n\n  if (isArray(source)) {\n    return source.find((tag) => tag.key === MLFLOW_TRACE_SCHEMA_VERSION_KEY)?.value;\n  }\n\n  return source[MLFLOW_TRACE_SCHEMA_VERSION_KEY];\n}\n\n// this function determines whether an object is a ModelTrace by asserting\n// that the object has the `data` and `info` fields, and that the\n// trace info contains the `mlflow.trace_schema.version` key\nexport const isModelTrace = (trace: any): trace is ModelTrace => {\n  const traceInfo = trace?.info;\n  const traceData = trace?.data;\n  if (!traceInfo || !traceData || !traceData?.spans) {\n    return false;\n  }\n\n  // request_metadata is for V2 traces, trace_metadata is for V3 traces\n  const metadata = traceInfo?.request_metadata ?? traceInfo?.trace_metadata;\n  if (metadata && findTraceVersionByKey(metadata)) {\n    return true;\n  }\n\n  const tags = traceInfo?.tags;\n  if (tags && findTraceVersionByKey(tags)) {\n    return true;\n  }\n\n  return false;\n};\n\nexport const createListFromObject = (\n  obj: { [key: string]: any } | string[] | string | boolean | number | undefined,\n) => {\n  if (isNil(obj)) {\n    return [];\n  }\n\n  if (Array.isArray(obj) || isString(obj) || isNumber(obj) || isBoolean(obj)) {\n    return [{ key: '', value: JSON.stringify(obj, null, 2) }];\n  }\n\n  return Object.entries(obj).map(([key, value]) => {\n    return { key, value: JSON.stringify(value, null, 2) };\n  });\n};\n\nexport const getHighlightedSpanComponents = ({\n  searchFilter,\n  data,\n  activeMatchBackgroundColor,\n  inactiveMatchBackgroundColor,\n  containsActiveMatch,\n  activeMatch,\n  scrollToActiveMatch,\n}: {\n  searchFilter: string;\n  data: string;\n  activeMatchBackgroundColor: string;\n  inactiveMatchBackgroundColor: string;\n  containsActiveMatch: boolean;\n  activeMatch: SearchMatch;\n  scrollToActiveMatch: (node: HTMLSpanElement) => void;\n}) => {\n  // splitting by regex retains the matches in the array,\n  // which makes it easier to handle stuff like preserving\n  // the original case of the match.\n  const regex = new RegExp(`(${escapeRegExp(searchFilter.trim())})`, 'gi');\n  const parts = data.split(regex);\n  const spans: React.ReactNode[] = [];\n  let matchIndex = 0;\n\n  for (let i = 0; i < parts.length; i++) {\n    if (parts[i].toLowerCase().includes(searchFilter.toLowerCase().trim())) {\n      const isActiveMatch = containsActiveMatch && activeMatch.matchIndex === matchIndex;\n      const backgroundColor = isActiveMatch ? activeMatchBackgroundColor : inactiveMatchBackgroundColor;\n      const span = (\n        <span ref={isActiveMatch ? scrollToActiveMatch : null} key={i} css={{ backgroundColor, scrollMarginTop: 50 }}>\n          {parts[i]}\n        </span>\n      );\n      matchIndex++;\n      spans.push(span);\n    } else {\n      spans.push(parts[i]);\n    }\n  }\n\n  return spans;\n};\n\nexport const isRetrieverDocument = (document: any): document is RetrieverDocument => {\n  return has(document, 'page_content');\n};\n\nexport const isRenderableRetrieverSpan = (span: ModelTraceSpanNode): boolean => {\n  return (\n    span.type === ModelSpanType.RETRIEVER &&\n    Array.isArray(span.outputs) &&\n    span.outputs.length > 0 &&\n    every(span.outputs, isRetrieverDocument)\n  );\n};\n\nexport const getEventAttributeKey = (name: string, index: number, attribute: string): string => {\n  return `${name}-${index}-${attribute}`;\n};\n\nexport const getSpanExceptionEvents = (span: ModelTraceSpanNode | ModelTraceSpan): ModelTraceEvent[] => {\n  return (span.events ?? []).filter((event) => event.name === 'exception');\n};\n\nexport const getSpanExceptionCount = (span: ModelTraceSpanNode | ModelTraceSpan): number => {\n  return getSpanExceptionEvents(span).length;\n};\n\nexport const isModelTraceChatToolParamProperty = (obj: any): obj is ModelTraceChatToolParamProperty => {\n  if (isNil(obj)) {\n    return false;\n  }\n\n  if (!isNil(obj.type) && !isString(obj.type)) {\n    return false;\n  }\n\n  if (!isNil(obj.description) && !isString(obj.description)) {\n    return false;\n  }\n\n  if (!isNil(obj.enum) && !Array.isArray(obj.enum)) {\n    return false;\n  }\n\n  return true;\n};\n\nexport const isModelTraceChatTool = (obj: any): obj is ModelTraceChatTool => {\n  if (isNil(obj) || obj.type !== 'function' || !has(obj, 'function.name')) {\n    return false;\n  }\n\n  // conditional validation for the `parameters` field\n  const parameters = obj.function?.parameters;\n  if (!isNil(parameters)) {\n    // if `required` is present, it must be a list of strings\n    const required = parameters.required;\n    if (!isNil(required) && (!Array.isArray(required) || !required.every(isString))) {\n      return false;\n    }\n\n    const properties = parameters.properties;\n    if (!isNil(properties) && !Object.values(properties).every(isModelTraceChatToolParamProperty)) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nexport const isModelTraceToolCall = (obj: any): obj is ModelTraceToolCall => {\n  return obj && isString(obj.id) && isString(obj.function?.arguments) && isString(obj.function?.name);\n};\n\nconst isContentPart = (part: any) => {\n  switch (part.type) {\n    case 'text':\n    case 'input_text':\n    case 'output_text':\n      return isString(part.text);\n    case 'image_url':\n      const { image_url } = part;\n      if (isNil(image_url)) {\n        return false;\n      }\n      return isString(image_url.url) && (isNil(image_url.detail) || ['auto', 'low', 'high'].includes(image_url.detail));\n    case 'input_audio':\n      const { input_audio } = part;\n      if (isNil(input_audio)) {\n        return false;\n      }\n      return isString(input_audio.data) && (isNil(input_audio.format) || ['wav', 'mp3'].includes(input_audio.format));\n    default:\n      return false;\n  }\n};\n\nconst isContentType = (content: any) => {\n  if (isNil(content) || isString(content)) {\n    return true;\n  }\n\n  if (isArray(content)) {\n    return content.every((part) => isContentPart(part));\n  }\n\n  return false;\n};\n\nexport const isModelTraceChatMessage = (message: any): message is ModelTraceChatMessage => {\n  if (!isRawModelTraceChatMessage(message)) {\n    return false;\n  }\n\n  return isNil(message.content) || isString(message.content);\n};\n\nexport const isRawModelTraceChatMessage = (message: any): message is RawModelTraceChatMessage => {\n  if (!message) {\n    return false;\n  }\n\n  if (message.tool_calls) {\n    if (!Array.isArray(message.tool_calls)) {\n      return false;\n    }\n\n    if (!message.tool_calls.every(isModelTraceToolCall)) {\n      return false;\n    }\n  }\n\n  if (message.type === 'reasoning') {\n    return true;\n  }\n\n  // verify if the message content is a valid content type or not\n  if (!isContentType(message.content)) {\n    return false;\n  }\n\n  return (\n    message.role === 'user' || message.role === 'assistant' || message.role === 'system' || message.role === 'tool'\n  );\n};\n\nexport const isModelTraceChatInput = (obj: any): obj is ModelTraceChatInput => {\n  return (\n    obj && Array.isArray(obj.messages) && obj.messages.length > 0 && obj.messages.every(isRawModelTraceChatMessage)\n  );\n};\n\nexport const isModelTraceChoices = (obj: any): obj is ModelTraceChatResponse['choices'] => {\n  return (\n    Array.isArray(obj) &&\n    obj.length > 0 &&\n    obj.every((choice: any) => has(choice, 'message') && isModelTraceChatMessage(choice.message))\n  );\n};\n\nexport const isModelTraceChatResponse = (obj: any): obj is ModelTraceChatResponse => {\n  return obj && isModelTraceChoices(obj.choices);\n};\n\n/**\n * Attempt to normalize a conversation, return null in case the format is unrecognized\n *\n * Supported formats:\n *   1. Langchain chat inputs\n *   2. Langchain chat results\n *   3. OpenAI ChatCompletions inputs\n *   4. OpenAI ChatCompletions responses\n *   5. OpenAI Responses inputs\n *   6. OpenAI Responses output\n *   7. LlamaIndex chat responses\n *   8. DSPy chat inputs\n *   8. DSPy chat outputs\n *   9. Gemini inputs\n *  10. Gemini outputs\n *  11. Anthropic inputs\n *  12. Anthropic outputs\n *  13. OpenAI Agent inputs\n *  14. OpenAI Agent outputs\n *  15. Autogen inputs\n *  16. Autogen outputs\n *  17. Bedrock inputs\n *  18. Bedrock outputs\n */\nexport const normalizeConversation = (input: any, messageFormat?: string): ModelTraceChatMessage[] | null => {\n  // wrap in try/catch to avoid crashing the UI. we're doing a lot of type coercion\n  // and formatting, and it's possible that we miss some edge cases. in case of an error,\n  // simply return null to signify that the input is not a chat input.\n  try {\n    // if the input is already in the correct format, return it\n    if (Array.isArray(input) && input.length > 0 && input.every(isRawModelTraceChatMessage)) {\n      return compact(input.map(prettyPrintChatMessage));\n    }\n\n    switch (messageFormat) {\n      case 'langchain':\n        const langchainMessages = normalizeLangchainChatInput(input) ?? normalizeLangchainChatResult(input);\n        if (langchainMessages) return langchainMessages;\n        break;\n      case 'llamaindex':\n        const llamaIndexMessages = normalizeLlamaIndexChatInput(input) ?? normalizeLlamaIndexChatResponse(input);\n        if (llamaIndexMessages) return llamaIndexMessages;\n        break;\n      case 'openai':\n        const openAIMessages =\n          normalizeOpenAIChatInput(input) ??\n          normalizeOpenAIChatResponse(input) ??\n          normalizeOpenAIResponsesOutput(input) ??\n          normalizeOpenAIResponsesInput(input);\n        if (openAIMessages) return openAIMessages;\n        break;\n      case 'dspy':\n        const dspyMessages = normalizeDspyChatInput(input) ?? normalizeDspyChatOutput(input);\n        if (dspyMessages) return dspyMessages;\n        break;\n      case 'gemini':\n        const geminiMessages = normalizeGeminiChatInput(input) ?? normalizeGeminiChatOutput(input);\n        if (geminiMessages) return geminiMessages;\n        break;\n      case 'anthropic':\n        const anthropicMessages = normalizeAnthropicChatInput(input) ?? normalizeAnthropicChatOutput(input);\n        if (anthropicMessages) return anthropicMessages;\n        break;\n      case 'openai-agent':\n        const openAIAgentMessages = normalizeOpenAIAgentInput(input) ?? normalizeOpenAIAgentOutput(input);\n        if (openAIAgentMessages) return openAIAgentMessages;\n        break;\n      case 'autogen':\n        const autogenMessages = normalizeAutogenChatInput(input) ?? normalizeAutogenChatOutput(input);\n        if (autogenMessages) return autogenMessages;\n        break;\n      case 'bedrock':\n        const bedrockMessages = normalizeBedrockChatInput(input) ?? normalizeBedrockChatOutput(input);\n        if (bedrockMessages) return bedrockMessages;\n        break;\n      default:\n        // Fallback to OpenAI chat format\n        const chatMessages = normalizeOpenAIChatInput(input) ?? normalizeOpenAIChatResponse(input);\n        if (chatMessages) return chatMessages;\n        break;\n    }\n    return null;\n  } catch (e) {\n    return null;\n  }\n};\n\nexport const prettyPrintToolCall = (toolCall: ModelTraceToolCall): ModelTraceToolCall => {\n  // add some spacing to the arguments for better readability\n  let args = toolCall.function?.arguments;\n  try {\n    args = JSON.stringify(JSON.parse(args), null, 2);\n  } catch (e) {\n    // use original args\n  }\n  return {\n    id: toolCall.id,\n    function: {\n      arguments: args,\n      name: toolCall.function.name,\n    },\n  };\n};\n\nconst formatChatContent = (content?: ModelTraceContentType | null): string | undefined | null => {\n  if (isNil(content) || isString(content)) {\n    return content;\n  }\n\n  const contentParts = content\n    // eslint-disable-next-line array-callback-return\n    .map((part) => {\n      switch (part.type) {\n        case 'text':\n        case 'input_text':\n        case 'output_text':\n          return part.text;\n        case 'image_url':\n          const url = part?.image_url?.url;\n          return url ? `![](${url})` : '[image]';\n        case 'input_audio':\n          // raw encoded audio content is not displayed in the UI\n          return '[audio]';\n      }\n    })\n    .filter((part) => part !== undefined);\n\n  // Join with double line breaks for better visual separation\n  return contentParts.join('\\n\\n');\n};\n\nexport const prettyPrintChatMessage = (message: RawModelTraceChatMessage): ModelTraceChatMessage | null => {\n  // TODO: support rich rendering of reasoning messages\n  // for now, just return null and compact it away in the caller\n  // this is because we want to still render the rest of the message\n  // outputs.\n  if (message.type === 'reasoning') {\n    return null;\n  }\n\n  return {\n    ...message,\n    content: formatChatContent(message.content),\n    tool_calls: message.tool_calls?.map(prettyPrintToolCall),\n  };\n};\n","import type { TimelineTreeNode } from './timeline-tree';\n\nexport const MLFLOW_TRACE_SCHEMA_VERSION_KEY = 'mlflow.trace_schema.version';\n\n// column name for mlflow trace data in inference tables\nexport const INFERENCE_TABLE_RESPONSE_COLUMN_KEY = 'response';\nexport const INFERENCE_TABLE_TRACE_COLUMN_KEY = 'trace';\n\nexport type ModelTraceExplorerRenderMode = 'default' | 'json';\n\nexport enum ModelSpanType {\n  LLM = 'LLM',\n  CHAIN = 'CHAIN',\n  AGENT = 'AGENT',\n  TOOL = 'TOOL',\n  FUNCTION = 'FUNCTION',\n  CHAT_MODEL = 'CHAT_MODEL',\n  RETRIEVER = 'RETRIEVER',\n  PARSER = 'PARSER',\n  EMBEDDING = 'EMBEDDING',\n  RERANKER = 'RERANKER',\n  MEMORY = 'MEMORY',\n  UNKNOWN = 'UNKNOWN',\n}\n\nexport enum ModelIconType {\n  MODELS = 'models',\n  DOCUMENT = 'document',\n  CONNECT = 'connect',\n  SEARCH = 'search',\n  SORT = 'sort',\n  UNKNOWN = 'unknown',\n  FUNCTION = 'function',\n  CODE = 'code',\n  NUMBERS = 'numbers',\n  WRENCH = 'wrench',\n  AGENT = 'agent',\n  CHAIN = 'chain',\n  USER = 'user',\n  SYSTEM = 'system',\n  SAVE = 'save',\n}\n\n/**\n * Represents a single model trace span.\n * Based on https://github.com/mlflow/mlflow/blob/tracing/mlflow/entities/span.py\n *\n * TODO: clean up all deprecated fields after PrPr customers swap over to\n *       the latest version of mlflow tracing\n */\nexport type ModelTraceSpanV2 = {\n  context: {\n    span_id: string;\n    trace_id: string;\n  };\n  name: string;\n  /* deprecated, renamed to `parent_id` */\n  parent_span_id?: string | null;\n  parent_id?: string | null;\n  /* deprecated, contained in attributes['mlflow.spanType'] */\n  span_type?: ModelSpanType | string;\n  /* deprecated, migrated to `status_code` and `status_message` */\n  status?: ModelTraceStatus;\n  status_code?: string;\n  status_message?: string | null;\n  start_time: number;\n  end_time: number;\n  /* deprecated, contained in attributes['mlflow.spanInputs'] */\n  inputs?: any;\n  /* deprecated, contained in attributes['mlflow.spanOutputs'] */\n  outputs?: any;\n  attributes?: Record<string, any>;\n  events?: ModelTraceEvent[];\n  /* metadata for ui usage logging */\n  type?: ModelSpanType;\n};\n\nexport type ModelTraceSpanV3 = {\n  trace_id: string;\n  span_id: string;\n  // can be empty\n  trace_state: string;\n  // can be empty or null\n  parent_span_id: string | null;\n  name: string;\n  start_time_unix_nano: string;\n  end_time_unix_nano: string;\n  status: {\n    code: ModelSpanStatusCode;\n    message?: string;\n  };\n  attributes: Record<string, any>;\n  events?: ModelTraceEvent[];\n  /* metadata for ui usage logging */\n  type?: ModelSpanType;\n};\n\nexport type ModelTraceSpan = ModelTraceSpanV2 | ModelTraceSpanV3;\n\nexport type ModelTraceEvent = {\n  name: string;\n  /* deprecated as of v3, migrated to `time_unix_nano` */\n  timestamp?: number;\n  time_unix_nano?: number;\n  attributes?: Record<string, any>;\n};\n\nexport type ModelTraceData = {\n  spans: ModelTraceSpan[];\n};\n\n/**\n * Represents a single model trace object.\n * Based on https://github.com/mlflow/mlflow/blob/8e44d102e9568d09d9dc376136d13a5a5d1ab46f/mlflow/tracing/types/model.py#L11\n */\nexport type ModelTrace = {\n  /* deprecated, renamed to `data` */\n  trace_data?: ModelTraceData;\n  /* deprecated, renamed to `info` */\n  trace_info?: ModelTraceInfo;\n  data: ModelTraceData;\n  info: ModelTraceInfoV3 | ModelTraceInfo | NotebookModelTraceInfo;\n};\n\n/**\n * Represents the trace data saved in an inference table.\n * https://github.com/databricks/universe/blob/fb8a572602161aa6387ac32593aa24a91518cc32/rag/serving/python/databricks/rag/unpacking/schemas.py#L133-L141\n */\nexport type ModelTraceInferenceTableData = {\n  app_version_id: string;\n  start_timestamp: string;\n  end_timestamp: string;\n  is_truncated: boolean;\n  [MLFLOW_TRACE_SCHEMA_VERSION_KEY]: number;\n  spans: (Omit<ModelTraceSpan, 'attributes'> & {\n    attributes: string;\n  })[];\n};\n\nexport type ModelTraceInfo = {\n  request_id?: string;\n  experiment_id?: string;\n  timestamp_ms?: number;\n  execution_time_ms?: number;\n  status?: ModelTraceStatus['description'];\n  attributes?: Record<string, any>;\n  request_metadata?: { key: string; value: string }[];\n  tags?: { key: string; value: string }[];\n};\n\n// tags and request_metadata in the notebook view\n// (i.e. displayed directly from the python client)\n// are stored as an object rather than an array.\nexport type NotebookModelTraceInfo = Omit<ModelTraceInfo, 'tags' | 'request_metadata'> & {\n  tags?: { [key: string]: string };\n  request_metadata?: { [key: string]: string };\n};\n\nexport type ModelTraceLocationMlflowExperiment = {\n  type: 'MLFLOW_EXPERIMENT';\n  mlflow_experiment: {\n    experiment_id: string;\n  };\n};\n\nexport type ModelTraceLocationInferenceTable = {\n  type: 'INFERENCE_TABLE';\n  inference_table: {\n    full_table_name: string;\n  };\n};\n\nexport type ModelTraceLocation = ModelTraceLocationMlflowExperiment | ModelTraceLocationInferenceTable;\n\nexport type ModelTraceInfoV3 = {\n  trace_id: string;\n  client_request_id?: string;\n  trace_location: ModelTraceLocation;\n  request_preview?: string;\n  response_preview?: string;\n  // timestamp in a format like \"2025-02-19T09:52:23.140Z\"\n  request_time: string;\n  // formatted duration string like \"32.4s\"\n  execution_duration: string;\n  state: ModelTraceState;\n  trace_metadata: {\n    [key: string]: string;\n  };\n  assessments: Assessment[];\n  tags: {\n    [key: string]: string;\n  };\n};\n\nexport type ModelTraceState = 'STATE_UNSPECIFIED' | 'OK' | 'ERROR' | 'IN_PROGRESS';\n\nexport type ModelSpanStatusCode = 'STATUS_CODE_UNSET' | 'STATUS_CODE_OK' | 'STATUS_CODE_ERROR';\n\nexport type ModelTraceStatusUnset = {\n  description: 'UNSET';\n  status_code: 0;\n};\n\nexport type ModelTraceStatusOk = {\n  description: 'OK';\n  status_code: 1;\n};\n\nexport type ModelTraceStatusError = {\n  description: 'ERROR';\n  status_code: 2;\n};\n\nexport type ModelTraceStatusInProgress = {\n  description: 'IN_PROGRESS';\n  status_code: 3;\n};\n\nexport enum ModelTraceSpanType {\n  LLM = 'LLM',\n  CHAIN = 'CHAIN',\n  AGENT = 'AGENT',\n  TOOL = 'TOOL',\n  CHAT_MODEL = 'CHAT_MODEL',\n  RETRIEVER = 'RETRIEVER',\n  PARSER = 'PARSER',\n  EMBEDDING = 'EMBEDDING',\n  RERANKER = 'RERANKER',\n  MEMORY = 'MEMORY',\n  UNKNOWN = 'UNKNOWN',\n}\n\nexport type ModelTraceStatus =\n  | ModelTraceStatusUnset\n  | ModelTraceStatusOk\n  | ModelTraceStatusError\n  | ModelTraceStatusInProgress;\n\n/**\n * Represents a single node in the model trace tree.\n */\nexport interface ModelTraceSpanNode extends TimelineTreeNode, Pick<ModelTraceSpan, 'attributes' | 'type' | 'events'> {\n  assessments: Assessment[];\n  inputs?: any;\n  outputs?: any;\n  children?: ModelTraceSpanNode[];\n  chatMessages?: ModelTraceChatMessage[];\n  chatTools?: ModelTraceChatTool[];\n  parentId?: string | null;\n  traceId: string;\n}\n\nexport type ModelTraceExplorerTab = 'chat' | 'content' | 'attributes' | 'events';\n\nexport type SearchMatch = {\n  span: ModelTraceSpanNode;\n  section: 'inputs' | 'outputs' | 'attributes' | 'events';\n  key: string;\n  isKeyMatch: boolean;\n  matchIndex: number;\n};\n\nexport type SpanFilterState = {\n  // always show parents regardless of filter state\n  showParents: boolean;\n  // always show exceptions regardless of filter state\n  showExceptions: boolean;\n  // record of span_type: whether to show it\n  spanTypeDisplayState: Record<string, boolean>;\n};\n\nexport interface RetrieverDocument {\n  metadata: {\n    doc_uri: string;\n    chunk_id: string;\n    [key: string]: any;\n  };\n  page_content: string;\n  [key: string]: any;\n}\n\nexport enum CodeSnippetRenderMode {\n  JSON = 'json',\n  TEXT = 'text',\n  MARKDOWN = 'markdown',\n  PYTHON = 'python',\n}\n\ntype ModelTraceTextContentPart = {\n  type: 'text' | 'input_text' | 'output_text';\n  text: string;\n};\n\ntype ModelTraceImageUrl = {\n  url: string;\n  detail?: 'auto' | 'low' | 'high';\n};\n\ntype ModelTraceImageContentPart = {\n  type: 'image_url';\n  image_url: ModelTraceImageUrl;\n};\n\ntype ModelTraceInputAudio = {\n  data: string;\n  format: 'wav' | 'mp3';\n};\n\ntype ModelTraceAudioContentPart = {\n  type: 'input_audio';\n  input_audio: ModelTraceInputAudio;\n};\n\nexport type ModelTraceContentParts =\n  | ModelTraceTextContentPart\n  | ModelTraceImageContentPart\n  | ModelTraceAudioContentPart;\n\nexport type ModelTraceContentType = string | ModelTraceContentParts[];\n\n// We treat content as string in the tracing UI.\nexport type ModelTraceChatMessage = {\n  role: 'system' | 'user' | 'assistant' | 'tool' | 'function' | 'developer';\n  name?: string;\n  content?: string | null;\n  tool_calls?: ModelTraceToolCall[];\n  tool_call_id?: string;\n};\n\n// The actual chat message schema of mlflow contains string, null and content part list.\nexport type RawModelTraceChatMessage = Omit<ModelTraceChatMessage, 'content'> & {\n  // there are other types, but we don't support them yet\n  type?: 'message' | 'reasoning';\n  content?: ModelTraceContentType | null;\n};\n\nexport type ModelTraceChatToolParamProperty = {\n  type?: string;\n  description?: string;\n  enum?: string[];\n};\n\nexport type ModelTraceChatTool = {\n  type: 'function';\n  function: {\n    name: string;\n    description?: string;\n    parameters?: {\n      properties: {\n        [key: string]: ModelTraceChatToolParamProperty;\n      };\n      required?: string[];\n    };\n  };\n};\n\nexport type ModelTraceToolCall = {\n  id: string;\n  function: {\n    arguments: string;\n    name: string;\n  };\n};\n\n// aligned to the OpenAI format\nexport type ModelTraceChatResponse = {\n  choices: {\n    message: ModelTraceChatMessage;\n  }[];\n};\n\nexport type ModelTraceChatInput = {\n  messages: RawModelTraceChatMessage[];\n};\n\nexport type AssessmentSourceType = 'SOURCE_TYPE_UNSPECIFIED' | 'HUMAN' | 'LLM_JUDGE' | 'CODE';\n\nexport interface AssessmentSource {\n  source_type: AssessmentSourceType;\n  // Identifier for the source. For example:\n  // - For a human source -> user name\n  // - For an LLM judge -> the judge source (databricks or custom)\n  // - For a code judge -> the function name\n  source_id: string;\n}\n\nexport interface AssessmentError {\n  error_code: string;\n  error_message?: string;\n  stack_trace?: string;\n}\n\nexport type AssessmentValue = string | number | boolean | null | string[];\n\nexport interface Feedback {\n  // can be null / undefined if error is present\n  value?: AssessmentValue;\n  error?: AssessmentError;\n}\n\nexport interface ExpectationValue {\n  value: AssessmentValue;\n}\n\nexport interface ExpectationSerializedValue {\n  serialized_value: {\n    value: string;\n    serialization_format: string;\n  };\n}\n\nexport type Expectation = ExpectationValue | ExpectationSerializedValue;\n\n// should be aligned with `mlflow/api/proto/service.proto`\nexport interface AssessmentBase {\n  assessment_id: string;\n  assessment_name: string;\n  trace_id: string;\n  source: AssessmentSource;\n  span_id?: string;\n\n  // the time fields are in the form of a string timestamp\n  // e.g. \"2025-04-18T04:01:20.159Z\"\n  create_time: string;\n  last_update_time: string;\n\n  rationale?: string;\n  metadata?: Record<string, string>;\n\n  // if false, the assessment is not valid and should not be displayed\n  // undefined and true should be considered valid.\n  valid?: boolean;\n\n  // the assessment_id of the assessment that this assessment overrides\n  overrides?: string;\n\n  // UI only field to store the overridden assessment object for easier display\n  overriddenAssessment?: Assessment;\n}\n\nexport interface FeedbackAssessment extends AssessmentBase {\n  feedback: Feedback;\n}\n\nexport interface ExpectationAssessment extends AssessmentBase {\n  expectation: Expectation;\n}\n\nexport type Assessment = FeedbackAssessment | ExpectationAssessment;\n","import type { ModelTrace, ModelTraceData } from '@databricks/web-shared/model-trace-explorer';\n\n// returns ModelTrace if the request is successful, otherwise returns an error message\nexport async function getTraceArtifact(requestId: string): Promise<ModelTrace | string> {\n  try {\n    // eslint-disable-next-line no-restricted-globals -- See go/spog-fetch\n    const result = await fetch(`/ajax-api/2.0/mlflow/get-trace-artifact?request_id=${requestId}`);\n    const text = await result.text();\n\n    const jsonData = JSON.parse(text);\n    // successful request containing span data\n    if (jsonData.spans) {\n      return {\n        info: {\n          request_id: requestId,\n        },\n        data: jsonData as ModelTraceData,\n      };\n    }\n\n    if (jsonData.error_code) {\n      return jsonData.message;\n    }\n\n    return 'Unknown error occurred';\n  } catch (e) {\n    if (e instanceof Error) {\n      return e.message;\n    }\n\n    if (typeof e === 'string') {\n      return e;\n    }\n\n    return 'Unknown error occurred';\n  }\n}\n","import { useState, useEffect, useMemo } from 'react';\n\nimport {\n  useDesignSystemTheme,\n  Typography,\n  Pagination,\n  Empty,\n  DangerIcon,\n  InfoTooltip,\n} from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\nimport { ModelTraceExplorer, getTraceArtifact } from '@databricks/web-shared/model-trace-explorer';\nimport type { ModelTrace } from '@databricks/web-shared/model-trace-explorer';\n\nconst MLFLOW_DOCS_URI = 'https://mlflow.org/docs/latest/llms/tracing/index.html?ref=jupyter-notebook-widget';\n\nconst getMlflowUILinkForTrace = (traceId: string, experimentId: string) => {\n  const queryParams = new URLSearchParams();\n  queryParams.append('selectedTraceId', traceId);\n  queryParams.append('compareRunsMode', 'TRACES');\n  return `/#/experiments/${experimentId}?${queryParams.toString()}`;\n};\n\nexport const ModelTraceExplorerOSSNotebookRenderer = () => {\n  const traceIds = useMemo(() => new URLSearchParams(window.location.search).getAll('trace_id'), []);\n  const experimentIds = useMemo(() => new URLSearchParams(window.location.search).getAll('experiment_id'), []);\n\n  const [activeTraceIndex, setActiveTraceIndex] = useState(traceIds.length > 0 ? 0 : null);\n  const [traceData, setTraceData] = useState<ModelTrace | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const { theme } = useDesignSystemTheme();\n\n  useEffect(() => {\n    const fetchTraceData = async () => {\n      if (activeTraceIndex === null) {\n        return;\n      }\n\n      setIsLoading(true);\n      const activeTraceId = traceIds[activeTraceIndex];\n      const data = await getTraceArtifact(activeTraceId);\n\n      if (typeof data === 'string') {\n        setError(data);\n      } else {\n        setTraceData(data);\n      }\n\n      setIsLoading(false);\n    };\n\n    fetchTraceData();\n  }, [activeTraceIndex, traceIds]);\n\n  if (traceIds.length === 0 || activeTraceIndex === null) {\n    return null;\n  }\n\n  if (isLoading) {\n    return (\n      <div css={{ width: 'calc(100% - 2px)' }}>\n        <Typography.Text color=\"secondary\">\n          <FormattedMessage\n            defaultMessage=\"Fetching trace data...\"\n            description=\"MLflow trace notebook output > loading state\"\n          />\n        </Typography.Text>\n      </div>\n    );\n  }\n\n  // some error occured\n  if (!traceData) {\n    return (\n      <div css={{ paddingTop: theme.spacing.md, width: 'calc(100% - 2px)' }}>\n        <Empty\n          image={<DangerIcon />}\n          description={\n            <>\n              <Typography.Paragraph>\n                <FormattedMessage\n                  defaultMessage=\"An error occurred while attempting to fetch trace data (ID: {traceId}). Please ensure that the MLflow tracking server is running, and that the trace data exists. Error details:\"\n                  description=\"An error message explaining that an error occured while fetching trace data\"\n                  values={{ traceId: traceIds[activeTraceIndex] }}\n                />\n              </Typography.Paragraph>\n              {error && <Typography.Paragraph>{error}</Typography.Paragraph>}\n            </>\n          }\n          title={\n            <FormattedMessage defaultMessage=\"Error\" description=\"MLflow trace notebook output > error state title\" />\n          }\n        />\n      </div>\n    );\n  }\n\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexDirection: 'column',\n        border: `1px solid ${theme.colors.border}`,\n        // -2px to prevent bottom border from being cut off\n        height: 'calc(100% - 2px)',\n      }}\n    >\n      <div\n        css={{\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'space-between',\n          padding: `${theme.spacing.xs}px ${theme.spacing.md}px`,\n        }}\n      >\n        <div\n          css={{\n            display: 'flex',\n            alignItems: 'center',\n            gap: theme.spacing.sm,\n          }}\n        >\n          <Typography.Title level={4} withoutMargins>\n            MLflow Trace UI\n          </Typography.Title>\n          <InfoTooltip\n            componentId=\"mlflow.notebook.trace-ui-info\"\n            iconTitle=\"More information\"\n            maxWidth={400}\n            content={\n              <FormattedMessage\n                defaultMessage=\"To disable or enable this display, call {disableFunction} or {enableFunction} and re-run the cell\"\n                description=\"Content in an info popover that instructs the user on how to disable the display. The disable and enable functions are code snippets with the real function names\"\n                values={{\n                  disableFunction: <code>mlflow.tracing.disable_notebook_display()</code>,\n                  enableFunction: <code>mlflow.tracing.enable_notebook_display()</code>,\n                }}\n              />\n            }\n          />\n          <Typography.Link\n            componentId=\"mlflow.notebook.trace-ui-learn-more-link\"\n            href={MLFLOW_DOCS_URI}\n            openInNewTab\n            title=\"Learn More\"\n          >\n            <FormattedMessage\n              defaultMessage=\"Learn More\"\n              description=\"Link to MLflow documentation for more information on MLflow tracing\"\n            />\n          </Typography.Link>\n        </div>\n        <Typography.Link\n          componentId=\"mlflow.notebook.trace-ui-see-in-mlflow-link\"\n          href={getMlflowUILinkForTrace(traceIds[activeTraceIndex], experimentIds[activeTraceIndex])}\n          openInNewTab\n          title=\"View in MLflow UI\"\n        >\n          <FormattedMessage\n            defaultMessage=\"View in MLflow UI\"\n            description=\"Link to the MLflow UI for an alternate view of the current trace\"\n          />\n        </Typography.Link>\n      </div>\n      {traceIds.length > 1 && (\n        <Pagination\n          componentId=\"mlflow.notebook.pagination\"\n          currentPageIndex={activeTraceIndex + 1}\n          dangerouslySetAntdProps={{\n            showQuickJumper: true,\n          }}\n          numTotal={traceIds.length}\n          onChange={(index) => setActiveTraceIndex(index - 1)}\n          pageSize={1}\n          style={{ marginBottom: theme.spacing.sm, paddingLeft: theme.spacing.sm, paddingRight: theme.spacing.sm }}\n        />\n      )}\n      <div css={{ flex: 1, overflow: 'hidden' }}>\n        <ModelTraceExplorer modelTrace={traceData} initialActiveView=\"detail\" />\n      </div>\n    </div>\n  );\n};\n","import { type RefObject, useRef, useCallback, useEffect, useState } from 'react';\n\ntype ResizeObserverOptions<ElementType extends Element> = {\n  /**\n   * The element to watch for size changes. Can either pass a ref object or a function that when called will return the element to be watched\n   */\n  ref: RefObject<ElementType | null> | (() => ElementType | null);\n  /**\n   * Optionally debounces state updates, to prevent rerendering on every single resize\n   */\n  debounceTimeMs?: number;\n};\n\nexport function useResizeObserver<ElementType extends Element>({\n  ref: rootRef,\n  debounceTimeMs,\n}: ResizeObserverOptions<ElementType>): { width: number; height: number } | null {\n  const prevSize = useRef<{ width: number; height: number }>({ width: -1, height: -1 });\n  const debounceRef = useRef<ReturnType<typeof setTimeout>>();\n  const [size, setSize] = useState<{ width: number; height: number } | null>(null);\n\n  const onResize = useCallback(\n    (entries: ResizeObserverEntry[]) => {\n      if (entries.length === 0) {\n        return;\n      }\n\n      const rect = entries[0].contentRect;\n      if (prevSize.current.width === -1) {\n        // First update, just set size immediately\n        prevSize.current = { width: rect.width, height: rect.height };\n        setSize(prevSize.current);\n        return;\n      }\n\n      if (rect.width !== prevSize.current.width || rect.height !== prevSize.current.height) {\n        prevSize.current.width = rect.width;\n        prevSize.current.height = rect.height;\n\n        if (!debounceTimeMs) {\n          setSize({ ...prevSize.current });\n          return;\n        }\n        clearTimeout(debounceRef.current);\n        debounceRef.current = setTimeout(() => {\n          setSize({ ...prevSize.current });\n        }, debounceTimeMs);\n      }\n    },\n    [debounceTimeMs],\n  );\n\n  const observerRef = useRef<ResizeObserver>();\n  if (!observerRef.current) {\n    observerRef.current = new ResizeObserver(onResize);\n  }\n\n  useEffect(() => {\n    const rootElement = typeof rootRef === 'function' ? rootRef() : rootRef.current;\n    if (rootElement) {\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion -- TODO(FEINF-3982)\n      const observer = observerRef.current!;\n      observer.observe(rootElement);\n      return () => observer.unobserve(rootElement);\n    }\n    return;\n  });\n\n  return size;\n}\n","import { css } from '@emotion/react';\nimport type { ReactNode } from 'react';\nimport React from 'react';\n\nimport type { ButtonProps } from '@databricks/design-system';\nimport { Button, LegacyTooltip } from '@databricks/design-system';\n\ntype SnippetActionButtonProps = Pick<ButtonProps, 'icon' | 'onClick' | 'href' | 'rel' | 'target'> & {\n  tooltipMessage: NonNullable<ReactNode>;\n};\n\nexport default function SnippetActionButton({ tooltipMessage, ...buttonProps }: SnippetActionButtonProps) {\n  const style = css({\n    zIndex: 1, // required for action buttons to be visible and float\n  });\n  return (\n    <LegacyTooltip title={tooltipMessage}>\n      <Button\n        componentId=\"codegen_web-shared_src_snippet_actions_snippetactionbutton.tsx_33\"\n        {...buttonProps}\n        css={style}\n      />\n    </LegacyTooltip>\n  );\n}\n","import React from 'react';\n\nimport type { ButtonProps } from '@databricks/design-system';\nimport { useCopyController } from '@databricks/web-shared/copy';\n\nimport SnippetActionButton from './SnippetActionButton';\n\nexport interface SnippetCopyActionProps extends ButtonProps {\n  /**\n   * The text to be copied into clipboard when action button is clicked.\n   */\n  copyText: string;\n  onClick?: (e: React.MouseEvent) => void;\n}\n\nexport function SnippetCopyAction({ copyText, onClick, ...props }: SnippetCopyActionProps) {\n  const { actionIcon, tooltipMessage, copy } = useCopyController(copyText);\n\n  return (\n    <SnippetActionButton\n      tooltipMessage={tooltipMessage}\n      icon={actionIcon}\n      onClick={(e) => {\n        copy();\n        onClick?.(e);\n      }}\n      {...props}\n    />\n  );\n}\n","import { PrismLight as SyntaxHighlighter } from 'react-syntax-highlighter';\nimport go from 'react-syntax-highlighter/dist/cjs/languages/prism/go';\nimport java from 'react-syntax-highlighter/dist/cjs/languages/prism/java';\nimport javascript from 'react-syntax-highlighter/dist/cjs/languages/prism/javascript';\nimport json from 'react-syntax-highlighter/dist/cjs/languages/prism/json';\nimport python from 'react-syntax-highlighter/dist/cjs/languages/prism/python';\nimport yaml from 'react-syntax-highlighter/dist/cjs/languages/prism/yaml';\nimport sql from 'react-syntax-highlighter/dist/cjs/languages/prism/sql';\n\nSyntaxHighlighter.registerLanguage('sql', sql);\nSyntaxHighlighter.registerLanguage('java', java);\nSyntaxHighlighter.registerLanguage('python', python);\nSyntaxHighlighter.registerLanguage('go', go);\nSyntaxHighlighter.registerLanguage('javascript', javascript);\nSyntaxHighlighter.registerLanguage('yaml', yaml);\nSyntaxHighlighter.registerLanguage('json', json);\n\nimport duotoneDarkStyle from './theme/databricks-duotone-dark';\nimport lightStyle from './theme/databricks-light';\nimport type { CSSProperties, ReactNode } from 'react';\nimport { pick } from 'lodash';\nexport type CodeSnippetTheme = 'duotoneDark' | 'light';\nexport const buttonBackgroundColorDark = 'rgba(140, 203, 255, 0)';\nexport const buttonColorDark = 'rgba(255, 255, 255, 0.84)';\nexport const buttonHoverColorDark = '#8ccbffcc';\nexport const buttonHoverBackgroundColorDark = 'rgba(140, 203, 255, 0.08)';\nexport const duboisAlertBackgroundColor = '#fff0f0';\nexport const snippetPadding = '24px';\nconst themesStyles: Record<CodeSnippetTheme, any> = {\n  light: lightStyle,\n  duotoneDark: duotoneDarkStyle,\n};\n\nexport type CodeSnippetLanguage = 'sql' | 'java' | 'python' | 'javascript' | 'go' | 'yaml' | 'text' | 'json';\n\nexport interface CodeSnippetProps {\n  /**\n   * The code string\n   */\n  children: string;\n  /**\n   * The actions that are displayed on the right top corner of the component\n   *  see `./actions` for built-in actions\n   */\n  actions?: NonNullable<ReactNode> | NonNullable<ReactNode>[];\n  /**\n   * The theme, default theme is `light`\n   */\n  theme?: CodeSnippetTheme;\n  /**\n   * Language of the code (`children`)\n   */\n  language: CodeSnippetLanguage;\n  /**\n   * Custom styles (passed to the internal `<pre>`)\n   */\n  style?: CSSProperties;\n  /**\n   * Whether to show line numbers on the left or not\n   */\n  showLineNumbers?: boolean;\n  /**\n   * Custom styles for line numbers\n   */\n  lineNumberStyle?: CSSProperties;\n  /**\n   * Boolean to specify whether to style the <code> block with white-space: pre-wrap or white-space: pre\n   */\n  wrapLongLines?: boolean;\n  /**\n   * Boolean that determines whether or not each line of code should be wrapped in a parent element\n   */\n  wrapLines?: boolean;\n  /**\n   * Props to pass to the line elements\n   */\n  lineProps?: React.HTMLProps<HTMLElement> | undefined;\n  /**\n   * Custom tag to use for the `<pre>` element\n   */\n  PreTag?: keyof JSX.IntrinsicElements | React.ComponentType<React.PropsWithChildren<any>> | undefined;\n}\n\n/**\n * `CodeSnippet` is used for highlighting code, use this instead of\n */\nexport function CodeSnippet({\n  theme = 'light',\n  language,\n  actions,\n  style,\n  children,\n  showLineNumbers,\n  lineNumberStyle,\n  wrapLongLines,\n  wrapLines,\n  PreTag,\n}: CodeSnippetProps) {\n  const customStyle = {\n    border: 'none',\n    borderRadius: 0,\n    margin: 0,\n    padding: snippetPadding,\n    ...style,\n  };\n  return (\n    <SyntaxHighlighter\n      showLineNumbers={showLineNumbers}\n      lineNumberStyle={lineNumberStyle}\n      language={language}\n      style={themesStyles[theme]}\n      customStyle={customStyle}\n      codeTagProps={{\n        style: pick(style, 'backgroundColor'),\n      }}\n      wrapLongLines={wrapLongLines}\n      wrapLines={wrapLines}\n      PreTag={PreTag}\n    >\n      {children}\n    </SyntaxHighlighter>\n  );\n}\n\nexport * from './actions/SnippetCopyAction';\n"],"names":["ErrorLogType","ErrorName","PredefinedError","Error","constructor","message","cause","super","errorLogType","errorName","displayMessage","isUserError","matchPredefinedError","error","matchPredefinedApolloError","Response","matchPredefinedErrorFromResponse","UnknownError","e","networkError","hasOwnProperty","response","GraphQLGenericError","originalError","errorDetails","NetworkRequestError","getNetworkRequestErrorDetailsFromResponse","status","BadRequestError","UnauthorizedError","PermissionError","NotFoundError","RateLimitedError","InternalServerError","ServiceUnavailableError","GenericNetworkRequestError","details","this","ServerError","_jsx","FormattedMessage","id","defaultMessage","ApplicationError","UserInputError","UnexpectedSystemStateError","SessionError","FETCH_TRACE_INFO_QUERY_KEY","displayErrorNotification","errorMessage","getIconTypeForSpan","spanType","ModelSpanType","LLM","ModelIconType","MODELS","CHAIN","AGENT","TOOL","WRENCH","CHAT_MODEL","RETRIEVER","SEARCH","PARSER","CODE","EMBEDDING","NUMBERS","RERANKER","SORT","MEMORY","SAVE","FUNCTION","UNKNOWN","getDisplayNameForSpanType","tryDeserializeAttribute","value","JSON","parse","getMatchesFromSpan","span","searchFilter","matches","sections","inputs","outputs","attributes","events","map","section","label","push","getMatchesFromEvent","forEach","event","index","Object","keys","attribute","isKeyMatch","toLowerCase","includes","key","getEventAttributeKey","name","matchIndex","numValueMatches","stringify","split","length","i","createListFromObject","item","searchTree","rootNode","spanFilterState","_rootNode$children","_ref","searchFilterLowercased","trim","allSpanTypesSelected","values","spanTypeDisplayState","every","shouldDisplay","filteredTreeNodes","children","filteredChildren","child","childNodes","childMatches","spanName","title","spanMatches","nodeMatchesSearch","spanTypeIsDisplayed","type","nodePassesSpanFilters","hasMatchingChild","hasException","getSpanExceptionCount","showParents","showExceptions","concat","searchTreeBySpanId","selectedSpanId","_rootNode$children2","isNil","matchedNode","normalizeNewSpanData","rootStartTime","rootEndTime","assessmentMap","traceId","_span$attributes","_span$attributes2","_span$attributes3","_assessmentMap$spanId","_span$attributes4","_span$attributes5","_span$attributes6","_getModelTraceSpanEnd","parentId","getModelTraceSpanParentId","spanId","getModelTraceSpanId","assessments","_assessmentMap$","chatMessages","getChatMessagesFromSpan","messagesAttributeValue","messageFormat","_normalizeConversatio","_normalizeConversatio2","Array","isArray","isRawModelTraceChatMessage","compact","prettyPrintChatMessage","messagesFromInputs","normalizeConversation","messagesFromOutputs","chatTools","getChatToolsFromSpan","toolsAttributeValue","_inputs$tools","isModelTraceChatTool","tools","mapValues","omitBy","_","startsWith","start","Number","getModelTraceSpanStartTime","end","getModelTraceSpanEndTime","icon","ModelTraceExplorerIcon","isRootSpan","decodeSpanId","isV3Span","base64","binaryString","atob","binaryLen","hex","charCodeAt","toString","padStart","base64ToHex","slice","isV3ModelTraceInfo","info","isV3ModelTraceSpan","_span$span_id","_span$context$span_id","_span$context","span_id","context","_span$parent_span_id","_span$parent_id","parent_span_id","parent_id","start_time_unix_nano","start_time","end_time_unix_nano","end_time","getModelTraceId","trace","_trace$info$request_i","trace_id","request_id","getModelTraceSize","_trace$info","_trace$info$trace_met","size","trace_metadata","isNaN","parseModelTraceToTree","_trace$trace_data$spa","_trace$trace_data","spans","trace_data","data","spanMap","relationMap","rootSpan","find","getSpanNodeFromData","_span$span_type","_span$end_time","_span$parent_id2","rootStart","rootEnd","getAssessmentMap","span_type","traceInfo","_traceInfo$assessment","getAssessmentsFromTags","tags","assessmentsById","keyBy","assessment","overrides","overriddenAssessment","reduce","acc","_assessment$span_id","sort","a","b","Date","last_update_time","getTime","entries","filter","findTraceVersionByKey","source","_source$find","tag","MLFLOW_TRACE_SCHEMA_VERSION_KEY","isModelTrace","_traceInfo$request_me","traceData","metadata","request_metadata","obj","isString","isNumber","isBoolean","getHighlightedSpanComponents","activeMatchBackgroundColor","inactiveMatchBackgroundColor","containsActiveMatch","activeMatch","scrollToActiveMatch","regex","RegExp","escapeRegExp","parts","isActiveMatch","backgroundColor","ref","css","_css","scrollMarginTop","isRetrieverDocument","document","has","isRenderableRetrieverSpan","getSpanExceptionEvents","_span$events","isModelTraceChatToolParamProperty","description","enum","_obj$function","parameters","function","required","properties","isModelTraceToolCall","_obj$function2","_obj$function3","arguments","isContentType","content","part","text","image_url","url","detail","input_audio","format","isContentPart","tool_calls","role","isModelTraceChoices","choice","isModelTraceChatResponse","choices","input","_normalizeLangchainCh","_normalizeLlamaIndexC","_ref2","_ref3","_normalizeOpenAIChatI","_normalizeDspyChatInp","_normalizeGeminiChatI","_normalizeAnthropicCh","_normalizeOpenAIAgent","_normalizeAutogenChat","_normalizeBedrockChat","_normalizeOpenAIChatI2","langchainMessages","normalizeLangchainChatInput","normalizeLangchainChatResult","llamaIndexMessages","normalizeLlamaIndexChatInput","normalizeLlamaIndexChatResponse","openAIMessages","normalizeOpenAIChatInput","normalizeOpenAIChatResponse","normalizeOpenAIResponsesOutput","normalizeOpenAIResponsesInput","dspyMessages","normalizeDspyChatInput","normalizeDspyChatOutput","geminiMessages","normalizeGeminiChatInput","normalizeGeminiChatOutput","anthropicMessages","normalizeAnthropicChatInput","normalizeAnthropicChatOutput","openAIAgentMessages","normalizeOpenAIAgentInput","normalizeOpenAIAgentOutput","autogenMessages","normalizeAutogenChatInput","normalizeAutogenChatOutput","bedrockMessages","normalizeBedrockChatInput","normalizeBedrockChatOutput","prettyPrintToolCall","toolCall","_toolCall$function","args","formatChatContent","_part$image_url","undefined","join","_message$tool_calls","INFERENCE_TABLE_RESPONSE_COLUMN_KEY","INFERENCE_TABLE_TRACE_COLUMN_KEY","ModelTraceSpanType","CodeSnippetRenderMode","async","getTraceArtifact","requestId","result","fetch","jsonData","error_code","getMlflowUILinkForTrace","experimentId","queryParams","URLSearchParams","append","styles","ModelTraceExplorerOSSNotebookRenderer","traceIds","useMemo","window","location","search","getAll","experimentIds","activeTraceIndex","setActiveTraceIndex","useState","setTraceData","isLoading","setIsLoading","setError","theme","useDesignSystemTheme","useEffect","activeTraceId","fetchTraceData","Typography","Text","color","_jsxs","display","flexDirection","border","colors","height","alignItems","justifyContent","padding","spacing","xs","md","gap","sm","Title","level","withoutMargins","InfoTooltip","componentId","iconTitle","maxWidth","disableFunction","enableFunction","Link","href","openInNewTab","Pagination","currentPageIndex","dangerouslySetAntdProps","showQuickJumper","numTotal","onChange","pageSize","style","marginBottom","paddingLeft","paddingRight","ModelTraceExplorer","modelTrace","initialActiveView","paddingTop","width","Empty","image","DangerIcon","_Fragment","Paragraph","useResizeObserver","rootRef","debounceTimeMs","prevSize","useRef","debounceRef","setSize","onResize","useCallback","rect","contentRect","current","clearTimeout","setTimeout","observerRef","ResizeObserver","rootElement","observer","observe","unobserve","SnippetActionButton","tooltipMessage","buttonProps","LegacyTooltip","Button","SnippetCopyAction","copyText","onClick","props","actionIcon","copy","useCopyController","SyntaxHighlighter","registerLanguage","sql","java","python","go","javascript","yaml","json","snippetPadding","themesStyles","light","lightStyle","duotoneDark","duotoneDarkStyle","CodeSnippet","language","actions","showLineNumbers","lineNumberStyle","wrapLongLines","wrapLines","PreTag","customStyle","borderRadius","margin","codeTagProps","pick"],"sourceRoot":""}