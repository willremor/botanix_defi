{"version":3,"file":"static/js/3428.60ccdc4b.chunk.js","mappings":"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","sources":["experiment-tracking/components/runs-charts/utils/findChartStepsByTimestamp.ts","experiment-tracking/components/runs-charts/components/cards/RunsChartsLineChartCard.tsx","experiment-tracking/components/runs-charts/hooks/useCompareRunChartSelectedRange.tsx","experiment-tracking/components/runs-charts/components/cards/RunsChartsScatterChartCard.tsx","experiment-tracking/components/runs-charts/components/cards/RunsChartsContourChartCard.tsx","common/static/parallel-chart-placeholder.svg","experiment-tracking/components/runs-charts/components/cards/RunsChartsParallelChartCard.tsx","experiment-tracking/components/runs-charts/components/cards/RunsChartsDifferenceChartCard.tsx","experiment-tracking/components/runs-charts/components/cards/RunsChartsImageChartCard.tsx","experiment-tracking/components/runs-charts/components/cards/RunsChartsCard.tsx","common/static/chart-contour.svg","experiment-tracking/components/runs-charts/components/hooks/useLineChartGlobalConfig.tsx","experiment-tracking/components/experiment-page/utils/experimentPage.fetch-utils.ts","experiment-tracking/components/runs-charts/components/cards/ChartCard.common.tsx","experiment-tracking/components/runs-charts/components/RunsScatterPlot.tsx","experiment-tracking/components/runs-charts/components/RunsMetricsLegend.tsx","experiment-tracking/components/runs-charts/components/config/RunsChartsConfigure.common.tsx","experiment-tracking/components/runs-charts/components/config/RunsChartsConfigureMetricWithDatasetSelect.tsx","experiment-tracking/components/runs-charts/components/config/RunsChartsConfigureBarChart.tsx","experiment-tracking/components/runs-charts/components/config/RunsChartsConfigureParallelChart.tsx","experiment-tracking/components/runs-charts/components/RunsChartsYAxisMetricAndExpressionSelector.tsx","experiment-tracking/components/runs-charts/components/config/RunsChartsConfigureLineChart.tsx","experiment-tracking/components/runs-charts/components/config/RunsChartsConfigureLineChart.preview.tsx","experiment-tracking/components/runs-charts/components/config/RunsChartsConfigureParallelChart.preview.tsx","experiment-tracking/components/runs-charts/components/config/RunsChartsConfigureContourChart.tsx","experiment-tracking/components/runs-charts/components/config/RunsChartsConfigureScatterChart.tsx","experiment-tracking/components/runs-charts/components/config/RunsChartsConfigureDifferenceChart.tsx","experiment-tracking/components/runs-charts/components/config/RunsChartsConfigureImageChart.tsx","experiment-tracking/components/runs-charts/components/config/RunsChartsConfigureImageChart.preview.tsx","experiment-tracking/components/runs-charts/components/config/RunsChartsConfigureScatterChartWithDatasets.tsx","experiment-tracking/components/runs-charts/components/RunsChartsConfigureModal.tsx","experiment-tracking/components/runs-charts/components/config/RunsChartsConfigureBarChart.preview.tsx","experiment-tracking/components/runs-charts/components/config/RunsChartsConfigureContourChart.preview.tsx","experiment-tracking/components/runs-charts/components/config/RunsChartsConfigureScatterChart.preview.tsx","experiment-tracking/components/runs-charts/utils/runsCharts.const.ts","experiment-tracking/components/runs-charts/components/charts/LazyParallelCoordinatesPlot.tsx","experiment-tracking/components/experiment-page/contexts/ExperimentPageUIStateContext.tsx","experiment-tracking/components/runs-charts/components/RunsMetricsLegendWrapper.tsx","experiment-tracking/components/runs-charts/hooks/useSampledMetricHistoryGraphQL.tsx","experiment-tracking/components/runs-charts/hooks/useSampledMetricHistory.tsx","experiment-tracking/components/experiment-page/hooks/useExperimentIds.ts","experiment-tracking/components/runs-charts/hooks/useRunsChartTraceHighlight.ts","experiment-tracking/components/runs-charts/utils/differenceView.ts","experiment-tracking/components/runs-charts/components/charts/difference-view-plot/DifferencePlotDataCell.tsx","experiment-tracking/components/runs-charts/components/charts/difference-view-plot/DifferencePlotRunHeaderCell.tsx","experiment-tracking/components/runs-charts/components/charts/DifferenceViewPlot.tsx","common/static/chart-difference.svg","common/utils/LocalStorageUtils.ts","experiment-tracking/components/runs-charts/components/charts/ImageGridSingleKeyPlot.tsx","experiment-tracking/components/runs-charts/components/charts/ImageGridMultipleKeyPlot.tsx","experiment-tracking/components/runs-charts/components/charts/ImageGridPlot.tsx","experiment-tracking/components/MetricChartsAccordion.tsx","experiment-tracking/components/runs-charts/components/RunsChartsAddChartMenu.tsx","experiment-tracking/components/runs-charts/components/sections/RunsChartsSectionHeader.tsx","experiment-tracking/components/runs-charts/hooks/useIsInViewport.tsx","experiment-tracking/components/runs-charts/components/RunsChartsDraggableCard.tsx","experiment-tracking/components/runs-charts/components/RunsChartsDraggablePreview.tsx","experiment-tracking/components/runs-charts/components/RunsChartsDraggableCardsGridSection.tsx","experiment-tracking/components/runs-charts/components/sections/RunsChartsSection.tsx","experiment-tracking/components/runs-charts/components/sections/RunsChartsSectionAccordion.tsx","common/static/chart-parallel.svg","experiment-tracking/components/runs-charts/hooks/useChartExpressionParser.tsx","experiment-tracking/components/runs-charts/hooks/useChartImageDownloadHandler.tsx","experiment-tracking/components/runs-charts/components/cards/RunsChartsBarChartCard.tsx","experiment-tracking/components/runs-charts/components/RunsMultipleTracesTooltipBody.tsx","experiment-tracking/components/runs-charts/hooks/useRunsChartsUIConfiguration.tsx","experiment-tracking/components/runs-charts/components/RunsMetricsBarPlot.tsx","experiment-tracking/components/runs-charts/components/RunsContourPlot.tsx","experiment-tracking/components/runs-charts/components/RunsChartsDraggableCardsGridContext.tsx","experiment-tracking/components/runs-charts/components/RunsChartsTooltipBody.tsx","common/static/chart-line.svg","experiment-tracking/components/runs-charts/hooks/useRunsChartsMultipleTracesTooltip.tsx","experiment-tracking/components/runs-charts/utils/expressionCharts.utils.ts","experiment-tracking/components/runs-charts/components/RunsMetricsLinePlot.tsx","common/static/chart-scatter.svg","experiment-tracking/components/runs-charts/components/RunsChartsNoDataFoundIndicator.tsx","experiment-tracking/components/runs-charts/hooks/useRunsChartsTooltip.tsx","common/static/chart-bar.svg","experiment-tracking/components/runs-compare/hooks/useGroupedChartRunData.tsx","common/hooks/useDragAndDropElement.tsx","experiment-tracking/components/runs-charts/hooks/useMutableHoverCallback.tsx","experiment-tracking/components/runs-charts/hooks/useImageSliderStepMarks.tsx","common/static/chart-image.svg"],"sourcesContent":["import { type Dictionary, compact, first, isUndefined, last, max, min, minBy, orderBy, values } from 'lodash';\nimport type { MetricEntity, SampledMetricsByRunUuidState } from '../../../types';\nimport type { SampledMetricsByRun } from '../hooks/useSampledMetricHistory';\n\n/**\n * This function consumes chart timestamp range and returns\n * corresponding step range for a given metric basing on a history.\n */\nexport const findChartStepsByTimestamp = (\n  // Currently fetched metric history\n  currentMetricHistory: {\n    [rangeKey: string]: {\n      loading?: boolean | undefined;\n      metricsHistory?: MetricEntity[] | undefined;\n    };\n  },\n  // Timestamp range - either textual (\"2022-10-23 10:00:00\") or numeric (milliseconds)\n  range: [string | number, string | number],\n  // If set to true, will return entire boundaries from history if timestamps are not found.\n  // Otherwise, will return undefined.\n  useDefaultIfNotFound = true,\n): [number, number] | undefined => {\n  // First, let's compile a history of all metric values from all ranges,\n  // then sort it by timestamp\n  const flatHistory = orderBy(\n    compact(\n      values(currentMetricHistory)\n        .map(({ metricsHistory }) => metricsHistory)\n        .flat(),\n    ),\n    'timestamp',\n  );\n\n  // If there's no sufficient entries, return nothing\n  if (flatHistory.length < 2) {\n    return undefined;\n  }\n\n  // We consume textual ranges produced by charts so we have\n  // to convert them to timestamps\n  const lowerBound = new Date(range[0]).valueOf();\n  const upperBound = new Date(range[1]).valueOf();\n\n  // First, try to find the lower entry using loop\n  let lowerEntry = useDefaultIfNotFound ? first(flatHistory) : undefined;\n\n  for (let index = 0; index < flatHistory.length; index++) {\n    const entry = flatHistory[index];\n    if (entry.timestamp > lowerBound) {\n      lowerEntry = flatHistory[index - 1] || entry;\n      break;\n    }\n  }\n\n  // Repeat for the upper entry\n  let upperEntry = useDefaultIfNotFound ? last(flatHistory) : undefined;\n\n  for (let index = flatHistory.length - 1; index >= 0; index--) {\n    const entry = flatHistory[index];\n    if (entry.timestamp < upperBound) {\n      upperEntry = flatHistory[index + 1] || entry;\n      break;\n    }\n  }\n\n  // If boundaries are not found, return nothing\n  if (isUndefined(lowerEntry) || isUndefined(upperEntry)) {\n    return undefined;\n  }\n\n  // Return found boundary entries\n  return [lowerEntry.step, upperEntry.step];\n};\n\n/**\n * Finds the chart steps by absolute timestamp for multiple runs.\n *\n * @param sampledMetrics - The sampled metrics by run UUID state.\n * @param runUuids - The array of run UUIDs.\n * @param metricKey - The metric key.\n * @param range - The range of timestamps.\n * @returns The lower and upper bounds of the chart steps, or undefined if not found.\n */\nexport const findChartStepsByTimestampForRuns = (\n  sampledMetrics: SampledMetricsByRunUuidState,\n  runUuids: string[],\n  metricKey: string,\n  range: [string | number, string | number],\n): [number, number] | undefined => {\n  const stepRangesPerRun = compact(\n    runUuids.map((runUuid) => {\n      const metricHistoryForRun = sampledMetrics[runUuid]?.[metricKey];\n      return metricHistoryForRun ? findChartStepsByTimestamp(metricHistoryForRun, range, false) : undefined;\n    }),\n  );\n  const lowerBound = min(stepRangesPerRun.map(([bound]) => bound));\n  const upperBound = max(stepRangesPerRun.map(([, bound]) => bound));\n\n  if (!isUndefined(lowerBound) && !isUndefined(upperBound)) {\n    return [lowerBound, upperBound];\n  }\n\n  return undefined;\n};\n\n/**\n * This function consumes chart relative time range and returns\n * corresponding step range for a given metric basing on a history.\n *\n * @param currentlyVisibleMetrics currentlyVisibleMetrics is a dictionary of currently rendered metric traces for run\n * @param runUuids a list of run UUIDs to process\n * @param relativeRange a relative time range in seconds\n * @returns a range of steps or undefined if no relevant are found\n */\nexport const findAbsoluteTimestampRangeForRelativeRange = (\n  currentlyVisibleMetrics: Dictionary<SampledMetricsByRun>,\n  runUuids: string[],\n  relativeRange: [number, number],\n  multiplier = 1000,\n): [number, number] | undefined => {\n  const stepRangesPerRun = compact(\n    runUuids.map((runUuid) => {\n      const runData = currentlyVisibleMetrics[runUuid];\n\n      if (!runData) {\n        return null;\n      }\n\n      // omit the \"runUuid\" key so we can conveniently access the metrics data\n      const { runUuid: _, ...runMetrics } = runData;\n\n      // concat all the metrics history for the run\n      const visibleMetricHistoryForRun = values(runMetrics).flatMap((metric) => metric.metricsHistory ?? []);\n\n      // Find the timestamp offset for the run. Should be equal to lowest timestamp value for each run.\n      const timestampOffset = minBy(visibleMetricHistoryForRun, 'timestamp')?.timestamp || 0;\n\n      // Convert relative time range to timestamp range. Relative range comes\n      // in seconds so we have to multiply it by 1000 to get milliseconds.\n      return [relativeRange[0] * multiplier + timestampOffset, relativeRange[1] * multiplier + timestampOffset] as [\n        number,\n        number,\n      ];\n    }),\n  );\n  const lowerBound = min(stepRangesPerRun.map(([bound]) => bound));\n  const upperBound = max(stepRangesPerRun.map(([, bound]) => bound));\n  if (!isUndefined(lowerBound) && !isUndefined(upperBound)) {\n    return [lowerBound, upperBound];\n  }\n\n  return undefined;\n};\n","import type { ReactNode } from 'react';\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport type { RunsChartsRunData } from '../RunsCharts.common';\nimport { RunsChartsLineChartXAxisType, removeOutliersFromMetricHistory } from '../RunsCharts.common';\nimport { RunsMetricsLinePlot } from '../RunsMetricsLinePlot';\nimport { RunsChartsTooltipMode, useRunsChartsTooltip } from '../../hooks/useRunsChartsTooltip';\nimport {\n  RunsChartsLineChartYAxisType,\n  type RunsChartsCardConfig,\n  type RunsChartsLineCardConfig,\n} from '../../runs-charts.types';\nimport type { RunsChartCardVisibilityProps, RunsChartCardSizeProps } from './ChartCard.common';\nimport {\n  type RunsChartCardReorderProps,\n  RunsChartCardWrapper,\n  RunsChartsChartsDragGroup,\n  RunsChartCardLoadingPlaceholder,\n} from './ChartCard.common';\nimport { useSampledMetricHistory } from '../../hooks/useSampledMetricHistory';\nimport { compact, intersection, isEqual, isUndefined, pick, uniq } from 'lodash';\nimport {\n  shouldEnableRelativeTimeDateAxis,\n  shouldEnableChartExpressions,\n} from '../../../../../common/utils/FeatureUtils';\nimport { findAbsoluteTimestampRangeForRelativeRange } from '../../utils/findChartStepsByTimestamp';\nimport type { Figure } from 'react-plotly.js';\nimport type { ReduxState } from '../../../../../redux-types';\nimport { shallowEqual, useSelector } from 'react-redux';\nimport { useCompareRunChartSelectedRange } from '../../hooks/useCompareRunChartSelectedRange';\nimport type { MetricHistoryByName } from '@mlflow/mlflow/src/experiment-tracking/types';\nimport type { RunsGroupByConfig } from '../../../experiment-page/utils/experimentPage.group-row-utils';\nimport { useGroupedChartRunData } from '../../../runs-compare/hooks/useGroupedChartRunData';\nimport type { ExperimentChartImageDownloadFileFormat } from '../../hooks/useChartImageDownloadHandler';\nimport { useChartImageDownloadHandler } from '../../hooks/useChartImageDownloadHandler';\nimport { downloadChartMetricHistoryCsv } from '../../../experiment-page/utils/experimentPage.common-utils';\nimport { RunsChartsNoDataFoundIndicator } from '../RunsChartsNoDataFoundIndicator';\nimport type { RunsChartsGlobalLineChartConfig } from '../../../experiment-page/models/ExperimentPageUIState';\nimport { useLineChartGlobalConfig } from '../hooks/useLineChartGlobalConfig';\n\nconst getV2ChartTitle = (cardConfig: RunsChartsLineCardConfig): string => {\n  if (shouldEnableChartExpressions() && cardConfig.yAxisKey === RunsChartsLineChartYAxisType.EXPRESSION) {\n    const expressions = cardConfig.yAxisExpressions?.map((exp) => exp.expression) || [];\n    return expressions?.join(' vs ') || '';\n  }\n  if (!cardConfig.selectedMetricKeys || cardConfig.selectedMetricKeys.length === 0) {\n    return cardConfig.metricKey;\n  }\n\n  return cardConfig.selectedMetricKeys.join(' vs ');\n};\n\nexport interface RunsChartsLineChartCardProps\n  extends RunsChartCardReorderProps,\n    RunsChartCardSizeProps,\n    RunsChartCardVisibilityProps {\n  config: RunsChartsLineCardConfig;\n  chartRunData: RunsChartsRunData[];\n\n  groupBy: RunsGroupByConfig | null;\n\n  onDelete: () => void;\n  onEdit: () => void;\n\n  fullScreen?: boolean;\n\n  autoRefreshEnabled?: boolean;\n  hideEmptyCharts?: boolean;\n\n  setFullScreenChart?: (chart: { config: RunsChartsCardConfig; title: string; subtitle: ReactNode }) => void;\n  onDownloadFullMetricHistoryCsv?: (runUuids: string[], metricKeys: string[]) => void;\n\n  globalLineChartConfig?: RunsChartsGlobalLineChartConfig;\n}\n\nconst SUPPORTED_DOWNLOAD_FORMATS: (ExperimentChartImageDownloadFileFormat | 'csv' | 'csv-full')[] = [\n  'png',\n  'svg',\n  'csv',\n  'csv-full',\n];\n\nexport const RunsChartsLineChartCard = ({\n  config,\n  chartRunData,\n  onDelete,\n  onEdit,\n  onDownloadFullMetricHistoryCsv,\n  groupBy,\n  fullScreen,\n  setFullScreenChart,\n  autoRefreshEnabled,\n  hideEmptyCharts,\n  globalLineChartConfig,\n  isInViewport: isInViewportProp,\n  isInViewportDeferred: isInViewportDeferredProp,\n  positionInSection,\n  ...reorderProps\n}: RunsChartsLineChartCardProps) => {\n  const { xAxisKey, selectedXAxisMetricKey, lineSmoothness } = useLineChartGlobalConfig(config, globalLineChartConfig);\n\n  const toggleFullScreenChart = useCallback(() => {\n    setFullScreenChart?.({\n      config,\n      title: getV2ChartTitle(config),\n      subtitle: null,\n    });\n  }, [config, setFullScreenChart]);\n\n  const slicedRuns = useMemo(() => chartRunData.filter(({ hidden }) => !hidden).reverse(), [chartRunData]);\n\n  const isGrouped = useMemo(() => slicedRuns.some((r) => r.groupParentInfo), [slicedRuns]);\n\n  const isEmptyDataset = useMemo(() => {\n    const metricKeys = config.selectedMetricKeys ?? [config.metricKey];\n    const metricsInRuns = slicedRuns.flatMap(({ metrics }) => Object.keys(metrics));\n    return intersection(metricKeys, uniq(metricsInRuns)).length === 0;\n  }, [config, slicedRuns]);\n\n  const runUuidsToFetch = useMemo(() => {\n    if (isGrouped) {\n      // First, get all runs inside visible groups\n      const runsInGroups = compact(slicedRuns.map((r) => r.groupParentInfo)).flatMap((g) => g.runUuids);\n\n      // Finally, get \"remaining\" runs that are not grouped\n      const ungroupedRuns = compact(\n        slicedRuns.filter((r) => !r.groupParentInfo && !r.belongsToGroup).map((r) => r.runInfo?.runUuid),\n      );\n      return [...runsInGroups, ...ungroupedRuns];\n    }\n    // If grouping is disabled, just get all run UUIDs from runInfo\n    return compact(slicedRuns.map((r) => r.runInfo?.runUuid));\n  }, [slicedRuns, isGrouped]);\n\n  const metricKeys = useMemo(() => {\n    const getYAxisKeys = (config: RunsChartsLineCardConfig) => {\n      const fallback = [config.metricKey];\n      if (!shouldEnableChartExpressions() || config.yAxisKey !== RunsChartsLineChartYAxisType.EXPRESSION) {\n        return config.selectedMetricKeys ?? fallback;\n      }\n      const yAxisKeys = config.yAxisExpressions?.reduce((acc, exp) => {\n        exp.variables.forEach((variable) => acc.add(variable));\n        return acc;\n      }, new Set<string>());\n      return yAxisKeys === undefined ? fallback : Array.from(yAxisKeys);\n    };\n    const yAxisKeys = getYAxisKeys(config);\n    const xAxisKeys = !selectedXAxisMetricKey ? [] : [selectedXAxisMetricKey];\n\n    return yAxisKeys.concat(xAxisKeys);\n  }, [config, selectedXAxisMetricKey]);\n\n  const { setTooltip, resetTooltip, destroyTooltip, selectedRunUuid } = useRunsChartsTooltip(\n    config,\n    RunsChartsTooltipMode.MultipleTracesWithScanline,\n  );\n\n  // If the chart is in fullscreen mode, we always render its body.\n  // Otherwise, we only render the chart if it is in the viewport.\n  const isInViewport = fullScreen || isInViewportProp;\n  const isInViewportDeferred = fullScreen || isInViewportDeferredProp;\n\n  const { aggregateFunction } = groupBy || {};\n\n  const sampledMetricsByRunUuid = useSelector(\n    (state: ReduxState) => pick(state.entities.sampledMetricsByRunUuid, runUuidsToFetch),\n    shallowEqual,\n  );\n\n  /**\n   * We set a local state for changes because full screen and non-full screen charts are\n   * different components - this prevents having to sync them.\n   */\n  const [yRangeLocal, setYRangeLocal] = useState<[number, number] | undefined>(() => {\n    if (config.range && !isUndefined(config.range.yMin) && !isUndefined(config.range.yMax)) {\n      return [config.range.yMin, config.range.yMax];\n    }\n    return undefined;\n  });\n\n  const { setOffsetTimestamp, stepRange, xRangeLocal, setXRangeLocal } = useCompareRunChartSelectedRange(\n    config,\n    xAxisKey,\n    config.metricKey,\n    sampledMetricsByRunUuid,\n    runUuidsToFetch,\n    xAxisKey === RunsChartsLineChartXAxisType.STEP ? config.xAxisScaleType : 'linear',\n  );\n\n  const { resultsByRunUuid, isLoading, isRefreshing } = useSampledMetricHistory({\n    runUuids: runUuidsToFetch,\n    metricKeys,\n    enabled: isInViewportDeferred,\n    maxResults: 320,\n    range: stepRange,\n    autoRefreshEnabled,\n  });\n\n  const chartLayoutUpdated = ({ layout }: Readonly<Figure>) => {\n    // We only want to update the local state if the chart is not in full screen mode.\n    // If not, this can cause synchronization issues between the full screen and non-full screen charts.\n    if (!fullScreen) {\n      let yAxisMin = yRangeLocal?.[0];\n      let yAxisMax = yRangeLocal?.[1];\n      let xAxisMin = xRangeLocal?.[0];\n      let xAxisMax = xRangeLocal?.[1];\n\n      const { autorange: yAxisAutorange, range: newYRange } = layout.yaxis || {};\n      const yRangeChanged = !isEqual(yAxisAutorange ? [undefined, undefined] : newYRange, [yAxisMin, yAxisMax]);\n\n      if (yRangeChanged) {\n        // When user zoomed in/out or changed the Y range manually, hide the tooltip\n        destroyTooltip();\n      }\n\n      if (yAxisAutorange) {\n        yAxisMin = undefined;\n        yAxisMax = undefined;\n      } else if (newYRange) {\n        yAxisMin = newYRange[0];\n        yAxisMax = newYRange[1];\n      }\n\n      const { autorange: xAxisAutorange, range: newXRange } = layout.xaxis || {};\n      if (xAxisAutorange) {\n        // Remove saved range if chart is back to default viewport\n        xAxisMin = undefined;\n        xAxisMax = undefined;\n      } else if (newXRange) {\n        const ungroupedRunUuids = compact(slicedRuns.map(({ runInfo }) => runInfo?.runUuid));\n        const groupedRunUuids = slicedRuns.flatMap(({ groupParentInfo }) => groupParentInfo?.runUuids ?? []);\n\n        if (!shouldEnableRelativeTimeDateAxis() && xAxisKey === RunsChartsLineChartXAxisType.TIME_RELATIVE) {\n          const timestampRange = findAbsoluteTimestampRangeForRelativeRange(\n            resultsByRunUuid,\n            [...ungroupedRunUuids, ...groupedRunUuids],\n            newXRange as [number, number],\n          );\n          setOffsetTimestamp([...(timestampRange as [number, number])]);\n        } else if (xAxisKey === RunsChartsLineChartXAxisType.TIME_RELATIVE_HOURS) {\n          const timestampRange = findAbsoluteTimestampRangeForRelativeRange(\n            resultsByRunUuid,\n            [...ungroupedRunUuids, ...groupedRunUuids],\n            newXRange as [number, number],\n            1000 * 60 * 60, // Convert hours to milliseconds\n          );\n          setOffsetTimestamp([...(timestampRange as [number, number])]);\n        } else {\n          setOffsetTimestamp(undefined);\n        }\n        xAxisMin = newXRange[0];\n        xAxisMax = newXRange[1];\n      }\n\n      if (\n        !isEqual(\n          { xMin: xRangeLocal?.[0], xMax: xRangeLocal?.[1], yMin: yRangeLocal?.[0], yMax: yRangeLocal?.[1] },\n          { xMin: xAxisMin, xMax: xAxisMax, yMin: yAxisMin, yMax: yAxisMax },\n        )\n      ) {\n        setXRangeLocal(isUndefined(xAxisMin) || isUndefined(xAxisMax) ? undefined : [xAxisMin, xAxisMax]);\n        setYRangeLocal(isUndefined(yAxisMin) || isUndefined(yAxisMax) ? undefined : [yAxisMin, yAxisMax]);\n      }\n    }\n  };\n\n  useEffect(() => {\n    destroyTooltip();\n  }, [destroyTooltip, isLoading]);\n\n  const sampledData: RunsChartsRunData[] = useMemo(\n    () =>\n      slicedRuns.map((run) => {\n        const metricsHistory = metricKeys.reduce((acc: MetricHistoryByName, key) => {\n          const history = resultsByRunUuid[run.uuid]?.[key]?.metricsHistory;\n          if (history) {\n            acc[key] = config.ignoreOutliers ? removeOutliersFromMetricHistory(history) : history;\n          }\n          return acc;\n        }, {});\n\n        return {\n          ...run,\n          metricsHistory,\n        };\n      }),\n    [metricKeys, resultsByRunUuid, slicedRuns, config.ignoreOutliers],\n  );\n\n  const sampledGroupData = useGroupedChartRunData({\n    enabled: isGrouped,\n    ungroupedRunsData: sampledData,\n    metricKeys,\n    sampledDataResultsByRunUuid: resultsByRunUuid,\n    aggregateFunction,\n    selectedXAxisMetricKey: xAxisKey === RunsChartsLineChartXAxisType.METRIC ? selectedXAxisMetricKey : undefined,\n    ignoreOutliers: config.ignoreOutliers ?? false,\n  });\n\n  // Use grouped data traces only if enabled and if there are any groups\n  const chartData = isGrouped ? sampledGroupData : sampledData;\n\n  const [imageDownloadHandler, setImageDownloadHandler] = useChartImageDownloadHandler();\n\n  // If the component is not in the viewport, we don't want to render the chart\n  const renderChartBody = isInViewport;\n\n  // If the data is loading or chart has just entered the viewport, show a skeleton\n  const renderSkeleton = isLoading || !isInViewportDeferred;\n\n  const chartBody = (\n    <div\n      css={[\n        styles.lineChartCardWrapper,\n        {\n          height: fullScreen ? '100%' : undefined,\n        },\n      ]}\n    >\n      {!renderChartBody ? null : renderSkeleton ? (\n        <RunsChartCardLoadingPlaceholder />\n      ) : (\n        <RunsMetricsLinePlot\n          runsData={chartData}\n          metricKey={config.metricKey}\n          selectedMetricKeys={config.selectedMetricKeys}\n          scaleType={config.scaleType}\n          xAxisKey={xAxisKey}\n          xAxisScaleType={config.xAxisScaleType}\n          yAxisKey={config.yAxisKey}\n          yAxisExpressions={config.yAxisExpressions}\n          selectedXAxisMetricKey={selectedXAxisMetricKey}\n          lineSmoothness={lineSmoothness}\n          useDefaultHoverBox={false}\n          onHover={setTooltip}\n          onUnhover={resetTooltip}\n          selectedRunUuid={selectedRunUuid}\n          onUpdate={chartLayoutUpdated}\n          xRange={xRangeLocal}\n          yRange={yRangeLocal}\n          fullScreen={fullScreen}\n          displayPoints={config.displayPoints}\n          onSetDownloadHandler={setImageDownloadHandler}\n          positionInSection={positionInSection ?? 0}\n        />\n      )}\n    </div>\n  );\n\n  const onClickDownload = useCallback(\n    (format) => {\n      const savedChartTitle = config.selectedMetricKeys?.join('-') ?? config.metricKey;\n      if (format === 'csv-full') {\n        const singleRunUuids = compact(chartData.map((d) => d.runInfo?.runUuid));\n        const runUuidsFromGroups = compact(\n          chartData\n            .filter(({ groupParentInfo }) => groupParentInfo)\n            .flatMap((group) => group.groupParentInfo?.runUuids),\n        );\n        const runUuids = [...singleRunUuids, ...runUuidsFromGroups];\n        onDownloadFullMetricHistoryCsv?.(runUuids, config.selectedMetricKeys || [config.metricKey]);\n        return;\n      }\n      if (format === 'csv') {\n        downloadChartMetricHistoryCsv(chartData, config.selectedMetricKeys || [config.metricKey], savedChartTitle);\n        return;\n      }\n      imageDownloadHandler?.(format, savedChartTitle);\n    },\n    [chartData, config, imageDownloadHandler, onDownloadFullMetricHistoryCsv],\n  );\n\n  // Do not render the card if the chart is empty and the user has enabled hiding empty charts\n  if (hideEmptyCharts && isEmptyDataset) {\n    return null;\n  }\n\n  if (fullScreen) {\n    return chartBody;\n  }\n\n  return (\n    <RunsChartCardWrapper\n      onEdit={onEdit}\n      onDelete={onDelete}\n      title={getV2ChartTitle(config)}\n      uuid={config.uuid}\n      dragGroupKey={RunsChartsChartsDragGroup.GENERAL_AREA}\n      supportedDownloadFormats={SUPPORTED_DOWNLOAD_FORMATS}\n      onClickDownload={onClickDownload}\n      // Disable fullscreen button if the chart is empty\n      toggleFullScreenChart={isEmptyDataset ? undefined : toggleFullScreenChart}\n      isRefreshing={isRefreshing}\n      isHidden={!isInViewport}\n      {...reorderProps}\n    >\n      {isEmptyDataset ? <RunsChartsNoDataFoundIndicator /> : chartBody}\n    </RunsChartCardWrapper>\n  );\n};\n\nconst styles = {\n  lineChartCardWrapper: {\n    overflow: 'hidden',\n  },\n};\n","import { useMemo, useState } from 'react';\nimport { findChartStepsByTimestampForRuns } from '../utils/findChartStepsByTimestamp';\nimport type { SampledMetricsByRunUuidState } from '../../../types';\nimport { isNumber, isString, isUndefined } from 'lodash';\nimport { RunsChartsLineChartXAxisType } from '../components/RunsCharts.common';\nimport type { RunsChartsLineCardConfig } from '../runs-charts.types';\n\n/**\n * Hook used in compare run charts. It's responsible for converting selected range\n * (which can be either step or timestamp) to step range, based on chart axis type.\n * @param config Line chart configuration\n * @param xAxisKey Can be 'step', 'time' or 'time-relative'\n * @param metricKey\n * @param sampledMetricsByRunUuid Recorded history for metrics for runs in compare chart\n * @param runUuids List of run UUIDs in compare chart\n * @param scaleType Scale type for the chart\n */\nexport const useCompareRunChartSelectedRange = (\n  config: RunsChartsLineCardConfig,\n  xAxisKey: RunsChartsLineChartXAxisType,\n  metricKey: string,\n  sampledMetricsByRunUuid: SampledMetricsByRunUuidState,\n  runUuids: string[],\n  scaleType: 'linear' | 'log' = 'linear',\n) => {\n  const [xRangeLocal, setXRangeLocal] = useState<[number | string, number | string] | undefined>(() => {\n    if (config.range && !isUndefined(config.range.xMin) && !isUndefined(config.range.xMax)) {\n      return [config.range.xMin, config.range.xMax];\n    }\n    return undefined;\n  });\n  const [offsetTimestamp, setOffsetTimestamp] = useState<[number, number] | undefined>(undefined);\n  const stepRange = useMemo<[number, number] | undefined>(() => {\n    if (!xRangeLocal) {\n      return undefined;\n    }\n    if (xAxisKey === RunsChartsLineChartXAxisType.TIME && isString(xRangeLocal[0]) && isString(xRangeLocal[1])) {\n      // If we're dealing with absolute time-based chart axis, find corresponding steps based on timestamp\n      const bounds = findChartStepsByTimestampForRuns(\n        sampledMetricsByRunUuid,\n        runUuids,\n        metricKey,\n        xRangeLocal as [string, string],\n      );\n      return bounds;\n    }\n\n    if (\n      xAxisKey === RunsChartsLineChartXAxisType.TIME_RELATIVE &&\n      offsetTimestamp &&\n      isNumber(xRangeLocal[0]) &&\n      isNumber(xRangeLocal[1])\n    ) {\n      // If we're dealing with absolute time-based chart axis, find corresponding steps based on timestamp\n      const bounds = findChartStepsByTimestampForRuns(\n        sampledMetricsByRunUuid,\n        runUuids,\n        metricKey,\n        offsetTimestamp as [number, number],\n      );\n      return bounds;\n    }\n\n    if (xAxisKey === RunsChartsLineChartXAxisType.STEP && isNumber(xRangeLocal[0]) && isNumber(xRangeLocal[1])) {\n      // If we're dealing with step-based chart axis, use those steps but incremented/decremented\n      const lowerBound = Math.floor(scaleType === 'log' ? 10 ** xRangeLocal[0] : xRangeLocal[0]);\n      const upperBound = Math.ceil(scaleType === 'log' ? 10 ** xRangeLocal[1] : xRangeLocal[1]);\n      return lowerBound && upperBound ? [lowerBound - 1, upperBound + 1] : undefined;\n    }\n\n    // return undefined for xAxisKey === 'metric' because there isn't\n    // necessarily a mapping between value range and step range\n    return undefined;\n  }, [xAxisKey, metricKey, xRangeLocal, sampledMetricsByRunUuid, runUuids, offsetTimestamp, scaleType]);\n\n  return {\n    /**\n     * If there's an offset timestamp calculated from relative runs, set it using this function\n     */\n    setOffsetTimestamp,\n    /**\n     * Resulting step range\n     */\n    stepRange,\n    /**\n     * Local range selected by user\n     */\n    xRangeLocal,\n    /**\n     * Set selected range\n     */\n    setXRangeLocal,\n  };\n};\n","import { useMemo } from 'react';\nimport type { RunsChartsRunData } from '../RunsCharts.common';\nimport type { RunsChartsScatterCardConfig } from '../../runs-charts.types';\nimport type {\n  RunsChartCardFullScreenProps,\n  RunsChartCardReorderProps,\n  RunsChartCardVisibilityProps,\n} from './ChartCard.common';\nimport { RunsChartCardWrapper, RunsChartsChartsDragGroup } from './ChartCard.common';\nimport { RunsScatterPlot } from '../RunsScatterPlot';\nimport { useRunsChartsTooltip } from '../../hooks/useRunsChartsTooltip';\nimport { useChartImageDownloadHandler } from '../../hooks/useChartImageDownloadHandler';\nimport { downloadChartDataCsv } from '../../../experiment-page/utils/experimentPage.common-utils';\nimport { intersection, uniq } from 'lodash';\nimport { RunsChartsNoDataFoundIndicator } from '../RunsChartsNoDataFoundIndicator';\nimport { Tag, Typography, useDesignSystemTheme } from '@databricks/design-system';\n\nexport interface RunsChartsScatterChartCardProps\n  extends RunsChartCardReorderProps,\n    RunsChartCardVisibilityProps,\n    RunsChartCardFullScreenProps {\n  config: RunsChartsScatterCardConfig;\n  chartRunData: RunsChartsRunData[];\n\n  hideEmptyCharts?: boolean;\n\n  onDelete: () => void;\n  onEdit: () => void;\n}\n\nexport const RunsChartsScatterChartCard = ({\n  config,\n  chartRunData,\n  onDelete,\n  onEdit,\n  fullScreen,\n  setFullScreenChart,\n  hideEmptyCharts,\n  isInViewport: isInViewportProp,\n  ...reorderProps\n}: RunsChartsScatterChartCardProps) => {\n  const { theme } = useDesignSystemTheme();\n  const title = (() => {\n    if (config.xaxis.datasetName || config.yaxis.datasetName) {\n      return (\n        <div css={{ flex: 1, display: 'flex', alignItems: 'center', overflow: 'hidden', gap: theme.spacing.xs }}>\n          <Typography.Text title={config.xaxis.key} ellipsis bold>\n            {config.xaxis.datasetName && (\n              <>\n                <Tag componentId=\"mlflow.charts.scatter_card_title.dataset_tag\" css={{ marginRight: 0 }}>\n                  {config.xaxis.datasetName}\n                </Tag>{' '}\n              </>\n            )}\n            {config.xaxis.key}\n          </Typography.Text>\n          <Typography.Text>vs</Typography.Text>\n          <Typography.Text title={config.xaxis.key} ellipsis bold>\n            {config.yaxis.datasetName && (\n              <>\n                <Tag componentId=\"mlflow.charts.scatter_card_title.dataset_tag\" css={{ marginRight: 0 }}>\n                  {config.yaxis.datasetName}\n                </Tag>{' '}\n              </>\n            )}\n            {config.yaxis.key}\n          </Typography.Text>\n        </div>\n      );\n    }\n    return `${config.xaxis.key} vs. ${config.yaxis.key}`;\n  })();\n\n  const toggleFullScreenChart = () => {\n    setFullScreenChart?.({\n      config,\n      title,\n      subtitle: null,\n    });\n  };\n\n  const slicedRuns = useMemo(() => chartRunData.filter(({ hidden }) => !hidden), [chartRunData]);\n\n  const isEmptyDataset = useMemo(() => {\n    const metricKeys = [config.xaxis.dataAccessKey ?? config.xaxis.key, config.yaxis.dataAccessKey ?? config.yaxis.key];\n    const metricsInRuns = slicedRuns.flatMap(({ metrics }) => Object.keys(metrics));\n    return intersection(metricKeys, uniq(metricsInRuns)).length === 0;\n  }, [config, slicedRuns]);\n\n  const { setTooltip, resetTooltip, selectedRunUuid } = useRunsChartsTooltip(config);\n\n  // If the chart is in fullscreen mode, we always render its body.\n  // Otherwise, we only render the chart if it is in the viewport.\n  const isInViewport = fullScreen || isInViewportProp;\n\n  const [imageDownloadHandler, setImageDownloadHandler] = useChartImageDownloadHandler();\n\n  const chartBody = (\n    <div\n      css={[\n        styles.scatterChartCardWrapper,\n        {\n          height: fullScreen ? '100%' : undefined,\n        },\n      ]}\n    >\n      {isInViewport ? (\n        <RunsScatterPlot\n          runsData={slicedRuns}\n          xAxis={config.xaxis}\n          yAxis={config.yaxis}\n          onHover={setTooltip}\n          onUnhover={resetTooltip}\n          useDefaultHoverBox={false}\n          selectedRunUuid={selectedRunUuid}\n          onSetDownloadHandler={setImageDownloadHandler}\n        />\n      ) : null}\n    </div>\n  );\n\n  // Do not render the card if the chart is empty and the user has enabled hiding empty charts\n  if (hideEmptyCharts && isEmptyDataset) {\n    return null;\n  }\n\n  if (fullScreen) {\n    return chartBody;\n  }\n\n  return (\n    <RunsChartCardWrapper\n      onEdit={onEdit}\n      onDelete={onDelete}\n      title={title}\n      uuid={config.uuid}\n      dragGroupKey={RunsChartsChartsDragGroup.GENERAL_AREA}\n      // Disable fullscreen button if the chart is empty\n      toggleFullScreenChart={isEmptyDataset ? undefined : toggleFullScreenChart}\n      supportedDownloadFormats={['png', 'svg', 'csv']}\n      onClickDownload={(format) => {\n        const savedChartTitle = [config.xaxis.key, config.yaxis.key].join('-');\n        if (format === 'csv' || format === 'csv-full') {\n          const paramsToExport = [];\n          const metricsToExport = [];\n          for (const axis of ['xaxis' as const, 'yaxis' as const]) {\n            if (config[axis].type === 'PARAM') {\n              paramsToExport.push(config[axis].key);\n            } else {\n              metricsToExport.push(config[axis].key);\n            }\n          }\n          downloadChartDataCsv(slicedRuns, metricsToExport, paramsToExport, savedChartTitle);\n          return;\n        }\n        imageDownloadHandler?.(format, savedChartTitle);\n      }}\n      {...reorderProps}\n    >\n      {isEmptyDataset ? <RunsChartsNoDataFoundIndicator /> : chartBody}\n    </RunsChartCardWrapper>\n  );\n};\n\nconst styles = {\n  scatterChartCardWrapper: {\n    overflow: 'hidden',\n  },\n};\n","import { useMemo } from 'react';\nimport type { RunsChartsRunData } from '../RunsCharts.common';\nimport type { RunsChartsContourCardConfig } from '../../runs-charts.types';\nimport type { RunsChartCardFullScreenProps, RunsChartCardReorderProps } from './ChartCard.common';\nimport { RunsChartCardWrapper, RunsChartsChartsDragGroup } from './ChartCard.common';\nimport { RunsContourPlot } from '../RunsContourPlot';\nimport { useRunsChartsTooltip } from '../../hooks/useRunsChartsTooltip';\nimport { useChartImageDownloadHandler } from '../../hooks/useChartImageDownloadHandler';\nimport { downloadChartDataCsv } from '../../../experiment-page/utils/experimentPage.common-utils';\nimport { intersection, uniq } from 'lodash';\nimport { RunsChartsNoDataFoundIndicator } from '../RunsChartsNoDataFoundIndicator';\n\nexport interface RunsChartsContourChartCardProps extends RunsChartCardReorderProps, RunsChartCardFullScreenProps {\n  config: RunsChartsContourCardConfig;\n  chartRunData: RunsChartsRunData[];\n\n  hideEmptyCharts?: boolean;\n\n  onDelete: () => void;\n  onEdit: () => void;\n}\n\nexport const RunsChartsContourChartCard = ({\n  config,\n  chartRunData,\n  onDelete,\n  onEdit,\n  fullScreen,\n  setFullScreenChart,\n  hideEmptyCharts,\n  ...reorderProps\n}: RunsChartsContourChartCardProps) => {\n  const title = `${config.xaxis.key} vs. ${config.yaxis.key} vs. ${config.zaxis.key}`;\n\n  const toggleFullScreenChart = () => {\n    setFullScreenChart?.({\n      config,\n      title,\n      subtitle: null,\n    });\n  };\n\n  const slicedRuns = useMemo(() => chartRunData.filter(({ hidden }) => !hidden), [chartRunData]);\n\n  const isEmptyDataset = useMemo(() => {\n    const metricKeys = [config.xaxis.key, config.yaxis.key, config.zaxis.key];\n    const metricsInRuns = slicedRuns.flatMap(({ metrics }) => Object.keys(metrics));\n    return intersection(metricKeys, uniq(metricsInRuns)).length === 0;\n  }, [config, slicedRuns]);\n\n  const { setTooltip, resetTooltip, selectedRunUuid } = useRunsChartsTooltip(config);\n\n  const [imageDownloadHandler, setImageDownloadHandler] = useChartImageDownloadHandler();\n\n  const chartBody = (\n    <div\n      css={[\n        styles.contourChartCardWrapper,\n        {\n          height: fullScreen ? '100%' : undefined,\n        },\n      ]}\n    >\n      <RunsContourPlot\n        runsData={slicedRuns}\n        xAxis={config.xaxis}\n        yAxis={config.yaxis}\n        zAxis={config.zaxis}\n        useDefaultHoverBox={false}\n        onHover={setTooltip}\n        onUnhover={resetTooltip}\n        selectedRunUuid={selectedRunUuid}\n        onSetDownloadHandler={setImageDownloadHandler}\n      />\n    </div>\n  );\n\n  // Do not render the card if the chart is empty and the user has enabled hiding empty charts\n  if (hideEmptyCharts && isEmptyDataset) {\n    return null;\n  }\n\n  if (fullScreen) {\n    return chartBody;\n  }\n\n  return (\n    <RunsChartCardWrapper\n      onEdit={onEdit}\n      onDelete={onDelete}\n      title={title}\n      uuid={config.uuid}\n      dragGroupKey={RunsChartsChartsDragGroup.GENERAL_AREA}\n      // Disable fullscreen button if the chart is empty\n      toggleFullScreenChart={isEmptyDataset ? undefined : toggleFullScreenChart}\n      supportedDownloadFormats={['png', 'svg', 'csv']}\n      onClickDownload={(format) => {\n        const savedChartTitle = [config.xaxis.key, config.yaxis.key, config.zaxis.key].join('-');\n        if (format === 'csv' || format === 'csv-full') {\n          const paramsToExport = [];\n          const metricsToExport = [];\n          for (const axis of ['xaxis' as const, 'yaxis' as const, 'zaxis' as const]) {\n            if (config[axis].type === 'PARAM') {\n              paramsToExport.push(config[axis].key);\n            } else {\n              metricsToExport.push(config[axis].key);\n            }\n          }\n          downloadChartDataCsv(slicedRuns, metricsToExport, paramsToExport, savedChartTitle);\n          return;\n        }\n        imageDownloadHandler?.(format, savedChartTitle);\n      }}\n      {...reorderProps}\n    >\n      {isEmptyDataset ? <RunsChartsNoDataFoundIndicator /> : chartBody}\n    </RunsChartCardWrapper>\n  );\n};\n\nconst styles = {\n  contourChartCardWrapper: {\n    overflow: 'hidden',\n  },\n};\n","var _path, _path2, _g, _defs;\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nimport * as React from \"react\";\nfunction SvgParallelChartPlaceholder({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 80,\n    height: 42,\n    viewBox: \"0 0 80 42\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M1.28418 2.34094L39.4998 17.0908L76.3746 7.87216\",\n    stroke: \"#CF797B\",\n    strokeLinecap: \"round\"\n  })), _path2 || (_path2 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M1.95459 20.443L40.1702 25.1361L77.045 21.1134M1.95459 36.5338L40.1702 35.1929L77.045 25.1361\",\n    stroke: \"#A88E6F\",\n    strokeLinecap: \"round\"\n  })), _g || (_g = /*#__PURE__*/React.createElement(\"g\", {\n    opacity: 0.8\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M1.28418 1V40.3341\",\n    stroke: \"#338ECC\",\n    strokeLinecap: \"round\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M40.6189 2.07251V39.9763\",\n    stroke: \"#338ECC\",\n    strokeLinecap: \"round\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M77.7156 2.07251V39.9763\",\n    stroke: \"url(#paint0_linear_2781_406689)\",\n    strokeWidth: 4,\n    strokeLinecap: \"square\"\n  }))), _defs || (_defs = /*#__PURE__*/React.createElement(\"defs\", null, /*#__PURE__*/React.createElement(\"linearGradient\", {\n    id: \"paint0_linear_2781_406689\",\n    x1: 78.2156,\n    y1: 2.07251,\n    x2: 78.2156,\n    y2: 39.9763,\n    gradientUnits: \"userSpaceOnUse\"\n  }, /*#__PURE__*/React.createElement(\"stop\", {\n    stopColor: \"#D04F5E\"\n  }), /*#__PURE__*/React.createElement(\"stop\", {\n    offset: 1,\n    stopColor: \"#4D9734\"\n  })))));\n}\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgParallelChartPlaceholder);\nexport default __webpack_public_path__ + \"static/media/parallel-chart-placeholder.234ef0c5b220ef2a5a6fa5bafff173f7.svg\";\nexport { ForwardRef as ReactComponent };","import { Button, DropdownMenu, Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { useCallback, useMemo } from 'react';\nimport { ReactComponent as ParallelChartSvg } from '../../../../../common/static/parallel-chart-placeholder.svg';\nimport type { RunsChartsRunData } from '../RunsCharts.common';\nimport LazyParallelCoordinatesPlot from '../charts/LazyParallelCoordinatesPlot';\nimport { isParallelChartConfigured, processParallelCoordinateData } from '../../utils/parallelCoordinatesPlot.utils';\nimport { useRunsChartsTooltip } from '../../hooks/useRunsChartsTooltip';\nimport type { RunsChartsParallelCardConfig } from '../../runs-charts.types';\nimport type { RunsChartCardFullScreenProps, RunsChartCardVisibilityProps } from './ChartCard.common';\nimport {\n  type RunsChartCardReorderProps,\n  RunsChartCardWrapper,\n  RunsChartsChartsDragGroup,\n  RunsChartCardLoadingPlaceholder,\n} from './ChartCard.common';\nimport { FormattedMessage } from 'react-intl';\nimport { useUpdateExperimentViewUIState } from '../../../experiment-page/contexts/ExperimentPageUIStateContext';\nimport { downloadChartDataCsv } from '../../../experiment-page/utils/experimentPage.common-utils';\nimport type { RunsGroupByConfig } from '../../../experiment-page/utils/experimentPage.group-row-utils';\nimport { RunsChartsNoDataFoundIndicator } from '../RunsChartsNoDataFoundIndicator';\n\nexport interface RunsChartsParallelChartCardProps\n  extends RunsChartCardReorderProps,\n    RunsChartCardFullScreenProps,\n    RunsChartCardVisibilityProps {\n  config: RunsChartsParallelCardConfig;\n  chartRunData: RunsChartsRunData[];\n\n  hideEmptyCharts?: boolean;\n\n  onDelete: () => void;\n  onEdit: () => void;\n  groupBy: RunsGroupByConfig | null;\n}\n\n/**\n * A placeholder component displayed before parallel coords chart is being configured by user\n */\nconst NotConfiguredParallelCoordsPlaceholder = ({ onEdit }: { onEdit: () => void }) => {\n  const { theme } = useDesignSystemTheme();\n\n  return (\n    <div css={{ display: 'flex', flex: 1, justifyContent: 'center', alignItems: 'center' }}>\n      <div css={{ display: 'flex', flexDirection: 'column', alignItems: 'center', maxWidth: 360 }}>\n        <ParallelChartSvg />\n        <Typography.Title css={{ marginTop: theme.spacing.md }} color=\"secondary\" level={3}>\n          <FormattedMessage\n            defaultMessage=\"Compare parameter importance\"\n            description=\"Experiment page > compare runs > parallel coordinates chart > chart not configured warning > title\"\n          />\n        </Typography.Title>\n        <Typography.Text css={{ marginBottom: theme.spacing.md }} color=\"secondary\">\n          <FormattedMessage\n            defaultMessage=\"Use the parallel coordinates chart to compare how various parameters in model affect your model metrics.\"\n            description=\"Experiment page > compare runs > parallel coordinates chart > chart not configured warning > description\"\n          />\n        </Typography.Text>\n        <Button componentId=\"mlflow.charts.parallel_coords_chart_configure_button\" type=\"primary\" onClick={onEdit}>\n          <FormattedMessage\n            defaultMessage=\"Configure chart\"\n            description=\"Experiment page > compare runs > parallel coordinates chart > configure chart button\"\n          />\n        </Button>\n      </div>\n    </div>\n  );\n};\n\n/**\n * A placeholder component displayed before parallel coords chart is being configured by user\n */\nconst UnsupportedDataPlaceholder = () => {\n  const { theme } = useDesignSystemTheme();\n\n  return (\n    <div css={{ display: 'flex', flex: 1, justifyContent: 'center', alignItems: 'center' }}>\n      <div css={{ display: 'flex', flexDirection: 'column', alignItems: 'center', maxWidth: 360 }}>\n        <ParallelChartSvg />\n        <Typography.Title css={{ marginTop: theme.spacing.md, textAlign: 'center' }} color=\"secondary\" level={3}>\n          <FormattedMessage\n            defaultMessage=\"Parallel coordinates chart does not support aggregated string values.\"\n            description=\"Experiment page > compare runs > parallel coordinates chart > unsupported string values warning > title\"\n          />\n        </Typography.Title>\n        <Typography.Text css={{ marginBottom: theme.spacing.md }} color=\"secondary\">\n          <FormattedMessage\n            defaultMessage=\"Use other parameters or disable run grouping to continue.\"\n            description=\"Experiment page > compare runs > parallel coordinates chart > unsupported string values warning > description\"\n          />\n        </Typography.Text>\n      </div>\n    </div>\n  );\n};\n\nexport const RunsChartsParallelChartCard = ({\n  config,\n  chartRunData,\n  onDelete,\n  onEdit,\n  groupBy,\n  fullScreen,\n  setFullScreenChart,\n  hideEmptyCharts,\n  isInViewport: isInViewportProp,\n  ...reorderProps\n}: RunsChartsParallelChartCardProps) => {\n  const updateUIState = useUpdateExperimentViewUIState();\n\n  const toggleFullScreenChart = () => {\n    setFullScreenChart?.({\n      config,\n      title: 'Parallel Coordinates',\n      subtitle: displaySubtitle ? subtitle : null,\n    });\n  };\n\n  const configuredChartRunData = useMemo(() => {\n    if (config?.showAllRuns) {\n      return chartRunData;\n    }\n    return chartRunData?.filter(({ hidden }) => !hidden);\n  }, [chartRunData, config?.showAllRuns]);\n\n  const containsStringValues = useMemo(\n    () =>\n      config.selectedParams?.some(\n        (paramKey) => configuredChartRunData?.some((dataTrace) => isNaN(Number(dataTrace.params[paramKey]?.value))),\n        [config.selectedParams, configuredChartRunData],\n      ),\n    [config.selectedParams, configuredChartRunData],\n  );\n\n  const updateVisibleOnlySetting = useCallback(\n    (showAllRuns: boolean) => {\n      updateUIState((state) => {\n        const newCompareRunCharts = state.compareRunCharts?.map((existingChartConfig) => {\n          if (existingChartConfig.uuid === config.uuid) {\n            const parallelChartConfig = existingChartConfig as RunsChartsParallelCardConfig;\n            return { ...parallelChartConfig, showAllRuns };\n          }\n          return existingChartConfig;\n        });\n\n        return { ...state, compareRunCharts: newCompareRunCharts };\n      });\n    },\n    [config.uuid, updateUIState],\n  );\n\n  const [isConfigured, parallelCoordsData] = useMemo(() => {\n    const configured = isParallelChartConfigured(config);\n\n    // Prepare the data in the parcoord-es format\n    const data = configured\n      ? processParallelCoordinateData(configuredChartRunData, config.selectedParams, config.selectedMetrics)\n      : [];\n\n    return [configured, data];\n  }, [config, configuredChartRunData]);\n\n  const isEmptyDataset = useMemo(() => {\n    return parallelCoordsData.length === 0;\n  }, [parallelCoordsData]);\n\n  // If the chart is in fullscreen mode, we always render its body.\n  // Otherwise, we only render the chart if it is in the viewport.\n  const isInViewport = fullScreen || isInViewportProp;\n\n  const { setTooltip, resetTooltip, selectedRunUuid, closeContextMenu } = useRunsChartsTooltip(config);\n\n  const containsUnsupportedValues = containsStringValues && groupBy;\n  const displaySubtitle = isConfigured && !containsUnsupportedValues;\n\n  const subtitle = (\n    <>\n      {config.showAllRuns ? (\n        <FormattedMessage\n          defaultMessage=\"Showing all runs\"\n          description=\"Experiment page > compare runs > parallel chart > header > indicator for all runs shown\"\n        />\n      ) : (\n        <FormattedMessage\n          defaultMessage=\"Showing only visible runs\"\n          description=\"Experiment page > compare runs > parallel chart > header > indicator for only visible runs shown\"\n        />\n      )}\n    </>\n  );\n\n  const chartBody = (\n    <>\n      {!isConfigured ? (\n        <NotConfiguredParallelCoordsPlaceholder onEdit={onEdit} />\n      ) : containsUnsupportedValues ? (\n        <UnsupportedDataPlaceholder />\n      ) : parallelCoordsData.length === 0 ? (\n        <RunsChartsNoDataFoundIndicator />\n      ) : (\n        // Avoid displaying empty set, otherwise parcoord-es goes crazy\n        <div\n          css={[\n            styles.parallelChartCardWrapper,\n            {\n              height: fullScreen ? '100%' : undefined,\n            },\n          ]}\n        >\n          {isInViewport ? (\n            <LazyParallelCoordinatesPlot\n              data={parallelCoordsData}\n              selectedParams={config.selectedParams}\n              selectedMetrics={config.selectedMetrics}\n              onHover={setTooltip}\n              onUnhover={resetTooltip}\n              axesRotateThreshold={8}\n              selectedRunUuid={selectedRunUuid}\n              closeContextMenu={closeContextMenu}\n              fallback={<RunsChartCardLoadingPlaceholder css={{ flex: 1 }} />}\n            />\n          ) : null}\n        </div>\n      )}\n    </>\n  );\n\n  if (fullScreen) {\n    return chartBody;\n  }\n\n  // Do not render the card if the chart is empty and the user has enabled hiding empty charts\n  if (hideEmptyCharts && isEmptyDataset) {\n    return null;\n  }\n\n  const fullScreenEnabled = isConfigured && !containsUnsupportedValues && !isEmptyDataset;\n\n  return (\n    <RunsChartCardWrapper\n      onEdit={onEdit}\n      onDelete={onDelete}\n      title=\"Parallel Coordinates\"\n      subtitle={displaySubtitle ? subtitle : null}\n      uuid={config.uuid}\n      tooltip={\n        <FormattedMessage\n          defaultMessage=\"The parallel coordinates chart shows runs with columns that are either numbers or strings. If a column has string entries, the runs corresponding to the 30 most recent unique values will be shown. Only runs with all relevant metrics and/or parameters will be displayed.\"\n          description=\"Experiment page > charts > parallel coordinates chart > tooltip explaining what data is expected to be rendered\"\n        />\n      }\n      dragGroupKey={RunsChartsChartsDragGroup.PARALLEL_CHARTS_AREA}\n      // Disable fullscreen button if the chart is empty\n      toggleFullScreenChart={fullScreenEnabled ? toggleFullScreenChart : undefined}\n      additionalMenuContent={\n        <>\n          <DropdownMenu.Separator />\n          <DropdownMenu.CheckboxItem\n            componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_cards_runschartsparallelchartcard.tsx_293\"\n            checked={!config.showAllRuns}\n            onClick={() => updateVisibleOnlySetting(false)}\n          >\n            <DropdownMenu.ItemIndicator />\n            <FormattedMessage\n              defaultMessage=\"Show only visible\"\n              description=\"Experiment page > compare runs tab > chart header > move down option\"\n            />\n          </DropdownMenu.CheckboxItem>\n          <DropdownMenu.CheckboxItem\n            componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_cards_runschartsparallelchartcard.tsx_300\"\n            checked={config.showAllRuns}\n            onClick={() => updateVisibleOnlySetting(true)}\n          >\n            <DropdownMenu.ItemIndicator />\n            <FormattedMessage\n              defaultMessage=\"Show all runs\"\n              description=\"Experiment page > compare runs tab > chart header > move down option\"\n            />\n          </DropdownMenu.CheckboxItem>\n        </>\n      }\n      supportedDownloadFormats={['csv']}\n      onClickDownload={(format) => {\n        const savedChartTitle = [...config.selectedMetrics, ...config.selectedParams].join('-');\n\n        if (format === 'csv') {\n          downloadChartDataCsv(configuredChartRunData, config.selectedMetrics, config.selectedParams, savedChartTitle);\n        }\n      }}\n      {...reorderProps}\n    >\n      {chartBody}\n    </RunsChartCardWrapper>\n  );\n};\n\nconst styles = {\n  parallelChartCardWrapper: {\n    // Set \"display: flex\" here (and \"flex: 1\" in the child element)\n    // so the chart will grow in width and height\n    display: 'flex',\n    overflow: 'hidden',\n    cursor: 'pointer',\n  },\n};\n","import { Button, Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { useCallback, useMemo } from 'react';\nimport type { RunsChartsRunData } from '../RunsCharts.common';\nimport {\n  DISABLED_GROUP_WHEN_GROUPBY,\n  DifferenceCardConfigCompareGroup,\n  type RunsChartsCardConfig,\n  type RunsChartsDifferenceCardConfig,\n} from '../../runs-charts.types';\nimport type { RunsChartCardFullScreenProps } from './ChartCard.common';\nimport { type RunsChartCardReorderProps, RunsChartCardWrapper, RunsChartsChartsDragGroup } from './ChartCard.common';\nimport { useConfirmChartCardConfigurationFn } from '../../hooks/useRunsChartsUIConfiguration';\nimport { useIntl, FormattedMessage } from 'react-intl';\nimport type { RunsGroupByConfig } from '../../../experiment-page/utils/experimentPage.group-row-utils';\nimport { DifferenceViewPlot } from '../charts/DifferenceViewPlot';\n\nexport interface RunsChartsDifferenceChartCardProps extends RunsChartCardReorderProps, RunsChartCardFullScreenProps {\n  config: RunsChartsDifferenceCardConfig;\n  chartRunData: RunsChartsRunData[];\n\n  hideEmptyCharts?: boolean;\n\n  onDelete: () => void;\n  onEdit: () => void;\n  groupBy: RunsGroupByConfig | null;\n}\n\n/**\n * A placeholder component displayed before runs difference chart is being configured by user\n */\nconst NotConfiguredDifferenceChartPlaceholder = ({ onEdit }: { onEdit: () => void }) => {\n  const { theme } = useDesignSystemTheme();\n\n  return (\n    <div css={{ display: 'flex', flex: 1, justifyContent: 'center', alignItems: 'center' }}>\n      <div css={{ display: 'flex', flexDirection: 'column', alignItems: 'center', maxWidth: 360 }}>\n        <Typography.Title css={{ marginTop: theme.spacing.md }} color=\"secondary\" level={3}>\n          <FormattedMessage\n            defaultMessage=\"Compare runs\"\n            description=\"Experiment tracking > runs charts > cards > RunsChartsDifferenceChartCard > chart not configured warning > title\"\n          />\n        </Typography.Title>\n        <Typography.Text css={{ marginBottom: theme.spacing.md }} color=\"secondary\">\n          <FormattedMessage\n            defaultMessage=\"Use the runs difference view to compare model and system metrics, parameters, attributes,\n            and tags across runs.\"\n            description=\"Experiment tracking > runs charts > cards > RunsChartsDifferenceChartCard > chart not configured warning > description\"\n          />\n        </Typography.Text>\n        <Button componentId=\"mlflow.charts.difference_chart_configure_button\" type=\"primary\" onClick={onEdit}>\n          <FormattedMessage\n            defaultMessage=\"Configure chart\"\n            description=\"Experiment tracking > runs charts > cards > RunsChartsDifferenceChartCard > configure chart button\"\n          />\n        </Button>\n      </div>\n    </div>\n  );\n};\n\nexport const RunsChartsDifferenceChartCard = ({\n  config,\n  chartRunData,\n  onDelete,\n  onEdit,\n  groupBy,\n  fullScreen,\n  setFullScreenChart,\n  hideEmptyCharts,\n  ...reorderProps\n}: RunsChartsDifferenceChartCardProps) => {\n  const toggleFullScreenChart = () => {\n    setFullScreenChart?.({\n      config,\n      title: config.chartName,\n      subtitle: null,\n    });\n  };\n\n  const [isConfigured, slicedRuns] = useMemo(() => {\n    const configured = Boolean(config.compareGroups?.length);\n    return [configured, chartRunData.filter(({ hidden }) => !hidden).reverse()];\n  }, [chartRunData, config]);\n\n  const isEmptyDataset = useMemo(() => {\n    return !isConfigured;\n  }, [isConfigured]);\n\n  const confirmChartCardConfiguration = useConfirmChartCardConfigurationFn();\n\n  const setCardConfig = (setter: (current: RunsChartsCardConfig) => RunsChartsDifferenceCardConfig) => {\n    confirmChartCardConfiguration(setter(config));\n  };\n\n  const showChangeFromBaselineToggle = useCallback(() => {\n    confirmChartCardConfiguration({\n      ...config,\n      showChangeFromBaseline: !config.showChangeFromBaseline,\n    } as RunsChartsCardConfig);\n  }, [config, confirmChartCardConfiguration]);\n\n  const showDifferencesOnlyToggle = useCallback(() => {\n    confirmChartCardConfiguration({\n      ...config,\n      showDifferencesOnly: !config.showDifferencesOnly,\n    } as RunsChartsCardConfig);\n  }, [config, confirmChartCardConfiguration]);\n\n  const { formatMessage } = useIntl();\n\n  const chartBody = (\n    <>\n      {!isConfigured ? (\n        <NotConfiguredDifferenceChartPlaceholder onEdit={onEdit} />\n      ) : (\n        <DifferenceViewPlot\n          previewData={slicedRuns}\n          groupBy={groupBy}\n          cardConfig={config}\n          setCardConfig={setCardConfig}\n        />\n      )}\n    </>\n  );\n  let showTooltip = undefined;\n  if (groupBy && DISABLED_GROUP_WHEN_GROUPBY.some((group) => config.compareGroups.includes(group))) {\n    showTooltip = formatMessage({\n      defaultMessage: 'Disable grouped runs to compare parameters, tag, or attributes',\n      description:\n        'Experiment tracking > runs charts > cards > RunsChartsDifferenceChartCard > disable group runs tooltip message',\n    });\n  }\n  if (fullScreen) {\n    return chartBody;\n  }\n\n  // Do not render the card if the chart is empty and the user has enabled hiding empty charts\n  if (hideEmptyCharts && isEmptyDataset) {\n    return null;\n  }\n\n  return (\n    <RunsChartCardWrapper\n      onEdit={onEdit}\n      onDelete={onDelete}\n      title={config.chartName}\n      uuid={config.uuid}\n      dragGroupKey={RunsChartsChartsDragGroup.GENERAL_AREA}\n      toggleFullScreenChart={toggleFullScreenChart}\n      toggles={[\n        {\n          toggleLabel: formatMessage({\n            defaultMessage: 'Show change from baseline',\n            description:\n              'Runs charts > components > cards > RunsChartsDifferenceChartCard > Show change from baseline toggle label',\n          }),\n          currentToggle: config.showChangeFromBaseline,\n          setToggle: showChangeFromBaselineToggle,\n        },\n        {\n          toggleLabel: formatMessage({\n            defaultMessage: 'Show differences only',\n            description:\n              'Runs charts > components > cards > RunsChartsDifferenceChartCard > Show differences only toggle label',\n          }),\n          currentToggle: config.showDifferencesOnly,\n          setToggle: showDifferencesOnlyToggle,\n        },\n      ]}\n      tooltip={showTooltip}\n      {...reorderProps}\n    >\n      {chartBody}\n    </RunsChartCardWrapper>\n  );\n};\n","import { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport type { RunsChartsRunData } from '../RunsCharts.common';\nimport type { RunsChartCardFullScreenProps } from './ChartCard.common';\nimport { type RunsChartCardReorderProps, RunsChartCardWrapper, RunsChartsChartsDragGroup } from './ChartCard.common';\nimport { useConfirmChartCardConfigurationFn } from '../../hooks/useRunsChartsUIConfiguration';\nimport type { RunsChartsCardConfig, RunsChartsImageCardConfig } from '../../runs-charts.types';\nimport { ImageGridPlot } from '../charts/ImageGridPlot';\nimport { useDesignSystemTheme } from '@databricks/design-system';\nimport { useImageSliderStepMarks } from '../../hooks/useImageSliderStepMarks';\nimport {\n  DEFAULT_IMAGE_GRID_CHART_NAME,\n  LOG_IMAGE_TAG_INDICATOR,\n  NUM_RUNS_TO_SUPPORT_FOR_LOG_IMAGE,\n} from '@mlflow/mlflow/src/experiment-tracking/constants';\nimport { LineSmoothSlider } from '@mlflow/mlflow/src/experiment-tracking/components/LineSmoothSlider';\nimport type { RunsGroupByConfig } from '@mlflow/mlflow/src/experiment-tracking/components/experiment-page/utils/experimentPage.group-row-utils';\n\nexport interface RunsChartsImageChartCardProps extends RunsChartCardReorderProps, RunsChartCardFullScreenProps {\n  config: RunsChartsImageCardConfig;\n  chartRunData: RunsChartsRunData[];\n\n  onDelete: () => void;\n  onEdit: () => void;\n  groupBy: RunsGroupByConfig | null;\n}\n\nexport const RunsChartsImageChartCard = ({\n  config,\n  chartRunData,\n  onDelete,\n  onEdit,\n  groupBy,\n  fullScreen,\n  setFullScreenChart,\n  ...reorderProps\n}: RunsChartsImageChartCardProps) => {\n  const { theme } = useDesignSystemTheme();\n  const containerRef = useRef(null);\n  const [containerWidth, setContainerWidth] = useState(0);\n\n  // Optimizations for smoother slider experience. Maintain a local copy of config, and update\n  // the global state only after the user has finished dragging the slider.\n  const [tmpConfig, setTmpConfig] = useState(config);\n  const confirmChartCardConfiguration = useConfirmChartCardConfigurationFn();\n  const updateStep = useCallback(\n    (newStep: number) => {\n      // Skip updating base chart config if step is the same as current step.\n      if (config.step === newStep) {\n        return;\n      }\n      confirmChartCardConfiguration({ ...config, step: newStep } as RunsChartsImageCardConfig);\n    },\n    [config, confirmChartCardConfiguration],\n  );\n  const tmpStepChange = useCallback((newStep: number) => {\n    setTmpConfig((currentConfig) => {\n      // Skip updating temporary config if step is the same as current step.\n      if (currentConfig.step === newStep) {\n        return currentConfig;\n      }\n      return { ...currentConfig, step: newStep };\n    });\n  }, []);\n\n  const chartName = config.imageKeys.length === 1 ? config.imageKeys[0] : DEFAULT_IMAGE_GRID_CHART_NAME;\n\n  const toggleFullScreenChart = () => {\n    setFullScreenChart?.({\n      config,\n      title: chartName,\n      subtitle: null,\n    });\n  };\n\n  const slicedRuns = useMemo(() => chartRunData.filter(({ hidden }) => !hidden).reverse(), [chartRunData]);\n\n  const setCardConfig = useCallback(\n    (setter: (current: RunsChartsCardConfig) => RunsChartsImageCardConfig) => {\n      confirmChartCardConfiguration(setter(config));\n    },\n    [config, confirmChartCardConfiguration],\n  );\n\n  const { stepMarks, maxMark, minMark } = useImageSliderStepMarks({\n    data: slicedRuns,\n    selectedImageKeys: config.imageKeys || [],\n  });\n\n  const stepMarkLength = Object.keys(stepMarks).length;\n\n  useEffect(() => {\n    // If there is only one step mark, set the step to the min mark\n    if (stepMarkLength === 1 && tmpConfig.step !== minMark) {\n      updateStep(minMark);\n      tmpStepChange(minMark);\n    }\n  }, [minMark, stepMarkLength, tmpConfig.step, updateStep, tmpStepChange]);\n\n  const shouldDisplayImageLimitIndicator =\n    slicedRuns.filter((run) => {\n      return run.tags[LOG_IMAGE_TAG_INDICATOR];\n    }).length > NUM_RUNS_TO_SUPPORT_FOR_LOG_IMAGE;\n\n  const chartBody = (\n    <div\n      css={{\n        display: 'flex',\n        flexDirection: 'column',\n        height: fullScreen ? '100%' : undefined,\n        width: '100%',\n        overflow: 'hidden',\n        marginTop: theme.spacing.sm,\n        gap: theme.spacing.md,\n      }}\n    >\n      <div\n        ref={containerRef}\n        css={{\n          flex: 1,\n          overflow: 'auto',\n        }}\n      >\n        <ImageGridPlot\n          previewData={slicedRuns}\n          groupBy={groupBy}\n          cardConfig={tmpConfig}\n          setCardConfig={setCardConfig}\n        />\n      </div>\n      <div\n        css={{\n          justifyContent: 'center',\n          alignItems: 'center',\n          display: 'inline-flex',\n          gap: theme.spacing.md,\n        }}\n      >\n        <div css={{ flex: 1 }}>\n          <LineSmoothSlider\n            value={tmpConfig.step}\n            onChange={tmpStepChange}\n            max={maxMark}\n            min={minMark}\n            marks={stepMarks}\n            disabled={Object.keys(stepMarks).length <= 1}\n            onAfterChange={updateStep}\n            css={{\n              '&[data-orientation=\"horizontal\"]': { width: 'auto' },\n            }}\n          />\n        </div>\n      </div>\n    </div>\n  );\n\n  if (fullScreen) {\n    return chartBody;\n  }\n\n  const cardBodyToRender = chartBody;\n\n  return (\n    <RunsChartCardWrapper\n      onEdit={onEdit}\n      onDelete={onDelete}\n      title={chartName}\n      subtitle={\n        shouldDisplayImageLimitIndicator && `Displaying images from first ${NUM_RUNS_TO_SUPPORT_FOR_LOG_IMAGE} runs`\n      }\n      uuid={config.uuid}\n      dragGroupKey={RunsChartsChartsDragGroup.GENERAL_AREA}\n      toggleFullScreenChart={toggleFullScreenChart}\n      {...reorderProps}\n    >\n      {cardBodyToRender}\n    </RunsChartCardWrapper>\n  );\n};\n","import { useMemo, memo } from 'react';\nimport { RunsChartType } from '../../runs-charts.types';\nimport type {\n  RunsChartsBarCardConfig,\n  RunsChartsCardConfig,\n  RunsChartsContourCardConfig,\n  RunsChartsDifferenceCardConfig,\n  RunsChartsImageCardConfig,\n  RunsChartsLineCardConfig,\n  RunsChartsParallelCardConfig,\n  RunsChartsScatterCardConfig,\n} from '../../runs-charts.types';\nimport type { RunsChartsRunData } from '../RunsCharts.common';\nimport { RunsChartsBarChartCard } from './RunsChartsBarChartCard';\nimport { RunsChartsLineChartCard } from './RunsChartsLineChartCard';\nimport { RunsChartsScatterChartCard } from './RunsChartsScatterChartCard';\nimport { RunsChartsContourChartCard } from './RunsChartsContourChartCard';\nimport { RunsChartsParallelChartCard } from './RunsChartsParallelChartCard';\nimport type {\n  RunsChartCardFullScreenProps,\n  RunsChartCardReorderProps,\n  RunsChartCardSizeProps,\n  RunsChartCardVisibilityProps,\n} from './ChartCard.common';\nimport { RunsChartsDifferenceChartCard } from './RunsChartsDifferenceChartCard';\nimport type { RunsGroupByConfig } from '../../../experiment-page/utils/experimentPage.group-row-utils';\nimport { RunsChartsImageChartCard } from './RunsChartsImageChartCard';\nimport type { RunsChartsGlobalLineChartConfig } from '../../../experiment-page/models/ExperimentPageUIState';\n\nexport interface RunsChartsCardProps\n  extends RunsChartCardReorderProps,\n    RunsChartCardFullScreenProps,\n    RunsChartCardVisibilityProps,\n    RunsChartCardSizeProps {\n  cardConfig: RunsChartsCardConfig;\n  chartRunData: RunsChartsRunData[];\n  onStartEditChart: (chart: RunsChartsCardConfig) => void;\n  onRemoveChart: (chart: RunsChartsCardConfig) => void;\n  onDownloadFullMetricHistoryCsv?: (runUuids: string[], metricKeys: string[]) => void;\n  index: number;\n  sectionIndex?: number;\n  autoRefreshEnabled?: boolean;\n  hideEmptyCharts?: boolean;\n  groupBy: RunsGroupByConfig | null;\n  globalLineChartConfig?: RunsChartsGlobalLineChartConfig;\n}\n\nconst RunsChartsCardRaw = ({\n  cardConfig,\n  chartRunData,\n  index,\n  sectionIndex,\n  onStartEditChart,\n  onRemoveChart,\n  setFullScreenChart,\n  groupBy,\n  fullScreen,\n  canMoveDown,\n  canMoveUp,\n  previousChartUuid,\n  nextChartUuid,\n  onReorderWith,\n  autoRefreshEnabled,\n  onDownloadFullMetricHistoryCsv,\n  hideEmptyCharts,\n  globalLineChartConfig,\n  height,\n  isInViewport,\n  isInViewportDeferred,\n}: RunsChartsCardProps) => {\n  const reorderProps = useMemo(\n    () => ({\n      onReorderWith,\n      canMoveDown,\n      canMoveUp,\n      previousChartUuid,\n      nextChartUuid,\n    }),\n    [onReorderWith, canMoveDown, canMoveUp, previousChartUuid, nextChartUuid],\n  );\n\n  const editProps = useMemo(\n    () => ({\n      onEdit: () => onStartEditChart(cardConfig),\n      onDelete: () => onRemoveChart(cardConfig),\n      setFullScreenChart,\n    }),\n    [onStartEditChart, onRemoveChart, setFullScreenChart, cardConfig],\n  );\n\n  const commonChartProps = useMemo(\n    () => ({\n      fullScreen,\n      autoRefreshEnabled,\n      groupBy,\n      hideEmptyCharts,\n      height,\n      isInViewport,\n      isInViewportDeferred,\n      ...editProps,\n      ...reorderProps,\n    }),\n    [\n      fullScreen,\n      autoRefreshEnabled,\n      groupBy,\n      editProps,\n      reorderProps,\n      hideEmptyCharts,\n      height,\n      isInViewport,\n      isInViewportDeferred,\n    ],\n  );\n\n  const slicedRuns = useMemo(() => chartRunData.filter(({ hidden }) => !hidden).reverse(), [chartRunData]);\n\n  if (cardConfig.type === RunsChartType.PARALLEL) {\n    return (\n      <RunsChartsParallelChartCard\n        config={cardConfig as RunsChartsParallelCardConfig}\n        chartRunData={chartRunData}\n        {...commonChartProps}\n      />\n    );\n  }\n\n  if (cardConfig.type === RunsChartType.DIFFERENCE) {\n    return (\n      <RunsChartsDifferenceChartCard\n        config={cardConfig as RunsChartsDifferenceCardConfig}\n        chartRunData={chartRunData}\n        {...commonChartProps}\n      />\n    );\n  }\n\n  if (cardConfig.type === RunsChartType.IMAGE) {\n    return (\n      <RunsChartsImageChartCard\n        config={cardConfig as RunsChartsImageCardConfig}\n        chartRunData={chartRunData}\n        {...commonChartProps}\n      />\n    );\n  }\n\n  if (cardConfig.type === RunsChartType.BAR) {\n    return (\n      <RunsChartsBarChartCard\n        config={cardConfig as RunsChartsBarCardConfig}\n        chartRunData={slicedRuns}\n        {...commonChartProps}\n      />\n    );\n  } else if (cardConfig.type === RunsChartType.LINE) {\n    return (\n      <RunsChartsLineChartCard\n        config={cardConfig as RunsChartsLineCardConfig}\n        chartRunData={slicedRuns}\n        onDownloadFullMetricHistoryCsv={onDownloadFullMetricHistoryCsv}\n        globalLineChartConfig={globalLineChartConfig}\n        positionInSection={index}\n        {...commonChartProps}\n      />\n    );\n  } else if (cardConfig.type === RunsChartType.SCATTER) {\n    return (\n      <RunsChartsScatterChartCard\n        config={cardConfig as RunsChartsScatterCardConfig}\n        chartRunData={slicedRuns}\n        {...commonChartProps}\n      />\n    );\n  } else if (cardConfig.type === RunsChartType.CONTOUR) {\n    return (\n      <RunsChartsContourChartCard\n        config={cardConfig as RunsChartsContourCardConfig}\n        chartRunData={slicedRuns}\n        {...commonChartProps}\n      />\n    );\n  }\n  return null;\n};\n\nexport const RunsChartsCard = memo(RunsChartsCardRaw);\n","var _path, _path2, _path3;\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nimport * as React from \"react\";\nfunction SvgChartContour({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 18,\n    height: 18,\n    viewBox: \"0 0 18 18\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M1 1V17H17\",\n    stroke: \"#A3AEB8\",\n    strokeLinecap: \"round\"\n  })), _path2 || (_path2 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M12.9749 4.94148C12.9188 4.71702 12.221 4.73284 12.0618 4.71515C11.1779 4.61693 10.2817 4.66052 9.39271 4.66052C8.11919 4.66052 7.15648 4.97961 6.24753 5.90922C5.86197 6.30355 5.5235 6.77684 5.23295 7.24378C4.99434 7.62726 4.65544 7.93479 4.40569 8.31299C3.93777 9.02154 3.56281 9.80723 3.56281 10.6699C3.56281 11.1806 3.37479 11.598 3.76962 12.0669C4.19449 12.5714 4.6863 12.9507 5.27978 13.2649C5.88594 13.5858 6.42202 13.8619 7.13723 13.8619C7.74338 13.8619 8.34952 13.8619 8.95567 13.8619C9.45735 13.8619 9.96042 13.8731 10.4619 13.8619C11.1412 13.8468 11.9484 13.1895 12.413 12.7381C13.581 11.6035 14.2393 9.88016 14.2393 8.24665C14.2393 7.69923 14.3797 7.17063 14.3797 6.62723C14.3797 6.40084 14.4779 5.87696 14.2744 5.71411C13.9268 5.43606 13.5785 5.13789 13.1857 4.94148\",\n    stroke: \"#338ECC\",\n    strokeLinecap: \"round\"\n  })), _path3 || (_path3 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M11.9213 6.83789C11.2761 6.83789 10.6309 6.83789 9.98577 6.83789C9.19776 6.83789 8.80182 7.44144 8.2844 7.97734C7.58163 8.70521 7.28544 9.67306 7.28544 10.666C7.28544 10.9641 7.22004 11.177 7.46104 11.3645C7.6831 11.5372 8.10719 11.6142 8.37806 11.6142C9.07316 11.6142 9.91042 11.5583 10.4462 11.0523C10.9277 10.5975 11.473 10.3701 11.8159 9.75284C12.045 9.34042 12.2022 8.86324 12.2022 8.38317C12.2022 8.14903 12.2022 7.9149 12.2022 7.68077C12.2022 7.4241 12.0208 7.38817 11.9213 7.18909\",\n    stroke: \"#338ECC\",\n    strokeLinecap: \"round\"\n  })));\n}\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgChartContour);\nexport default __webpack_public_path__ + \"static/media/chart-contour.0d4b306f2669f3ad25375568935e3ce3.svg\";\nexport { ForwardRef as ReactComponent };","import { isUndefined, pick } from 'lodash';\nimport type { RunsChartsLineCardConfig } from '../../runs-charts.types';\nimport type { RunsChartsGlobalLineChartConfig } from '../../../experiment-page/models/ExperimentPageUIState';\nimport { useMemo } from 'react';\nimport { RunsChartsLineChartXAxisType } from '../RunsCharts.common';\n\n/**\n * A utility hook that selects if certain line chart settings should be\n * taken from global configuration or from local chard card settings.\n */\nexport const useLineChartGlobalConfig = (\n  originalCardConfig: RunsChartsLineCardConfig,\n  globalLineChartConfig?: RunsChartsGlobalLineChartConfig,\n) =>\n  useMemo(() => {\n    const result = pick(originalCardConfig, ['xAxisKey', 'selectedXAxisMetricKey', 'lineSmoothness']);\n\n    if (!globalLineChartConfig) {\n      return result;\n    }\n\n    const globalXAxisKey = globalLineChartConfig.xAxisKey;\n\n    if (originalCardConfig.useGlobalLineSmoothing && !isUndefined(globalLineChartConfig.lineSmoothness)) {\n      result.lineSmoothness = globalLineChartConfig.lineSmoothness;\n    }\n\n    if (!isUndefined(globalXAxisKey) && originalCardConfig.useGlobalXaxisKey) {\n      result.xAxisKey = globalXAxisKey;\n      const globalSelectedXAxisMetricKey = globalLineChartConfig?.selectedXAxisMetricKey;\n      if (globalXAxisKey === RunsChartsLineChartXAxisType.METRIC && globalSelectedXAxisMetricKey) {\n        result.selectedXAxisMetricKey = globalSelectedXAxisMetricKey;\n      }\n    }\n\n    return result;\n  }, [originalCardConfig, globalLineChartConfig]);\n","import { chunk, isEqual } from 'lodash';\nimport { AnyAction } from 'redux';\nimport type { searchModelVersionsApi } from '../../../../model-registry/actions';\nimport { MAX_RUNS_IN_SEARCH_MODEL_VERSIONS_FILTER } from '../../../../model-registry/constants';\nimport {\n  ATTRIBUTE_COLUMN_SORT_KEY,\n  DEFAULT_LIFECYCLE_FILTER,\n  DEFAULT_MODEL_VERSION_FILTER,\n  DEFAULT_START_TIME,\n} from '../../../constants';\nimport { ViewType } from '../../../sdk/MlflowEnums';\nimport { LIFECYCLE_FILTER } from '../../../types';\nimport type { KeyValueEntity } from '../../../../common/types';\nimport { EXPERIMENT_LOG_MODEL_HISTORY_TAG } from './experimentPage.common-utils';\nimport type { ThunkDispatch } from '../../../../redux-types';\nimport type { ExperimentPageSearchFacetsState } from '../models/ExperimentPageSearchFacetsState';\nimport { RUNS_SEARCH_MAX_RESULTS } from '../../../actions';\nimport { getUUID } from '../../../../common/utils/ActionUtils';\nimport { shouldUseRegexpBasedAutoRunsSearchFilter } from '../../../../common/utils/FeatureUtils';\n\nconst START_TIME_COLUMN_OFFSET = {\n  ALL: null,\n  LAST_HOUR: 1 * 60 * 60 * 1000,\n  LAST_24_HOURS: 24 * 60 * 60 * 1000,\n  LAST_7_DAYS: 7 * 24 * 60 * 60 * 1000,\n  LAST_30_DAYS: 30 * 24 * 60 * 60 * 1000,\n  LAST_YEAR: 12 * 30 * 24 * 60 * 60 * 1000,\n};\n\nconst VALID_TABLE_ALIASES = [\n  'attribute',\n  'attributes',\n  'attr',\n  'run',\n  'metric',\n  'metrics',\n  'param',\n  'params',\n  'parameter',\n  'tag',\n  'tags',\n  'dataset',\n  'datasets',\n  'model',\n  'models',\n];\nconst SQL_SYNTAX_PATTERN = new RegExp(\n  `(${VALID_TABLE_ALIASES.join('|')})\\\\.\\\\S+\\\\s*(>|<|>=|<=|=|!=| like| ilike| rlike| in)`,\n  'i',\n);\n\nexport const RUNS_AUTO_REFRESH_INTERVAL = 30000;\n\n/**\n * Creates \"order by\" SQL expression\n */\nconst createOrderByExpression = ({ orderByKey, orderByAsc }: ExperimentPageSearchFacetsState) => {\n  if (orderByKey) {\n    return orderByAsc ? [orderByKey + ' ASC'] : [orderByKey + ' DESC'];\n  }\n  return [];\n};\n\n/**\n * Creates SQL expression for filtering by run start time\n */\nconst createStartTimeExpression = ({ startTime }: ExperimentPageSearchFacetsState, referenceTime: number) => {\n  const offset = START_TIME_COLUMN_OFFSET[startTime as keyof typeof START_TIME_COLUMN_OFFSET];\n  if (!startTime || !offset || startTime === 'ALL') {\n    return null;\n  }\n  const startTimeOffset = referenceTime - offset;\n\n  return `attributes.start_time >= ${startTimeOffset}`;\n};\n\n/**\n * Creates SQL expression for filtering by selected datasets\n */\nconst createDatasetsFilterExpression = ({ datasetsFilter }: ExperimentPageSearchFacetsState) => {\n  if (datasetsFilter.length === 0) {\n    return null;\n  }\n  const datasetNames = datasetsFilter.map((dataset) => `'${dataset.name}'`).join(',');\n  const datasetDigests = datasetsFilter.map((dataset) => `'${dataset.digest}'`).join(',');\n\n  return `dataset.name IN (${datasetNames}) AND dataset.digest IN (${datasetDigests})`;\n};\n\nexport const detectSqlSyntaxInSearchQuery = (searchFilter: string) => {\n  return SQL_SYNTAX_PATTERN.test(searchFilter);\n};\n\nexport const createQuickRegexpSearchFilter = (searchFilter: string) =>\n  `attributes.run_name RLIKE '${searchFilter.replace(/'/g, \"\\\\'\")}'`;\n\n/**\n * Combines search filter and start time SQL expressions\n */\nconst createFilterExpression = (\n  { searchFilter }: ExperimentPageSearchFacetsState,\n  startTimeExpression: string | null,\n  datasetsFilterExpression: string | null,\n) => {\n  if (\n    shouldUseRegexpBasedAutoRunsSearchFilter() &&\n    searchFilter.length > 0 &&\n    !detectSqlSyntaxInSearchQuery(searchFilter)\n  ) {\n    return createQuickRegexpSearchFilter(searchFilter);\n  }\n\n  const activeFilters = [];\n  if (searchFilter) activeFilters.push(searchFilter);\n  if (startTimeExpression) activeFilters.push(startTimeExpression);\n  if (datasetsFilterExpression) activeFilters.push(datasetsFilterExpression);\n\n  if (activeFilters.length === 0) return undefined;\n  return activeFilters.join(' and ');\n};\n\n/**\n * If this function returns true, the ExperimentView should nest children underneath their parents\n * and fetch all root level parents of visible runs. If this function returns false, the views will\n * not nest children or fetch any additional parents. Will always return true if the orderByKey is\n * 'attributes.start_time'\n */\nconst shouldNestChildrenAndFetchParents = ({ orderByKey, searchFilter }: ExperimentPageSearchFacetsState) =>\n  (!orderByKey && !searchFilter) || orderByKey === ATTRIBUTE_COLUMN_SORT_KEY.DATE;\n\n/**\n *\n * Function creates API-compatible query object basing on the given criteria.\n * @param experimentIds IDs of experiments to be queries for runs\n * @param searchFacetsState the sort/filter model to use\n * @param referenceTime reference time to calculate startTime filter\n * @param pageToken next page token if fetching the next page\n */\nexport const createSearchRunsParams = (\n  experimentIds: string[],\n  searchFacetsState: ExperimentPageSearchFacetsState & { runsPinned: string[] },\n  referenceTime: number,\n  pageToken?: string,\n  maxResults?: number,\n) => {\n  const runViewType =\n    searchFacetsState.lifecycleFilter === LIFECYCLE_FILTER.ACTIVE ? ViewType.ACTIVE_ONLY : ViewType.DELETED_ONLY;\n\n  const { runsPinned = undefined } = searchFacetsState;\n\n  const orderBy = createOrderByExpression(searchFacetsState);\n  const startTimeExpression = createStartTimeExpression(searchFacetsState, referenceTime);\n  const datasetsFilterExpression = createDatasetsFilterExpression(searchFacetsState);\n  const filter = createFilterExpression(searchFacetsState, startTimeExpression, datasetsFilterExpression);\n  const shouldFetchParents = shouldNestChildrenAndFetchParents(searchFacetsState);\n\n  return {\n    // Experiment IDs\n    experimentIds,\n\n    // Filters and sort options\n    filter,\n    runViewType,\n    orderBy,\n    shouldFetchParents,\n\n    // Next page token for loading more runs\n    pageToken,\n    runsPinned,\n\n    maxResults: maxResults || RUNS_SEARCH_MAX_RESULTS,\n  };\n};\n/**\n * Function checks if given runs set contain info about log model history and if true,\n * fetches model versions for them\n *\n * @param runsPayload runs payload returned from the searchRuns API\n * @param actionCreator redux-thunk action creator that for search model versions action\n * @param dispatch redux-compatible dispatch function\n */\nexport const fetchModelVersionsForRuns = (\n  runsPayload: {\n    info: {\n      run_id: string;\n    };\n    data: {\n      tags: KeyValueEntity[];\n    };\n  }[],\n  actionCreator: typeof searchModelVersionsApi,\n  dispatch: ThunkDispatch,\n) => {\n  const runsWithLogModelHistory = runsPayload.filter((run) =>\n    run.data.tags.some((t) => t.key === EXPERIMENT_LOG_MODEL_HISTORY_TAG),\n  );\n\n  const promises = chunk(runsWithLogModelHistory, MAX_RUNS_IN_SEARCH_MODEL_VERSIONS_FILTER).map((runsChunk) => {\n    // eslint-disable-next-line prefer-const\n    let maxResults = undefined;\n    const action = actionCreator(\n      {\n        run_id: runsChunk.map((run) => run.info.run_id),\n      },\n      getUUID(),\n      maxResults,\n    );\n    return dispatch(action);\n  });\n\n  return Promise.all(promises);\n};\n\n/**\n * Function consumes a search state facets object and returns `true`\n * if at least one filter-related facet is not-default meaning that runs\n * are currently filtered.\n */\nexport const isSearchFacetsFilterUsed = (currentSearchFacetsState: ExperimentPageSearchFacetsState) => {\n  const { lifecycleFilter, modelVersionFilter, datasetsFilter, searchFilter, startTime } = currentSearchFacetsState;\n  return Boolean(\n    lifecycleFilter !== DEFAULT_LIFECYCLE_FILTER ||\n      modelVersionFilter !== DEFAULT_MODEL_VERSION_FILTER ||\n      datasetsFilter.length !== 0 ||\n      searchFilter ||\n      startTime !== DEFAULT_START_TIME,\n  );\n};\n","import {\n  Button,\n  DragIcon,\n  DropdownMenu,\n  OverflowIcon,\n  Typography,\n  useDesignSystemTheme,\n  LegacyInfoTooltip,\n  FullscreenIcon,\n  Switch,\n  Spinner,\n} from '@databricks/design-system';\nimport type { Theme } from '@emotion/react';\nimport type { PropsWithChildren, ReactNode } from 'react';\nimport React, { memo, useCallback, forwardRef } from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport { RunsChartsRunData } from '../RunsCharts.common';\nimport type { RunsChartsCardConfig } from '../../runs-charts.types';\nimport type { ExperimentChartImageDownloadFileFormat } from '../../hooks/useChartImageDownloadHandler';\nimport { noop } from 'lodash';\n\nexport const DRAGGABLE_CARD_HANDLE_CLASS = 'mlflow-charts-drag-handle';\nexport const DRAGGABLE_CARD_TRANSITION_NAME = '--drag-transform';\nexport const DRAGGABLE_CARD_TRANSITION_VAR = `var(${DRAGGABLE_CARD_TRANSITION_NAME})`;\n\nexport enum RunsChartsChartsDragGroup {\n  PARALLEL_CHARTS_AREA = 'PARALLEL_CHARTS_AREA',\n  GENERAL_AREA = 'GENERAL_AREA',\n}\n\nexport interface RunsChartCardReorderProps {\n  onReorderWith: (draggedKey: string, targetDropKey: string) => void;\n  canMoveUp: boolean;\n  canMoveDown: boolean;\n  previousChartUuid?: string;\n  nextChartUuid?: string;\n}\n\nexport interface RunsChartCardSizeProps {\n  height?: number;\n  positionInSection?: number;\n}\n\nexport interface RunsChartCardVisibilityProps {\n  isInViewport?: boolean;\n  isInViewportDeferred?: boolean;\n}\n\nexport type RunsChartCardSetFullscreenFn = (chart: {\n  config: RunsChartsCardConfig;\n  title: string | ReactNode;\n  subtitle: ReactNode;\n}) => void;\n\nexport interface RunsChartCardFullScreenProps {\n  fullScreen?: boolean;\n  setFullScreenChart?: RunsChartCardSetFullscreenFn;\n}\n\nexport interface ChartCardToggleProps {\n  toggleLabel: string;\n  currentToggle: boolean;\n  setToggle: () => void;\n}\n\nexport interface ChartCardWrapperProps extends RunsChartCardReorderProps, RunsChartCardSizeProps {\n  title: React.ReactNode;\n  subtitle?: React.ReactNode;\n  onEdit: () => void;\n  onDelete: () => void;\n  tooltip?: React.ReactNode;\n  uuid?: string;\n  dragGroupKey: RunsChartsChartsDragGroup;\n  additionalMenuContent?: React.ReactNode;\n  toggleFullScreenChart?: () => void;\n  toggles?: ChartCardToggleProps[];\n  isRefreshing?: boolean;\n  onClickDownload?: (format: ExperimentChartImageDownloadFileFormat | 'csv' | 'csv-full') => void;\n  supportedDownloadFormats?: (ExperimentChartImageDownloadFileFormat | 'csv' | 'csv-full')[];\n  isHidden?: boolean;\n}\n\n/**\n * Wrapper components for all chart cards. Provides styles and adds\n * a dropdown menu with actions for configure and delete.\n */\nconst RunsChartCardWrapperRaw = ({\n  title,\n  subtitle,\n  onDelete,\n  onEdit,\n  children,\n  uuid,\n  dragGroupKey,\n  tooltip = '',\n  onReorderWith = noop,\n  canMoveDown,\n  canMoveUp,\n  previousChartUuid,\n  nextChartUuid,\n  additionalMenuContent,\n  toggleFullScreenChart,\n  toggles,\n  supportedDownloadFormats = [],\n  onClickDownload,\n  isHidden,\n  height,\n  isRefreshing = false,\n}: PropsWithChildren<ChartCardWrapperProps>) => {\n  const { theme } = useDesignSystemTheme();\n\n  const onMoveUp = useCallback(\n    () => onReorderWith(uuid || '', previousChartUuid || ''),\n    [onReorderWith, uuid, previousChartUuid],\n  );\n  const onMoveDown = useCallback(\n    () => onReorderWith(uuid || '', nextChartUuid || ''),\n    [onReorderWith, uuid, nextChartUuid],\n  );\n\n  const usingCustomTitle = React.isValidElement(title);\n\n  return (\n    <div\n      css={{\n        // Either use provided height or default to 360\n        height: height ?? 360,\n        overflow: 'hidden',\n        display: 'grid',\n        gridTemplateRows: 'auto 1fr',\n        backgroundColor: theme.colors.backgroundPrimary,\n        padding: 12,\n        // have a slightly smaller padding when the enableDeepLearningUI\n        // flag is on to accomodate the legend in the charts\n        paddingBottom: theme.spacing.sm,\n        border: `1px solid ${theme.colors.border}`,\n        borderRadius: theme.general.borderRadiusBase,\n        transition: 'opacity 0.12s',\n        position: 'relative',\n      }}\n      data-testid=\"experiment-view-compare-runs-card\"\n    >\n      <div\n        css={{\n          display: 'flex',\n          overflow: 'hidden',\n        }}\n      >\n        <div\n          data-testid=\"experiment-view-compare-runs-card-drag-handle\"\n          css={{\n            marginTop: usingCustomTitle ? theme.spacing.sm : theme.spacing.xs,\n            marginRight: theme.spacing.sm,\n            cursor: 'grab',\n          }}\n          className={DRAGGABLE_CARD_HANDLE_CLASS}\n        >\n          <DragIcon />\n        </div>\n        {usingCustomTitle ? (\n          title\n        ) : (\n          <div css={{ overflow: 'hidden', flex: 1, flexShrink: 1 }}>\n            <Typography.Title\n              title={String(title)}\n              level={4}\n              withoutMargins\n              css={{\n                overflow: 'hidden',\n                whiteSpace: 'nowrap',\n                textOverflow: 'ellipsis',\n              }}\n            >\n              {title}\n            </Typography.Title>\n            {subtitle && <span css={styles.subtitle(theme)}>{subtitle}</span>}\n            {tooltip && <LegacyInfoTooltip css={{ verticalAlign: 'middle' }} title={tooltip} />}\n          </div>\n        )}\n        {isRefreshing && (\n          <div\n            css={{\n              width: theme.general.heightSm,\n              height: theme.general.heightSm,\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n            }}\n          >\n            <Spinner />\n          </div>\n        )}\n        {toggles && (\n          <div\n            css={{\n              display: 'flex',\n              padding: `0px ${theme.spacing.lg}px`,\n              gap: theme.spacing.md,\n              alignItems: 'flex-start',\n            }}\n          >\n            {toggles.map((toggle) => {\n              return (\n                <Switch\n                  componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_cards_chartcard.common.tsx_262\"\n                  key={toggle.toggleLabel}\n                  checked={toggle.currentToggle}\n                  onChange={toggle.setToggle}\n                  label={toggle.toggleLabel}\n                />\n              );\n            })}\n          </div>\n        )}\n        <Button\n          componentId=\"fullscreen_button_chartcard\"\n          icon={<FullscreenIcon />}\n          onClick={toggleFullScreenChart}\n          disabled={!toggleFullScreenChart}\n        />\n        <DropdownMenu.Root modal={false}>\n          <DropdownMenu.Trigger asChild>\n            <Button\n              componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-compare_cards_chartcard.common.tsx_158\"\n              type=\"tertiary\"\n              icon={<OverflowIcon />}\n              data-testid=\"experiment-view-compare-runs-card-menu\"\n            />\n          </DropdownMenu.Trigger>\n          <DropdownMenu.Content align=\"end\" minWidth={100}>\n            <DropdownMenu.Item\n              componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_cards_chartcard.common.tsx_288\"\n              onClick={onEdit}\n              data-testid=\"experiment-view-compare-runs-card-edit\"\n            >\n              Configure\n            </DropdownMenu.Item>\n            <DropdownMenu.Item\n              componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_cards_chartcard.common.tsx_291\"\n              onClick={onDelete}\n              data-testid=\"experiment-view-compare-runs-card-delete\"\n            >\n              Delete\n            </DropdownMenu.Item>\n            {supportedDownloadFormats.length > 0 && onClickDownload && (\n              <>\n                <DropdownMenu.Separator />\n                {supportedDownloadFormats.includes('csv') && (\n                  <DropdownMenu.Item\n                    componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_cards_chartcard.common.tsx_298\"\n                    onClick={() => onClickDownload('csv')}\n                  >\n                    <FormattedMessage\n                      defaultMessage=\"Export as CSV\"\n                      description=\"Experiment page > compare runs tab > chart header > export CSV data option\"\n                    />\n                  </DropdownMenu.Item>\n                )}\n                {supportedDownloadFormats.includes('svg') && (\n                  <DropdownMenu.Item\n                    componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_cards_chartcard.common.tsx_316\"\n                    onClick={() => onClickDownload('svg')}\n                  >\n                    <FormattedMessage\n                      defaultMessage=\"Download as SVG\"\n                      description=\"Experiment page > compare runs tab > chart header > download as SVG option\"\n                    />\n                  </DropdownMenu.Item>\n                )}\n                {supportedDownloadFormats.includes('png') && (\n                  <DropdownMenu.Item\n                    componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_cards_chartcard.common.tsx_324\"\n                    onClick={() => onClickDownload('png')}\n                  >\n                    <FormattedMessage\n                      defaultMessage=\"Download as PNG\"\n                      description=\"Experiment page > compare runs tab > chart header > download as PNG option\"\n                    />\n                  </DropdownMenu.Item>\n                )}\n              </>\n            )}\n            <DropdownMenu.Separator />\n            <DropdownMenu.Item\n              componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_cards_chartcard.common.tsx_334\"\n              disabled={!canMoveUp}\n              onClick={onMoveUp}\n              data-testid=\"experiment-view-compare-runs-move-up\"\n            >\n              <FormattedMessage\n                defaultMessage=\"Move up\"\n                description=\"Experiment page > compare runs tab > chart header > move up option\"\n              />\n            </DropdownMenu.Item>\n            <DropdownMenu.Item\n              componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_cards_chartcard.common.tsx_344\"\n              disabled={!canMoveDown}\n              onClick={onMoveDown}\n              data-testid=\"experiment-view-compare-runs-move-down\"\n            >\n              <FormattedMessage\n                defaultMessage=\"Move down\"\n                description=\"Experiment page > compare runs tab > chart header > move down option\"\n              />\n            </DropdownMenu.Item>\n            {additionalMenuContent}\n          </DropdownMenu.Content>\n        </DropdownMenu.Root>\n      </div>\n      {children}\n    </div>\n  );\n};\n\nconst styles = {\n  chartEntry: (theme: Theme) => ({\n    height: 360,\n    overflow: 'hidden',\n    display: 'grid',\n    gridTemplateRows: 'auto 1fr',\n    backgroundColor: theme.colors.backgroundPrimary,\n    padding: theme.spacing.md,\n    border: `1px solid ${theme.colors.border}`,\n    borderRadius: theme.general.borderRadiusBase,\n  }),\n  chartComponentWrapper: () => ({\n    overflow: 'hidden',\n  }),\n  subtitle: (theme: Theme) => ({\n    color: theme.colors.textSecondary,\n    fontSize: 11,\n    marginRight: 4,\n    verticalAlign: 'middle',\n  }),\n};\n\nexport const RunsChartCardWrapper = memo(RunsChartCardWrapperRaw);\n\nexport const RunsChartCardLoadingPlaceholder = forwardRef<\n  HTMLDivElement,\n  {\n    className?: string;\n    style?: React.CSSProperties;\n  }\n>(({ className, style }, ref) => (\n  <div\n    css={{ display: 'flex', height: '100%', justifyContent: 'center', alignItems: 'center' }}\n    className={className}\n    style={style}\n    ref={ref}\n  >\n    <Spinner />\n  </div>\n));\n","import { useDesignSystemTheme } from '@databricks/design-system';\nimport { isNil } from 'lodash';\nimport type { Data, Datum, Layout, PlotMouseEvent } from 'plotly.js';\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { LazyPlot } from '../../LazyPlot';\nimport { useMutableChartHoverCallback } from '../hooks/useMutableHoverCallback';\nimport { highlightScatterTraces, useRenderRunsChartTraceHighlight } from '../hooks/useRunsChartTraceHighlight';\nimport type { RunsChartsRunData, RunsChartAxisDef, RunsPlotsCommonProps } from './RunsCharts.common';\nimport {\n  commonRunsChartStyles,\n  runsChartDefaultMargin,\n  runsChartHoverlabel,\n  createThemedPlotlyLayout,\n  useDynamicPlotSize,\n  getLegendDataFromRuns,\n} from './RunsCharts.common';\nimport RunsMetricsLegendWrapper from './RunsMetricsLegendWrapper';\nimport { createChartImageDownloadHandler } from '../hooks/useChartImageDownloadHandler';\nimport { RunsChartCardLoadingPlaceholder } from './cards/ChartCard.common';\n\nexport interface RunsScatterPlotProps extends RunsPlotsCommonProps {\n  /**\n   * Horizontal axis with a metric or a param\n   */\n  xAxis: RunsChartAxisDef;\n\n  /**\n   * Vertical axis with a metric or a param\n   */\n  yAxis: RunsChartAxisDef;\n\n  /**\n   * Array of runs data with corresponding values\n   */\n  runsData: RunsChartsRunData[];\n}\n\nconst PLOT_CONFIG = {\n  displaylogo: false,\n  scrollZoom: false,\n  modeBarButtonsToRemove: ['toImage'],\n};\n\nconst createTooltipTemplate = () =>\n  '<b>%{customdata[1]}:</b><br>' +\n  '<b>%{xaxis.title.text}:</b> %{x:.2f}<br>' +\n  '<b>%{yaxis.title.text}:</b> %{y:.2f}<br>' +\n  '<extra></extra>';\n\n/**\n * Implementation of plotly.js chart displaying\n * scatter plot comparing values for a given\n * set of experiments runs\n */\nexport const RunsScatterPlot = React.memo(\n  ({\n    runsData,\n    xAxis,\n    yAxis,\n    markerSize = 10,\n    className,\n    margin = runsChartDefaultMargin,\n    onUpdate,\n    onHover,\n    onUnhover,\n    width,\n    height,\n    useDefaultHoverBox = true,\n    selectedRunUuid,\n    onSetDownloadHandler,\n  }: RunsScatterPlotProps) => {\n    const { theme } = useDesignSystemTheme();\n\n    const { layoutHeight, layoutWidth, setContainerDiv, containerDiv, isDynamicSizeSupported } = useDynamicPlotSize();\n\n    const plotData = useMemo(() => {\n      // Prepare empty values\n      const xValues: (number | string)[] = [];\n      const yValues: (number | string)[] = [];\n      const colors: (number | string)[] = [];\n      const tooltipData: Datum[] = [];\n\n      // Iterate through all the runs and aggregate selected metrics/params\n      for (const runData of runsData) {\n        const { runInfo, metrics, params, color, uuid, displayName } = runData;\n        const { runUuid, runName } = runInfo || {};\n        const xAxisData = xAxis.type === 'METRIC' ? metrics : params;\n        const yAxisData = yAxis.type === 'METRIC' ? metrics : params;\n\n        const x = xAxisData?.[xAxis.dataAccessKey ?? xAxis.key]?.value;\n        const y = yAxisData?.[yAxis.dataAccessKey ?? yAxis.key]?.value;\n\n        if (!isNil(x) && !isNil(y)) {\n          xValues.push(x);\n          yValues.push(y);\n          colors.push(color || theme.colors.primary);\n          if (runUuid) {\n            tooltipData.push([runUuid, runName || runUuid] as any);\n          } else {\n            tooltipData.push([uuid, displayName] as any);\n          }\n        }\n      }\n\n      return [\n        {\n          x: xValues,\n          y: yValues,\n          customdata: tooltipData,\n          text: runsData.map(({ displayName }) => displayName),\n          hovertemplate: useDefaultHoverBox ? createTooltipTemplate() : undefined,\n          hoverinfo: useDefaultHoverBox ? undefined : 'none',\n          hoverlabel: useDefaultHoverBox ? runsChartHoverlabel : undefined,\n          type: 'scatter',\n          mode: 'markers',\n          textposition: 'bottom center',\n          marker: {\n            size: markerSize,\n            color: colors,\n          },\n        } as Data,\n      ];\n    }, [runsData, xAxis, yAxis, theme, markerSize, useDefaultHoverBox]);\n\n    const plotlyThemedLayout = useMemo(() => createThemedPlotlyLayout(theme), [theme]);\n\n    const [layout, setLayout] = useState<Partial<Layout>>({\n      width: width || layoutWidth,\n      height: height || layoutHeight,\n      margin,\n      xaxis: { title: xAxis.key, tickfont: { size: 11, color: theme.colors.textSecondary } },\n      yaxis: { title: yAxis.key, tickfont: { size: 11, color: theme.colors.textSecondary } },\n      template: { layout: plotlyThemedLayout },\n    });\n\n    useEffect(() => {\n      setLayout((current) => {\n        const newLayout = {\n          ...current,\n          width: width || layoutWidth,\n          height: height || layoutHeight,\n          margin,\n        };\n\n        if (newLayout.xaxis) {\n          newLayout.xaxis.title = xAxis.key;\n        }\n\n        if (newLayout.yaxis) {\n          newLayout.yaxis.title = yAxis.key;\n        }\n\n        return newLayout;\n      });\n    }, [layoutWidth, layoutHeight, margin, xAxis.key, yAxis.key, width, height]);\n\n    const { setHoveredPointIndex } = useRenderRunsChartTraceHighlight(\n      containerDiv,\n      selectedRunUuid,\n      runsData,\n      highlightScatterTraces,\n    );\n\n    const hoverCallback = useCallback(\n      ({ points }: PlotMouseEvent) => {\n        // Find the corresponding run UUID by basing on \"customdata\" field set in the trace data.\n        // Plotly TS typings don't support custom fields so we need to cast to \"any\" first\n        const pointCustomDataRunUuid = (points[0] as any)?.customdata?.[0];\n        setHoveredPointIndex(points[0]?.pointIndex ?? -1);\n\n        if (pointCustomDataRunUuid) {\n          onHover?.(pointCustomDataRunUuid, undefined, {});\n        }\n      },\n      [onHover, setHoveredPointIndex],\n    );\n\n    const unhoverCallback = useCallback(() => {\n      onUnhover?.();\n      setHoveredPointIndex(-1);\n    }, [onUnhover, setHoveredPointIndex]);\n\n    /**\n     * Unfortunately plotly.js memorizes first onHover callback given on initial render,\n     * so in order to achieve updated behavior we need to wrap its most recent implementation\n     * in the immutable callback.\n     */\n    const mutableHoverCallback = useMutableChartHoverCallback(hoverCallback);\n\n    const legendLabelData = useMemo(() => getLegendDataFromRuns(runsData), [runsData]);\n\n    useEffect(() => {\n      const dataToExport: Data[] = plotData.map((trace: Data) => ({\n        ...trace,\n        mode: 'text+markers',\n      }));\n      onSetDownloadHandler?.(createChartImageDownloadHandler(dataToExport, layout));\n    }, [layout, onSetDownloadHandler, plotData]);\n\n    const chart = (\n      <div\n        css={[commonRunsChartStyles.chartWrapper(theme), commonRunsChartStyles.scatterChartHighlightStyles]}\n        className={className}\n        ref={setContainerDiv}\n      >\n        <LazyPlot\n          data={plotData}\n          useResizeHandler={!isDynamicSizeSupported}\n          css={commonRunsChartStyles.chart(theme)}\n          layout={layout}\n          config={PLOT_CONFIG}\n          onUpdate={onUpdate}\n          onHover={mutableHoverCallback}\n          onUnhover={unhoverCallback}\n          fallback={<RunsChartCardLoadingPlaceholder />}\n        />\n      </div>\n    );\n\n    return <RunsMetricsLegendWrapper labelData={legendLabelData}>{chart}</RunsMetricsLegendWrapper>;\n  },\n);\n","import { Typography, useDesignSystemTheme } from '@databricks/design-system';\n\nimport React from 'react';\nimport type { Dash } from 'plotly.js';\n\nconst STROKE_WIDTH = 3;\n\n/**\n * Replicating plotly.js's dasharrays for each dash type, with smaller spaces\n * https://github.com/plotly/plotly.js/blob/master/src/components/drawing/index.js#L162\n */\nconst getDashArray = (dashType: Dash) => {\n  switch (dashType) {\n    case 'dot':\n      return `${STROKE_WIDTH}`;\n    case 'dash':\n      return `${2 * STROKE_WIDTH}, ${STROKE_WIDTH}`;\n    case 'longdash':\n      return `${3 * STROKE_WIDTH}, ${STROKE_WIDTH}`;\n    case 'dashdot':\n      return `${2 * STROKE_WIDTH}, ${STROKE_WIDTH}, ${STROKE_WIDTH}, ${STROKE_WIDTH}`;\n    case 'longdashdot':\n      return `${3 * STROKE_WIDTH}, ${STROKE_WIDTH}, ${STROKE_WIDTH}, ${STROKE_WIDTH}`;\n    default:\n      return '';\n  }\n};\n\nexport type LegendLabelData = {\n  label: string;\n  color: string;\n  dashStyle?: Dash;\n  uuid?: string;\n  metricKey?: string;\n};\n\nconst TraceLabel: React.FC<React.PropsWithChildren<LegendLabelData>> = ({ label, color, dashStyle }) => {\n  const { theme } = useDesignSystemTheme();\n\n  return (\n    <div\n      css={{\n        display: 'flex',\n        alignItems: 'center',\n        textOverflow: 'ellipsis',\n        flexShrink: 0,\n        marginRight: theme.spacing.md,\n        maxWidth: '100%',\n      }}\n    >\n      <TraceLabelColorIndicator color={color} dashStyle={dashStyle} />\n      <Typography.Text\n        color=\"secondary\"\n        size=\"sm\"\n        css={{ whiteSpace: 'nowrap', textOverflow: 'ellipsis', overflow: 'hidden' }}\n      >\n        {label}\n      </Typography.Text>\n    </div>\n  );\n};\n\nexport const TraceLabelColorIndicator: React.FC<\n  React.PropsWithChildren<Pick<LegendLabelData, 'color' | 'dashStyle'>>\n> = ({ color, dashStyle }) => {\n  const { theme } = useDesignSystemTheme();\n  const strokeDasharray = dashStyle ? getDashArray(dashStyle) : undefined;\n  const pathYOffset = theme.typography.fontSizeSm / 2;\n\n  return (\n    <svg\n      css={{\n        height: theme.typography.fontSizeSm,\n        width: STROKE_WIDTH * 8,\n        marginRight: theme.spacing.xs,\n        flexShrink: 0,\n      }}\n    >\n      <path\n        d={`M0,${pathYOffset}h${STROKE_WIDTH * 8}`}\n        style={{\n          strokeWidth: STROKE_WIDTH,\n          stroke: color,\n          strokeDasharray,\n        }}\n      />\n    </svg>\n  );\n};\ntype RunsMetricsLegendProps = {\n  labelData: LegendLabelData[];\n  height: number;\n  fullScreen?: boolean;\n};\n\nconst RunsMetricsLegend: React.FC<React.PropsWithChildren<RunsMetricsLegendProps>> = ({\n  labelData,\n  height,\n  fullScreen,\n}) => {\n  const { theme } = useDesignSystemTheme();\n\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexWrap: 'wrap',\n        height,\n        alignContent: fullScreen ? 'flex-start' : 'normal',\n        gap: fullScreen ? theme.spacing.sm : 0,\n        overflowY: 'auto',\n        overflowX: 'hidden',\n        marginTop: fullScreen ? theme.spacing.lg : theme.spacing.sm,\n      }}\n    >\n      {labelData.map((labelDatum) => (\n        <TraceLabel key={labelDatum.uuid ?? labelDatum.label} {...labelDatum} />\n      ))}\n    </div>\n  );\n};\n\nexport default RunsMetricsLegend;\n","import {\n  LegacySelect,\n  SimpleSelect,\n  SimpleSelectOption,\n  SimpleSelectOptionGroup,\n  Tag,\n  Typography,\n  useDesignSystemTheme,\n} from '@databricks/design-system';\nimport type { ComponentProps, PropsWithChildren } from 'react';\nimport React, { useMemo } from 'react';\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport { makeCanonicalSortKey } from '../../../experiment-page/utils/experimentPage.common-utils';\n\n/**\n * Represents a field in the compare run charts configuration modal.\n * Displays a title and content with proper margins.\n */\nexport const RunsChartsConfigureField = ({\n  title,\n  compact = false,\n  children,\n}: PropsWithChildren<{\n  title: React.ReactNode;\n  compact?: boolean;\n}>) => {\n  const { theme } = useDesignSystemTheme();\n  return (\n    <div\n      css={{ marginBottom: compact ? theme.spacing.sm : theme.spacing.md * 2 }}\n      data-testid=\"experiment-view-compare-runs-config-field\"\n    >\n      <Typography.Title level={4}>{title}</Typography.Title>\n      {children}\n    </div>\n  );\n};\n\n/**\n * A searchable select for selecting metric or param from a categorized list.\n */\nexport const RunsChartsMetricParamSelect = ({\n  value,\n  onChange,\n  metricKeyList,\n  paramKeyList,\n}: {\n  value: string;\n  onChange: ComponentProps<typeof LegacySelect>['onChange'];\n  metricKeyList?: string[];\n  paramKeyList?: string[];\n}) => {\n  const { formatMessage } = useIntl();\n\n  const isEmpty = !paramKeyList?.length && !metricKeyList?.length;\n\n  return (\n    <LegacySelect\n      css={styles.selectFull}\n      value={\n        isEmpty\n          ? formatMessage({\n              description:\n                'Message displayed when no metrics or params are available in the compare runs chart configure modal',\n              defaultMessage: 'No metrics or parameters available',\n            })\n          : value\n      }\n      disabled={isEmpty}\n      onChange={onChange}\n      dangerouslySetAntdProps={{ showSearch: true }}\n    >\n      {metricKeyList?.length ? (\n        <LegacySelect.OptGroup\n          label={formatMessage({\n            defaultMessage: 'Metrics',\n            description: \"Label for 'metrics' option group in the compare runs chart configure modal\",\n          })}\n        >\n          {metricKeyList.map((metric) => (\n            <LegacySelect.Option\n              key={makeCanonicalSortKey('METRIC', metric)}\n              value={makeCanonicalSortKey('METRIC', metric)}\n            >\n              {metric}\n            </LegacySelect.Option>\n          ))}\n        </LegacySelect.OptGroup>\n      ) : null}\n      {paramKeyList?.length ? (\n        <LegacySelect.OptGroup\n          label={formatMessage({\n            defaultMessage: 'Params',\n            description: \"Label for 'params' option group in the compare runs chart configure modal\",\n          })}\n        >\n          {paramKeyList.map((param) => (\n            <LegacySelect.Option\n              key={makeCanonicalSortKey('PARAM', param)}\n              value={makeCanonicalSortKey('PARAM', param)}\n            >\n              {param}\n            </LegacySelect.Option>\n          ))}\n        </LegacySelect.OptGroup>\n      ) : null}\n    </LegacySelect>\n  );\n};\n\nexport const RunsChartsMetricParamSelectV2 = ({\n  value,\n  id,\n  onChange,\n  metricOptions = [],\n  paramOptions = [],\n}: {\n  value: string;\n  id: string;\n  onChange: (value: string) => void;\n  metricOptions: {\n    key: string;\n    datasetName: string | undefined;\n    metricKey: string;\n  }[];\n  paramOptions: {\n    key: string;\n    paramKey: string;\n  }[];\n}) => {\n  const { formatMessage } = useIntl();\n\n  const isEmpty = !paramOptions.length && !metricOptions.length;\n\n  return (\n    <SimpleSelect\n      componentId=\"mlflow.charts.chart_configure.metric_with_dataset_select\"\n      id={id}\n      css={styles.selectFull}\n      value={\n        isEmpty\n          ? formatMessage({\n              description:\n                'Message displayed when no metrics or params are available in the compare runs chart configure modal',\n              defaultMessage: 'No metrics or parameters available',\n            })\n          : value\n      }\n      disabled={isEmpty}\n      onChange={({ target }) => {\n        onChange(target.value);\n      }}\n      contentProps={{\n        matchTriggerWidth: true,\n        maxHeight: 500,\n      }}\n    >\n      {metricOptions?.length ? (\n        <SimpleSelectOptionGroup\n          label={formatMessage({\n            defaultMessage: 'Metrics',\n            description: \"Label for 'metrics' option group in the compare runs chart configure modal\",\n          })}\n        >\n          {metricOptions.map(({ datasetName, key, metricKey }) => (\n            <SimpleSelectOption key={key} value={key}>\n              {datasetName && (\n                <Tag componentId=\"mlflow.charts.chart_configure.metric_with_dataset_select.tag\">{datasetName}</Tag>\n              )}{' '}\n              {metricKey}\n            </SimpleSelectOption>\n          ))}\n        </SimpleSelectOptionGroup>\n      ) : null}\n      {paramOptions?.length ? (\n        <SimpleSelectOptionGroup\n          label={formatMessage({\n            defaultMessage: 'Params',\n            description: \"Label for 'params' option group in the compare runs chart configure modal\",\n          })}\n        >\n          {paramOptions.map(({ key, paramKey }) => (\n            <SimpleSelectOption key={key} value={key}>\n              {paramKey}\n            </SimpleSelectOption>\n          ))}\n        </SimpleSelectOptionGroup>\n      ) : null}\n    </SimpleSelect>\n  );\n};\n\nexport const runsChartsRunCountDefaultOptions: { value: number; label: React.ReactNode }[] = [\n  // We're not using any procedural generation so react-intl extractor can parse it\n  {\n    value: 5,\n    label: (\n      <FormattedMessage\n        defaultMessage=\"5\"\n        description=\"Label for 5 first runs visible in run count selector within runs compare configuration modal\"\n      />\n    ),\n  },\n  {\n    value: 10,\n    label: (\n      <FormattedMessage\n        defaultMessage=\"10\"\n        description=\"Label for 10 first runs visible in run count selector within runs compare configuration modal\"\n      />\n    ),\n  },\n  {\n    value: 20,\n    label: (\n      <FormattedMessage\n        defaultMessage=\"20\"\n        description=\"Label for 20 first runs visible in run count selector within runs compare configuration modal\"\n      />\n    ),\n  },\n];\n\nconst styles = { selectFull: { width: '100%' } };\n","import { SimpleSelect, SimpleSelectOption, Tag } from '@databricks/design-system';\nimport type { RunsChartsMetricByDatasetEntry } from '../../runs-charts.types';\n\nexport const RunsChartsConfigureMetricWithDatasetSelect = ({\n  metricKeysByDataset,\n  value,\n  onChange,\n}: {\n  metricKeysByDataset?: RunsChartsMetricByDatasetEntry[];\n  value?: string;\n  onChange: (metricByDatasetEntry: RunsChartsMetricByDatasetEntry) => void;\n}) => {\n  return (\n    <SimpleSelect\n      css={{ width: '100%' }}\n      componentId=\"mlflow.charts.chart_configure.metric_with_dataset_select\"\n      id=\"mlflow.charts.chart_configure.metric_with_dataset_select\"\n      value={value}\n      onChange={({ target }) => {\n        const entry = metricKeysByDataset?.find(({ dataAccessKey }) => dataAccessKey === target.value);\n        if (entry) {\n          onChange(entry);\n        }\n      }}\n      contentProps={{\n        matchTriggerWidth: true,\n        maxHeight: 400,\n      }}\n    >\n      {metricKeysByDataset?.map(({ datasetName, metricKey, dataAccessKey }) => (\n        <SimpleSelectOption key={dataAccessKey} value={dataAccessKey}>\n          {datasetName && (\n            <Tag componentId=\"mlflow.charts.chart_configure.metric_with_dataset_select.tag\">{datasetName}</Tag>\n          )}{' '}\n          {metricKey}\n        </SimpleSelectOption>\n      ))}\n    </SimpleSelect>\n  );\n};\n","import { LegacySelect } from '@databricks/design-system';\nimport { useCallback, useEffect } from 'react';\nimport type {\n  RunsChartsCardConfig,\n  RunsChartsBarCardConfig,\n  RunsChartsMetricByDatasetEntry,\n} from '../../runs-charts.types';\nimport { RunsChartsConfigureField, runsChartsRunCountDefaultOptions } from './RunsChartsConfigure.common';\nimport { isEmpty } from 'lodash';\nimport { RunsChartsConfigureMetricWithDatasetSelect } from './RunsChartsConfigureMetricWithDatasetSelect';\n\n/**\n * Form containing configuration controls for runs compare charts.\n */\nexport const RunsChartsConfigureBarChart = ({\n  state,\n  onStateChange,\n  metricKeyList,\n  metricKeysByDataset,\n}: {\n  metricKeyList: string[];\n  metricKeysByDataset?: RunsChartsMetricByDatasetEntry[];\n  state: Partial<RunsChartsBarCardConfig>;\n  onStateChange: (setter: (current: RunsChartsCardConfig) => RunsChartsBarCardConfig) => void;\n}) => {\n  /**\n   * Callback for updating metric key\n   */\n  const updateMetric = useCallback(\n    (metricKey: string, datasetName?: string, dataAccessKey?: string) => {\n      onStateChange((current) => ({ ...(current as RunsChartsBarCardConfig), metricKey, datasetName, dataAccessKey }));\n    },\n    [onStateChange],\n  );\n\n  /**\n   * Callback for updating run count\n   */\n  const updateVisibleRunCount = useCallback(\n    (runsCountToCompare: number) => {\n      onStateChange((current) => ({\n        ...(current as RunsChartsBarCardConfig),\n        runsCountToCompare,\n      }));\n    },\n    [onStateChange],\n  );\n\n  /**\n   * If somehow metric key is not predetermined, automatically\n   * select the first one so it's not empty\n   */\n  useEffect(() => {\n    if (!state.metricKey && metricKeysByDataset?.[0]) {\n      updateMetric(\n        metricKeysByDataset[0].metricKey,\n        metricKeysByDataset[0].datasetName,\n        metricKeysByDataset[0].dataAccessKey,\n      );\n      return;\n    }\n\n    if (!state.metricKey && metricKeyList?.[0]) {\n      updateMetric(metricKeyList[0]);\n    }\n  }, [state.metricKey, updateMetric, metricKeyList, metricKeysByDataset]);\n\n  const emptyMetricsList = metricKeyList.length === 0;\n\n  return (\n    <>\n      <RunsChartsConfigureField title=\"Metric\">\n        {!isEmpty(metricKeysByDataset) ? (\n          <RunsChartsConfigureMetricWithDatasetSelect\n            metricKeysByDataset={metricKeysByDataset}\n            onChange={({ metricKey, datasetName, dataAccessKey }) =>\n              updateMetric(metricKey, datasetName, dataAccessKey)\n            }\n            value={state.dataAccessKey ?? state.metricKey}\n          />\n        ) : (\n          <LegacySelect\n            css={styles.selectFull}\n            value={emptyMetricsList ? 'No metrics available' : state.metricKey}\n            onChange={(metricKey) => updateMetric(metricKey)}\n            disabled={emptyMetricsList}\n            dangerouslySetAntdProps={{ showSearch: true }}\n          >\n            {metricKeyList.map((metric) => (\n              <LegacySelect.Option key={metric} value={metric} data-testid={`metric-${metric}`}>\n                {metric}\n              </LegacySelect.Option>\n            ))}\n          </LegacySelect>\n        )}\n      </RunsChartsConfigureField>\n    </>\n  );\n};\n\nconst styles = { selectFull: { width: '100%' } };\n","import { LegacySelect } from '@databricks/design-system';\nimport { useCallback } from 'react';\nimport type { RunsChartsCardConfig, RunsChartsParallelCardConfig } from '../../runs-charts.types';\nimport { RunsChartsConfigureField } from './RunsChartsConfigure.common';\n\n/**\n * Form containing configuration controls for runs compare charts.\n */\nexport const RunsChartsConfigureParallelChart = ({\n  state,\n  onStateChange,\n  metricKeyList,\n  paramKeyList,\n}: {\n  metricKeyList: string[];\n  paramKeyList: string[];\n  state: Partial<RunsChartsParallelCardConfig>;\n  onStateChange: (setter: (current: RunsChartsCardConfig) => RunsChartsParallelCardConfig) => void;\n}) => {\n  /**\n   * Callback for updating selected metrics and params\n   */\n\n  const updateSelectedParams = useCallback(\n    (selectedParams: string[]) => {\n      onStateChange((current) => ({\n        ...(current as RunsChartsParallelCardConfig),\n        selectedParams,\n      }));\n    },\n    [onStateChange],\n  );\n\n  const updateSelectedMetrics = useCallback(\n    (selectedMetrics: string[]) => {\n      onStateChange((current) => ({\n        ...(current as RunsChartsParallelCardConfig),\n        selectedMetrics,\n      }));\n    },\n    [onStateChange],\n  );\n\n  const emptyMetricsList = metricKeyList.length === 0;\n  const emptyParamsList = paramKeyList.length === 0;\n\n  return (\n    <>\n      <RunsChartsConfigureField title=\"Params\">\n        <LegacySelect\n          mode={emptyParamsList ? undefined : 'multiple'}\n          onChange={updateSelectedParams}\n          style={{\n            width: 275,\n          }}\n          value={emptyParamsList ? ('No parameters available' as any) : state.selectedParams}\n          disabled={emptyParamsList}\n        >\n          {paramKeyList.map((param) => (\n            <LegacySelect.Option value={param} key={param}>\n              {param}\n            </LegacySelect.Option>\n          ))}\n        </LegacySelect>\n      </RunsChartsConfigureField>\n      <RunsChartsConfigureField title=\"Metrics\">\n        <LegacySelect\n          mode={emptyMetricsList ? undefined : 'multiple'}\n          onChange={updateSelectedMetrics}\n          style={{\n            width: 275,\n          }}\n          value={emptyMetricsList ? ('No metrics available' as any) : state.selectedMetrics}\n          disabled={emptyMetricsList}\n        >\n          {metricKeyList.map((metric) => (\n            <LegacySelect.Option value={metric} key={metric}>\n              {metric}\n            </LegacySelect.Option>\n          ))}\n        </LegacySelect>\n      </RunsChartsConfigureField>\n    </>\n  );\n};\n","import {\n  Button,\n  CloseIcon,\n  Input,\n  LegacySelect,\n  PlusIcon,\n  Radio,\n  useDesignSystemTheme,\n} from '@databricks/design-system';\nimport type {\n  RunsChartsCardConfig,\n  RunsChartsLineCardConfig,\n  RunsChartsLineChartExpression,\n} from '../runs-charts.types';\nimport { RunsChartsLineChartYAxisType } from '../runs-charts.types';\nimport { RunsChartsConfigureField } from './config/RunsChartsConfigure.common';\nimport { FormattedMessage } from 'react-intl';\nimport { shouldEnableChartExpressions } from '@mlflow/mlflow/src/common/utils/FeatureUtils';\nimport { useCallback, useEffect, useState } from 'react';\nimport { useChartExpressionParser } from '../hooks/useChartExpressionParser';\nimport { RunsChartsLineChartXAxisType } from './RunsCharts.common';\n\nconst renderMetricSelectorV1 = ({\n  metricKeyList,\n  metricKey,\n  updateMetric,\n}: {\n  metricKeyList: string[];\n  metricKey?: string;\n  updateMetric: (metricKey: string) => void;\n}) => {\n  const emptyMetricsList = metricKeyList.length === 0;\n\n  return (\n    <LegacySelect\n      css={{ width: '100%' }}\n      value={emptyMetricsList ? 'No metrics available' : metricKey}\n      onChange={updateMetric}\n      disabled={emptyMetricsList}\n      dangerouslySetAntdProps={{ showSearch: true }}\n    >\n      {metricKeyList.map((metric) => (\n        <LegacySelect.Option key={metric} value={metric} data-testid={`metric-${metric}`}>\n          {metric}\n        </LegacySelect.Option>\n      ))}\n    </LegacySelect>\n  );\n};\n\nconst renderMetricSelectorV2 = ({\n  metricKeyList,\n  selectedMetricKeys,\n  updateSelectedMetrics,\n}: {\n  metricKeyList: string[];\n  selectedMetricKeys?: string[];\n  updateSelectedMetrics: (metricKeys: string[]) => void;\n}) => {\n  const emptyMetricsList = metricKeyList.length === 0;\n\n  return (\n    <LegacySelect\n      mode=\"multiple\"\n      placeholder={\n        emptyMetricsList ? (\n          <FormattedMessage\n            defaultMessage=\"No metrics available\"\n            description=\"Text shown in a disabled multi-selector when there are no selectable metrics.\"\n          />\n        ) : (\n          <FormattedMessage\n            defaultMessage=\"Select metrics\"\n            description=\"Placeholder text for a metric multi-selector when configuring a line chart\"\n          />\n        )\n      }\n      css={{ width: '100%' }}\n      value={emptyMetricsList ? [] : selectedMetricKeys}\n      onChange={updateSelectedMetrics}\n      disabled={emptyMetricsList}\n      dangerouslySetAntdProps={{ showSearch: true }}\n    >\n      {metricKeyList.map((metric) => (\n        <LegacySelect.Option key={metric} value={metric} data-testid={`metric-${metric}`}>\n          {metric}\n        </LegacySelect.Option>\n      ))}\n    </LegacySelect>\n  );\n};\n\nconst ExpressionInput = ({\n  chartExpression,\n  index,\n  updateYAxisExpression,\n  removeYAxisExpression,\n  metricKeyList,\n}: {\n  chartExpression: RunsChartsLineChartExpression;\n  index: number;\n  updateYAxisExpression: (expression: RunsChartsLineChartExpression, index: number) => void;\n  removeYAxisExpression: (index: number) => void;\n  metricKeyList: string[];\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const { compileExpression } = useChartExpressionParser();\n  const [isValidExpression, setIsValidExpression] = useState(true);\n  const validateAndUpdate = (expression: string) => {\n    const compiledExpression = compileExpression(expression, metricKeyList);\n    if (compiledExpression === undefined) {\n      setIsValidExpression(false);\n      updateYAxisExpression({ rpn: [], variables: [], expression }, index);\n    } else {\n      setIsValidExpression(true);\n      updateYAxisExpression(compiledExpression, index);\n    }\n  };\n\n  return (\n    <span css={{ display: 'flex', width: '100%', gap: theme.spacing.sm }}>\n      <Input\n        componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_runschartsyaxismetricandexpressionselector.tsx_122\"\n        value={chartExpression.expression}\n        onChange={(e) => validateAndUpdate(e.target.value)}\n        validationState={isValidExpression ? undefined : 'error'}\n      />\n      <Button\n        componentId=\"mlflow.charts.line-chart-expressions-remove\"\n        icon={<CloseIcon />}\n        onClick={() => removeYAxisExpression(index)}\n      />\n    </span>\n  );\n};\n\nexport const RunsChartsYAxisMetricAndExpressionSelector = ({\n  state,\n  onStateChange,\n  metricKeyList,\n  updateSelectedMetrics,\n}: {\n  state: Partial<RunsChartsLineCardConfig>;\n  onStateChange: (setter: (current: RunsChartsCardConfig) => RunsChartsLineCardConfig) => void;\n  metricKeyList: string[];\n  updateSelectedMetrics: (metricKeys: string[]) => void;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const usingChartExpressions =\n    shouldEnableChartExpressions() && state.xAxisKey !== RunsChartsLineChartXAxisType.METRIC;\n\n  const DEBOUNCE_DELAY = 300; // in ms\n\n  const [temporaryChartExpressions, setTemporaryChartExpressions] = useState<RunsChartsLineChartExpression[]>(\n    state.yAxisExpressions || [],\n  );\n\n  const updateYAxisExpressionTemporary = (expression: RunsChartsLineChartExpression, index: number) => {\n    setTemporaryChartExpressions((current) => {\n      const newExpressions = [...current];\n      newExpressions[index] = expression;\n      return newExpressions;\n    });\n  };\n\n  const addNewYAxisExpressionTemporary = () => {\n    setTemporaryChartExpressions((current) => {\n      return [...current, { rpn: [], variables: [], expression: '' } as RunsChartsLineChartExpression];\n    });\n  };\n\n  const removeYAxisExpressionTemporary = (index: number) => {\n    setTemporaryChartExpressions((current) => {\n      const newExpressions = [...current];\n      newExpressions.splice(index, 1);\n      return newExpressions;\n    });\n  };\n\n  useEffect(() => {\n    const updateYAxisExpression = (yAxisExpressions: RunsChartsLineChartExpression[]) => {\n      onStateChange((current) => {\n        const config = current as RunsChartsLineCardConfig;\n        return {\n          ...config,\n          yAxisExpressions,\n        };\n      });\n    };\n    const handler = setTimeout(() => {\n      updateYAxisExpression(temporaryChartExpressions);\n    }, DEBOUNCE_DELAY);\n\n    return () => {\n      clearTimeout(handler);\n    };\n  }, [temporaryChartExpressions, onStateChange]);\n\n  const updateYAxisKey = useCallback(\n    (yAxisKey: RunsChartsLineCardConfig['yAxisKey']) => {\n      onStateChange((current) => {\n        const config = current as RunsChartsLineCardConfig;\n        return {\n          ...config,\n          yAxisKey,\n          range: {\n            ...config.range,\n            yMin: undefined,\n            yMax: undefined,\n          },\n        };\n      });\n    },\n    [onStateChange],\n  );\n\n  return (\n    <>\n      {usingChartExpressions && (\n        <RunsChartsConfigureField title=\"Metric type\" compact>\n          <Radio.Group\n            componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_runschartsyaxismetricandexpressionselector.tsx_221\"\n            name=\"runs-charts-field-group-metric-type-y-axis\"\n            value={state.yAxisKey || RunsChartsLineChartYAxisType.METRIC}\n            onChange={({ target: { value } }) => updateYAxisKey(value)}\n          >\n            <Radio value={RunsChartsLineChartYAxisType.METRIC} key={RunsChartsLineChartYAxisType.METRIC}>\n              <FormattedMessage\n                defaultMessage=\"Logged metrics\"\n                description=\"Experiment tracking > runs charts > line chart configuration > logged metrics label\"\n              />\n            </Radio>\n            <Radio value={RunsChartsLineChartYAxisType.EXPRESSION} key={RunsChartsLineChartYAxisType.EXPRESSION}>\n              <FormattedMessage\n                defaultMessage=\"Custom expression\"\n                description=\"Experiment tracking > runs charts > line chart configuration > custom expression label\"\n              />\n            </Radio>\n          </Radio.Group>\n        </RunsChartsConfigureField>\n      )}\n      {usingChartExpressions && state.yAxisKey === RunsChartsLineChartYAxisType.EXPRESSION ? (\n        <RunsChartsConfigureField title=\"Expression\" compact>\n          <div css={{ display: 'flex', flexDirection: 'column', alignItems: 'flex-start', gap: theme.spacing.sm }}>\n            {temporaryChartExpressions.map((chartExpression, index) => {\n              return (\n                <ExpressionInput\n                  key={index}\n                  chartExpression={chartExpression}\n                  index={index}\n                  updateYAxisExpression={updateYAxisExpressionTemporary}\n                  removeYAxisExpression={removeYAxisExpressionTemporary}\n                  metricKeyList={metricKeyList}\n                />\n              );\n            })}\n            <Button\n              componentId=\"mlflow.charts.line-chart-expressions-add-new\"\n              icon={<PlusIcon />}\n              onClick={addNewYAxisExpressionTemporary}\n            >\n              Add new\n            </Button>\n          </div>\n        </RunsChartsConfigureField>\n      ) : (\n        <RunsChartsConfigureField title=\"Metric\" compact>\n          {renderMetricSelectorV2({\n            metricKeyList,\n            selectedMetricKeys: state.selectedMetricKeys,\n            updateSelectedMetrics,\n          })}\n        </RunsChartsConfigureField>\n      )}\n    </>\n  );\n};\n","import type { ThemeType } from '@databricks/design-system';\nimport {\n  Radio,\n  LegacySelect,\n  Switch,\n  LegacyTooltip,\n  QuestionMarkIcon,\n  useDesignSystemTheme,\n  SegmentedControlGroup,\n  SegmentedControlButton,\n  InfoSmallIcon,\n  Input,\n  FormUI,\n  Typography,\n  SimpleSelect,\n  SimpleSelectOption,\n  SimpleSelectOptionGroup,\n  Tooltip,\n  PlusIcon,\n  Button,\n  Spacer,\n  CloseIcon,\n} from '@databricks/design-system';\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport { useCallback, useEffect, useState } from 'react';\nimport {\n  RunsChartsLineChartYAxisType,\n  type ChartRange,\n  type RunsChartsCardConfig,\n  type RunsChartsLineCardConfig,\n} from '../../runs-charts.types';\nimport { RunsChartsConfigureField } from './RunsChartsConfigure.common';\nimport { shouldEnableChartExpressions } from '@mlflow/mlflow/src/common/utils/FeatureUtils';\nimport { RunsChartsLineChartXAxisType } from '@mlflow/mlflow/src/experiment-tracking/components/runs-charts/components/RunsCharts.common';\nimport { LineSmoothSlider } from '@mlflow/mlflow/src/experiment-tracking/components/LineSmoothSlider';\nimport { isUndefined } from 'lodash';\nimport { RunsChartsYAxisMetricAndExpressionSelector } from '../RunsChartsYAxisMetricAndExpressionSelector';\n\nconst USE_GLOBAL_SETTING_KEY = '_GLOBAL';\n\nconst renderXAxisMetricSelector = ({\n  theme,\n  metricKeyList,\n  selectedXAxisMetricKey,\n  updateSelectedXAxisMetricKey,\n  disabled = false,\n}: {\n  theme: ThemeType;\n  metricKeyList: string[];\n  selectedXAxisMetricKey?: string;\n  updateSelectedXAxisMetricKey: (metricKey: string) => void;\n  disabled?: boolean;\n}) => {\n  const emptyMetricsList = metricKeyList.length === 0;\n\n  return (\n    <Radio value={RunsChartsLineChartXAxisType.METRIC} disabled={disabled}>\n      <FormattedMessage\n        defaultMessage=\"Metric\"\n        description=\"Label for a radio button that configures the x-axis on a line chart. This option makes the X-axis a custom metric that the user selects.\"\n      />\n      <LegacySelect\n        css={{\n          marginTop: theme.spacing.xs,\n          width: '100%',\n        }}\n        value={selectedXAxisMetricKey || undefined}\n        placeholder={\n          emptyMetricsList ? (\n            <FormattedMessage\n              defaultMessage=\"No metrics available\"\n              description=\"Text shown in a disabled metric selector when there are no selectable metrics.\"\n            />\n          ) : (\n            <FormattedMessage\n              defaultMessage=\"Select metric\"\n              description=\"Placeholder text for a metric selector when configuring a line chart\"\n            />\n          )\n        }\n        onClick={(e: React.MouseEvent<HTMLElement>) => {\n          // this is to prevent the radio button\n          // from automatically closing the selector\n          e.preventDefault();\n          e.stopPropagation();\n        }}\n        onChange={updateSelectedXAxisMetricKey}\n        disabled={emptyMetricsList || disabled}\n        dangerouslySetAntdProps={{ showSearch: true }}\n      >\n        {metricKeyList.map((metric) => (\n          <LegacySelect.Option key={metric} value={metric} data-testid={`metric-${metric}`}>\n            {metric}\n          </LegacySelect.Option>\n        ))}\n      </LegacySelect>\n    </Radio>\n  );\n};\n\nconst safeLog = (x: number | undefined) => {\n  if (isUndefined(x)) {\n    return x;\n  }\n  if (x <= 0) {\n    return undefined;\n  }\n  return Math.log10(x);\n};\n\nconst safePow = (x: number | undefined) => {\n  if (isUndefined(x)) {\n    return x;\n  }\n  return Math.pow(10, x);\n};\n\n/**\n * Form containing configuration controls for runs compare charts.\n */\nexport const RunsChartsConfigureLineChart = ({\n  state,\n  onStateChange,\n  metricKeyList,\n}: {\n  metricKeyList: string[];\n  state: Partial<RunsChartsLineCardConfig>;\n  onStateChange: (setter: (current: RunsChartsCardConfig) => RunsChartsLineCardConfig) => void;\n}) => {\n  const usingChartExpressions = shouldEnableChartExpressions();\n  const { theme } = useDesignSystemTheme();\n  const intl = useIntl();\n  const runSelectOptions = [5, 10, 20, 50, 100];\n\n  const [localAxisRange, setLocalAxisRange] = useState<ChartRange>({\n    xMin: state.xAxisScaleType === 'log' ? safePow(state.range?.xMin) : state.range?.xMin,\n    xMax: state.xAxisScaleType === 'log' ? safePow(state.range?.xMax) : state.range?.xMax,\n    yMin: state.scaleType === 'log' ? safePow(state.range?.yMin) : state.range?.yMin,\n    yMax: state.scaleType === 'log' ? safePow(state.range?.yMax) : state.range?.yMax,\n  });\n\n  /**\n   * Callback for updating metric key\n   */\n  const updateMetric = useCallback(\n    (metricKey: string) => {\n      onStateChange((current) => ({ ...(current as RunsChartsLineCardConfig), metricKey }));\n    },\n    [onStateChange],\n  );\n\n  const updateSelectedMetrics = useCallback(\n    (metricKeys: string[]) => {\n      onStateChange((current) => ({\n        ...(current as RunsChartsLineCardConfig),\n        metricKey: metricKeys[0],\n        selectedMetricKeys: metricKeys,\n      }));\n    },\n    [onStateChange],\n  );\n\n  const updateXAxisKey = useCallback(\n    (xAxisKey: RunsChartsLineCardConfig['xAxisKey'], useGlobal = false) => {\n      onStateChange((current) => {\n        const config = current as RunsChartsLineCardConfig;\n        return {\n          ...config,\n          xAxisKey,\n          selectedXAxisMetricKey: '',\n          range: {\n            ...config.range,\n            xMin: undefined,\n            xMax: undefined,\n          },\n          useGlobalXaxisKey: useGlobal ?? config.useGlobalXaxisKey,\n          selectedYAxisMetricKey: RunsChartsLineChartYAxisType.METRIC,\n        };\n      });\n    },\n    [onStateChange],\n  );\n\n  const isInvalidLogValue = (value: number | undefined) => !isUndefined(value) && value <= 0;\n\n  const updateXAxisScaleType = useCallback(\n    (isLogType: boolean) => {\n      onStateChange((current) => {\n        const config = current as RunsChartsLineCardConfig;\n\n        let newXMin = isLogType ? safeLog(localAxisRange.xMin) : localAxisRange.xMin;\n        let newXMax = isLogType ? safeLog(localAxisRange.xMax) : localAxisRange.xMax;\n        if (isLogType && isInvalidLogValue(localAxisRange.xMin) && localAxisRange.xMax && localAxisRange.xMax > 1) {\n          // when switching to log type, if only xMin is invalid, set xMin to 1.\n          setLocalAxisRange((prev) => ({\n            ...prev,\n            xMin: 1,\n          }));\n          newXMin = 0;\n        } else if (isLogType && (isInvalidLogValue(localAxisRange.xMin) || isInvalidLogValue(localAxisRange.xMax))) {\n          setLocalAxisRange((prev) => ({\n            ...prev,\n            xMin: undefined,\n            xMax: undefined,\n          }));\n          newXMin = undefined;\n          newXMax = undefined;\n        }\n        return {\n          ...config,\n          xAxisScaleType: isLogType ? 'log' : 'linear',\n          range: {\n            ...config.range,\n            xMin: newXMin,\n            xMax: newXMax,\n          },\n        };\n      });\n    },\n    [onStateChange, localAxisRange.xMin, localAxisRange.xMax],\n  );\n\n  const updateSelectedXAxisMetricKey = useCallback(\n    (selectedXAxisMetricKey: string) => {\n      onStateChange((current) => ({\n        ...(current as RunsChartsLineCardConfig),\n        selectedXAxisMetricKey,\n        xAxisKey: RunsChartsLineChartXAxisType.METRIC,\n      }));\n    },\n    [onStateChange],\n  );\n\n  const updateYAxisType = useCallback(\n    (isLogType: boolean) => {\n      onStateChange((current) => {\n        const config = current as RunsChartsLineCardConfig;\n\n        let newYMin = isLogType ? safeLog(localAxisRange.yMin) : localAxisRange.yMin;\n        let newYMax = isLogType ? safeLog(localAxisRange.yMax) : localAxisRange.yMax;\n        if (isLogType && isInvalidLogValue(localAxisRange.yMin) && localAxisRange.yMax && localAxisRange.yMax > 1) {\n          // when switching to log type, if only yMin is invalid, set yMin to 1.\n          setLocalAxisRange((prev) => ({\n            ...prev,\n            yMin: 1,\n          }));\n          newYMin = 0; // This is the logged value of 1.\n        } else if (isLogType && (isInvalidLogValue(localAxisRange.yMin) || isInvalidLogValue(localAxisRange.yMax))) {\n          setLocalAxisRange((prev) => ({\n            ...prev,\n            yMin: undefined,\n            yMax: undefined,\n          }));\n          newYMin = undefined;\n          newYMax = undefined;\n        }\n        return {\n          ...config,\n          scaleType: isLogType ? 'log' : 'linear',\n          range: {\n            ...config.range,\n            yMin: newYMin,\n            yMax: newYMax,\n          },\n        };\n      });\n    },\n    [onStateChange, localAxisRange.yMin, localAxisRange.yMax],\n  );\n\n  const updateIgnoreOutliers = useCallback(\n    (ignoreOutliers: boolean) => {\n      onStateChange((current) => ({\n        ...(current as RunsChartsLineCardConfig),\n        ignoreOutliers,\n      }));\n    },\n    [onStateChange],\n  );\n\n  const updateSmoothing = useCallback(\n    (lineSmoothness: number) => {\n      onStateChange((current) => ({\n        ...(current as RunsChartsLineCardConfig),\n        lineSmoothness: lineSmoothness,\n      }));\n    },\n    [onStateChange],\n  );\n\n  /**\n   * Callback for updating run count\n   */\n  const updateVisibleRunCount = useCallback(\n    (runsCountToCompare: number) => {\n      onStateChange((current) => ({\n        ...(current as RunsChartsLineCardConfig),\n        runsCountToCompare,\n      }));\n    },\n    [onStateChange],\n  );\n\n  /**\n   * If somehow metric key is not predetermined, automatically\n   * select the first one so it's not empty\n   */\n  useEffect(() => {\n    if (!state.metricKey && metricKeyList?.[0]) {\n      updateMetric(metricKeyList[0]);\n    }\n  }, [state.metricKey, updateMetric, metricKeyList]);\n\n  // for backwards compatibility, if selectedMetricKeys\n  // is not present, set it using metricKey.\n  useEffect(() => {\n    if (isUndefined(state.selectedMetricKeys) && !isUndefined(state.metricKey) && state.metricKey !== '') {\n      updateSelectedMetrics([state.metricKey]);\n    }\n  }, [state.selectedMetricKeys, state.metricKey, updateSelectedMetrics]);\n\n  const updateXAxisWhenConfirmed = (xMin: number | undefined, xMax: number | undefined) => {\n    if (inTransitionState(xMin, xMax)) {\n      return;\n    }\n    onStateChange((current) => {\n      const config = current as RunsChartsLineCardConfig;\n      return {\n        ...config,\n        range: {\n          ...config.range,\n          xMin: config.xAxisScaleType === 'log' ? safeLog(xMin) : xMin,\n          xMax: config.xAxisScaleType === 'log' ? safeLog(xMax) : xMax,\n        },\n      };\n    });\n  };\n\n  const updateYAxisWhenConfirmed = (yMin: number | undefined, yMax: number | undefined) => {\n    if (inTransitionState(yMin, yMax)) {\n      return;\n    }\n    onStateChange((current) => {\n      const config = current as RunsChartsLineCardConfig;\n      return {\n        ...config,\n        range: {\n          ...config.range,\n          yMin: config.scaleType === 'log' ? safeLog(yMin) : yMin,\n          yMax: config.scaleType === 'log' ? safeLog(yMax) : yMax,\n        },\n      };\n    });\n  };\n\n  const updateXAxisScaleMin = (xMin: string) => {\n    const newXMin = xMin ? Number(xMin) : undefined;\n    setLocalAxisRange((prev) => ({ ...prev, xMin: newXMin }));\n    updateXAxisWhenConfirmed(newXMin, localAxisRange.xMax);\n  };\n  const updateXAxisScaleMax = (xMax: string) => {\n    const newXMax = xMax ? Number(xMax) : undefined;\n    setLocalAxisRange((prev) => ({ ...prev, xMax: newXMax }));\n    updateXAxisWhenConfirmed(localAxisRange.xMin, newXMax);\n  };\n  const updateYAxisScaleMin = (yMin: string) => {\n    const newYMin = yMin ? Number(yMin) : undefined;\n    setLocalAxisRange((prev) => ({ ...prev, yMin: newYMin }));\n    updateYAxisWhenConfirmed(newYMin, localAxisRange.yMax);\n  };\n  const updateYAxisScaleMax = (yMax: string) => {\n    const newYMax = yMax ? Number(yMax) : undefined;\n    setLocalAxisRange((prev) => ({ ...prev, yMax: newYMax }));\n    updateYAxisWhenConfirmed(localAxisRange.yMin, newYMax);\n  };\n\n  const inTransitionState = (a: number | undefined, b: number | undefined) => {\n    if (isUndefined(a) && isUndefined(b)) {\n      return false;\n    } else if (!isUndefined(a) && !isUndefined(b)) {\n      return false;\n    } else {\n      return true;\n    }\n  };\n\n  const invalidMessage = (scaleType: 'log' | 'linear' | undefined, value: number | undefined) => {\n    if (scaleType === 'log' && isInvalidLogValue(value)) {\n      return (\n        <FormUI.Message\n          message={\n            <FormattedMessage\n              defaultMessage=\"Invalid log value\"\n              description=\"Experiment tracking > runs charts > line chart configuration > invalid log value message\"\n            />\n          }\n          type=\"warning\"\n        />\n      );\n    }\n    return null;\n  };\n\n  const METRIC_AXIS_PREFIX = 'metric-';\n  return (\n    <>\n      <Typography.Title level={4} color=\"secondary\">\n        X-axis\n      </Typography.Title>\n      <RunsChartsConfigureField title=\"Type\" compact>\n        {usingChartExpressions ? (\n          <SimpleSelect\n            componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_config_runschartsconfigurelinechart.tsx_436\"\n            id=\"x-axis-type\"\n            width=\"100%\"\n            value={state.useGlobalXaxisKey ? USE_GLOBAL_SETTING_KEY : state.xAxisKey}\n            contentProps={{ matchTriggerWidth: true, textOverflowMode: 'ellipsis' }}\n            onChange={({ target: { value } }) => {\n              if (value.startsWith(METRIC_AXIS_PREFIX)) {\n                updateSelectedXAxisMetricKey(value.slice(METRIC_AXIS_PREFIX.length));\n              } else if (value === RunsChartsLineChartXAxisType.STEP) {\n                updateXAxisKey(RunsChartsLineChartXAxisType.STEP);\n              } else if (value === RunsChartsLineChartXAxisType.TIME) {\n                updateXAxisKey(RunsChartsLineChartXAxisType.TIME);\n              } else if (value === RunsChartsLineChartXAxisType.TIME_RELATIVE) {\n                updateXAxisKey(RunsChartsLineChartXAxisType.TIME_RELATIVE);\n              } else if (value === USE_GLOBAL_SETTING_KEY) {\n                updateXAxisKey(RunsChartsLineChartXAxisType.STEP, true);\n              }\n            }}\n          >\n            <SimpleSelectOption value={USE_GLOBAL_SETTING_KEY}>\n              <FormattedMessage\n                defaultMessage=\"Use workspace settings\"\n                description=\"Label for a radio button that configures the x-axis on a line chart. This option is for using global workspace settings.\"\n              />\n            </SimpleSelectOption>\n            <SimpleSelectOption value={RunsChartsLineChartXAxisType.STEP}>\n              <FormattedMessage\n                defaultMessage=\"Step\"\n                description=\"Label for a radio button that configures the x-axis on a line chart. This option is for the step number that the metrics were logged.\"\n              />\n            </SimpleSelectOption>\n            <SimpleSelectOption value={RunsChartsLineChartXAxisType.TIME}>\n              <FormattedMessage\n                defaultMessage=\"Time (wall)\"\n                description=\"Label for a radio button that configures the x-axis on a line chart. This option is for the absolute time that the metrics were logged.\"\n              />\n              <Tooltip\n                componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_config_runschartsconfigurelinechart.tsx_474\"\n                content={\n                  <FormattedMessage\n                    defaultMessage=\"Absolute date and time\"\n                    description=\"A tooltip line chart configuration for the step function of wall time\"\n                  />\n                }\n                side=\"right\"\n              >\n                <span>\n                  {' '}\n                  <QuestionMarkIcon css={styles.timeStepQuestionMarkIcon} />\n                </span>\n              </Tooltip>\n            </SimpleSelectOption>\n            <SimpleSelectOption value={RunsChartsLineChartXAxisType.TIME_RELATIVE}>\n              <FormattedMessage\n                defaultMessage=\"Time (relative)\"\n                description=\"Label for a radio button that configures the x-axis on a line chart. This option is for relative time since the first metric was logged.\"\n              />\n              <Tooltip\n                componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_config_runschartsconfigurelinechart.tsx_494\"\n                content={\n                  <FormattedMessage\n                    defaultMessage=\"Amount of time that has passed since the first metric value was logged\"\n                    description=\"A tooltip line chart configuration for the step function of relative time\"\n                  />\n                }\n                side=\"right\"\n              >\n                <span>\n                  {' '}\n                  <QuestionMarkIcon css={styles.timeStepQuestionMarkIcon} />\n                </span>\n              </Tooltip>\n            </SimpleSelectOption>\n            {metricKeyList.length > 0 && (\n              <SimpleSelectOptionGroup label=\"Metrics\">\n                {metricKeyList.map((metric) => (\n                  <SimpleSelectOption\n                    key={metric}\n                    value={`${METRIC_AXIS_PREFIX}${metric}`}\n                    data-testid={`${METRIC_AXIS_PREFIX}${metric}`}\n                  >\n                    {metric}\n                  </SimpleSelectOption>\n                ))}\n              </SimpleSelectOptionGroup>\n            )}\n          </SimpleSelect>\n        ) : (\n          <Radio.Group\n            componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_config_runschartsconfigurelinechart.tsx_524\"\n            name=\"runs-charts-field-group-x-axis\"\n            value={state.useGlobalXaxisKey ? USE_GLOBAL_SETTING_KEY : state.xAxisKey}\n            onChange={({ target: { value } }) => {\n              if (value === USE_GLOBAL_SETTING_KEY) {\n                updateXAxisKey(RunsChartsLineChartXAxisType.STEP, true);\n              } else {\n                updateXAxisKey(value);\n              }\n            }}\n          >\n            <Radio value={USE_GLOBAL_SETTING_KEY}>\n              <FormattedMessage\n                defaultMessage=\"Use workspace settings\"\n                description=\"Label for a radio button that configures the x-axis on a line chart. This option is for using global workspace settings.\"\n              />\n            </Radio>\n\n            <Radio value={RunsChartsLineChartXAxisType.STEP}>\n              <FormattedMessage\n                defaultMessage=\"Step\"\n                description=\"Label for a radio button that configures the x-axis on a line chart. This option is for the step number that the metrics were logged.\"\n              />\n            </Radio>\n            <Radio value={RunsChartsLineChartXAxisType.TIME}>\n              <FormattedMessage\n                defaultMessage=\"Time (wall)\"\n                description=\"Label for a radio button that configures the x-axis on a line chart. This option is for the absolute time that the metrics were logged.\"\n              />\n              <LegacyTooltip\n                title={\n                  <FormattedMessage\n                    defaultMessage=\"Absolute date and time\"\n                    description=\"A tooltip line chart configuration for the step function of wall time\"\n                  />\n                }\n                placement=\"right\"\n              >\n                {' '}\n                <QuestionMarkIcon css={styles.timeStepQuestionMarkIcon} />\n              </LegacyTooltip>\n            </Radio>\n            <Radio value={RunsChartsLineChartXAxisType.TIME_RELATIVE}>\n              <FormattedMessage\n                defaultMessage=\"Time (relative)\"\n                description=\"Label for a radio button that configures the x-axis on a line chart. This option is for relative time since the first metric was logged.\"\n              />\n              <LegacyTooltip\n                title={\n                  <FormattedMessage\n                    defaultMessage=\"Amount of time that has passed since the first metric value was logged\"\n                    description=\"A tooltip line chart configuration for the step function of relative time\"\n                  />\n                }\n                placement=\"right\"\n              >\n                {' '}\n                <QuestionMarkIcon css={styles.timeStepQuestionMarkIcon} />\n              </LegacyTooltip>\n            </Radio>\n            {renderXAxisMetricSelector({\n              theme,\n              metricKeyList,\n              selectedXAxisMetricKey: state.selectedXAxisMetricKey,\n              updateSelectedXAxisMetricKey,\n            })}\n          </Radio.Group>\n        )}\n      </RunsChartsConfigureField>\n      {state.xAxisKey === RunsChartsLineChartXAxisType.STEP && (\n        <>\n          <RunsChartsConfigureField title=\"X-axis scale\" compact>\n            <div css={{ display: 'flex', gap: theme.spacing.sm }}>\n              <div>\n                <Input\n                  componentId=\"mlflow.charts.line_chart_configure.x_axis_min\"\n                  aria-label=\"x-axis-min\"\n                  name=\"min\"\n                  type=\"number\"\n                  value={localAxisRange.xMin}\n                  onChange={(e) => updateXAxisScaleMin(e.target.value)}\n                  max={localAxisRange.xMax}\n                  placeholder=\"Min\"\n                />\n                {invalidMessage(state.xAxisScaleType, localAxisRange.xMin)}\n              </div>\n              <div>\n                <Input\n                  componentId=\"mlflow.charts.line_chart_configure.x_axis_max\"\n                  aria-label=\"x-axis-max\"\n                  name=\"max\"\n                  type=\"number\"\n                  value={localAxisRange.xMax}\n                  onChange={(e) => updateXAxisScaleMax(e.target.value)}\n                  min={localAxisRange.xMin}\n                  placeholder=\"Max\"\n                />\n                {invalidMessage(state.xAxisScaleType, localAxisRange.xMax)}\n              </div>\n            </div>\n            <div style={{ padding: theme.spacing.xs }} />\n            <Switch\n              componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_config_runschartsconfigurelinechart.tsx_628\"\n              aria-label=\"x-axis-log\"\n              checked={state.xAxisScaleType === 'log'}\n              onChange={updateXAxisScaleType}\n              label=\"Log scale\"\n              activeLabel=\"On\"\n              inactiveLabel=\"Off\"\n              disabledLabel=\"Disabled\"\n            />\n          </RunsChartsConfigureField>\n        </>\n      )}\n      <Typography.Title level={4} color=\"secondary\" css={{ paddingTop: theme.spacing.lg }}>\n        Y-axis\n      </Typography.Title>\n      <RunsChartsYAxisMetricAndExpressionSelector\n        state={state}\n        onStateChange={onStateChange}\n        metricKeyList={metricKeyList}\n        updateSelectedMetrics={updateSelectedMetrics}\n      />\n      <RunsChartsConfigureField title=\"Y-axis scale\" compact>\n        <div css={{ display: 'flex', gap: theme.spacing.sm }}>\n          <div>\n            <Input\n              componentId=\"mlflow.charts.line_chart_configure.y_axis_min\"\n              aria-label=\"y-axis-min\"\n              name=\"min\"\n              type=\"number\"\n              value={localAxisRange.yMin}\n              onChange={(e) => updateYAxisScaleMin(e.target.value)}\n              max={localAxisRange.yMax}\n              placeholder=\"Min\"\n            />\n            {invalidMessage(state.scaleType, localAxisRange.yMin)}\n          </div>\n          <div>\n            <Input\n              componentId=\"mlflow.charts.line_chart_configure.y_axis_max\"\n              aria-label=\"y-axis-max\"\n              name=\"max\"\n              type=\"number\"\n              value={localAxisRange.yMax}\n              onChange={(e) => updateYAxisScaleMax(e.target.value)}\n              min={localAxisRange.yMin}\n              placeholder=\"Max\"\n            />\n            {invalidMessage(state.scaleType, localAxisRange.yMax)}\n          </div>\n        </div>\n        <Spacer size=\"xs\" />\n        <Switch\n          componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_config_runschartsconfigurelinechart.tsx_682\"\n          aria-label=\"y-axis-log\"\n          checked={state.scaleType === 'log'}\n          onChange={updateYAxisType}\n          label=\"Log scale\"\n          activeLabel=\"On\"\n          inactiveLabel=\"Off\"\n          disabledLabel=\"Disabled\"\n        />\n        <Spacer size=\"xs\" />\n        <div css={{ display: 'flex', flexDirection: 'row', justifyContent: 'space-between' }}>\n          <div>\n            <Typography.Text bold>\n              <FormattedMessage\n                defaultMessage=\"Ignore outliers\"\n                description=\"Runs charts > line chart > ignore outliers > label\"\n              />\n            </Typography.Text>\n            <Tooltip\n              componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_config_runschartsconfigurelinechart.tsx_703\"\n              delayDuration={0}\n              content={\n                <FormattedMessage\n                  defaultMessage=\"Only display data points between the p5 and p95 of the data. This can help with chart readability in cases where outliers significantly affect the Y-axis range\"\n                  description=\"A tooltip describing the 'Ignore Outliers' configuration option for line charts\"\n                />\n              }\n              side=\"right\"\n            >\n              <span>\n                {' '}\n                <QuestionMarkIcon css={styles.timeStepQuestionMarkIcon} />\n              </span>\n            </Tooltip>\n          </div>\n          <Switch\n            componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_config_runschartsconfigurelinechart.tsx_716\"\n            aria-label=\"y-axis-ignore-outliers\"\n            checked={state.ignoreOutliers}\n            onChange={updateIgnoreOutliers}\n            // Empty label so that the active/inactive labels are actually displayed\n            label=\" \"\n            activeLabel={intl.formatMessage({\n              defaultMessage: 'On',\n              description: 'Runs charts > line chart > ignore outliers > on setting label',\n            })}\n            inactiveLabel={intl.formatMessage({\n              defaultMessage: 'Off',\n              description: 'Runs charts > line chart > ignore outliers > off setting label',\n            })}\n            disabledLabel={intl.formatMessage({\n              defaultMessage: 'Disabled',\n              description: 'Runs charts > line chart > ignore outliers > disabled label',\n            })}\n          />\n        </div>\n      </RunsChartsConfigureField>\n      <Typography.Title level={4} color=\"secondary\" css={{ paddingTop: theme.spacing.lg }}>\n        Advanced\n      </Typography.Title>\n      <RunsChartsConfigureField\n        title={intl.formatMessage({\n          defaultMessage: 'Display points',\n          description: 'Runs charts > line chart > display points > label',\n        })}\n        compact\n      >\n        <SegmentedControlGroup\n          componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_config_runschartsconfigurelinechart.tsx_747\"\n          name={intl.formatMessage({\n            defaultMessage: 'Display points',\n            description: 'Runs charts > line chart > display points > label',\n          })}\n          value={state.displayPoints}\n          onChange={({ target }) => {\n            onStateChange((current) => ({\n              ...(current as RunsChartsLineCardConfig),\n              displayPoints: target.value,\n            }));\n          }}\n        >\n          <SegmentedControlButton\n            value={undefined}\n            aria-label={[\n              intl.formatMessage({\n                defaultMessage: 'Display points',\n                description: 'Runs charts > line chart > display points > label',\n              }),\n              intl.formatMessage({\n                defaultMessage: 'Auto',\n                description: 'Runs charts > line chart > display points > auto setting label',\n              }),\n            ].join(': ')}\n          >\n            <FormattedMessage\n              defaultMessage=\"Auto\"\n              description=\"Runs charts > line chart > display points > auto setting label\"\n            />{' '}\n            <LegacyTooltip\n              title={\n                <FormattedMessage\n                  defaultMessage=\"Show points on line charts if there are fewer than 60 data points per trace\"\n                  description=\"Runs charts > line chart > display points > auto tooltip\"\n                />\n              }\n            >\n              <InfoSmallIcon />\n            </LegacyTooltip>\n          </SegmentedControlButton>\n          <SegmentedControlButton\n            value\n            aria-label={[\n              intl.formatMessage({\n                defaultMessage: 'Display points',\n                description: 'Runs charts > line chart > display points > label',\n              }),\n              intl.formatMessage({\n                defaultMessage: 'On',\n                description: 'Runs charts > line chart > display points > on setting label',\n              }),\n            ].join(': ')}\n          >\n            <FormattedMessage\n              defaultMessage=\"On\"\n              description=\"Runs charts > line chart > display points > on setting label\"\n            />\n          </SegmentedControlButton>\n          <SegmentedControlButton\n            value={false}\n            aria-label={[\n              intl.formatMessage({\n                defaultMessage: 'Display points',\n                description: 'Runs charts > line chart > display points > label',\n              }),\n              intl.formatMessage({\n                defaultMessage: 'Off',\n                description: 'Runs charts > line chart > display points > off setting label',\n              }),\n            ].join(': ')}\n          >\n            <FormattedMessage\n              defaultMessage=\"Off\"\n              description=\"Runs charts > line chart > display points > off setting label\"\n            />\n          </SegmentedControlButton>\n        </SegmentedControlGroup>\n      </RunsChartsConfigureField>\n      <RunsChartsConfigureField\n        title={\n          <>\n            <FormattedMessage\n              defaultMessage=\"Line smoothing\"\n              description=\"Runs charts > line chart > configuration > label for line smoothing slider control. The control allows changing data trace line smoothness from 1 to 100, where 1 is the original data trace and 100 is the smoothest trace. Line smoothing helps eliminate noise in the data.\"\n            />\n          </>\n        }\n        compact\n      >\n        <Radio.Group\n          componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_config_runschartsconfigurelinechart.tsx_838\"\n          name=\"use-global-line-smoothness\"\n          value={Boolean(state.useGlobalLineSmoothing)}\n          onChange={({ target }) => {\n            onStateChange((current) => ({\n              ...(current as RunsChartsLineCardConfig),\n              useGlobalLineSmoothing: target.value === true,\n            }));\n          }}\n        >\n          <Radio value>Use workspace settings</Radio>\n          <Radio value={false}>Custom</Radio>\n        </Radio.Group>\n\n        <LineSmoothSlider\n          data-testid=\"smoothness-toggle\"\n          min={0}\n          max={100}\n          onChange={updateSmoothing}\n          value={state.lineSmoothness ? state.lineSmoothness : 0}\n          disabled={state.useGlobalLineSmoothing}\n        />\n      </RunsChartsConfigureField>\n    </>\n  );\n};\n\nconst styles = {\n  selectFull: { width: '100%' },\n  timeStepQuestionMarkIcon: () => ({\n    svg: { width: 12, height: 12 },\n  }),\n};\n","import { useCallback, useMemo, useRef } from 'react';\nimport { connect } from 'react-redux';\nimport type { ReduxState } from '../../../../../redux-types';\nimport type { MetricHistoryByName } from '../../../../types';\nimport {\n  RunsChartsLineChartXAxisType,\n  removeOutliersFromMetricHistory,\n  type RunsChartsRunData,\n} from '../RunsCharts.common';\nimport { RunsMetricsLinePlot } from '../RunsMetricsLinePlot';\nimport { RunsChartsTooltipMode, useRunsChartsTooltip } from '../../hooks/useRunsChartsTooltip';\nimport type { RunsChartsLineCardConfig } from '../../runs-charts.types';\nimport { RunsChartsLineChartYAxisType } from '../../runs-charts.types';\nimport { shouldEnableChartExpressions } from '../../../../../common/utils/FeatureUtils';\nimport { useSampledMetricHistory } from '../../hooks/useSampledMetricHistory';\nimport { compact, isUndefined, uniq } from 'lodash';\nimport type { RunsGroupByConfig } from '../../../experiment-page/utils/experimentPage.group-row-utils';\nimport { useGroupedChartRunData } from '../../../runs-compare/hooks/useGroupedChartRunData';\nimport type { RunsChartsGlobalLineChartConfig } from '../../../experiment-page/models/ExperimentPageUIState';\nimport { useLineChartGlobalConfig } from '../hooks/useLineChartGlobalConfig';\nimport { RunsChartCardLoadingPlaceholder } from '../cards/ChartCard.common';\n\nconst RunsChartsConfigureLineChartPreviewImpl = ({\n  previewData,\n  cardConfig,\n  metricsByRunUuid,\n  groupBy,\n  globalLineChartConfig,\n}: {\n  previewData: RunsChartsRunData[];\n  cardConfig: RunsChartsLineCardConfig;\n  groupBy: RunsGroupByConfig | null;\n\n  globalLineChartConfig?: RunsChartsGlobalLineChartConfig;\n\n  metricsByRunUuid: Record<string, MetricHistoryByName>;\n}) => {\n  const { lineSmoothness, selectedXAxisMetricKey, xAxisKey } = useLineChartGlobalConfig(\n    cardConfig,\n    globalLineChartConfig,\n  );\n\n  const isGrouped = useMemo(() => previewData.some((r) => r.groupParentInfo), [previewData]);\n\n  const { aggregateFunction } = groupBy || {};\n\n  const runUuidsToFetch = useMemo(() => {\n    if (isGrouped) {\n      const runsInGroups = compact(previewData.map((r) => r.groupParentInfo)).flatMap((g) => g.runUuids);\n      const ungroupedRuns = compact(\n        previewData.filter((r) => !r.groupParentInfo && !r.belongsToGroup).map((r) => r.runInfo?.runUuid ?? undefined),\n      );\n      return [...runsInGroups, ...ungroupedRuns];\n    }\n    return compact(previewData.map((r) => r.runInfo)).map((g) => g.runUuid ?? '');\n  }, [previewData, isGrouped]);\n\n  const metricKeysToFetch = useMemo(() => {\n    const getYAxisKeys = (cardConfig: RunsChartsLineCardConfig) => {\n      const fallback = [cardConfig.metricKey];\n      if (!shouldEnableChartExpressions() || cardConfig.yAxisKey !== RunsChartsLineChartYAxisType.EXPRESSION) {\n        return cardConfig.selectedMetricKeys ?? fallback;\n      }\n      const yAxisKeys = cardConfig.yAxisExpressions?.reduce((acc, exp) => {\n        exp.variables.forEach((variable) => acc.add(variable));\n        return acc;\n      }, new Set<string>());\n      return yAxisKeys === undefined ? fallback : Array.from(yAxisKeys);\n    };\n    const yAxisKeys = getYAxisKeys(cardConfig);\n    const xAxisKeys = !selectedXAxisMetricKey ? [] : [selectedXAxisMetricKey];\n    return yAxisKeys.concat(xAxisKeys);\n  }, [cardConfig, selectedXAxisMetricKey]);\n\n  const { resultsByRunUuid, isLoading } = useSampledMetricHistory({\n    runUuids: runUuidsToFetch,\n    metricKeys: metricKeysToFetch,\n    enabled: true,\n    maxResults: 320,\n    autoRefreshEnabled: false,\n  });\n\n  const sampledData = useMemo(\n    () =>\n      previewData.map((run) => {\n        const metricsHistory = metricKeysToFetch.reduce((acc: MetricHistoryByName, key) => {\n          const history = resultsByRunUuid[run.uuid]?.[key]?.metricsHistory;\n          if (history) {\n            acc[key] = cardConfig.ignoreOutliers ? removeOutliersFromMetricHistory(history) : history;\n          }\n          return acc;\n        }, {});\n\n        return {\n          ...run,\n          metricsHistory,\n        };\n      }),\n    [metricKeysToFetch, resultsByRunUuid, previewData, cardConfig.ignoreOutliers],\n  );\n\n  const sampledGroupData = useGroupedChartRunData({\n    enabled: isGrouped,\n    ungroupedRunsData: sampledData,\n    metricKeys: metricKeysToFetch,\n    sampledDataResultsByRunUuid: resultsByRunUuid,\n    aggregateFunction,\n    selectedXAxisMetricKey: xAxisKey === RunsChartsLineChartXAxisType.METRIC ? selectedXAxisMetricKey : undefined,\n    ignoreOutliers: cardConfig.ignoreOutliers ?? false,\n  });\n\n  // Use grouped data traces only if enabled and if there are any groups\n  const chartData = isGrouped ? sampledGroupData : sampledData;\n\n  const { setTooltip, resetTooltip } = useRunsChartsTooltip(\n    cardConfig,\n    RunsChartsTooltipMode.MultipleTracesWithScanline,\n  );\n\n  if (isLoading) {\n    return <RunsChartCardLoadingPlaceholder />;\n  }\n\n  const checkValidRange = (\n    rangeMin: number | undefined,\n    rangeMax: number | undefined,\n  ): [number, number] | undefined => {\n    if (isUndefined(rangeMin) || isUndefined(rangeMax)) {\n      return undefined;\n    }\n    return [rangeMin, rangeMax];\n  };\n\n  const xRange = checkValidRange(cardConfig.range?.xMin, cardConfig.range?.xMax);\n  const yRange = checkValidRange(cardConfig.range?.yMin, cardConfig.range?.yMax);\n\n  return (\n    <RunsMetricsLinePlot\n      runsData={chartData}\n      metricKey={cardConfig.metricKey}\n      selectedMetricKeys={cardConfig.selectedMetricKeys}\n      scaleType={cardConfig.scaleType}\n      xAxisScaleType={cardConfig.xAxisScaleType}\n      lineSmoothness={lineSmoothness}\n      xAxisKey={xAxisKey}\n      selectedXAxisMetricKey={selectedXAxisMetricKey}\n      displayPoints={cardConfig.displayPoints}\n      yAxisExpressions={cardConfig.yAxisExpressions}\n      yAxisKey={cardConfig.yAxisKey}\n      useDefaultHoverBox={false}\n      onHover={setTooltip}\n      onUnhover={resetTooltip}\n      xRange={xRange}\n      yRange={yRange}\n    />\n  );\n};\n\nconst mapStateToProps = ({ entities: { metricsByRunUuid } }: ReduxState) => ({\n  metricsByRunUuid,\n});\n\n/**\n * Preview of line chart used in compare runs configuration modal\n */\nexport const RunsChartsConfigureLineChartPreview = connect(mapStateToProps, undefined, undefined, {\n  areStatesEqual: (nextState, prevState) => nextState.entities.metricsByRunUuid === prevState.entities.metricsByRunUuid,\n})(RunsChartsConfigureLineChartPreviewImpl);\n","import type { RunsChartsRunData } from '../RunsCharts.common';\nimport LazyParallelCoordinatesPlot from '../charts/LazyParallelCoordinatesPlot';\nimport { isParallelChartConfigured, processParallelCoordinateData } from '../../utils/parallelCoordinatesPlot.utils';\nimport { useRunsChartsTooltip } from '../../hooks/useRunsChartsTooltip';\nimport type { RunsChartsParallelCardConfig } from '../../runs-charts.types';\nimport { useMemo } from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport type { RunsGroupByConfig } from '../../../experiment-page/utils/experimentPage.group-row-utils';\nimport { Empty, NoIcon } from '@databricks/design-system';\nimport { RunsChartCardLoadingPlaceholder } from '../cards/ChartCard.common';\n\nexport const RunsChartsConfigureParallelChartPreview = ({\n  previewData,\n  cardConfig,\n  groupBy,\n}: {\n  previewData: RunsChartsRunData[];\n  cardConfig: RunsChartsParallelCardConfig;\n  groupBy: RunsGroupByConfig | null;\n}) => {\n  const isConfigured = isParallelChartConfigured(cardConfig);\n\n  const { setTooltip, resetTooltip } = useRunsChartsTooltip(cardConfig);\n\n  const containsStringValues = useMemo(\n    () =>\n      cardConfig.selectedParams?.some(\n        (paramKey) => previewData?.some((dataTrace) => isNaN(Number(dataTrace.params[paramKey]?.value))),\n        [cardConfig.selectedParams, previewData],\n      ),\n    [cardConfig.selectedParams, previewData],\n  );\n\n  if (containsStringValues && groupBy) {\n    return (\n      <div css={{ display: 'flex', justifyContent: 'center', alignItems: 'center', textAlign: 'center' }}>\n        <FormattedMessage\n          defaultMessage=\"Parallel coordinates chart does not support aggregated string values. Use other parameters or disable run grouping to continue.\"\n          description=\"Experiment page > compare runs > parallel coordinates chart configuration modal > unsupported string values warning\"\n        />\n      </div>\n    );\n  }\n\n  const filteredData = isConfigured\n    ? processParallelCoordinateData(previewData, cardConfig.selectedParams, cardConfig.selectedMetrics)\n    : [];\n\n  if (!isConfigured) {\n    return (\n      <div css={{ display: 'flex', justifyContent: 'center', alignItems: 'center' }}>\n        Select at least two metrics and params first\n      </div>\n    );\n  }\n\n  return filteredData.length ? (\n    /* Avoid displaying empty set, otherwise parcoord-es crashes */\n    <LazyParallelCoordinatesPlot\n      selectedMetrics={cardConfig.selectedMetrics}\n      selectedParams={cardConfig.selectedParams}\n      data={filteredData}\n      axesRotateThreshold={6}\n      onHover={setTooltip}\n      onUnhover={resetTooltip}\n      fallback={<RunsChartCardLoadingPlaceholder />}\n    />\n  ) : (\n    <Empty\n      description={\n        <FormattedMessage\n          defaultMessage=\"No matching data found for the available runs.\"\n          description=\"Experiment tracking > runs charts > parallel coordinates chart preview > no data found description\"\n        />\n      }\n      image={<NoIcon />}\n    />\n  );\n};\n","import { useCallback, useEffect } from 'react';\nimport { useIntl } from 'react-intl';\nimport {\n  extractCanonicalSortKey,\n  isCanonicalSortKeyOfType,\n  makeCanonicalSortKey,\n} from '../../../experiment-page/utils/experimentPage.common-utils';\nimport type { RunsChartsCardConfig, RunsChartsContourCardConfig } from '../../runs-charts.types';\nimport { RunsChartsMetricParamSelect, RunsChartsConfigureField } from './RunsChartsConfigure.common';\n\ntype ValidAxis = keyof Pick<RunsChartsContourCardConfig, 'xaxis' | 'yaxis' | 'zaxis'>;\n\n/**\n * Form containing configuration controls for Contour runs compare chart.\n */\nexport const RunsChartsConfigureContourChart = ({\n  state,\n  onStateChange,\n  metricKeyList,\n  paramKeyList,\n}: {\n  metricKeyList: string[];\n  paramKeyList: string[];\n  state: RunsChartsContourCardConfig;\n  onStateChange: (setter: (current: RunsChartsCardConfig) => RunsChartsContourCardConfig) => void;\n}) => {\n  const { formatMessage } = useIntl();\n  const runSelectOptions = [5, 10, 20, 50, 100];\n\n  /**\n   * Callback for updating X or Y axis\n   */\n  const updateAxis = useCallback(\n    (canonicalKey: string, axis: ValidAxis) => {\n      const type = isCanonicalSortKeyOfType(canonicalKey, 'METRIC') ? 'METRIC' : 'PARAM';\n      const key = extractCanonicalSortKey(canonicalKey, type);\n      onStateChange((current) => ({\n        ...(current as RunsChartsContourCardConfig),\n        [axis]: { key, type },\n      }));\n    },\n    [onStateChange],\n  );\n\n  /**\n   * Callback for updating run count\n   */\n  const updateVisibleRunCount = useCallback(\n    (runsCountToCompare: number) => {\n      onStateChange((current) => ({\n        ...(current as RunsChartsContourCardConfig),\n        runsCountToCompare,\n      }));\n    },\n    [onStateChange],\n  );\n\n  /**\n   * If somehow axes are not predetermined, automatically\n   * select the first metric/param so it's not empty\n   */\n  useEffect(() => {\n    const firstMetric = metricKeyList?.[0];\n    const firstParam = paramKeyList?.[0];\n    if (!state.xaxis?.key) {\n      if (firstMetric) {\n        updateAxis(makeCanonicalSortKey('METRIC', firstMetric), 'xaxis');\n      } else if (firstParam) {\n        updateAxis(makeCanonicalSortKey('PARAM', firstParam), 'xaxis');\n      }\n    }\n    if (!state.yaxis?.key) {\n      if (firstMetric) {\n        updateAxis(makeCanonicalSortKey('METRIC', firstMetric), 'yaxis');\n      } else if (firstParam) {\n        updateAxis(makeCanonicalSortKey('PARAM', firstParam), 'yaxis');\n      }\n    }\n    if (!state.zaxis?.key) {\n      if (firstMetric) {\n        updateAxis(makeCanonicalSortKey('METRIC', firstMetric), 'zaxis');\n      } else if (firstParam) {\n        updateAxis(makeCanonicalSortKey('PARAM', firstParam), 'zaxis');\n      }\n    }\n  }, [state.xaxis, state.yaxis, state.zaxis, updateAxis, metricKeyList, paramKeyList]);\n\n  return (\n    <>\n      <RunsChartsConfigureField\n        title={formatMessage({\n          defaultMessage: 'X axis',\n          description: 'Label for X axis in Contour chart configurator in compare runs chart config modal',\n        })}\n      >\n        <RunsChartsMetricParamSelect\n          value={state.xaxis.key ? makeCanonicalSortKey(state.xaxis.type, state.xaxis.key) : ''}\n          onChange={(value) => {\n            updateAxis(value, 'xaxis');\n          }}\n          paramKeyList={paramKeyList}\n          metricKeyList={metricKeyList}\n        />\n      </RunsChartsConfigureField>\n      <RunsChartsConfigureField\n        title={formatMessage({\n          defaultMessage: 'Y axis',\n          description: 'Label for Y axis in Contour chart configurator in compare runs chart config modal',\n        })}\n      >\n        <RunsChartsMetricParamSelect\n          value={state.yaxis.key ? makeCanonicalSortKey(state.yaxis.type, state.yaxis.key) : ''}\n          onChange={(value) => {\n            updateAxis(value, 'yaxis');\n          }}\n          paramKeyList={paramKeyList}\n          metricKeyList={metricKeyList}\n        />\n      </RunsChartsConfigureField>\n      <RunsChartsConfigureField\n        title={formatMessage({\n          defaultMessage: 'Z axis',\n          description: 'Label for Z axis in Contour chart configurator in compare runs chart config modal',\n        })}\n      >\n        <RunsChartsMetricParamSelect\n          value={state.zaxis.key ? makeCanonicalSortKey(state.zaxis.type, state.zaxis.key) : ''}\n          onChange={(value) => {\n            updateAxis(value, 'zaxis');\n          }}\n          paramKeyList={paramKeyList}\n          metricKeyList={metricKeyList}\n        />\n      </RunsChartsConfigureField>\n    </>\n  );\n};\n","import { useCallback, useEffect } from 'react';\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport {\n  extractCanonicalSortKey,\n  isCanonicalSortKeyOfType,\n  makeCanonicalSortKey,\n} from '../../../experiment-page/utils/experimentPage.common-utils';\nimport type { RunsChartsCardConfig, RunsChartsScatterCardConfig } from '../../runs-charts.types';\nimport {\n  RunsChartsMetricParamSelect,\n  RunsChartsConfigureField,\n  runsChartsRunCountDefaultOptions,\n} from './RunsChartsConfigure.common';\n\ntype ValidAxis = keyof Pick<RunsChartsScatterCardConfig, 'xaxis' | 'yaxis'>;\n\nconst scatterPlotDefaultOptions = runsChartsRunCountDefaultOptions;\nscatterPlotDefaultOptions.push(\n  {\n    value: 100,\n    label: (\n      <FormattedMessage\n        defaultMessage=\"100\"\n        description=\"Label for 100 first runs visible in run count selector within runs compare configuration modal\"\n      />\n    ),\n  },\n  {\n    value: 250,\n    label: (\n      <FormattedMessage\n        defaultMessage=\"250\"\n        description=\"Label for 250 first runs visible in run count selector within runs compare configuration modal\"\n      />\n    ),\n  },\n  {\n    value: 500,\n    label: (\n      <FormattedMessage\n        defaultMessage=\"500\"\n        description=\"Label for 500 first runs visible in run count selector within runs compare configuration modal\"\n      />\n    ),\n  },\n);\n\n/**\n * Form containing configuration controls for scatter runs compare chart.\n */\nexport const RunsChartsConfigureScatterChart = ({\n  state,\n  onStateChange,\n  metricKeyList,\n  paramKeyList,\n}: {\n  metricKeyList: string[];\n  paramKeyList: string[];\n  state: RunsChartsScatterCardConfig;\n  onStateChange: (setter: (current: RunsChartsCardConfig) => RunsChartsScatterCardConfig) => void;\n}) => {\n  const { formatMessage } = useIntl();\n\n  /**\n   * Callback for updating X or Y axis\n   */\n  const updateAxis = useCallback(\n    (canonicalKey: string, axis: ValidAxis) => {\n      const type = isCanonicalSortKeyOfType(canonicalKey, 'METRIC') ? 'METRIC' : 'PARAM';\n      const key = extractCanonicalSortKey(canonicalKey, type);\n      onStateChange((current) => ({\n        ...(current as RunsChartsScatterCardConfig),\n        [axis]: { key, type },\n      }));\n    },\n    [onStateChange],\n  );\n\n  /**\n   * Callback for updating run count\n   */\n  const updateVisibleRunCount = useCallback(\n    (runsCountToCompare: number) => {\n      onStateChange((current) => ({\n        ...(current as RunsChartsScatterCardConfig),\n        runsCountToCompare,\n      }));\n    },\n    [onStateChange],\n  );\n\n  /**\n   * If somehow axes are not predetermined, automatically\n   * select the first metric/param so it's not empty\n   */\n  useEffect(() => {\n    const firstMetric = metricKeyList?.[0];\n    const firstParam = paramKeyList?.[0];\n    if (!state.xaxis?.key) {\n      if (firstMetric) {\n        updateAxis(makeCanonicalSortKey('METRIC', firstMetric), 'xaxis');\n      } else if (firstParam) {\n        updateAxis(makeCanonicalSortKey('PARAM', firstParam), 'xaxis');\n      }\n    }\n    if (!state.yaxis?.key) {\n      if (firstMetric) {\n        updateAxis(makeCanonicalSortKey('METRIC', firstMetric), 'yaxis');\n      } else if (firstParam) {\n        updateAxis(makeCanonicalSortKey('PARAM', firstParam), 'yaxis');\n      }\n    }\n  }, [state.xaxis, state.yaxis, updateAxis, metricKeyList, paramKeyList]);\n\n  return (\n    <>\n      <RunsChartsConfigureField\n        title={formatMessage({\n          defaultMessage: 'X axis',\n          description: 'Label for X axis in scatter chart configurator in compare runs chart config modal',\n        })}\n      >\n        <RunsChartsMetricParamSelect\n          value={state.xaxis.key ? makeCanonicalSortKey(state.xaxis.type, state.xaxis.key) : ''}\n          onChange={(value) => {\n            updateAxis(value, 'xaxis');\n          }}\n          paramKeyList={paramKeyList}\n          metricKeyList={metricKeyList}\n        />\n      </RunsChartsConfigureField>\n      <RunsChartsConfigureField\n        title={formatMessage({\n          defaultMessage: 'Y axis',\n          description: 'Label for Y axis in scatter chart configurator in compare runs chart config modal',\n        })}\n      >\n        <RunsChartsMetricParamSelect\n          value={state.yaxis.key ? makeCanonicalSortKey(state.yaxis.type, state.yaxis.key) : ''}\n          onChange={(value) => {\n            updateAxis(value, 'yaxis');\n          }}\n          paramKeyList={paramKeyList}\n          metricKeyList={metricKeyList}\n        />\n      </RunsChartsConfigureField>\n    </>\n  );\n};\n","import {\n  Checkbox,\n  Input,\n  Switch,\n  useDesignSystemTheme,\n  LegacyTooltip,\n  InfoSmallIcon,\n  LegacyInfoTooltip,\n} from '@databricks/design-system';\nimport type { RunsChartsCardConfig, RunsChartsDifferenceCardConfig } from '../../runs-charts.types';\nimport { DISABLED_GROUP_WHEN_GROUPBY, DifferenceCardConfigCompareGroup } from '../../runs-charts.types';\nimport { RunsChartsConfigureField } from './RunsChartsConfigure.common';\nimport { useCallback } from 'react';\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport type { RunsGroupByConfig } from '../../../experiment-page/utils/experimentPage.group-row-utils';\n\n/**\n * Form containing configuration controls for runs compare difference view chart.\n */\nexport const RunsChartsConfigureDifferenceChart = ({\n  state,\n  onStateChange,\n  metricKeyList,\n  paramKeyList,\n  groupBy,\n}: {\n  metricKeyList: string[];\n  paramKeyList: string[];\n  state: Partial<RunsChartsDifferenceCardConfig>;\n  onStateChange: (setter: (current: RunsChartsCardConfig) => RunsChartsDifferenceCardConfig) => void;\n  groupBy: RunsGroupByConfig | null;\n}) => {\n  /**\n   * Callback for updating compare groups\n   */\n  const updateCompareGroups = useCallback(\n    (compareGroup: DifferenceCardConfigCompareGroup) => {\n      onStateChange((current) => {\n        const currentConfig = current as RunsChartsDifferenceCardConfig;\n        const compareGroups = currentConfig.compareGroups;\n        if (compareGroups.includes(compareGroup)) {\n          return {\n            ...(current as RunsChartsDifferenceCardConfig),\n            compareGroups: compareGroups.filter((group) => group !== compareGroup),\n          };\n        } else {\n          return { ...(current as RunsChartsDifferenceCardConfig), compareGroups: [...compareGroups, compareGroup] };\n        }\n      });\n    },\n    [onStateChange],\n  );\n\n  const updateChartName = useCallback(\n    (e) => onStateChange((current) => ({ ...(current as RunsChartsDifferenceCardConfig), chartName: e.target.value })),\n    [onStateChange],\n  );\n\n  const updateShowChangeFromBaseline = useCallback(\n    (showChangeFromBaseline: boolean) =>\n      onStateChange((current) => ({\n        ...(current as RunsChartsDifferenceCardConfig),\n        showChangeFromBaseline,\n      })),\n    [onStateChange],\n  );\n\n  const updateShowDifferencesOnly = useCallback(\n    (showDifferencesOnly: boolean) =>\n      onStateChange((current) => ({\n        ...(current as RunsChartsDifferenceCardConfig),\n        showDifferencesOnly,\n      })),\n    [onStateChange],\n  );\n\n  const { theme } = useDesignSystemTheme();\n  const { formatMessage } = useIntl();\n\n  return (\n    <>\n      <RunsChartsConfigureField\n        title={formatMessage({\n          defaultMessage: 'Compare',\n          description:\n            'Runs charts > components > config > RunsChartsConfigureDifferenceChart > Compare config section',\n        })}\n      >\n        <Checkbox.Group id=\"checkbox-group\" defaultValue={state.compareGroups}>\n          {Object.values(DifferenceCardConfigCompareGroup).map((group) => {\n            const groupedCondition = groupBy ? DISABLED_GROUP_WHEN_GROUPBY.includes(group) : false;\n            return (\n              <div css={{ display: 'inline-flex', alignItems: 'center' }} key={group}>\n                <Checkbox\n                  componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_config_runschartsconfiguredifferencechart.tsx_98\"\n                  key={group}\n                  value={group}\n                  isChecked={state.compareGroups?.includes(group)}\n                  onChange={() => updateCompareGroups(group)}\n                  disabled={groupedCondition}\n                >\n                  {group}\n                </Checkbox>\n                {groupedCondition && (\n                  <LegacyInfoTooltip\n                    title={\n                      <FormattedMessage\n                        defaultMessage=\"Disable grouped runs to compare\"\n                        description=\"Experiment tracking > components > runs-charts > RunsChartsConfigureDifferenceCharts > disable grouped runs info message\"\n                      />\n                    }\n                  />\n                )}\n              </div>\n            );\n          })}\n        </Checkbox.Group>\n        <div\n          css={{\n            display: 'flex',\n            flexDirection: 'column',\n            padding: `${theme.spacing.md}px 0px`,\n            gap: theme.spacing.sm,\n          }}\n        >\n          <Switch\n            componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_config_runschartsconfiguredifferencechart.tsx_129\"\n            checked={state.showChangeFromBaseline}\n            onChange={updateShowChangeFromBaseline}\n            label={formatMessage({\n              defaultMessage: 'Show change from baseline',\n              description:\n                'Runs charts > components > config > RunsChartsConfigureDifferenceChart > Show change from baseline toggle',\n            })}\n          />\n          <Switch\n            componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_config_runschartsconfiguredifferencechart.tsx_138\"\n            checked={state.showDifferencesOnly}\n            onChange={updateShowDifferencesOnly}\n            label={formatMessage({\n              defaultMessage: 'Show differences only',\n              description:\n                'Runs charts > components > config > RunsChartsConfigureDifferenceChart > Show differences only toggle',\n            })}\n          />\n        </div>\n      </RunsChartsConfigureField>\n\n      <RunsChartsConfigureField\n        title={formatMessage({\n          defaultMessage: 'Chart name',\n          description:\n            'Runs charts > components > config > RunsChartsConfigureDifferenceChart > Chart name config section',\n        })}\n      >\n        <Input\n          componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_config_runschartsconfiguredifferencechart.tsx_157\"\n          value={state.chartName}\n          onChange={updateChartName}\n        />\n      </RunsChartsConfigureField>\n    </>\n  );\n};\n","import { useCallback } from 'react';\nimport type { RunsChartsCardConfig, RunsChartsImageCardConfig } from '../../runs-charts.types';\nimport { Input } from '@databricks/design-system';\nimport { useIntl } from 'react-intl';\nimport { RunsChartsConfigureField } from './RunsChartsConfigure.common';\nimport { DialogCombobox } from '@databricks/design-system';\nimport { DialogComboboxContent } from '@databricks/design-system';\nimport { DialogComboboxTrigger } from '@databricks/design-system';\nimport { DialogComboboxOptionListCheckboxItem } from '@databricks/design-system';\nimport { DialogComboboxOptionList } from '@databricks/design-system';\nimport { useImageSliderStepMarks } from '../../hooks/useImageSliderStepMarks';\nimport type { RunsChartsRunData } from '../RunsCharts.common';\nimport { LineSmoothSlider } from '@mlflow/mlflow/src/experiment-tracking/components/LineSmoothSlider';\n\nexport const RunsChartsConfigureImageChart = ({\n  previewData,\n  state,\n  onStateChange,\n  imageKeyList,\n}: {\n  previewData: RunsChartsRunData[];\n  imageKeyList: string[];\n  state: Partial<RunsChartsImageCardConfig>;\n  onStateChange: (setter: (current: RunsChartsCardConfig) => RunsChartsImageCardConfig) => void;\n}) => {\n  const IMAGE_CONFIG_WIDTH = 275;\n\n  const { stepMarks, maxMark, minMark } = useImageSliderStepMarks({\n    data: previewData,\n    selectedImageKeys: state.imageKeys || [],\n  });\n\n  const updateImageKeys = useCallback(\n    (imageKeys: string[]) => {\n      onStateChange((current) => {\n        return { ...(current as RunsChartsImageCardConfig), imageKeys };\n      });\n    },\n    [onStateChange],\n  );\n\n  const updateStep = useCallback(\n    (step: number) => {\n      onStateChange((current) => {\n        return { ...(current as RunsChartsImageCardConfig), step };\n      });\n    },\n    [onStateChange],\n  );\n\n  const { formatMessage } = useIntl();\n\n  const handleUpdate = (imageKey: string) => {\n    onStateChange((current) => {\n      const currentConfig = current as RunsChartsImageCardConfig;\n      if (currentConfig.imageKeys?.includes(imageKey)) {\n        return {\n          ...currentConfig,\n          imageKeys: currentConfig.imageKeys?.filter((key) => key !== imageKey),\n        };\n      } else {\n        return { ...currentConfig, imageKeys: [...(currentConfig.imageKeys || []), imageKey] };\n      }\n    });\n  };\n\n  const handleClear = () => {\n    onStateChange((current) => {\n      return { ...(current as RunsChartsImageCardConfig), imageKeys: [] };\n    });\n  };\n\n  return (\n    <>\n      <RunsChartsConfigureField\n        title={formatMessage({\n          defaultMessage: 'Images',\n          description: 'Runs charts > components > config > RunsChartsConfigureImageGrid > Images section',\n        })}\n      >\n        <DialogCombobox\n          componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_config_runschartsconfigureimagechart.tsx_84\"\n          value={state.imageKeys}\n          label=\"Images\"\n          multiSelect\n        >\n          <DialogComboboxTrigger onClear={handleClear} minWidth={IMAGE_CONFIG_WIDTH} />\n          <DialogComboboxContent matchTriggerWidth>\n            <DialogComboboxOptionList>\n              {imageKeyList.map((imageKey) => {\n                return (\n                  <DialogComboboxOptionListCheckboxItem\n                    key={imageKey}\n                    value={imageKey}\n                    onChange={handleUpdate}\n                    checked={state.imageKeys?.includes(imageKey)}\n                  />\n                );\n              })}\n            </DialogComboboxOptionList>\n          </DialogComboboxContent>\n        </DialogCombobox>\n      </RunsChartsConfigureField>\n      <RunsChartsConfigureField title=\"Step\">\n        <LineSmoothSlider\n          max={maxMark}\n          min={minMark}\n          marks={stepMarks}\n          value={state.step}\n          disabled={Object.keys(stepMarks).length <= 1}\n          onChange={updateStep}\n        />\n      </RunsChartsConfigureField>\n    </>\n  );\n};\n","import type { RunsGroupByConfig } from '@mlflow/mlflow/src/experiment-tracking/components/experiment-page/utils/experimentPage.group-row-utils';\nimport type { RunsChartsCardConfig, RunsChartsImageCardConfig } from '../../runs-charts.types';\nimport type { RunsChartsRunData } from '../RunsCharts.common';\nimport { ImageGridPlot } from '../charts/ImageGridPlot';\nimport { FormattedMessage } from 'react-intl';\nimport { Empty } from '@databricks/design-system';\nimport { LOG_IMAGE_TAG_INDICATOR } from '../../../../constants';\n\nexport const RunsChartsConfigureImageChartPreview = ({\n  previewData,\n  cardConfig,\n  setCardConfig,\n  groupBy,\n}: {\n  previewData: RunsChartsRunData[];\n  cardConfig: RunsChartsImageCardConfig;\n  setCardConfig: (setter: (current: RunsChartsCardConfig) => RunsChartsImageCardConfig) => void;\n  groupBy: RunsGroupByConfig | null;\n}) => {\n  const containsLoggedImages = previewData.some((run: RunsChartsRunData) => Boolean(run.tags[LOG_IMAGE_TAG_INDICATOR]));\n\n  if (containsLoggedImages && cardConfig?.imageKeys?.length === 0) {\n    return (\n      <Empty\n        title={\n          <FormattedMessage\n            defaultMessage=\"No images configured for preview\"\n            description=\"Title for the empty state when user did not configure any images for preview yet\"\n          />\n        }\n        description={\n          <FormattedMessage\n            defaultMessage=\"Please use controls on the left to select images to be compared\"\n            description=\"Description for the empty state when user did not configure any images for preview yet\"\n          />\n        }\n      />\n    );\n  }\n\n  const chartBody = (\n    <ImageGridPlot previewData={previewData} cardConfig={cardConfig} setCardConfig={setCardConfig} groupBy={groupBy} />\n  );\n\n  const cardBodyToRender = chartBody;\n\n  return <div css={{ width: '100%', overflow: 'auto hidden' }}>{cardBodyToRender}</div>;\n};\n","import { useCallback, useEffect, useMemo } from 'react';\nimport { useIntl } from 'react-intl';\nimport type {\n  RunsChartsCardConfig,\n  RunsChartsMetricByDatasetEntry,\n  RunsChartsScatterCardConfig,\n} from '../../runs-charts.types';\nimport { RunsChartsConfigureField, RunsChartsMetricParamSelectV2 } from './RunsChartsConfigure.common';\n\ntype ValidAxis = keyof Pick<RunsChartsScatterCardConfig, 'xaxis' | 'yaxis'>;\n\n/**\n * Form containing configuration controls for scatter runs compare chart.\n */\nexport const RunsChartsConfigureScatterChartWithDatasets = ({\n  state,\n  onStateChange,\n  paramKeyList,\n  metricKeysByDataset,\n}: {\n  paramKeyList: string[];\n  metricKeysByDataset: RunsChartsMetricByDatasetEntry[] | undefined;\n  state: RunsChartsScatterCardConfig;\n  onStateChange: (setter: (current: RunsChartsCardConfig) => RunsChartsScatterCardConfig) => void;\n}) => {\n  const { formatMessage } = useIntl();\n\n  const metricOptions = useMemo(\n    () =>\n      metricKeysByDataset?.map(({ dataAccessKey, metricKey, datasetName }) => ({\n        key: JSON.stringify(['METRIC', dataAccessKey]),\n        dataAccessKey,\n        datasetName,\n        metricKey,\n      })) ?? [],\n    [metricKeysByDataset],\n  );\n\n  const paramOptions = useMemo(\n    () =>\n      paramKeyList?.map((paramKey) => ({\n        key: JSON.stringify(['PARAM', paramKey]),\n        paramKey,\n      })) ?? [],\n    [paramKeyList],\n  );\n\n  /**\n   * Callback for updating X or Y axis\n   */\n  const handleChange = useCallback(\n    (axis: ValidAxis) => (value: string) => {\n      const foundMetric = metricOptions.find(({ key }) => key === value);\n      if (foundMetric) {\n        const { dataAccessKey, datasetName, metricKey } = foundMetric;\n        onStateChange((current) => ({\n          ...(current as RunsChartsScatterCardConfig),\n          [axis]: { key: metricKey, type: 'METRIC', datasetName, dataAccessKey },\n        }));\n      }\n      const foundParam = paramOptions.find(({ key }) => key === value);\n      if (foundParam) {\n        onStateChange((current) => ({\n          ...(current as RunsChartsScatterCardConfig),\n          [axis]: { key: foundParam.paramKey, type: 'PARAM' },\n        }));\n      }\n    },\n    [onStateChange, metricOptions, paramOptions],\n  );\n\n  useEffect(() => {\n    // For each axis: if there is no selected value, select the first available option\n    for (const axis of ['xaxis', 'yaxis'] as const) {\n      if (!state[axis]?.key) {\n        if (metricOptions?.[0]) {\n          handleChange(axis)(metricOptions[0].key);\n        } else if (paramOptions?.[0]) {\n          handleChange(axis)(paramOptions[0].key);\n        }\n      }\n    }\n  }, [state, metricOptions, paramOptions, handleChange]);\n\n  const getSelectedValue = useCallback(\n    (axis: ValidAxis) => {\n      if (state[axis].type === 'METRIC') {\n        const foundMetricOption = metricOptions.find(\n          ({ dataAccessKey }) => dataAccessKey === state[axis].dataAccessKey,\n        );\n        if (foundMetricOption) {\n          return foundMetricOption.key;\n        }\n      }\n      if (state[axis].type === 'PARAM') {\n        const foundParamOption = paramOptions.find(({ paramKey }) => paramKey === state[axis].key);\n        if (foundParamOption) {\n          return foundParamOption.key;\n        }\n      }\n      return '';\n    },\n    [state, metricOptions, paramOptions],\n  );\n\n  const selectedXValue = useMemo(() => getSelectedValue('xaxis'), [getSelectedValue]);\n  const selectedYValue = useMemo(() => getSelectedValue('yaxis'), [getSelectedValue]);\n\n  return (\n    <>\n      <RunsChartsConfigureField\n        title={formatMessage({\n          defaultMessage: 'X axis',\n          description: 'Label for X axis in scatter chart configurator in compare runs chart config modal',\n        })}\n      >\n        <RunsChartsMetricParamSelectV2\n          value={selectedXValue}\n          onChange={handleChange('xaxis')}\n          metricOptions={metricOptions}\n          paramOptions={paramOptions}\n          id=\"mlflow.charts.chart_configure.scatter.x_axis\"\n        />\n      </RunsChartsConfigureField>\n      <RunsChartsConfigureField\n        title={formatMessage({\n          defaultMessage: 'Y axis',\n          description: 'Label for Y axis in scatter chart configurator in compare runs chart config modal',\n        })}\n      >\n        <RunsChartsMetricParamSelectV2\n          value={selectedYValue}\n          onChange={handleChange('yaxis')}\n          metricOptions={metricOptions}\n          paramOptions={paramOptions}\n          id=\"mlflow.charts.chart_configure.scatter.y_axis\"\n        />\n      </RunsChartsConfigureField>\n    </>\n  );\n};\n","/**\n * TODO: implement actual UI for this modal, it's a crude placeholder with minimal logic for now\n */\nimport { Modal, useDesignSystemTheme, SimpleSelect, SimpleSelectOption } from '@databricks/design-system';\nimport type { Interpolation, Theme } from '@emotion/react';\nimport React, { useCallback, useMemo, useState } from 'react';\nimport { useIntl, FormattedMessage } from 'react-intl';\nimport type {\n  RunsChartsBarCardConfig,\n  RunsChartsLineCardConfig,\n  RunsChartsContourCardConfig,\n  RunsChartsScatterCardConfig,\n  RunsChartsParallelCardConfig,\n  RunsChartsDifferenceCardConfig,\n  RunsChartsImageCardConfig,\n} from '../runs-charts.types';\nimport { RunsChartsCardConfig, RunsChartType, type RunsChartsMetricByDatasetEntry } from '../runs-charts.types';\n\nimport { ReactComponent as ChartBarIcon } from '../../../../common/static/chart-bar.svg';\nimport { ReactComponent as ChartContourIcon } from '../../../../common/static/chart-contour.svg';\nimport { ReactComponent as ChartLineIcon } from '../../../../common/static/chart-line.svg';\nimport { ReactComponent as ChartParallelIcon } from '../../../../common/static/chart-parallel.svg';\nimport { ReactComponent as ChartScatterIcon } from '../../../../common/static/chart-scatter.svg';\nimport { ReactComponent as ChartDifferenceIcon } from '../../../../common/static/chart-difference.svg';\nimport { ReactComponent as ChartImageIcon } from '../../../../common/static/chart-image.svg';\nimport { RunsChartsConfigureBarChart } from './config/RunsChartsConfigureBarChart';\nimport { RunsChartsConfigureParallelChart } from './config/RunsChartsConfigureParallelChart';\nimport type { RunsChartsRunData } from './RunsCharts.common';\nimport { RunsChartsConfigureField } from './config/RunsChartsConfigure.common';\nimport { RunsChartsConfigureLineChart } from './config/RunsChartsConfigureLineChart';\nimport { RunsChartsConfigureLineChartPreview } from './config/RunsChartsConfigureLineChart.preview';\nimport { RunsChartsConfigureBarChartPreview } from './config/RunsChartsConfigureBarChart.preview';\nimport { RunsChartsConfigureContourChartPreview } from './config/RunsChartsConfigureContourChart.preview';\nimport { RunsChartsConfigureScatterChartPreview } from './config/RunsChartsConfigureScatterChart.preview';\nimport { RunsChartsConfigureParallelChartPreview } from './config/RunsChartsConfigureParallelChart.preview';\nimport { RunsChartsConfigureContourChart } from './config/RunsChartsConfigureContourChart';\nimport { RunsChartsConfigureScatterChart } from './config/RunsChartsConfigureScatterChart';\nimport { RunsChartsTooltipBody } from './RunsChartsTooltipBody';\nimport { RunsChartsTooltipWrapper } from '../hooks/useRunsChartsTooltip';\nimport { RunsChartsConfigureDifferenceChart } from './config/RunsChartsConfigureDifferenceChart';\nimport type { RunsGroupByConfig } from '../../experiment-page/utils/experimentPage.group-row-utils';\nimport { RunsChartsConfigureImageChart } from './config/RunsChartsConfigureImageChart';\nimport { RunsChartsConfigureImageChartPreview } from './config/RunsChartsConfigureImageChart.preview';\nimport type { RunsChartsGlobalLineChartConfig } from '../../experiment-page/models/ExperimentPageUIState';\nimport { isEmpty } from 'lodash';\nimport { RunsChartsConfigureScatterChartWithDatasets } from './config/RunsChartsConfigureScatterChartWithDatasets';\nimport { DifferenceViewPlot } from './charts/DifferenceViewPlot';\n\nconst previewComponentsMap: Record<\n  RunsChartType,\n  React.FC<\n    React.PropsWithChildren<{\n      previewData: RunsChartsRunData[];\n      cardConfig: any;\n      groupBy: RunsGroupByConfig | null;\n      globalLineChartConfig?: RunsChartsGlobalLineChartConfig;\n      setCardConfig: (\n        setter: (\n          current: RunsChartsCardConfig,\n        ) => RunsChartsDifferenceCardConfig | RunsChartsImageCardConfig | RunsChartsLineCardConfig,\n      ) => void;\n    }>\n  >\n> = {\n  [RunsChartType.BAR]: RunsChartsConfigureBarChartPreview,\n  [RunsChartType.CONTOUR]: RunsChartsConfigureContourChartPreview,\n  [RunsChartType.LINE]: RunsChartsConfigureLineChartPreview,\n  [RunsChartType.PARALLEL]: RunsChartsConfigureParallelChartPreview,\n  [RunsChartType.SCATTER]: RunsChartsConfigureScatterChartPreview,\n  [RunsChartType.DIFFERENCE]: DifferenceViewPlot,\n  [RunsChartType.IMAGE]: RunsChartsConfigureImageChartPreview,\n};\n\nexport const RunsChartsConfigureModal = ({\n  onCancel,\n  onSubmit,\n  config,\n  chartRunData,\n  metricKeyList,\n  metricKeysByDataset,\n  paramKeyList,\n  groupBy,\n  supportedChartTypes,\n  globalLineChartConfig,\n}: {\n  metricKeyList: string[];\n  metricKeysByDataset?: RunsChartsMetricByDatasetEntry[];\n  paramKeyList: string[];\n  config: RunsChartsCardConfig;\n  chartRunData: RunsChartsRunData[];\n  onCancel: () => void;\n  groupBy: RunsGroupByConfig | null;\n  onSubmit: (formData: Partial<RunsChartsCardConfig>) => void;\n  supportedChartTypes?: RunsChartType[] | undefined;\n  globalLineChartConfig?: RunsChartsGlobalLineChartConfig;\n}) => {\n  const isChartTypeSupported = (type: RunsChartType) => !supportedChartTypes || supportedChartTypes.includes(type);\n  const { theme } = useDesignSystemTheme();\n  const borderStyle = `1px solid ${theme.colors.actionDefaultBorderDefault}`;\n  const [currentFormState, setCurrentFormState] = useState<RunsChartsCardConfig>(config);\n\n  const isEditing = Boolean(currentFormState.uuid);\n\n  const updateChartType = useCallback((type?: RunsChartType) => {\n    if (!type) {\n      return;\n    }\n    const emptyChartCard = RunsChartsCardConfig.getEmptyChartCardByType(type, true);\n    if (emptyChartCard) {\n      setCurrentFormState(emptyChartCard);\n    }\n  }, []);\n\n  const previewData = useMemo(() => chartRunData.filter(({ hidden }) => !hidden).reverse(), [chartRunData]);\n\n  const imageKeyList = useMemo(() => {\n    const imageKeys = new Set<string>();\n    previewData.forEach((run) => {\n      Object.keys(run.images).forEach((imageKey) => {\n        imageKeys.add(imageKey);\n      });\n    });\n    return Array.from(imageKeys).sort();\n  }, [previewData]);\n\n  const renderConfigOptionsforChartType = (type?: RunsChartType) => {\n    if (type === RunsChartType.BAR) {\n      return (\n        <RunsChartsConfigureBarChart\n          metricKeyList={metricKeyList}\n          metricKeysByDataset={metricKeysByDataset}\n          state={currentFormState as RunsChartsBarCardConfig}\n          onStateChange={setCurrentFormState}\n        />\n      );\n    }\n    if (type === RunsChartType.CONTOUR) {\n      return (\n        <RunsChartsConfigureContourChart\n          metricKeyList={metricKeyList}\n          paramKeyList={paramKeyList}\n          state={currentFormState as RunsChartsContourCardConfig}\n          onStateChange={setCurrentFormState}\n        />\n      );\n    }\n    if (type === RunsChartType.LINE) {\n      return (\n        <RunsChartsConfigureLineChart\n          metricKeyList={metricKeyList}\n          state={currentFormState as RunsChartsLineCardConfig}\n          onStateChange={setCurrentFormState}\n        />\n      );\n    }\n    if (type === RunsChartType.PARALLEL) {\n      return (\n        <RunsChartsConfigureParallelChart\n          metricKeyList={metricKeyList}\n          paramKeyList={paramKeyList}\n          state={currentFormState as RunsChartsParallelCardConfig}\n          onStateChange={setCurrentFormState}\n        />\n      );\n    }\n    if (type === RunsChartType.SCATTER) {\n      if (!isEmpty(metricKeysByDataset)) {\n        return (\n          <RunsChartsConfigureScatterChartWithDatasets\n            paramKeyList={paramKeyList}\n            metricKeysByDataset={metricKeysByDataset}\n            state={currentFormState as RunsChartsScatterCardConfig}\n            onStateChange={setCurrentFormState}\n          />\n        );\n      }\n      return (\n        <RunsChartsConfigureScatterChart\n          metricKeyList={metricKeyList}\n          paramKeyList={paramKeyList}\n          state={currentFormState as RunsChartsScatterCardConfig}\n          onStateChange={setCurrentFormState}\n        />\n      );\n    }\n    if (type === RunsChartType.DIFFERENCE) {\n      return (\n        <RunsChartsConfigureDifferenceChart\n          metricKeyList={metricKeyList}\n          paramKeyList={paramKeyList}\n          state={currentFormState as RunsChartsDifferenceCardConfig}\n          onStateChange={setCurrentFormState}\n          groupBy={groupBy}\n        />\n      );\n    }\n    if (type === RunsChartType.IMAGE) {\n      return (\n        <RunsChartsConfigureImageChart\n          previewData={previewData}\n          imageKeyList={imageKeyList}\n          state={currentFormState as RunsChartsImageCardConfig}\n          onStateChange={setCurrentFormState}\n        />\n      );\n    }\n    return null;\n  };\n\n  const renderPreviewChartType = (type?: RunsChartType) => {\n    if (!type) {\n      return null;\n    }\n    const PreviewComponent = previewComponentsMap[type];\n    if (!PreviewComponent) {\n      return null;\n    }\n    return (\n      <PreviewComponent\n        previewData={previewData}\n        cardConfig={currentFormState}\n        groupBy={groupBy}\n        setCardConfig={setCurrentFormState}\n        globalLineChartConfig={globalLineChartConfig}\n      />\n    );\n  };\n\n  const { formatMessage } = useIntl();\n\n  let disableSaveButton = false;\n  if (currentFormState.type === RunsChartType.LINE) {\n    const lineCardConfig = currentFormState as RunsChartsLineCardConfig;\n    disableSaveButton = (lineCardConfig.selectedMetricKeys ?? []).length === 0;\n  }\n\n  return (\n    <Modal\n      componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_runschartsconfiguremodal.tsx_232\"\n      visible\n      onCancel={onCancel}\n      onOk={() => onSubmit(currentFormState)}\n      title={\n        isEditing\n          ? formatMessage({\n              defaultMessage: 'Edit chart',\n              description: 'Title of the modal when editing a runs comparison chart',\n            })\n          : formatMessage({\n              defaultMessage: 'Add new chart',\n              description: 'Title of the modal when adding a new runs comparison chart',\n            })\n      }\n      okButtonProps={{\n        'data-testid': 'experiment-view-compare-runs-chart-modal-confirm',\n        disabled: disableSaveButton,\n      }}\n      cancelText={formatMessage({\n        defaultMessage: 'Cancel',\n        description: 'Cancel button label within a modal for adding/editing a new runs comparison chart',\n      })}\n      okText={\n        isEditing\n          ? formatMessage({\n              defaultMessage: 'Save changes',\n              description: 'Confirm button label within a modal when editing a runs comparison chart',\n            })\n          : formatMessage({\n              defaultMessage: 'Add chart',\n              description: 'Confirm button label within a modal when adding a new runs comparison chart',\n            })\n      }\n      size=\"wide\"\n      css={{ width: 1280 }}\n      dangerouslySetAntdProps={{\n        bodyStyle: {\n          overflowY: 'hidden',\n          display: 'flex',\n        },\n      }}\n    >\n      <div\n        css={{\n          // TODO: wait for modal dimensions decision\n          display: 'flex',\n          width: '100%',\n          gridTemplateColumns: '300px 1fr',\n          gap: theme.spacing.md,\n          borderTop: borderStyle,\n          borderBottom: borderStyle,\n        }}\n      >\n        <div\n          css={{\n            overflowY: 'auto',\n            borderRight: borderStyle,\n            padding: `${theme.spacing.md}px ${theme.spacing.md}px ${theme.spacing.md}px 0px`,\n            width: '300px',\n          }}\n        >\n          {!isEditing && (\n            <RunsChartsConfigureField title=\"Chart type\">\n              <SimpleSelect\n                componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_runschartsconfiguremodal.tsx_296\"\n                id=\"chart-type-select\"\n                css={{ width: '100%' }}\n                value={currentFormState.type}\n                onChange={({ target }) => {\n                  const chartType = target.value as RunsChartType;\n                  Object.values(RunsChartType).includes(chartType) && updateChartType(chartType);\n                }}\n              >\n                {isChartTypeSupported(RunsChartType.BAR) && (\n                  <SimpleSelectOption value={RunsChartType.BAR}>\n                    <div css={styles.chartTypeOption(theme)}>\n                      <ChartBarIcon />\n                      <FormattedMessage\n                        defaultMessage=\"Bar chart\"\n                        description=\"Experiment tracking > runs charts > add chart menu > bar chart\"\n                      />\n                    </div>\n                  </SimpleSelectOption>\n                )}\n                {isChartTypeSupported(RunsChartType.SCATTER) && (\n                  <SimpleSelectOption value={RunsChartType.SCATTER}>\n                    <div css={styles.chartTypeOption(theme)}>\n                      <ChartScatterIcon />\n                      <FormattedMessage\n                        defaultMessage=\"Scatter chart\"\n                        description=\"Experiment tracking > runs charts > add chart menu > scatter plot\"\n                      />\n                    </div>\n                  </SimpleSelectOption>\n                )}\n                {isChartTypeSupported(RunsChartType.LINE) && (\n                  <SimpleSelectOption value={RunsChartType.LINE}>\n                    <div css={styles.chartTypeOption(theme)}>\n                      <ChartLineIcon />\n                      <FormattedMessage\n                        defaultMessage=\"Line chart\"\n                        description=\"Experiment tracking > runs charts > add chart menu > line chart\"\n                      />\n                    </div>\n                  </SimpleSelectOption>\n                )}\n                {isChartTypeSupported(RunsChartType.PARALLEL) && (\n                  <SimpleSelectOption value={RunsChartType.PARALLEL}>\n                    <div css={styles.chartTypeOption(theme)}>\n                      <ChartParallelIcon />\n                      <FormattedMessage\n                        defaultMessage=\"Parallel coordinates\"\n                        description=\"Experiment tracking > runs charts > add chart menu > parallel coordinates\"\n                      />\n                    </div>\n                  </SimpleSelectOption>\n                )}\n                {isChartTypeSupported(RunsChartType.CONTOUR) && (\n                  <SimpleSelectOption value={RunsChartType.CONTOUR}>\n                    <div css={styles.chartTypeOption(theme)}>\n                      <ChartContourIcon />\n                      <FormattedMessage\n                        defaultMessage=\"Contour chart\"\n                        description=\"Experiment tracking > runs charts > add chart menu > contour chart\"\n                      />\n                    </div>\n                  </SimpleSelectOption>\n                )}\n                {isChartTypeSupported(RunsChartType.DIFFERENCE) && (\n                  <SimpleSelectOption value={RunsChartType.DIFFERENCE}>\n                    <div css={styles.chartTypeOption(theme)}>\n                      <ChartDifferenceIcon />\n                      <FormattedMessage\n                        defaultMessage=\"Difference view\"\n                        description=\"Experiment tracking > runs charts > add chart menu > difference view\"\n                      />\n                    </div>\n                  </SimpleSelectOption>\n                )}\n                {isChartTypeSupported(RunsChartType.IMAGE) && (\n                  <SimpleSelectOption value={RunsChartType.IMAGE}>\n                    <div css={styles.chartTypeOption(theme)}>\n                      <ChartImageIcon />\n                      <FormattedMessage\n                        defaultMessage=\"Image grid\"\n                        description=\"Experiment tracking > runs charts > add chart menu > image grid\"\n                      />\n                    </div>\n                  </SimpleSelectOption>\n                )}\n              </SimpleSelect>\n            </RunsChartsConfigureField>\n          )}\n          {renderConfigOptionsforChartType(currentFormState.type)}\n        </div>\n        <div css={{ overflow: 'auto', flexGrow: 1 }}>\n          <RunsChartsTooltipWrapper contextData={{ runs: chartRunData }} component={RunsChartsTooltipBody} hoverOnly>\n            <div\n              css={{\n                minHeight: 500,\n                height: '100%',\n                width: 500,\n                padding: '32px 0px',\n              }}\n            >\n              {renderPreviewChartType(currentFormState.type)}\n            </div>\n          </RunsChartsTooltipWrapper>\n        </div>\n      </div>\n    </Modal>\n  );\n};\n\nconst styles = {\n  chartTypeOption: (theme: Theme) =>\n    ({\n      display: 'grid',\n      gridTemplateColumns: `${theme.general.iconSize + theme.spacing.xs}px 1fr`,\n      gap: theme.spacing.xs,\n      alignItems: 'center',\n    } as Interpolation<Theme>),\n  field: {\n    // TODO: wait for modal dimensions decision\n    display: 'grid',\n    gridTemplateColumns: '80px 1fr',\n    marginBottom: 16,\n  } as Interpolation<Theme>,\n};\n","import { barChartCardDefaultMargin } from '../cards/RunsChartsBarChartCard';\nimport type { RunsChartsRunData } from '../RunsCharts.common';\nimport { RunsMetricsBarPlot } from '../RunsMetricsBarPlot';\nimport { useRunsChartsTooltip } from '../../hooks/useRunsChartsTooltip';\nimport type { RunsChartsBarCardConfig } from '../../runs-charts.types';\n\nexport const RunsChartsConfigureBarChartPreview = ({\n  previewData,\n  cardConfig,\n}: {\n  previewData: RunsChartsRunData[];\n  cardConfig: RunsChartsBarCardConfig;\n}) => {\n  const { resetTooltip, setTooltip } = useRunsChartsTooltip(cardConfig);\n\n  const dataKey = cardConfig.dataAccessKey ?? cardConfig.metricKey;\n\n  return (\n    <RunsMetricsBarPlot\n      useDefaultHoverBox={false}\n      displayRunNames={false}\n      displayMetricKey={false}\n      metricKey={dataKey}\n      runsData={previewData}\n      margin={barChartCardDefaultMargin}\n      onHover={setTooltip}\n      onUnhover={resetTooltip}\n    />\n  );\n};\n","import { useMemo } from 'react';\nimport type { RunsChartsRunData } from '../RunsCharts.common';\nimport { RunsContourPlot } from '../RunsContourPlot';\nimport { useRunsChartsTooltip } from '../../hooks/useRunsChartsTooltip';\nimport type { RunsChartsContourCardConfig } from '../../runs-charts.types';\n\nexport const RunsChartsConfigureContourChartPreview = ({\n  previewData,\n  cardConfig,\n}: {\n  previewData: RunsChartsRunData[];\n  cardConfig: RunsChartsContourCardConfig;\n}) => {\n  const { resetTooltip, setTooltip } = useRunsChartsTooltip(cardConfig);\n\n  // We need to re-render the chart when any axis config changes.\n  // Plotly tries to determine axis format based on values and is not capable\n  // of dynamic switching between different axis types, so we need to make sure\n  // that we re-mount the chart when config changes.\n  const key = useMemo(() => {\n    const { xaxis, yaxis, zaxis } = cardConfig;\n    return JSON.stringify({ xaxis, yaxis, zaxis });\n  }, [cardConfig]);\n\n  return (\n    <RunsContourPlot\n      xAxis={cardConfig.xaxis}\n      yAxis={cardConfig.yaxis}\n      zAxis={cardConfig.zaxis}\n      runsData={previewData}\n      onHover={setTooltip}\n      onUnhover={resetTooltip}\n      useDefaultHoverBox={false}\n      key={key}\n    />\n  );\n};\n","import { useMemo } from 'react';\nimport type { RunsChartsRunData } from '../RunsCharts.common';\nimport { RunsScatterPlot } from '../RunsScatterPlot';\nimport { useRunsChartsTooltip } from '../../hooks/useRunsChartsTooltip';\nimport type { RunsChartsScatterCardConfig } from '../../runs-charts.types';\n\nexport const RunsChartsConfigureScatterChartPreview = ({\n  previewData,\n  cardConfig,\n}: {\n  previewData: RunsChartsRunData[];\n  cardConfig: RunsChartsScatterCardConfig;\n}) => {\n  const { resetTooltip, setTooltip } = useRunsChartsTooltip(cardConfig);\n\n  // We need to re-render the chart when the x or y axis changes.\n  // Plotly tries to determine axis format based on values and is not capable\n  // of dynamic switching between different axis types, so we need to make sure\n  // that we re-mount the chart when config changes.\n  const key = useMemo(() => {\n    const { xaxis, yaxis } = cardConfig;\n    return JSON.stringify({ xaxis, yaxis });\n  }, [cardConfig]);\n\n  return (\n    <RunsScatterPlot\n      xAxis={cardConfig.xaxis}\n      yAxis={cardConfig.yaxis}\n      runsData={previewData}\n      onHover={setTooltip}\n      onUnhover={resetTooltip}\n      useDefaultHoverBox={false}\n      key={key}\n    />\n  );\n};\n","export const RUNS_CHARTS_UI_Z_INDEX = {\n  CARD_PREVIEW: 1,\n  CARD_DRAGGED: 2,\n  TOOLTIP_CONTAINER: 3,\n  SEARCH_BAR: 3,\n  TOOLTIP: 4,\n};\n","import { LegacySkeleton } from '@databricks/design-system';\nimport React, { Suspense } from 'react';\n\nconst ParallelCoordinatesPlot = React.lazy(() => import('./ParallelCoordinatesPlot'));\n\nconst LazyParallelCoordinatesPlot = ({ fallback, ...props }: any) => {\n  return (\n    <Suspense fallback={fallback ?? <LegacySkeleton />}>\n      <ParallelCoordinatesPlot {...props} />\n    </Suspense>\n  );\n};\n\nexport default LazyParallelCoordinatesPlot;\n","import type { ReactNode } from 'react';\nimport React, { useMemo } from 'react';\nimport type { ExperimentPageUIState } from '../models/ExperimentPageUIState';\nimport { createExperimentPageUIState } from '../models/ExperimentPageUIState';\n\nconst ExperimentPageUISetStateContext = React.createContext<\n  React.Dispatch<React.SetStateAction<ExperimentPageUIState>>\n>((state) => state);\n\n// Creates contexts for setting current UI state\nexport const ExperimentPageUIStateContextProvider = ({\n  children,\n  setUIState,\n}: {\n  children: ReactNode;\n  setUIState: React.Dispatch<React.SetStateAction<ExperimentPageUIState>>;\n}) => (\n  <ExperimentPageUISetStateContext.Provider value={setUIState}>{children}</ExperimentPageUISetStateContext.Provider>\n);\n\nexport const useUpdateExperimentViewUIState = () => React.useContext(ExperimentPageUISetStateContext);\n","import React from 'react';\n\nimport type { LegendLabelData } from './RunsMetricsLegend';\nimport RunsMetricsLegend from './RunsMetricsLegend';\nimport { useDesignSystemTheme } from '@databricks/design-system';\n\nconst RunsMetricsLegendWrapper = ({\n  labelData,\n  fullScreen,\n  children,\n}: React.PropsWithChildren<{\n  labelData: LegendLabelData[];\n  fullScreen?: boolean;\n}>) => {\n  const { theme } = useDesignSystemTheme();\n\n  const FULL_SCREEN_LEGEND_HEIGHT = 100;\n  const LEGEND_HEIGHT = 32;\n\n  const height = fullScreen ? FULL_SCREEN_LEGEND_HEIGHT : LEGEND_HEIGHT;\n  const heightBuffer = fullScreen ? theme.spacing.lg : theme.spacing.md;\n\n  return (\n    <>\n      <div css={{ height: `calc(100% - ${height + heightBuffer}px)` }}>{children}</div>\n      <RunsMetricsLegend labelData={labelData} height={height} fullScreen={fullScreen} />\n    </>\n  );\n};\n\nexport default RunsMetricsLegendWrapper;\n","import { gql, NetworkStatus } from '@mlflow/mlflow/src/common/utils/graphQLHooks';\nimport { useQuery } from '@mlflow/mlflow/src/common/utils/graphQLHooks';\nimport { EXPERIMENT_RUNS_METRIC_AUTO_REFRESH_INTERVAL } from '../../../utils/MetricsUtils';\nimport { groupBy, keyBy } from 'lodash';\nimport { useEffect, useMemo } from 'react';\nimport type { SampledMetricsByRun } from './useSampledMetricHistory';\nimport type { GetMetricHistoryBulkInterval } from '../../../../graphql/__generated__/graphql';\nimport Utils from '../../../../common/utils/Utils';\nimport { useIntl } from 'react-intl';\n\nconst GET_METRIC_HISTORY_BULK_INTERVAL = gql`\n  query GetMetricHistoryBulkInterval($data: MlflowGetMetricHistoryBulkIntervalInput!)\n  @component(name: \"MLflow.ExperimentRunTracking\") {\n    mlflowGetMetricHistoryBulkInterval(input: $data) {\n      __typename\n      metrics {\n        timestamp\n        step\n        runId\n        key\n        value\n      }\n      apiError {\n        code\n        message\n      }\n    }\n  }\n`;\n\nexport const useSampledMetricHistoryGraphQL = ({\n  metricKey,\n  runUuids,\n  autoRefreshEnabled,\n  enabled,\n  maxResults = 320,\n  range,\n}: {\n  runUuids: string[];\n  metricKey: string;\n  maxResults?: number;\n  range?: [number, number];\n  enabled?: boolean;\n  autoRefreshEnabled?: boolean;\n}) => {\n  const intl = useIntl();\n  const { data, refetch, startPolling, stopPolling, networkStatus, error } = useQuery<GetMetricHistoryBulkInterval>(\n    GET_METRIC_HISTORY_BULK_INTERVAL,\n    {\n      skip: !enabled,\n      notifyOnNetworkStatusChange: true,\n      pollInterval: autoRefreshEnabled ? EXPERIMENT_RUNS_METRIC_AUTO_REFRESH_INTERVAL : undefined,\n      onCompleted(data) {\n        if (data.mlflowGetMetricHistoryBulkInterval?.apiError?.code === 'RESOURCE_DOES_NOT_EXIST') {\n          Utils.displayGlobalErrorNotification(\n            intl.formatMessage({\n              defaultMessage: 'Requested resource does not exist',\n              description:\n                'Error message displayed when a requested run does not exist while fetching sampled metric data',\n            }),\n          );\n        } else if (data.mlflowGetMetricHistoryBulkInterval?.apiError?.message) {\n          Utils.logErrorAndNotifyUser(new Error(data.mlflowGetMetricHistoryBulkInterval.apiError.message));\n        }\n      },\n      variables: {\n        data: {\n          runIds: runUuids,\n          metricKey,\n          startStep: range?.[0] ?? null,\n          endStep: range?.[1] ?? null,\n          maxResults,\n        },\n      },\n    },\n  );\n\n  useEffect(() => {\n    if (autoRefreshEnabled) {\n      startPolling(EXPERIMENT_RUNS_METRIC_AUTO_REFRESH_INTERVAL);\n    } else {\n      stopPolling();\n    }\n  }, [autoRefreshEnabled, startPolling, stopPolling]);\n\n  const resultsByRunUuid = useMemo<Record<string, SampledMetricsByRun>>(() => {\n    if (data) {\n      const metrics = data?.mlflowGetMetricHistoryBulkInterval?.metrics;\n      const metricsByRunId = groupBy(metrics, 'runId');\n\n      // Transform the data into the already existing format\n      return keyBy(\n        runUuids.map(\n          (runId) =>\n            ({\n              runUuid: runId,\n              [metricKey]: {\n                metricsHistory: metricsByRunId[runId]?.map(({ key, step, timestamp, value }) => ({\n                  key: key ?? undefined,\n                  step: Number(step),\n                  timestamp: Number(timestamp),\n                  value: value ?? undefined,\n                })),\n              },\n            } as SampledMetricsByRun),\n        ),\n        'runUuid',\n      );\n    }\n\n    return {};\n  }, [data, metricKey, runUuids]);\n\n  const isLoading = networkStatus === NetworkStatus.loading || networkStatus === NetworkStatus.setVariables;\n  const isRefreshing = networkStatus === NetworkStatus.poll;\n  return {\n    resultsByRunUuid,\n    isLoading,\n    isRefreshing,\n    refresh: refetch,\n    error,\n    apiError: data?.mlflowGetMetricHistoryBulkInterval?.apiError,\n  };\n};\n","import { chunk, isEqual, keyBy } from 'lodash';\nimport { useCallback, useEffect, useMemo, useRef } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport type { ReduxState, ThunkDispatch } from '../../../../redux-types';\nimport { createChartAxisRangeKey } from '../components/RunsCharts.common';\nimport { getSampledMetricHistoryBulkAction } from '../../../sdk/SampledMetricHistoryService';\nimport type { SampledMetricsByRunUuidState } from '@mlflow/mlflow/src/experiment-tracking/types';\nimport { EXPERIMENT_RUNS_METRIC_AUTO_REFRESH_INTERVAL } from '../../../utils/MetricsUtils';\nimport Utils from '../../../../common/utils/Utils';\nimport { shouldEnableGraphQLSampledMetrics } from '../../../../common/utils/FeatureUtils';\nimport { useSampledMetricHistoryGraphQL } from './useSampledMetricHistoryGraphQL';\n\ntype SampledMetricData = SampledMetricsByRunUuidState[string][string][string];\n\nexport type SampledMetricsByRun = {\n  runUuid: string;\n} & {\n  [metricKey: string]: SampledMetricData;\n};\n\nconst SAMPLED_METRIC_HISTORY_API_RUN_LIMIT = 100;\n\n/**\n * Automatically fetches sampled metric history for runs, used in run runs charts.\n * After updating list of metrics or runs, optimizes the request and fetches\n * only the missing entries.\n *\n * REST-based implementation.\n */\nconst useSampledMetricHistoryREST = (params: {\n  runUuids: string[];\n  metricKeys: string[];\n  maxResults?: number;\n  range?: [number, number];\n  enabled?: boolean;\n  autoRefreshEnabled?: boolean;\n}) => {\n  const { metricKeys, runUuids, enabled, maxResults, range, autoRefreshEnabled } = params;\n  const dispatch = useDispatch<ThunkDispatch>();\n\n  const { resultsByRunUuid, isLoading, isRefreshing } = useSelector(\n    (store: ReduxState) => {\n      const rangeKey = createChartAxisRangeKey(range);\n\n      let anyRunRefreshing = false;\n      let anyRunLoading = false;\n\n      const returnValues: SampledMetricsByRun[] = runUuids.map((runUuid) => {\n        const metricsByMetricKey = metricKeys.reduce(\n          (dataByMetricKey: { [key: string]: SampledMetricData }, metricKey: string) => {\n            const runMetricData = store.entities.sampledMetricsByRunUuid[runUuid]?.[metricKey]?.[rangeKey];\n\n            if (!runMetricData) {\n              return dataByMetricKey;\n            }\n\n            anyRunLoading = anyRunLoading || Boolean(runMetricData.loading);\n            anyRunRefreshing = anyRunRefreshing || Boolean(runMetricData.refreshing);\n\n            dataByMetricKey[metricKey] = runMetricData;\n            return dataByMetricKey;\n          },\n          {},\n        );\n\n        return {\n          runUuid,\n          ...metricsByMetricKey,\n        };\n      });\n\n      return {\n        isLoading: anyRunLoading,\n        isRefreshing: anyRunRefreshing,\n        resultsByRunUuid: keyBy(returnValues, 'runUuid'),\n      };\n    },\n    (left, right) =>\n      isEqual(left.resultsByRunUuid, right.resultsByRunUuid) &&\n      left.isLoading === right.isLoading &&\n      left.isRefreshing === right.isRefreshing,\n  );\n\n  const refreshFn = useCallback(() => {\n    metricKeys.forEach((metricKey) => {\n      chunk(runUuids, SAMPLED_METRIC_HISTORY_API_RUN_LIMIT).forEach((runUuidsChunk) => {\n        const action = getSampledMetricHistoryBulkAction(runUuidsChunk, metricKey, maxResults, range, 'all');\n        dispatch(action);\n      });\n    });\n  }, [dispatch, maxResults, runUuids, metricKeys, range]);\n\n  const refreshTimeoutRef = useRef<number | undefined>(undefined);\n  const autoRefreshEnabledRef = useRef(autoRefreshEnabled && params.enabled);\n  autoRefreshEnabledRef.current = autoRefreshEnabled && params.enabled;\n\n  // Serialize runUuids to a string to use as a dependency in the effect,\n  // directly used runUuids can cause unnecessary re-fetches\n  const runUuidsSerialized = useMemo(() => runUuids.join(','), [runUuids]);\n\n  // Regular single fetch effect with no auto-refresh capabilities. Used if auto-refresh is disabled.\n  useEffect(() => {\n    if (!enabled || autoRefreshEnabled) {\n      return;\n    }\n    metricKeys.forEach((metricKey) => {\n      chunk(runUuids, SAMPLED_METRIC_HISTORY_API_RUN_LIMIT).forEach((runUuidsChunk) => {\n        const action = getSampledMetricHistoryBulkAction(runUuidsChunk, metricKey, maxResults, range);\n        dispatch(action);\n      });\n    });\n  }, [dispatch, maxResults, runUuids, metricKeys, range, enabled, autoRefreshEnabled]);\n\n  // A fetch effect with auto-refresh capabilities. Used only if auto-refresh is enabled.\n  useEffect(() => {\n    let hookUnmounted = false;\n    if (!enabled || !autoRefreshEnabled) {\n      return;\n    }\n\n    // Base fetching function, used for both initial call and subsequent auto-refresh calls\n    const fetchMetricsFn = async (isAutoRefreshing = false) => {\n      const runUuids = runUuidsSerialized.split(',').filter((runUuid: string) => runUuid !== '');\n      await Promise.all(\n        metricKeys.map(async (metricKey) =>\n          Promise.all(\n            chunk(runUuids, SAMPLED_METRIC_HISTORY_API_RUN_LIMIT).map(async (runUuidsChunk) =>\n              dispatch(\n                getSampledMetricHistoryBulkAction(\n                  runUuidsChunk,\n                  metricKey,\n                  maxResults,\n                  range,\n                  isAutoRefreshing ? 'auto' : undefined,\n                ),\n              ),\n            ),\n          ),\n        ),\n      );\n    };\n\n    const scheduleRefresh = async () => {\n      // Initial check to confirm that auto-refresh is still enabled and the hook is still mounted\n      if (!autoRefreshEnabledRef.current || hookUnmounted) {\n        return;\n      }\n      try {\n        await fetchMetricsFn(true);\n      } catch (e) {\n        // In case of error during auto-refresh, log the error but do break the auto-refresh loop\n        Utils.logErrorAndNotifyUser(e);\n      }\n      clearTimeout(refreshTimeoutRef.current);\n\n      // After loading the data, schedule the next refresh if the hook is still enabled and mounted\n      if (!autoRefreshEnabledRef.current || hookUnmounted) {\n        return;\n      }\n\n      refreshTimeoutRef.current = window.setTimeout(scheduleRefresh, EXPERIMENT_RUNS_METRIC_AUTO_REFRESH_INTERVAL);\n    };\n\n    fetchMetricsFn().then(scheduleRefresh);\n\n    return () => {\n      // Mark the hook as unmounted to prevent scheduling new auto-refreshes with current data\n      hookUnmounted = true;\n\n      // Clear the timeout\n      clearTimeout(refreshTimeoutRef.current);\n    };\n  }, [dispatch, maxResults, runUuidsSerialized, metricKeys, range, enabled, autoRefreshEnabled]);\n\n  return { isLoading, isRefreshing, resultsByRunUuid, refresh: refreshFn };\n};\n\n/**\n * A switcher hook that selects between the REST and GraphQL implementations of the\n * `useSampledMetricHistory` hook based on flags and parameter context.\n */\nexport const useSampledMetricHistory = (params: {\n  runUuids: string[];\n  metricKeys: string[];\n  maxResults?: number;\n  range?: [number, number];\n  enabled?: boolean;\n  autoRefreshEnabled?: boolean;\n}) => {\n  const { metricKeys, enabled, autoRefreshEnabled, runUuids } = params;\n\n  // We should use the apollo hook if there is only one metric key and the number of runUuids is less than 100.\n  // To be improved after endpoint will start supporting multiple metric keys.\n  const shouldUseGraphql = shouldEnableGraphQLSampledMetrics() && metricKeys.length === 1 && runUuids.length <= 100;\n\n  const legacyResult = useSampledMetricHistoryREST({\n    ...params,\n    enabled: enabled && !shouldUseGraphql,\n    autoRefreshEnabled: autoRefreshEnabled && !shouldUseGraphql,\n  });\n\n  const graphQlResult = useSampledMetricHistoryGraphQL({\n    ...params,\n    metricKey: metricKeys[0],\n    enabled: enabled && shouldUseGraphql,\n    autoRefreshEnabled: autoRefreshEnabled && shouldUseGraphql,\n  });\n\n  return shouldUseGraphql ? graphQlResult : legacyResult;\n};\n","import qs from 'qs';\nimport { useMemo } from 'react';\nimport { useParams, useLocation } from '../../../../common/utils/RoutingUtils';\nimport Utils from '../../../../common/utils/Utils';\n\nexport type UseExperimentIdsResult = string[];\n\n/**\n * Hook that returns requested experiment IDs basing on the URL.\n * It extracts ids basing on either route match (in case of a single experiment)\n * or query params (in case of comparing experiments.).\n *\n * @returns array of strings with experiment IDs\n */\n\nexport const useExperimentIds = (): UseExperimentIdsResult => {\n  const params = useParams<{ experimentId?: string }>();\n  const location = useLocation();\n\n  const normalizedLocationSearch = useMemo(() => decodeURIComponent(location.search), [location.search]);\n\n  /**\n   * Memoized string containing experiment IDs for comparison (\"?experiments=...\")\n   */\n  const compareExperimentIdsQueryParam = useMemo(() => {\n    const queryParams = qs.parse(normalizedLocationSearch.substring(1));\n    if (queryParams['experiments']) {\n      const experimentIdsRaw = queryParams['experiments'];\n      return experimentIdsRaw?.toString() || '';\n    }\n\n    return '';\n  }, [normalizedLocationSearch]);\n\n  return useMemo(() => {\n    // Case #1: single experiment\n    if (params?.experimentId) {\n      return [params?.experimentId];\n    }\n\n    // Case #2: multiple (compare) experiments\n    if (compareExperimentIdsQueryParam) {\n      try {\n        return JSON.parse(compareExperimentIdsQueryParam);\n      } catch {\n        // Apparently URL is malformed\n        Utils.logErrorAndNotifyUser(`Could not parse experiment query parameter ${compareExperimentIdsQueryParam}`);\n        return '';\n      }\n    }\n\n    return [];\n  }, [compareExperimentIdsQueryParam, params?.experimentId]);\n};\n","import { isUndefined, noop } from 'lodash';\nimport {\n  type PropsWithChildren,\n  createContext,\n  createElement,\n  useContext,\n  useMemo,\n  useRef,\n  useEffect,\n  useState,\n  useCallback,\n} from 'react';\nimport { shouldEnableUnifiedChartDataTraceHighlight } from '../../../../common/utils/FeatureUtils';\n\n/**\n * Function used to highlight particular trace in the experiment runs chart,\n * for both hover and select scenarios.\n * Since implementation varies across chart types, the function is curryable where\n * two first-level parameters determine the target SVG selector paths to the trace within\n * target chart type.\n *\n * @param traceSelector selector path to the trace for a particular chart type\n * @param parentSelector selector path to the traces container for a particular chart type\n */\nconst highlightChartTracesFn =\n  (traceSelector: string, parentSelector: string) =>\n  /**\n   * @param parent a HTML element containing the chart\n   * @param hoverIndex index of a trace that should be hover-higlighted, set -1 to remove highlight\n   * @param selectIndex index of a trace that should be select-higlighted, set -1 to remove highlight\n   */\n  (parent: HTMLElement, hoverIndex: number, selectIndex: number, numberOfBands = 0) => {\n    const deselected = hoverIndex === -1 && selectIndex === -1;\n\n    parent.querySelector('.is-hover-highlight')?.classList.remove('is-hover-highlight');\n    if (hoverIndex > -1) {\n      parent.querySelectorAll(traceSelector)[hoverIndex]?.classList.add('is-hover-highlight');\n    }\n\n    parent.querySelector('.is-selection-highlight')?.classList.remove('is-selection-highlight');\n    if (selectIndex > -1) {\n      parent.querySelectorAll(traceSelector)[selectIndex]?.classList.add('is-selection-highlight');\n    }\n\n    if (numberOfBands > 0) {\n      const bandTraceIndex =\n        selectIndex > -1 ? selectIndex - numberOfBands : hoverIndex > -1 ? hoverIndex - numberOfBands : -1;\n      parent.querySelectorAll(traceSelector).forEach((e, index) => {\n        e.classList.toggle('is-band', index >= 0 && index < numberOfBands);\n        e.classList.toggle('is-band-highlighted', index === bandTraceIndex);\n      });\n    } else {\n      parent.querySelectorAll(traceSelector).forEach((e) => e.classList.remove('is-band'));\n    }\n\n    if (deselected) {\n      parent.querySelector(parentSelector)?.classList.remove('is-highlight');\n    } else {\n      parent.querySelector(parentSelector)?.classList.add('is-highlight');\n    }\n  };\n\n/**\n * Type-specific implementation of highlightChartTracesFn for bar charts\n */\nexport const highlightBarTraces = highlightChartTracesFn('svg .trace.bars g.point', '.trace.bars');\n\n/**\n * Type-specific implementation of highlightChartTracesFn for line charts\n */\nexport const highlightLineTraces = highlightChartTracesFn('svg .scatterlayer g.trace', '.scatterlayer');\n\n/**\n * Type-specific implementation of highlightChartTracesFn for scatter and contour charts\n */\nexport const highlightScatterTraces = highlightChartTracesFn('svg .scatterlayer path.point', '.trace.scatter');\n\n/**\n * This hook provides mechanisms necessary for highlighting SVG trace paths\n * in experiment runs charts.\n *\n * @param containerDiv HTML element containing the chart\n * @param selectedRunUuid currently selected run UUID (set to -1 if none)\n * @param runsData array containing run informations, should be the same order as provided to the chart\n * @param highlightFn a styling function that will be called when the trace should be (un)highlighted, please refer to `highlightCallbackFn()`\n */\nexport const useRenderRunsChartTraceHighlight = (\n  containerDiv: HTMLElement | null,\n  selectedRunUuid: string | null | undefined,\n  runsData: { uuid?: string }[],\n  highlightFn: ReturnType<typeof highlightChartTracesFn>,\n  numberOfBands = 0,\n) => {\n  // Save the last runs data to be available immediately on non-stateful callbacks\n  const lastRunsData = useRef(runsData);\n  lastRunsData.current = runsData;\n\n  const selectedTraceIndex = useMemo(() => {\n    if (!containerDiv || !selectedRunUuid) {\n      return -1;\n    }\n    return runsData.findIndex(({ uuid }) => uuid === selectedRunUuid);\n  }, [runsData, containerDiv, selectedRunUuid]);\n\n  const [hoveredPointIndex, setHoveredPointIndex] = useState(-1);\n  const { onHighlightChange } = useRunsChartTraceHighlight();\n\n  useEffect(() => {\n    // Disable this hook variant if new highlight model is enabled\n    if (shouldEnableUnifiedChartDataTraceHighlight()) {\n      return;\n    }\n    if (!containerDiv) {\n      return;\n    }\n    highlightFn(containerDiv, hoveredPointIndex, selectedTraceIndex, numberOfBands);\n  }, [highlightFn, containerDiv, selectedTraceIndex, hoveredPointIndex, numberOfBands]);\n\n  useEffect(() => {\n    // Use this hook variant only if new highlight model is enabled\n    if (!shouldEnableUnifiedChartDataTraceHighlight()) {\n      return;\n    }\n    if (!containerDiv) {\n      return;\n    }\n    // Here, we don't report stateful hovered run UUID since it's handled by the new highlight model\n    highlightFn(containerDiv, -1, selectedTraceIndex, numberOfBands);\n  }, [highlightFn, containerDiv, selectedTraceIndex, numberOfBands]);\n\n  // Save the last selected trace index to be available immediately on non-stateful callbacks\n  const lastSelectedTraceIndex = useRef(selectedTraceIndex);\n  lastSelectedTraceIndex.current = selectedTraceIndex;\n\n  const highlightChangeListener = useCallback(\n    (newExtern: string | null) => {\n      if (!containerDiv) {\n        return;\n      }\n\n      const externallyHighlightedRunIndex = lastRunsData.current.findIndex(({ uuid }) => uuid === newExtern);\n      highlightFn(containerDiv, externallyHighlightedRunIndex, lastSelectedTraceIndex.current, numberOfBands);\n    },\n    [highlightFn, containerDiv, numberOfBands],\n  );\n\n  // Listen to the highlight change event\n  useEffect(() => onHighlightChange(highlightChangeListener), [onHighlightChange, highlightChangeListener]);\n\n  return {\n    selectedTraceIndex,\n    hoveredPointIndex,\n    // With the unified chart data trace highlight, we don't need to do costly state updates anymore\n    setHoveredPointIndex: shouldEnableUnifiedChartDataTraceHighlight() ? noop : setHoveredPointIndex,\n  };\n};\n\nexport enum ChartsTraceHighlightSource {\n  NONE,\n  CHART,\n  TABLE,\n}\n\ninterface RunsChartsSetHighlightContextType {\n  highlightDataTrace: (\n    traceUuid: string | null,\n    options?: { source?: ChartsTraceHighlightSource; shouldBlock?: boolean },\n  ) => void;\n  onHighlightChange: (fn: (traceUuid: string | null, source?: ChartsTraceHighlightSource) => void) => () => void;\n}\n\nconst RunsChartsSetHighlightContext = createContext<RunsChartsSetHighlightContextType>({\n  highlightDataTrace: () => {},\n  onHighlightChange: () => () => {},\n});\n\nexport const RunsChartsSetHighlightContextProvider = ({ children }: PropsWithChildren<unknown>) => {\n  const highlightListenerFns = useRef<((traceUuid: string | null, source?: ChartsTraceHighlightSource) => void)[]>([]);\n  const block = useRef(false);\n\n  // Stable and memoized context value\n  const contextValue = useMemo<RunsChartsSetHighlightContextType>(() => {\n    // If new highlight model is disabled, disable entire feature by providint empty logic to the context\n    if (!shouldEnableUnifiedChartDataTraceHighlight()) {\n      return {\n        highlightDataTrace: () => {},\n        onHighlightChange: () => () => {},\n      };\n    }\n\n    const notifyListeners = (traceUuid: string | null, source?: ChartsTraceHighlightSource) => {\n      for (const fn of highlightListenerFns.current) {\n        fn(traceUuid, source);\n      }\n    };\n\n    const highlightDataTrace = (\n      traceUuid: string | null,\n      { shouldBlock, source }: { source?: ChartsTraceHighlightSource; shouldBlock?: boolean } = {},\n    ) => {\n      if (!isUndefined(shouldBlock)) {\n        block.current = shouldBlock;\n      } else if (block.current) {\n        return;\n      }\n      notifyListeners(traceUuid, source);\n    };\n\n    const onHighlightChange = (listener: (traceUuid: string | null, source?: ChartsTraceHighlightSource) => void) => {\n      highlightListenerFns.current.push(listener);\n      return () => {\n        highlightListenerFns.current = highlightListenerFns.current.filter((fn) => fn !== listener);\n      };\n    };\n\n    return {\n      highlightDataTrace,\n      onHighlightChange,\n    };\n  }, []);\n\n  return createElement(RunsChartsSetHighlightContext.Provider, { value: contextValue }, children);\n};\n\nexport const useRunsChartTraceHighlight = () => useContext(RunsChartsSetHighlightContext);\n","import { MLFLOW_SYSTEM_METRIC_PREFIX } from '@mlflow/mlflow/src/experiment-tracking/constants';\nimport type { MetricEntitiesByName } from '../../../types';\nimport type { KeyValueEntity } from '../../../../common/types';\nimport type { RunsChartsRunData } from '../components/RunsCharts.common';\nimport type { RunsChartsDifferenceCardConfig } from '../runs-charts.types';\nimport { DifferenceCardAttributes } from '../runs-charts.types';\nimport Utils from '@mlflow/mlflow/src/common/utils/Utils';\nimport type { RunsGroupByConfig } from '../../experiment-page/utils/experimentPage.group-row-utils';\n\nconst DIFFERENCE_CHART_DEFAULT_EMPTY_VALUE = '-';\nconst DIFFERENCE_EPSILON = 1e-6;\nexport const getDifferenceChartDisplayedValue = (val: any, places = 2) => {\n  if (typeof val === 'number') {\n    return val.toFixed(places);\n  } else if (typeof val === 'string') {\n    return val;\n  }\n  try {\n    return JSON.stringify(val);\n  } catch {\n    return DIFFERENCE_CHART_DEFAULT_EMPTY_VALUE;\n  }\n};\n\nexport enum DifferenceChartCellDirection {\n  POSITIVE,\n  NEGATIVE,\n  SAME,\n}\nexport const differenceView = (a: any, b: any) => {\n  if (typeof a !== 'number' || typeof b !== 'number') {\n    return undefined;\n  } else {\n    const diff = a - b;\n    if (diff === 0) {\n      return { label: getDifferenceChartDisplayedValue(diff).toString(), direction: DifferenceChartCellDirection.SAME };\n    } else if (diff > 0) {\n      return { label: `+${getDifferenceChartDisplayedValue(diff)}`, direction: DifferenceChartCellDirection.POSITIVE };\n    } else {\n      return {\n        label: getDifferenceChartDisplayedValue(diff).toString(),\n        direction: DifferenceChartCellDirection.NEGATIVE,\n      };\n    }\n  }\n};\n\nexport const isDifferent = (a: any, b: any) => {\n  if (a === DIFFERENCE_CHART_DEFAULT_EMPTY_VALUE || b === DIFFERENCE_CHART_DEFAULT_EMPTY_VALUE) {\n    return false;\n  }\n  // Check if type a and b are the same\n  if (typeof a !== typeof b) {\n    return true;\n  } else if (typeof a === 'number' && typeof b === 'number') {\n    return Math.abs(a - b) > DIFFERENCE_EPSILON;\n  } else if (typeof a === 'string' && typeof b === 'string') {\n    return a !== b;\n  }\n  return false;\n};\n\nexport const getDifferenceViewDataGroups = (\n  previewData: RunsChartsRunData[],\n  cardConfig: RunsChartsDifferenceCardConfig,\n  headingColumnId: string,\n  groupBy: RunsGroupByConfig | null,\n) => {\n  const getMetrics = (\n    filterCondition: (metric: string) => boolean,\n    runDataKeys: (data: RunsChartsRunData) => string[],\n    runDataAttribute: (\n      data: RunsChartsRunData,\n    ) =>\n      | MetricEntitiesByName\n      | Record<string, KeyValueEntity>\n      | Record<string, { key: string; value: string | number }>,\n  ) => {\n    // Get array of sorted keys\n    const keys = Array.from(new Set(previewData.flatMap((runData) => runDataKeys(runData))))\n      .filter((key) => filterCondition(key))\n      .sort();\n    const values = keys.flatMap((key: string) => {\n      const data: Record<string, string | number> = {};\n      let hasDifference = false;\n\n      previewData.forEach((runData, index) => {\n        // Set the key as runData.uuid and the value as the metric's value or DEFAULT_EMPTY_VALUE\n        data[runData.uuid] = runDataAttribute(runData)[key]\n          ? runDataAttribute(runData)[key].value\n          : DIFFERENCE_CHART_DEFAULT_EMPTY_VALUE;\n        if (index > 0) {\n          const prev = previewData[index - 1];\n          if (isDifferent(data[prev.uuid], data[runData.uuid])) {\n            hasDifference = true;\n          }\n        }\n      });\n      if (cardConfig.showDifferencesOnly && !hasDifference) {\n        return [];\n      }\n      return [\n        {\n          [headingColumnId]: key,\n          ...data,\n        },\n      ];\n    });\n    return values;\n  };\n\n  const modelMetrics = getMetrics(\n    (metric: string) => !metric.startsWith(MLFLOW_SYSTEM_METRIC_PREFIX),\n    (runData: RunsChartsRunData) => Object.keys(runData.metrics),\n    (runData: RunsChartsRunData) => runData.metrics,\n  );\n\n  const systemMetrics = getMetrics(\n    (metric: string) => metric.startsWith(MLFLOW_SYSTEM_METRIC_PREFIX),\n    (runData: RunsChartsRunData) => Object.keys(runData.metrics),\n    (runData: RunsChartsRunData) => runData.metrics,\n  );\n\n  if (groupBy) {\n    return { modelMetrics, systemMetrics, parameters: [], tags: [], attributes: [] };\n  }\n\n  const parameters = getMetrics(\n    () => true,\n    (runData: RunsChartsRunData) => Object.keys(runData.params),\n    (runData: RunsChartsRunData) => runData.params,\n  );\n\n  const tags = getMetrics(\n    () => true,\n    (runData: RunsChartsRunData) => Utils.getVisibleTagValues(runData.tags).map(([key]) => key),\n    (runData: RunsChartsRunData) => runData.tags,\n  );\n\n  // Get attributes\n  const attributeGroups = [\n    DifferenceCardAttributes.USER,\n    DifferenceCardAttributes.SOURCE,\n    DifferenceCardAttributes.VERSION,\n    DifferenceCardAttributes.MODELS,\n  ];\n  const attributes = attributeGroups.flatMap((attribute) => {\n    const attributeData: Record<string, string | number> = {};\n    let hasDifference = false;\n    previewData.forEach((runData, index) => {\n      if (attribute === DifferenceCardAttributes.USER) {\n        const user = Utils.getUser(runData.runInfo ?? {}, runData.tags);\n        attributeData[runData.uuid] = user;\n      } else if (attribute === DifferenceCardAttributes.SOURCE) {\n        const source = Utils.getSourceName(runData.tags);\n        attributeData[runData.uuid] = source;\n      } else if (attribute === DifferenceCardAttributes.VERSION) {\n        const version = Utils.getSourceVersion(runData.tags);\n        attributeData[runData.uuid] = version;\n      } else {\n        const models = Utils.getLoggedModelsFromTags(runData.tags);\n        attributeData[runData.uuid] = models.join(',');\n      }\n      if (index > 0) {\n        const prev = previewData[index - 1];\n        if (isDifferent(attributeData[prev.uuid], attributeData[runData.uuid])) {\n          hasDifference = true;\n        }\n      }\n    });\n    if (cardConfig.showDifferencesOnly && !hasDifference) {\n      return [];\n    }\n    return [\n      {\n        [headingColumnId]: attribute,\n        ...attributeData,\n      },\n    ];\n  });\n  return { modelMetrics, systemMetrics, parameters, tags, attributes };\n};\n\nexport const DIFFERENCE_PLOT_EXPAND_COLUMN_ID = 'expand';\nexport const DIFFERENCE_PLOT_HEADING_COLUMN_ID = 'headingColumn';\n\n/**\n * Transforms an array of objects into a format suitable for rendering in a table.\n * Each object in the array represents a row in the table.\n * If all values in a row are JSON objects with the same keys, the row is transformed into a parent row with child rows.\n * Each child row represents a key-value pair from the JSON objects.\n * If a value in a row is not a JSON object or the JSON objects don't have the same keys, the row is not transformed.\n *\n * @param data - An array of objects. Each object represents a row in the table.\n * @returns An array of objects. Each object represents a row or a parent row with child rows in the table.\n */\nexport const getDifferencePlotJSONRows = (data: { [key: string]: string | number }[]) => {\n  const validateParseJSON = (value: string) => {\n    try {\n      const parsed = JSON.parse(value);\n      if (parsed === null || typeof parsed !== 'object' || Array.isArray(parsed) || Object.keys(parsed).length === 0) {\n        return null;\n      }\n      return parsed;\n    } catch (e) {\n      return null;\n    }\n  };\n\n  const extractMaximumCommonSchema = (schema1: Record<any, any> | undefined, schema2: Record<any, any> | undefined) => {\n    if (schema1 !== undefined && Object.keys(schema1).length === 0) {\n      // This may not be a suitable object, return null\n      return null;\n    } else if (schema2 !== undefined && Object.keys(schema2).length === 0) {\n      return null;\n    }\n\n    const schema: Record<string, unknown> = {};\n\n    const collectKeys = (target: Record<any, any>, source: Record<any, any>) => {\n      for (const key in source) {\n        if (!target.hasOwnProperty(key) || target[key]) {\n          if (typeof source[key] === 'object' && source[key] !== null && !Array.isArray(source[key])) {\n            target[key] = target[key] || {};\n            collectKeys(target[key], source[key]);\n          } else if (source[key] === DIFFERENCE_CHART_DEFAULT_EMPTY_VALUE) {\n            target[key] = true;\n          } else {\n            target[key] = false;\n          }\n        }\n      }\n    };\n\n    schema1 !== undefined && collectKeys(schema, schema1);\n    schema2 !== undefined && collectKeys(schema, schema2);\n\n    return schema;\n  };\n\n  const getChildren = (\n    parsedRowWithoutHeadingCol: { [key: string]: Record<any, any> | undefined },\n    schema: Record<any, any>,\n  ): Record<string, any>[] => {\n    return Object.keys(schema).map((key) => {\n      if (typeof schema[key] === 'boolean') {\n        let result = {\n          key: key,\n          [DIFFERENCE_PLOT_HEADING_COLUMN_ID]: key,\n        };\n        Object.keys(parsedRowWithoutHeadingCol).forEach((runUuid) => {\n          const value = parsedRowWithoutHeadingCol[runUuid]?.[key];\n          result = {\n            ...result,\n            [runUuid]: value === undefined ? DIFFERENCE_CHART_DEFAULT_EMPTY_VALUE : value,\n          };\n        });\n        return result;\n      }\n      // Recurse\n      const newParsedRow: { [key: string]: Record<any, any> | undefined } = {};\n      Object.keys(parsedRowWithoutHeadingCol).forEach((runUuid) => {\n        newParsedRow[runUuid] = parsedRowWithoutHeadingCol[runUuid]?.[key];\n      });\n\n      return {\n        key: key,\n        [DIFFERENCE_PLOT_HEADING_COLUMN_ID]: key,\n        children: getChildren(newParsedRow, schema[key]),\n      };\n    });\n  };\n\n  const isAllElementsJSON = (row: { [key: string]: string | number }) => {\n    let jsonSchema: Record<any, any> | undefined = undefined;\n    let isAllJson = true;\n    const parsedRow: Record<string, any> = {};\n\n    Object.keys(row).forEach((runUuid) => {\n      if (runUuid !== DIFFERENCE_PLOT_HEADING_COLUMN_ID) {\n        if (row[runUuid] !== DIFFERENCE_CHART_DEFAULT_EMPTY_VALUE) {\n          const json = validateParseJSON(row[runUuid] as string);\n          parsedRow[runUuid] = json;\n          if (json === null) {\n            isAllJson = false;\n          } else {\n            const commonSchema = extractMaximumCommonSchema(jsonSchema, json);\n            if (commonSchema === null) {\n              isAllJson = false;\n            } else {\n              jsonSchema = commonSchema;\n            }\n          }\n        }\n      }\n    });\n    if (isAllJson && jsonSchema !== undefined) {\n      try {\n        return {\n          [DIFFERENCE_PLOT_HEADING_COLUMN_ID]: row[DIFFERENCE_PLOT_HEADING_COLUMN_ID],\n          children: getChildren(parsedRow, jsonSchema),\n          key: row[DIFFERENCE_PLOT_HEADING_COLUMN_ID],\n        };\n      } catch {\n        return row;\n      }\n    } else {\n      return row;\n    }\n  };\n  return data.map(isAllElementsJSON);\n};\n","import type { TypographyColor } from '@databricks/design-system';\nimport { ArrowDownIcon, ArrowUpIcon, DashIcon, Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport {\n  DifferenceChartCellDirection,\n  differenceView,\n  getDifferenceChartDisplayedValue,\n} from '../../../utils/differenceView';\nimport { type CellContext } from '@tanstack/react-table';\nimport type { DifferencePlotDataColumnDef } from '../DifferenceViewPlot';\nimport { type DifferencePlotDataRow } from '../DifferenceViewPlot';\n\nconst CellDifference = ({ label, direction }: { label: string; direction: DifferenceChartCellDirection }) => {\n  const { theme } = useDesignSystemTheme();\n  let paragraphColor: TypographyColor | undefined = undefined;\n  let icon = null;\n  switch (direction) {\n    case DifferenceChartCellDirection.NEGATIVE:\n      paragraphColor = 'error';\n      icon = <ArrowDownIcon color=\"danger\" data-testid=\"negative-cell-direction\" />;\n      break;\n    case DifferenceChartCellDirection.POSITIVE:\n      paragraphColor = 'success';\n      icon = <ArrowUpIcon color=\"success\" data-testid=\"positive-cell-direction\" />;\n      break;\n    case DifferenceChartCellDirection.SAME:\n      paragraphColor = 'info';\n      icon = <DashIcon css={{ color: theme.colors.textSecondary }} data-testid=\"same-cell-direction\" />;\n      break;\n    default:\n      break;\n  }\n\n  return (\n    <div\n      css={{\n        display: 'inline-flex',\n        backgroundColor: theme.colors.actionDisabledBackground,\n        padding: `${theme.spacing.xs / 2}px ${theme.spacing.xs}px`,\n        fontSize: theme.typography.fontSizeSm,\n        borderRadius: theme.borders.borderRadiusSm,\n        userSelect: 'none',\n        gap: theme.spacing.xs,\n        alignItems: 'center',\n        svg: {\n          width: theme.typography.fontSizeSm,\n          height: theme.typography.fontSizeSm,\n        },\n        overflow: 'hidden',\n      }}\n    >\n      <Typography.Text size=\"sm\" color={paragraphColor} css={{ margin: 0 }} ellipsis>\n        {label}\n      </Typography.Text>\n      {icon}\n    </div>\n  );\n};\n\nexport const DifferencePlotDataCell = ({\n  getValue,\n  row: { original },\n  column: { columnDef },\n}: CellContext<DifferencePlotDataRow, DifferencePlotDataRow> & {\n  column: { columnDef: DifferencePlotDataColumnDef };\n  row: { original: Record<string, any> };\n}) => {\n  const { theme } = useDesignSystemTheme();\n\n  const { isBaseline, baselineColumnUuid, showChangeFromBaseline } = columnDef.meta ?? {};\n\n  const value = getValue();\n\n  if (isBaseline) {\n    return getDifferenceChartDisplayedValue(getValue());\n  }\n  if (value === undefined) {\n    return null;\n  }\n  const rowDifference = baselineColumnUuid ? differenceView(value, original[baselineColumnUuid]) : null;\n  return (\n    <span css={{ display: 'inline-flex', overflow: 'hidden', gap: theme.spacing.sm, alignItems: 'center' }}>\n      <Typography.Text ellipsis>{getDifferenceChartDisplayedValue(value)}</Typography.Text>\n      {rowDifference && showChangeFromBaseline && (\n        <CellDifference label={rowDifference.label} direction={rowDifference.direction} />\n      )}\n    </span>\n  );\n};\n","import { HeaderContext } from '@tanstack/react-table';\nimport { RunColorPill } from '../../../../experiment-page/components/RunColorPill';\nimport { Button, DropdownMenu, OverflowIcon, Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from 'react-intl';\nimport { type DifferencePlotDataColumnDef } from '../DifferenceViewPlot';\n\nexport const DifferencePlotRunHeaderCell = ({\n  column: { columnDef },\n}: {\n  column: {\n    columnDef: DifferencePlotDataColumnDef;\n  };\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const traceData = columnDef.meta?.traceData;\n  const updateBaselineColumnUuid = columnDef.meta?.updateBaselineColumnUuid;\n  if (!traceData) {\n    return null;\n  }\n  return (\n    <div\n      css={{\n        flex: 1,\n        display: 'inline-flex',\n        overflow: 'hidden',\n        alignItems: 'center',\n        gap: theme.spacing.xs,\n        fontWeight: 'normal',\n      }}\n    >\n      <RunColorPill color={traceData.color} /> <Typography.Text ellipsis>{traceData?.displayName}</Typography.Text>\n      <div css={{ flex: 1 }} />\n      <DropdownMenu.Root>\n        <DropdownMenu.Trigger asChild>\n          <Button\n            type=\"link\"\n            size=\"small\"\n            componentId=\"mlflow.charts.difference_plot.overflow_menu.trigger\"\n            icon={<OverflowIcon />}\n          />\n        </DropdownMenu.Trigger>\n        <DropdownMenu.Content>\n          <DropdownMenu.Item\n            componentId=\"mlflow.charts.difference_plot.overflow_menu.set_as_baseline\"\n            onClick={() => updateBaselineColumnUuid?.(traceData.uuid)}\n          >\n            <FormattedMessage\n              defaultMessage=\"Set as baseline\"\n              description=\"In the run data difference comparison table, the label for an option to set particular experiment run as a baseline one - meaning other runs will be compared to it.\"\n            />\n          </DropdownMenu.Item>\n        </DropdownMenu.Content>\n      </DropdownMenu.Root>\n    </div>\n  );\n};\n","import {\n  Button,\n  ChevronDownIcon,\n  ChevronRightIcon,\n  Table,\n  TableCell,\n  TableHeader,\n  TableRow,\n  useDesignSystemTheme,\n} from '@databricks/design-system';\nimport type { CellContext, ColumnDef, ColumnDefTemplate, Row } from '@tanstack/react-table';\nimport { flexRender, getCoreRowModel, getExpandedRowModel, useReactTable } from '@tanstack/react-table';\nimport { useVirtualizer } from '@tanstack/react-virtual';\nimport { useCallback, useMemo, useRef, useState } from 'react';\nimport { useIntl } from 'react-intl';\nimport type { RunsGroupByConfig } from '../../../experiment-page/utils/experimentPage.group-row-utils';\nimport type { RunsChartsCardConfig, RunsChartsDifferenceCardConfig } from '../../runs-charts.types';\nimport { DifferenceCardConfigCompareGroup } from '../../runs-charts.types';\nimport {\n  DIFFERENCE_PLOT_EXPAND_COLUMN_ID,\n  DIFFERENCE_PLOT_HEADING_COLUMN_ID,\n  getDifferencePlotJSONRows,\n  getDifferenceViewDataGroups,\n} from '../../utils/differenceView';\nimport type { RunsChartsRunData } from '../RunsCharts.common';\nimport { DifferencePlotDataCell } from './difference-view-plot/DifferencePlotDataCell';\nimport { DifferencePlotRunHeaderCell } from './difference-view-plot/DifferencePlotRunHeaderCell';\n\nexport type DifferencePlotDataColumnDef = ColumnDef<DifferencePlotDataRow> & {\n  meta?: {\n    traceData?: RunsChartsRunData;\n    updateBaselineColumnUuid: (uuid: string) => void;\n    isBaseline: boolean;\n    showChangeFromBaseline: boolean;\n    baselineColumnUuid?: string;\n  };\n};\n\nexport type DifferencePlotDataRow =\n  | Record<string, any>\n  | {\n      children: DifferencePlotDataRow[];\n      key: string;\n      [DIFFERENCE_PLOT_HEADING_COLUMN_ID]: string;\n    };\n\nconst ExpandCell: ColumnDefTemplate<\n  CellContext<DifferencePlotDataRow, unknown> & { toggleExpand?: (row: Row<DifferencePlotDataRow>) => void }\n> = ({ row, toggleExpand }) => {\n  if (row.getCanExpand() && toggleExpand) {\n    return (\n      <Button\n        componentId=\"mlflow.charts.difference_plot.expand_button\"\n        size=\"small\"\n        type=\"link\"\n        onClick={() => toggleExpand(row)}\n        icon={row.getIsExpanded() ? <ChevronDownIcon /> : <ChevronRightIcon />}\n      />\n    );\n  }\n  return null;\n};\n\nexport const DifferenceViewPlot = ({\n  previewData,\n  cardConfig,\n  groupBy,\n  setCardConfig,\n}: {\n  previewData: RunsChartsRunData[];\n  cardConfig: RunsChartsDifferenceCardConfig;\n  groupBy: RunsGroupByConfig | null;\n  setCardConfig?: (setter: (current: RunsChartsCardConfig) => RunsChartsDifferenceCardConfig) => void;\n}) => {\n  const { formatMessage } = useIntl();\n  const { theme } = useDesignSystemTheme();\n\n  const { modelMetrics, systemMetrics, parameters, tags, attributes } = useMemo(\n    () => getDifferenceViewDataGroups(previewData, cardConfig, DIFFERENCE_PLOT_HEADING_COLUMN_ID, groupBy),\n    [previewData, cardConfig, groupBy],\n  );\n\n  const { baselineColumn, nonBaselineColumns } = useMemo(() => {\n    const dataTracesReverse = previewData.slice().reverse();\n    // baseline column (can be undefined if no baseline selected)\n    let baselineColumn = dataTracesReverse.find((runData) => runData.uuid === cardConfig.baselineColumnUuid);\n    if (baselineColumn === undefined && dataTracesReverse.length > 0) {\n      // Set the first column as baseline column\n      baselineColumn = dataTracesReverse[0];\n    }\n    // non-baseline columns\n    const nonBaselineColumns = dataTracesReverse.filter(\n      (runData) => baselineColumn === undefined || runData.uuid !== baselineColumn.uuid,\n    );\n    return { baselineColumn, nonBaselineColumns };\n  }, [previewData, cardConfig.baselineColumnUuid]);\n\n  const updateBaselineColumnUuid = useCallback(\n    (baselineColumnUuid: string) => {\n      setCardConfig?.((current) => ({\n        ...(current as RunsChartsDifferenceCardConfig),\n        baselineColumnUuid,\n      }));\n    },\n    [setCardConfig],\n  );\n\n  const dataRows = useMemo<DifferencePlotDataRow[]>(\n    () =>\n      cardConfig.compareGroups.reduce((acc: DifferencePlotDataRow[], group: DifferenceCardConfigCompareGroup) => {\n        switch (group) {\n          case DifferenceCardConfigCompareGroup.MODEL_METRICS:\n            acc.push({\n              [DIFFERENCE_PLOT_HEADING_COLUMN_ID]: formatMessage({\n                defaultMessage: `Model Metrics`,\n                description:\n                  'Experiment tracking > runs charts > cards > RunsChartsDifferenceChartCard > model metrics heading',\n              }),\n              children: [...modelMetrics],\n              key: 'modelMetrics',\n            });\n            break;\n          case DifferenceCardConfigCompareGroup.SYSTEM_METRICS:\n            acc.push({\n              [DIFFERENCE_PLOT_HEADING_COLUMN_ID]: formatMessage({\n                defaultMessage: `System Metrics`,\n                description:\n                  'Experiment tracking > runs charts > cards > RunsChartsDifferenceChartCard > system metrics heading',\n              }),\n              children: [...systemMetrics],\n              key: 'systemMetrics',\n            });\n            break;\n          case DifferenceCardConfigCompareGroup.PARAMETERS:\n            acc.push({\n              [DIFFERENCE_PLOT_HEADING_COLUMN_ID]: formatMessage({\n                defaultMessage: `Parameters`,\n                description:\n                  'Experiment tracking > runs charts > cards > RunsChartsDifferenceChartCard > parameters heading',\n              }),\n              children: getDifferencePlotJSONRows(parameters),\n              key: 'parameters',\n            });\n            break;\n          case DifferenceCardConfigCompareGroup.ATTRIBUTES:\n            acc.push({\n              [DIFFERENCE_PLOT_HEADING_COLUMN_ID]: formatMessage({\n                defaultMessage: `Attributes`,\n                description:\n                  'Experiment tracking > runs charts > cards > RunsChartsDifferenceChartCard > attributes heading',\n              }),\n              children: [...attributes],\n              key: 'attributes',\n            });\n            break;\n          case DifferenceCardConfigCompareGroup.TAGS:\n            acc.push({\n              [DIFFERENCE_PLOT_HEADING_COLUMN_ID]: formatMessage({\n                defaultMessage: `Tags`,\n                description: 'Experiment tracking > runs charts > cards > RunsChartsDifferenceChartCard > tags heading',\n              }),\n              children: [...tags],\n              key: 'tags',\n            });\n            break;\n        }\n        return acc;\n      }, []),\n    [modelMetrics, systemMetrics, parameters, tags, attributes, cardConfig.compareGroups, formatMessage],\n  );\n\n  const columns = useMemo(() => {\n    const columns: DifferencePlotDataColumnDef[] = [\n      {\n        id: DIFFERENCE_PLOT_EXPAND_COLUMN_ID,\n        cell: ExpandCell,\n        size: 32,\n        enableResizing: false,\n      },\n      {\n        accessorKey: DIFFERENCE_PLOT_HEADING_COLUMN_ID,\n        size: 150,\n        header: formatMessage({\n          defaultMessage: 'Compare by',\n          description: 'Runs charts > components > charts > DifferenceViewPlot > Compare by column heading',\n        }),\n        id: DIFFERENCE_PLOT_HEADING_COLUMN_ID,\n        enableResizing: true,\n      },\n      ...[baselineColumn, ...nonBaselineColumns].map((traceData, index) => ({\n        accessorKey: traceData?.uuid,\n        size: 200,\n        enableResizing: true,\n        meta: {\n          traceData,\n          updateBaselineColumnUuid,\n          showChangeFromBaseline: cardConfig.showChangeFromBaseline,\n          isBaseline: traceData === baselineColumn,\n          baselineColumnUuid: baselineColumn?.uuid,\n        },\n        id: traceData?.uuid ?? index.toString(),\n        header: DifferencePlotRunHeaderCell as ColumnDefTemplate<DifferencePlotDataRow>,\n        cell: DifferencePlotDataCell as ColumnDefTemplate<DifferencePlotDataRow>,\n      })),\n    ];\n    return columns;\n  }, [formatMessage, baselineColumn, nonBaselineColumns, updateBaselineColumnUuid, cardConfig.showChangeFromBaseline]);\n\n  // Start with all row groups expanded\n  const [expanded, setExpanded] = useState({\n    modelMetrics: true,\n    systemMetrics: true,\n    parameters: true,\n    attributes: true,\n    tags: true,\n  });\n\n  const table = useReactTable({\n    columns,\n    data: dataRows,\n    getCoreRowModel: getCoreRowModel(),\n    getExpandedRowModel: getExpandedRowModel(),\n    columnResizeMode: 'onChange',\n    enableExpanding: true,\n    getSubRows: (row) => row.children,\n    getRowId: (row) => row.key,\n    getRowCanExpand: (row) => Boolean(row.subRows.length),\n    state: {\n      expanded,\n      columnPinning: {\n        left: [DIFFERENCE_PLOT_EXPAND_COLUMN_ID, DIFFERENCE_PLOT_HEADING_COLUMN_ID],\n      },\n    },\n  });\n\n  const tableContainerRef = useRef<HTMLDivElement>(null);\n\n  const toggleExpand = useCallback((row: Row<DifferencePlotDataRow>) => {\n    const key = row.original.key;\n    setExpanded((prev) => ({\n      ...prev,\n      [key]: !row.getIsExpanded(),\n    }));\n  }, []);\n\n  const { getVirtualItems, getTotalSize } = useVirtualizer({\n    count: table.getExpandedRowModel().rows.length,\n    getScrollElement: () => tableContainerRef.current,\n    estimateSize: () => 33, // Default row height\n    paddingStart: 37, // Default header height,\n  });\n\n  const expandedRows = table.getExpandedRowModel().rows;\n\n  return (\n    <div css={{ flex: 1, overflowX: 'scroll', height: '100%' }} ref={tableContainerRef}>\n      <Table css={{ width: table.getTotalSize(), position: 'relative' }}>\n        <TableRow isHeader css={{ position: 'sticky', top: 0, zIndex: 101 }}>\n          {table.getLeafHeaders().map((header, index) => {\n            const isPinned = header.column.getIsPinned();\n\n            return (\n              <TableHeader\n                header={header}\n                column={header.column}\n                setColumnSizing={table.setColumnSizing}\n                componentId=\"mlflow.charts.difference_plot.header\"\n                key={header.id}\n                multiline={false}\n                style={{\n                  left: isPinned === 'left' ? `${header.column.getStart('left')}px` : undefined,\n                  position: isPinned ? 'sticky' : 'relative',\n                  width: header.column.getSize(),\n                  flexBasis: header.column.getSize(),\n                  zIndex: isPinned ? 100 : 0,\n                }}\n                wrapContent={false}\n              >\n                {flexRender(header.column.columnDef.header, header.getContext())}\n              </TableHeader>\n            );\n          })}\n        </TableRow>\n        <div css={{ height: getTotalSize() }}>\n          {getVirtualItems().map(({ index, start, size }) => {\n            const row = expandedRows[index];\n\n            return (\n              <TableRow\n                key={row.id + index}\n                css={{\n                  width: 'auto',\n                  position: 'absolute',\n                  top: 0,\n                }}\n                style={{\n                  transform: `translateY(${start}px)`,\n                  height: size,\n                }}\n              >\n                {row.getVisibleCells().map((cell, index) => {\n                  const isPinned = cell.column.getIsPinned();\n\n                  const isNameColumn = cell.column.columnDef.id === DIFFERENCE_PLOT_HEADING_COLUMN_ID;\n                  return (\n                    <TableCell\n                      key={cell.id}\n                      style={{\n                        left: isPinned === 'left' ? `${cell.column.getStart('left')}px` : undefined,\n                        position: isPinned ? 'sticky' : 'relative',\n                        width: cell.column.getSize(),\n                        zIndex: isPinned ? 100 : 0,\n                        flexBasis: cell.column.getSize(),\n                      }}\n                      css={[\n                        {\n                          backgroundColor: isPinned ? theme.colors.backgroundPrimary : undefined,\n                        },\n                        isNameColumn && { borderRight: `1px solid ${theme.colors.border}` },\n                        isNameColumn && { paddingLeft: row.depth * theme.spacing.lg },\n                      ]}\n                      wrapContent={false}\n                    >\n                      {flexRender(cell.column.columnDef.cell, { ...cell.getContext(), toggleExpand })}\n                    </TableCell>\n                  );\n                })}\n              </TableRow>\n            );\n          })}\n        </div>\n      </Table>\n    </div>\n  );\n};\n","var _rect, _rect2, _rect3, _rect4, _rect5, _rect6, _rect7, _rect8, _rect9, _rect0, _rect1, _rect10, _rect11, _rect12, _rect13, _rect14, _rect15, _rect16;\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nimport * as React from \"react\";\nfunction SvgChartDifference({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 16,\n    height: 16,\n    viewBox: \"0 0 16 16\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _rect || (_rect = /*#__PURE__*/React.createElement(\"rect\", {\n    y: 2,\n    width: 4,\n    height: 1,\n    fill: \"#338ECC\"\n  })), _rect2 || (_rect2 = /*#__PURE__*/React.createElement(\"rect\", {\n    x: 5,\n    y: 2,\n    width: 4,\n    height: 1,\n    fill: \"#338ECC\"\n  })), _rect3 || (_rect3 = /*#__PURE__*/React.createElement(\"rect\", {\n    x: 10,\n    y: 2,\n    width: 4,\n    height: 1,\n    fill: \"#338ECC\"\n  })), _rect4 || (_rect4 = /*#__PURE__*/React.createElement(\"rect\", {\n    y: 4,\n    width: 4,\n    height: 1,\n    fill: \"#338ECC\"\n  })), _rect5 || (_rect5 = /*#__PURE__*/React.createElement(\"rect\", {\n    x: 5,\n    y: 4,\n    width: 4,\n    height: 1,\n    fill: \"#338ECC\"\n  })), _rect6 || (_rect6 = /*#__PURE__*/React.createElement(\"rect\", {\n    x: 10,\n    y: 4,\n    width: 4,\n    height: 1,\n    fill: \"#338ECC\"\n  })), _rect7 || (_rect7 = /*#__PURE__*/React.createElement(\"rect\", {\n    y: 6,\n    width: 4,\n    height: 1,\n    fill: \"#D9D9D9\"\n  })), _rect8 || (_rect8 = /*#__PURE__*/React.createElement(\"rect\", {\n    x: 5,\n    y: 6,\n    width: 4,\n    height: 1,\n    fill: \"#D9D9D9\"\n  })), _rect9 || (_rect9 = /*#__PURE__*/React.createElement(\"rect\", {\n    x: 10,\n    y: 6,\n    width: 4,\n    height: 1,\n    fill: \"#D9D9D9\"\n  })), _rect0 || (_rect0 = /*#__PURE__*/React.createElement(\"rect\", {\n    y: 8,\n    width: 4,\n    height: 1,\n    fill: \"#D9D9D9\"\n  })), _rect1 || (_rect1 = /*#__PURE__*/React.createElement(\"rect\", {\n    x: 5,\n    y: 8,\n    width: 4,\n    height: 1,\n    fill: \"#D9D9D9\"\n  })), _rect10 || (_rect10 = /*#__PURE__*/React.createElement(\"rect\", {\n    x: 10,\n    y: 8,\n    width: 4,\n    height: 1,\n    fill: \"#D9D9D9\"\n  })), _rect11 || (_rect11 = /*#__PURE__*/React.createElement(\"rect\", {\n    y: 10,\n    width: 4,\n    height: 1,\n    fill: \"#D9D9D9\"\n  })), _rect12 || (_rect12 = /*#__PURE__*/React.createElement(\"rect\", {\n    x: 5,\n    y: 10,\n    width: 4,\n    height: 1,\n    fill: \"#D9D9D9\"\n  })), _rect13 || (_rect13 = /*#__PURE__*/React.createElement(\"rect\", {\n    x: 10,\n    y: 10,\n    width: 4,\n    height: 1,\n    fill: \"#D9D9D9\"\n  })), _rect14 || (_rect14 = /*#__PURE__*/React.createElement(\"rect\", {\n    y: 12,\n    width: 4,\n    height: 1,\n    fill: \"#D9D9D9\"\n  })), _rect15 || (_rect15 = /*#__PURE__*/React.createElement(\"rect\", {\n    x: 5,\n    y: 12,\n    width: 4,\n    height: 1,\n    fill: \"#D9D9D9\"\n  })), _rect16 || (_rect16 = /*#__PURE__*/React.createElement(\"rect\", {\n    x: 10,\n    y: 12,\n    width: 4,\n    height: 1,\n    fill: \"#D9D9D9\"\n  })));\n}\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgChartDifference);\nexport default __webpack_public_path__ + \"static/media/chart-difference.16174216d6f3b7c24f40e3541fe0ca2c.svg\";\nexport { ForwardRef as ReactComponent };","/**\n * NOTE: this code file was automatically migrated to TypeScript using ts-migrate and\n * may contain multiple `any` type annotations and `@ts-expect-error` directives.\n * If possible, please improve types while making changes to this file. If the type\n * annotations are already looking good, please remove this comment.\n */\n\n/**\n * Utils for working with local storage.\n */\n// eslint-disable-next-line @typescript-eslint/no-extraneous-class -- TODO(FEINF-4274)\nexport default class LocalStorageUtils {\n  /**\n   * Protocol version of MLflow's local storage. Should be incremented on any breaking change in how\n   * data persisted in local storage is used, to prevent old (invalid) cached data from being loaded\n   * and breaking the application.\n   */\n  static version = '1.1';\n\n  /**\n   * Return a LocalStorageStore corresponding to the specified component and ID, where the ID\n   * can be used to disambiguate between multiple instances of cached data for the same component\n   * (e.g. cached data for multiple experiments).\n   */\n  static getStoreForComponent(componentName: any, id: any) {\n    return new LocalStorageStore([componentName, id].join('-'), 'localStorage');\n  }\n\n  static getSessionScopedStoreForComponent(componentName: any, id: any) {\n    return new LocalStorageStore([componentName, id].join('-'), 'sessionStorage');\n  }\n}\n\n/**\n * Interface to browser local storage that allows for setting key-value pairs under the specified\n * \"scope\".\n */\nclass LocalStorageStore {\n  constructor(scope: any, type: any) {\n    this.scope = scope;\n    if (type === 'localStorage') {\n      this.storageObj = window.localStorage;\n    } else {\n      this.storageObj = window.sessionStorage;\n    }\n  }\n  static reactComponentStateKey = 'ReactComponentState';\n\n  scope: any;\n  storageObj: any;\n\n  /**\n   * Loads React component state cached in local storage into a vanilla JS object.\n   */\n  loadComponentState() {\n    const storedVal = this.getItem(LocalStorageStore.reactComponentStateKey);\n    if (storedVal) {\n      return JSON.parse(storedVal);\n    }\n    return {};\n  }\n\n  /**\n   * Save React component state in local storage.\n   * @param stateRecord: Immutable.Record instance or plain object containing component state.\n   */\n  saveComponentState(stateRecord: any) {\n    const targetValue = typeof stateRecord.toJSON === 'function' ? stateRecord.toJSON() : stateRecord;\n    this.setItem(LocalStorageStore.reactComponentStateKey, JSON.stringify(targetValue));\n  }\n\n  /**\n   * Helper method for constructing a scoped key to use for setting/getting values in\n   * local storage.\n   */\n  withScopePrefix(key: any) {\n    return ['MLflowLocalStorage', LocalStorageUtils.version, this.scope, key].join('-');\n  }\n\n  /** Save the specified key-value pair in local storage. */\n  setItem(key: any, value: any) {\n    this.storageObj.setItem(this.withScopePrefix(key), value);\n  }\n\n  /** Fetch the value corresponding to the passed-in key from local storage. */\n  getItem(key: any) {\n    return this.storageObj.getItem(this.withScopePrefix(key));\n  }\n}\n","import { Tooltip, useDesignSystemTheme } from '@databricks/design-system';\nimport { RunColorPill } from '@mlflow/mlflow/src/experiment-tracking/components/experiment-page/components/RunColorPill';\nimport type { RunsChartsImageCardConfig, RunsChartsCardConfig } from '../../runs-charts.types';\nimport type { RunsChartsRunData } from '../RunsCharts.common';\nimport { EmptyImageGridPlot, ImagePlotWithHistory } from './ImageGridPlot.common';\nimport type { ImageEntity } from '@mlflow/mlflow/src/experiment-tracking/types';\n\nexport const ImageGridSingleKeyPlot = ({\n  previewData,\n  cardConfig,\n}: {\n  previewData: RunsChartsRunData[];\n  cardConfig: RunsChartsImageCardConfig;\n  groupBy?: string;\n  setCardConfig?: (setter: (current: RunsChartsCardConfig) => RunsChartsImageCardConfig) => void;\n}) => {\n  const { theme } = useDesignSystemTheme();\n\n  const displayRuns = previewData.filter((run: RunsChartsRunData) => {\n    const imageMetadata = run.images[cardConfig.imageKeys[0]];\n    return imageMetadata && Object.keys(imageMetadata).length > 0;\n  });\n\n  if (displayRuns.length === 0) {\n    return <EmptyImageGridPlot />;\n  }\n  return (\n    <div css={{ display: 'flex', justifyContent: 'flex-start', flexWrap: 'wrap', gap: theme.spacing.xs }}>\n      {displayRuns.map((run: RunsChartsRunData) => {\n        // There is exactly one key in this plot\n        const imageMetadataByStep = Object.values(run.images[cardConfig.imageKeys[0]]).reduce(\n          (acc, metadata: ImageEntity) => {\n            if (metadata.step !== undefined) {\n              acc[metadata.step] = metadata;\n            }\n            return acc;\n          },\n          {} as Record<number, ImageEntity>,\n        );\n        return (\n          <div\n            key={run.uuid}\n            css={{\n              border: `1px solid transparent`,\n              borderRadius: theme.borders.borderRadiusSm,\n              padding: theme.spacing.sm,\n              '&:hover': {\n                border: `1px solid ${theme.colors.border}`,\n                backgroundColor: theme.colors.tableBackgroundUnselectedHover,\n              },\n            }}\n          >\n            <Tooltip content={run.displayName} componentId=\"mlflow.charts.image-plot.run-name-tooltip\">\n              <div\n                css={{\n                  height: theme.typography.lineHeightMd,\n                  overflow: 'hidden',\n                  whiteSpace: 'nowrap',\n                  display: 'inline-flex',\n                  alignItems: 'center',\n                  gap: theme.spacing.sm,\n                }}\n              >\n                <RunColorPill color={run.color} />\n                {run.displayName}\n              </div>\n            </Tooltip>\n            <ImagePlotWithHistory\n              key={run.uuid}\n              step={cardConfig.step}\n              metadataByStep={imageMetadataByStep}\n              runUuid={run.uuid}\n            />\n          </div>\n        );\n      })}\n    </div>\n  );\n};\n","import { useDesignSystemTheme, TableRow, TableHeader, TableCell, Table, Tooltip } from '@databricks/design-system';\nimport { RunColorPill } from '@mlflow/mlflow/src/experiment-tracking/components/experiment-page/components/RunColorPill';\nimport { useMemo } from 'react';\nimport type { RunsChartsImageCardConfig, RunsChartsCardConfig } from '../../runs-charts.types';\nimport type { RunsChartsRunData } from '../RunsCharts.common';\nimport { EmptyImageGridPlot, ImagePlotWithHistory, MIN_GRID_IMAGE_SIZE } from './ImageGridPlot.common';\nimport type { ImageEntity } from '@mlflow/mlflow/src/experiment-tracking/types';\nimport { FormattedMessage } from 'react-intl';\n\nexport const ImageGridMultipleKeyPlot = ({\n  previewData,\n  cardConfig,\n}: {\n  previewData: RunsChartsRunData[];\n  cardConfig: RunsChartsImageCardConfig;\n  groupBy?: string;\n  setCardConfig?: (setter: (current: RunsChartsCardConfig) => RunsChartsImageCardConfig) => void;\n}) => {\n  const { theme } = useDesignSystemTheme();\n\n  const displayRuns = previewData.filter((run: RunsChartsRunData) => Object.keys(run.images).length !== 0);\n\n  if (displayRuns.length === 0) {\n    return <EmptyImageGridPlot />;\n  }\n  return (\n    <div css={{ height: '100%', width: '100%' }}>\n      <Table grid scrollable>\n        <TableRow isHeader>\n          <TableHeader\n            componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_charts_imagegridmultiplekeyplot.tsx_44\"\n            css={{ minWidth: MIN_GRID_IMAGE_SIZE + theme.spacing.md }}\n          >\n            <FormattedMessage\n              defaultMessage=\"images\"\n              description=\"Experiment tracking > runs charts > charts > image grid multiple key > table header text\"\n            />\n          </TableHeader>\n          {displayRuns.map((run: RunsChartsRunData) => {\n            return (\n              <TableHeader\n                componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_charts_imagegridmultiplekeyplot.tsx_52\"\n                key={run.uuid}\n                css={{ minWidth: MIN_GRID_IMAGE_SIZE + theme.spacing.md }}\n              >\n                <Tooltip content={run.displayName} componentId=\"mlflow.charts.image-plot.run-name-tooltip\">\n                  <div\n                    css={{\n                      height: theme.typography.lineHeightMd,\n                      whiteSpace: 'nowrap',\n                      display: 'inline-flex',\n                      alignItems: 'center',\n                      margin: 'auto',\n                      gap: theme.spacing.sm,\n                      fontWeight: 'normal',\n                    }}\n                  >\n                    <RunColorPill color={run.color} />\n                    {run.displayName}\n                  </div>\n                </Tooltip>\n              </TableHeader>\n            );\n          })}\n        </TableRow>\n        {cardConfig.imageKeys.map((imageKey) => {\n          return (\n            <TableRow key={imageKey}>\n              <TableCell css={{ minWidth: MIN_GRID_IMAGE_SIZE + theme.spacing.md }}>\n                <div style={{ whiteSpace: 'normal' }}>{imageKey}</div>\n              </TableCell>\n              {displayRuns.map((run: RunsChartsRunData) => {\n                if (run.images[imageKey] && Object.keys(run.images[imageKey]).length > 0) {\n                  const metadataByStep = Object.values(run.images[imageKey]).reduce((acc, metadata) => {\n                    if (metadata.step !== undefined) {\n                      acc[metadata.step] = metadata;\n                    }\n                    return acc;\n                  }, {} as Record<number, ImageEntity>);\n                  return (\n                    <TableCell\n                      key={run.uuid}\n                      css={{\n                        minWidth: MIN_GRID_IMAGE_SIZE + theme.spacing.md,\n                        '&:hover': {\n                          backgroundColor: theme.colors.tableBackgroundUnselectedHover,\n                        },\n                      }}\n                    >\n                      <ImagePlotWithHistory metadataByStep={metadataByStep} step={cardConfig.step} runUuid={run.uuid} />\n                    </TableCell>\n                  );\n                }\n                return <TableCell key={run.uuid} css={{ minWidth: MIN_GRID_IMAGE_SIZE + theme.spacing.md }} />;\n              })}\n            </TableRow>\n          );\n        })}\n      </Table>\n    </div>\n  );\n};\n","import type { RunsChartsImageCardConfig, RunsChartsCardConfig } from '../../runs-charts.types';\nimport type { RunsChartsRunData } from '../RunsCharts.common';\nimport { ImageGridSingleKeyPlot } from './ImageGridSingleKeyPlot';\nimport { ImageGridMultipleKeyPlot } from './ImageGridMultipleKeyPlot';\nimport {\n  LOG_IMAGE_TAG_INDICATOR,\n  NUM_RUNS_TO_SUPPORT_FOR_LOG_IMAGE,\n} from '@mlflow/mlflow/src/experiment-tracking/constants';\nimport type { RunsGroupByConfig } from '@mlflow/mlflow/src/experiment-tracking/components/experiment-page/utils/experimentPage.group-row-utils';\nimport { Empty } from '@databricks/design-system';\nimport { FormattedMessage } from 'react-intl';\n\nexport const ImageGridPlot = ({\n  previewData,\n  cardConfig,\n  groupBy,\n  setCardConfig,\n}: {\n  previewData: RunsChartsRunData[];\n  cardConfig: RunsChartsImageCardConfig;\n  groupBy: RunsGroupByConfig | null;\n  setCardConfig?: (setter: (current: RunsChartsCardConfig) => RunsChartsImageCardConfig) => void;\n}) => {\n  const containsLoggedImages = previewData.some((run: RunsChartsRunData) => Boolean(run.tags[LOG_IMAGE_TAG_INDICATOR]));\n\n  const filteredPreviewData = previewData\n    .filter((run: RunsChartsRunData) => {\n      return run.tags[LOG_IMAGE_TAG_INDICATOR];\n    })\n    .slice(-NUM_RUNS_TO_SUPPORT_FOR_LOG_IMAGE);\n\n  if (!containsLoggedImages) {\n    return (\n      <div css={{ flex: 1, display: 'flex', justifyContent: 'center', alignItems: 'center' }}>\n        <Empty\n          title={\n            <FormattedMessage\n              defaultMessage=\"No images found\"\n              description=\"Title for the empty state when no images are found in the currently visible runs\"\n            />\n          }\n          description={\n            <FormattedMessage\n              defaultMessage=\"No logged images found in the currently visible runs\"\n              description=\"Description for the empty state when no images are found in the currently visible runs\"\n            />\n          }\n        />\n      </div>\n    );\n  }\n\n  if (cardConfig.imageKeys.length === 1) {\n    return <ImageGridSingleKeyPlot previewData={filteredPreviewData} cardConfig={cardConfig} />;\n  } else if (cardConfig.imageKeys.length > 1) {\n    return <ImageGridMultipleKeyPlot previewData={filteredPreviewData} cardConfig={cardConfig} />;\n  }\n  return null;\n};\n","import { Accordion, useDesignSystemTheme } from '@databricks/design-system';\nimport type { CSSObject } from '@emotion/react';\nimport { css } from '@emotion/react';\nimport { useMemo } from 'react';\n\nexport const METRIC_CHART_SECTION_HEADER_SIZE = 55;\n\ninterface MetricChartsAccordionProps {\n  activeKey?: string | string[];\n  onActiveKeyChange?: (key: string | string[]) => void;\n  children: React.ReactNode;\n  disableCollapse?: boolean;\n}\n\nconst MetricChartsAccordion = ({\n  activeKey,\n  onActiveKeyChange,\n  children,\n  disableCollapse = false,\n}: MetricChartsAccordionProps) => {\n  const { theme, getPrefixedClassName } = useDesignSystemTheme();\n  const clsPrefix = getPrefixedClassName('collapse');\n\n  const styles = useMemo(() => {\n    const classItem = `.${clsPrefix}-item`;\n    const classItemActive = `${classItem}-active`;\n    const classHeader = `.${clsPrefix}-header`;\n    const classContent = `.${clsPrefix}-content`;\n    const classContentBox = `.${clsPrefix}-content-box`;\n    const classArrow = `.${clsPrefix}-arrow`;\n\n    const styles: CSSObject = {\n      [classContent]: {\n        padding: '0px !important',\n        backgroundColor: 'transparent !important',\n      },\n\n      [classContentBox]: {\n        padding: '0 0 12px 0px !important',\n        backgroundColor: 'transparent !important',\n      },\n\n      [`& > ${classItem} > ${classHeader} > ${classArrow}`]: {\n        fontSize: theme.general.iconSize,\n        left: 12,\n        // TODO: This is needed currently because the rotated icon isn't centered, remove when accordion is fixed\n        verticalAlign: '-7px',\n        transform: 'rotate(-90deg)',\n        display: disableCollapse ? 'none' : undefined,\n      },\n\n      [`& > ${classItemActive} > ${classHeader} > ${classArrow}`]: {\n        transform: 'rotate(0deg)',\n      },\n\n      [classHeader]: {\n        display: 'flex',\n        color: theme.colors.textPrimary,\n        fontWeight: 600,\n        alignItems: 'center',\n\n        '&:focus-visible': {\n          outlineColor: `${theme.colors.primary} !important`,\n          outlineStyle: 'auto !important',\n        },\n      },\n\n      [`& > ${classItem}`]: {\n        borderBottom: `1px solid ${theme.colors.border}`,\n        borderRadius: 0,\n      },\n\n      [`& > ${classItem} > ${classHeader}`]: {\n        padding: 0,\n        lineHeight: '20px',\n        height: METRIC_CHART_SECTION_HEADER_SIZE,\n      },\n    };\n    return styles;\n  }, [theme, clsPrefix, disableCollapse]);\n\n  return (\n    <Accordion\n      componentId=\"codegen_mlflow_app_src_experiment-tracking_components_metricchartsaccordion.tsx_82\"\n      {...(activeKey ? { activeKey } : {})}\n      {...(onActiveKeyChange ? { onChange: onActiveKeyChange } : {})}\n      dangerouslyAppendEmotionCSS={css(styles)}\n      dangerouslySetAntdProps={{ expandIconPosition: 'left' }}\n    >\n      {children}\n    </Accordion>\n  );\n};\n\nexport default MetricChartsAccordion;\n","import { Button, DropdownMenu, PlusIcon } from '@databricks/design-system';\nimport type { Theme } from '@emotion/react';\n\nimport { ReactComponent as ChartBarIcon } from '../../../../common/static/chart-bar.svg';\nimport { ReactComponent as ChartContourIcon } from '../../../../common/static/chart-contour.svg';\nimport { ReactComponent as ChartLineIcon } from '../../../../common/static/chart-line.svg';\nimport { ReactComponent as ChartParallelIcon } from '../../../../common/static/chart-parallel.svg';\nimport { ReactComponent as ChartScatterIcon } from '../../../../common/static/chart-scatter.svg';\nimport { ReactComponent as ChartDifferenceIcon } from '../../../../common/static/chart-difference.svg';\nimport { ReactComponent as ChartImageIcon } from '../../../../common/static/chart-image.svg';\nimport { RunsChartType } from '../runs-charts.types';\nimport { FormattedMessage } from 'react-intl';\n\nexport interface RunsChartsAddChartMenuProps {\n  onAddChart: (type: RunsChartType) => void;\n  supportedChartTypes?: RunsChartType[];\n}\n\nexport const RunsChartsAddChartMenu = ({ onAddChart, supportedChartTypes }: RunsChartsAddChartMenuProps) => {\n  const isChartTypeSupported = (type: RunsChartType) => !supportedChartTypes || supportedChartTypes.includes(type);\n  return (\n    <DropdownMenu.Root modal={false}>\n      <DropdownMenu.Trigger asChild>\n        <Button\n          componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-compare_runscompareaddchartmenu.tsx_19\"\n          css={styles.addChartButton}\n          icon={<PlusIcon />}\n          data-testid=\"experiment-view-compare-runs-add-chart\"\n        >\n          <FormattedMessage\n            defaultMessage=\"Add chart\"\n            description=\"Experiment tracking > runs charts > add chart menu\"\n          />\n        </Button>\n      </DropdownMenu.Trigger>\n      <DropdownMenu.Content align=\"end\">\n        {isChartTypeSupported(RunsChartType.BAR) && (\n          <DropdownMenu.Item\n            componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_runschartsaddchartmenu.tsx_42\"\n            onClick={() => onAddChart(RunsChartType.BAR)}\n            data-testid=\"experiment-view-compare-runs-chart-type-bar\"\n          >\n            <DropdownMenu.IconWrapper css={styles.iconWrapper}>\n              <ChartBarIcon />\n            </DropdownMenu.IconWrapper>\n            <FormattedMessage\n              defaultMessage=\"Bar chart\"\n              description=\"Experiment tracking > runs charts > add chart menu > bar chart\"\n            />\n          </DropdownMenu.Item>\n        )}\n        {isChartTypeSupported(RunsChartType.LINE) && (\n          <DropdownMenu.Item\n            componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_runschartsaddchartmenu.tsx_56\"\n            onClick={() => onAddChart(RunsChartType.LINE)}\n            data-testid=\"experiment-view-compare-runs-chart-type-line\"\n          >\n            <DropdownMenu.IconWrapper css={styles.iconWrapper}>\n              <ChartLineIcon />\n            </DropdownMenu.IconWrapper>\n            <FormattedMessage\n              defaultMessage=\"Line chart\"\n              description=\"Experiment tracking > runs charts > add chart menu > line chart\"\n            />\n          </DropdownMenu.Item>\n        )}\n        {isChartTypeSupported(RunsChartType.PARALLEL) && (\n          <DropdownMenu.Item\n            componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_runschartsaddchartmenu.tsx_70\"\n            onClick={() => onAddChart(RunsChartType.PARALLEL)}\n            data-testid=\"experiment-view-compare-runs-chart-type-parallel\"\n          >\n            <DropdownMenu.IconWrapper css={styles.iconWrapper}>\n              <ChartParallelIcon />\n            </DropdownMenu.IconWrapper>\n            <FormattedMessage\n              defaultMessage=\"Parallel coordinates\"\n              description=\"Experiment tracking > runs charts > add chart menu > parallel coordinates\"\n            />\n          </DropdownMenu.Item>\n        )}\n        {isChartTypeSupported(RunsChartType.SCATTER) && (\n          <DropdownMenu.Item\n            componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_runschartsaddchartmenu.tsx_84\"\n            onClick={() => onAddChart(RunsChartType.SCATTER)}\n            data-testid=\"experiment-view-compare-runs-chart-type-scatter\"\n          >\n            <DropdownMenu.IconWrapper css={styles.iconWrapper}>\n              <ChartScatterIcon />\n            </DropdownMenu.IconWrapper>\n            <FormattedMessage\n              defaultMessage=\"Scatter chart\"\n              description=\"Experiment tracking > runs charts > add chart menu > scatter plot\"\n            />\n          </DropdownMenu.Item>\n        )}\n        {isChartTypeSupported(RunsChartType.CONTOUR) && (\n          <DropdownMenu.Item\n            componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_runschartsaddchartmenu.tsx_98\"\n            onClick={() => onAddChart(RunsChartType.CONTOUR)}\n            data-testid=\"experiment-view-compare-runs-chart-type-contour\"\n          >\n            <DropdownMenu.IconWrapper css={styles.iconWrapper}>\n              <ChartContourIcon />\n            </DropdownMenu.IconWrapper>\n            <FormattedMessage\n              defaultMessage=\"Contour chart\"\n              description=\"Experiment tracking > runs charts > add chart menu > contour chart\"\n            />\n          </DropdownMenu.Item>\n        )}\n        {isChartTypeSupported(RunsChartType.DIFFERENCE) && (\n          <DropdownMenu.Item\n            componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_runschartsaddchartmenu.tsx_112\"\n            onClick={() => onAddChart(RunsChartType.DIFFERENCE)}\n            data-testid=\"experiment-view-compare-runs-chart-type-difference\"\n          >\n            <DropdownMenu.IconWrapper css={styles.iconWrapper}>\n              <ChartDifferenceIcon />\n            </DropdownMenu.IconWrapper>\n            <FormattedMessage\n              defaultMessage=\"Difference view\"\n              description=\"Experiment tracking > runs charts > add chart menu > difference view\"\n            />\n          </DropdownMenu.Item>\n        )}\n        {isChartTypeSupported(RunsChartType.IMAGE) && (\n          <DropdownMenu.Item\n            componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_runschartsaddchartmenu.tsx_126\"\n            onClick={() => onAddChart(RunsChartType.IMAGE)}\n            data-testid=\"experiment-view-compare-runs-chart-type-image\"\n          >\n            <DropdownMenu.IconWrapper css={styles.iconWrapper}>\n              <ChartImageIcon />\n            </DropdownMenu.IconWrapper>\n            <FormattedMessage\n              defaultMessage=\"Image grid\"\n              description=\"Experiment tracking > runs charts > add chart menu > image grid\"\n            />\n          </DropdownMenu.Item>\n        )}\n      </DropdownMenu.Content>\n    </DropdownMenu.Root>\n  );\n};\n\nconst styles = {\n  addChartButton: (theme: Theme) => ({\n    // Overriden while waiting for design decision in DuBois (FEINF-1711)\n    backgroundColor: `${theme.colors.backgroundPrimary} !important`,\n  }),\n  iconWrapper: (theme: Theme) => ({\n    width: theme.general.iconSize + theme.spacing.xs,\n  }),\n};\n","import {\n  Button,\n  DangerModal,\n  DragIcon,\n  DropdownMenu,\n  Input,\n  Modal,\n  OverflowIcon,\n  PencilIcon,\n  useDesignSystemTheme,\n} from '@databricks/design-system';\nimport type { ChartSectionConfig } from '../../../../types';\nimport { RunsChartsAddChartMenu } from '../RunsChartsAddChartMenu';\nimport type { RunsChartType } from '../../runs-charts.types';\nimport { useEffect, useRef, useState } from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport { useDragAndDropElement } from '@mlflow/mlflow/src/common/hooks/useDragAndDropElement';\nimport { CheckIcon } from '@databricks/design-system';\nimport { METRIC_CHART_SECTION_HEADER_SIZE } from '../../../MetricChartsAccordion';\nimport cx from 'classnames';\n\nexport interface RunsChartsSectionHeaderProps {\n  index: number;\n  section: ChartSectionConfig;\n  sectionChartsLength: number;\n  addNewChartCard: (metricSectionId: string) => (type: RunsChartType) => void;\n  onDeleteSection: (sectionId: string) => void;\n  onAddSection: (sectionId: string, above: boolean) => void;\n  editSection: number;\n  onSetEditSection: React.Dispatch<React.SetStateAction<number>>;\n  onSetSectionName: (sectionId: string, name: string) => void;\n  onSectionReorder: (sourceSectionId: string, targetSectionId: string) => void;\n  isExpanded: boolean;\n  supportedChartTypes?: RunsChartType[] | undefined;\n  /**\n   * Set to \"true\" to hide various controls (e.g. edit, add, delete) in the section header.\n   */\n  hideExtraControls: boolean;\n}\n\nexport const RunsChartsSectionHeader = ({\n  index,\n  section,\n  sectionChartsLength,\n  addNewChartCard,\n  onDeleteSection,\n  onAddSection,\n  editSection,\n  onSetEditSection,\n  onSetSectionName,\n  onSectionReorder,\n  isExpanded,\n  hideExtraControls,\n  supportedChartTypes,\n}: RunsChartsSectionHeaderProps) => {\n  const { theme } = useDesignSystemTheme();\n  // Change name locally for better performance\n  const [tmpSectionName, setTmpSectionName] = useState(section.name);\n  // State to check if element is being dragged\n  const [isDraggingHandle, setIsDraggingHandle] = useState(false);\n\n  // Ref and state to measure the width of the section name\n  const sectionNameRef = useRef<HTMLDivElement>(null);\n  const confirmButtonRef = useRef<HTMLButtonElement>(null);\n  const [sectionNameWidth, setSectionNameWidth] = useState(0.0);\n\n  // Delete section modal\n  const [isDeleteSectionModalOpen, setIsDeleteSectionModalOpen] = useState(false);\n\n  const stopPropagation = (e: any) => {\n    e.stopPropagation();\n  };\n\n  const deleteModalConfirm = () => {\n    onDeleteSection(section.uuid);\n  };\n\n  const deleteModalCancel = () => {\n    setIsDeleteSectionModalOpen(false);\n  };\n\n  const deleteSection = () => {\n    setIsDeleteSectionModalOpen(true);\n  };\n\n  const addSectionAbove = () => {\n    onAddSection(section.uuid, true);\n  };\n\n  const addSectionBelow = () => {\n    onAddSection(section.uuid, false);\n  };\n\n  const onEdit = (e: React.MouseEvent<HTMLElement>) => {\n    e.stopPropagation();\n    onSetEditSection(index);\n  };\n\n  const onChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setTmpSectionName(e.target.value);\n  };\n\n  const onSubmit = (e: React.KeyboardEvent<HTMLInputElement> | React.MouseEvent<HTMLElement>) => {\n    e.stopPropagation();\n    if (!tmpSectionName.trim()) {\n      e.preventDefault();\n      return;\n    }\n    onSetEditSection(-1);\n    onSetSectionName(section.uuid, tmpSectionName);\n  };\n\n  const onEsc = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === 'Escape') {\n      e.stopPropagation();\n      onSetEditSection(-1);\n      setTmpSectionName(section.name);\n    }\n  };\n\n  const onBlur = (e: React.FocusEvent) => {\n    if (e.relatedTarget === confirmButtonRef.current) {\n      return;\n    }\n    onSetEditSection(-1);\n    onSetSectionName(section.uuid, tmpSectionName);\n  };\n\n  useEffect(() => {\n    if (!sectionNameRef.current) {\n      return;\n    }\n\n    const resizeObserver = new ResizeObserver(([entry]) => {\n      setSectionNameWidth(entry.contentRect.width);\n    });\n\n    resizeObserver.observe(sectionNameRef.current);\n\n    return () => resizeObserver.disconnect();\n  }, []);\n\n  // For explicitness:\n  const EDITABLE_LABEL_PADDING_WIDTH = 6;\n  const EDITABLE_LABEL_BORDER_WIDTH = 1;\n  const EDITABLE_LABEL_OFFSET = EDITABLE_LABEL_PADDING_WIDTH + EDITABLE_LABEL_BORDER_WIDTH;\n\n  const isCurrentlyEdited = editSection === index;\n  const [isCurrentlyHovered, setIsCurrentlyHovered] = useState(false);\n\n  const { dragHandleRef, dragPreviewRef, dropTargetRef, isOver, isDragging } = useDragAndDropElement({\n    dragGroupKey: 'sections',\n    dragKey: section.uuid,\n    onDrop: onSectionReorder,\n  });\n\n  return (\n    <>\n      <div\n        role=\"figure\"\n        css={{\n          display: 'flex',\n          alignItems: 'center',\n          width: '100%',\n          padding: `${theme.spacing.xs}px 0px`,\n          height: `${METRIC_CHART_SECTION_HEADER_SIZE}px`,\n          '.section-element-visibility-on-hover': {\n            visibility: isCurrentlyHovered ? 'visible' : 'hidden',\n            opacity: isCurrentlyHovered ? 1 : 0,\n          },\n          '.section-element-visibility-on-hover-and-not-drag': {\n            visibility: isCurrentlyHovered ? 'visible' : 'hidden',\n            opacity: isCurrentlyHovered ? (isDraggingHandle ? 0 : 1) : 0,\n          },\n          '.section-element-hidden-on-edit': { display: isCurrentlyEdited ? 'none' : 'inherit' },\n        }}\n        onMouseMove={() => setIsCurrentlyHovered(true)}\n        onMouseLeave={() => setIsCurrentlyHovered(false)}\n        ref={(element) => {\n          // Use this element for both drag preview and drop target\n          dropTargetRef?.(element);\n          dragPreviewRef?.(element);\n        }}\n        data-testid=\"experiment-view-compare-runs-section-header\"\n      >\n        {isOver && (\n          // Visual overlay for target drop element\n          <div\n            css={{\n              position: 'absolute',\n              inset: 0,\n              backgroundColor: theme.isDarkMode ? theme.colors.blue800 : theme.colors.blue100,\n              border: `2px dashed ${theme.colors.blue400}`,\n              opacity: 0.75,\n            }}\n          />\n        )}\n        <div\n          style={{\n            maxWidth: '40%',\n            display: 'flex',\n            alignItems: 'center',\n          }}\n        >\n          <div\n            ref={sectionNameRef}\n            style={{\n              position: !isCurrentlyEdited ? 'relative' : 'absolute',\n              visibility: !isCurrentlyEdited ? 'visible' : 'hidden',\n              textOverflow: isCurrentlyEdited ? undefined : 'ellipsis',\n              maxWidth: '100%',\n              overflow: 'clip',\n              paddingLeft: EDITABLE_LABEL_OFFSET,\n              whiteSpace: 'pre',\n            }}\n          >\n            {tmpSectionName}\n          </div>\n          {editSection === index && (\n            <Input\n              componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_sections_runschartssectionheader.tsx_220\"\n              autoFocus\n              onClick={stopPropagation}\n              onMouseDown={stopPropagation}\n              onMouseUp={stopPropagation}\n              onDoubleClick={stopPropagation}\n              onChange={onChange}\n              value={tmpSectionName}\n              css={{\n                color: theme.colors.textPrimary,\n                fontWeight: 600,\n                padding: `1px ${EDITABLE_LABEL_PADDING_WIDTH}px 1px ${EDITABLE_LABEL_PADDING_WIDTH}px`,\n                background: theme.colors.backgroundSecondary,\n                minWidth: '50px',\n                width: sectionNameWidth + 2 * EDITABLE_LABEL_OFFSET,\n                position: 'relative',\n                lineHeight: theme.typography.lineHeightBase,\n                maxWidth: '100%',\n              }}\n              onKeyDown={onEsc}\n              onPressEnter={onSubmit}\n              dangerouslyAppendEmotionCSS={{ '&&': { minHeight: '20px !important' } }}\n              onBlur={onBlur}\n            />\n          )}\n          <div\n            css={{\n              padding: theme.spacing.xs,\n              position: 'relative',\n            }}\n            style={{\n              visibility: !isCurrentlyEdited ? 'visible' : 'hidden',\n              display: isCurrentlyEdited ? 'none' : 'inherit',\n            }}\n          >\n            {`(${sectionChartsLength})`}\n          </div>\n          {!hideExtraControls && (\n            <div className=\"section-element-visibility-on-hover-and-not-drag section-element-hidden-on-edit\">\n              <Button\n                componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-compare_sections_runscomparesectionheader.tsx_246\"\n                onClick={onEdit}\n                aria-label=\"Icon label\"\n                icon={<PencilIcon />}\n              />\n            </div>\n          )}\n        </div>\n        {editSection === index && !hideExtraControls && (\n          <div style={{ padding: `0 ${theme.spacing.xs}px` }}>\n            <Button\n              componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-compare_sections_runscomparesectionheader.tsx_251\"\n              onClick={onSubmit}\n              icon={<CheckIcon />}\n              ref={confirmButtonRef}\n            />\n          </div>\n        )}\n        {!hideExtraControls && (\n          <div\n            className=\"section-element-visibility-on-hover section-element-hidden-on-edit\"\n            css={{ position: 'absolute', top: '50%', left: '50%', transform: 'translate(-50%, -50%)', cursor: 'grab' }}\n          >\n            <DragIcon\n              rotate={90}\n              style={{ color: theme.colors.textSecondary }}\n              ref={dragHandleRef}\n              onMouseDown={() => setIsDraggingHandle(true)}\n              onMouseLeave={() => {\n                setIsDraggingHandle(false);\n              }}\n              data-testid=\"experiment-view-compare-runs-section-header-drag-handle\"\n            />\n          </div>\n        )}\n        {!hideExtraControls && (\n          <div\n            style={{\n              position: 'absolute',\n              top: '50%',\n              right: '0',\n              transform: 'translate(0, -50%)',\n              display: 'flex',\n              alignItems: 'center',\n            }}\n          >\n            <div\n              onClick={stopPropagation}\n              onMouseDown={stopPropagation}\n              onMouseUp={stopPropagation}\n              onDoubleClick={stopPropagation}\n              className=\"section-element-visibility-on-hover-and-not-drag section-element-hidden-on-edit\"\n            >\n              <DropdownMenu.Root modal={false}>\n                <DropdownMenu.Trigger asChild>\n                  <Button\n                    componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-compare_sections_runscomparesectionheader.tsx_288\"\n                    icon={<OverflowIcon />}\n                  />\n                </DropdownMenu.Trigger>\n                <DropdownMenu.Content>\n                  <DropdownMenu.Item\n                    componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_sections_runschartssectionheader.tsx_321\"\n                    onClick={addSectionAbove}\n                  >\n                    <FormattedMessage\n                      defaultMessage=\"Add section above\"\n                      description=\"Experiment page > compare runs > chart section > add section above label\"\n                    />\n                  </DropdownMenu.Item>\n                  <DropdownMenu.Item\n                    componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_sections_runschartssectionheader.tsx_327\"\n                    onClick={addSectionBelow}\n                  >\n                    <FormattedMessage\n                      defaultMessage=\"Add section below\"\n                      description=\"Experiment page > compare runs > chart section > add section below label\"\n                    />\n                  </DropdownMenu.Item>\n                  <DropdownMenu.Item\n                    componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_sections_runschartssectionheader.tsx_333\"\n                    onClick={deleteSection}\n                  >\n                    <FormattedMessage\n                      defaultMessage=\"Delete section\"\n                      description=\"Experiment page > compare runs > chart section > delete section label\"\n                    />\n                  </DropdownMenu.Item>\n                </DropdownMenu.Content>\n              </DropdownMenu.Root>\n              <DangerModal\n                componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_sections_runschartssectionheader.tsx_351\"\n                visible={isDeleteSectionModalOpen}\n                onOk={deleteModalConfirm}\n                onCancel={deleteModalCancel}\n                title=\"Delete section\"\n              >\n                <FormattedMessage\n                  defaultMessage=\"Deleting the section will permanently remove it and the charts it contains. This cannot be undone.\"\n                  description=\"Experiment page > compare runs > chart section > delete section warning message\"\n                />\n              </DangerModal>\n            </div>\n\n            <div\n              onClick={stopPropagation}\n              onMouseDown={stopPropagation}\n              onMouseUp={stopPropagation}\n              onDoubleClick={stopPropagation}\n              className={cx(\n                {\n                  'section-element-visibility-on-hover-and-not-drag': !isExpanded,\n                },\n                'section-element-hidden-on-edit',\n              )}\n              css={{\n                alignSelf: 'flex-end',\n                marginLeft: theme.spacing.xs,\n              }}\n            >\n              <RunsChartsAddChartMenu\n                onAddChart={addNewChartCard(section.uuid)}\n                supportedChartTypes={supportedChartTypes}\n              />\n            </div>\n          </div>\n        )}\n      </div>\n    </>\n  );\n};\n","import { useEffect, useRef, useState } from 'react';\n\n// Define a module-global observer and a WeakMap on elements to hold callbacks\nlet sharedObserver: IntersectionObserver | null = null;\nconst entryCallbackMap = new WeakMap();\n\nconst ensureSharedObserverExists = () => {\n  if (!sharedObserver) {\n    sharedObserver = new IntersectionObserver((entries) => {\n      for (const entry of entries) {\n        const entryCallback = entryCallbackMap.get(entry.target);\n        entryCallback?.(entry.isIntersecting);\n      }\n    });\n  }\n};\n\nfunction observeElement(element: Element, callback: (isIntersecting: boolean) => void) {\n  ensureSharedObserverExists();\n  entryCallbackMap.set(element, callback);\n  sharedObserver?.observe(element);\n\n  return () => {\n    if (element) {\n      sharedObserver?.unobserve(element);\n      entryCallbackMap.delete(element);\n    }\n  };\n}\n\n/**\n * Checks if the element is currently visible within the viewport using IntersectionObserver.\n * If \"enabled\" is set to false, the returned value will always be true.\n */\nexport const useIsInViewport = <T extends Element>({ enabled = true }: { enabled?: boolean } = {}) => {\n  const [element, setElementRef] = useState<T | null>(null);\n  const [isInViewport, setIsInViewport] = useState(!enabled);\n\n  useEffect(() => {\n    // If already viewed or element is not available, do nothing\n    if (!element) {\n      return;\n    }\n\n    // If IntersectionObserver is not available, assume that the element is visible\n    if (!window.IntersectionObserver || !enabled) {\n      setIsInViewport(true);\n      return;\n    }\n\n    return observeElement(element, setIsInViewport);\n  }, [enabled, element]);\n\n  // When the flag is disabled, deferred result is the same as the regular one\n  return { isInViewport, setElementRef };\n};\n","import { forwardRef, memo, useCallback, useRef, useState } from 'react';\nimport { RunsChartsCard, type RunsChartsCardProps } from './cards/RunsChartsCard';\nimport { DraggableCore, type DraggableEventHandler } from 'react-draggable';\nimport { Resizable } from 'react-resizable';\nimport { Spinner, useDesignSystemTheme } from '@databricks/design-system';\nimport { useIsInViewport } from '../hooks/useIsInViewport';\nimport { useDebounce } from 'use-debounce';\nimport {\n  DRAGGABLE_CARD_HANDLE_CLASS,\n  DRAGGABLE_CARD_TRANSITION_VAR,\n  RunsChartCardLoadingPlaceholder,\n} from './cards/ChartCard.common';\nimport { useRunsChartsDraggableGridActionsContext } from './RunsChartsDraggableCardsGridContext';\nimport { RUNS_CHARTS_UI_Z_INDEX } from '../utils/runsCharts.const';\n\nconst VIEWPORT_DEBOUNCE_MS = 150;\n\ninterface RunsChartsDraggableCardProps extends RunsChartsCardProps {\n  uuid?: string;\n  translateBy?: { x: number; y: number; overflowing: boolean };\n  onResizeStart: (rect: DOMRect) => void;\n  onResize: (width: number, height: number) => void;\n  onResizeStop: () => void;\n}\n\nexport const RunsChartsDraggableCard = memo((props: RunsChartsDraggableCardProps) => {\n  const { setElementRef, isInViewport } = useIsInViewport<HTMLDivElement>();\n  const { uuid, translateBy, onResizeStart, onResize, onResizeStop, ...cardProps } = props;\n  const { theme } = useDesignSystemTheme();\n\n  const [deferredValue] = useDebounce(isInViewport, VIEWPORT_DEBOUNCE_MS);\n  const isInViewportDeferred = deferredValue;\n\n  const [resizeWidth, setResizeWidth] = useState(0);\n  const [resizeHeight, setResizeHeight] = useState(0);\n  const [isDragging, setIsDragging] = useState(false);\n  const [origin, setOrigin] = useState<{ x: number; y: number }>({ x: 0, y: 0 });\n\n  const { setDraggedCardUuid, onDropChartCard } = useRunsChartsDraggableGridActionsContext();\n\n  const draggedCardElementRef = useRef<HTMLDivElement | null>(null);\n\n  const onStartDrag = useCallback<DraggableEventHandler>(\n    (_, { x, y }) => {\n      setIsDragging(true);\n      setDraggedCardUuid(uuid ?? null);\n      setOrigin({ x, y });\n    },\n    [setDraggedCardUuid, uuid],\n  );\n\n  const onDrag = useCallback(\n    (_, { x, y }) => {\n      if (draggedCardElementRef.current) {\n        draggedCardElementRef.current.style.transform = `translate3d(${x - origin.x}px, ${y - origin.y}px, 0)`;\n      }\n    },\n    [origin],\n  );\n\n  const onStopDrag = useCallback(() => {\n    onDropChartCard();\n    setDraggedCardUuid(null);\n    if (draggedCardElementRef.current) {\n      draggedCardElementRef.current.style.transform = '';\n    }\n    setIsDragging(false);\n  }, [onDropChartCard, setDraggedCardUuid, draggedCardElementRef]);\n\n  const onResizeStartInternal = useCallback(() => {\n    const rect = draggedCardElementRef.current?.getBoundingClientRect();\n    if (rect) {\n      setResizeWidth(rect?.width ?? 0);\n      setResizeHeight(rect?.height ?? 0);\n      onResizeStart?.(rect);\n    }\n  }, [onResizeStart, draggedCardElementRef]);\n\n  const onResizeInternal = useCallback(\n    (_, { size }) => {\n      setResizeWidth(size.width);\n      setResizeHeight(size.height);\n      onResize(size.width, size.height);\n    },\n    [onResize],\n  );\n\n  if (!isInViewport) {\n    // If the card is not in the viewport, we avoid rendering draggable/resizable components\n    // and render a placeholder element having card's height instead.\n    return (\n      <RunsChartCardLoadingPlaceholder\n        style={{\n          height: props.height,\n        }}\n        css={{\n          backgroundColor: theme.colors.backgroundPrimary,\n          border: `1px solid ${theme.colors.border}`,\n          borderRadius: theme.general.borderRadiusBase,\n        }}\n        ref={setElementRef}\n      />\n    );\n  }\n\n  return (\n    <DraggableCore\n      enableUserSelectHack={false}\n      onStart={onStartDrag}\n      onDrag={onDrag}\n      onStop={onStopDrag}\n      handle={`.${DRAGGABLE_CARD_HANDLE_CLASS}`}\n    >\n      <Resizable\n        width={resizeWidth}\n        height={resizeHeight}\n        axis=\"both\"\n        onResizeStart={onResizeStartInternal}\n        onResizeStop={onResizeStop}\n        onResize={onResizeInternal}\n        handle={<ResizableHandle />}\n      >\n        <div\n          ref={(element) => {\n            draggedCardElementRef.current = element;\n            setElementRef(element);\n          }}\n          style={\n            isDragging\n              ? {\n                  // Make sure the dragged card is on top of all other cards\n                  zIndex: RUNS_CHARTS_UI_Z_INDEX.CARD_DRAGGED,\n                  pointerEvents: 'none',\n                }\n              : {\n                  transition: DRAGGABLE_CARD_TRANSITION_VAR,\n                  transform: `translate3d(${translateBy?.x ?? 0}px,${translateBy?.y ?? 0}px,0)`,\n                  opacity: translateBy?.overflowing ? 0 : 1,\n                }\n          }\n        >\n          <RunsChartsCard {...cardProps} isInViewport={isInViewport} isInViewportDeferred={isInViewportDeferred} />\n        </div>\n      </Resizable>\n    </DraggableCore>\n  );\n});\n\nconst ResizableHandle = forwardRef((props, ref) => {\n  const { theme } = useDesignSystemTheme();\n  return (\n    <div\n      ref={ref as any}\n      {...props}\n      data-testid=\"draggable-card-resize-handle\"\n      css={{\n        position: 'absolute',\n        bottom: 0,\n        right: 0,\n        cursor: 'se-resize',\n        lineHeight: 0,\n        padding: theme.spacing.xs,\n        color: theme.colors.actionDefaultIconDefault,\n      }}\n    >\n      <svg width=\"8\" height=\"8\" viewBox=\"0 0 8 8\">\n        <path d=\"M6 6V0H8V8H0V6H6Z\" fill=\"currentColor\" />\n      </svg>\n    </div>\n  );\n});\n","import { useDesignSystemTheme } from '@databricks/design-system';\nimport { RUNS_CHARTS_UI_Z_INDEX } from '../utils/runsCharts.const';\n\nexport const RunsChartsDraggablePreview = ({\n  x,\n  y,\n  width,\n  height,\n}: {\n  x?: number;\n  y?: number;\n  width?: number | string;\n  height?: number | string;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  return (\n    <>\n      {/* Cover pointer events */}\n      <div\n        css={{\n          position: 'absolute',\n          inset: 0,\n        }}\n      />\n      <div\n        css={{\n          position: 'absolute',\n          backgroundColor: theme.colors.actionDefaultBackgroundHover,\n          borderStyle: 'dashed',\n          borderColor: theme.colors.actionDefaultBorderDefault,\n          pointerEvents: 'none',\n          borderRadius: theme.general.borderRadiusBase,\n          borderWidth: 2,\n          inset: 0,\n          // Make sure the preview is above other cards\n          zIndex: RUNS_CHARTS_UI_Z_INDEX.CARD_PREVIEW,\n        }}\n        style={{\n          transform: `translate3d(${x}px, ${y}px, 0)`,\n          width: width,\n          height: height,\n        }}\n      />\n    </>\n  );\n};\n","import { Empty, useDesignSystemTheme } from '@databricks/design-system';\nimport { memo, useCallback, useMemo, useRef, useState } from 'react';\nimport { useUpdateRunsChartsUIConfiguration } from '../hooks/useRunsChartsUIConfiguration';\nimport type { RunsChartsCardConfig } from '../runs-charts.types';\nimport type { RunsChartsRunData } from './RunsCharts.common';\nimport { isEmptyChartCard } from './RunsCharts.common';\nimport { useMediaQuery } from '@databricks/web-shared/hooks';\nimport { Global } from '@emotion/react';\nimport { FormattedMessage } from 'react-intl';\nimport type { ChartSectionConfig } from '../../../types';\nimport { RunsChartsDraggableCard } from './RunsChartsDraggableCard';\nimport {\n  useRunsChartsDraggableGridActionsContext,\n  useRunsChartsDraggableGridStateContext,\n} from './RunsChartsDraggableCardsGridContext';\nimport { RunsChartsDraggablePreview } from './RunsChartsDraggablePreview';\nimport { DRAGGABLE_CARD_TRANSITION_NAME, type RunsChartCardSetFullscreenFn } from './cards/ChartCard.common';\nimport type { RunsGroupByConfig } from '../../experiment-page/utils/experimentPage.group-row-utils';\nimport type { RunsChartsGlobalLineChartConfig } from '../../experiment-page/models/ExperimentPageUIState';\n\nconst rowHeightSuggestions = [300, 330, 360, 400, 500];\n\nconst getColumnSuggestions = (containerWidth: number, gapSize = 8) =>\n  [1, 2, 3, 4, 5].map((n) => ({\n    cols: n,\n    width: (containerWidth - (n - 1) * gapSize) / n,\n  }));\n\nconst PlaceholderSymbol = Symbol('placeholder');\n\ninterface RunsChartsDraggableCardsGridProps {\n  onRemoveChart: (chart: RunsChartsCardConfig) => void;\n  onStartEditChart: (chart: RunsChartsCardConfig) => void;\n  sectionConfig: ChartSectionConfig;\n  setFullScreenChart: RunsChartCardSetFullscreenFn;\n  sectionId: string;\n  groupBy: RunsGroupByConfig | null;\n  autoRefreshEnabled?: boolean;\n  hideEmptyCharts?: boolean;\n  globalLineChartConfig?: RunsChartsGlobalLineChartConfig;\n  chartRunData: RunsChartsRunData[];\n  cardsConfig: RunsChartsCardConfig[];\n}\n\n// Renders draggable cards grid in a single chart section\nexport const RunsChartsDraggableCardsGridSection = memo(\n  ({\n    cardsConfig,\n    sectionConfig,\n    chartRunData,\n    sectionId,\n    hideEmptyCharts,\n    ...cardProps\n  }: RunsChartsDraggableCardsGridProps) => {\n    const { theme } = useDesignSystemTheme();\n\n    // If below medium breakpoint, display only 1 card per row.\n    // Otherwise, use section configuration or fall back to 3 columns.\n    const isCompactMode = useMediaQuery(`(max-width: ${theme.responsive.breakpoints.md}px)`);\n    const columns = isCompactMode ? 1 : sectionConfig.columns ?? 3;\n\n    // Use card height from the section configuration or fall back to 360 pixels.\n    const cardHeight = sectionConfig.cardHeight ?? 360;\n\n    const gridBoxRef = useRef<HTMLDivElement | null>(null);\n\n    const { draggedCardUuid, isDragging } = useRunsChartsDraggableGridStateContext();\n    const { setTargetSection, setTargetPosition, onSwapCards } = useRunsChartsDraggableGridActionsContext();\n\n    const updateUIState = useUpdateRunsChartsUIConfiguration();\n\n    const setColumns = useCallback(\n      (columnCount: number) => {\n        updateUIState((current) => {\n          const section = current.compareRunSections?.find((section) => section.uuid === sectionId);\n          if (!section) {\n            return current;\n          }\n\n          return {\n            ...current,\n            compareRunSections: current.compareRunSections?.map((s) => {\n              if (s.uuid === sectionId) {\n                return {\n                  ...s,\n                  columns: columnCount,\n                };\n              }\n              return s;\n            }),\n          };\n        });\n      },\n      [sectionId, updateUIState],\n    );\n\n    const setCardHeight = useCallback(\n      (height: number) => {\n        updateUIState((current) => {\n          const section = current.compareRunSections?.find((section) => section.uuid === sectionId);\n          if (!section) {\n            return current;\n          }\n\n          return {\n            ...current,\n            compareRunSections: current.compareRunSections?.map((s) => {\n              if (s.uuid === sectionId) {\n                return {\n                  ...s,\n                  cardHeight: height,\n                };\n              }\n              return s;\n            }),\n          };\n        });\n      },\n      [sectionId, updateUIState],\n    );\n\n    const lastElementCount = useRef<number>(0);\n\n    const [positionInSection, setPositionInSection] = useState<number | null>(null);\n    const [resizePreview, setResizePreview] = useState<null | Partial<DOMRect>>(null);\n\n    lastElementCount.current = cardsConfig.length;\n    const position = !draggedCardUuid ? null : positionInSection;\n\n    // Helper function that calculates the x, y coordinates of a card based on its position in the grid\n    const findCoords = useCallback(\n      (position) => {\n        const gap = theme.spacing.sm;\n        const rowCount = Math.ceil(cardsConfig.length / columns);\n\n        const row = Math.floor(position / columns);\n        const col = position % columns;\n\n        const colGapsCount = columns - 1;\n\n        const passedColGaps = col;\n        const passedRowGaps = row;\n        const rect = gridBoxRef.current?.getBoundingClientRect();\n\n        const singleWidth = ((rect?.width ?? 0) - colGapsCount * gap) / columns;\n\n        const overflowing = row >= rowCount;\n\n        return {\n          overflowing,\n          row,\n          col,\n          x: col * singleWidth + passedColGaps * gap,\n          y: row * cardHeight + passedRowGaps * gap,\n        };\n      },\n      [columns, cardHeight, theme, cardsConfig.length],\n    );\n\n    const cardsToRender = useMemo(() => {\n      return cardsConfig.filter((cardConfig) => {\n        if (!hideEmptyCharts) {\n          return true;\n        }\n        return !isEmptyChartCard(chartRunData, cardConfig);\n      });\n    }, [cardsConfig, chartRunData, hideEmptyCharts]);\n\n    // Calculate the transforms for each card based on the dragged card and its position.\n    const cardTransforms = useMemo(() => {\n      if (!draggedCardUuid || position === null) {\n        return {};\n      }\n\n      const result: Record<string, { x: number; y: number; overflowing: boolean }> = {};\n\n      const newArray: (RunsChartsCardConfig | typeof PlaceholderSymbol)[] = cardsToRender.slice();\n      const fromIndex = cardsToRender.findIndex((x) => x.uuid === draggedCardUuid);\n      const toIndex = position;\n\n      if (fromIndex !== -1) {\n        // If the card is dragged within same section, just rearrange the cards\n        newArray.splice(fromIndex, 1);\n        newArray.splice(toIndex, 0, cardsToRender[fromIndex]);\n      } else {\n        // If the card is dragged from another section, insert empty placeholder element\n        newArray.splice(toIndex, 0, PlaceholderSymbol);\n      }\n\n      for (const cardConfig of cardsToRender) {\n        const newIndex = newArray.indexOf(cardConfig);\n        const oldIndex = cardsToRender.indexOf(cardConfig);\n\n        const oldCoords = findCoords(oldIndex);\n        const newCoords = findCoords(newIndex);\n\n        // If the card is not moving, skip it\n        if (newCoords.x === oldCoords.x && newCoords.y === oldCoords.y) {\n          continue;\n        }\n\n        // Calculate the delta between the old and new positions\n        const deltaX = newCoords.x - oldCoords.x;\n        const deltaY = newCoords.y - oldCoords.y;\n\n        if (cardConfig.uuid) {\n          result[cardConfig.uuid] = {\n            x: deltaX,\n            y: deltaY,\n            overflowing: newCoords.overflowing,\n          };\n        }\n      }\n\n      return result;\n    }, [draggedCardUuid, position, cardsToRender, findCoords]);\n\n    // Calculate the preview (placeholder) for the dragged card based on its new position\n    const dragPreview = useMemo(() => {\n      if (position === null) {\n        return null;\n      }\n      if (cardsToRender.length === 0) {\n        return { x: 0, y: 0, width: '100%', height: '100%' };\n      }\n      const { x, y } = findCoords(position);\n      const colGapsCount = columns - 1;\n      const rect = gridBoxRef.current?.getBoundingClientRect();\n\n      const singleWidth = ((rect?.width ?? 0) - colGapsCount * theme.spacing.sm) / columns;\n\n      const height = cardHeight;\n      return { x, y, width: singleWidth, height };\n    }, [position, findCoords, columns, cardHeight, theme, cardsToRender.length]);\n\n    const mouseMove = useCallback(\n      (e: React.MouseEvent) => {\n        if (!isDragging() || !gridBoxRef.current) {\n          return;\n        }\n\n        const rect = gridBoxRef.current.getBoundingClientRect();\n        const rowCount = Math.ceil(lastElementCount.current / columns);\n\n        setTargetSection(sectionId);\n        const pos =\n          Math.floor(((e.clientY - rect.top) / rect.height) * rowCount) * columns +\n          Math.floor(((e.clientX - rect.left) / rect.width) * columns);\n\n        setPositionInSection(pos);\n        setTargetPosition(pos);\n      },\n\n      [columns, isDragging, sectionId, setTargetSection, setTargetPosition],\n    );\n\n    const [columnSuggestions, setColumnSuggestions] = useState<{ cols: number; width: number }[]>([]);\n\n    const immediateColSuggestion = useRef<number | null>(null);\n    const immediateRowSuggestion = useRef<number | null>(null);\n\n    const onResizeStart = useCallback((rect: DOMRect) => {\n      const gridBoxRefSize = gridBoxRef.current?.getBoundingClientRect();\n      if (!gridBoxRefSize) {\n        return;\n      }\n\n      setResizePreview({\n        x: rect.left - gridBoxRefSize.left,\n        y: rect.top - gridBoxRefSize.top,\n        width: rect.width,\n        height: rect.height,\n      });\n\n      setColumnSuggestions(getColumnSuggestions(gridBoxRefSize.width));\n    }, []);\n\n    const onResizeStop = useCallback(() => {\n      setColumns(immediateColSuggestion.current ?? columns);\n      setCardHeight(immediateRowSuggestion.current ?? cardHeight);\n      setResizePreview(null);\n    }, [cardHeight, columns, setCardHeight, setColumns]);\n\n    const onResize = useCallback(\n      (width: number, height: number) => {\n        const columnSuggestion = columnSuggestions.reduce((prev, curr) =>\n          Math.abs(curr.width - width) < Math.abs(prev.width - width) ? curr : prev,\n        );\n\n        const rowHeightSuggestion = rowHeightSuggestions.reduce((prev, curr) =>\n          Math.abs(curr - height) < Math.abs(prev - height) ? curr : prev,\n        );\n\n        immediateColSuggestion.current = columnSuggestion.cols;\n        immediateRowSuggestion.current = rowHeightSuggestion;\n\n        setResizePreview((current) => {\n          if (!current) {\n            return null;\n          }\n          if (current.width !== columnSuggestion.width || current.height !== rowHeightSuggestion) {\n            return { ...current, width: columnSuggestion.width, height: rowHeightSuggestion };\n          }\n          return current;\n        });\n      },\n      [columnSuggestions],\n    );\n\n    return (\n      <div\n        ref={gridBoxRef}\n        css={[\n          { position: 'relative' },\n          cardsToRender.length > 0 && {\n            display: 'grid',\n            gap: theme.spacing.sm,\n          },\n        ]}\n        style={{\n          gridTemplateColumns: 'repeat(' + columns + ', 1fr)',\n          ...(draggedCardUuid && {\n            [DRAGGABLE_CARD_TRANSITION_NAME]: 'transform 0.1s',\n          }),\n        }}\n        data-testid=\"draggable-chart-cards-grid\"\n        onMouseMove={mouseMove}\n        onMouseLeave={() => {\n          setPositionInSection(null);\n        }}\n      >\n        {(draggedCardUuid || resizePreview) && (\n          <Global\n            styles={{\n              'body, :host': {\n                userSelect: 'none',\n              },\n            }}\n          />\n        )}\n        {cardsToRender.length === 0 && (\n          <div css={{ display: 'flex', justifyContent: 'center', minHeight: 160 }}>\n            <Empty\n              title={\n                <FormattedMessage\n                  defaultMessage=\"No charts in this section\"\n                  description=\"Runs compare page > Charts tab > No charts placeholder title\"\n                />\n              }\n              description={\n                <FormattedMessage\n                  defaultMessage=\"Click 'Add chart' or drag and drop to add charts here.\"\n                  description=\"Runs compare page > Charts tab > No charts placeholder description\"\n                />\n              }\n            />\n          </div>\n        )}\n        {cardsToRender.map((cardConfig, index, array) => {\n          return (\n            <RunsChartsDraggableCard\n              key={cardConfig.uuid}\n              uuid={cardConfig.uuid ?? ''}\n              translateBy={cardTransforms[cardConfig.uuid ?? '']}\n              onResizeStart={onResizeStart}\n              onResizeStop={onResizeStop}\n              onResize={onResize}\n              cardConfig={cardConfig}\n              chartRunData={chartRunData}\n              onReorderWith={onSwapCards}\n              index={index}\n              height={cardHeight}\n              canMoveDown={Boolean(array[index + 1])}\n              canMoveUp={Boolean(array[index - 1])}\n              previousChartUuid={array[index - 1]?.uuid}\n              nextChartUuid={array[index + 1]?.uuid}\n              hideEmptyCharts={hideEmptyCharts}\n              {...cardProps}\n            />\n          );\n        })}\n        {dragPreview && <RunsChartsDraggablePreview {...dragPreview} />}\n        {resizePreview && <RunsChartsDraggablePreview {...resizePreview} />}\n      </div>\n    );\n  },\n);\n","import type { RunsGroupByConfig } from '../../../experiment-page/utils/experimentPage.group-row-utils';\nimport type { RunsChartsCardConfig } from '../../runs-charts.types';\nimport type { RunsChartsRunData } from '../RunsCharts.common';\nimport type { RunsChartCardSetFullscreenFn } from '../cards/ChartCard.common';\nimport type { RunsChartsGlobalLineChartConfig } from '../../../experiment-page/models/ExperimentPageUIState';\nimport type { ChartSectionConfig } from '../../../../types';\nimport { RunsChartsDraggableCardsGridSection } from '../RunsChartsDraggableCardsGridSection';\n\nexport interface RunsChartsSectionProps {\n  sectionId: string;\n  sectionConfig: ChartSectionConfig;\n  sectionCharts: RunsChartsCardConfig[];\n  reorderCharts: (sourceChartUuid: string, targetChartUuid: string) => void;\n  insertCharts: (sourceChartUuid: string, targetSectionId: string) => void;\n  isMetricHistoryLoading: boolean;\n  chartData: RunsChartsRunData[];\n  startEditChart: (chartCard: RunsChartsCardConfig) => void;\n  removeChart: (configToDelete: RunsChartsCardConfig) => void;\n  groupBy: RunsGroupByConfig | null;\n  sectionIndex: number;\n  setFullScreenChart: RunsChartCardSetFullscreenFn;\n  autoRefreshEnabled?: boolean;\n  hideEmptyCharts?: boolean;\n  globalLineChartConfig?: RunsChartsGlobalLineChartConfig;\n}\n\nexport const RunsChartsSection = ({\n  sectionId,\n  sectionCharts,\n  reorderCharts,\n  insertCharts,\n  isMetricHistoryLoading,\n  chartData,\n  startEditChart,\n  removeChart,\n  groupBy,\n  sectionIndex,\n  setFullScreenChart,\n  autoRefreshEnabled,\n  hideEmptyCharts,\n  globalLineChartConfig,\n  sectionConfig,\n}: RunsChartsSectionProps) => {\n  return (\n    <RunsChartsDraggableCardsGridSection\n      sectionConfig={sectionConfig}\n      cardsConfig={sectionCharts}\n      chartRunData={chartData}\n      onStartEditChart={startEditChart}\n      onRemoveChart={removeChart}\n      setFullScreenChart={setFullScreenChart}\n      sectionId={sectionId}\n      groupBy={groupBy}\n      autoRefreshEnabled={autoRefreshEnabled}\n      hideEmptyCharts={hideEmptyCharts}\n      globalLineChartConfig={globalLineChartConfig}\n    />\n  );\n};\n","import { Accordion } from '@databricks/design-system';\nimport type { ChartSectionConfig } from '../../../../types';\nimport type { RunsChartsRunData } from '../RunsCharts.common';\nimport type {\n  RunsChartsBarCardConfig,\n  RunsChartsCardConfig,\n  RunsChartsLineCardConfig,\n  RunsChartsScatterCardConfig,\n  RunsChartsContourCardConfig,\n  SerializedRunsChartsCardConfigCard,\n  RunsChartsParallelCardConfig,\n} from '../../runs-charts.types';\nimport { RunsChartType } from '../../runs-charts.types';\nimport MetricChartsAccordion, { METRIC_CHART_SECTION_HEADER_SIZE } from '../../../MetricChartsAccordion';\nimport { RunsChartsSectionHeader } from './RunsChartsSectionHeader';\nimport { RunsChartsSection } from './RunsChartsSection';\nimport { useCallback, useMemo } from 'react';\nimport { getUUID } from '@mlflow/mlflow/src/common/utils/ActionUtils';\nimport { useState } from 'react';\nimport { Button, PlusIcon } from '@databricks/design-system';\nimport { FormattedMessage } from 'react-intl';\nimport { Empty } from '@databricks/design-system';\nimport { useDesignSystemTheme } from '@databricks/design-system';\nimport { Spacer } from '@databricks/design-system';\nimport { useUpdateRunsChartsUIConfiguration } from '../../hooks/useRunsChartsUIConfiguration';\nimport { compact, isArray } from 'lodash';\nimport type { RunsChartCardSetFullscreenFn } from '../cards/ChartCard.common';\nimport type { RunsGroupByConfig } from '../../../experiment-page/utils/experimentPage.group-row-utils';\nimport type { RunsChartsGlobalLineChartConfig } from '../../../experiment-page/models/ExperimentPageUIState';\n\nconst chartMatchesFilter = (filter: string, config: RunsChartsCardConfig) => {\n  // Use regexp-based filtering if a feature flag is enabled\n  if (config.type === RunsChartType.IMAGE || config.type === RunsChartType.DIFFERENCE) {\n    return true;\n  }\n\n  try {\n    const filterRegex = new RegExp(filter, 'i');\n    return getChartMetricsAndParams(config).some((metricOrParam) => metricOrParam.match(filterRegex));\n  } catch {\n    // If the regex is invalid (e.g. user it still typing it), prevent from filtering\n    return true;\n  }\n};\n\nconst getChartMetricsAndParams = (config: RunsChartsCardConfig): string[] => {\n  if (config.type === RunsChartType.BAR) {\n    const barConfig = config as RunsChartsBarCardConfig;\n    if (barConfig.dataAccessKey) {\n      return [barConfig.metricKey, barConfig.dataAccessKey];\n    }\n    return [barConfig.metricKey];\n  } else if (config.type === RunsChartType.LINE) {\n    const lineConfig = config as RunsChartsLineCardConfig;\n    if (isArray(lineConfig.selectedMetricKeys)) {\n      return lineConfig.selectedMetricKeys;\n    }\n    return [lineConfig.metricKey];\n  } else if (config.type === RunsChartType.SCATTER) {\n    const scatterConfig = config as RunsChartsScatterCardConfig;\n    return [scatterConfig.xaxis.key.toLowerCase(), scatterConfig.yaxis.key.toLowerCase()];\n  } else if (config.type === RunsChartType.PARALLEL) {\n    const parallelConfig = config as RunsChartsParallelCardConfig;\n    return [...parallelConfig.selectedMetrics, ...parallelConfig.selectedParams];\n  } else {\n    const contourConfig = config as RunsChartsContourCardConfig;\n    return [contourConfig.xaxis.key, contourConfig.yaxis.key, contourConfig.zaxis.key];\n  }\n};\n\nexport interface RunsChartsSectionAccordionProps {\n  compareRunSections?: ChartSectionConfig[];\n  compareRunCharts?: SerializedRunsChartsCardConfigCard[];\n  reorderCharts: (sourceChartUuid: string, targetChartUuid: string) => void;\n  insertCharts: (sourceChartUuid: string, targetSectionId: string) => void;\n  chartData: RunsChartsRunData[];\n  isMetricHistoryLoading?: boolean;\n  startEditChart: (chartCard: RunsChartsCardConfig) => void;\n  removeChart: (configToDelete: RunsChartsCardConfig) => void;\n  addNewChartCard: (metricSectionId: string) => (type: RunsChartType) => void;\n  search: string;\n  groupBy: RunsGroupByConfig | null;\n  autoRefreshEnabled?: boolean;\n  hideEmptyCharts?: boolean;\n  supportedChartTypes?: RunsChartType[] | undefined;\n  setFullScreenChart: RunsChartCardSetFullscreenFn;\n  globalLineChartConfig?: RunsChartsGlobalLineChartConfig;\n  noRunsSelectedEmptyState?: React.ReactElement;\n}\n\nexport const RunsChartsSectionAccordion = ({\n  compareRunSections,\n  compareRunCharts,\n  reorderCharts,\n  insertCharts,\n  chartData,\n  isMetricHistoryLoading = false,\n  autoRefreshEnabled = false,\n  startEditChart,\n  removeChart,\n  addNewChartCard,\n  search,\n  groupBy,\n  supportedChartTypes,\n  hideEmptyCharts,\n  setFullScreenChart = () => {},\n  globalLineChartConfig,\n  noRunsSelectedEmptyState,\n}: RunsChartsSectionAccordionProps) => {\n  const updateUIState = useUpdateRunsChartsUIConfiguration();\n  const [editSection, setEditSection] = useState(-1);\n  const { theme } = useDesignSystemTheme();\n\n  /**\n   * Get the active (expanded) panels for the accordion\n   */\n  const activeKey = useMemo(() => {\n    const activeSections = (compareRunSections || []).flatMap((sectionConfig: ChartSectionConfig) => {\n      if (sectionConfig.display) {\n        return [sectionConfig.uuid];\n      } else {\n        return [];\n      }\n    });\n    return activeSections;\n  }, [compareRunSections]);\n\n  /**\n   * Updates the active (expanded) panels for the accordion\n   */\n  const onActivePanelChange = useCallback(\n    (key: string | string[]) => {\n      updateUIState((current) => {\n        const newCompareRunPanels = (current.compareRunSections || []).map((sectionConfig: ChartSectionConfig) => {\n          const sectionId = sectionConfig.uuid;\n          const shouldDisplaySection =\n            (typeof key === 'string' && sectionId === key) || (Array.isArray(key) && key.includes(sectionId));\n          return {\n            ...sectionConfig,\n            display: shouldDisplaySection,\n          };\n        });\n        return {\n          ...current,\n          compareRunSections: newCompareRunPanels,\n        };\n      });\n    },\n    [updateUIState],\n  );\n\n  /**\n   * Deletes a section from the accordion\n   */\n  const deleteSection = useCallback(\n    (sectionId: string) => {\n      updateUIState((current) => {\n        const newCompareRunCharts = (current.compareRunCharts || [])\n          // Keep charts that are generated or not in section\n          .filter((chartConfig: RunsChartsCardConfig) => {\n            return chartConfig.isGenerated || chartConfig.metricSectionId !== sectionId;\n          })\n          // For charts that are generated and in section, set deleted to true\n          .map((chartConfig: RunsChartsCardConfig) => {\n            if (chartConfig.isGenerated && chartConfig.metricSectionId === sectionId) {\n              return { ...chartConfig, deleted: true };\n            } else {\n              return chartConfig;\n            }\n          });\n\n        // Delete section\n        const newCompareRunSections = (current.compareRunSections || [])\n          .slice()\n          .filter((sectionConfig: ChartSectionConfig) => {\n            return sectionConfig.uuid !== sectionId;\n          });\n\n        return {\n          ...current,\n          compareRunCharts: newCompareRunCharts,\n          compareRunSections: newCompareRunSections,\n          isAccordionReordered: true,\n        };\n      });\n    },\n    [updateUIState],\n  );\n\n  /**\n   * Adds a section to the accordion\n   * @param sectionId indicates the section selected to anchor at\n   * @param above is a boolean value indicating whether to add the section above or below the anchor\n   */\n  const addSection = useCallback(\n    (sectionId: string, above: boolean) => {\n      let idx = -1;\n      updateUIState((current) => {\n        // Look for index\n        const newCompareRunSections = [...(current.compareRunSections || [])];\n        idx = newCompareRunSections.findIndex((sectionConfig: ChartSectionConfig) => sectionConfig.uuid === sectionId);\n        const newSection = { name: '', uuid: getUUID(), display: false, isReordered: false };\n        if (idx < 0) {\n          // Index not found, add to end\n          newCompareRunSections.push(newSection);\n        } else if (above) {\n          newCompareRunSections.splice(idx, 0, newSection);\n        } else {\n          idx += 1;\n          newCompareRunSections.splice(idx, 0, newSection);\n        }\n        return {\n          ...current,\n          compareRunSections: newCompareRunSections,\n          isAccordionReordered: true,\n        };\n      });\n      return idx;\n    },\n    [updateUIState],\n  );\n\n  /**\n   * Appends a section to the end of the accordion\n   */\n  const appendSection = useCallback(() => {\n    updateUIState((current) => {\n      const newCompareRunSections = [\n        ...(current.compareRunSections || []),\n        { name: '', uuid: getUUID(), display: false, isReordered: false },\n      ];\n      return {\n        ...current,\n        compareRunSections: newCompareRunSections,\n        isAccordionReordered: true,\n      };\n    });\n    setEditSection(compareRunSections?.length || -1);\n  }, [updateUIState, compareRunSections?.length]);\n\n  /**\n   * Updates the name of a section\n   * @param sectionId the section to update the name of\n   * @param name the new name of the section\n   */\n  const setSectionName = useCallback(\n    (sectionId: string, name: string) => {\n      updateUIState((current) => {\n        const newCompareRunSections = (current.compareRunSections || []).map((sectionConfig: ChartSectionConfig) => {\n          if (sectionConfig.uuid === sectionId) {\n            return { ...sectionConfig, name: name };\n          } else {\n            return sectionConfig;\n          }\n        });\n        return {\n          ...current,\n          compareRunSections: newCompareRunSections,\n          isAccordionReordered: true,\n        };\n      });\n    },\n    [updateUIState],\n  );\n\n  /**\n   * Reorders the sections in the accordion\n   * @param sourceSectionId the section you are dragging\n   * @param targetSectionId the section to drop\n   */\n  const sectionReorder = useCallback(\n    (sourceSectionId: string, targetSectionId: string) => {\n      updateUIState((current) => {\n        const newCompareRunSections = (current.compareRunSections || []).slice();\n        const sourceSectionIdx = newCompareRunSections.findIndex(\n          (sectionConfig: ChartSectionConfig) => sectionConfig.uuid === sourceSectionId,\n        );\n        const targetSectionIdx = newCompareRunSections.findIndex(\n          (sectionConfig: ChartSectionConfig) => sectionConfig.uuid === targetSectionId,\n        );\n        const sourceSection = newCompareRunSections.splice(sourceSectionIdx, 1)[0];\n        // If the source section is above the target section, the target section index will be shifted down by 1\n        newCompareRunSections.splice(targetSectionIdx, 0, sourceSection);\n        return {\n          ...current,\n          compareRunSections: newCompareRunSections,\n          isAccordionReordered: true,\n        };\n      });\n    },\n    [updateUIState],\n  );\n\n  const noRunsSelected = useMemo(() => chartData.filter(({ hidden }) => !hidden).length === 0, [chartData]);\n\n  const { sectionsToRender, chartsToRender } = useMemo(() => {\n    if (search === '') {\n      return { sectionsToRender: compareRunSections, chartsToRender: compareRunCharts };\n    }\n\n    const compareRunChartsFiltered = (compareRunCharts || []).filter((config: RunsChartsCardConfig) => {\n      return !config.deleted && chartMatchesFilter(search, config);\n    });\n    // Get the sections that have these charts\n    const sectionsWithCharts = new Set<string>();\n    compareRunChartsFiltered.forEach((config: RunsChartsCardConfig) => {\n      if (config.metricSectionId) {\n        sectionsWithCharts.add(config.metricSectionId);\n      }\n    });\n    // Filter the sections\n    const compareRunSectionsFiltered = (compareRunSections || []).filter((sectionConfig: ChartSectionConfig) => {\n      return sectionsWithCharts.has(sectionConfig.uuid);\n    });\n\n    return { sectionsToRender: compareRunSectionsFiltered, chartsToRender: compareRunChartsFiltered };\n  }, [search, compareRunCharts, compareRunSections]);\n\n  const isSearching = search !== '';\n\n  if (!compareRunSections || !compareRunCharts) {\n    return null;\n  }\n\n  if (noRunsSelected) {\n    return (\n      noRunsSelectedEmptyState ?? (\n        <div css={{ marginTop: theme.spacing.lg }}>\n          <Empty\n            description={\n              <FormattedMessage\n                defaultMessage=\"All runs are hidden. Select at least one run to view charts.\"\n                description=\"Experiment tracking > runs charts > indication displayed when no runs are selected for comparison\"\n              />\n            }\n          />\n        </div>\n      )\n    );\n  }\n\n  if (isSearching && chartsToRender?.length === 0) {\n    // Render empty in the center of the page\n    return (\n      <>\n        <Spacer size=\"lg\" />\n        <Empty\n          title={\n            <FormattedMessage\n              defaultMessage=\"No metric charts\"\n              description=\"Experiment page > compare runs > no metric charts\"\n            />\n          }\n          description={\n            <FormattedMessage\n              defaultMessage=\"All charts are filtered. Clear the search filter to see hidden metric charts.\"\n              description=\"Experiment page > compare runs > no metric charts > description\"\n            />\n          }\n        />\n      </>\n    );\n  }\n\n  return (\n    <div>\n      <MetricChartsAccordion activeKey={activeKey} onActiveKeyChange={onActivePanelChange}>\n        {(sectionsToRender || []).map((sectionConfig: ChartSectionConfig, index: number) => {\n          const sectionCharts = (chartsToRender || []).filter((config: RunsChartsCardConfig) => {\n            const section = (config as RunsChartsBarCardConfig).metricSectionId;\n            return !config.deleted && section === sectionConfig.uuid;\n          });\n\n          return (\n            <Accordion.Panel\n              header={\n                <RunsChartsSectionHeader\n                  index={index}\n                  section={sectionConfig}\n                  onDeleteSection={deleteSection}\n                  onAddSection={addSection}\n                  editSection={editSection}\n                  onSetEditSection={setEditSection}\n                  onSetSectionName={setSectionName}\n                  sectionChartsLength={sectionCharts.length}\n                  addNewChartCard={addNewChartCard}\n                  onSectionReorder={sectionReorder}\n                  isExpanded={activeKey.includes(sectionConfig.uuid)}\n                  supportedChartTypes={supportedChartTypes}\n                  // When searching, hide the section placement controls\n                  hideExtraControls={isSearching}\n                />\n              }\n              key={sectionConfig.uuid}\n              aria-hidden={!activeKey.includes(sectionConfig.uuid)}\n            >\n              <RunsChartsSection\n                sectionId={sectionConfig.uuid}\n                sectionConfig={sectionConfig}\n                sectionCharts={sectionCharts}\n                reorderCharts={reorderCharts}\n                insertCharts={insertCharts}\n                isMetricHistoryLoading={isMetricHistoryLoading}\n                chartData={chartData}\n                startEditChart={startEditChart}\n                removeChart={removeChart}\n                groupBy={groupBy}\n                sectionIndex={index}\n                setFullScreenChart={setFullScreenChart}\n                autoRefreshEnabled={autoRefreshEnabled}\n                hideEmptyCharts={hideEmptyCharts}\n                globalLineChartConfig={globalLineChartConfig}\n              />\n            </Accordion.Panel>\n          );\n        })}\n      </MetricChartsAccordion>\n      {!isSearching && (\n        <div>\n          <Button\n            componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-compare_sections_runscomparesectionaccordion.tsx_405\"\n            block\n            onClick={appendSection}\n            icon={<PlusIcon />}\n            style={{ border: 'none', marginTop: '6px' }}\n          >\n            <FormattedMessage\n              defaultMessage=\"Add section\"\n              description=\"Experiment page > compare runs > chart section > add section bar\"\n            />\n          </Button>\n        </div>\n      )}\n    </div>\n  );\n};\n","var _path, _path2, _path3, _path4, _path5;\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nimport * as React from \"react\";\nfunction SvgChartParallel({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 18,\n    height: 18,\n    viewBox: \"0 0 18 18\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M1 1V17H17\",\n    stroke: \"#A3AEB8\",\n    strokeLinecap: \"round\"\n  })), _path2 || (_path2 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M4.21875 3.58289C4.55663 3.58289 4.88067 3.68935 5.21469 3.73008C5.6474 3.78285 6.02137 3.96513 6.37191 4.21552C6.76902 4.49917 7.0271 4.74589 7.24101 5.18954C7.44337 5.60925 7.59378 6.06989 7.72958 6.51432C7.86002 6.94121 8.09708 7.33726 8.19153 7.77803C8.25347 8.0671 8.34514 8.32427 8.44678 8.60015C8.58028 8.96252 8.80086 9.27915 8.96667 9.62583C9.15145 10.0122 9.216 10.4461 9.34876 10.8551C9.57831 11.5623 9.91132 12.4763 10.7205 12.6731C11.4284 12.8453 12.1459 12.8845 12.8705 12.8845C13.0981 12.8845 13.3979 12.898 13.5831 12.7499C13.6402 12.7042 13.7451 12.6907 13.8164 12.6591C13.8752 12.6329 14.0919 12.5871 14.1123 12.5463\",\n    stroke: \"#CCE3F2\",\n    strokeLinecap: \"round\"\n  })), _path3 || (_path3 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M4.16162 12.9805C4.32512 12.9805 4.4895 12.9859 4.65284 12.9805C4.84076 12.9742 5.0468 12.7952 5.2099 12.707C5.62236 12.4841 5.99426 12.0648 6.24299 11.6739C6.49491 11.2781 6.8776 10.9871 7.0887 10.5649C7.27767 10.187 7.50992 9.80749 7.73691 9.45078C7.93911 9.13304 8.10211 8.77722 8.28637 8.44554C8.43088 8.18544 8.45 7.88672 8.60542 7.62768C8.94898 7.05509 9.16215 6.418 9.45873 5.82484C9.72614 5.29001 9.96898 4.82426 10.4159 4.42207C10.5753 4.27853 10.8984 4.21824 11.0995 4.14861C11.3303 4.06873 11.579 4.02714 11.8136 3.93592C12.0394 3.84807 12.2521 3.84383 12.4795 3.77386C12.6993 3.70623 12.9319 3.63713 13.1632 3.63713C13.5192 3.63713 13.9089 3.59155 14.2798 3.59155\",\n    stroke: \"#CCE3F2\",\n    strokeLinecap: \"round\"\n  })), _path4 || (_path4 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M3.79248 2.74207V13.8225\",\n    stroke: \"#338ECC\",\n    strokeLinecap: \"round\"\n  })), _path5 || (_path5 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M14.873 3.04419V13.7217\",\n    stroke: \"#338ECC\",\n    strokeLinecap: \"round\"\n  })));\n}\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgChartParallel);\nexport default __webpack_public_path__ + \"static/media/chart-parallel.da7dedf539b2af4b654d377c679173e4.svg\";\nexport { ForwardRef as ReactComponent };","import { last, uniq } from 'lodash';\nimport type { RunsChartsLineChartExpression } from '../runs-charts.types';\nimport { useCallback } from 'react';\n\nconst VARIABLE_OPERATOR = '$';\nconst MATCH_VARIABLE_REGEX = /\\$\\{([^}]+)\\}/g;\n\nenum Operator {\n  ADD = '+',\n  SUBTRACT = '-',\n  MULTIPLY = '*',\n  DIVIDE = '/',\n  POWER = '^',\n  // unary operators\n  NEGATIVE_SIGN = '_',\n  POSITIVE_SIGN = '|',\n}\nenum Parenthesis {\n  OPEN = '(',\n  CLOSE = ')',\n}\nenum VariableParenthesis {\n  OPEN = '{',\n  CLOSE = '}',\n}\n// Higher precedence value means higher priority\nconst precedence = {\n  [Operator.ADD]: 1,\n  [Operator.SUBTRACT]: 1,\n  [Operator.MULTIPLY]: 2,\n  [Operator.DIVIDE]: 2,\n  [Operator.POWER]: 3,\n  [Operator.NEGATIVE_SIGN]: 4,\n  [Operator.POSITIVE_SIGN]: 4,\n};\n\nconst isBinaryOperator = (char: string | number | undefined) => {\n  if (typeof char === 'string') {\n    return [Operator.ADD, Operator.SUBTRACT, Operator.MULTIPLY, Operator.DIVIDE, Operator.POWER].includes(\n      char as Operator,\n    );\n  }\n  return false;\n};\n\nconst isUnaryOperator = (char: string | number | undefined) => {\n  if (typeof char === 'string') {\n    return [Operator.NEGATIVE_SIGN, Operator.POSITIVE_SIGN].includes(char as Operator);\n  }\n  return false;\n};\nconst isHigherPrecedence = (op1: Operator, op2: Operator) => precedence[op1] > precedence[op2];\n\nconst indexToVariableString = (name: number) => `${VARIABLE_OPERATOR}{${name}}`;\nconst variableStringToIndex = (variable: string) => variable.slice(2, -1);\n\n// Parses variables from an expression and replace with an index\nexport const parseVariablesAndReplaceWithIndex = (expression: string) => {\n  const matches = expression.match(MATCH_VARIABLE_REGEX);\n  if (!matches) {\n    return { expression, variables: [] };\n  }\n  // De-duplicate matches and map them to their index\n  const dedupMatches = uniq(matches);\n  const matchesMap: Record<string, string> = {};\n  dedupMatches.forEach((match, index) => {\n    matchesMap[match] = indexToVariableString(index);\n  });\n  // Convert each variable into an index number e.g. ${train/loss} => ${0}\n  const replacedExpression = expression.replace(MATCH_VARIABLE_REGEX, (match) => {\n    if (match in matchesMap) {\n      return matchesMap[match];\n    }\n    return match;\n  });\n\n  const variables = dedupMatches.map(variableStringToIndex);\n  return { expression: replacedExpression, variables };\n};\n\n// Pop function that throws an error if the stack is empty\nconst popAndValidate = (stack: (string | number)[], operandCount: number[]): string | number => {\n  const lastElement = stack.pop();\n  if (lastElement === undefined) {\n    throw new Error('Invalid expression: stack is empty');\n  } else if (isBinaryOperator(lastElement)) {\n    if (operandCount[operandCount.length - 1] < 2) {\n      throw new Error('Invalid expression: Stack has binary operator without enough operands');\n    }\n    operandCount[operandCount.length - 1]--;\n  } else if (isUnaryOperator(lastElement)) {\n    if (operandCount[operandCount.length - 1] < 1) {\n      throw new Error('Invalid expression: Stack has unary operator without enough operands');\n    }\n  } else {\n    throw new Error('Invalid expression: Stack has invalid elements');\n  }\n  return lastElement;\n};\n\n// Flushes all the unary operators on a given value\nconst flushUnaryOperators = (stack: (string | number)[], output: (string | number)[], operandCount: number[]) => {\n  while (stack.length > 0 && isUnaryOperator(last(stack))) {\n    output.push(popAndValidate(stack, operandCount));\n  }\n};\n\nconst toRPN = (expression: string) => {\n  const stack: (string | number)[] = [];\n  const output: (string | number)[] = [];\n  const operandCount: number[] = [0];\n\n  const incrementOperand = () => {\n    operandCount[operandCount.length - 1]++;\n  };\n  for (let i = 0; i < expression.length; i++) {\n    let char = expression[i];\n\n    // Convert unary operators to placeholder negative and positive signs\n    const isUnarySign = i === 0 || isBinaryOperator(expression[i - 1]) || expression[i - 1] === Parenthesis.OPEN;\n    if (char === Operator.SUBTRACT && isUnarySign) {\n      char = Operator.NEGATIVE_SIGN;\n    } else if (char === Operator.ADD && isUnarySign) {\n      char = Operator.POSITIVE_SIGN;\n    }\n\n    if (char === VARIABLE_OPERATOR) {\n      let variable = '';\n      if (i + 1 >= expression.length || expression[i + 1] !== VariableParenthesis.OPEN) {\n        throw new Error('Invalid expression: Variable must be followed by {');\n      }\n      i++; // Skip '{'\n      while (i + 1 < expression.length && expression[i + 1] !== VariableParenthesis.CLOSE) {\n        variable += expression[++i];\n      }\n      i++; // Skip '}'\n      output.push(variable);\n      incrementOperand();\n      flushUnaryOperators(stack, output, operandCount);\n    } else if (/\\d/.test(char) || char === '.') {\n      // If the character is part of a number (digit or decimal point)\n      let num = char;\n      // Parse full number\n      while (i + 1 < expression.length && (/\\d/.test(expression[i + 1]) || expression[i + 1] === '.')) {\n        num += expression[++i];\n      }\n      const periodMatches = num.match(/\\./g);\n      if (periodMatches && periodMatches.length > 1) {\n        throw new Error('Invalid expression: Number has multiple decimal points');\n      }\n      const floatNum = parseFloat(num);\n      incrementOperand();\n      output.push(floatNum);\n      flushUnaryOperators(stack, output, operandCount);\n    } else if (isUnaryOperator(char)) {\n      stack.push(char);\n    } else if (isBinaryOperator(char)) {\n      // If its a binary operator, we should have at least on element in the output to operate on\n      if (output.length === 0) {\n        throw new Error('Invalid expression: Binary operator without operands');\n      }\n      while (\n        stack.length > 0 &&\n        isBinaryOperator(last(stack)) &&\n        (isHigherPrecedence(last(stack) as Operator, char as Operator) ||\n          (last(stack) === char && char !== Operator.POWER))\n      ) {\n        output.push(popAndValidate(stack, operandCount));\n      }\n      stack.push(char);\n    } else if (char === Parenthesis.OPEN) {\n      stack.push(char);\n      operandCount.push(0);\n    } else if (char === Parenthesis.CLOSE) {\n      while (stack.length > 0 && last(stack) !== Parenthesis.OPEN) {\n        output.push(popAndValidate(stack, operandCount));\n      }\n      const openParen = stack.pop(); // Remove '(' from the stack\n      if (openParen !== Parenthesis.OPEN) {\n        throw new Error('Invalid expression: Parenthesis mismatch');\n      }\n      if (operandCount[operandCount.length - 1] !== 1) {\n        throw new Error('Invalid expression: Parenthesis does not have exactly one operand');\n      }\n      operandCount.pop();\n      incrementOperand();\n      flushUnaryOperators(stack, output, operandCount);\n    } else {\n      throw new Error('Invalid expression: Unknown character in expression');\n    }\n  }\n  // The stack should only have unary and binary operators at the end\n  while (stack.length > 0) {\n    output.push(popAndValidate(stack, operandCount));\n  }\n  if (operandCount.length !== 1 || operandCount[0] !== 1) {\n    throw new Error('Invalid expression: Invalid number of operands');\n  }\n  return output;\n};\n\nconst fromRPN = (tokens: (string | number)[]) => {\n  const stack: (number | string)[] = [];\n  tokens.forEach((token) => {\n    if (typeof token === 'number') {\n      stack.push(token);\n      return;\n    }\n    if (isUnaryOperator(token)) {\n      const x = stack.pop();\n      if (typeof x !== 'number') {\n        throw new Error('Invalid expression: Unary operator without operand');\n      }\n      switch (token) {\n        case Operator.NEGATIVE_SIGN:\n          stack.push(-x);\n          break;\n        case Operator.POSITIVE_SIGN:\n          stack.push(x);\n          break;\n      }\n    } else if (isBinaryOperator(token)) {\n      const b = stack.pop();\n      const a = stack.pop();\n      if (typeof a !== 'number' || typeof b !== 'number') {\n        throw new Error('Invalid expression: Binary operator without enough operands');\n      }\n      switch (token) {\n        case Operator.ADD:\n          stack.push(a + b);\n          break;\n        case Operator.SUBTRACT:\n          stack.push(a - b);\n          break;\n        case Operator.MULTIPLY:\n          stack.push(a * b);\n          break;\n        case Operator.DIVIDE:\n          stack.push(a / b);\n          break;\n        case Operator.POWER:\n          stack.push(Math.pow(a, b));\n          break;\n      }\n    } else {\n      throw new Error('Invalid expression: Unknown token in expression');\n    }\n  });\n  if (stack.length !== 1 || typeof stack[0] !== 'number') {\n    throw new Error('Invalid expression: Invalid expression result');\n  }\n  return stack[0];\n};\n\nexport const useChartExpressionParser = () => {\n  const compileExpression = useCallback(\n    (expression: string, metricKeyList: string[]): RunsChartsLineChartExpression | undefined => {\n      try {\n        // Validate only contains valid characters\n        const noVariableExpression = expression.replace(MATCH_VARIABLE_REGEX, '');\n        if (!/^[0-9+\\-*/().\\s^]*$/.test(noVariableExpression)) {\n          return undefined;\n        }\n        // Parse variables from expression and remove whitespace elsewhere\n        const { expression: parsedExpression, variables } = parseVariablesAndReplaceWithIndex(expression);\n        // Check if all variables are valid\n        for (const variable of variables) {\n          if (!metricKeyList.includes(variable)) {\n            return undefined;\n          }\n        }\n        const cleanedExpression = parsedExpression.replace(/\\s/g, '');\n        const replacedExpression = cleanedExpression.replace(MATCH_VARIABLE_REGEX, (match) => {\n          const index = parseInt(match.slice(2, -1), 10);\n          return `${VARIABLE_OPERATOR}{${variables[index]}}`;\n        });\n        // Convert expression to RPN\n        const rpn = toRPN(replacedExpression);\n        return {\n          rpn,\n          variables,\n          expression,\n        };\n      } catch (e) {\n        // If not a valid expression, return undefined\n        return undefined;\n      }\n    },\n    [],\n  );\n\n  const evaluateExpression = (\n    chartExpression: RunsChartsLineChartExpression | undefined,\n    variables: Record<string, number>,\n  ): number | undefined => {\n    if (chartExpression === undefined) {\n      return undefined;\n    }\n    try {\n      const parsedRPN = chartExpression.rpn.map((token) => {\n        if (typeof token === 'string' && chartExpression.variables.includes(token)) {\n          return variables[token];\n        }\n        return token;\n      });\n      return fromRPN(parsedRPN);\n    } catch (e) {\n      return undefined;\n    }\n  };\n\n  return {\n    compileExpression,\n    evaluateExpression,\n  };\n};\n","import { useCallback, useRef, useState } from 'react';\nimport { type Data, type Layout, type Config, downloadImage } from 'plotly.js';\n\nexport type ExperimentChartImageDownloadFileFormat = 'svg' | 'png';\nexport type ExperimentChartImageDownloadHandler = (\n  format: ExperimentChartImageDownloadFileFormat,\n  chartTitle: string,\n) => void;\n\nconst experimentChartImageDefaultDownloadLayout: Partial<Layout> = {\n  paper_bgcolor: 'white',\n  plot_bgcolor: 'white',\n};\n\nconst experimentChartImageDefaultDownloadSettings = {\n  width: 1200,\n  height: 600,\n};\n\nconst experimentChartImageDefaultDownloadPlotConfig: Partial<Config> = {\n  displaylogo: false,\n  modeBarButtonsToRemove: ['toImage'],\n};\n\nexport const createChartImageDownloadHandler =\n  (data: Data[], layout: Partial<Layout>) => (format: 'svg' | 'png', title: string) =>\n    downloadImage(\n      {\n        data,\n        layout: { ...layout, ...experimentChartImageDefaultDownloadLayout },\n        config: experimentChartImageDefaultDownloadPlotConfig,\n      },\n      { ...experimentChartImageDefaultDownloadSettings, format, filename: title },\n    );\n\n/**\n * Returns a memoized download handler for chart images.\n * Uses ref-based caching to ensure that the download handler is not recreated on every render.\n */\nexport const useChartImageDownloadHandler = () => {\n  const downloadHandlerRef = useRef<ExperimentChartImageDownloadHandler | null>(null);\n  const [downloadHandler, setDownloadHandler] = useState<ExperimentChartImageDownloadHandler | null>(null);\n\n  const setDownloadHandlerCached = useCallback((downloadHandler: ExperimentChartImageDownloadHandler) => {\n    downloadHandlerRef.current = downloadHandler;\n    setDownloadHandler((existingHandler: ExperimentChartImageDownloadHandler | null) => {\n      if (existingHandler) {\n        return existingHandler;\n      }\n\n      return (format: ExperimentChartImageDownloadFileFormat, chartTitle: string) =>\n        downloadHandlerRef.current?.(format, chartTitle);\n    });\n  }, []);\n\n  return [downloadHandler, setDownloadHandlerCached] as const;\n};\n","import { useMemo } from 'react';\nimport type { RunsChartsRunData } from '../RunsCharts.common';\nimport { RunsMetricsBarPlot } from '../RunsMetricsBarPlot';\nimport { useRunsChartsTooltip } from '../../hooks/useRunsChartsTooltip';\nimport type { RunsChartsBarCardConfig } from '../../runs-charts.types';\nimport type { RunsChartCardFullScreenProps, RunsChartCardVisibilityProps } from './ChartCard.common';\nimport { RunsChartCardWrapper, type RunsChartCardReorderProps, RunsChartsChartsDragGroup } from './ChartCard.common';\nimport { useChartImageDownloadHandler } from '../../hooks/useChartImageDownloadHandler';\nimport { downloadChartDataCsv } from '../../../experiment-page/utils/experimentPage.common-utils';\nimport { customMetricBehaviorDefs } from '../../../experiment-page/utils/customMetricBehaviorUtils';\nimport { RunsChartsNoDataFoundIndicator } from '../RunsChartsNoDataFoundIndicator';\nimport { Tag, Typography } from '@databricks/design-system';\n\nexport interface RunsChartsBarChartCardProps\n  extends RunsChartCardReorderProps,\n    RunsChartCardFullScreenProps,\n    RunsChartCardVisibilityProps {\n  config: RunsChartsBarCardConfig;\n  chartRunData: RunsChartsRunData[];\n\n  hideEmptyCharts?: boolean;\n\n  onDelete: () => void;\n  onEdit: () => void;\n}\n\nexport const barChartCardDefaultMargin = {\n  t: 24,\n  b: 48,\n  r: 0,\n  l: 4,\n  pad: 0,\n};\n\nexport const RunsChartsBarChartCard = ({\n  config,\n  chartRunData,\n  onDelete,\n  onEdit,\n  fullScreen,\n  setFullScreenChart,\n  hideEmptyCharts,\n  isInViewport: isInViewportProp,\n  ...reorderProps\n}: RunsChartsBarChartCardProps) => {\n  const dataKey = config.dataAccessKey ?? config.metricKey;\n\n  const toggleFullScreenChart = () => {\n    setFullScreenChart?.({\n      config,\n      title: customMetricBehaviorDefs[config.metricKey]?.displayName ?? config.metricKey,\n      subtitle: null,\n    });\n  };\n\n  const slicedRuns = useMemo(\n    () => chartRunData.filter(({ hidden, metrics }) => !hidden && metrics[dataKey]),\n    [chartRunData, dataKey],\n  );\n\n  const isEmptyDataset = useMemo(() => {\n    const metricsInRuns = slicedRuns.flatMap(({ metrics }) => Object.keys(metrics));\n    return !metricsInRuns.includes(dataKey);\n  }, [dataKey, slicedRuns]);\n\n  const { setTooltip, resetTooltip, selectedRunUuid } = useRunsChartsTooltip(config);\n\n  // If the chart is in fullscreen mode, we always render its body.\n  // Otherwise, we only render the chart if it is in the viewport.\n  const isInViewport = fullScreen || isInViewportProp;\n\n  const [imageDownloadHandler, setImageDownloadHandler] = useChartImageDownloadHandler();\n\n  const chartBody = (\n    <div\n      css={[\n        styles.barChartCardWrapper,\n        {\n          height: fullScreen ? '100%' : undefined,\n        },\n      ]}\n    >\n      {isInViewport ? (\n        <RunsMetricsBarPlot\n          runsData={slicedRuns}\n          metricKey={dataKey}\n          displayRunNames={false}\n          displayMetricKey={false}\n          useDefaultHoverBox={false}\n          margin={barChartCardDefaultMargin}\n          onHover={setTooltip}\n          onUnhover={resetTooltip}\n          selectedRunUuid={selectedRunUuid}\n          onSetDownloadHandler={setImageDownloadHandler}\n        />\n      ) : null}\n    </div>\n  );\n\n  if (fullScreen) {\n    return chartBody;\n  }\n\n  // Do not render the card if the chart is empty and the user has enabled hiding empty charts\n  if (hideEmptyCharts && isEmptyDataset) {\n    return null;\n  }\n\n  const chartTitle = (() => {\n    if (config.datasetName) {\n      return (\n        <div css={{ flex: 1, display: 'flex', alignItems: 'center', overflow: 'hidden' }}>\n          <Typography.Text title={config.metricKey} ellipsis bold>\n            <Tag componentId=\"mlflow.charts.bar_card_title.dataset_tag\" css={{ marginRight: 0 }}>\n              {config.datasetName}\n            </Tag>{' '}\n            {config.metricKey}\n          </Typography.Text>\n        </div>\n      );\n    }\n    return customMetricBehaviorDefs[config.metricKey]?.displayName ?? config.displayName ?? config.metricKey;\n  })();\n\n  return (\n    <RunsChartCardWrapper\n      onEdit={onEdit}\n      onDelete={onDelete}\n      title={chartTitle}\n      uuid={config.uuid}\n      dragGroupKey={RunsChartsChartsDragGroup.GENERAL_AREA}\n      // Disable fullscreen button if the chart is empty\n      toggleFullScreenChart={isEmptyDataset ? undefined : toggleFullScreenChart}\n      supportedDownloadFormats={['png', 'svg', 'csv']}\n      onClickDownload={(format) => {\n        if (format === 'csv' || format === 'csv-full') {\n          const runsToExport = [...slicedRuns].reverse();\n          downloadChartDataCsv(runsToExport, [config.metricKey], [], config.metricKey);\n          return;\n        }\n        imageDownloadHandler?.(format, config.metricKey);\n      }}\n      {...reorderProps}\n    >\n      {isEmptyDataset ? <RunsChartsNoDataFoundIndicator /> : chartBody}\n    </RunsChartCardWrapper>\n  );\n};\n\nconst styles = {\n  barChartCardWrapper: {\n    overflow: 'hidden',\n  },\n};\n","import { isUndefined } from 'lodash';\n\nimport type { RunsCompareMultipleTracesTooltipData } from './RunsMetricsLinePlot';\nimport React from 'react';\nimport { TraceLabelColorIndicator } from './RunsMetricsLegend';\nimport { FormattedDate, FormattedTime, useIntl } from 'react-intl';\nimport { getChartAxisLabelDescriptor, RunsChartsLineChartXAxisType } from './RunsCharts.common';\nimport { useDesignSystemTheme } from '@databricks/design-system';\nimport { shouldEnableRelativeTimeDateAxis } from '@mlflow/mlflow/src/common/utils/FeatureUtils';\n\n// Sadly when hovering outside data point, we can't get the date-time value from Plotly chart\n// so we have to format it ourselves in a way that resembles Plotly's logic\nconst PlotlyLikeFormattedTime = ({ value }: { value: string | number }) => (\n  <>\n    <FormattedDate value={value} year=\"numeric\" />-\n    <FormattedDate value={value} month=\"2-digit\" />-\n    <FormattedDate value={value} day=\"2-digit\" /> <FormattedTime value={value} hour=\"numeric\" hourCycle=\"h24\" />:\n    <FormattedTime value={value} minute=\"2-digit\" />:\n    <FormattedTime value={value} second=\"2-digit\" fractionalSecondDigits={3} />\n  </>\n);\n\n// Sadly when hovering outside data point, we can't get the date-time value from Plotly chart\n// so we have to format it ourselves in a way that resembles Plotly's logic\nconst PlotlyLikeFormattedTimestamp = ({ value }: { value: string | number }) => (\n  <>\n    <FormattedTime value={value} hour=\"2-digit\" hourCycle=\"h23\" />:\n    <FormattedTime value={value} minute=\"2-digit\" />:\n    <FormattedTime value={value} second=\"2-digit\" fractionalSecondDigits={3} />\n  </>\n);\n\n/**\n * Variant of the tooltip body for the line chart that displays multiple traces at once.\n * Used in the compare runs page and run details metrics page.\n */\nexport const RunsMultipleTracesTooltipBody = ({ hoverData }: { hoverData: RunsCompareMultipleTracesTooltipData }) => {\n  const { tooltipLegendItems, hoveredDataPoint: singleTraceHoverData, xValue, xAxisKeyLabel } = hoverData;\n  const { traceUuid: runUuid, metricEntity } = singleTraceHoverData || {};\n\n  const intl = useIntl();\n  const { theme } = useDesignSystemTheme();\n\n  const hoveredTraceUuid = `${runUuid}.${metricEntity?.key}`;\n  const displayedXValueLabel =\n    hoverData.xAxisKey === RunsChartsLineChartXAxisType.METRIC\n      ? xAxisKeyLabel\n      : intl.formatMessage(getChartAxisLabelDescriptor(hoverData.xAxisKey));\n\n  if (tooltipLegendItems) {\n    return (\n      <div>\n        {!isUndefined(xValue) && (\n          <div css={{ marginBottom: theme.spacing.xs }}>\n            <span css={{ fontWeight: 'bold' }}>{displayedXValueLabel}</span>{' '}\n            {hoverData.xAxisKey === RunsChartsLineChartXAxisType.TIME ? (\n              <PlotlyLikeFormattedTime value={xValue} />\n            ) : shouldEnableRelativeTimeDateAxis() &&\n              hoverData.xAxisKey === RunsChartsLineChartXAxisType.TIME_RELATIVE ? (\n              <PlotlyLikeFormattedTimestamp value={xValue} />\n            ) : (\n              xValue\n            )}\n          </div>\n        )}\n        <div\n          css={{\n            display: 'grid',\n            gridTemplateColumns: `${theme.general.iconSize}px auto auto`,\n            columnGap: theme.spacing.sm,\n            rowGap: theme.spacing.sm / 4,\n            alignItems: 'center',\n          }}\n        >\n          {tooltipLegendItems.map(({ displayName, color, uuid, value, dashStyle }) => (\n            <React.Fragment key={uuid}>\n              <TraceLabelColorIndicator color={color || 'transparent'} dashStyle={dashStyle} />\n\n              <div\n                css={{\n                  marginRight: theme.spacing.md,\n                  fontSize: theme.typography.fontSizeSm,\n                  color: hoveredTraceUuid === uuid ? 'unset' : theme.colors.textPlaceholder,\n                }}\n              >\n                {displayName}\n              </div>\n              <div>\n                {!isUndefined(value) && (\n                  <span\n                    css={{\n                      fontWeight: hoveredTraceUuid === uuid ? 'bold' : 'normal',\n                      color: hoveredTraceUuid === uuid ? 'unset' : theme.colors.textPlaceholder,\n                    }}\n                  >\n                    {value}\n                  </span>\n                )}\n              </div>\n            </React.Fragment>\n          ))}\n        </div>\n      </div>\n    );\n  }\n  return null;\n};\n","import React, { useCallback } from 'react';\nimport type { ExperimentRunsChartsUIConfiguration } from '../../experiment-page/models/ExperimentPageUIState';\nimport { RunsChartsCardConfig } from '../runs-charts.types';\nimport { getUUID } from '../../../../common/utils/ActionUtils';\n\nexport type RunsChartsUIConfigurationSetter = (\n  state: ExperimentRunsChartsUIConfiguration,\n) => ExperimentRunsChartsUIConfiguration;\n\nconst RunsChartsUIConfigurationContext = React.createContext<\n  (stateSetter: RunsChartsUIConfigurationSetter, isSeeding?: boolean) => void\n>(() => {});\n\n/**\n * Creates a localized context to manage the UI state of the runs charts.\n * Accepts a function to update the state object, coming from simple state setter or a reducer.\n */\nexport const RunsChartsUIConfigurationContextProvider = ({\n  children,\n  updateChartsUIState,\n}: {\n  children: React.ReactNode;\n  updateChartsUIState: (stateSetter: RunsChartsUIConfigurationSetter, isSeeding?: boolean) => void;\n}) => (\n  <RunsChartsUIConfigurationContext.Provider value={updateChartsUIState}>\n    {children}\n  </RunsChartsUIConfigurationContext.Provider>\n);\n\n/**\n * Returns a function to update the current overarching UI state of the runs charts.\n */\nexport const useUpdateRunsChartsUIConfiguration = () => React.useContext(RunsChartsUIConfigurationContext);\n\nexport const useReorderRunsChartsFn = () => {\n  const updateChartsUIState = useUpdateRunsChartsUIConfiguration();\n\n  return useCallback(\n    (sourceChartUuid: string, targetChartUuid: string) => {\n      updateChartsUIState((current) => {\n        const newChartsOrder = current.compareRunCharts?.slice();\n        const newSectionsState = current.compareRunSections?.slice();\n        if (!newChartsOrder || !newSectionsState) {\n          return current;\n        }\n\n        const indexSource = newChartsOrder.findIndex((c) => c.uuid === sourceChartUuid);\n        const indexTarget = newChartsOrder.findIndex((c) => c.uuid === targetChartUuid);\n\n        // If one of the charts is not found, do nothing\n        if (indexSource < 0 || indexTarget < 0) {\n          return current;\n        }\n\n        const sourceChart = newChartsOrder[indexSource];\n        const targetChart = newChartsOrder[indexTarget];\n\n        const isSameMetricSection = targetChart.metricSectionId === sourceChart.metricSectionId;\n\n        // Update the sections to indicate that the charts have been reordered\n        const sourceSectionIdx = newSectionsState.findIndex((c) => c.uuid === sourceChart.metricSectionId);\n        const targetSectionIdx = newSectionsState.findIndex((c) => c.uuid === targetChart.metricSectionId);\n        newSectionsState.splice(sourceSectionIdx, 1, { ...newSectionsState[sourceSectionIdx], isReordered: true });\n        newSectionsState.splice(targetSectionIdx, 1, { ...newSectionsState[targetSectionIdx], isReordered: true });\n\n        // Set new chart metric group\n        const newSourceChart = { ...sourceChart };\n        newSourceChart.metricSectionId = targetChart.metricSectionId;\n\n        // Remove the source graph from array\n        newChartsOrder.splice(indexSource, 1);\n        if (!isSameMetricSection) {\n          // Insert the source graph into target\n          newChartsOrder.splice(\n            newChartsOrder.findIndex((c) => c.uuid === targetChartUuid),\n            0,\n            newSourceChart,\n          );\n        } else {\n          // The indexTarget is not neccessarily the target now, but it will work as the insert index\n          newChartsOrder.splice(indexTarget, 0, newSourceChart);\n        }\n\n        return {\n          ...current,\n          compareRunCharts: newChartsOrder,\n          compareRunSections: newSectionsState,\n        };\n      });\n    },\n    [updateChartsUIState],\n  );\n};\n\nexport const useConfirmChartCardConfigurationFn = () => {\n  const updateChartsUIState = useUpdateRunsChartsUIConfiguration();\n  return useCallback(\n    (configuredCard: Partial<RunsChartsCardConfig>) => {\n      const serializedCard = RunsChartsCardConfig.serialize({\n        ...configuredCard,\n        uuid: getUUID(),\n      });\n\n      // Creating new chart\n      if (!configuredCard.uuid) {\n        updateChartsUIState((current) => ({\n          ...current,\n          // This condition ensures that chart collection will remain undefined if not set previously\n          compareRunCharts: current.compareRunCharts && [...current.compareRunCharts, serializedCard],\n        }));\n      } /* Editing existing chart */ else {\n        updateChartsUIState((current) => ({\n          ...current,\n          compareRunCharts: current.compareRunCharts?.map((existingChartCard) => {\n            if (existingChartCard.uuid === configuredCard.uuid) {\n              return { ...serializedCard, uuid: existingChartCard.uuid };\n            }\n            return existingChartCard;\n          }),\n        }));\n      }\n    },\n    [updateChartsUIState],\n  );\n};\n\nexport const useInsertRunsChartsFn = () => {\n  const updateChartsUIState = useUpdateRunsChartsUIConfiguration();\n  return useCallback(\n    (sourceChartUuid: string, targetSectionId: string) => {\n      updateChartsUIState((current) => {\n        const newChartsOrder = current.compareRunCharts?.slice();\n        const newSectionsState = current.compareRunSections?.slice();\n        if (!newChartsOrder || !newSectionsState) {\n          return current;\n        }\n\n        const indexSource = newChartsOrder.findIndex((c) => c.uuid === sourceChartUuid);\n        if (indexSource < 0) {\n          return current;\n        }\n        const sourceChart = newChartsOrder[indexSource];\n        // Set new chart metric group\n        const newSourceChart = { ...sourceChart };\n        newSourceChart.metricSectionId = targetSectionId;\n\n        // Update the sections to indicate that the charts have been reordered\n        const sourceSectionIdx = newSectionsState.findIndex((c) => c.uuid === sourceChart.metricSectionId);\n        const targetSectionIdx = newSectionsState.findIndex((c) => c.uuid === targetSectionId);\n        newSectionsState.splice(sourceSectionIdx, 1, { ...newSectionsState[sourceSectionIdx], isReordered: true });\n        newSectionsState.splice(targetSectionIdx, 1, { ...newSectionsState[targetSectionIdx], isReordered: true });\n\n        // Remove the source graph from array and append\n        newChartsOrder.splice(indexSource, 1);\n        newChartsOrder.push(newSourceChart);\n\n        return {\n          ...current,\n          compareRunCharts: newChartsOrder,\n          compareRunSections: newSectionsState,\n        };\n      });\n    },\n    [updateChartsUIState],\n  );\n};\n\nexport const useRemoveRunsChartFn = () => {\n  const updateChartsUIState = useUpdateRunsChartsUIConfiguration();\n\n  return useCallback(\n    (configToDelete: RunsChartsCardConfig) => {\n      updateChartsUIState((current) => ({\n        ...current,\n        compareRunCharts: configToDelete.isGenerated\n          ? current.compareRunCharts?.map((setup) =>\n              setup.uuid === configToDelete.uuid ? { ...setup, deleted: true } : setup,\n            )\n          : current.compareRunCharts?.filter((setup) => setup.uuid !== configToDelete.uuid),\n      }));\n    },\n    [updateChartsUIState],\n  );\n};\n","import { useDesignSystemTheme } from '@databricks/design-system';\nimport type { Config, Data, Layout } from 'plotly.js';\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { useIntl } from 'react-intl';\nimport { LazyPlot } from '../../LazyPlot';\nimport { useMutableChartHoverCallback } from '../hooks/useMutableHoverCallback';\nimport { highlightBarTraces, useRenderRunsChartTraceHighlight } from '../hooks/useRunsChartTraceHighlight';\nimport type { RunsChartsRunData, RunsPlotsCommonProps } from './RunsCharts.common';\nimport {\n  commonRunsChartStyles,\n  runsChartDefaultMargin,\n  runsChartHoverlabel,\n  createThemedPlotlyLayout,\n  normalizeChartValue,\n  useDynamicPlotSize,\n  getLegendDataFromRuns,\n} from './RunsCharts.common';\nimport type { MetricEntity } from '../../../types';\nimport RunsMetricsLegendWrapper from './RunsMetricsLegendWrapper';\nimport { createChartImageDownloadHandler } from '../hooks/useChartImageDownloadHandler';\nimport { customMetricBehaviorDefs } from '../../experiment-page/utils/customMetricBehaviorUtils';\nimport { RunsChartCardLoadingPlaceholder } from './cards/ChartCard.common';\n\n// We're not using params in bar plot\nexport type BarPlotRunData = Omit<RunsChartsRunData, 'params' | 'tags' | 'images'>;\n\nexport interface RunsMetricsBarPlotHoverData {\n  xValue: string;\n  yValue: number;\n  index: number;\n  metricEntity?: MetricEntity;\n}\n\nexport interface RunsMetricsBarPlotProps extends RunsPlotsCommonProps {\n  /**\n   * Determines which metric are we comparing by\n   */\n  metricKey: string;\n\n  /**\n   * Array of runs data with corresponding values\n   */\n  runsData: BarPlotRunData[];\n\n  /**\n   * Relative width of the plot bar\n   */\n  barWidth?: number;\n\n  /**\n   * Display run names on the Y axis\n   */\n  displayRunNames?: boolean;\n\n  /**\n   * Display metric key on the X axis\n   */\n  displayMetricKey?: boolean;\n}\n\nconst PLOT_CONFIG: Partial<Config> = {\n  displaylogo: false,\n  scrollZoom: false,\n  doubleClick: 'autosize',\n  showTips: false,\n  modeBarButtonsToRemove: ['toImage'],\n};\n\nconst Y_AXIS_PARAMS = {\n  ticklabelposition: 'inside',\n  tickfont: { size: 11 },\n  fixedrange: true,\n};\n\nconst getFixedPointValue = (val: string | number, places = 2) => (typeof val === 'number' ? val.toFixed(places) : val);\n\n/**\n * Implementation of plotly.js chart displaying\n * bar plot comparing metrics for a given\n * set of experiments runs\n */\nexport const RunsMetricsBarPlot = React.memo(\n  ({\n    runsData,\n    metricKey,\n    className,\n    margin = runsChartDefaultMargin,\n    onUpdate,\n    onHover,\n    onUnhover,\n    barWidth = 3 / 4,\n    width,\n    height,\n    displayRunNames = true,\n    useDefaultHoverBox = true,\n    displayMetricKey = true,\n    selectedRunUuid,\n    onSetDownloadHandler,\n  }: RunsMetricsBarPlotProps) => {\n    const plotData = useMemo(() => {\n      // Run uuids\n      const ids = runsData.map((d) => d.uuid);\n\n      // Trace names\n      const names = runsData.map(({ displayName }) => displayName);\n\n      // Actual metric values\n      const values = runsData.map((d) => normalizeChartValue(d.metrics[metricKey]?.value));\n\n      // Displayed metric values\n      const textValues = runsData.map((d) => {\n        const customMetricBehaviorDef = customMetricBehaviorDefs[metricKey];\n        if (customMetricBehaviorDef) {\n          return customMetricBehaviorDef.valueFormatter({ value: d.metrics[metricKey]?.value });\n        }\n\n        return getFixedPointValue(d.metrics[metricKey]?.value);\n      });\n\n      // Colors corresponding to each run\n      const colors = runsData.map((d) => d.color);\n\n      return [\n        {\n          y: ids,\n          x: values,\n          names,\n          text: textValues,\n          textposition: values.map((value) => (value === 0 ? 'outside' : 'auto')),\n          textfont: {\n            size: 11,\n          },\n          metrics: runsData.map((d) => d.metrics[metricKey]),\n          // Display run name on hover. \"<extra></extra>\" removes plotly's \"extra\" tooltip that\n          // is unnecessary here.\n          type: 'bar' as any,\n          hovertemplate: useDefaultHoverBox ? '%{label}<extra></extra>' : undefined,\n          hoverinfo: useDefaultHoverBox ? 'y' : 'none',\n          hoverlabel: useDefaultHoverBox ? runsChartHoverlabel : undefined,\n          width: barWidth,\n\n          orientation: 'h',\n          marker: {\n            color: colors,\n          },\n        } as Data & { names: string[] },\n      ];\n    }, [runsData, metricKey, barWidth, useDefaultHoverBox]);\n\n    const { layoutHeight, layoutWidth, setContainerDiv, containerDiv, isDynamicSizeSupported } = useDynamicPlotSize();\n\n    const { formatMessage } = useIntl();\n    const { theme } = useDesignSystemTheme();\n    const plotlyThemedLayout = useMemo(() => createThemedPlotlyLayout(theme), [theme]);\n\n    const [layout, setLayout] = useState<Partial<Layout>>({\n      width: width || layoutWidth,\n      height: height || layoutHeight,\n      hovermode: 'y',\n      margin,\n      xaxis: {\n        title: displayMetricKey ? metricKey : undefined,\n        tickfont: { size: 11, color: theme.colors.textSecondary },\n        tickformat: customMetricBehaviorDefs[metricKey]?.chartAxisTickFormat ?? undefined,\n      },\n      yaxis: {\n        showticklabels: displayRunNames,\n        title: displayRunNames\n          ? formatMessage({\n              defaultMessage: 'Run name',\n              description: 'Label for Y axis in bar chart when comparing metrics between runs',\n            })\n          : undefined,\n        tickfont: { size: 11, color: theme.colors.textSecondary },\n        fixedrange: true,\n      },\n      template: { layout: plotlyThemedLayout },\n    });\n\n    useEffect(() => {\n      setLayout((current) => ({\n        ...current,\n        width: width || layoutWidth,\n        height: height || layoutHeight,\n        margin,\n        xaxis: {\n          ...current.xaxis,\n          title: displayMetricKey ? metricKey : undefined,\n        },\n      }));\n    }, [layoutWidth, layoutHeight, margin, metricKey, width, height, displayMetricKey]);\n\n    const { setHoveredPointIndex } = useRenderRunsChartTraceHighlight(\n      containerDiv,\n      selectedRunUuid,\n      runsData,\n      highlightBarTraces,\n    );\n\n    const hoverCallback = useCallback(\n      ({ points, event }) => {\n        const metricEntity = points[0].data?.metrics[points[0].pointIndex];\n        setHoveredPointIndex(points[0]?.pointIndex ?? -1);\n\n        const hoverData: RunsMetricsBarPlotHoverData = {\n          xValue: points[0].x,\n          yValue: points[0].value,\n          // The index of the X datum\n          index: points[0].pointIndex,\n          metricEntity,\n        };\n\n        const runUuid = points[0]?.label;\n        if (runUuid) {\n          onHover?.(runUuid, event, hoverData);\n        }\n      },\n      [onHover, setHoveredPointIndex],\n    );\n\n    const unhoverCallback = useCallback(() => {\n      onUnhover?.();\n      setHoveredPointIndex(-1);\n    }, [onUnhover, setHoveredPointIndex]);\n\n    /**\n     * Unfortunately plotly.js memorizes first onHover callback given on initial render,\n     * so in order to achieve updated behavior we need to wrap its most recent implementation\n     * in the immutable callback.\n     */\n    const mutableHoverCallback = useMutableChartHoverCallback(hoverCallback);\n\n    const legendLabelData = useMemo(() => getLegendDataFromRuns(runsData), [runsData]);\n\n    useEffect(() => {\n      // Prepare layout and data traces to export\n      const layoutToExport = {\n        ...layout,\n        yaxis: {\n          ...layout.yaxis,\n          showticklabels: true,\n          automargin: true,\n        },\n      };\n\n      const dataToExport = plotData.map((trace) => ({\n        ...trace,\n        // In exported image, use names for Y axes\n        y: trace.names,\n      }));\n      onSetDownloadHandler?.(createChartImageDownloadHandler(dataToExport, layoutToExport));\n    }, [layout, onSetDownloadHandler, plotData]);\n\n    const chart = (\n      <div\n        css={[commonRunsChartStyles.chartWrapper(theme), styles.highlightStyles]}\n        className={className}\n        ref={setContainerDiv}\n      >\n        <LazyPlot\n          data={plotData}\n          useResizeHandler={!isDynamicSizeSupported}\n          css={commonRunsChartStyles.chart(theme)}\n          onUpdate={onUpdate}\n          layout={layout}\n          config={PLOT_CONFIG}\n          onHover={mutableHoverCallback}\n          onUnhover={unhoverCallback}\n          fallback={<RunsChartCardLoadingPlaceholder />}\n        />\n      </div>\n    );\n\n    return <RunsMetricsLegendWrapper labelData={legendLabelData}>{chart}</RunsMetricsLegendWrapper>;\n  },\n);\n\nconst styles = {\n  highlightStyles: {\n    '.trace.bars g.point path': {\n      transition: 'var(--trace-transition)',\n    },\n    '.trace.bars.is-highlight g.point path': {\n      opacity: 'var(--trace-opacity-dimmed-high) !important',\n    },\n    '.trace.bars g.point.is-hover-highlight path': {\n      opacity: 'var(--trace-opacity-highlighted) !important',\n    },\n    '.trace.bars g.point.is-selection-highlight path': {\n      opacity: 'var(--trace-opacity-highlighted) !important',\n      stroke: 'var(--trace-stroke-color)',\n      strokeWidth: 'var(--trace-stroke-width) !important',\n    },\n  },\n};\n","import { useDesignSystemTheme } from '@databricks/design-system';\nimport type { Data, Datum, Layout, PlotMouseEvent } from 'plotly.js';\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { LazyPlot } from '../../LazyPlot';\nimport { useMutableChartHoverCallback } from '../hooks/useMutableHoverCallback';\nimport { highlightScatterTraces, useRenderRunsChartTraceHighlight } from '../hooks/useRunsChartTraceHighlight';\nimport type { RunsChartsRunData, RunsChartAxisDef, RunsPlotsCommonProps } from './RunsCharts.common';\nimport {\n  commonRunsChartStyles,\n  runsChartDefaultContourMargin,\n  runsChartHoverlabel,\n  createThemedPlotlyLayout,\n  useDynamicPlotSize,\n  getLegendDataFromRuns,\n} from './RunsCharts.common';\nimport RunsMetricsLegendWrapper from './RunsMetricsLegendWrapper';\nimport { createChartImageDownloadHandler } from '../hooks/useChartImageDownloadHandler';\nimport { RunsChartCardLoadingPlaceholder } from './cards/ChartCard.common';\n\nexport interface RunsContourPlotProps extends RunsPlotsCommonProps {\n  /**\n   * Horizontal axis with a metric or a param\n   */\n  xAxis: RunsChartAxisDef;\n\n  /**\n   * Vertical axis with a metric or a param\n   */\n  yAxis: RunsChartAxisDef;\n\n  /**\n   * Depth dimension with a metric or a param\n   */\n  zAxis: RunsChartAxisDef;\n\n  /**\n   * Array of runs data with corresponding values\n   */\n  runsData: RunsChartsRunData[];\n\n  /**\n   * Sets the color scale in [[0.35, 'rgb(40,60,190)'],[0.5, 'rgb(70,100,245)'],...] format.\n   * Leave unset to use the defualt scale.\n   */\n  colorScale?: [number, string][];\n\n  /**\n   * Set to `true` in order to reverse the color scale.\n   */\n  reverseScale?: boolean;\n}\n\nconst PLOT_CONFIG = {\n  displaylogo: false,\n  scrollZoom: false,\n  modeBarButtonsToRemove: ['toImage'],\n};\n\nconst DEFAULT_COLOR_SCALE: [number, string][] = [\n  [0, 'rgb(5,10,172)'],\n  [0.35, 'rgb(40,60,190)'],\n  [0.5, 'rgb(70,100,245)'],\n  [0.6, 'rgb(90,120,245)'],\n  [0.7, 'rgb(106,137,247)'],\n  [1, 'rgb(220,220,220)'],\n];\n\nconst createTooltipTemplate = (zAxisTitle: string) =>\n  '<b>%{customdata[1]}:</b><br>' +\n  '<b>%{xaxis.title.text}:</b> %{x:.2f}<br>' +\n  '<b>%{yaxis.title.text}:</b> %{y:.2f}<br>' +\n  `<b>${zAxisTitle}:</b> %{customdata[2]:.2f}` +\n  '<extra></extra>';\n\n/**\n * Implementation of plotly.js chart displaying\n * contour plot comparing values for a given\n * set of experiments runs\n */\nexport const RunsContourPlot = React.memo(\n  ({\n    runsData,\n    xAxis,\n    yAxis,\n    zAxis,\n    markerSize = 10,\n    className,\n    reverseScale,\n    margin = runsChartDefaultContourMargin,\n    colorScale = DEFAULT_COLOR_SCALE,\n    onUpdate,\n    onHover,\n    onUnhover,\n    width,\n    height,\n    useDefaultHoverBox = true,\n    selectedRunUuid,\n    onSetDownloadHandler,\n  }: RunsContourPlotProps) => {\n    const { theme } = useDesignSystemTheme();\n\n    const { layoutHeight, layoutWidth, setContainerDiv, containerDiv, isDynamicSizeSupported } = useDynamicPlotSize();\n\n    const plotData = useMemo(() => {\n      // Prepare empty values\n      const xValues: (number | string)[] = [];\n      const yValues: (number | string)[] = [];\n      const zValues: (number | string)[] = [];\n      const colors: (number | string)[] = [];\n      const tooltipData: Datum[] = [];\n\n      // Iterate through all the runs and aggregate selected metrics/params\n      for (const runData of runsData) {\n        const { metrics, params, color, uuid, displayName } = runData;\n        const xAxisData = xAxis.type === 'METRIC' ? metrics : params;\n        const yAxisData = yAxis.type === 'METRIC' ? metrics : params;\n        const zAxisData = zAxis.type === 'METRIC' ? metrics : params;\n\n        const x = xAxisData?.[xAxis.key]?.value || undefined;\n        const y = yAxisData?.[yAxis.key]?.value || undefined;\n        const z = zAxisData?.[zAxis.key]?.value || undefined;\n\n        if (x && y && z) {\n          xValues.push(x);\n          yValues.push(y);\n          zValues.push(z);\n          colors.push(color || theme.colors.primary);\n          tooltipData.push([uuid, displayName || uuid, z] as any);\n        }\n      }\n\n      // Let's compile chart layers\n      const layers = [\n        // The top layer with the scatter plot (dots)\n        {\n          x: xValues,\n          y: yValues,\n          customdata: tooltipData,\n          text: runsData.map(({ displayName }) => displayName),\n          hovertemplate: useDefaultHoverBox ? createTooltipTemplate(zAxis.key) : undefined,\n          hoverinfo: useDefaultHoverBox ? undefined : 'none',\n          hoverlabel: useDefaultHoverBox ? runsChartHoverlabel : undefined,\n          type: 'scatter',\n          mode: 'markers',\n          textposition: 'bottom center',\n          marker: {\n            size: markerSize,\n            color: colors,\n            line: {\n              color: 'black',\n              width: 1,\n            },\n          },\n        },\n      ] as Data[];\n\n      // If there are at least two runs, add a contour chart layer\n      if (runsData.length > 1) {\n        layers.unshift({\n          x: xValues,\n          y: yValues,\n          z: zValues,\n          type: 'contour',\n          connectgaps: true,\n          hoverinfo: 'none',\n          contours: {\n            coloring: 'heatmap',\n          },\n          colorscale: colorScale,\n          reversescale: reverseScale,\n          colorbar: {\n            tickfont: { size: 11, color: theme.colors.textSecondary, family: '' },\n          },\n        } as Data);\n      }\n      return layers;\n    }, [\n      colorScale,\n      reverseScale,\n      markerSize,\n      runsData,\n      xAxis.type,\n      xAxis.key,\n      yAxis.type,\n      yAxis.key,\n      zAxis.type,\n      zAxis.key,\n      theme.colors.primary,\n      theme.colors.textSecondary,\n      useDefaultHoverBox,\n    ]);\n\n    const plotlyThemedLayout = useMemo(() => createThemedPlotlyLayout(theme), [theme]);\n\n    const [layout, setLayout] = useState<Partial<Layout>>({\n      width: width || layoutWidth,\n      height: height || layoutHeight,\n      margin,\n      xaxis: { title: xAxis.key, tickfont: { size: 11, color: theme.colors.textSecondary } },\n      yaxis: {\n        ticks: 'inside',\n        title: { standoff: 32, text: yAxis.key },\n        tickfont: { size: 11, color: theme.colors.textSecondary },\n      },\n      template: { layout: plotlyThemedLayout },\n    });\n\n    useEffect(() => {\n      setLayout((current) => {\n        const newLayout = {\n          ...current,\n          width: width || layoutWidth,\n          height: height || layoutHeight,\n          margin,\n        };\n\n        if (newLayout.xaxis) {\n          newLayout.xaxis.title = xAxis.key;\n        }\n\n        if (newLayout.yaxis) {\n          newLayout.yaxis.title = { standoff: 32, text: yAxis.key };\n        }\n\n        return newLayout;\n      });\n    }, [layoutWidth, layoutHeight, margin, xAxis.key, yAxis.key, width, height]);\n\n    const { setHoveredPointIndex } = useRenderRunsChartTraceHighlight(\n      containerDiv,\n      selectedRunUuid,\n      runsData,\n      highlightScatterTraces,\n    );\n\n    const hoverCallback = useCallback(\n      ({ points }: PlotMouseEvent) => {\n        // Find hover event corresponding to the second curve (scatter plot) only\n        const scatterPoints = points.find(({ curveNumber }) => curveNumber === 1);\n\n        setHoveredPointIndex(scatterPoints?.pointIndex ?? -1);\n\n        if (!scatterPoints) {\n          return;\n        }\n\n        // Find the corresponding run UUID by basing on \"customdata\" field set in the trace data.\n        // Plotly TS typings don't support custom fields so we need to cast to \"any\" first\n        const pointCustomDataRunUuid = (scatterPoints as any)?.customdata?.[0];\n        if (pointCustomDataRunUuid) {\n          onHover?.(pointCustomDataRunUuid);\n        }\n      },\n      [onHover, setHoveredPointIndex],\n    );\n\n    const unhoverCallback = useCallback(() => {\n      onUnhover?.();\n      setHoveredPointIndex(-1);\n    }, [onUnhover, setHoveredPointIndex]);\n\n    /**\n     * Unfortunately plotly.js memorizes first onHover callback given on initial render,\n     * so in order to achieve updated behavior we need to wrap its most recent implementation\n     * in the immutable callback.\n     */\n    const mutableHoverCallback = useMutableChartHoverCallback(hoverCallback);\n\n    const legendLabelData = useMemo(() => getLegendDataFromRuns(runsData), [runsData]);\n\n    useEffect(() => {\n      const dataToExport: Data[] = plotData.map((trace: Data) => ({\n        ...trace,\n        mode: 'text+markers',\n      }));\n      onSetDownloadHandler?.(createChartImageDownloadHandler(dataToExport, layout));\n    }, [layout, onSetDownloadHandler, plotData]);\n\n    const chart = (\n      <div\n        css={[commonRunsChartStyles.chartWrapper(theme), commonRunsChartStyles.scatterChartHighlightStyles]}\n        className={className}\n        ref={setContainerDiv}\n      >\n        <LazyPlot\n          data={plotData}\n          useResizeHandler={!isDynamicSizeSupported}\n          css={commonRunsChartStyles.chart(theme)}\n          onUpdate={onUpdate}\n          layout={layout}\n          config={PLOT_CONFIG}\n          onHover={mutableHoverCallback}\n          onUnhover={unhoverCallback}\n          fallback={<RunsChartCardLoadingPlaceholder />}\n        />\n      </div>\n    );\n\n    return <RunsMetricsLegendWrapper labelData={legendLabelData}>{chart}</RunsMetricsLegendWrapper>;\n  },\n);\n","/* eslint-disable react-hooks/rules-of-hooks */\nimport { createContext, useCallback, useContext, useMemo, useRef, useState } from 'react';\nimport type { RunsChartsCardConfig } from '../runs-charts.types';\nimport { DragAndDropProvider } from '../../../../common/hooks/useDragAndDropElement';\nimport { useUpdateRunsChartsUIConfiguration } from '../hooks/useRunsChartsUIConfiguration';\nimport { indexOf, sortBy } from 'lodash';\n\nconst RunsChartsDraggableGridStateContext = createContext<{\n  draggedCardUuid: string | null;\n  targetSection: string | null;\n  isDragging: () => boolean;\n}>({\n  draggedCardUuid: '',\n  targetSection: '',\n  isDragging: () => false,\n});\n\nconst RunsChartsDraggableGridActionsContext = createContext<{\n  setDraggedCardUuid: (cardUuid: string | null) => void;\n  setTargetSection: (targetSectionUuid: string | null) => void;\n  setTargetPosition: (pos: number) => void;\n  onDropChartCard: () => void;\n  onSwapCards: (sourceUuid: string, targetUuid: string) => void;\n}>({\n  setDraggedCardUuid: () => {},\n  setTargetSection: () => {},\n  setTargetPosition: () => {},\n  onDropChartCard: () => {},\n  onSwapCards: () => {},\n});\n\nexport const useRunsChartsDraggableGridStateContext = () => useContext(RunsChartsDraggableGridStateContext);\nexport const useRunsChartsDraggableGridActionsContext = () => useContext(RunsChartsDraggableGridActionsContext);\n\nexport const RunsChartsDraggableCardsGridContextProvider = ({\n  children,\n  visibleChartCards = [],\n}: {\n  children?: React.ReactNode;\n  visibleChartCards?: RunsChartsCardConfig[];\n}) => {\n  // Stateful values: dragged card ID and target section ID\n  const [draggedCardUuid, setDraggedCardUuid] = useState<string | null>(null);\n  const [targetSectionUuid, setTargetSectionUuid] = useState<string | null>(null);\n\n  // Use refs for direct access to the values\n  const immediateDraggedCardUuid = useRef<string | null>(null);\n  const immediateTargetSectionId = useRef<string | null>(null);\n  immediateDraggedCardUuid.current = draggedCardUuid;\n  immediateTargetSectionId.current = targetSectionUuid;\n\n  // Mutable field: target position (index) in the target section\n  const targetLocalPosition = useRef<number | null>(null);\n\n  const setTargetPosition = useCallback((pos: number) => {\n    targetLocalPosition.current = pos;\n  }, []);\n\n  const isDragging = useCallback(() => immediateDraggedCardUuid.current !== null, []);\n\n  const updateChartsUIState = useUpdateRunsChartsUIConfiguration();\n\n  // Callback for simple card swapping (Move up/move down functionality)\n  const onSwapCards = useCallback(\n    (sourceChartUuid: string, targetChartUuid: string) => {\n      updateChartsUIState((current) => {\n        const newChartsOrder = current.compareRunCharts?.slice();\n\n        if (!newChartsOrder) {\n          return current;\n        }\n\n        const indexSource = newChartsOrder.findIndex((c) => c.uuid === sourceChartUuid);\n        const indexTarget = newChartsOrder.findIndex((c) => c.uuid === targetChartUuid);\n\n        // If one of the charts is not found, do nothing\n        if (indexSource < 0 || indexTarget < 0) {\n          return current;\n        }\n\n        const sourceChart = newChartsOrder[indexSource];\n\n        // Remove the chart and insert it at the target position\n        newChartsOrder.splice(indexSource, 1);\n        newChartsOrder.splice(indexTarget, 0, sourceChart);\n\n        return { ...current, compareRunCharts: newChartsOrder };\n      });\n    },\n    [updateChartsUIState],\n  );\n\n  // Callback invoked when a card is dropped\n  const onDropChartCard = useCallback(() => {\n    const draggedChartUuid = immediateDraggedCardUuid.current;\n    const targetSectionId = immediateTargetSectionId.current;\n    const targetPosition = targetLocalPosition.current;\n\n    if (draggedChartUuid === null || targetSectionId === null || targetPosition === null) {\n      return;\n    }\n\n    setDraggedCardUuid(null);\n\n    updateChartsUIState((current) => {\n      // Find the source card and section in the current state\n      const sourceCard = current.compareRunCharts?.find((chart) => chart.uuid === draggedChartUuid);\n      if (!sourceCard) {\n        return current;\n      }\n\n      const sourceSection = current.compareRunSections?.find((section) => section.uuid === sourceCard?.metricSectionId);\n\n      // Find the target section in the current state\n      const targetSection = current.compareRunSections?.find((section) => section.uuid === targetSectionId);\n\n      // Get all the cards in the source section\n      const sourceSectionCards = current.compareRunCharts?.filter(\n        (chartCard) => chartCard.metricSectionId === sourceSection?.uuid,\n      );\n\n      // If we're moving the card within the same section\n      if (sourceSection === targetSection) {\n        // Copy the resulting chart list\n        const resultChartsList = current.compareRunCharts?.slice();\n\n        // Get all the currently visible cards (excluding hidden and deleted cards)\n        const visibleSectionCards = sourceSectionCards?.filter((chartCard) => visibleChartCards.includes(chartCard));\n\n        if (!resultChartsList || !visibleSectionCards) {\n          return current;\n        }\n\n        // Find the original position\n        const originalIndex = resultChartsList.findIndex((chartCard) => chartCard.uuid === draggedChartUuid);\n\n        // Clamp the target position index to the visible section cards\n        const clampedLocalPosition = Math.min(targetPosition, visibleSectionCards.length - 1);\n\n        // Map from the index in the section to a global index\n        const targetIndex = indexOf(resultChartsList, visibleSectionCards?.[clampedLocalPosition]);\n\n        // If we found the original index and the target index\n        if (resultChartsList && originalIndex !== -1 && targetIndex !== -1) {\n          // Remove the card from the original position\n          resultChartsList.splice(originalIndex, 1);\n          // Insert the card at the target position\n          resultChartsList.splice(targetIndex, 0, sourceCard);\n        }\n\n        return {\n          ...current,\n          compareRunCharts: resultChartsList,\n        };\n      } else {\n        // If we're moving card to a new section\n        const targetSectionCards = current.compareRunCharts?.filter(\n          (chart) => chart.metricSectionId === targetSectionId && !chart.deleted,\n        );\n\n        // Calculate the target position in the target section\n        if (targetSectionCards) {\n          targetSectionCards.splice(targetPosition, 0, sourceCard);\n        }\n\n        return {\n          ...current,\n          // Use the target position in the sorting function to determine the new position\n          compareRunCharts: sortBy(current.compareRunCharts, (a) => targetSectionCards?.indexOf(a) ?? -1).map(\n            (chart) => {\n              // Also, update the metricSectionId of the dragged card\n              if (chart.uuid === sourceCard.uuid) {\n                return {\n                  ...chart,\n                  metricSectionId: targetSectionId,\n                };\n              }\n              return chart;\n            },\n          ),\n          compareRunSections: current.compareRunSections?.map((section) => {\n            if (section.uuid === sourceSection?.uuid || section.uuid === targetSection?.uuid) {\n              return { ...section, isReordered: true };\n            }\n            return section;\n          }),\n        };\n      }\n    });\n  }, [updateChartsUIState, visibleChartCards]);\n\n  // For performance purposes, expose two different contexts:\n  // one for state (changing but rarely consumed) and one for actions (static but consumed often)\n  const stateContextValue = useMemo(\n    () => ({\n      draggedCardUuid,\n      targetSection: targetSectionUuid,\n      isDragging,\n    }),\n    [draggedCardUuid, targetSectionUuid, isDragging],\n  );\n\n  const actionsContextValue = useMemo(\n    () => ({\n      setDraggedCardUuid,\n      setTargetSection: setTargetSectionUuid,\n      setTargetPosition,\n      onDropChartCard,\n      onSwapCards,\n    }),\n    [onDropChartCard, onSwapCards, setTargetPosition],\n  );\n\n  return (\n    <DragAndDropProvider>\n      <RunsChartsDraggableGridStateContext.Provider value={stateContextValue}>\n        <RunsChartsDraggableGridActionsContext.Provider value={actionsContextValue}>\n          {children}\n        </RunsChartsDraggableGridActionsContext.Provider>\n      </RunsChartsDraggableGridStateContext.Provider>\n    </DragAndDropProvider>\n  );\n};\n","import { isNil } from 'lodash';\nimport {\n  Button,\n  CloseIcon,\n  PinIcon,\n  PinFillIcon,\n  LegacyTooltip,\n  VisibleIcon,\n  Typography,\n} from '@databricks/design-system';\nimport type { Theme } from '@emotion/react';\nimport { FormattedMessage } from 'react-intl';\nimport { Link } from '../../../../common/utils/RoutingUtils';\nimport Routes from '../../../routes';\nimport { useExperimentIds } from '../../experiment-page/hooks/useExperimentIds';\nimport type { RunsChartsRunData } from './RunsCharts.common';\nimport { RunsChartsLineChartXAxisType } from './RunsCharts.common';\nimport type { RunsChartsTooltipBodyProps } from '../hooks/useRunsChartsTooltip';\nimport { RunsChartsTooltipMode, containsMultipleRunsTooltipData } from '../hooks/useRunsChartsTooltip';\nimport type {\n  RunsChartsBarCardConfig,\n  RunsChartsCardConfig,\n  RunsChartsScatterCardConfig,\n  RunsChartsContourCardConfig,\n  RunsChartsLineCardConfig,\n  RunsChartsParallelCardConfig,\n} from '../runs-charts.types';\nimport { RunsChartType } from '../runs-charts.types';\nimport {\n  type RunsCompareMultipleTracesTooltipData,\n  type RunsMetricsSingleTraceTooltipData,\n} from './RunsMetricsLinePlot';\nimport { RunsMultipleTracesTooltipBody } from './RunsMultipleTracesTooltipBody';\nimport { shouldEnableRelativeTimeDateAxis } from '@mlflow/mlflow/src/common/utils/FeatureUtils';\nimport { customMetricBehaviorDefs } from '../../experiment-page/utils/customMetricBehaviorUtils';\n\ninterface RunsChartsContextMenuContentDataType {\n  runs: RunsChartsRunData[];\n  onTogglePin?: (runUuid: string) => void;\n  onHideRun?: (runUuid: string) => void;\n  getDataTraceLink?: (experimentId: string, traceUuid: string) => string;\n}\n\ntype RunsChartContextMenuHoverDataType = RunsChartsCardConfig;\n\nconst createBarChartValuesBox = (cardConfig: RunsChartsBarCardConfig, activeRun: RunsChartsRunData) => {\n  const { metricKey, dataAccessKey } = cardConfig;\n\n  const dataKey = dataAccessKey ?? metricKey;\n\n  const metric = activeRun?.metrics[dataKey];\n\n  if (!metric) {\n    return null;\n  }\n\n  const customMetricBehaviorDef = customMetricBehaviorDefs[metric.key];\n  const displayName = customMetricBehaviorDef?.displayName ?? metric.key;\n  const displayValue = customMetricBehaviorDef?.valueFormatter({ value: metric.value }) ?? metric.value;\n\n  return (\n    <div css={styles.value}>\n      <strong>{displayName}:</strong> {displayValue}\n    </div>\n  );\n};\n\nconst createScatterChartValuesBox = (cardConfig: RunsChartsScatterCardConfig, activeRun: RunsChartsRunData) => {\n  const { xaxis, yaxis } = cardConfig;\n  const xKey = xaxis.dataAccessKey ?? xaxis.key;\n  const yKey = xaxis.dataAccessKey ?? yaxis.key;\n\n  const xLabel = xaxis.key;\n  const yLabel = yaxis.key;\n\n  const xValue = xaxis.type === 'METRIC' ? activeRun.metrics[xKey]?.value : activeRun.params[xKey]?.value;\n\n  const yValue = yaxis.type === 'METRIC' ? activeRun.metrics[yKey]?.value : activeRun.params[yKey]?.value;\n\n  return (\n    <>\n      {xValue && (\n        <div css={styles.value}>\n          <strong>X ({xLabel}):</strong> {xValue}\n        </div>\n      )}\n      {yValue && (\n        <div css={styles.value}>\n          <strong>Y ({yLabel}):</strong> {yValue}\n        </div>\n      )}\n    </>\n  );\n};\n\nconst createContourChartValuesBox = (cardConfig: RunsChartsContourCardConfig, activeRun: RunsChartsRunData) => {\n  const { xaxis, yaxis, zaxis } = cardConfig;\n  const xKey = xaxis.key;\n  const yKey = yaxis.key;\n  const zKey = zaxis.key;\n\n  const xValue = xaxis.type === 'METRIC' ? activeRun.metrics[xKey]?.value : activeRun.params[xKey]?.value;\n\n  const yValue = yaxis.type === 'METRIC' ? activeRun.metrics[yKey]?.value : activeRun.params[yKey]?.value;\n\n  const zValue = zaxis.type === 'METRIC' ? activeRun.metrics[zKey]?.value : activeRun.params[zKey]?.value;\n\n  return (\n    <>\n      {xValue && (\n        <div css={styles.value}>\n          <strong>X ({xKey}):</strong> {xValue}\n        </div>\n      )}\n      {yValue && (\n        <div css={styles.value}>\n          <strong>Y ({yKey}):</strong> {yValue}\n        </div>\n      )}\n      {zValue && (\n        <div css={styles.value}>\n          <strong>Z ({zKey}):</strong> {zValue}\n        </div>\n      )}\n    </>\n  );\n};\n\nconst normalizeRelativeTimeChartTooltipValue = (value: string | number) => {\n  if (typeof value === 'number') {\n    return value;\n  }\n  return value.split(' ')[1] || '00:00:00';\n};\n\nconst getTooltipXValue = (\n  hoverData: RunsMetricsSingleTraceTooltipData | undefined,\n  xAxisKey: RunsChartsLineChartXAxisType,\n) => {\n  if (xAxisKey === RunsChartsLineChartXAxisType.METRIC) {\n    return hoverData?.xValue ?? '';\n  }\n\n  if (shouldEnableRelativeTimeDateAxis() && xAxisKey === RunsChartsLineChartXAxisType.TIME_RELATIVE) {\n    return normalizeRelativeTimeChartTooltipValue(hoverData?.xValue ?? '');\n  }\n\n  // Default return for other cases\n  return hoverData?.xValue;\n};\n\nconst createLineChartValuesBox = (\n  cardConfig: RunsChartsLineCardConfig,\n  activeRun: RunsChartsRunData,\n  hoverData?: RunsMetricsSingleTraceTooltipData,\n) => {\n  const { metricKey: metricKeyFromConfig, xAxisKey } = cardConfig;\n  const metricKey = hoverData?.metricEntity?.key || metricKeyFromConfig;\n\n  // If there's available value from x axis (step or time), extract entry from\n  // metric history instead of latest metric.\n  const metricValue = hoverData?.yValue ?? activeRun?.metrics[metricKey].value;\n\n  if (isNil(metricValue)) {\n    return null;\n  }\n\n  const xValue = getTooltipXValue(hoverData, xAxisKey);\n  return (\n    <>\n      {hoverData && (\n        <div css={styles.value}>\n          <strong>{hoverData.label}:</strong> {xValue}\n        </div>\n      )}\n      <div css={styles.value}>\n        <strong>{metricKey}:</strong> {metricValue}\n      </div>\n    </>\n  );\n};\n\nconst createParallelChartValuesBox = (\n  cardConfig: RunsChartsParallelCardConfig,\n  activeRun: RunsChartsRunData,\n  isHovering?: boolean,\n) => {\n  const { selectedParams, selectedMetrics } = cardConfig as RunsChartsParallelCardConfig;\n  const paramsList = selectedParams.map((paramKey) => {\n    const param = activeRun?.params[paramKey];\n    if (param) {\n      return (\n        <div key={paramKey}>\n          <strong>{param.key}:</strong> {param.value}\n        </div>\n      );\n    }\n    return true;\n  });\n  const metricsList = selectedMetrics.map((metricKey) => {\n    const metric = activeRun?.metrics[metricKey];\n    if (metric) {\n      return (\n        <div key={metricKey}>\n          <strong>{metric.key}:</strong> {metric.value}\n        </div>\n      );\n    }\n    return true;\n  });\n\n  // show only first 3 params and primary metric if hovering, else show all\n  if (isHovering) {\n    return (\n      <>\n        {paramsList.slice(0, 3)}\n        {(paramsList.length > 3 || metricsList.length > 1) && <div>...</div>}\n        {metricsList[metricsList.length - 1]}\n      </>\n    );\n  } else {\n    return (\n      <>\n        {paramsList}\n        {metricsList}\n      </>\n    );\n  }\n};\n\n/**\n * Internal component that displays metrics/params - its final design\n * is a subject to change\n */\nconst ValuesBox = ({\n  activeRun,\n  cardConfig,\n  isHovering,\n  hoverData,\n}: {\n  activeRun: RunsChartsRunData;\n  cardConfig: RunsChartsCardConfig;\n  isHovering?: boolean;\n  hoverData?: RunsMetricsSingleTraceTooltipData;\n}) => {\n  if (cardConfig.type === RunsChartType.BAR) {\n    return createBarChartValuesBox(cardConfig as RunsChartsBarCardConfig, activeRun);\n  }\n\n  if (cardConfig.type === RunsChartType.SCATTER) {\n    return createScatterChartValuesBox(cardConfig as RunsChartsScatterCardConfig, activeRun);\n  }\n\n  if (cardConfig.type === RunsChartType.CONTOUR) {\n    return createContourChartValuesBox(cardConfig as RunsChartsContourCardConfig, activeRun);\n  }\n\n  if (cardConfig.type === RunsChartType.LINE) {\n    return createLineChartValuesBox(cardConfig as RunsChartsLineCardConfig, activeRun, hoverData);\n  }\n\n  if (cardConfig.type === RunsChartType.PARALLEL) {\n    return createParallelChartValuesBox(cardConfig as RunsChartsParallelCardConfig, activeRun, isHovering);\n  }\n\n  return null;\n};\n\nexport const RunsChartsTooltipBody = ({\n  closeContextMenu,\n  contextData,\n  hoverData,\n  chartData,\n  runUuid,\n  isHovering,\n  mode,\n}: RunsChartsTooltipBodyProps<\n  RunsChartsContextMenuContentDataType,\n  RunsChartContextMenuHoverDataType,\n  RunsMetricsSingleTraceTooltipData | RunsCompareMultipleTracesTooltipData\n>) => {\n  const { runs, onTogglePin, onHideRun, getDataTraceLink } = contextData;\n  const [experimentId] = useExperimentIds();\n  const activeRun = runs?.find((run) => run.uuid === runUuid);\n\n  if (\n    containsMultipleRunsTooltipData(hoverData) &&\n    mode === RunsChartsTooltipMode.MultipleTracesWithScanline &&\n    isHovering\n  ) {\n    return <RunsMultipleTracesTooltipBody hoverData={hoverData} />;\n  }\n\n  const singleTraceHoverData = containsMultipleRunsTooltipData(hoverData) ? hoverData.hoveredDataPoint : hoverData;\n\n  if (!activeRun) {\n    return null;\n  }\n\n  const runName = activeRun.displayName || activeRun.uuid;\n  const metricSuffix = singleTraceHoverData?.metricEntity ? ` (${singleTraceHoverData.metricEntity.key})` : '';\n\n  return (\n    <div>\n      <div css={styles.contentWrapper}>\n        <div css={styles.header}>\n          <div css={styles.colorPill} style={{ backgroundColor: activeRun.color }} />\n          {activeRun.groupParentInfo ? (\n            <Typography.Text>{runName + metricSuffix}</Typography.Text>\n          ) : (\n            <Link\n              to={getDataTraceLink?.(experimentId, runUuid) ?? Routes.getRunPageRoute(experimentId, runUuid)}\n              target=\"_blank\"\n              css={styles.runLink}\n              onClick={closeContextMenu}\n            >\n              {runName + metricSuffix}\n            </Link>\n          )}\n        </div>\n        {!isHovering && (\n          <Button\n            componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-compare_runscomparetooltipbody.tsx_259\"\n            size=\"small\"\n            onClick={closeContextMenu}\n            icon={<CloseIcon />}\n          />\n        )}\n      </div>\n\n      <ValuesBox\n        isHovering={isHovering}\n        activeRun={activeRun}\n        cardConfig={chartData}\n        hoverData={singleTraceHoverData}\n      />\n\n      <div css={styles.actionsWrapper}>\n        {activeRun.pinnable && onTogglePin && (\n          <LegacyTooltip\n            title={\n              activeRun.pinned ? (\n                <FormattedMessage\n                  defaultMessage=\"Unpin run\"\n                  description=\"A tooltip for the pin icon button in the runs table next to the pinned run\"\n                />\n              ) : (\n                <FormattedMessage\n                  defaultMessage=\"Click to pin the run\"\n                  description=\"A tooltip for the pin icon button in the runs chart tooltip next to the not pinned run\"\n                />\n              )\n            }\n            placement=\"bottom\"\n          >\n            <Button\n              componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-compare_runscomparetooltipbody.tsx_282\"\n              size=\"small\"\n              onClick={() => {\n                onTogglePin(runUuid);\n                closeContextMenu();\n              }}\n              icon={activeRun.pinned ? <PinFillIcon /> : <PinIcon />}\n            />\n          </LegacyTooltip>\n        )}\n        {onHideRun && (\n          <LegacyTooltip\n            title={\n              <FormattedMessage\n                defaultMessage=\"Click to hide the run\"\n                description='A tooltip for the \"hide\" icon button in the runs chart tooltip'\n              />\n            }\n            placement=\"bottom\"\n          >\n            <Button\n              componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-compare_runscomparetooltipbody.tsx_302\"\n              data-testid=\"experiment-view-compare-runs-tooltip-visibility-button\"\n              size=\"small\"\n              onClick={() => {\n                onHideRun(runUuid);\n                closeContextMenu();\n              }}\n              icon={<VisibleIcon />}\n            />\n          </LegacyTooltip>\n        )}\n      </div>\n    </div>\n  );\n};\n\nconst styles = {\n  runLink: (theme: Theme) => ({\n    color: theme.colors.primary,\n    '&:hover': {},\n  }),\n  actionsWrapper: {\n    marginTop: 8,\n    display: 'flex',\n    gap: 8,\n    alignItems: 'center',\n  },\n  header: {\n    display: 'flex',\n    gap: 8,\n    alignItems: 'center',\n  },\n  value: {\n    whiteSpace: 'nowrap' as const,\n    overflow: 'hidden',\n    textOverflow: 'ellipsis',\n  },\n  contentWrapper: {\n    display: 'flex',\n    gap: 8,\n    alignItems: 'center',\n    marginBottom: 12,\n    justifyContent: 'space-between',\n    height: 24,\n  },\n  colorPill: { width: 12, height: 12, borderRadius: '100%' },\n};\n","var _path, _path2;\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nimport * as React from \"react\";\nfunction SvgChartLine({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 22,\n    height: 22,\n    viewBox: \"0 0 22 22\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M4.38977 15.717L8.79655 10.8113L12.5254 14.9622L19.644 7.03772\",\n    stroke: \"#338ECC\",\n    strokeWidth: 2,\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\"\n  })), _path2 || (_path2 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M1 1V21H21\",\n    stroke: \"#A3AEB8\",\n    strokeLinecap: \"round\"\n  })));\n}\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgChartLine);\nexport default __webpack_public_path__ + \"static/media/chart-line.0adaa2036bb4eb5956db6d0c7e925a3d.svg\";\nexport { ForwardRef as ReactComponent };","import { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport type { Figure } from 'react-plotly.js';\nimport type {\n  LineChartTraceData,\n  RunsCompareMultipleTracesTooltipData,\n  RunsMetricsLinePlotProps,\n  RunsMetricsSingleTraceTooltipData,\n} from '../components/RunsMetricsLinePlot';\nimport { compact, isNumber, isString, isUndefined, orderBy, throttle, uniq } from 'lodash';\nimport type { LegendLabelData } from '../components/RunsMetricsLegend';\nimport type { RunsChartsLineChartXAxisType } from '../components/RunsCharts.common';\n\n// Plotly-specific selectors for finding particular elements of interest in the plot DOM structure\nconst PLOTLY_SVG_SELECTOR = '.main-svg';\nconst PLOTLY_DRAGLAYER_SELECTOR = '.main-svg .draglayer .nsewdrag';\n\n// Interval for throttling the tooltip data update handler\nconst TOOLTIP_DATA_UPDATE_INTERVAL = 50;\n\n/**\n * Utility function, parses the microseconds from the plotly's axis boundary string\n * which are not supported by JavaScript's Date object and have to be added manually.\n *\n * E.g. transforms 2024-02-02 14:35:37.5747 into 0.7\n */\nconst parseMicroseconds = (plotlyAxisBoundary: string) => {\n  const microsecondsString =\n    isString(plotlyAxisBoundary) && plotlyAxisBoundary.match(/[0-9]{2}:[0-9]{2}:[0-9]{2}\\.([0-9]+)/)?.[1];\n  if (!microsecondsString) {\n    return 0;\n  }\n\n  // We turn the microseconds into a fraction of a millisecond, e.g. 0.5743 -> 574.3 -> 0.3\n  return (Number(`0.${microsecondsString}`) * 1000) % 1;\n};\n\nexport const useRunsMultipleTracesTooltipData = ({\n  onUnhover,\n  onHover,\n  runsData,\n  plotData,\n  legendLabelData,\n  containsMultipleMetricKeys,\n  xAxisKeyLabel,\n  xAxisKey,\n  disabled = false,\n  setHoveredPointIndex,\n  xAxisScaleType = 'linear',\n  positionInSection = 0,\n}: Pick<RunsMetricsLinePlotProps, 'runsData' | 'onHover' | 'onUnhover'> & {\n  plotData: LineChartTraceData[];\n  legendLabelData: LegendLabelData[];\n  containsMultipleMetricKeys?: boolean;\n  xAxisKeyLabel: string;\n  disabled?: boolean;\n  xAxisKey: RunsChartsLineChartXAxisType;\n  setHoveredPointIndex: (value: number) => void;\n  xAxisScaleType?: 'linear' | 'log';\n  positionInSection?: number;\n}) => {\n  // Save current boundaries/dimensions of the plot in the mutable ref object\n  const chartBoundaries = useRef<{\n    containerLeftPixels: number;\n    plotWidthPixels: number;\n    plotOffsetPixels: number;\n    lowerBoundValue: number;\n    valueRange: number;\n    mainContainer: SVGElement | null;\n    dragLayer: SVGElement | null;\n    initialized: boolean;\n  }>({\n    containerLeftPixels: 0,\n    plotWidthPixels: 0,\n    plotOffsetPixels: 0,\n    lowerBoundValue: 0,\n    valueRange: 0,\n    mainContainer: null,\n    dragLayer: null,\n    initialized: false,\n  });\n\n  // Keep the reference to the scanline element\n  const scanlineElementRef = useRef<HTMLDivElement>(null);\n\n  // Keep the reference to the current hovered trace data\n  const currentHoveredDataPoint = useRef<RunsMetricsSingleTraceTooltipData | undefined>(undefined);\n\n  // Calculate all visible X values each time the plot data changes\n  const visibleXValues = useMemo(() => uniq(plotData.map(({ x }) => x).flat()) as number[], [plotData]);\n\n  // Store the reference to the initialized plotly's figure object, helps keep track when the plot is initialized\n  const [initializedFigure, setInitializedFigure] = useState<{\n    figure: Readonly<Figure>;\n    graphDiv: Readonly<HTMLElement>;\n  } | null>(null);\n\n  // We are calculating the tooltip data outside of React to avoid unnecessary re-renders,\n  // so we're copying all the input data to the mutable ref objects\n  const immediateHoverData = useRef<RunsCompareMultipleTracesTooltipData | undefined>(undefined);\n  const immediateLegendLabelData = useRef(legendLabelData);\n  const immediateRunsData = useRef(runsData);\n  const immediatePlotData = useRef(plotData);\n  const immediateXValuesData = useRef(visibleXValues);\n  const immediateFigure = useRef(initializedFigure);\n\n  // Update the mutable ref objects when the input data changes\n  immediateLegendLabelData.current = legendLabelData;\n  immediateRunsData.current = runsData;\n  immediatePlotData.current = plotData;\n  immediateXValuesData.current = visibleXValues;\n  immediateFigure.current = initializedFigure;\n\n  // Setup the boundaries of the plot\n  const setupBoundaries = useCallback((figure: Readonly<Figure>) => {\n    const lowerAxisValue = figure.layout.xaxis?.range?.[0];\n    const upperAxisValue = figure.layout.xaxis?.range?.[1];\n\n    // If the axis values are numbers, use them as is, otherwise convert them to timestamps\n    let lowerBoundary = isNumber(lowerAxisValue) ? lowerAxisValue : new Date(lowerAxisValue ?? 0).getTime();\n    let upperBoundary = isNumber(upperAxisValue) ? upperAxisValue : new Date(upperAxisValue ?? 0).getTime();\n\n    lowerBoundary += parseMicroseconds(lowerAxisValue);\n    upperBoundary += parseMicroseconds(upperAxisValue);\n\n    // Save the boundaries to the mutable ref object\n    chartBoundaries.current.lowerBoundValue = lowerBoundary ?? 0;\n    chartBoundaries.current.valueRange = (upperBoundary ?? 0) - chartBoundaries.current.lowerBoundValue;\n  }, []);\n\n  const updateContainerPosition = useCallback(() => {\n    const { mainContainer, dragLayer } = chartBoundaries.current;\n\n    if (mainContainer && dragLayer) {\n      const containerRect = mainContainer.getBoundingClientRect();\n      const dragLayerRect = dragLayer.getBoundingClientRect();\n\n      // Save the boundaries to the mutable ref object\n      chartBoundaries.current.containerLeftPixels = containerRect.x;\n      chartBoundaries.current.plotWidthPixels = dragLayerRect.width;\n      chartBoundaries.current.plotOffsetPixels = dragLayerRect.x - containerRect.x;\n      chartBoundaries.current.initialized = dragLayerRect.width > 0;\n    }\n  }, []);\n\n  // This is a handler of plotly's onUpdate callback.\n  // It is called when the plot is initialized and when the plot is updated.\n  const onUpdatePlotHandler = useCallback(\n    (figure: Readonly<Figure>, graphDiv: Readonly<HTMLElement>) => {\n      setupBoundaries(figure);\n\n      const mainContainer: SVGElement | null = graphDiv.querySelector(PLOTLY_SVG_SELECTOR);\n      const dragLayer: SVGElement | null = graphDiv.querySelector(PLOTLY_DRAGLAYER_SELECTOR);\n\n      chartBoundaries.current.mainContainer = mainContainer;\n      chartBoundaries.current.dragLayer = dragLayer;\n      updateContainerPosition();\n    },\n    [setupBoundaries, updateContainerPosition],\n  );\n\n  // This is a handler of plotly's onInit callback.\n  const onInitPlotHandler = useCallback(\n    (figure: Readonly<Figure>, graphDiv: Readonly<HTMLElement>) => {\n      setInitializedFigure({ figure, graphDiv });\n      onUpdatePlotHandler(figure, graphDiv);\n    },\n    [onUpdatePlotHandler],\n  );\n\n  useEffect(() => {\n    // Recalculate positions after chart has been moved\n    requestAnimationFrame(() => {\n      if (!immediateFigure.current) {\n        return;\n      }\n      onUpdatePlotHandler(immediateFigure.current.figure, immediateFigure.current.graphDiv);\n    });\n  }, [positionInSection, onUpdatePlotHandler]);\n\n  // Hides the scanline when the mouse leaves the plot\n  const pointerLeavePlotCallback = useCallback(\n    (e: PointerEvent) => {\n      // Noop if the mouse is moving to plotly's dragcover element\n      if (e.relatedTarget instanceof Element && e.relatedTarget.classList.contains('dragcover')) {\n        return;\n      }\n      onUnhover?.();\n      if (scanlineElementRef.current) {\n        scanlineElementRef.current.style.display = 'none';\n      }\n    },\n    [onUnhover],\n  );\n\n  // This is a handler of plotly's onHover callback.\n  const onPointHoverCallback = useCallback(\n    ({ points }) => {\n      const hoveredPoint = points[0];\n      const hoveredPointData = hoveredPoint?.data;\n\n      setHoveredPointIndex(hoveredPoint?.curveNumber ?? -1);\n\n      if (!hoveredPointData) {\n        return;\n      }\n\n      // Extract metric entity\n      const metricEntity = hoveredPointData.metricHistory?.[hoveredPoint.pointIndex];\n\n      const singleTraceData: RunsMetricsSingleTraceTooltipData = {\n        // Value of the \"x\" axis (time, step)\n        xValue: hoveredPoint.x,\n        // Value of the \"y\" axis\n        yValue: hoveredPoint.y,\n        // Metric entity value\n        metricEntity,\n        // The index of the X datum\n        index: hoveredPoint.pointIndex,\n        // Current label (\"Step\", \"Time\" etc.)\n        label: xAxisKeyLabel,\n        // Run/group UUID\n        traceUuid: hoveredPointData.uuid,\n      };\n\n      // Save the hovered point/trace data to the mutable ref object\n      currentHoveredDataPoint.current = singleTraceData;\n    },\n    [xAxisKeyLabel, setHoveredPointIndex],\n  );\n\n  // This is a handler of plotly's onUnhover callback.\n  const onPointUnhoverCallback = useCallback(() => {\n    currentHoveredDataPoint.current = undefined;\n    setHoveredPointIndex(-1);\n  }, [setHoveredPointIndex]);\n\n  const getClosestXValue = useCallback(\n    (pointerClientX: number) => {\n      const boundaries = chartBoundaries.current;\n      // Calculate the X value of the hovered point\n      const resultX =\n        (pointerClientX - boundaries.plotOffsetPixels - boundaries.containerLeftPixels) / boundaries.plotWidthPixels;\n\n      // Calculate the current step based on the X value and precalculated boundaries\n      let currentStep = boundaries.lowerBoundValue + boundaries.valueRange * resultX;\n      if (xAxisScaleType === 'log') {\n        currentStep = 10 ** currentStep;\n      }\n      // Find the closest existing X value to the currently hovered value\n      const closestXValue = immediateXValuesData.current.reduce((acc, x) => {\n        if (Math.abs(x - currentStep) < Math.abs(acc - currentStep)) {\n          return x;\n        }\n        return acc;\n      }, immediateXValuesData.current[0]);\n      return closestXValue;\n    },\n    [xAxisScaleType],\n  );\n\n  useEffect(() => {\n    // Return early if this tooltip is disabled\n    if (disabled) {\n      return;\n    }\n    // Return early if the figure is not initialized yet\n    if (!initializedFigure) {\n      return;\n    }\n\n    // Setup the boundaries of the plot at the beginning\n    setupBoundaries(initializedFigure.figure);\n\n    // Get the drag layer element - this is the event-sensitive layer of rendered plotly chart\n    const dragLayer: SVGElement | null = initializedFigure.graphDiv.querySelector(PLOTLY_DRAGLAYER_SELECTOR);\n\n    // This is a throttled handler of the pointermove event, it contains some heavier logic so it's throttled for 50ms\n    const tooltipDataUpdateHandler = throttle(\n      (e: PointerEvent) => {\n        // If for some reason the chart sizing is not initialized yet, do it now\n        if (!chartBoundaries.current.initialized) {\n          updateContainerPosition();\n        }\n        const closestXValue = getClosestXValue(e.clientX);\n\n        // Calculate the tooltip data - based on existing legend, plot and runs data\n        const data = immediateLegendLabelData.current.map((legendEntry) => {\n          // First, find the corresponding data entry (from chart components's input data) and trace (from data prepared for plotly)\n          const correspondingDataEntry = immediateRunsData.current.find(({ uuid }) => uuid === legendEntry.uuid);\n          const correspondingDataTrace = immediatePlotData.current.find(\n            ({ uuid, metricKey }) => uuid === legendEntry.uuid && legendEntry.metricKey === metricKey,\n          );\n\n          if (!correspondingDataTrace) {\n            return undefined;\n          }\n\n          // Determine the display name of the metric - if there are multiple metrics, use the legend label,\n          // otherwise use the display name of the corresponding data entry.\n          const displayName = containsMultipleMetricKeys ? legendEntry.label : correspondingDataEntry?.displayName;\n\n          // Find the value of the corresponding data trace at the closest X value\n          const xIndex = correspondingDataTrace.x?.indexOf(closestXValue);\n          if (isUndefined(xIndex) || xIndex === -1) {\n            return undefined;\n          }\n          const value = correspondingDataTrace.y?.[xIndex];\n\n          // Construct the tooltip legend entry\n          return {\n            displayName: displayName || '',\n            value: isNumber(value) ? value : undefined,\n            color: legendEntry?.color,\n            dashStyle: legendEntry?.dashStyle,\n            uuid: `${legendEntry.uuid}.${legendEntry.metricKey}`,\n          };\n        });\n\n        // Save the tooltip data to the mutable ref object\n        immediateHoverData.current = {\n          tooltipLegendItems: orderBy(compact(data), 'value', 'desc'),\n          hoveredDataPoint: currentHoveredDataPoint?.current,\n          xValue: closestXValue,\n          xAxisKey,\n          xAxisKeyLabel,\n        };\n      },\n      TOOLTIP_DATA_UPDATE_INTERVAL,\n      { leading: true },\n    );\n\n    const windowResizeHandler = throttle(updateContainerPosition, TOOLTIP_DATA_UPDATE_INTERVAL);\n\n    // This is a handler of the pointermove event.\n    // It's not throttled: it just updates the scanline and tooltip position and pass precalculated tooltip data\n    const hoverHandler = (e: PointerEvent) => {\n      if (!immediateHoverData.current) {\n        return;\n      }\n\n      const boundaries = chartBoundaries.current;\n      const closestXValue = getClosestXValue(e.clientX);\n      const closestXValueLeftX =\n        ((xAxisScaleType === 'log' ? Math.log10(closestXValue) : closestXValue) - boundaries.lowerBoundValue) /\n        boundaries.valueRange;\n      const closestXValueLeftInPixels = closestXValueLeftX * boundaries.plotWidthPixels;\n\n      // Enable and reposition the scanline\n      if (scanlineElementRef.current) {\n        scanlineElementRef.current.style.display = 'block';\n        scanlineElementRef.current.style.left = `${boundaries.plotOffsetPixels + closestXValueLeftInPixels}px`;\n      }\n\n      onHover?.(\n        immediateHoverData.current?.hoveredDataPoint?.traceUuid || '',\n        {\n          x: boundaries.containerLeftPixels + boundaries.plotOffsetPixels + closestXValueLeftInPixels,\n          y: e.clientY,\n          originalEvent: e,\n        },\n        immediateHoverData.current,\n      );\n    };\n\n    if (dragLayer) {\n      // Assign two separate handlers for move: one for updating the tooltip data, one for updating the scanline and tooltip position\n      dragLayer.addEventListener('pointermove', tooltipDataUpdateHandler);\n      dragLayer.addEventListener('pointermove', hoverHandler);\n      window.addEventListener('resize', windowResizeHandler);\n\n      // Assign a handler that hides the scanline and tooltip\n      dragLayer.addEventListener('pointerleave', pointerLeavePlotCallback);\n      return () => {\n        dragLayer.removeEventListener('pointermove', tooltipDataUpdateHandler);\n        dragLayer.removeEventListener('pointermove', hoverHandler);\n        dragLayer.removeEventListener('pointerleave', pointerLeavePlotCallback);\n        window.removeEventListener('resize', windowResizeHandler);\n      };\n    }\n\n    return () => {};\n  }, [\n    pointerLeavePlotCallback,\n    initializedFigure,\n    setupBoundaries,\n    onHover,\n    containsMultipleMetricKeys,\n    currentHoveredDataPoint,\n    disabled,\n    xAxisKey,\n    xAxisKeyLabel,\n    xAxisScaleType,\n    getClosestXValue,\n    updateContainerPosition,\n  ]);\n\n  const scanlineElement = disabled ? null : (\n    <div\n      css={{\n        top: 0,\n        width: 0,\n        borderLeft: `1px dashed rgba(0,0,0,0.5)`,\n        height: '100%',\n        position: 'absolute',\n        pointerEvents: 'none',\n      }}\n      ref={scanlineElementRef}\n      style={{ display: 'none' }}\n    />\n  );\n\n  return {\n    updateHandler: onUpdatePlotHandler,\n    initHandler: onInitPlotHandler,\n    scanlineElement,\n    onPointHover: onPointHoverCallback,\n    onPointUnhover: onPointUnhoverCallback,\n  };\n};\n","import { intersection } from 'lodash';\nimport type { MetricEntity } from '../../../types';\nimport type { RunsChartsRunData } from '../components/RunsCharts.common';\nimport { RunsChartsLineChartXAxisType } from '../components/RunsCharts.common';\nimport type { RunsMetricsLinePlotProps } from '../components/RunsMetricsLinePlot';\nimport type { RunsChartsLineChartExpression } from '../runs-charts.types';\n\nconst getCompareValue = (element: MetricEntity, xAxisKey: RunsMetricsLinePlotProps['xAxisKey']) => {\n  if (xAxisKey === RunsChartsLineChartXAxisType.STEP) {\n    // If xAxisKey is steps, we match along step\n    return element.step;\n  } else if (\n    xAxisKey === RunsChartsLineChartXAxisType.TIME ||\n    xAxisKey === RunsChartsLineChartXAxisType.TIME_RELATIVE\n  ) {\n    // If xAxisKey is time, we match along timestamp\n    return element.timestamp;\n  }\n  return null;\n};\n\nexport const getExpressionChartsSortedMetricHistory = ({\n  expression,\n  runEntry,\n  evaluateExpression,\n  xAxisKey,\n}: {\n  expression: RunsChartsLineChartExpression;\n  runEntry: Omit<RunsChartsRunData, 'metrics' | 'params' | 'tags' | 'images'>;\n  evaluateExpression: (\n    expression: RunsChartsLineChartExpression,\n    variables: Record<string, number>,\n  ) => number | undefined;\n  xAxisKey: RunsMetricsLinePlotProps['xAxisKey'];\n}) => {\n  const xDataPointsPerVariable = expression.variables.map((variable) => {\n    const elements = runEntry.metricsHistory?.[variable];\n    if (elements !== undefined) {\n      return elements.flatMap((element) => {\n        const compareValue = getCompareValue(element, xAxisKey);\n        if (compareValue !== null) {\n          return [compareValue];\n        }\n        return [];\n      });\n    }\n    return [];\n  });\n  const xDataPoints = intersection(...xDataPointsPerVariable);\n  xDataPoints.sort((a, b) => a - b); // ascending\n\n  // For each xDataPoint, extract variables and evaluate expression\n  return xDataPoints.flatMap((xDataPoint) => {\n    const variables = expression.variables.reduce((obj, variable) => {\n      const elements = runEntry.metricsHistory?.[variable];\n      const value = elements?.find((element) => getCompareValue(element, xAxisKey) === xDataPoint)?.value;\n      if (value !== undefined) {\n        obj[variable] = value;\n      }\n      return obj;\n    }, {} as Record<string, number>);\n\n    const expressionValue = evaluateExpression(expression, variables);\n    if (expressionValue !== undefined) {\n      return [\n        {\n          value: expressionValue,\n          key: expression.expression,\n          ...(xAxisKey === RunsChartsLineChartXAxisType.STEP || xAxisKey === RunsChartsLineChartXAxisType.METRIC\n            ? { step: xDataPoint, timestamp: 0 }\n            : { timestamp: xDataPoint, step: 0 }),\n        },\n      ];\n    }\n    return [];\n  });\n};\n","import { useDesignSystemTheme } from '@databricks/design-system';\nimport { isEmpty, isEqual, isNumber, maxBy, minBy } from 'lodash';\nimport type { Config, Dash, Data as PlotlyData, Layout, LayoutAxis } from 'plotly.js';\nimport { type Figure } from 'react-plotly.js';\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { useIntl } from 'react-intl';\nimport type { MetricEntity } from '../../../types';\nimport { LazyPlot } from '../../LazyPlot';\nimport { useMutableChartHoverCallback } from '../hooks/useMutableHoverCallback';\nimport { highlightLineTraces, useRenderRunsChartTraceHighlight } from '../hooks/useRunsChartTraceHighlight';\nimport type { RunsChartsRunData, RunsPlotsCommonProps } from './RunsCharts.common';\nimport {\n  commonRunsChartStyles,\n  runsChartDefaultMargin,\n  runsChartHoverlabel,\n  createThemedPlotlyLayout,\n  normalizeChartValue,\n  useDynamicPlotSize,\n  getLineChartLegendData,\n  lineDashStyles,\n  containsDuplicateXValues,\n  createFadedTraceColor,\n  getChartAxisLabelDescriptor,\n  RunsChartsLineChartXAxisType,\n} from './RunsCharts.common';\nimport { EMA } from '../../MetricsPlotView';\nimport RunsMetricsLegendWrapper from './RunsMetricsLegendWrapper';\nimport {\n  shouldEnableRelativeTimeDateAxis,\n  shouldEnableChartExpressions,\n} from '@mlflow/mlflow/src/common/utils/FeatureUtils';\nimport { useRunsMultipleTracesTooltipData } from '../hooks/useRunsChartsMultipleTracesTooltip';\nimport { createChartImageDownloadHandler } from '../hooks/useChartImageDownloadHandler';\nimport {\n  EPOCH_RELATIVE_TIME,\n  HOUR_IN_MILLISECONDS,\n  LINE_CHART_RELATIVE_TIME_THRESHOLD,\n} from '@mlflow/mlflow/src/experiment-tracking/constants';\nimport { type RunsChartsLineChartExpression, RunsChartsLineChartYAxisType } from '../runs-charts.types';\nimport { useChartExpressionParser } from '../hooks/useChartExpressionParser';\nimport { getExpressionChartsSortedMetricHistory } from '../utils/expressionCharts.utils';\nimport { RunsChartCardLoadingPlaceholder } from './cards/ChartCard.common';\n\nexport type LineChartTraceData = PlotlyData & {\n  x?: number[] | undefined;\n  y?: number[];\n  uuid?: string;\n  metricKey?: string;\n};\n\n// Display markers only if there are less than 60 points in the single data trace\nconst MARKER_DISPLAY_THRESHOLD = 60;\n\nconst getDataTraceForRun = ({\n  runEntry,\n  metricKey,\n  xAxisKey,\n  selectedXAxisMetricKey,\n  useDefaultHoverBox,\n  lineSmoothness,\n  lineShape,\n  lineDash,\n  displayPoints,\n  displayOriginalLine: originalLine,\n  xAxisScaleType,\n  expression,\n  evaluateExpression,\n}: {\n  runEntry: Omit<RunsChartsRunData, 'metrics' | 'params' | 'tags' | 'images'>;\n  metricKey?: RunsMetricsLinePlotProps['metricKey'];\n  xAxisKey: RunsMetricsLinePlotProps['xAxisKey'];\n  selectedXAxisMetricKey: RunsMetricsLinePlotProps['selectedXAxisMetricKey'];\n  useDefaultHoverBox: RunsMetricsLinePlotProps['useDefaultHoverBox'];\n  lineSmoothness: RunsMetricsLinePlotProps['lineSmoothness'];\n  lineShape: RunsMetricsLinePlotProps['lineShape'];\n  lineDash?: Dash;\n  displayPoints?: boolean;\n  displayOriginalLine?: boolean;\n  xAxisScaleType?: 'linear' | 'log';\n  expression?: RunsChartsLineChartExpression;\n  evaluateExpression?: (\n    expression: RunsChartsLineChartExpression,\n    variables: Record<string, number>,\n  ) => number | undefined;\n}): LineChartTraceData => {\n  if (!runEntry.metricsHistory) {\n    return {};\n  }\n\n  let sortedMetricsHistory: MetricEntity[] = [];\n  if (expression && evaluateExpression) {\n    sortedMetricsHistory = getExpressionChartsSortedMetricHistory({\n      expression,\n      runEntry,\n      evaluateExpression,\n      xAxisKey,\n    });\n  } else if (metricKey !== undefined) {\n    sortedMetricsHistory = runEntry.metricsHistory[metricKey]?.sort((a, b) =>\n      xAxisKey === RunsChartsLineChartXAxisType.STEP ? a.step - b.step : a.timestamp - b.timestamp,\n    );\n  } else {\n    return {};\n  }\n\n  let xValues;\n  let yValues;\n  if (xAxisKey === RunsChartsLineChartXAxisType.METRIC) {\n    const ySteps = new Set((sortedMetricsHistory ?? []).map(({ step }) => step));\n    const xValuesWithSteps = prepareXAxisDataForMetricType(ySteps, runEntry.metricsHistory[selectedXAxisMetricKey]);\n    const stepOrder = xValuesWithSteps.map(({ step }) => step);\n    const xSteps = new Set(stepOrder);\n    const yValueHistory = orderBySteps(sortedMetricsHistory ?? [], stepOrder).filter(({ step }) => xSteps.has(step));\n\n    xValues = xValuesWithSteps.map(({ value }) => value);\n    yValues = yValueHistory.map(({ value }) => normalizeChartValue(value));\n  } else {\n    xValues = prepareMetricHistoryByAxisType(sortedMetricsHistory, xAxisKey);\n    yValues = sortedMetricsHistory?.map(({ value }) => normalizeChartValue(value));\n\n    if (xAxisScaleType === 'log') {\n      // If the log scale is used, we want to remove all <=0 values from X axis (and their corresponding Y values).\n      const firstNonZeroXIndex = xValues.findIndex((x) => x > 0);\n      if (firstNonZeroXIndex !== -1) {\n        xValues = xValues.slice(firstNonZeroXIndex);\n        yValues = yValues.slice(firstNonZeroXIndex);\n      }\n    }\n  }\n\n  // If there are any duplicate X values, use linear line shape\n  // to avoid bending splines in the wrong direction\n  const optimizedLineShape = containsDuplicateXValues(xValues) ? 'linear' : lineShape;\n\n  // Use chart card's configuration or if its unset, use the automatic behavior by checking the number of points\n  const shouldDisplayMarkers = !originalLine && (displayPoints ?? xValues.length < MARKER_DISPLAY_THRESHOLD);\n\n  const containsSingleValue = yValues?.length === 1;\n\n  const hoverinfo = (() => {\n    if (originalLine) {\n      return 'skip';\n    }\n    if (useDefaultHoverBox) {\n      return undefined;\n    }\n    return 'none';\n  })();\n\n  return {\n    // Let's add UUID to each run so it can be distinguished later (e.g. on hover)\n    uuid: runEntry.uuid,\n    name: runEntry.runInfo?.runName || '',\n    x: xValues,\n    // The actual value is on Y axis\n    y: EMA(yValues ?? [], originalLine ? 0 : lineSmoothness),\n    // Save the metric history\n    metricHistory: sortedMetricsHistory,\n    metricKey: metricKey || expression?.expression,\n    hovertext: runEntry.runInfo?.runName || '',\n    text: 'x',\n    textposition: 'outside',\n    textfont: {\n      size: 11,\n    },\n    mode: containsSingleValue || shouldDisplayMarkers ? 'lines+markers' : 'lines',\n    hovertemplate: useDefaultHoverBox ? createTooltipTemplate(runEntry.runInfo?.runName || '') : undefined,\n    hoverinfo,\n    hoverlabel: useDefaultHoverBox ? runsChartHoverlabel : undefined,\n    type: 'scatter',\n    line: { dash: lineDash, shape: optimizedLineShape },\n    marker: {\n      color: originalLine ? createFadedTraceColor(runEntry.color, 0.15) : runEntry.color,\n    },\n  } as LineChartTraceData;\n};\n\nconst getBandTraceForRun = ({\n  runEntry,\n  metricKey,\n  lineShape,\n  xAxisKey,\n  selectedXAxisMetricKey,\n  xAxisScaleType,\n}: {\n  runEntry: Omit<RunsChartsRunData, 'metrics' | 'params' | 'tags' | 'images'>;\n  metricKey: RunsMetricsLinePlotProps['metricKey'];\n  lineShape: RunsMetricsLinePlotProps['lineShape'];\n  xAxisKey: RunsChartsLineChartXAxisType;\n  selectedXAxisMetricKey: RunsMetricsLinePlotProps['selectedXAxisMetricKey'];\n  xAxisScaleType?: 'linear' | 'log';\n}): LineChartTraceData => {\n  if (!runEntry.aggregatedMetricsHistory) {\n    return {};\n  }\n\n  // Get upper and lower boundaries to draw a band\n  const { max, min } = runEntry.aggregatedMetricsHistory[metricKey];\n\n  let xMins, xMaxes, yMins, yMaxes;\n  if (xAxisKey === RunsChartsLineChartXAxisType.METRIC) {\n    if (!runEntry.metricsHistory) {\n      return {};\n    }\n    const ySteps = new Set(max.map(({ step }) => step));\n    const xValuesWithSteps = prepareXAxisDataForMetricType(ySteps, runEntry.metricsHistory[selectedXAxisMetricKey]);\n    const stepOrder = xValuesWithSteps.map((e) => e.step);\n    const xSteps = new Set(stepOrder);\n    const xValues = xValuesWithSteps.map((e) => e.value);\n\n    yMins = orderBySteps(min, stepOrder)\n      .filter(({ step }) => xSteps.has(step))\n      .map(({ value }) => normalizeChartValue(value))\n      .reverse();\n    yMaxes = orderBySteps(max, stepOrder)\n      .filter(({ step }) => xSteps.has(step))\n      .map(({ value }) => normalizeChartValue(value));\n    xMins = xValues.slice().reverse();\n    xMaxes = xValues;\n  } else {\n    // Reverse one of the arrays so that the band is drawn correctly\n    const minReversed = min.slice().reverse();\n    xMins = prepareMetricHistoryByAxisType(minReversed, xAxisKey);\n    xMaxes = prepareMetricHistoryByAxisType(max, xAxisKey);\n    yMins = minReversed.map(({ value }) => normalizeChartValue(value));\n    yMaxes = max.map(({ value }) => normalizeChartValue(value));\n\n    if (xAxisScaleType === 'log') {\n      // If the log scale is used, we want to remove all <=0 values from X axis (and their corresponding Y values).\n      const firstNonZeroXIndex = xMaxes.findIndex((x) => isNumber(x) && x > 0);\n      const lastNonZeroXIndex = xMins.length - xMins.findIndex((x) => isNumber(x) && x > 0);\n      if (firstNonZeroXIndex !== -1 && lastNonZeroXIndex !== -1) {\n        xMaxes = xMaxes.slice(firstNonZeroXIndex);\n        yMaxes = yMaxes.slice(firstNonZeroXIndex);\n        xMins = xMins.slice(0, lastNonZeroXIndex - 1);\n        yMins = yMins.slice(0, lastNonZeroXIndex - 1);\n      }\n    }\n  }\n\n  // Place a null value in the middle to create a gap, otherwise Plotly will\n  // connect the lines and the fill will be drawn incorrectly\n  const xValues = [...xMins, null, ...xMaxes];\n  const bandValues = [...yMins, null, ...yMaxes];\n\n  return {\n    name: runEntry.runInfo?.runName || '',\n    x: xValues,\n    y: bandValues,\n    fillcolor: createFadedTraceColor(runEntry.color, 0.2),\n    hovertemplate: undefined,\n    hoverlabel: undefined,\n    hoverinfo: 'skip',\n    line: { color: 'transparent', shape: lineShape },\n    fill: 'tozeroy',\n    type: 'scatter',\n  } as LineChartTraceData;\n};\n\n/**\n * This function takes a list of metric entities and returns a copy ordered by\n * the step order provided. This is used in metric-type X axes, where the Y values\n * need to be ordered by the X values.\n *\n * For example:\n * dataPoints = [{step: 0, value: 1}, {step: 1, value: 2}, {step: 2, value: 3}]\n * stepOrder = [2, 0, 1]\n * return = [{step: 2, value: 3}, {step: 0, value: 1}, {step: 1, value: 2}]\n */\nconst orderBySteps = (dataPoints: MetricEntity[], stepOrder: number[]) => {\n  const stepIndexes = stepOrder.reduce((acc, step, idx) => {\n    acc[step] = idx;\n    return acc;\n  }, {} as Record<number, number>);\n\n  // if there's a step mismatch, send all non-existing values to the end\n  return dataPoints.slice().sort((a, b) => (stepIndexes[a.step] ?? Infinity) - (stepIndexes[b.step] ?? Infinity));\n};\n\nexport interface RunsMetricsSingleTraceTooltipData {\n  xValue: string | number;\n  yValue: number;\n  index: number;\n  label: string;\n  traceUuid?: string;\n  metricEntity?: MetricEntity;\n}\n\nexport interface RunsCompareMultipleTracesTooltipData {\n  tooltipLegendItems: {\n    uuid: string;\n    color?: string;\n    dashStyle?: Dash;\n    displayName: string;\n    value?: string | number;\n  }[];\n  xValue: string | number;\n  xAxisKey: RunsChartsLineChartXAxisType;\n  xAxisKeyLabel: string;\n  hoveredDataPoint?: RunsMetricsSingleTraceTooltipData;\n}\n\nexport interface RunsMetricsLinePlotProps extends RunsPlotsCommonProps {\n  /**\n   * Determines which metric are we comparing by\n   * NOTE: used only as a fallback in V2 charts\n   */\n  metricKey: string;\n\n  /**\n   * Determines which metric keys to display in V2 charts\n   * NOTE: this prop may not be present in V1 chart configs\n   */\n  selectedMetricKeys?: string[];\n\n  /**\n   * Smoothing factor for EMA\n   */\n  lineSmoothness?: number;\n\n  /**\n   * X axis mode\n   */\n  xAxisScaleType?: 'linear' | 'log';\n\n  /**\n   * Y axis mode\n   */\n  scaleType?: 'linear' | 'log';\n\n  /**\n   * Use spline or polyline. Spline is default mode.\n   */\n  lineShape?: 'linear' | 'spline';\n\n  /**\n   * Choose X axis mode - numeric step or absolute time\n   */\n  xAxisKey?: RunsChartsLineChartXAxisType;\n\n  /**\n   * Choose Y axis mode - metric or expressions\n   */\n  yAxisKey?: RunsChartsLineChartYAxisType;\n\n  /**\n   * Array of expressions to evaluate\n   */\n  yAxisExpressions?: RunsChartsLineChartExpression[];\n\n  /**\n   * Name of the metric to use for the X axis. Used when xAxisKey is set to 'metric'\n   */\n  selectedXAxisMetricKey: string;\n\n  /**\n   * Array of runs data with corresponding values\n   */\n  runsData: Omit<RunsChartsRunData, 'metrics' | 'params' | 'tags' | 'images'>[];\n\n  /**\n   * Currently visible range on x-axis.\n   */\n  xRange?: [number | string, number | string];\n\n  /**\n   * Currently visible range on y-axis\n   */\n  yRange?: [number | string, number | string];\n\n  /**\n   * If set to true, only x-axis can be zoomed by dragging\n   */\n  lockXAxisZoom?: boolean;\n\n  /**\n   * Display points on the line chart. Undefined means \"auto\" mode, i.e. display points only when\n   * there are fewer than 60 datapoints on the chart.\n   */\n  displayPoints?: boolean;\n\n  /**\n   * Current ordering of the chart in the list.\n   * Helps to recalculate tooltip legend repositioning in case of reordering.\n   */\n  positionInSection?: number;\n}\n\nconst PLOT_CONFIG: Partial<Config> = {\n  displaylogo: false,\n  doubleClick: 'autosize',\n  scrollZoom: false,\n  modeBarButtonsToRemove: ['toImage'],\n};\n\nconst createTooltipTemplate = (runName: string) =>\n  `<b>${runName}</b>:<br>` +\n  '<b>%{xaxis.title.text}:</b> %{x}<br>' +\n  '<b>%{yaxis.title.text}:</b> %{y:.2f}<br>' +\n  '<extra></extra>';\n\n/**\n * Prepares dataset's X axis according to selected visualization type: step, time-wall and time-relative\n *\n * NOTE: metric-type X axes are handled by `prepareXAxisDataForMetricType()`, since we need to retain\n *       step information in order to format the Y axis data correctly.\n */\nconst prepareMetricHistoryByAxisType = (\n  metricHistory?: MetricEntity[],\n  axisType?: RunsMetricsLinePlotProps['xAxisKey'],\n) => {\n  if (!metricHistory) {\n    return [];\n  }\n  if (axisType === RunsChartsLineChartXAxisType.TIME_RELATIVE) {\n    const { timestamp: minTimestamp } = minBy(metricHistory, 'timestamp') || {};\n    if (minTimestamp) {\n      if (shouldEnableRelativeTimeDateAxis()) {\n        return metricHistory.map(({ timestamp }) => timestamp - minTimestamp + EPOCH_RELATIVE_TIME);\n      }\n      return metricHistory.map(({ timestamp }) => (timestamp - minTimestamp) / 1000); // Milliseconds -> seconds\n    }\n    return metricHistory.map(({ step }) => step);\n  } else if (shouldEnableRelativeTimeDateAxis() && axisType === RunsChartsLineChartXAxisType.TIME_RELATIVE_HOURS) {\n    const { timestamp: minTimestamp } = minBy(metricHistory, 'timestamp') || {};\n    if (minTimestamp) {\n      return metricHistory.map(({ timestamp }) => (timestamp - minTimestamp) / HOUR_IN_MILLISECONDS);\n    }\n  } else if (axisType === RunsChartsLineChartXAxisType.TIME) {\n    return metricHistory.map(({ timestamp }) => timestamp);\n  }\n\n  return metricHistory.map(({ step }) => step);\n};\n\n/**\n * Prepares dataset's X axis when axisType is 'metric'. This is separate from\n * `prepareMetricHistoryByAxisType` because we need to keep track of the `step`\n * in addition to the `value`, so that the Y axis data can be associated to the\n * correct X datapoint.\n */\nconst prepareXAxisDataForMetricType = (\n  ySteps: Set<number>,\n  metricHistory?: MetricEntity[],\n): Array<{\n  value: number | undefined;\n  step: number;\n}> => {\n  if (!metricHistory) {\n    return [];\n  }\n\n  return metricHistory\n    .filter((datapoint) => ySteps.has(datapoint.step))\n    .map((datapoint) => ({\n      value: normalizeChartValue(datapoint.value),\n      step: datapoint.step,\n    }))\n    .sort((a, b) => {\n      // sort by value in ascending order\n      return Number(a.value) - Number(b.value);\n    });\n};\n\nconst getXAxisPlotlyType = (\n  xAxisKey: RunsChartsLineChartXAxisType,\n  xAxisScaleType: 'linear' | 'log',\n  dynamicXAxisKey: RunsChartsLineChartXAxisType,\n) => {\n  if (\n    xAxisKey === RunsChartsLineChartXAxisType.TIME ||\n    (shouldEnableRelativeTimeDateAxis() && dynamicXAxisKey === RunsChartsLineChartXAxisType.TIME_RELATIVE)\n  ) {\n    return 'date';\n  }\n  if (xAxisKey === RunsChartsLineChartXAxisType.STEP && xAxisScaleType === 'log') {\n    return 'log';\n  }\n  return 'linear';\n};\n\n/**\n * Implementation of plotly.js chart displaying\n * line plot comparing metrics' history for a given\n * set of experiments runs\n */\nexport const RunsMetricsLinePlot = React.memo(\n  ({\n    runsData,\n    metricKey,\n    selectedMetricKeys,\n    scaleType = 'linear',\n    xAxisScaleType = 'linear',\n    xAxisKey = RunsChartsLineChartXAxisType.STEP,\n    yAxisKey = RunsChartsLineChartYAxisType.METRIC,\n    yAxisExpressions = [],\n    selectedXAxisMetricKey = '',\n    lineSmoothness = 70,\n    className,\n    margin = runsChartDefaultMargin,\n    lineShape = 'linear',\n    onUpdate,\n    onHover,\n    onUnhover,\n    width,\n    height,\n    useDefaultHoverBox = true,\n    selectedRunUuid,\n    xRange,\n    yRange,\n    lockXAxisZoom,\n    fullScreen,\n    displayPoints,\n    onSetDownloadHandler,\n    positionInSection = 0,\n  }: RunsMetricsLinePlotProps) => {\n    const { theme } = useDesignSystemTheme();\n    const { evaluateExpression } = useChartExpressionParser();\n\n    const dynamicXAxisKey = useMemo(() => {\n      let dynamicXAxisKey = xAxisKey;\n      if (shouldEnableRelativeTimeDateAxis() && xAxisKey === RunsChartsLineChartXAxisType.TIME_RELATIVE) {\n        const metricKeys = selectedMetricKeys || [metricKey];\n        let maxDiff = 0;\n        runsData.forEach((runData) => {\n          const metricHistory = runData.metricsHistory;\n          if (metricHistory) {\n            metricKeys.forEach((metricKey) => {\n              if (metricHistory[metricKey]) {\n                const { timestamp: minTimestamp } = minBy(metricHistory[metricKey], 'timestamp') || {};\n                const { timestamp: maxTimestamp } = maxBy(metricHistory[metricKey], 'timestamp') || {};\n                if (maxTimestamp && minTimestamp) {\n                  const diff = maxTimestamp - minTimestamp;\n                  maxDiff = Math.max(maxDiff, diff);\n                }\n              }\n            });\n          }\n        });\n\n        if (maxDiff >= LINE_CHART_RELATIVE_TIME_THRESHOLD) {\n          dynamicXAxisKey = RunsChartsLineChartXAxisType.TIME_RELATIVE_HOURS;\n        }\n      }\n      return dynamicXAxisKey;\n    }, [runsData, selectedMetricKeys, metricKey, xAxisKey]);\n\n    const getTraceAndOriginalTrace = (props: any) => {\n      const dataTrace = getDataTraceForRun(props);\n      const originalLineProps = {\n        ...props,\n        lineSmoothness: 0,\n        useDefaultHoverBox: false,\n        displayPoints: false,\n        displayOriginalLine: true,\n      };\n      const originalDataTrace = getDataTraceForRun(originalLineProps);\n      return [dataTrace, originalDataTrace];\n    };\n\n    const plotData = useMemo(() => {\n      // Generate a data trace for each metric in each run\n      const metricKeys = selectedMetricKeys ?? [metricKey];\n      return runsData\n        .map((runEntry) => {\n          if (\n            shouldEnableChartExpressions() &&\n            xAxisKey !== RunsChartsLineChartXAxisType.METRIC &&\n            yAxisKey === RunsChartsLineChartYAxisType.EXPRESSION\n          ) {\n            return yAxisExpressions.flatMap((expression: RunsChartsLineChartExpression, idx: number) => {\n              return getTraceAndOriginalTrace({\n                runEntry,\n                expression,\n                xAxisKey: dynamicXAxisKey,\n                selectedXAxisMetricKey,\n                useDefaultHoverBox,\n                lineSmoothness,\n                lineShape,\n                lineDash: lineDashStyles[idx % lineDashStyles.length],\n                displayPoints,\n                xAxisScaleType,\n                evaluateExpression,\n              });\n            });\n          } else {\n            return (\n              metricKeys\n                // Discard creating traces for metrics that don't have any history for a given run\n                .filter((metricKey) => !isEmpty(runEntry.metricsHistory?.[metricKey]))\n                .flatMap((metricKey, idx) => {\n                  return getTraceAndOriginalTrace({\n                    runEntry,\n                    metricKey,\n                    xAxisKey: dynamicXAxisKey,\n                    selectedXAxisMetricKey,\n                    useDefaultHoverBox,\n                    lineSmoothness,\n                    lineShape,\n                    lineDash: lineDashStyles[idx % lineDashStyles.length],\n                    displayPoints,\n                    xAxisScaleType,\n                  });\n                })\n            );\n          }\n        })\n        .flat();\n    }, [\n      runsData,\n      lineShape,\n      dynamicXAxisKey,\n      lineSmoothness,\n      metricKey,\n      useDefaultHoverBox,\n      selectedMetricKeys,\n      selectedXAxisMetricKey,\n      displayPoints,\n      xAxisScaleType,\n      yAxisKey,\n      yAxisExpressions,\n      evaluateExpression,\n      xAxisKey,\n    ]);\n\n    const bandsData = useMemo(() => {\n      const metricKeys = selectedMetricKeys ?? [metricKey];\n      return runsData\n        .filter(({ groupParentInfo }) => groupParentInfo)\n        .flatMap((runEntry) =>\n          metricKeys.map((metricKey) =>\n            getBandTraceForRun({\n              runEntry,\n              metricKey,\n              lineShape,\n              xAxisKey: dynamicXAxisKey,\n              selectedXAxisMetricKey,\n              xAxisScaleType,\n            }),\n          ),\n        );\n    }, [lineShape, metricKey, runsData, selectedMetricKeys, dynamicXAxisKey, selectedXAxisMetricKey, xAxisScaleType]);\n\n    const plotDataWithBands = useMemo(() => [...bandsData, ...plotData], [plotData, bandsData]);\n\n    const { layoutHeight, layoutWidth, setContainerDiv, containerDiv, isDynamicSizeSupported } = useDynamicPlotSize();\n\n    const { formatMessage } = useIntl();\n\n    const { setHoveredPointIndex } = useRenderRunsChartTraceHighlight(\n      containerDiv,\n      selectedRunUuid,\n      plotDataWithBands,\n      highlightLineTraces,\n      bandsData.length,\n    );\n\n    const xAxisPlotlyType = getXAxisPlotlyType(xAxisKey, xAxisScaleType, dynamicXAxisKey);\n\n    const xAxisKeyLabel = useMemo(() => {\n      if (dynamicXAxisKey === RunsChartsLineChartXAxisType.METRIC) {\n        return selectedXAxisMetricKey;\n      }\n\n      return formatMessage(getChartAxisLabelDescriptor(dynamicXAxisKey));\n    }, [formatMessage, dynamicXAxisKey, selectedXAxisMetricKey]);\n\n    const yAxisParams: Partial<LayoutAxis> = useMemo(() => {\n      return {\n        tickfont: { size: 11, color: theme.colors.textSecondary },\n        type: scaleType === 'log' ? 'log' : 'linear',\n        fixedrange: lockXAxisZoom,\n        range: yRange,\n        autorange: yRange === undefined,\n        tickformat: 'f',\n      };\n    }, [scaleType, lockXAxisZoom, theme, yRange]);\n\n    const xAxisParams: Partial<LayoutAxis> = useMemo(() => {\n      return {\n        title: xAxisKeyLabel,\n        tickfont: { size: 11, color: theme.colors.textSecondary },\n        range: xRange,\n        autorange: xRange === undefined,\n        type: xAxisPlotlyType,\n      };\n    }, [theme, xAxisKeyLabel, xRange, xAxisPlotlyType]);\n\n    const [layout, setLayout] = useState<Partial<Layout>>({\n      width: width || layoutWidth,\n      height: height || layoutHeight,\n      margin,\n      xaxis: xAxisParams,\n      yaxis: yAxisParams,\n      showlegend: false,\n    });\n\n    useEffect(() => {\n      setLayout((current) => {\n        const updatedLayout = {\n          ...current,\n          width: width || layoutWidth,\n          height: height || layoutHeight,\n          margin,\n          yaxis: yAxisParams,\n          xaxis: { ...current.xaxis, ...xAxisParams },\n          showlegend: false,\n        };\n\n        if (isEqual(updatedLayout, current)) {\n          return current;\n        }\n        return updatedLayout;\n      });\n    }, [layoutWidth, layoutHeight, margin, xAxisParams, yAxisParams, width, height, xAxisKeyLabel]);\n\n    const containsMultipleMetricKeys = useMemo(() => (selectedMetricKeys?.length || 0) > 1, [selectedMetricKeys]);\n\n    const unhoverCallback = useCallback(() => {\n      onUnhover?.();\n      setHoveredPointIndex(-1);\n    }, [onUnhover, setHoveredPointIndex]);\n\n    const themedPlotlyLayout = useMemo(() => createThemedPlotlyLayout(theme), [theme]);\n\n    // When switching axis title, Plotly.js mutates its layout object\n    // internally which leads to desync problems and automatic axis range\n    // ends up with an invalid value. In order to fix it, we are mutating\n    // axis object and injecting metric key as title in\n    // the render phase.\n    // It could be fixed by wrapping plotly.js directly instead of using\n    // react-plotly.js - but the effort does not correspond to the plan of\n    // moving away from plotly soon.\n    const immediateLayout = layout;\n    if (immediateLayout.xaxis) {\n      immediateLayout.xaxis.title = xAxisKeyLabel;\n      immediateLayout.xaxis.type = xAxisPlotlyType;\n      if (xRange) {\n        immediateLayout.xaxis.range = xRange;\n      }\n      immediateLayout.xaxis.automargin = true;\n      immediateLayout.xaxis.tickformat =\n        shouldEnableRelativeTimeDateAxis() && dynamicXAxisKey === RunsChartsLineChartXAxisType.TIME_RELATIVE\n          ? '%H:%M:%S'\n          : undefined;\n    }\n    immediateLayout.template = { layout: themedPlotlyLayout };\n\n    if (immediateLayout.yaxis && yRange) {\n      immediateLayout.yaxis.range = yRange;\n      immediateLayout.yaxis.automargin = true;\n      immediateLayout.yaxis.tickformat = 'f';\n    }\n\n    const legendLabelData = useMemo(\n      () => getLineChartLegendData(runsData, selectedMetricKeys, metricKey, yAxisKey, yAxisExpressions),\n      [runsData, selectedMetricKeys, metricKey, yAxisKey, yAxisExpressions],\n    );\n\n    const {\n      scanlineElement,\n      initHandler,\n      updateHandler: updateHandlerMultipleRuns,\n      onPointHover: hoverCallbackMultipleRuns,\n      onPointUnhover: unhoverCallbackMultipleRuns,\n    } = useRunsMultipleTracesTooltipData({\n      legendLabelData,\n      plotData,\n      runsData,\n      containsMultipleMetricKeys,\n      onHover,\n      onUnhover: unhoverCallback,\n      xAxisKeyLabel,\n      xAxisKey: dynamicXAxisKey,\n      xAxisScaleType: xAxisKey === RunsChartsLineChartXAxisType.STEP ? xAxisScaleType : 'linear',\n      setHoveredPointIndex,\n      positionInSection,\n    });\n\n    /**\n     * Unfortunately plotly.js memorizes first onHover callback given on initial render,\n     * so in order to achieve updated behavior we need to wrap its most recent implementation\n     * in the immutable callback.\n     */\n    const mutableHoverCallback = useMutableChartHoverCallback(hoverCallbackMultipleRuns);\n\n    // Prepare data for image download handler\n    useEffect(() => {\n      // Check if we are using multiple metric keys. If so, we also need to append\n      // the metric key to  the trace name in the exported image.\n      const usingMultipleMetricKeys = (selectedMetricKeys?.length || 0) > 1;\n      const dataToExport = usingMultipleMetricKeys\n        ? plotDataWithBands.map((dataTrace) =>\n            dataTrace.metricKey\n              ? {\n                  ...dataTrace,\n                  name: `${dataTrace.name} (${dataTrace.metricKey})`,\n                }\n              : dataTrace,\n          )\n        : plotDataWithBands;\n\n      const layoutToExport: Partial<Layout> = {\n        ...layout,\n        showlegend: true,\n        legend: {\n          orientation: 'h',\n        },\n      };\n      onSetDownloadHandler?.(createChartImageDownloadHandler(dataToExport, layoutToExport));\n    }, [layout, onSetDownloadHandler, plotDataWithBands, selectedMetricKeys?.length]);\n\n    const chart = (\n      <div\n        css={[commonRunsChartStyles.chartWrapper(theme), styles.highlightStyles]}\n        className={className}\n        ref={setContainerDiv}\n      >\n        <LazyPlot\n          data={plotDataWithBands}\n          useResizeHandler={!isDynamicSizeSupported}\n          css={commonRunsChartStyles.chart(theme)}\n          onUpdate={(figure: Readonly<Figure>, graphDiv: Readonly<HTMLElement>) => {\n            updateHandlerMultipleRuns(figure, graphDiv);\n            onUpdate?.(figure, graphDiv);\n          }}\n          layout={immediateLayout}\n          config={PLOT_CONFIG}\n          onHover={mutableHoverCallback}\n          onUnhover={unhoverCallbackMultipleRuns}\n          onInitialized={initHandler}\n          fallback={<RunsChartCardLoadingPlaceholder />}\n        />\n        {scanlineElement}\n      </div>\n    );\n\n    return (\n      <RunsMetricsLegendWrapper labelData={legendLabelData} fullScreen={fullScreen}>\n        {chart}\n      </RunsMetricsLegendWrapper>\n    );\n  },\n);\n\nconst styles = {\n  highlightStyles: {\n    '.scatterlayer g.trace': {\n      transition: 'var(--trace-transition)',\n    },\n    '.scatterlayer.is-highlight g.trace:not(.is-band)': {\n      opacity: 'var(--trace-opacity-dimmed-low) !important',\n    },\n    '.scatterlayer g.trace.is-hover-highlight:not(.is-band)': {\n      opacity: 'var(--trace-opacity-highlighted) !important',\n    },\n    '.scatterlayer g.trace.is-selection-highlight:not(.is-band)': {\n      opacity: 'var(--trace-opacity-highlighted) !important',\n    },\n    '.scatterlayer g.trace.is-selection-highlight path.point': {\n      stroke: 'var(--trace-stroke-color)',\n      strokeWidth: 'var(--trace-stroke-width) !important',\n    },\n    '.scatterlayer.is-highlight g.trace.is-band:not(.is-band-highlighted)': {\n      opacity: 'var(--trace-opacity-dimmed) !important',\n    },\n  },\n};\n","var _path, _circle, _ellipse, _circle2, _circle3, _ellipse2, _ellipse3;\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nimport * as React from \"react\";\nfunction SvgChartScatter({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 18,\n    height: 16,\n    viewBox: \"0 0 18 16\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M1 0.813599V15.1865H17\",\n    stroke: \"#A3AEB8\",\n    strokeLinecap: \"round\"\n  })), _circle || (_circle = /*#__PURE__*/React.createElement(\"circle\", {\n    cx: 3.98301,\n    cy: 12.4746,\n    r: 1.35593,\n    fill: \"#338ECC\"\n  })), _ellipse || (_ellipse = /*#__PURE__*/React.createElement(\"ellipse\", {\n    cx: 9.40684,\n    cy: 10.8475,\n    rx: 1.35593,\n    ry: 1.35593,\n    fill: \"#338ECC\"\n  })), _circle2 || (_circle2 = /*#__PURE__*/React.createElement(\"circle\", {\n    cx: 5.6102,\n    cy: 8.1356,\n    r: 1.35593,\n    fill: \"#338ECC\",\n    fillOpacity: 0.25\n  })), _circle3 || (_circle3 = /*#__PURE__*/React.createElement(\"circle\", {\n    cx: 9.40684,\n    cy: 6.50852,\n    r: 1.35593,\n    fill: \"#338ECC\"\n  })), _ellipse2 || (_ellipse2 = /*#__PURE__*/React.createElement(\"ellipse\", {\n    cx: 13.7457,\n    cy: 5.96616,\n    rx: 1.35593,\n    ry: 1.35593,\n    fill: \"#338ECC\",\n    fillOpacity: 0.25\n  })), _ellipse3 || (_ellipse3 = /*#__PURE__*/React.createElement(\"ellipse\", {\n    cx: 16.4576,\n    cy: 2.46128,\n    rx: 1.35593,\n    ry: 1.35593,\n    fill: \"#338ECC\"\n  })));\n}\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgChartScatter);\nexport default __webpack_public_path__ + \"static/media/chart-scatter.69118d0023a6ff3973f7fa913834ac47.svg\";\nexport { ForwardRef as ReactComponent };","import { Empty, NoIcon, Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { useUpdateExperimentViewUIState } from '../../experiment-page/contexts/ExperimentPageUIStateContext';\nimport { useCallback } from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nexport const RunsChartsNoDataFoundIndicator = () => {\n  const updateUIState = useUpdateExperimentViewUIState();\n  const { theme } = useDesignSystemTheme();\n\n  const hideEmptyCharts = useCallback(() => {\n    updateUIState((state) => ({ ...state, hideEmptyCharts: true }));\n  }, [updateUIState]);\n\n  return (\n    <div\n      css={{\n        flex: 1,\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        paddingLeft: theme.spacing.lg,\n        paddingRight: theme.spacing.lg,\n      }}\n    >\n      <Empty\n        description={\n          <FormattedMessage\n            defaultMessage=\"No chart data available for the currently visible runs. Select other runs or <link>hide empty charts.</link>\"\n            description=\"Experiment tracking > runs charts > indication displayed when no corresponding data is found to be used in chart-based run comparison\"\n            values={{\n              link: (chunks) => (\n                <Typography.Link\n                  componentId=\"codegen_mlflow_app_src_experiment-tracking_components_runs-charts_components_runschartsnodatafoundindicator.tsx_31\"\n                  onClick={hideEmptyCharts}\n                >\n                  {chunks}\n                </Typography.Link>\n              ),\n            }}\n          />\n        }\n        image={<NoIcon />}\n      />\n    </div>\n  );\n};\n","import type { Interpolation, Theme } from '@emotion/react';\nimport React, { useCallback, useContext, useEffect, useLayoutEffect, useMemo, useRef, useState } from 'react';\nimport type {\n  RunsCompareMultipleTracesTooltipData,\n  RunsMetricsSingleTraceTooltipData,\n} from '../components/RunsMetricsLinePlot';\nimport type { RunsMetricsBarPlotHoverData } from '../components/RunsMetricsBarPlot';\nimport { ChartsTraceHighlightSource, useRunsChartTraceHighlight } from './useRunsChartTraceHighlight';\nimport { RUNS_CHARTS_UI_Z_INDEX } from '../utils/runsCharts.const';\n\nexport interface RunsChartsTooltipBodyProps<TContext = any, TChartData = any, THoverData = any> {\n  runUuid: string;\n  hoverData: THoverData;\n  chartData: TChartData;\n  contextData: TContext;\n  closeContextMenu: () => void;\n  isHovering?: boolean;\n  mode: RunsChartsTooltipMode;\n}\n\nexport interface RunsChartsChartMouseEvent {\n  x: number;\n  y: number;\n  originalEvent?: MouseEvent;\n}\n\nexport enum RunsChartsTooltipMode {\n  Simple = 1,\n  MultipleTracesWithScanline = 2,\n}\n\nexport type RunsChartsTooltipBodyComponent<C = any, T = any> = React.ComponentType<\n  React.PropsWithChildren<RunsChartsTooltipBodyProps<C, T>>\n>;\n\nconst RunsChartsTooltipContext = React.createContext<{\n  selectedRunUuid: string | null;\n  closeContextMenu: () => void;\n  resetTooltip: () => void;\n  destroyTooltip: () => void;\n  updateTooltip: (\n    runUuid: string,\n    mode: RunsChartsTooltipMode,\n    chartData?: any,\n    event?: RunsChartsChartMouseEvent,\n    additionalData?: any,\n  ) => void;\n} | null>(null);\n\nexport enum ContextMenuVisibility {\n  HIDDEN,\n  HOVER,\n  VISIBLE,\n}\n\nexport const containsMultipleRunsTooltipData = (\n  hoverData: RunsMetricsBarPlotHoverData | RunsMetricsSingleTraceTooltipData | RunsCompareMultipleTracesTooltipData,\n): hoverData is RunsCompareMultipleTracesTooltipData => hoverData && 'tooltipLegendItems' in hoverData;\n\n/**\n * Extract first ancestor HTML element in the hierarchy, even if the target is an SVG element.\n * Necessary for proper behavior of '.contains()'\n */\nconst extractHTMLAncestorElement = (element: Element | EventTarget | null) => {\n  if (element === null || !(element instanceof Element)) {\n    return null;\n  }\n  if (element instanceof HTMLElement) {\n    return element;\n  }\n\n  let currentElement: Element | null = element;\n  while (currentElement && !(currentElement instanceof HTMLElement)) {\n    currentElement = currentElement.parentElement;\n  }\n\n  return currentElement;\n};\n\n/**\n * Context and DOM container necessary for chart context menu to work.\n * Can wrap multiple charts.\n */\nexport const RunsChartsTooltipWrapper = <\n  // Type for the context data passed to the tooltip, e.g. list of all runs\n  TContext = any,\n  // Type for local hover data passed to the tooltip, e.g. configuration of particular chart\n  THover = any,\n>({\n  className,\n  children,\n  contextData,\n  component: Component,\n  hoverOnly = false,\n}: React.PropsWithChildren<{\n  className?: string;\n  contextData: TContext;\n  component: React.ComponentType<React.PropsWithChildren<RunsChartsTooltipBodyProps<TContext, THover>>>;\n  hoverOnly?: boolean;\n}>) => {\n  // A reference to the viewport-wide element containing the context menu\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  // A reference to the tooltip/context-menu element\n  const ctxMenuRef = useRef<HTMLDivElement>(null);\n\n  // Mutable value containing current mouse position\n  const currentPos = useRef<{ x: number; y: number }>({ x: 0, y: 0 });\n\n  // Mutable value containing current snapped mouse position, provided externally by the tooltip data providers\n  // Used instead of `currentPos` when the tooltip is in the \"multiple runs\" mode\n  const currentSnappedCoordinates = useRef<{ x: number; y: number }>({ x: 0, y: 0 });\n\n  const [mode, setMode] = useState<RunsChartsTooltipMode>(RunsChartsTooltipMode.Simple);\n\n  // Current visibility of the tooltip/context-menu\n  const [contextMenuShown, setContextMenuShown] = useState<ContextMenuVisibility>(ContextMenuVisibility.HIDDEN);\n\n  const [tooltipDisplayParams, setTooltipDisplayParams] = useState<any | null>(null);\n  const [hoveredRunUuid, setHoveredRunUuid] = useState<string>('');\n\n  // Apart from run uuid, It's also possible to set bonus axis data (helpful for line charts with data lineage)\n  const [additionalAxisData, setAdditionalAxisData] = useState<any>(null);\n\n  // Stores data about the run that has been clicked, but mouse has not been released.\n  const focusedRunData = useRef<{ x: number; y: number; runUuid: string } | null>(null);\n\n  // Mutable version of certain state values, used in processes outside the React event lifecycle\n  const mutableContextMenuShownRef = useRef<ContextMenuVisibility>(contextMenuShown);\n  const mutableHoveredRunUuid = useRef(hoveredRunUuid);\n  const mutableTooltipDisplayParams = useRef(tooltipDisplayParams);\n  const mutableAdditionalAxisData = useRef(additionalAxisData);\n\n  // Get the higlighting function from the context\n  const { highlightDataTrace } = useRunsChartTraceHighlight();\n\n  // This method applies the tooltip position basing on the mouse position\n  const applyPositioning = useCallback(\n    (isChangingVisibilityMode = false) => {\n      if (!ctxMenuRef.current || !containerRef.current) {\n        return;\n      }\n\n      // For the X coordinate, If the tooltip is in the \"multiple runs\" mode, use the snapped coordinates.\n      // Otherwise, use the current mouse position.\n      let targetX =\n        mode === RunsChartsTooltipMode.MultipleTracesWithScanline\n          ? currentSnappedCoordinates.current.x\n          : currentPos.current.x;\n\n      let targetY = currentPos.current.y;\n\n      const currentCtxMenu = ctxMenuRef.current;\n      const containerRect = containerRef.current.getBoundingClientRect();\n\n      if (mode === RunsChartsTooltipMode.MultipleTracesWithScanline) {\n        // In particular cases, the tooltip container can not take entire viewport size\n        // so we need to adjust the position of the tooltip\n        targetX -= containerRect.x;\n        targetY -= containerRect.y;\n      }\n\n      ctxMenuRef.current.style.left = '0px';\n      ctxMenuRef.current.style.top = '0px';\n      ctxMenuRef.current.style.transform = `translate3d(${targetX + 1}px, ${targetY + 1}px, 0)`;\n\n      // This function is used to reposition the tooltip if it's out of the viewport\n      const reposition = () => {\n        const menuRect = currentCtxMenu.getBoundingClientRect();\n\n        if (targetX + menuRect.width >= containerRect.width) {\n          targetX -= menuRect.width;\n        }\n\n        if (targetY + menuRect.height >= containerRect.height) {\n          targetY -= menuRect.height;\n        }\n\n        currentCtxMenu.style.transform = `translate3d(${targetX + 1}px, ${targetY + 1}px, 0)`;\n      };\n\n      // If the tooltip changes it's visibility mode during the process, defer repositioning to the next frame\n      // to make sure that the position is correct after possible change of the tooltip size.\n      // Otherwise, reposition immediately to save computation cycles.\n      if (isChangingVisibilityMode) {\n        requestAnimationFrame(reposition);\n      } else {\n        reposition();\n      }\n    },\n    [mode],\n  );\n\n  // Save mutable visibility each time a stateful one changes\n  useEffect(() => {\n    mutableContextMenuShownRef.current = contextMenuShown;\n  }, [contextMenuShown]);\n\n  // This function returns X and Y of the target element relative to the container\n  const getCoordinatesForTargetElement = useCallback((targetElement: HTMLElement, event: MouseEvent) => {\n    const targetRect = targetElement.getBoundingClientRect();\n    const containerRect = containerRef.current?.getBoundingClientRect() || { left: 0, top: 0 };\n    const x = event.offsetX + (targetRect.left - containerRect.left);\n    const y = event.offsetY + (targetRect.top - containerRect.top);\n    return { x, y };\n  }, []);\n\n  const mouseMove: React.MouseEventHandler<HTMLDivElement> = useCallback(\n    (event) => {\n      // Apply only if the tooltip is in the hover mode\n      if (\n        mutableContextMenuShownRef.current === ContextMenuVisibility.HOVER &&\n        ctxMenuRef.current &&\n        containerRef.current\n      ) {\n        focusedRunData.current = null;\n        const targetElement = extractHTMLAncestorElement(event.target);\n        if (targetElement) {\n          currentPos.current = getCoordinatesForTargetElement(targetElement, event.nativeEvent);\n          applyPositioning();\n        }\n      }\n    },\n    [applyPositioning, getCoordinatesForTargetElement],\n  );\n\n  // This callback is being fired on every new run being hovered\n  const updateTooltip = useCallback(\n    (\n      runUuid: string,\n      mode: RunsChartsTooltipMode,\n      chartData?: any,\n      event?: RunsChartsChartMouseEvent,\n      additionalRunData?: any,\n    ) => {\n      mutableHoveredRunUuid.current = runUuid;\n      mutableTooltipDisplayParams.current = chartData;\n      mutableAdditionalAxisData.current = additionalRunData;\n\n      // If the tooltip is visible and hardwired to the position, don't change it\n      if (mutableContextMenuShownRef.current === ContextMenuVisibility.VISIBLE) {\n        return;\n      }\n\n      // Update the event-specific data in the state\n      setTooltipDisplayParams(chartData);\n\n      // If the mouse button has been clicked on a run but hover\n      // has been lost, do nothing\n      if (!runUuid && focusedRunData.current?.runUuid) {\n        return;\n      }\n\n      if (mode === RunsChartsTooltipMode.MultipleTracesWithScanline) {\n        currentSnappedCoordinates.current.x = event?.x || 0;\n      }\n\n      // Set the mode - single run or multiple runs\n      setMode(mode);\n\n      // Update the currently hovered run\n      setHoveredRunUuid((currentRunUuid) => {\n        if (additionalRunData) {\n          setAdditionalAxisData(additionalRunData);\n        }\n        // If the tooltip was hidden or it's shown but it's another run,\n        // make sure that the state is updated\n        if (\n          mutableContextMenuShownRef.current === ContextMenuVisibility.HIDDEN ||\n          (mutableContextMenuShownRef.current === ContextMenuVisibility.HOVER && runUuid !== currentRunUuid)\n        ) {\n          setContextMenuShown(ContextMenuVisibility.HOVER);\n          return runUuid;\n        }\n        return currentRunUuid;\n      });\n    },\n    [],\n  );\n\n  const mouseDownCapture: React.MouseEventHandler<HTMLDivElement> = useCallback(\n    (event) => {\n      if (hoverOnly) {\n        return;\n      }\n      // Saves the current position and hovered run ID after lowering the mouse button,\n      // we use it afterwards to confirm that user has clicked on the same run and scrubbing/zooming\n      // didn't occur in the meanwhile\n      if (event.button === 0 && mutableHoveredRunUuid.current) {\n        focusedRunData.current = {\n          x: event.pageX,\n          y: event.pageY,\n          runUuid: mutableHoveredRunUuid.current,\n        };\n      }\n    },\n    [hoverOnly],\n  );\n\n  // Callback for the click event for the tooltip area, checks if context menu needs to be shown.\n  // We're not using `mouseup` because plotly.js hijacks the event by appending drag cover to the document on `mousedown`.\n  const tooltipAreaClicked: React.MouseEventHandler<HTMLDivElement> = useCallback(\n    (event) => {\n      if (hoverOnly) {\n        return;\n      }\n\n      const clickedInTheSamePlace = () => {\n        const epsilonPixels = 5;\n\n        return (\n          focusedRunData.current?.runUuid &&\n          Math.abs(event.pageX - focusedRunData.current.x) < epsilonPixels &&\n          Math.abs(event.pageY - focusedRunData.current.y) < epsilonPixels\n        );\n      };\n\n      // We're interested in displaying the context menu only if\n      // mouse is in the same position as when lowering the button,\n      // this way we won't display it when zooming on the chart.\n      if (focusedRunData.current && clickedInTheSamePlace()) {\n        // If the context menu is already visible, we need to reposition it and provide\n        // the updated run UUID\n        if (mutableContextMenuShownRef.current === ContextMenuVisibility.VISIBLE) {\n          setHoveredRunUuid(focusedRunData.current.runUuid);\n          setAdditionalAxisData(mutableAdditionalAxisData.current);\n          const targetElement = extractHTMLAncestorElement(event.nativeEvent.target);\n          if (targetElement) {\n            currentPos.current = getCoordinatesForTargetElement(targetElement, event.nativeEvent);\n            applyPositioning(true);\n          }\n        } else {\n          // If the context menu was not visible before (it was a tooltip), just enable it.\n          setContextMenuShown(ContextMenuVisibility.VISIBLE);\n          applyPositioning(true);\n        }\n        event.stopPropagation();\n      }\n      // Since the mouse button is up, reset the currently focused run\n      focusedRunData.current = null;\n    },\n    [applyPositioning, hoverOnly, getCoordinatesForTargetElement],\n  );\n\n  // Exposed function used to hide the context menu\n  const closeContextMenu = useCallback(() => setContextMenuShown(ContextMenuVisibility.HIDDEN), []);\n\n  // Set up main listeners in the useLayoutEffect hook\n  useLayoutEffect(() => {\n    if (!containerRef.current) {\n      return undefined;\n    }\n\n    // Find the DOM root - it can be either document or a shadow root\n    const domRoot = containerRef.current.getRootNode() as Document;\n\n    // This function is being called on every click in the document,\n    // it's used to dismiss the shown context menu\n    const rootClickListener = (e: MouseEvent) => {\n      // We're interested only in dismissing context menu mode, tooltip is fine\n      if (mutableContextMenuShownRef.current !== ContextMenuVisibility.VISIBLE) {\n        return;\n      }\n\n      const targetElement = extractHTMLAncestorElement(e.target);\n\n      if (!targetElement) {\n        return;\n      }\n\n      // Check if the click event occurred within the\n      // context menu\n      const contextMenuClicked =\n        targetElement instanceof HTMLElement &&\n        ctxMenuRef?.current instanceof HTMLElement &&\n        ctxMenuRef.current.contains(targetElement);\n\n      // Dismiss the context menu only if click didn't occur on\n      // the context menu content or on another run\n      if (!contextMenuClicked && !focusedRunData.current?.runUuid) {\n        setContextMenuShown(ContextMenuVisibility.HIDDEN);\n      }\n    };\n    domRoot.addEventListener('click', rootClickListener, { capture: true });\n\n    return () => {\n      domRoot.removeEventListener('click', rootClickListener, { capture: true });\n    };\n  }, [getCoordinatesForTargetElement, applyPositioning]);\n\n  // Callback used to reset the tooltip, fired when the mouse leaves the run\n  const resetTooltip = useCallback(() => {\n    mutableHoveredRunUuid.current = '';\n    if (focusedRunData.current?.runUuid || mutableContextMenuShownRef.current === ContextMenuVisibility.VISIBLE) {\n      return;\n    }\n    setHoveredRunUuid('');\n    setContextMenuShown(ContextMenuVisibility.HIDDEN);\n  }, []);\n\n  // Callback used to remove the tooltip,\n  const destroyTooltip = useCallback((force = false) => {\n    mutableHoveredRunUuid.current = '';\n    setHoveredRunUuid('');\n    setContextMenuShown(ContextMenuVisibility.HIDDEN);\n  }, []);\n\n  // Export the currently selected run ID. Set to \"null\" if there is nothing selected.\n  const selectedRunUuid = useMemo(() => {\n    if (contextMenuShown !== ContextMenuVisibility.VISIBLE) {\n      return null;\n    }\n    return hoveredRunUuid;\n  }, [contextMenuShown, hoveredRunUuid]);\n\n  // When the selected data trace changes, report the highlight event\n  useEffect(\n    () =>\n      highlightDataTrace(selectedRunUuid, {\n        source: ChartsTraceHighlightSource.CHART,\n        // Block the highlight event so it won't change as long as the tooltip is in selected mode\n        shouldBlock: Boolean(selectedRunUuid),\n      }),\n    [highlightDataTrace, selectedRunUuid],\n  );\n\n  const contextValue = useMemo(\n    () => ({ updateTooltip, resetTooltip, destroyTooltip, selectedRunUuid, closeContextMenu }),\n    [updateTooltip, resetTooltip, destroyTooltip, selectedRunUuid, closeContextMenu],\n  );\n\n  // We're displaying tooltip if:\n  // - it's not in the hidden mode\n  // - it's in the single run tooltip mode and hovered run is not empty\n  // - it's in the multiple runs tooltip mode\n  const displayTooltip =\n    contextMenuShown !== ContextMenuVisibility.HIDDEN &&\n    (mode === RunsChartsTooltipMode.MultipleTracesWithScanline || hoveredRunUuid !== '');\n\n  return (\n    <RunsChartsTooltipContext.Provider value={contextValue}>\n      {/* The element below wraps all the children (where charts are expected to be mounted)\n      and tracks mouse movement inside */}\n      <div\n        onMouseMove={mouseMove}\n        onMouseDownCapture={mouseDownCapture}\n        onClickCapture={tooltipAreaClicked}\n        css={{ height: '100%' }}\n      >\n        {children}\n      </div>\n      {/* The element below houses the tooltip/context menu */}\n      <div css={styles.contextMenuContainer} className={className} ref={containerRef}>\n        {displayTooltip && (\n          <div\n            ref={ctxMenuRef}\n            css={styles.contextMenuWrapper}\n            data-testid=\"tooltip-container\"\n            style={{\n              userSelect: contextMenuShown === ContextMenuVisibility.HOVER ? 'none' : 'unset',\n              pointerEvents: contextMenuShown === ContextMenuVisibility.HOVER ? 'none' : 'all',\n            }}\n          >\n            {/* A tooltip body component passed from the props */}\n            <Component\n              runUuid={hoveredRunUuid}\n              hoverData={additionalAxisData}\n              chartData={tooltipDisplayParams}\n              contextData={contextData}\n              isHovering={contextMenuShown === ContextMenuVisibility.HOVER}\n              closeContextMenu={closeContextMenu}\n              mode={mode}\n            />\n          </div>\n        )}\n      </div>\n    </RunsChartsTooltipContext.Provider>\n  );\n};\n\n/**\n * This hook is used to wire up tooltip to particular experiment runs chart.\n * Returns \"setTooltip\" and \"resetTooltip\" functions that should be called\n * upon chart's \"onHover\" and \"onUnhover\" events. \"setTooltip\" function consumes\n * the runUuid that was hovered on.\n */\nexport const useRunsChartsTooltip = <\n  // Type for local hover data passed to the tooltip, e.g. configuration of particular chart\n  TChart = any,\n  TAxisData = any,\n>(\n  chartData?: TChart,\n  mode = RunsChartsTooltipMode.Simple,\n) => {\n  const contextValue = useContext(RunsChartsTooltipContext);\n\n  if (!contextValue) {\n    throw new Error(\n      'You must invoke useRunsChartsTooltip() in a component being ancestor of <RunsChartsTooltipWrapper />!',\n    );\n  }\n\n  const { updateTooltip, resetTooltip, selectedRunUuid, closeContextMenu, destroyTooltip } = contextValue;\n  const { highlightDataTrace } = useRunsChartTraceHighlight();\n\n  const setTooltip = useCallback(\n    (runUuid = '', event?: RunsChartsChartMouseEvent, additionalAxisData?: TAxisData) => {\n      updateTooltip(runUuid, mode, chartData, event, additionalAxisData);\n      highlightDataTrace(runUuid, {\n        source: ChartsTraceHighlightSource.CHART,\n      });\n    },\n    [updateTooltip, chartData, mode, highlightDataTrace],\n  );\n\n  const resetTooltipWithHighlight = useCallback(() => {\n    resetTooltip();\n    highlightDataTrace(null);\n  }, [resetTooltip, highlightDataTrace]);\n\n  return { setTooltip, resetTooltip: resetTooltipWithHighlight, selectedRunUuid, closeContextMenu, destroyTooltip };\n};\n\nconst styles = {\n  contextMenuContainer: {\n    overflow: 'hidden',\n    top: 0,\n    left: 0,\n    width: '100%',\n    height: '100%',\n    position: 'fixed',\n    pointerEvents: 'none',\n    zIndex: RUNS_CHARTS_UI_Z_INDEX.TOOLTIP_CONTAINER,\n  } as Interpolation<Theme>,\n  contextMenuWrapper: (theme: Theme) => ({\n    zIndex: RUNS_CHARTS_UI_Z_INDEX.TOOLTIP,\n    position: 'absolute' as const,\n    padding: theme.spacing.sm,\n    backgroundColor: theme.colors.backgroundPrimary,\n    border: `1px solid ${theme.colors.border}`,\n    left: -999,\n    top: -999,\n    borderRadius: theme.general.borderRadiusBase,\n    boxShadow: theme.general.shadowLow,\n  }),\n  overlayElement: (): Interpolation<Theme> => ({\n    '&::after': {\n      content: '\"\"',\n      position: 'absolute',\n      left: 0,\n      top: 0,\n      right: 0,\n      bottom: 0,\n      backgroundColor: 'transparent',\n    },\n  }),\n};\n","var _path, _rect, _rect2, _rect3, _rect4;\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nimport * as React from \"react\";\nfunction SvgChartBar({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 18,\n    height: 16,\n    viewBox: \"0 0 18 16\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M1 0.813599V15.1865H17\",\n    stroke: \"#A3AEB8\",\n    strokeLinecap: \"round\"\n  })), _rect || (_rect = /*#__PURE__*/React.createElement(\"rect\", {\n    x: 3.16943,\n    y: 10.5763,\n    width: 2.16949,\n    height: 3.25424,\n    fill: \"#338ECC\"\n  })), _rect2 || (_rect2 = /*#__PURE__*/React.createElement(\"rect\", {\n    x: 6.42371,\n    y: 5.15259,\n    width: 2.16949,\n    height: 8.67797,\n    fill: \"#338ECC\"\n  })), _rect3 || (_rect3 = /*#__PURE__*/React.createElement(\"rect\", {\n    x: 9.67798,\n    y: 8.40686,\n    width: 2.16949,\n    height: 5.42373,\n    fill: \"#338ECC\"\n  })), _rect4 || (_rect4 = /*#__PURE__*/React.createElement(\"rect\", {\n    x: 12.9323,\n    y: 1.89832,\n    width: 2.16949,\n    height: 11.9322,\n    fill: \"#338ECC\"\n  })));\n}\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgChartBar);\nexport default __webpack_public_path__ + \"static/media/chart-bar.0fd4a63680fba840a7b69fbf07969f79.svg\";\nexport { ForwardRef as ReactComponent };","import { useMemo } from 'react';\nimport type { RunGroupingAggregateFunction } from '../../experiment-page/utils/experimentPage.row-types';\nimport invariant from 'invariant';\nimport {\n  removeOutliersFromMetricHistory,\n  type RunsChartsRunData,\n} from '../../runs-charts/components/RunsCharts.common';\nimport {\n  createAggregatedMetricHistory,\n  createValueAggregatedMetricHistory,\n  type SyntheticMetricHistory,\n} from '../../experiment-page/utils/experimentPage.group-row-utils';\nimport { uniq, type Dictionary, compact, pick, isNil } from 'lodash';\nimport type { SampledMetricsByRun } from '../../runs-charts/hooks/useSampledMetricHistory';\nimport type { MetricHistoryByName } from '../../../types';\n\nexport interface UseGroupedChartRunDataParams {\n  ungroupedRunsData: RunsChartsRunData[];\n  enabled: boolean;\n  aggregateFunction?: RunGroupingAggregateFunction;\n  metricKeys: string[];\n  sampledDataResultsByRunUuid: Dictionary<SampledMetricsByRun>;\n  selectedXAxisMetricKey?: string;\n  ignoreOutliers: boolean;\n}\n\n/**\n * Returns a new array of RunsChartsRunData with aggregated metrics for grouped runs.\n * In order to make rendering of the confidence interval possible, the returned dataset contains\n * min, max and average values for each metric while respecting the metric history.\n */\nexport const useGroupedChartRunData = ({\n  ungroupedRunsData,\n  enabled,\n  aggregateFunction,\n  metricKeys,\n  sampledDataResultsByRunUuid,\n  selectedXAxisMetricKey,\n  ignoreOutliers,\n}: UseGroupedChartRunDataParams) => {\n  return useMemo(() => {\n    if (!enabled || !aggregateFunction) {\n      return ungroupedRunsData;\n    }\n\n    // Extract groups from the result set and calculate aggregated metrics\n    const perGroupData: RunsChartsRunData[] = ungroupedRunsData\n      .filter(({ groupParentInfo }) => groupParentInfo)\n      .map((group) => {\n        const aggregatedMetricsHistory: Record<string, SyntheticMetricHistory> = {};\n        metricKeys.forEach((metricKey) => {\n          invariant(group.groupParentInfo, 'groupParentInfo should be defined');\n\n          const aggregatedRunUuidsInGroup =\n            group.groupParentInfo.runUuidsForAggregation ?? group.groupParentInfo.runUuids;\n\n          let aggregatedMetricsHistoryForMetric;\n          if (!isNil(selectedXAxisMetricKey)) {\n            aggregatedMetricsHistoryForMetric = createValueAggregatedMetricHistory(\n              pick(sampledDataResultsByRunUuid, aggregatedRunUuidsInGroup),\n              metricKey,\n              selectedXAxisMetricKey,\n              ignoreOutliers,\n            );\n          } else {\n            const metricsHistoryInGroup = compact(\n              aggregatedRunUuidsInGroup.flatMap((runUuid) => {\n                const metricsHistory = sampledDataResultsByRunUuid[runUuid]?.[metricKey]?.metricsHistory;\n                if (ignoreOutliers) {\n                  return metricsHistory ? removeOutliersFromMetricHistory(metricsHistory) : undefined;\n                }\n                return metricsHistory;\n              }),\n            );\n\n            // Get all step numbers from all runs in the group\n            const steps = uniq(metricsHistoryInGroup.map((h) => h.step)).sort((a, b) => a - b);\n\n            aggregatedMetricsHistoryForMetric = createAggregatedMetricHistory(steps, metricKey, metricsHistoryInGroup);\n          }\n\n          aggregatedMetricsHistory[metricKey] = aggregatedMetricsHistoryForMetric;\n        });\n        const metricsHistory = metricKeys.reduce<MetricHistoryByName>((acc, key) => {\n          const history = aggregatedMetricsHistory[key][aggregateFunction];\n          if (history && history.length > 0) {\n            acc[key] = history;\n          }\n          return acc;\n        }, {});\n\n        return {\n          ...group,\n          metricsHistory,\n          aggregatedMetricsHistory,\n        };\n      });\n\n    const ungroupedRuns = ungroupedRunsData.filter(({ belongsToGroup }) => belongsToGroup === false);\n\n    return [...perGroupData, ...ungroupedRuns];\n  }, [\n    metricKeys,\n    sampledDataResultsByRunUuid,\n    ungroupedRunsData,\n    enabled,\n    aggregateFunction,\n    selectedXAxisMetricKey,\n    ignoreOutliers,\n  ]);\n};\n","// eslint-disable-next-line import/no-extraneous-dependencies\nimport { type DragDropManager, createDragDropManager } from 'dnd-core';\nimport { useLayoutEffect, useRef, useState } from 'react';\nimport { useDrag, useDrop, DndProvider } from 'react-dnd';\nimport { HTML5Backend } from 'react-dnd-html5-backend';\n\nexport interface useDragAndDropElementProps {\n  /**\n   * Unique drag element identifier, used in drop events\n   */\n  dragKey: string;\n  /**\n   * Group key - items are droppable only within a single group\n   */\n  dragGroupKey: string;\n  /**\n   * Callback function, conveys both dragged and target element key\n   */\n  onDrop: (draggedKey: string, targetDropKey: string) => void;\n\n  /**\n   * If true, drag and drop will be disabled\n   */\n  disabled?: boolean;\n}\n\ninterface DraggedItem {\n  key: string;\n  groupKey: string;\n}\n\n/**\n * A hook enabling drag-and-drop capabilities for any component.\n * Used component will serve as both DnD source and target.\n */\nexport const useDragAndDropElement = ({\n  dragGroupKey,\n  dragKey,\n  onDrop,\n  disabled = false,\n}: useDragAndDropElementProps) => {\n  const dropListener = useRef(onDrop);\n\n  dropListener.current = onDrop;\n\n  const [{ isOver, draggedItem }, dropTargetRef] = useDrop<\n    DraggedItem,\n    never,\n    { isOver: boolean; draggedItem: DraggedItem }\n  >(\n    {\n      canDrop: () => !disabled,\n      accept: `dnd-${dragGroupKey}`,\n      drop: ({ key: sourceKey }: { key: string }, monitor) => {\n        if (sourceKey === dragKey || monitor.didDrop()) {\n          return;\n        }\n        dropListener.current(sourceKey, dragKey);\n      },\n      collect: (monitor) => ({ isOver: monitor.isOver({ shallow: true }), draggedItem: monitor.getItem() }),\n    },\n    [disabled, dragGroupKey, dragKey],\n  );\n\n  const [{ isDragging }, dragHandleRef, dragPreviewRef] = useDrag(\n    {\n      canDrag: () => !disabled,\n      type: `dnd-${dragGroupKey}`,\n      item: { key: dragKey, groupKey: dragGroupKey },\n      collect: (monitor) => ({\n        isDragging: monitor.isDragging(),\n      }),\n    },\n    [disabled, dragGroupKey, dragKey],\n  );\n\n  const isDraggingOtherGroup = Boolean(draggedItem && draggedItem.groupKey !== dragGroupKey);\n\n  return { dropTargetRef, dragHandleRef, dragPreviewRef, isDragging, isOver, isDraggingOtherGroup };\n};\n\n/**\n * Create a scoped DndProvider that will limit its functionality to a single root element.\n * It should prevent HTML5Backend collisions, see:\n * https://github.com/react-dnd/react-dnd/blob/7c88c37489a53b5ac98699c46a506a8e085f1c03/packages/backend-html5/src/HTML5BackendImpl.ts#L107-L109\n */\nexport const DragAndDropProvider: React.FC<React.PropsWithChildren<unknown>> = ({ children }) => {\n  const rootElementRef = useRef<HTMLDivElement>(null);\n  const [manager, setManager] = useState<DragDropManager | null>(null);\n\n  useLayoutEffect(() => {\n    const rootElement = rootElementRef.current;\n    const dragDropManager = createDragDropManager(HTML5Backend, undefined, { rootElement });\n    setManager(dragDropManager);\n    return () => {\n      dragDropManager.getBackend().teardown();\n    };\n  }, []);\n\n  return (\n    <div css={{ display: 'contents' }} ref={rootElementRef}>\n      {manager && <DndProvider manager={manager}>{children}</DndProvider>}\n    </div>\n  );\n};\n","import type { PlotMouseEvent } from 'plotly.js';\nimport { useEffect, useRef } from 'react';\n\n/**\n * Unfortunately plotly.js memorizes first onHover callback given on initial render,\n * so in order to achieve updated behavior we need to wrap each onHover callback with an\n * immutable callback that will call mutable implementation.\n */\nexport const useMutableChartHoverCallback = <T extends (event: Readonly<PlotMouseEvent>) => void>(callback: T) => {\n  const mutableRef = useRef<T>(callback);\n\n  useEffect(() => {\n    mutableRef.current = callback;\n  }, [callback]);\n\n  return (event: Readonly<PlotMouseEvent>) => {\n    mutableRef.current(event);\n  };\n};\n","import { ImageEntity } from '@mlflow/mlflow/src/experiment-tracking/types';\nimport type { RunsChartsRunData } from '../components/RunsCharts.common';\n\nexport const useImageSliderStepMarks = ({\n  data,\n  selectedImageKeys,\n}: {\n  data: RunsChartsRunData[];\n  selectedImageKeys: string[];\n}) => {\n  const stepMarks = data.reduce((acc, run: RunsChartsRunData) => {\n    for (const imageKey of Object.keys(run.images)) {\n      if (selectedImageKeys?.includes(imageKey)) {\n        const metadata = run.images[imageKey];\n        for (const meta of Object.values(metadata)) {\n          if (meta.step !== undefined) {\n            acc[meta.step] = {\n              style: { display: 'none' },\n              label: '',\n            };\n          }\n        }\n      }\n    }\n    return acc;\n  }, {} as Record<number, any>);\n\n  return {\n    stepMarks,\n    maxMark: Math.max(...Object.keys(stepMarks).map(Number)),\n    minMark: Math.min(...Object.keys(stepMarks).map(Number)),\n  };\n};\n","var _rect, _line, _line2, _line3;\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nimport * as React from \"react\";\nfunction SvgChartImage({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 16,\n    height: 16,\n    viewBox: \"0 0 16 16\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _rect || (_rect = /*#__PURE__*/React.createElement(\"rect\", {\n    x: 0.5,\n    y: 0.5,\n    width: 15,\n    height: 15,\n    stroke: \"#C4C4C4\"\n  })), _line || (_line = /*#__PURE__*/React.createElement(\"line\", {\n    x1: 8.5,\n    y1: 0.800049,\n    x2: 8.5,\n    y2: 16,\n    stroke: \"#C4C4C4\"\n  })), _line2 || (_line2 = /*#__PURE__*/React.createElement(\"line\", {\n    x1: 16,\n    y1: 5.69995,\n    x2: -2.63656e-8,\n    y2: 5.69995,\n    stroke: \"#C4C4C4\"\n  })), _line3 || (_line3 = /*#__PURE__*/React.createElement(\"line\", {\n    x1: 16,\n    y1: 10.9,\n    x2: -2.63656e-8,\n    y2: 10.9,\n    stroke: \"#C4C4C4\"\n  })));\n}\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgChartImage);\nexport default __webpack_public_path__ + \"static/media/chart-image.cc434c4dc50780966344e2385a15f8fe.svg\";\nexport { ForwardRef as ReactComponent };"],"names":["findChartStepsByTimestampForRuns","sampledMetrics","runUuids","metricKey","range","stepRangesPerRun","compact","map","runUuid","_sampledMetrics$runUu","metricHistoryForRun","findChartStepsByTimestamp","currentMetricHistory","useDefaultIfNotFound","flatHistory","orderBy","values","metricsHistory","flat","length","lowerBound","Date","valueOf","upperBound","lowerEntry","first","undefined","index","entry","timestamp","upperEntry","last","isUndefined","step","min","bound","max","findAbsoluteTimestampRangeForRelativeRange","currentlyVisibleMetrics","relativeRange","multiplier","_minBy","runData","_","runMetrics","visibleMetricHistoryForRun","flatMap","metric","_metric$metricsHistor","timestampOffset","minBy","getV2ChartTitle","cardConfig","shouldEnableChartExpressions","yAxisKey","RunsChartsLineChartYAxisType","EXPRESSION","_cardConfig$yAxisExpr","expressions","yAxisExpressions","exp","expression","join","selectedMetricKeys","SUPPORTED_DOWNLOAD_FORMATS","RunsChartsLineChartCard","config","chartRunData","onDelete","onEdit","onDownloadFullMetricHistoryCsv","groupBy","fullScreen","setFullScreenChart","autoRefreshEnabled","hideEmptyCharts","globalLineChartConfig","isInViewport","isInViewportProp","isInViewportDeferred","isInViewportDeferredProp","positionInSection","reorderProps","_config$ignoreOutlier","xAxisKey","selectedXAxisMetricKey","lineSmoothness","useLineChartGlobalConfig","toggleFullScreenChart","useCallback","title","subtitle","slicedRuns","useMemo","filter","hidden","reverse","isGrouped","some","r","groupParentInfo","isEmptyDataset","_config$selectedMetri","metricKeys","metricsInRuns","metrics","Object","keys","intersection","uniq","runUuidsToFetch","g","belongsToGroup","_r$runInfo","runInfo","_r$runInfo2","yAxisKeys","_config$yAxisExpressi","fallback","_config$selectedMetri2","reduce","acc","variables","forEach","variable","add","Set","Array","from","getYAxisKeys","xAxisKeys","concat","setTooltip","resetTooltip","destroyTooltip","selectedRunUuid","useRunsChartsTooltip","RunsChartsTooltipMode","MultipleTracesWithScanline","aggregateFunction","sampledMetricsByRunUuid","useSelector","state","pick","entities","shallowEqual","yRangeLocal","setYRangeLocal","useState","yMin","yMax","setOffsetTimestamp","stepRange","xRangeLocal","setXRangeLocal","useCompareRunChartSelectedRange","scaleType","xMin","xMax","offsetTimestamp","RunsChartsLineChartXAxisType","TIME","isString","TIME_RELATIVE","isNumber","STEP","Math","floor","ceil","xAxisScaleType","resultsByRunUuid","isLoading","isRefreshing","useSampledMetricHistory","enabled","maxResults","useEffect","sampledData","run","key","_resultsByRunUuid$run","_resultsByRunUuid$run2","history","uuid","ignoreOutliers","removeOutliersFromMetricHistory","sampledGroupData","useGroupedChartRunData","ungroupedRunsData","sampledDataResultsByRunUuid","METRIC","chartData","imageDownloadHandler","setImageDownloadHandler","useChartImageDownloadHandler","renderChartBody","renderSkeleton","chartBody","_jsx","css","styles","lineChartCardWrapper","height","children","RunsChartCardLoadingPlaceholder","RunsMetricsLinePlot","runsData","useDefaultHoverBox","onHover","onUnhover","onUpdate","chartLayoutUpdated","layout","yAxisMin","yAxisMax","xAxisMin","xAxisMax","autorange","yAxisAutorange","newYRange","yaxis","isEqual","xAxisAutorange","newXRange","xaxis","ungroupedRunUuids","groupedRunUuids","_groupParentInfo$runU","shouldEnableRelativeTimeDateAxis","TIME_RELATIVE_HOURS","timestampRange","xRange","yRange","displayPoints","onSetDownloadHandler","onClickDownload","format","_config$selectedMetri3","_config$selectedMetri4","savedChartTitle","downloadChartMetricHistoryCsv","d","_d$runInfo","group","_group$groupParentInf","RunsChartCardWrapper","dragGroupKey","RunsChartsChartsDragGroup","GENERAL_AREA","supportedDownloadFormats","isHidden","RunsChartsNoDataFoundIndicator","overflow","_ref","name","_ref2","RunsChartsScatterChartCard","theme","useDesignSystemTheme","datasetName","_jsxs","_css","flex","display","alignItems","gap","spacing","xs","Typography","Text","ellipsis","bold","_Fragment","Tag","componentId","_config$xaxis$dataAcc","_config$yaxis$dataAcc","dataAccessKey","scatterChartCardWrapper","RunsScatterPlot","xAxis","yAxis","paramsToExport","metricsToExport","axis","type","push","downloadChartDataCsv","RunsChartsContourChartCard","zaxis","contourChartCardWrapper","RunsContourPlot","zAxis","_path","_path2","_g","_defs","_extends","assign","bind","n","e","arguments","t","hasOwnProperty","call","apply","SvgParallelChartPlaceholder","titleId","props","svgRef","width","viewBox","fill","xmlns","ref","id","stroke","strokeLinecap","opacity","strokeWidth","x1","y1","x2","y2","gradientUnits","stopColor","offset","ForwardRef","NotConfiguredParallelCoordsPlaceholder","ParallelChartSvg","Title","marginTop","md","color","level","FormattedMessage","defaultMessage","marginBottom","Button","onClick","_ref3","_ref4","UnsupportedDataPlaceholder","textAlign","_ref5","RunsChartsParallelChartCard","updateUIState","useUpdateExperimentViewUIState","configuredChartRunData","showAllRuns","containsStringValues","_config$selectedParam","selectedParams","paramKey","dataTrace","_dataTrace$params$par","isNaN","Number","params","value","updateVisibleOnlySetting","_state$compareRunChar","newCompareRunCharts","compareRunCharts","existingChartConfig","isConfigured","parallelCoordsData","configured","isParallelChartConfigured","processParallelCoordinateData","selectedMetrics","closeContextMenu","containsUnsupportedValues","displaySubtitle","parallelChartCardWrapper","LazyParallelCoordinatesPlot","data","axesRotateThreshold","fullScreenEnabled","tooltip","PARALLEL_CHARTS_AREA","additionalMenuContent","DropdownMenu","Separator","CheckboxItem","checked","ItemIndicator","cursor","NotConfiguredDifferenceChartPlaceholder","RunsChartsDifferenceChartCard","_config$compareGroups","Boolean","compareGroups","confirmChartCardConfiguration","useConfirmChartCardConfigurationFn","showChangeFromBaselineToggle","showChangeFromBaseline","showDifferencesOnlyToggle","showDifferencesOnly","formatMessage","useIntl","DifferenceViewPlot","previewData","setCardConfig","setter","showTooltip","DISABLED_GROUP_WHEN_GROUPBY","includes","chartName","toggles","toggleLabel","currentToggle","setToggle","RunsChartsImageChartCard","containerRef","useRef","containerWidth","setContainerWidth","tmpConfig","setTmpConfig","updateStep","newStep","tmpStepChange","currentConfig","imageKeys","DEFAULT_IMAGE_GRID_CHART_NAME","stepMarks","maxMark","minMark","useImageSliderStepMarks","selectedImageKeys","stepMarkLength","shouldDisplayImageLimitIndicator","tags","LOG_IMAGE_TAG_INDICATOR","NUM_RUNS_TO_SUPPORT_FOR_LOG_IMAGE","flexDirection","sm","ImageGridPlot","justifyContent","LineSmoothSlider","onChange","marks","disabled","onAfterChange","cardBodyToRender","RunsChartsCardRaw","sectionIndex","onStartEditChart","onRemoveChart","canMoveDown","canMoveUp","previousChartUuid","nextChartUuid","onReorderWith","editProps","commonChartProps","RunsChartType","PARALLEL","DIFFERENCE","IMAGE","BAR","RunsChartsBarChartCard","LINE","SCATTER","CONTOUR","RunsChartsCard","memo","_path3","SvgChartContour","originalCardConfig","result","globalXAxisKey","useGlobalLineSmoothing","useGlobalXaxisKey","globalSelectedXAxisMetricKey","START_TIME_COLUMN_OFFSET","ALL","LAST_HOUR","LAST_24_HOURS","LAST_7_DAYS","LAST_30_DAYS","LAST_YEAR","SQL_SYNTAX_PATTERN","RegExp","RUNS_AUTO_REFRESH_INTERVAL","detectSqlSyntaxInSearchQuery","searchFilter","test","createQuickRegexpSearchFilter","replace","createSearchRunsParams","experimentIds","searchFacetsState","referenceTime","pageToken","runViewType","lifecycleFilter","LIFECYCLE_FILTER","ACTIVE","ViewType","ACTIVE_ONLY","DELETED_ONLY","runsPinned","createOrderByExpression","orderByKey","orderByAsc","startTimeExpression","createStartTimeExpression","startTime","createFilterExpression","datasetsFilterExpression","shouldUseRegexpBasedAutoRunsSearchFilter","activeFilters","createDatasetsFilterExpression","datasetsFilter","dataset","digest","shouldFetchParents","shouldNestChildrenAndFetchParents","ATTRIBUTE_COLUMN_SORT_KEY","DATE","RUNS_SEARCH_MAX_RESULTS","fetchModelVersionsForRuns","runsPayload","actionCreator","dispatch","runsWithLogModelHistory","EXPERIMENT_LOG_MODEL_HISTORY_TAG","promises","chunk","MAX_RUNS_IN_SEARCH_MODEL_VERSIONS_FILTER","runsChunk","action","run_id","info","getUUID","Promise","all","isSearchFacetsFilterUsed","currentSearchFacetsState","modelVersionFilter","DEFAULT_LIFECYCLE_FILTER","DEFAULT_MODEL_VERSION_FILTER","DEFAULT_START_TIME","DRAGGABLE_CARD_HANDLE_CLASS","DRAGGABLE_CARD_TRANSITION_NAME","DRAGGABLE_CARD_TRANSITION_VAR","RunsChartCardWrapperRaw","noop","onMoveUp","onMoveDown","usingCustomTitle","React","gridTemplateRows","backgroundColor","colors","backgroundPrimary","padding","paddingBottom","border","borderRadius","general","borderRadiusBase","transition","position","marginRight","className","DragIcon","String","withoutMargins","LegacyInfoTooltip","heightSm","Spinner","lg","toggle","Switch","label","icon","FullscreenIcon","Root","modal","Trigger","asChild","OverflowIcon","Content","align","minWidth","Item","chartEntry","chartComponentWrapper","textSecondary","fontSize","verticalAlign","forwardRef","style","PLOT_CONFIG","displaylogo","scrollZoom","modeBarButtonsToRemove","markerSize","margin","runsChartDefaultMargin","layoutHeight","layoutWidth","setContainerDiv","containerDiv","isDynamicSizeSupported","useDynamicPlotSize","plotData","xValues","yValues","tooltipData","_xAxisData","_xAxis$dataAccessKey","_yAxisData","_yAxis$dataAccessKey","displayName","runName","xAxisData","yAxisData","x","y","isNil","primary","customdata","text","hovertemplate","hoverinfo","hoverlabel","runsChartHoverlabel","mode","textposition","marker","size","plotlyThemedLayout","createThemedPlotlyLayout","setLayout","tickfont","template","current","newLayout","setHoveredPointIndex","useRenderRunsChartTraceHighlight","highlightScatterTraces","hoverCallback","points","_points$","_points$$customdata","_points$0$pointIndex","_points$2","pointCustomDataRunUuid","pointIndex","unhoverCallback","mutableHoverCallback","useMutableChartHoverCallback","legendLabelData","getLegendDataFromRuns","dataToExport","trace","createChartImageDownloadHandler","chart","commonRunsChartStyles","chartWrapper","scatterChartHighlightStyles","LazyPlot","useResizeHandler","RunsMetricsLegendWrapper","labelData","TraceLabel","dashStyle","textOverflow","flexShrink","maxWidth","TraceLabelColorIndicator","strokeDasharray","dashType","getDashArray","pathYOffset","typography","fontSizeSm","STROKE_WIDTH","RunsMetricsLegend","flexWrap","alignContent","overflowY","overflowX","labelDatum","_labelDatum$uuid","RunsChartsConfigureField","RunsChartsMetricParamSelect","metricKeyList","paramKeyList","isEmpty","LegacySelect","selectFull","dangerouslySetAntdProps","showSearch","OptGroup","Option","makeCanonicalSortKey","param","RunsChartsMetricParamSelectV2","metricOptions","paramOptions","SimpleSelect","target","contentProps","matchTriggerWidth","maxHeight","SimpleSelectOptionGroup","SimpleSelectOption","runsChartsRunCountDefaultOptions","RunsChartsConfigureMetricWithDatasetSelect","metricKeysByDataset","find","RunsChartsConfigureBarChart","onStateChange","_state$dataAccessKey","updateMetric","runsCountToCompare","emptyMetricsList","RunsChartsConfigureParallelChart","updateSelectedParams","updateSelectedMetrics","emptyParamsList","renderMetricSelectorV2","placeholder","ExpressionInput","chartExpression","updateYAxisExpression","removeYAxisExpression","compileExpression","useChartExpressionParser","isValidExpression","setIsValidExpression","Input","compiledExpression","rpn","validateAndUpdate","validationState","CloseIcon","RunsChartsYAxisMetricAndExpressionSelector","usingChartExpressions","temporaryChartExpressions","setTemporaryChartExpressions","updateYAxisExpressionTemporary","newExpressions","removeYAxisExpressionTemporary","splice","handler","setTimeout","clearTimeout","updateYAxisKey","Radio","Group","PlusIcon","addNewYAxisExpressionTemporary","USE_GLOBAL_SETTING_KEY","renderXAxisMetricSelector","updateSelectedXAxisMetricKey","preventDefault","stopPropagation","safeLog","log10","safePow","pow","RunsChartsConfigureLineChart","_state$range","_state$range2","_state$range3","_state$range4","_state$range5","_state$range6","_state$range7","_state$range8","intl","localAxisRange","setLocalAxisRange","updateXAxisKey","useGlobal","selectedYAxisMetricKey","isInvalidLogValue","updateXAxisScaleType","isLogType","newXMin","newXMax","prev","updateYAxisType","newYMin","newYMax","updateIgnoreOutliers","updateSmoothing","updateXAxisWhenConfirmed","inTransitionState","updateYAxisWhenConfirmed","a","b","invalidMessage","FormUI","Message","message","METRIC_AXIS_PREFIX","textOverflowMode","startsWith","slice","Tooltip","content","side","QuestionMarkIcon","timeStepQuestionMarkIcon","LegacyTooltip","placement","updateXAxisScaleMin","updateXAxisScaleMax","activeLabel","inactiveLabel","disabledLabel","paddingTop","updateYAxisScaleMin","updateYAxisScaleMax","Spacer","delayDuration","SegmentedControlGroup","SegmentedControlButton","InfoSmallIcon","svg","RunsChartsConfigureLineChartPreview","connect","mapStateToProps","metricsByRunUuid","areStatesEqual","nextState","prevState","RunsChartsConfigureLineChartPreviewImpl","_cardConfig$ignoreOut","_cardConfig$range","_cardConfig$range2","_cardConfig$range3","_cardConfig$range4","_r$runInfo$runUuid","_g$runUuid","metricKeysToFetch","_cardConfig$selectedM","checkValidRange","rangeMin","rangeMax","RunsChartsConfigureContourChart","updateAxis","canonicalKey","isCanonicalSortKeyOfType","extractCanonicalSortKey","_state$xaxis","_state$yaxis","_state$zaxis","firstMetric","firstParam","RunsChartsConfigureScatterChart","RunsChartsConfigureDifferenceChart","updateCompareGroups","compareGroup","updateChartName","updateShowChangeFromBaseline","updateShowDifferencesOnly","Checkbox","defaultValue","DifferenceCardConfigCompareGroup","_state$compareGroups","groupedCondition","isChecked","RunsChartsConfigureImageChart","imageKeyList","handleUpdate","imageKey","_currentConfig$imageK","_currentConfig$imageK2","DialogCombobox","multiSelect","DialogComboboxTrigger","onClear","handleClear","DialogComboboxContent","DialogComboboxOptionList","_state$imageKeys","DialogComboboxOptionListCheckboxItem","RunsChartsConfigureScatterChartWithDatasets","_metricKeysByDataset$","JSON","stringify","_paramKeyList$map","handleChange","foundMetric","foundParam","_state$axis","getSelectedValue","foundMetricOption","foundParamOption","selectedXValue","selectedYValue","previewComponentsMap","RunsChartsConfigureBarChartPreview","_cardConfig$dataAcces","dataKey","RunsMetricsBarPlot","displayRunNames","displayMetricKey","barChartCardDefaultMargin","RunsChartsConfigureContourChartPreview","RunsChartsConfigureParallelChartPreview","_cardConfig$selectedP","filteredData","Empty","description","image","NoIcon","RunsChartsConfigureScatterChartPreview","RunsChartsConfigureImageChartPreview","_cardConfig$imageKeys","RunsChartsConfigureModal","onCancel","onSubmit","supportedChartTypes","isChartTypeSupported","borderStyle","actionDefaultBorderDefault","currentFormState","setCurrentFormState","isEditing","updateChartType","emptyChartCard","RunsChartsCardConfig","getEmptyChartCardByType","images","sort","disableSaveButton","_lineCardConfig$selec","Modal","visible","onOk","okButtonProps","cancelText","okText","bodyStyle","gridTemplateColumns","borderTop","borderBottom","borderRight","chartType","chartTypeOption","ChartBarIcon","ChartScatterIcon","ChartLineIcon","ChartParallelIcon","ChartContourIcon","ChartDifferenceIcon","ChartImageIcon","RunsChartsTooltipWrapper","contextData","runs","component","RunsChartsTooltipBody","hoverOnly","PreviewComponent","renderPreviewChartType","iconSize","field","RUNS_CHARTS_UI_Z_INDEX","CARD_PREVIEW","CARD_DRAGGED","TOOLTIP_CONTAINER","SEARCH_BAR","TOOLTIP","ParallelCoordinatesPlot","Suspense","LegacySkeleton","ExperimentPageUISetStateContext","ExperimentPageUIStateContextProvider","setUIState","Provider","heightBuffer","GET_METRIC_HISTORY_BULK_INTERVAL","gql","shouldUseGraphql","shouldEnableGraphQLSampledMetrics","legacyResult","useDispatch","store","rangeKey","createChartAxisRangeKey","anyRunRefreshing","anyRunLoading","returnValues","metricsByMetricKey","dataByMetricKey","_store$entities$sampl","_store$entities$sampl2","runMetricData","loading","refreshing","keyBy","left","right","refreshFn","runUuidsChunk","getSampledMetricHistoryBulkAction","refreshTimeoutRef","autoRefreshEnabledRef","runUuidsSerialized","hookUnmounted","fetchMetricsFn","async","isAutoRefreshing","split","scheduleRefresh","Utils","logErrorAndNotifyUser","window","EXPERIMENT_RUNS_METRIC_AUTO_REFRESH_INTERVAL","then","refresh","useSampledMetricHistoryREST","graphQlResult","useSampledMetricHistoryGraphQL","_range$","_range$2","_data$mlflowGetMetric6","refetch","startPolling","stopPolling","networkStatus","error","useQuery","skip","notifyOnNetworkStatusChange","pollInterval","onCompleted","_data$mlflowGetMetric","_data$mlflowGetMetric2","_data$mlflowGetMetric3","_data$mlflowGetMetric4","mlflowGetMetricHistoryBulkInterval","apiError","code","displayGlobalErrorNotification","Error","runIds","startStep","endStep","_data$mlflowGetMetric5","metricsByRunId","runId","_metricsByRunId$runId","NetworkStatus","setVariables","poll","useExperimentIds","useParams","location","useLocation","normalizedLocationSearch","decodeURIComponent","search","compareExperimentIdsQueryParam","queryParams","qs","substring","experimentIdsRaw","toString","experimentId","parse","highlightChartTracesFn","traceSelector","parentSelector","parent","hoverIndex","selectIndex","numberOfBands","_parent$querySelector","_parent$querySelector3","deselected","_parent$querySelector2","_parent$querySelector4","_parent$querySelector5","_parent$querySelector6","querySelector","classList","remove","querySelectorAll","bandTraceIndex","highlightBarTraces","highlightLineTraces","highlightFn","lastRunsData","selectedTraceIndex","findIndex","hoveredPointIndex","onHighlightChange","useRunsChartTraceHighlight","shouldEnableUnifiedChartDataTraceHighlight","lastSelectedTraceIndex","highlightChangeListener","newExtern","externallyHighlightedRunIndex","ChartsTraceHighlightSource","RunsChartsSetHighlightContext","createContext","highlightDataTrace","RunsChartsSetHighlightContextProvider","highlightListenerFns","block","contextValue","traceUuid","shouldBlock","source","notifyListeners","fn","listener","createElement","useContext","DIFFERENCE_CHART_DEFAULT_EMPTY_VALUE","getDifferenceChartDisplayedValue","val","places","toFixed","DifferenceChartCellDirection","isDifferent","abs","DIFFERENCE_PLOT_EXPAND_COLUMN_ID","DIFFERENCE_PLOT_HEADING_COLUMN_ID","getDifferencePlotJSONRows","getChildren","parsedRowWithoutHeadingCol","schema","_parsedRowWithoutHead","newParsedRow","_parsedRowWithoutHead2","row","jsonSchema","isAllJson","parsedRow","json","parsed","isArray","validateParseJSON","commonSchema","extractMaximumCommonSchema","schema1","schema2","collectKeys","CellDifference","direction","paragraphColor","NEGATIVE","ArrowDownIcon","POSITIVE","ArrowUpIcon","SAME","DashIcon","actionDisabledBackground","borders","borderRadiusSm","userSelect","DifferencePlotDataCell","getValue","original","column","columnDef","_columnDef$meta","isBaseline","baselineColumnUuid","meta","rowDifference","differenceView","diff","DifferencePlotRunHeaderCell","_columnDef$meta2","traceData","updateBaselineColumnUuid","fontWeight","RunColorPill","ExpandCell","toggleExpand","getCanExpand","getIsExpanded","ChevronDownIcon","ChevronRightIcon","modelMetrics","systemMetrics","parameters","attributes","getDifferenceViewDataGroups","headingColumnId","getMetrics","filterCondition","runDataKeys","runDataAttribute","hasDifference","MLFLOW_SYSTEM_METRIC_PREFIX","getVisibleTagValues","DifferenceCardAttributes","USER","SOURCE","VERSION","MODELS","attribute","attributeData","_runData$runInfo","user","getUser","getSourceName","version","getSourceVersion","models","getLoggedModelsFromTags","baselineColumn","nonBaselineColumns","dataTracesReverse","dataRows","MODEL_METRICS","SYSTEM_METRICS","PARAMETERS","ATTRIBUTES","TAGS","columns","cell","enableResizing","accessorKey","header","_traceData$uuid","expanded","setExpanded","table","useReactTable","getCoreRowModel","getExpandedRowModel","columnResizeMode","enableExpanding","getSubRows","getRowId","getRowCanExpand","subRows","columnPinning","tableContainerRef","getVirtualItems","getTotalSize","useVirtualizer","count","rows","getScrollElement","estimateSize","paddingStart","expandedRows","Table","TableRow","isHeader","getLeafHeaders","isPinned","getIsPinned","TableHeader","setColumnSizing","multiline","getStart","getSize","flexBasis","zIndex","wrapContent","flexRender","getContext","start","transform","getVisibleCells","isNameColumn","TableCell","paddingLeft","depth","_rect","_rect2","_rect3","_rect4","_rect5","_rect6","_rect7","_rect8","_rect9","_rect0","_rect1","_rect10","_rect11","_rect12","_rect13","_rect14","_rect15","_rect16","SvgChartDifference","LocalStorageUtils","getStoreForComponent","componentName","LocalStorageStore","getSessionScopedStoreForComponent","constructor","scope","storageObj","this","localStorage","sessionStorage","loadComponentState","storedVal","getItem","reactComponentStateKey","saveComponentState","stateRecord","targetValue","toJSON","setItem","withScopePrefix","ImageGridSingleKeyPlot","displayRuns","imageMetadata","EmptyImageGridPlot","imageMetadataByStep","metadata","tableBackgroundUnselectedHover","lineHeightMd","whiteSpace","ImagePlotWithHistory","metadataByStep","ImageGridMultipleKeyPlot","grid","scrollable","MIN_GRID_IMAGE_SIZE","containsLoggedImages","filteredPreviewData","MetricChartsAccordion","activeKey","onActiveKeyChange","disableCollapse","getPrefixedClassName","clsPrefix","classItem","classItemActive","classHeader","classContent","classContentBox","classArrow","textPrimary","outlineColor","outlineStyle","lineHeight","Accordion","dangerouslyAppendEmotionCSS","expandIconPosition","RunsChartsAddChartMenu","onAddChart","addChartButton","IconWrapper","iconWrapper","RunsChartsSectionHeader","section","sectionChartsLength","addNewChartCard","onDeleteSection","onAddSection","editSection","onSetEditSection","onSetSectionName","onSectionReorder","isExpanded","hideExtraControls","tmpSectionName","setTmpSectionName","isDraggingHandle","setIsDraggingHandle","sectionNameRef","confirmButtonRef","sectionNameWidth","setSectionNameWidth","isDeleteSectionModalOpen","setIsDeleteSectionModalOpen","trim","resizeObserver","ResizeObserver","contentRect","observe","disconnect","isCurrentlyEdited","isCurrentlyHovered","setIsCurrentlyHovered","dragHandleRef","dragPreviewRef","dropTargetRef","isOver","isDragging","useDragAndDropElement","dragKey","onDrop","role","visibility","onMouseMove","onMouseLeave","element","inset","isDarkMode","blue800","blue100","blue400","EDITABLE_LABEL_PADDING_WIDTH","autoFocus","onMouseDown","onMouseUp","onDoubleClick","background","backgroundSecondary","lineHeightBase","onKeyDown","onPressEnter","minHeight","onBlur","relatedTarget","PencilIcon","CheckIcon","rotate","top","addSectionAbove","addSectionBelow","deleteSection","DangerModal","deleteModalConfirm","deleteModalCancel","cx","alignSelf","marginLeft","sharedObserver","entryCallbackMap","WeakMap","observeElement","callback","_sharedObserver","IntersectionObserver","entries","entryCallback","get","isIntersecting","set","_sharedObserver2","unobserve","delete","RunsChartsDraggableCard","_translateBy$x","_translateBy$y","setElementRef","useIsInViewport","setIsInViewport","translateBy","onResizeStart","onResize","onResizeStop","cardProps","deferredValue","useDebounce","resizeWidth","setResizeWidth","resizeHeight","setResizeHeight","setIsDragging","origin","setOrigin","setDraggedCardUuid","onDropChartCard","useRunsChartsDraggableGridActionsContext","draggedCardElementRef","onStartDrag","onDrag","onStopDrag","onResizeStartInternal","_draggedCardElementRe","rect","getBoundingClientRect","_rect$width","_rect$height","onResizeInternal","DraggableCore","enableUserSelectHack","onStart","onStop","handle","Resizable","ResizableHandle","pointerEvents","overflowing","bottom","actionDefaultIconDefault","RunsChartsDraggablePreview","actionDefaultBackgroundHover","borderColor","borderWidth","rowHeightSuggestions","PlaceholderSymbol","Symbol","RunsChartsDraggableCardsGridSection","cardsConfig","sectionConfig","sectionId","_sectionConfig$column","_sectionConfig$cardHe","useMediaQuery","responsive","breakpoints","cardHeight","gridBoxRef","draggedCardUuid","useRunsChartsDraggableGridStateContext","setTargetSection","setTargetPosition","onSwapCards","useUpdateRunsChartsUIConfiguration","setColumns","columnCount","_current$compareRunSe","_current$compareRunSe2","compareRunSections","s","setCardHeight","_current$compareRunSe3","_current$compareRunSe4","lastElementCount","setPositionInSection","resizePreview","setResizePreview","findCoords","_gridBoxRef$current","rowCount","col","colGapsCount","passedColGaps","passedRowGaps","cardsToRender","isEmptyChartCard","cardTransforms","newArray","fromIndex","toIndex","newIndex","indexOf","oldIndex","oldCoords","newCoords","deltaX","deltaY","dragPreview","_gridBoxRef$current2","_rect$width2","mouseMove","pos","clientY","clientX","columnSuggestions","setColumnSuggestions","immediateColSuggestion","immediateRowSuggestion","_gridBoxRef$current3","gridBoxRefSize","getColumnSuggestions","gapSize","cols","_immediateColSuggesti","_immediateRowSuggesti","columnSuggestion","curr","rowHeightSuggestion","Global","array","_cardConfig$uuid","_cardConfig$uuid2","_array","_array2","RunsChartsSection","sectionCharts","reorderCharts","insertCharts","isMetricHistoryLoading","startEditChart","removeChart","getChartMetricsAndParams","barConfig","lineConfig","scatterConfig","toLowerCase","parallelConfig","contourConfig","RunsChartsSectionAccordion","noRunsSelectedEmptyState","setEditSection","onActivePanelChange","newCompareRunPanels","shouldDisplaySection","chartConfig","isGenerated","metricSectionId","deleted","newCompareRunSections","isAccordionReordered","addSection","above","idx","newSection","isReordered","appendSection","setSectionName","sectionReorder","sourceSectionId","targetSectionId","sourceSectionIdx","targetSectionIdx","sourceSection","noRunsSelected","sectionsToRender","chartsToRender","compareRunChartsFiltered","chartMatchesFilter","filterRegex","metricOrParam","match","sectionsWithCharts","has","isSearching","Panel","_path4","_path5","SvgChartParallel","MATCH_VARIABLE_REGEX","Operator","Parenthesis","VariableParenthesis","precedence","ADD","SUBTRACT","MULTIPLY","DIVIDE","POWER","NEGATIVE_SIGN","POSITIVE_SIGN","isBinaryOperator","char","isUnaryOperator","variableStringToIndex","popAndValidate","stack","operandCount","lastElement","pop","flushUnaryOperators","output","noVariableExpression","parsedExpression","matches","dedupMatches","matchesMap","parseVariablesAndReplaceWithIndex","cleanedExpression","incrementOperand","i","isUnarySign","OPEN","CLOSE","num","periodMatches","floatNum","parseFloat","op1","isHigherPrecedence","toRPN","parseInt","evaluateExpression","tokens","token","fromRPN","experimentChartImageDefaultDownloadLayout","paper_bgcolor","plot_bgcolor","experimentChartImageDefaultDownloadSettings","experimentChartImageDefaultDownloadPlotConfig","downloadImage","filename","downloadHandlerRef","downloadHandler","setDownloadHandler","setDownloadHandlerCached","existingHandler","chartTitle","_downloadHandlerRef$c","l","pad","_config$dataAccessKey","barChartCardWrapper","_customMetricBehavior3","_customMetricBehavior4","customMetricBehaviorDefs","_customMetricBehavior","_customMetricBehavior2","runsToExport","PlotlyLikeFormattedTime","FormattedDate","year","month","day","FormattedTime","hour","hourCycle","minute","second","fractionalSecondDigits","PlotlyLikeFormattedTimestamp","RunsMultipleTracesTooltipBody","hoverData","tooltipLegendItems","hoveredDataPoint","singleTraceHoverData","xValue","xAxisKeyLabel","metricEntity","hoveredTraceUuid","displayedXValueLabel","getChartAxisLabelDescriptor","columnGap","rowGap","textPlaceholder","RunsChartsUIConfigurationContext","RunsChartsUIConfigurationContextProvider","updateChartsUIState","useReorderRunsChartsFn","sourceChartUuid","targetChartUuid","_current$compareRunCh","newChartsOrder","newSectionsState","indexSource","c","indexTarget","sourceChart","targetChart","isSameMetricSection","newSourceChart","configuredCard","serializedCard","serialize","_current$compareRunCh2","existingChartCard","useInsertRunsChartsFn","_current$compareRunCh3","useRemoveRunsChartFn","configToDelete","_current$compareRunCh4","_current$compareRunCh5","setup","doubleClick","showTips","barWidth","ids","names","_d$metrics$metricKey","normalizeChartValue","textValues","_d$metrics$metricKey3","customMetricBehaviorDef","_d$metrics$metricKey2","valueFormatter","getFixedPointValue","textfont","orientation","hovermode","tickformat","chartAxisTickFormat","showticklabels","fixedrange","event","_points$0$data","yValue","layoutToExport","automargin","highlightStyles","DEFAULT_COLOR_SCALE","reverseScale","runsChartDefaultContourMargin","colorScale","zValues","_xAxisData$xAxis$key","_yAxisData$yAxis$key","_zAxisData$zAxis$key","zAxisData","z","layers","zAxisTitle","line","unshift","connectgaps","contours","coloring","colorscale","reversescale","colorbar","family","ticks","standoff","_scatterPoints$pointI","_customdata","scatterPoints","curveNumber","RunsChartsDraggableGridStateContext","targetSection","RunsChartsDraggableGridActionsContext","RunsChartsDraggableCardsGridContextProvider","visibleChartCards","targetSectionUuid","setTargetSectionUuid","immediateDraggedCardUuid","immediateTargetSectionId","targetLocalPosition","draggedChartUuid","targetPosition","sourceCard","sourceSectionCards","chartCard","resultChartsList","visibleSectionCards","originalIndex","clampedLocalPosition","targetIndex","targetSectionCards","sortBy","_targetSectionCards$i","stateContextValue","actionsContextValue","DragAndDropProvider","createLineChartValuesBox","activeRun","_hoverData$metricEnti","_hoverData$yValue","metricKeyFromConfig","metricValue","getTooltipXValue","_hoverData$xValue","_hoverData$xValue2","ValuesBox","isHovering","createBarChartValuesBox","displayValue","createScatterChartValuesBox","_xaxis$dataAccessKey","_xaxis$dataAccessKey2","_activeRun$metrics$xK","_activeRun$params$xKe","_activeRun$metrics$yK","_activeRun$params$yKe","xKey","yKey","xLabel","yLabel","createContourChartValuesBox","_activeRun$metrics$xK2","_activeRun$params$xKe2","_activeRun$metrics$yK2","_activeRun$params$yKe2","_activeRun$metrics$zK","_activeRun$params$zKe","zKey","zValue","createParallelChartValuesBox","paramsList","metricsList","_getDataTraceLink","onTogglePin","onHideRun","getDataTraceLink","containsMultipleRunsTooltipData","metricSuffix","contentWrapper","colorPill","Link","to","Routes","getRunPageRoute","runLink","actionsWrapper","pinnable","pinned","PinFillIcon","PinIcon","VisibleIcon","SvgChartLine","strokeLinejoin","PLOTLY_DRAGLAYER_SELECTOR","parseMicroseconds","plotlyAxisBoundary","_plotlyAxisBoundary$m","microsecondsString","getCompareValue","getDataTraceForRun","runEntry","lineShape","lineDash","displayOriginalLine","originalLine","_yValues","_runEntry$runInfo","_yValues2","_runEntry$runInfo2","_runEntry$runInfo3","sortedMetricsHistory","getExpressionChartsSortedMetricHistory","xDataPointsPerVariable","_runEntry$metricsHist","elements","compareValue","xDataPoints","xDataPoint","obj","_runEntry$metricsHist2","_elements$find","expressionValue","_sortedMetricsHistory","_sortedMetricsHistory2","ySteps","xValuesWithSteps","prepareXAxisDataForMetricType","stepOrder","xSteps","yValueHistory","orderBySteps","_sortedMetricsHistory3","prepareMetricHistoryByAxisType","firstNonZeroXIndex","optimizedLineShape","containsDuplicateXValues","shouldDisplayMarkers","containsSingleValue","EMA","metricHistory","hovertext","createTooltipTemplate","dash","shape","createFadedTraceColor","dataPoints","stepIndexes","_stepIndexes$a$step","_stepIndexes$b$step","Infinity","axisType","minTimestamp","EPOCH_RELATIVE_TIME","HOUR_IN_MILLISECONDS","datapoint","lockXAxisZoom","dynamicXAxisKey","maxDiff","maxTimestamp","maxBy","LINE_CHART_RELATIVE_TIME_THRESHOLD","getTraceAndOriginalTrace","originalLineProps","lineDashStyles","bandsData","getBandTraceForRun","_runEntry$runInfo4","aggregatedMetricsHistory","xMins","xMaxes","yMins","yMaxes","minReversed","lastNonZeroXIndex","bandValues","fillcolor","plotDataWithBands","xAxisPlotlyType","getXAxisPlotlyType","yAxisParams","xAxisParams","showlegend","updatedLayout","containsMultipleMetricKeys","themedPlotlyLayout","immediateLayout","getLineChartLegendData","scanlineElement","initHandler","updateHandler","updateHandlerMultipleRuns","onPointHover","hoverCallbackMultipleRuns","onPointUnhover","unhoverCallbackMultipleRuns","useRunsMultipleTracesTooltipData","chartBoundaries","containerLeftPixels","plotWidthPixels","plotOffsetPixels","lowerBoundValue","valueRange","mainContainer","dragLayer","initialized","scanlineElementRef","currentHoveredDataPoint","visibleXValues","initializedFigure","setInitializedFigure","immediateHoverData","immediateLegendLabelData","immediateRunsData","immediatePlotData","immediateXValuesData","immediateFigure","setupBoundaries","figure","_figure$layout$xaxis","_figure$layout$xaxis$","_figure$layout$xaxis2","_figure$layout$xaxis3","_lowerBoundary","_upperBoundary","lowerAxisValue","upperAxisValue","lowerBoundary","getTime","upperBoundary","updateContainerPosition","containerRect","dragLayerRect","onUpdatePlotHandler","graphDiv","onInitPlotHandler","requestAnimationFrame","pointerLeavePlotCallback","Element","contains","onPointHoverCallback","_hoveredPoint$curveNu","_hoveredPointData$met","hoveredPoint","hoveredPointData","singleTraceData","onPointUnhoverCallback","getClosestXValue","pointerClientX","boundaries","resultX","currentStep","tooltipDataUpdateHandler","throttle","closestXValue","legendEntry","_correspondingDataTra","_correspondingDataTra2","correspondingDataEntry","correspondingDataTrace","xIndex","leading","windowResizeHandler","hoverHandler","_immediateHoverData$c","_immediateHoverData$c2","closestXValueLeftInPixels","originalEvent","addEventListener","removeEventListener","borderLeft","legend","onInitialized","_circle","_ellipse","_circle2","_circle3","_ellipse2","_ellipse3","SvgChartScatter","cy","rx","ry","fillOpacity","paddingRight","link","chunks","RunsChartsTooltipContext","ContextMenuVisibility","extractHTMLAncestorElement","HTMLElement","currentElement","parentElement","Component","ctxMenuRef","currentPos","currentSnappedCoordinates","setMode","Simple","contextMenuShown","setContextMenuShown","HIDDEN","tooltipDisplayParams","setTooltipDisplayParams","hoveredRunUuid","setHoveredRunUuid","additionalAxisData","setAdditionalAxisData","focusedRunData","mutableContextMenuShownRef","mutableHoveredRunUuid","mutableTooltipDisplayParams","mutableAdditionalAxisData","applyPositioning","isChangingVisibilityMode","targetX","targetY","currentCtxMenu","reposition","menuRect","getCoordinatesForTargetElement","targetElement","_containerRef$current","targetRect","offsetX","offsetY","HOVER","nativeEvent","updateTooltip","additionalRunData","_focusedRunData$curre","VISIBLE","currentRunUuid","mouseDownCapture","button","pageX","pageY","tooltipAreaClicked","clickedInTheSamePlace","_focusedRunData$curre2","useLayoutEffect","domRoot","getRootNode","rootClickListener","_focusedRunData$curre3","capture","_focusedRunData$curre4","force","CHART","displayTooltip","onMouseDownCapture","onClickCapture","contextMenuContainer","contextMenuWrapper","boxShadow","shadowLow","overlayElement","SvgChartBar","invariant","aggregatedRunUuidsInGroup","runUuidsForAggregation","aggregatedMetricsHistoryForMetric","metricsHistoryInGroup","_sampledDataResultsBy","_sampledDataResultsBy2","steps","h","createAggregatedMetricHistory","createValueAggregatedMetricHistory","dropListener","draggedItem","useDrop","canDrop","accept","drop","sourceKey","monitor","didDrop","collect","shallow","useDrag","canDrag","item","groupKey","isDraggingOtherGroup","rootElementRef","manager","setManager","rootElement","dragDropManager","createDragDropManager","HTML5Backend","getBackend","teardown","DndProvider","mutableRef","_line","_line2","_line3","SvgChartImage"],"sourceRoot":""}