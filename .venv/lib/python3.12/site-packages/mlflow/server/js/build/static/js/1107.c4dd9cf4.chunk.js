"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[1107],{3159:function(e,t,s){s.d(t,{S9:function(){return q},PK:function(){return B},nl:function(){return O},I$:function(){return H},Ay:function(){return z}});var i=s(89555),n=s(31014),a=s(10811),r=s(76010),o=s(68621),l=s(26809),c=s(9133),d=s(82645),u=s(26458),h=s(89933),p=s(64912),m=s(68048),g=s(50111);function y({columns:e,values:t,styles:s={},testId:i,scroll:n}){return(0,g.Y)(m.LegacyTable,{className:"mlflow-html-table-view","data-testid":i,dataSource:t,columns:e,scroll:n,size:"middle",pagination:!1,style:s})}var v=s(85017),f=s(48624),x=s(58481);class C extends n.Component{render(){const{runUuids:e}=this.props;return(0,g.Y)("div",{className:"metrics-summary",children:e.length>1?this.renderMetricTables():this.renderRunTable(e[0])})}renderRunTable(e){const{metricKeys:t,latestMetrics:s,minMetrics:i,maxMetrics:n,intl:a}=this.props,r=[{title:a.formatMessage({id:"YINJEO",defaultMessage:"Metric"}),dataIndex:"metricKey",sorter:(e,t)=>e.metricKey<t.metricKey?-1:e.metricKey>t.metricKey?1:0,width:350},...this.dataColumns()];return 0===t.length?null:(0,g.Y)(y,{columns:r,values:A(e,t,s,i,n,a),scroll:{y:300}})}renderMetricTables(){const{runExperimentIds:e,runUuids:t,runDisplayNames:s,metricKeys:i,latestMetrics:a,minMetrics:r,maxMetrics:o,intl:l}=this.props,c=[{title:l.formatMessage({id:"d1Ou4x",defaultMessage:"Run"}),dataIndex:"runLink",sorter:(e,t)=>e.runName<t.runName?-1:e.runName>t.runName?1:0,width:350},...this.dataColumns()];return i.map((i=>(0,g.FD)(n.Fragment,{children:[(0,g.Y)("h1",{children:i}),(0,g.Y)(y,{columns:c,values:M(i,e,t,s,a,r,o,l),scroll:{y:300}})]},i)))}dataColumns(){return[{title:this.props.intl.formatMessage({id:"umeTwG",defaultMessage:"Latest"}),dataIndex:"latestFormatted",sorter:(e,t)=>e.latestValue-t.latestValue,width:200,ellipsis:!0},{title:this.props.intl.formatMessage({id:"iQzwqe",defaultMessage:"Min"}),dataIndex:"minFormatted",sorter:(e,t)=>e.minValue-t.minValue,width:200,ellipsis:!0},{title:this.props.intl.formatMessage({id:"+hkg/y",defaultMessage:"Max"}),dataIndex:"maxFormatted",sorter:(e,t)=>e.maxValue-t.maxValue,width:200,ellipsis:!0}]}}const M=(e,t,s,i,n,a,r,o)=>s.map(((s,l)=>{const c=i[l];return{runName:c,runLink:(0,g.Y)(f.N_,{to:x.Ay.getRunPageRoute(t[s]||"",s),children:c}),key:s,...k(s,e,n,a,r,o)}})),A=(e,t,s,i,n,a)=>t.map((t=>({metricKey:t,key:t,...k(e,t,s,i,n,a)})));var b={name:"nkt64x",styles:"margin-right:10px"},w={name:"nkt64x",styles:"margin-right:10px"},S={name:"nkt64x",styles:"margin-right:10px"};const k=(e,t,s,i,n,a)=>{const r=L(s,e,t),o=L(i,e,t),l=L(n,e,t),c=N(r),d=N(o),u=N(l);return{latestFormatted:(0,g.Y)("span",{title:c,css:b,children:Y(r,a)}),minFormatted:(0,g.Y)("span",{title:d,css:w,children:Y(o,a)}),maxFormatted:(0,g.Y)("span",{title:u,css:S,children:Y(l,a)}),latestValue:c,minValue:d,maxValue:u}},L=(e,t,s)=>e[t]&&e[t][s],N=e=>e&&e.value,Y=(e,t)=>void 0===e?"":t.formatMessage({id:"eQgPEi",defaultMessage:"{value} (step={step})"},{value:e.value,step:e.step}),I=(0,p.Ay)(C);var R=(0,a.Ng)(((e,t)=>{const{runUuids:s}=t,i={},n={},a={},r={};return s.forEach((t=>{const s=(0,u.K4)(t,e);i[t]=s&&s.experimentId,n[t]=(0,v.d0)(t,e),a[t]=(0,v.qP)(t,e),r[t]=(0,v.KQ)(t,e)})),{runExperimentIds:i,latestMetrics:n,minMetrics:a,maxMetrics:r}}))(I),U=s(51079),_=s.n(U),D=s(25869),K=s(16934);const T=({icon:e,className:t,style:s,onClick:i,...n})=>(0,g.Y)(K.B,{componentId:"codegen_mlflow_app_src_common_components_iconbutton.tsx_20",type:"link",className:t,style:{padding:0,...s},onClick:i,...n,children:e});class P extends n.Component{constructor(...e){super(...e),this.renderContent=()=>{const{experimentId:e,runItems:t}=this.props;return(0,g.Y)("div",{children:t.map((({name:t,runId:s,color:i,y:n},a)=>{const o=`${s}-${a}`,l=x.Ay.getRunPageRoute(e,s);return(0,g.Y)(f.N_,{to:l,children:(0,g.FD)("p",{style:{color:i},children:[(0,g.Y)("i",{className:"fa fa-external-link-o",style:{marginRight:5}}),`${t}, ${r.A.formatMetric(n)}`]})},o)}))})},this.renderTitle=()=>{const{handleClose:e}=this.props;return(0,g.FD)("div",{children:[(0,g.Y)("span",{children:"Jump to individual runs"}),(0,g.Y)(T,{icon:(0,g.Y)("i",{className:"fa fa-times"}),onClick:e,style:{float:"right",marginLeft:"7px"}})]})}}componentDidMount(){document.addEventListener("keydown",this.props.handleKeyDown)}componentWillUnmount(){document.removeEventListener("keydown",this.props.handleKeyDown)}render(){const{visible:e,x:t,y:s,handleVisibleChange:i}=this.props;return(0,g.Y)(m.LegacyPopover,{content:this.renderContent(),title:this.renderTitle(),placement:"left",visible:e,onVisibleChange:i,children:(0,g.Y)("div",{style:{left:t,top:s,position:"absolute"}})})}}var E=s(7204),F=s(47019),V=s(32039);const B="line",q="bar",O=1e4,X=1e5,H=e=>{const t=["run_id",...Object.keys(e[0].history[0])],s=e.flatMap((({runUuid:e,history:t})=>t.map((t=>[e,...Object.values(t)]))));return[t].concat(s).map((e=>e.join(","))).join("\n")};class W extends n.Component{constructor(e){super(e),this._isMounted=!1,this.displayPopover=void 0,this.intervalId=void 0,this.legendClickTimeout=null,this.prevLegendClickTime=Math.inf,this.lastClickedLegendCurveId=null,this.MAX_DOUBLE_CLICK_INTERVAL_MS=300,this.SINGLE_CLICK_EVENT_DELAY_MS=this.MAX_DOUBLE_CLICK_INTERVAL_MS+10,this.onFocus=()=>{this.setState({focused:!0})},this.onBlur=()=>{this.setState({focused:!1})},this.clearEventListeners=()=>{window.removeEventListener("focus",this.onFocus),window.removeEventListener("blur",this.onBlur)},this.clearInterval=()=>{clearInterval(this.intervalId),this.intervalId=null},this.allRunsCompleted=()=>this.props.completedRunUuids.length===this.props.runUuids.length,this.isHangingRunUuid=e=>{const t=this.props.latestMetricsByRunUuid[e];if(!t)return!1;const s=Object.values(t).map((({timestamp:e})=>e)),i=Math.max(...s);return(new Date).getTime()-i>6048e5},this.getActiveRunUuids=()=>{const{completedRunUuids:e,runUuids:t}=this.props;return(0,c.difference)(t,e).filter((0,c.negate)(this.isHangingRunUuid))},this.shouldPoll=()=>!(this.allRunsCompleted()||0===this.getActiveRunUuids().length),this.updateUrlState=e=>{const{runUuids:t,metricKey:s,location:i,navigate:n}=this.props,a=JSON.parse(_().parse(i.search).experiments),r={...this.getUrlState(),...e},{selectedXAxis:o,selectedMetricKeys:l,showPoint:c,yAxisLogScale:d,lineSmoothness:u,layout:h,deselectedCurves:p,lastLinearYAxisRange:m}=r;n(x.Ay.getMetricPageRoute(t,s,a,l,h,o,d,u,c,p,m),{replace:!0})},this.getNumTotalMetrics=()=>this.props.metricsWithRunInfoAndHistory.map((({history:e})=>e.length)).reduce(((e,t)=>e+t),0),this.loadMetricHistory=(e,t)=>{if(this.getNumTotalMetrics()>=X)return r.A.logErrorAndNotifyUser("The total number of metric data points exceeded 100,000. Cannot fetch more metrics."),Promise.resolve([]);this.setState({loading:!0});const s=e.flatMap((e=>t.map((t=>({runUuid:e,metricKey:t}))))).filter((({runUuid:e,metricKey:t})=>this.props.latestMetricsByRunUuid[e].hasOwnProperty(t))).map((async({runUuid:e,metricKey:t})=>{const s=[],i=(0,E.yk)();s.push(i);let n=(await this.props.getMetricHistoryApi(e,t,25e3,void 0,i)).value.next_page_token;for(;n;){if(this.getNumTotalMetrics()>=X)return{requestIds:s,success:!1};const i=(0,E.yk)();s.push(i);n=(await this.props.getMetricHistoryApi(e,t,25e3,n,i)).value.next_page_token}return{requestIds:s,success:!0}}));return Promise.all(s).then((e=>(this._isMounted&&this.setState({loading:!1}),e.every((({success:e})=>e))||r.A.logErrorAndNotifyUser("The total number of metric data points exceeded 100,000. Aborted fetching metrics."),e.flatMap((({requestIds:e})=>e)))))},this.loadRuns=e=>{const t=[];return e.forEach((e=>{const s=(0,E.yk)();this.props.getRunApi(e),t.push(s)})),t},this.getMetrics=()=>{const e=this.getUrlState(),t=new Set(e.selectedMetricKeys),{selectedXAxis:s}=e,{metricsWithRunInfoAndHistory:i}=this.props,n=i.filter((e=>t.has(e.metricKey)));return n.forEach((e=>{const t=s===h.c1&&e.history[0]&&(0,c.isNumber)(e.history[0].step);e.history.sort(t?r.A.compareByStepAndTimestamp:r.A.compareByTimestamp)})),n},this.handleYAxisLogScaleChange=e=>{const t=this.getUrlState(),s=(0,c.cloneDeep)(t.layout),i=e?"log":"linear";if(!e&&t.lastLinearYAxisRange&&t.lastLinearYAxisRange.length>0)return s.yaxis={type:"linear",range:t.lastLinearYAxisRange},void this.updateUrlState({layout:s,lastLinearYAxisRange:[]});if(!t.layout.yaxis||!t.layout.yaxis.range)return s.yaxis={type:i,autorange:!0,..."log"===i?{exponentformat:"e"}:{}},void this.updateUrlState({layout:s,lastLinearYAxisRange:[]});let n=[];const a=t.layout.yaxis.range;e?a[0]<=0?(n=a,s.yaxis={type:"log",autorange:!0,exponentformat:"e"}):s.yaxis={type:"log",range:[Math.log(a[0])/Math.log(10),Math.log(a[1])/Math.log(10)],exponentformat:"e"}:s.yaxis={type:"linear",range:[Math.pow(10,a[0]),Math.pow(10,a[1])]},this.updateUrlState({layout:s,lastLinearYAxisRange:n})},this.handleXAxisChange=e=>{const t=this.getUrlState(),s={[h.up]:"date",[h.gW]:"linear",[h.c1]:"linear"}[e.target.value]||"linear",i={...t.layout,xaxis:{autorange:!0,type:s}};this.updateUrlState({selectedXAxis:e.target.value,layout:i})},this.handleLayoutChange=e=>{this.displayPopover=!1;const t=this.getUrlState(),{"xaxis.range[0]":s,"xaxis.range[1]":i,"yaxis.range[0]":n,"yaxis.range[1]":a,"xaxis.autorange":r,"yaxis.autorange":o,"yaxis.showspikes":l,"xaxis.showspikes":c,...d}=e;let u={...t.layout,...d},h=[...t.lastLinearYAxisRange];const p=u.xaxis||{};void 0!==s&&void 0!==i&&(p.range=[s,i],p.autorange=!1),c&&(p.showspikes=!0),r&&(p.autorange=!0);const m=u.yaxis||{};if(void 0!==n&&void 0!==a&&(m.range=[n,a],m.autorange=!1),l&&(m.showspikes=!0),o){h=[];const e=t.layout&&t.layout.yaxis&&"log"===t.layout.yaxis.type?"log":"linear";m.autorange=!0,m.type=e}"log"===m.type&&(m.exponentformat="e"),u={...u,xaxis:p,yaxis:m},this.updateUrlState({layout:u,lastLinearYAxisRange:h})},this.handleDownloadCsv=()=>{const e=H(this.props.metricsWithRunInfoAndHistory),t=new Blob([e],{type:"application/csv;charset=utf-8"});(0,F.saveAs)(t,"metrics.csv")},this.handleLegendClick=({curveNumber:e,data:t})=>{const s=this.getUrlState(),i=Date.now();if(i-this.prevLegendClickTime<this.MAX_DOUBLE_CLICK_INTERVAL_MS&&e===this.lastClickedLegendCurveId)this.handleLegendDoubleClick({curveNumber:e,data:t}),this.prevLegendClickTime=Math.inf;else{const n=W.getCurveKey(t[e]);this.legendClickTimeout=window.setTimeout((()=>{const e=new Set(s.deselectedCurves);e.has(n)?e.delete(n):e.add(n),this.updateUrlState({deselectedCurves:Array.from(e)})}),this.SINGLE_CLICK_EVENT_DELAY_MS),this.prevLegendClickTime=i}return this.lastClickedLegendCurveId=e,!1},this.handleLegendDoubleClick=({curveNumber:e,data:t})=>{window.clearTimeout(this.legendClickTimeout);const s=W.getCurveKey(t[e]),i=t.map((e=>W.getCurveKey(e))).filter((e=>e!==s));return this.updateUrlState({deselectedCurves:i}),!1},this.handleMetricsSelectChange=e=>{const t=this.getUrlState().selectedMetricKeys||[],s=e.filter((e=>!t.includes(e)));this.updateUrlState({selectedMetricKeys:e}),this.loadMetricHistory(this.props.runUuids,s).then((e=>{this.setState({loading:!1}),this.setState((t=>({historyRequestIds:[...t.historyRequestIds,...e]})))}))},this.handleShowPointChange=e=>this.updateUrlState({showPoint:e}),this.handleLineSmoothChange=e=>this.updateUrlState({lineSmoothness:e}),this.handleKeyDownOnPopover=({key:e})=>{"Escape"===e&&this.setState({popoverVisible:!1})},this.updatePopover=e=>{this.displayPopover=!this.displayPopover,setTimeout((()=>{if(this.displayPopover){this.displayPopover=!1;const{popoverVisible:t,popoverX:s,popoverY:i}=this.state,{points:n,event:{clientX:a,clientY:r}}=e,o=s===a&&i===r,l=n.sort(((e,t)=>t.y-e.y)).map((e=>({runId:e.data.runId,name:e.data.name,color:e.fullData.marker.color,y:e.y})));this.setState({popoverVisible:!t||!o,popoverX:a,popoverY:r,popoverRunItems:l})}}),300)},this.state={historyRequestIds:[],popoverVisible:!1,popoverX:0,popoverY:0,popoverRunItems:[],focused:!0,loading:!1},this.displayPopover=!1,this.intervalId=null}hasMultipleExperiments(){return this.props.experimentIds&&this.props.experimentIds.length>1}componentDidMount(){this._isMounted=!0,this.loadMetricHistory(this.props.runUuids,this.getUrlState().selectedMetricKeys),this.shouldPoll()&&(window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus),this.intervalId=setInterval((()=>{if(this.state.focused){const e=this.getActiveRunUuids();this.loadMetricHistory(e,this.getUrlState().selectedMetricKeys),this.loadRuns(e),this.shouldPoll()||(this.clearEventListeners(),this.clearInterval())}}),O))}componentWillUnmount(){this._isMounted=!1,this.clearEventListeners(),this.clearInterval()}getUrlState(){return r.A.getMetricPlotStateFromUrl(this.props.location.search)}static predictChartType(e){return e&&e.length&&(0,c.every)(e,(e=>e.history&&1===e.history.length))?q:B}static isComparing(e){const t=_().parse(e),s=t&&t["?runs"];return!!s&&JSON.parse(s).length>1}getAxisType(){const e=this.getUrlState();return e.layout&&e.layout.yaxis&&"log"===e.layout.yaxis.type?"log":"linear"}static getCurveKey(e){return"bar"===e.type?e.runId:r.A.getCurveKey(e.runId,e.metricName)}render(){const{experimentIds:e,runUuids:t,runDisplayNames:s,distinctMetricKeys:n,location:a}=this.props,{popoverVisible:r,popoverX:l,popoverY:c,popoverRunItems:u,loading:p}=this.state,m=this.getUrlState(),{showPoint:y,selectedXAxis:v,selectedMetricKeys:f,lineSmoothness:x}=m,C="log"===this.getAxisType(),{historyRequestIds:M}=this.state,A=this.getMetrics(),b=W.predictChartType(A);return(0,g.FD)("div",{className:"mlflow-metrics-plot-container",children:[(0,g.Y)(h.jC,{numRuns:this.props.runUuids.length,numCompletedRuns:this.props.completedRunUuids.length,distinctMetricKeys:n,selectedXAxis:v,selectedMetricKeys:f,handleXAxisChange:this.handleXAxisChange,handleMetricsSelectChange:this.handleMetricsSelectChange,handleShowPointChange:this.handleShowPointChange,handleYAxisLogScaleChange:this.handleYAxisLogScaleChange,handleLineSmoothChange:this.handleLineSmoothChange,chartType:b,lineSmoothness:x,yAxisLogScale:C,showPoint:y,handleDownloadCsv:this.handleDownloadCsv,disableSmoothnessControl:this.props.containsInfinities}),(0,g.Y)("div",{className:"metrics-plot-data",children:(0,g.FD)(o.Ay,{requestIds:M,shouldOptimisticallyRender:0===M.length,children:[this.hasMultipleExperiments()?null:(0,g.Y)(P,{experimentId:e[0],visible:r,x:l,y:c,runItems:u,handleKeyDown:this.handleKeyDownOnPopover,handleClose:()=>this.setState({popoverVisible:!1}),handleVisibleChange:e=>this.setState({popoverVisible:e})}),(0,g.Y)(K.S,{size:"large",css:(0,i.AH)({visibility:p?"visible":"hidden"},"")}),(0,g.Y)(d.gT,{runUuids:t,runDisplayNames:s,xAxis:v,metrics:this.getMetrics(),metricKeys:f,showPoint:y,chartType:b,isComparing:W.isComparing(a.search),lineSmoothness:x,extraLayout:m.layout,deselectedCurves:m.deselectedCurves,onLayoutChange:this.handleLayoutChange,onClick:this.updatePopover,onLegendClick:this.handleLegendClick,onLegendDoubleClick:this.handleLegendDoubleClick}),(0,g.Y)(R,{runUuids:t,runDisplayNames:s,metricKeys:f})]})})]})}}W.defaultProps={containsInfinities:!1};const j={getMetricHistoryApi:l.Ly,getRunApi:l.aO};var z=(0,D.h)((0,a.Ng)(((e,t)=>{const{runUuids:s}=t,i=s.filter((t=>"RUNNING"!==(0,u.K4)(t,e).status)),{latestMetricsByRunUuid:n,metricsByRunUuid:a}=e.entities,o=(0,c.flatMap)(s,(e=>{const t=n[e];return t?Object.keys(t):[]})),l=[...new Set(o)].sort(),d=[];let h=!1;const p=(0,c.flatMap)(s,(t=>{const s=r.A.getRunDisplayName((0,u.K4)(t,e),t);d.push(s);const i=a[t];return i?Object.keys(i).map((e=>{const n=i[e].map((e=>(0,V.rj)(e)));return n.some((({value:e})=>"number"===typeof e&&!isNaN(e)&&!isFinite(e)))&&(h=!0),{metricKey:e,history:n,runUuid:t,runDisplayName:s}})):[]}));return{runDisplayNames:d,latestMetricsByRunUuid:n,distinctMetricKeys:l,metricsWithRunInfoAndHistory:p,completedRunUuids:i,containsInfinities:h}}),j)(W))},20193:function(e,t,s){s.d(t,{o:function(){return p}});var i=s(89555),n=s(16934),a=s(68048),r=s(39330),o=s(9133),l=s(31014),c=s(50111);const d=(e,t,s)=>(0,o.keys)(e).reduce(((e,s)=>Math.abs(Number(s)-t)<Math.abs(e-t)?Number(s):Number(e)),s),u=(e,t,s)=>"down"===s?Math.max(...Object.keys(e).filter((e=>Number(e)<t)).map(Number)):Math.min(...Object.keys(e).filter((e=>Number(e)>t)).map(Number));var h={name:"b9l38d",styles:"width:min-content"};const p=({max:e=1,min:t=0,step:s,marks:p,value:m,onChange:g,disabled:y,onAfterChange:v,componentId:f,className:x})=>{const{theme:C}=(0,n.u)(),M=!(0,o.isEmpty)(p),A=M&&Object.keys(p).length<10,[b,w]=(0,l.useState)(void 0);return(0,c.FD)("div",{css:(0,i.AH)({display:"flex",height:C.general.heightSm,gap:C.spacing.md,alignItems:"center"},""),children:[(0,c.FD)(a.Slider.Root,{disabled:y,css:(0,i.AH)({flex:1,position:"relative","span:last-child":{zIndex:2}},""),className:x,min:t,max:e,value:[null!==m&&void 0!==m?m:0],onValueCommit:([e])=>null===v||void 0===v?void 0:v(e),onKeyDown:e=>{if(M&&(e.preventDefault(),["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(e.key))){const t=u(p,null!==m&&void 0!==m?m:0,"ArrowLeft"===e.key||"ArrowDown"===e.key?"down":"up");null===v||void 0===v||v(t),g(t)}},onValueChange:([e])=>{g(M?d(p,e,null!==m&&void 0!==m?m:0):e)},step:null!==s&&void 0!==s?s:void 0,children:[A&&(0,c.Y)("div",{css:(0,i.AH)({position:"absolute",inset:0,marginRight:14},""),children:(0,o.keys)(p).map((s=>(0,c.Y)("div",{css:(0,i.AH)({position:"absolute",zIndex:1,top:0,right:0,bottom:0,marginLeft:-1.5,marginTop:6,pointerEvents:"none",borderRadius:"100%",backgroundColor:C.colors.actionPrimaryBackgroundDefault,height:8,width:8,opacity:.5},""),style:{left:Number(s)/(e-t)*100+"%"}},s)))}),(0,c.Y)(a.Slider.Track,{className:"TRACK",children:(0,c.Y)(a.Slider.Range,{})}),(0,c.Y)(a.Slider.Thumb,{css:(0,i.AH)({position:"relative",height:14,width:14},"")})]}),(0,c.Y)(r.I,{componentId:null!==f&&void 0!==f?f:"mlflow.experiment_tracking.common.line_smooth_slider",type:"number",disabled:y,min:t,max:e,css:h,step:s,value:null!==b&&void 0!==b?b:m,onBlur:()=>{(0,o.isUndefined)(b)||(M?(null===v||void 0===v||v(d(p,b,null!==m&&void 0!==m?m:0)),g(d(p,b,null!==m&&void 0!==m?m:0))):(null===v||void 0===v||v((0,o.clamp)(b,t,e)),g((0,o.clamp)(b,t,e))),w(void 0))},onChange:({target:s,nativeEvent:i})=>{if(i instanceof InputEvent)w(Number(s.value));else if(M){const e=u(p,null!==m&&void 0!==m?m:0,Number(s.value)<Number(m)?"down":"up");g(e)}else g((0,o.clamp)(Number(s.value),t,e))}})]})}},79445:function(e,t,s){s.d(t,{W:function(){return l}});var i=s(31014),n=s(68048),a=s(27705),r=s(50111);const o=i.lazy((()=>s.e(4850).then(s.bind(s,84850)))),l=({fallback:e,...t})=>(0,r.Y)(a.g,{children:(0,r.Y)(i.Suspense,{fallback:null!==e&&void 0!==e?e:(0,r.Y)(n.LegacySkeleton,{active:!0}),children:(0,r.Y)(o,{...t})})})},82645:function(e,t,s){s.d(t,{gT:function(){return x},mV:function(){return g}});var i=s(4473),n=s(68341),a=s(31014),r=s(76010),o=s(9133),l=s(47019),c=s(89933),d=s(3159),u=s(79445),h=s(32039),p=s(64912),m=s(50111);const g=(e,t)=>{if(t<=1||!e||e.length<=1||e.every((t=>t===e[0])))return e;const s=t/(c.W0+1),i=[];let n=0;for(let a=0;a<e.length;a++)if(isNaN(e[a]))i.push(e[a]);else{n=n*s+(1-s)*e[a];const t=n/(1-Math.pow(s,a+1));i.push(t)}return i},y={width:857.1,height:1e3,path:"m214-7h429v214h-429v-214z m500 0h72v500q0 8-6 21t-11 20l-157 156q-5 6-19 12t-22 5v-232q0-22-15-38t-38-16h-322q-22 0-37 16t-16 38v232h-72v-714h72v232q0 22 16 38t37 16h465q22 0 38-16t15-38v-232z m-214 518v178q0 8-5 13t-13 5h-107q-7 0-13-5t-5-13v-178q0-8 5-13t13-5h107q7 0 13 5t5 13z m357-18v-518q0-22-15-38t-38-16h-750q-23 0-38 16t-16 38v750q0 22 16 38t38 16h517q23 0 50-12t42-26l156-157q16-15 27-42t11-49z",transform:"matrix(1 0 0 -1 0 850)"};var v=(0,n.A)("annotationData");class f extends a.Component{constructor(...e){super(...e),this.regenerateInfinityAnnotations=()=>{var e;const{metrics:t,xAxis:s,extraLayout:n}=this.props,a="log"===(null===n||void 0===n||null===(e=n.yaxis)||void 0===e?void 0:e.type),r={};t.forEach((e=>{const{metricKey:t,history:i}=e;r[t]=(0,h.cX)({xValues:x.getXValuesForLineChart(i,s,this.props.intl),yValues:i.map((e=>"number"===typeof e.value?e.value:Number(e.value))),isLogScale:a,stringFormatter:e=>this.props.intl.formatMessage(e,{metricKey:t})})})),(0,i.A)(this,v)[v]=r},Object.defineProperty(this,v,{writable:!0,value:{}}),this.getPlotPropsForLineChart=()=>{const{metrics:e,xAxis:t,showPoint:s,lineSmoothness:n,isComparing:a,deselectedCurves:o}=this.props,l=new Set(o),c=[],d=[],u={data:e.map((e=>{const{metricKey:o,runDisplayName:u,history:h,runUuid:p}=e,m=h.map((e=>"number"===typeof e.value?e.value:Number(e.value))),y=m.filter((e=>!isNaN(e))).length<=1,f=!l.has(r.A.getCurveKey(p,o))||"legendonly";return(0,i.A)(this,v)[v]&&o in(0,i.A)(this,v)[v]&&!0===f&&(c.push(...(0,i.A)(this,v)[v][o].shapes),d.push(...(0,i.A)(this,v)[v][o].annotations)),{name:x.getLineLegend(o,u,a),x:x.getXValuesForLineChart(h,t),y:(y?m:g(m,n)).map((e=>isFinite(e)?e:NaN)),text:m.map((e=>isNaN(e)?e:e.toFixed(5))),type:"scattergl",mode:y?"markers":"lines+markers",marker:{opacity:y||s?1:0},hovertemplate:y||1===n?"%{y}":"Value: %{text}<br>Smoothed: %{y}",visible:f,runId:p,metricName:o}}))};return u.layout={...u.layout,...this.props.extraLayout,shapes:c,annotations:d},u},this.getPlotPropsForBarChart=()=>{const{runUuids:e,runDisplayNames:t,deselectedCurves:s}=this.props,i=this.props.metrics.reduce(((e,t)=>{const{runUuid:s,metricKey:i,history:n}=t,a=n[0]&&n[0].value;return e[i]?e[i][s]=a:e[i]={metricKey:i,[s]:a},e}),{}),n=(0,o.sortBy)(Object.values(i),"metricKey"),a=n.map((e=>e.metricKey)),l=new Set(s),c={data:e.map(((e,s)=>{const i=l.has(e)?{visible:"legendonly"}:{};return{name:r.A.truncateString(t[s],24),x:a,y:n.map((t=>t[e])),type:"bar",runId:e,...i}})),layout:{barmode:"group"}};return c.layout={...c.layout,...this.props.extraLayout},c}}static getXValuesForLineChart(e,t,s){if(0===e.length)return[];switch(t){case c.c1:return e.map((({step:e})=>e));case c.gW:{const{timestamp:t}=(0,o.minBy)(e,"timestamp");return e.map((({timestamp:e})=>(e-t)/1e3))}default:return e.map((({timestamp:e})=>e))}}componentDidMount(){this.regenerateInfinityAnnotations()}componentDidUpdate(){this.regenerateInfinityAnnotations()}render(){const{onLayoutChange:e,onClick:t,onLegendClick:s,onLegendDoubleClick:i}=this.props,n=this.props.chartType===d.S9?this.getPlotPropsForBarChart():this.getPlotPropsForLineChart();return(0,m.Y)("div",{className:"metrics-plot-view-container",children:(0,m.Y)(u.W,{...n,useResizeHandler:!0,onRelayout:e,onClick:t,onLegendClick:s,onLegendDoubleClick:i,style:{width:"100%",height:"100%"},layout:(0,o.cloneDeep)(n.layout),config:{displaylogo:!1,scrollZoom:!0,modeBarButtonsToRemove:["sendDataToCloud"],modeBarButtonsToAdd:[{name:"Download plot data as CSV",icon:y,click:()=>{const e=(0,d.I$)(this.props.metrics),t=new Blob([e],{type:"application/csv;charset=utf-8"});(0,l.saveAs)(t,"metrics.csv")}}]}})})}}f.getLineLegend=(e,t,s)=>{let i=e;return s&&(i+=`, ${r.A.truncateString(t,24)}`),i};const x=(0,p.Ay)(f)},89933:function(e,t,s){s.d(t,{W0:function(){return v},jC:function(){return M},gW:function(){return y},c1:function(){return g},up:function(){return m}});var i=s(31014),n=s(68048),a=s(16934),r=s(50111);const o=e=>(0,r.FD)("div",{css:l.wrapper,className:e.className,children:[(0,r.Y)("div",{css:l.track,children:(0,r.Y)("div",{css:l.progressTrack,style:{width:`${e.percent}%`}})}),e.format(e.percent)]}),l={wrapper:e=>({display:"flex",alignItems:"center",gap:e.spacing.sm}),track:e=>({backgroundColor:e.colors.backgroundSecondary,height:e.spacing.sm,flex:1,borderRadius:e.spacing.sm}),progressTrack:e=>({backgroundColor:e.colors.primary,height:e.spacing.sm,borderRadius:e.spacing.sm})};var c=s(3159),d=s(88443),u=s(64912),h=s(20193);const p=n.Radio.Group,m="wall",g="step",y="relative",v=100;var f={name:"1vuhrro",styles:"text-align:justify;text-align-last:left"};class x extends i.Component{constructor(...e){super(...e),this.handleMetricsSelectFilterChange=(e,t)=>t.props.title.toUpperCase().includes(e.toUpperCase()),this.getAllMetricKeys=()=>{const{distinctMetricKeys:e}=this.props;return e.map((e=>({title:e,value:e,key:e})))}}render(){const{chartType:e,yAxisLogScale:t,lineSmoothness:s,showPoint:i,numRuns:l,numCompletedRuns:u,disableSmoothnessControl:x}=this.props,M=(0,r.Y)(d.A,{id:"0gIYIc",defaultMessage:'Make the line between points "smoother" based on Exponential Moving Average. Smoothing can be useful for displaying the overall trend when the logging frequency is high.'}),A=(0,r.Y)(d.A,{id:"UEDu0c",defaultMessage:"MLflow UI automatically fetches metric histories for active runs and updates the metrics plot with a {interval} second interval.",values:{interval:Math.round(c.nl/1e3)}});return(0,r.FD)("div",{className:"plot-controls",css:[C.controlsWrapper,e===c.PK&&C.centeredControlsWrapper,""],children:[e===c.PK?(0,r.FD)("div",{children:[(0,r.Y)("div",{className:"inline-control",children:(0,r.FD)("div",{className:"control-label",children:[(0,r.Y)(d.A,{id:"nEoTsR",defaultMessage:"Completed Runs"})," ",(0,r.Y)(n.LegacyTooltip,{title:A,children:(0,r.Y)(n.QuestionMarkIcon,{})}),(0,r.Y)(o,{percent:Math.round(100*u/l),format:()=>`${u}/${l}`})]})}),(0,r.FD)("div",{className:"inline-control",children:[(0,r.Y)("div",{className:"control-label",children:(0,r.Y)(d.A,{id:"yzxYIm",defaultMessage:"Points:"})}),(0,r.Y)(n.Switch,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_metricsplotcontrols.tsx_120","data-testid":"show-point-toggle",defaultChecked:i,onChange:this.props.handleShowPointChange})]}),!x&&(0,r.FD)("div",{className:"block-control",children:[(0,r.FD)("div",{className:"control-label",children:[(0,r.Y)(d.A,{id:"T4eipT",defaultMessage:"Line Smoothness"})," ",(0,r.Y)(n.LegacyTooltip,{title:M,children:(0,r.Y)(n.QuestionMarkIcon,{})})]}),(0,r.Y)(h.o,{"data-testid":"smoothness-toggle",min:1,max:v,onChange:this.props.handleLineSmoothChange,value:s})]}),(0,r.FD)("div",{className:"block-control",children:[(0,r.Y)("div",{className:"control-label",children:(0,r.Y)(d.A,{id:"L26D19",defaultMessage:"X-axis:"})}),(0,r.FD)(p,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_metricsplotcontrols.tsx_154",name:"metrics-plot-x-axis-radio-group",css:C.xAxisControls,onChange:this.props.handleXAxisChange,value:this.props.selectedXAxis,children:[(0,r.Y)(n.Radio,{value:g,"data-testid":"x-axis-radio",children:(0,r.Y)(d.A,{id:"nQoUED",defaultMessage:"Step"})}),(0,r.Y)(n.Radio,{value:m,"data-testid":"x-axis-radio",children:(0,r.Y)(d.A,{id:"8flziy",defaultMessage:"Time (Wall)"})}),(0,r.Y)(n.Radio,{value:y,"data-testid":"x-axis-radio",children:(0,r.Y)(d.A,{id:"aNnPar",defaultMessage:"Time (Relative)"})})]})]})]}):null,(0,r.FD)("div",{className:"block-control",children:[(0,r.Y)("div",{className:"control-label",children:(0,r.Y)(d.A,{id:"QC5Vjq",defaultMessage:"Y-axis:"})}),(0,r.Y)(n.LegacySelect,{placeholder:this.props.intl.formatMessage({id:"aXw0NO",defaultMessage:"Please select metric"}),value:this.props.selectedMetricKeys,onChange:this.props.handleMetricsSelectChange,mode:"multiple",css:C.axisSelector,children:this.getAllMetricKeys().map((e=>(0,r.Y)(n.LegacySelect.Option,{value:e.value,children:e.title},e.key)))})]}),(0,r.FD)("div",{className:"inline-control",children:[(0,r.Y)("div",{className:"control-label",children:(0,r.Y)(d.A,{id:"HGG+BI",defaultMessage:"Y-axis Log Scale:"})}),(0,r.Y)(n.Switch,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_metricsplotcontrols.tsx_220",defaultChecked:t,onChange:this.props.handleYAxisLogScaleChange})]}),(0,r.Y)("div",{className:"inline-control",children:(0,r.FD)(a.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_metricsplotcontrols.tsx_222",css:f,onClick:this.props.handleDownloadCsv,children:[(0,r.Y)(d.A,{id:"3S3Ah4",defaultMessage:"Download data"}),(0,r.Y)("i",{className:"fa fa-download"})]})})]})}}x.defaultProps={disableSmoothnessControl:!1};const C={xAxisControls:e=>({label:{marginTop:e.spacing.xs,marginBottom:e.spacing.xs}}),controlsWrapper:{minWidth:"20%",maxWidth:"30%"},axisSelector:{width:"100%"},centeredControlsWrapper:{justifyContent:"center"}},M=(0,u.Ay)(x)}}]);
//# sourceMappingURL=1107.c4dd9cf4.chunk.js.map